const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./index-BWEtM_lB.js","./index-BjkuSehU.js","./index-BdLuVvBa.js","./index-BqZ6UJOu.js"])))=>i.map(i=>d[i]);
var Que=Object.defineProperty;var Hue=(r,s,a)=>s in r?Que(r,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):r[s]=a;var Nc=(r,s,a)=>Hue(r,typeof s!="symbol"?s+"":s,a);function xK(r,s){for(var a=0;a<s.length;a++){const c=s[a];if(typeof c!="string"&&!Array.isArray(c)){for(const A in c)if(A!=="default"&&!(A in r)){const u=Object.getOwnPropertyDescriptor(c,A);u&&Object.defineProperty(r,A,u.get?u:{enumerable:!0,get:()=>c[A]})}}}return Object.freeze(Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}))}(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const A of document.querySelectorAll('link[rel="modulepreload"]'))c(A);new MutationObserver(A=>{for(const u of A)if(u.type==="childList")for(const m of u.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&c(m)}).observe(document,{childList:!0,subtree:!0});function a(A){const u={};return A.integrity&&(u.integrity=A.integrity),A.referrerPolicy&&(u.referrerPolicy=A.referrerPolicy),A.crossOrigin==="use-credentials"?u.credentials="include":A.crossOrigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function c(A){if(A.ep)return;A.ep=!0;const u=a(A);fetch(A.href,u)}})();const Gue="modulepreload",Kue=function(r,s){return new URL(r,s).href},ZH={},n_=function(s,a,c){let A=Promise.resolve();if(a&&a.length>0){const m=document.getElementsByTagName("link"),E=document.querySelector("meta[property=csp-nonce]"),w=(E==null?void 0:E.nonce)||(E==null?void 0:E.getAttribute("nonce"));A=Promise.allSettled(a.map(C=>{if(C=Kue(C,c),C in ZH)return;ZH[C]=!0;const T=C.endsWith(".css"),N=T?'[rel="stylesheet"]':"";if(!!c)for(let Q=m.length-1;Q>=0;Q--){const K=m[Q];if(K.href===C&&(!T||K.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${C}"]${N}`))return;const k=document.createElement("link");if(k.rel=T?"stylesheet":Gue,T||(k.as="script"),k.crossOrigin="",k.href=C,w&&k.setAttribute("nonce",w),document.head.appendChild(k),T)return new Promise((Q,K)=>{k.addEventListener("load",Q),k.addEventListener("error",()=>K(new Error(`Unable to preload CSS for ${C}`)))})}))}function u(m){const E=new Event("vite:preloadError",{cancelable:!0});if(E.payload=m,window.dispatchEvent(E),!E.defaultPrevented)throw m}return A.then(m=>{for(const E of m||[])E.status==="rejected"&&u(E.reason);return s().catch(u)})};var W0=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function DK(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}function Wue(r){if(r.__esModule)return r;var s=r.default;if(typeof s=="function"){var a=function c(){return this instanceof c?Reflect.construct(s,arguments,this.constructor):s.apply(this,arguments)};a.prototype=s.prototype}else a={};return Object.defineProperty(a,"__esModule",{value:!0}),Object.keys(r).forEach(function(c){var A=Object.getOwnPropertyDescriptor(r,c);Object.defineProperty(a,c,A.get?A:{enumerable:!0,get:function(){return r[c]}})}),a}var BK={exports:{}},rb={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Yue=Symbol.for("react.transitional.element"),zue=Symbol.for("react.fragment");function kK(r,s,a){var c=null;if(a!==void 0&&(c=""+a),s.key!==void 0&&(c=""+s.key),"key"in s){a={};for(var A in s)A!=="key"&&(a[A]=s[A])}else a=s;return s=a.ref,{$$typeof:Yue,type:r,key:c,ref:s!==void 0?s:null,props:a}}rb.Fragment=zue;rb.jsx=kK;rb.jsxs=kK;BK.exports=rb;var p=BK.exports,LK={exports:{}},nn={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var cD=Symbol.for("react.transitional.element"),que=Symbol.for("react.portal"),Xue=Symbol.for("react.fragment"),Jue=Symbol.for("react.strict_mode"),$ue=Symbol.for("react.profiler"),Zue=Symbol.for("react.consumer"),ehe=Symbol.for("react.context"),the=Symbol.for("react.forward_ref"),nhe=Symbol.for("react.suspense"),rhe=Symbol.for("react.memo"),UK=Symbol.for("react.lazy"),she=Symbol.for("react.activity"),e5=Symbol.iterator;function ihe(r){return r===null||typeof r!="object"?null:(r=e5&&r[e5]||r["@@iterator"],typeof r=="function"?r:null)}var PK={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},MK=Object.assign,FK={};function _f(r,s,a){this.props=r,this.context=s,this.refs=FK,this.updater=a||PK}_f.prototype.isReactComponent={};_f.prototype.setState=function(r,s){if(typeof r!="object"&&typeof r!="function"&&r!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,r,s,"setState")};_f.prototype.forceUpdate=function(r){this.updater.enqueueForceUpdate(this,r,"forceUpdate")};function jK(){}jK.prototype=_f.prototype;function lD(r,s,a){this.props=r,this.context=s,this.refs=FK,this.updater=a||PK}var AD=lD.prototype=new jK;AD.constructor=lD;MK(AD,_f.prototype);AD.isPureReactComponent=!0;var t5=Array.isArray;function TO(){}var Dr={H:null,A:null,T:null,S:null},VK=Object.prototype.hasOwnProperty;function dD(r,s,a){var c=a.ref;return{$$typeof:cD,type:r,key:s,ref:c!==void 0?c:null,props:a}}function ahe(r,s){return dD(r.type,s,r.props)}function uD(r){return typeof r=="object"&&r!==null&&r.$$typeof===cD}function ohe(r){var s={"=":"=0",":":"=2"};return"$"+r.replace(/[=:]/g,function(a){return s[a]})}var n5=/\/+/g;function oN(r,s){return typeof r=="object"&&r!==null&&r.key!=null?ohe(""+r.key):s.toString(36)}function che(r){switch(r.status){case"fulfilled":return r.value;case"rejected":throw r.reason;default:switch(typeof r.status=="string"?r.then(TO,TO):(r.status="pending",r.then(function(s){r.status==="pending"&&(r.status="fulfilled",r.value=s)},function(s){r.status==="pending"&&(r.status="rejected",r.reason=s)})),r.status){case"fulfilled":return r.value;case"rejected":throw r.reason}}throw r}function Cp(r,s,a,c,A){var u=typeof r;(u==="undefined"||u==="boolean")&&(r=null);var m=!1;if(r===null)m=!0;else switch(u){case"bigint":case"string":case"number":m=!0;break;case"object":switch(r.$$typeof){case cD:case que:m=!0;break;case UK:return m=r._init,Cp(m(r._payload),s,a,c,A)}}if(m)return A=A(r),m=c===""?"."+oN(r,0):c,t5(A)?(a="",m!=null&&(a=m.replace(n5,"$&/")+"/"),Cp(A,s,a,"",function(C){return C})):A!=null&&(uD(A)&&(A=ahe(A,a+(A.key==null||r&&r.key===A.key?"":(""+A.key).replace(n5,"$&/")+"/")+m)),s.push(A)),1;m=0;var E=c===""?".":c+":";if(t5(r))for(var w=0;w<r.length;w++)c=r[w],u=E+oN(c,w),m+=Cp(c,s,a,u,A);else if(w=ihe(r),typeof w=="function")for(r=w.call(r),w=0;!(c=r.next()).done;)c=c.value,u=E+oN(c,w++),m+=Cp(c,s,a,u,A);else if(u==="object"){if(typeof r.then=="function")return Cp(che(r),s,a,c,A);throw s=String(r),Error("Objects are not valid as a React child (found: "+(s==="[object Object]"?"object with keys {"+Object.keys(r).join(", ")+"}":s)+"). If you meant to render a collection of children, use an array instead.")}return m}function Y0(r,s,a){if(r==null)return r;var c=[],A=0;return Cp(r,c,"","",function(u){return s.call(a,u,A++)}),c}function lhe(r){if(r._status===-1){var s=r._result;s=s(),s.then(function(a){(r._status===0||r._status===-1)&&(r._status=1,r._result=a)},function(a){(r._status===0||r._status===-1)&&(r._status=2,r._result=a)}),r._status===-1&&(r._status=0,r._result=s)}if(r._status===1)return r._result.default;throw r._result}var r5=typeof reportError=="function"?reportError:function(r){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var s=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof r=="object"&&r!==null&&typeof r.message=="string"?String(r.message):String(r),error:r});if(!window.dispatchEvent(s))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",r);return}console.error(r)},Ahe={map:Y0,forEach:function(r,s,a){Y0(r,function(){s.apply(this,arguments)},a)},count:function(r){var s=0;return Y0(r,function(){s++}),s},toArray:function(r){return Y0(r,function(s){return s})||[]},only:function(r){if(!uD(r))throw Error("React.Children.only expected to receive a single React element child.");return r}};nn.Activity=she;nn.Children=Ahe;nn.Component=_f;nn.Fragment=Xue;nn.Profiler=$ue;nn.PureComponent=lD;nn.StrictMode=Jue;nn.Suspense=nhe;nn.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=Dr;nn.__COMPILER_RUNTIME={__proto__:null,c:function(r){return Dr.H.useMemoCache(r)}};nn.cache=function(r){return function(){return r.apply(null,arguments)}};nn.cacheSignal=function(){return null};nn.cloneElement=function(r,s,a){if(r==null)throw Error("The argument must be a React element, but you passed "+r+".");var c=MK({},r.props),A=r.key;if(s!=null)for(u in s.key!==void 0&&(A=""+s.key),s)!VK.call(s,u)||u==="key"||u==="__self"||u==="__source"||u==="ref"&&s.ref===void 0||(c[u]=s[u]);var u=arguments.length-2;if(u===1)c.children=a;else if(1<u){for(var m=Array(u),E=0;E<u;E++)m[E]=arguments[E+2];c.children=m}return dD(r.type,A,c)};nn.createContext=function(r){return r={$$typeof:ehe,_currentValue:r,_currentValue2:r,_threadCount:0,Provider:null,Consumer:null},r.Provider=r,r.Consumer={$$typeof:Zue,_context:r},r};nn.createElement=function(r,s,a){var c,A={},u=null;if(s!=null)for(c in s.key!==void 0&&(u=""+s.key),s)VK.call(s,c)&&c!=="key"&&c!=="__self"&&c!=="__source"&&(A[c]=s[c]);var m=arguments.length-2;if(m===1)A.children=a;else if(1<m){for(var E=Array(m),w=0;w<m;w++)E[w]=arguments[w+2];A.children=E}if(r&&r.defaultProps)for(c in m=r.defaultProps,m)A[c]===void 0&&(A[c]=m[c]);return dD(r,u,A)};nn.createRef=function(){return{current:null}};nn.forwardRef=function(r){return{$$typeof:the,render:r}};nn.isValidElement=uD;nn.lazy=function(r){return{$$typeof:UK,_payload:{_status:-1,_result:r},_init:lhe}};nn.memo=function(r,s){return{$$typeof:rhe,type:r,compare:s===void 0?null:s}};nn.startTransition=function(r){var s=Dr.T,a={};Dr.T=a;try{var c=r(),A=Dr.S;A!==null&&A(a,c),typeof c=="object"&&c!==null&&typeof c.then=="function"&&c.then(TO,r5)}catch(u){r5(u)}finally{s!==null&&a.types!==null&&(s.types=a.types),Dr.T=s}};nn.unstable_useCacheRefresh=function(){return Dr.H.useCacheRefresh()};nn.use=function(r){return Dr.H.use(r)};nn.useActionState=function(r,s,a){return Dr.H.useActionState(r,s,a)};nn.useCallback=function(r,s){return Dr.H.useCallback(r,s)};nn.useContext=function(r){return Dr.H.useContext(r)};nn.useDebugValue=function(){};nn.useDeferredValue=function(r,s){return Dr.H.useDeferredValue(r,s)};nn.useEffect=function(r,s){return Dr.H.useEffect(r,s)};nn.useEffectEvent=function(r){return Dr.H.useEffectEvent(r)};nn.useId=function(){return Dr.H.useId()};nn.useImperativeHandle=function(r,s,a){return Dr.H.useImperativeHandle(r,s,a)};nn.useInsertionEffect=function(r,s){return Dr.H.useInsertionEffect(r,s)};nn.useLayoutEffect=function(r,s){return Dr.H.useLayoutEffect(r,s)};nn.useMemo=function(r,s){return Dr.H.useMemo(r,s)};nn.useOptimistic=function(r,s){return Dr.H.useOptimistic(r,s)};nn.useReducer=function(r,s,a){return Dr.H.useReducer(r,s,a)};nn.useRef=function(r){return Dr.H.useRef(r)};nn.useState=function(r){return Dr.H.useState(r)};nn.useSyncExternalStore=function(r,s,a){return Dr.H.useSyncExternalStore(r,s,a)};nn.useTransition=function(){return Dr.H.useTransition()};nn.version="19.2.0";LK.exports=nn;var z=LK.exports;const _i=DK(z),QK=xK({__proto__:null,default:_i},[z]);var HK={exports:{}},sb={},GK={exports:{}},KK={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(r){function s(we,Se){var Qe=we.length;we.push(Se);e:for(;0<Qe;){var Ye=Qe-1>>>1,It=we[Ye];if(0<A(It,Se))we[Ye]=Se,we[Qe]=It,Qe=Ye;else break e}}function a(we){return we.length===0?null:we[0]}function c(we){if(we.length===0)return null;var Se=we[0],Qe=we.pop();if(Qe!==Se){we[0]=Qe;e:for(var Ye=0,It=we.length,Fe=It>>>1;Ye<Fe;){var Ge=2*(Ye+1)-1,dt=we[Ge],Nt=Ge+1,hn=we[Nt];if(0>A(dt,Qe))Nt<It&&0>A(hn,dt)?(we[Ye]=hn,we[Nt]=Qe,Ye=Nt):(we[Ye]=dt,we[Ge]=Qe,Ye=Ge);else if(Nt<It&&0>A(hn,Qe))we[Ye]=hn,we[Nt]=Qe,Ye=Nt;else break e}}return Se}function A(we,Se){var Qe=we.sortIndex-Se.sortIndex;return Qe!==0?Qe:we.id-Se.id}if(r.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var u=performance;r.unstable_now=function(){return u.now()}}else{var m=Date,E=m.now();r.unstable_now=function(){return m.now()-E}}var w=[],C=[],T=1,N=null,B=3,k=!1,Q=!1,K=!1,Y=!1,F=typeof setTimeout=="function"?setTimeout:null,M=typeof clearTimeout=="function"?clearTimeout:null,V=typeof setImmediate<"u"?setImmediate:null;function W(we){for(var Se=a(C);Se!==null;){if(Se.callback===null)c(C);else if(Se.startTime<=we)c(C),Se.sortIndex=Se.expirationTime,s(w,Se);else break;Se=a(C)}}function q(we){if(K=!1,W(we),!Q)if(a(w)!==null)Q=!0,te||(te=!0,ue());else{var Se=a(C);Se!==null&&Xe(q,Se.startTime-we)}}var te=!1,re=-1,de=5,ce=-1;function Ae(){return Y?!0:!(r.unstable_now()-ce<de)}function ne(){if(Y=!1,te){var we=r.unstable_now();ce=we;var Se=!0;try{e:{Q=!1,K&&(K=!1,M(re),re=-1),k=!0;var Qe=B;try{t:{for(W(we),N=a(w);N!==null&&!(N.expirationTime>we&&Ae());){var Ye=N.callback;if(typeof Ye=="function"){N.callback=null,B=N.priorityLevel;var It=Ye(N.expirationTime<=we);if(we=r.unstable_now(),typeof It=="function"){N.callback=It,W(we),Se=!0;break t}N===a(w)&&c(w),W(we)}else c(w);N=a(w)}if(N!==null)Se=!0;else{var Fe=a(C);Fe!==null&&Xe(q,Fe.startTime-we),Se=!1}}break e}finally{N=null,B=Qe,k=!1}Se=void 0}}finally{Se?ue():te=!1}}}var ue;if(typeof V=="function")ue=function(){V(ne)};else if(typeof MessageChannel<"u"){var ye=new MessageChannel,De=ye.port2;ye.port1.onmessage=ne,ue=function(){De.postMessage(null)}}else ue=function(){F(ne,0)};function Xe(we,Se){re=F(function(){we(r.unstable_now())},Se)}r.unstable_IdlePriority=5,r.unstable_ImmediatePriority=1,r.unstable_LowPriority=4,r.unstable_NormalPriority=3,r.unstable_Profiling=null,r.unstable_UserBlockingPriority=2,r.unstable_cancelCallback=function(we){we.callback=null},r.unstable_forceFrameRate=function(we){0>we||125<we?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):de=0<we?Math.floor(1e3/we):5},r.unstable_getCurrentPriorityLevel=function(){return B},r.unstable_next=function(we){switch(B){case 1:case 2:case 3:var Se=3;break;default:Se=B}var Qe=B;B=Se;try{return we()}finally{B=Qe}},r.unstable_requestPaint=function(){Y=!0},r.unstable_runWithPriority=function(we,Se){switch(we){case 1:case 2:case 3:case 4:case 5:break;default:we=3}var Qe=B;B=we;try{return Se()}finally{B=Qe}},r.unstable_scheduleCallback=function(we,Se,Qe){var Ye=r.unstable_now();switch(typeof Qe=="object"&&Qe!==null?(Qe=Qe.delay,Qe=typeof Qe=="number"&&0<Qe?Ye+Qe:Ye):Qe=Ye,we){case 1:var It=-1;break;case 2:It=250;break;case 5:It=1073741823;break;case 4:It=1e4;break;default:It=5e3}return It=Qe+It,we={id:T++,callback:Se,priorityLevel:we,startTime:Qe,expirationTime:It,sortIndex:-1},Qe>Ye?(we.sortIndex=Qe,s(C,we),a(w)===null&&we===a(C)&&(K?(M(re),re=-1):K=!0,Xe(q,Qe-Ye))):(we.sortIndex=It,s(w,we),Q||k||(Q=!0,te||(te=!0,ue()))),we},r.unstable_shouldYield=Ae,r.unstable_wrapCallback=function(we){var Se=B;return function(){var Qe=B;B=Se;try{return we.apply(this,arguments)}finally{B=Qe}}}})(KK);GK.exports=KK;var dhe=GK.exports,WK={exports:{}},Li={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var uhe=z;function YK(r){var s="https://react.dev/errors/"+r;if(1<arguments.length){s+="?args[]="+encodeURIComponent(arguments[1]);for(var a=2;a<arguments.length;a++)s+="&args[]="+encodeURIComponent(arguments[a])}return"Minified React error #"+r+"; visit "+s+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function AA(){}var ki={d:{f:AA,r:function(){throw Error(YK(522))},D:AA,C:AA,L:AA,m:AA,X:AA,S:AA,M:AA},p:0,findDOMNode:null},hhe=Symbol.for("react.portal");function phe(r,s,a){var c=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:hhe,key:c==null?null:""+c,children:r,containerInfo:s,implementation:a}}var Ug=uhe.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function ib(r,s){if(r==="font")return"";if(typeof s=="string")return s==="use-credentials"?s:""}Li.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=ki;Li.createPortal=function(r,s){var a=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!s||s.nodeType!==1&&s.nodeType!==9&&s.nodeType!==11)throw Error(YK(299));return phe(r,s,null,a)};Li.flushSync=function(r){var s=Ug.T,a=ki.p;try{if(Ug.T=null,ki.p=2,r)return r()}finally{Ug.T=s,ki.p=a,ki.d.f()}};Li.preconnect=function(r,s){typeof r=="string"&&(s?(s=s.crossOrigin,s=typeof s=="string"?s==="use-credentials"?s:"":void 0):s=null,ki.d.C(r,s))};Li.prefetchDNS=function(r){typeof r=="string"&&ki.d.D(r)};Li.preinit=function(r,s){if(typeof r=="string"&&s&&typeof s.as=="string"){var a=s.as,c=ib(a,s.crossOrigin),A=typeof s.integrity=="string"?s.integrity:void 0,u=typeof s.fetchPriority=="string"?s.fetchPriority:void 0;a==="style"?ki.d.S(r,typeof s.precedence=="string"?s.precedence:void 0,{crossOrigin:c,integrity:A,fetchPriority:u}):a==="script"&&ki.d.X(r,{crossOrigin:c,integrity:A,fetchPriority:u,nonce:typeof s.nonce=="string"?s.nonce:void 0})}};Li.preinitModule=function(r,s){if(typeof r=="string")if(typeof s=="object"&&s!==null){if(s.as==null||s.as==="script"){var a=ib(s.as,s.crossOrigin);ki.d.M(r,{crossOrigin:a,integrity:typeof s.integrity=="string"?s.integrity:void 0,nonce:typeof s.nonce=="string"?s.nonce:void 0})}}else s==null&&ki.d.M(r)};Li.preload=function(r,s){if(typeof r=="string"&&typeof s=="object"&&s!==null&&typeof s.as=="string"){var a=s.as,c=ib(a,s.crossOrigin);ki.d.L(r,a,{crossOrigin:c,integrity:typeof s.integrity=="string"?s.integrity:void 0,nonce:typeof s.nonce=="string"?s.nonce:void 0,type:typeof s.type=="string"?s.type:void 0,fetchPriority:typeof s.fetchPriority=="string"?s.fetchPriority:void 0,referrerPolicy:typeof s.referrerPolicy=="string"?s.referrerPolicy:void 0,imageSrcSet:typeof s.imageSrcSet=="string"?s.imageSrcSet:void 0,imageSizes:typeof s.imageSizes=="string"?s.imageSizes:void 0,media:typeof s.media=="string"?s.media:void 0})}};Li.preloadModule=function(r,s){if(typeof r=="string")if(s){var a=ib(s.as,s.crossOrigin);ki.d.m(r,{as:typeof s.as=="string"&&s.as!=="script"?s.as:void 0,crossOrigin:a,integrity:typeof s.integrity=="string"?s.integrity:void 0})}else ki.d.m(r)};Li.requestFormReset=function(r){ki.d.r(r)};Li.unstable_batchedUpdates=function(r,s){return r(s)};Li.useFormState=function(r,s,a){return Ug.H.useFormState(r,s,a)};Li.useFormStatus=function(){return Ug.H.useHostTransitionStatus()};Li.version="19.2.0";function zK(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(zK)}catch(r){console.error(r)}}zK(),WK.exports=Li;var fhe=WK.exports;/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ds=dhe,qK=z,mhe=fhe;function Me(r){var s="https://react.dev/errors/"+r;if(1<arguments.length){s+="?args[]="+encodeURIComponent(arguments[1]);for(var a=2;a<arguments.length;a++)s+="&args[]="+encodeURIComponent(arguments[a])}return"Minified React error #"+r+"; visit "+s+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function XK(r){return!(!r||r.nodeType!==1&&r.nodeType!==9&&r.nodeType!==11)}function O_(r){var s=r,a=r;if(r.alternate)for(;s.return;)s=s.return;else{r=s;do s=r,s.flags&4098&&(a=s.return),r=s.return;while(r)}return s.tag===3?a:null}function JK(r){if(r.tag===13){var s=r.memoizedState;if(s===null&&(r=r.alternate,r!==null&&(s=r.memoizedState)),s!==null)return s.dehydrated}return null}function $K(r){if(r.tag===31){var s=r.memoizedState;if(s===null&&(r=r.alternate,r!==null&&(s=r.memoizedState)),s!==null)return s.dehydrated}return null}function s5(r){if(O_(r)!==r)throw Error(Me(188))}function ghe(r){var s=r.alternate;if(!s){if(s=O_(r),s===null)throw Error(Me(188));return s!==r?null:r}for(var a=r,c=s;;){var A=a.return;if(A===null)break;var u=A.alternate;if(u===null){if(c=A.return,c!==null){a=c;continue}break}if(A.child===u.child){for(u=A.child;u;){if(u===a)return s5(A),r;if(u===c)return s5(A),s;u=u.sibling}throw Error(Me(188))}if(a.return!==c.return)a=A,c=u;else{for(var m=!1,E=A.child;E;){if(E===a){m=!0,a=A,c=u;break}if(E===c){m=!0,c=A,a=u;break}E=E.sibling}if(!m){for(E=u.child;E;){if(E===a){m=!0,a=u,c=A;break}if(E===c){m=!0,c=u,a=A;break}E=E.sibling}if(!m)throw Error(Me(189))}}if(a.alternate!==c)throw Error(Me(190))}if(a.tag!==3)throw Error(Me(188));return a.stateNode.current===a?r:s}function ZK(r){var s=r.tag;if(s===5||s===26||s===27||s===6)return r;for(r=r.child;r!==null;){if(s=ZK(r),s!==null)return s;r=r.sibling}return null}var Br=Object.assign,_he=Symbol.for("react.element"),z0=Symbol.for("react.transitional.element"),wg=Symbol.for("react.portal"),kp=Symbol.for("react.fragment"),e8=Symbol.for("react.strict_mode"),RO=Symbol.for("react.profiler"),t8=Symbol.for("react.consumer"),fl=Symbol.for("react.context"),hD=Symbol.for("react.forward_ref"),IO=Symbol.for("react.suspense"),NO=Symbol.for("react.suspense_list"),pD=Symbol.for("react.memo"),_A=Symbol.for("react.lazy"),OO=Symbol.for("react.activity"),Ehe=Symbol.for("react.memo_cache_sentinel"),i5=Symbol.iterator;function og(r){return r===null||typeof r!="object"?null:(r=i5&&r[i5]||r["@@iterator"],typeof r=="function"?r:null)}var vhe=Symbol.for("react.client.reference");function xO(r){if(r==null)return null;if(typeof r=="function")return r.$$typeof===vhe?null:r.displayName||r.name||null;if(typeof r=="string")return r;switch(r){case kp:return"Fragment";case RO:return"Profiler";case e8:return"StrictMode";case IO:return"Suspense";case NO:return"SuspenseList";case OO:return"Activity"}if(typeof r=="object")switch(r.$$typeof){case wg:return"Portal";case fl:return r.displayName||"Context";case t8:return(r._context.displayName||"Context")+".Consumer";case hD:var s=r.render;return r=r.displayName,r||(r=s.displayName||s.name||"",r=r!==""?"ForwardRef("+r+")":"ForwardRef"),r;case pD:return s=r.displayName||null,s!==null?s:xO(r.type)||"Memo";case _A:s=r._payload,r=r._init;try{return xO(r(s))}catch{}}return null}var bg=Array.isArray,Gt=qK.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Qn=mhe.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,wu={pending:!1,data:null,method:null,action:null},DO=[],Lp=-1;function Uc(r){return{current:r}}function Ws(r){0>Lp||(r.current=DO[Lp],DO[Lp]=null,Lp--)}function vr(r,s){Lp++,DO[Lp]=r.current,r.current=s}var kc=Uc(null),r_=Uc(null),UA=Uc(null),aw=Uc(null);function ow(r,s){switch(vr(UA,s),vr(r_,r),vr(kc,null),s.nodeType){case 9:case 11:r=(r=s.documentElement)&&(r=r.namespaceURI)?d6(r):0;break;default:if(r=s.tagName,s=s.namespaceURI)s=d6(s),r=yY(s,r);else switch(r){case"svg":r=1;break;case"math":r=2;break;default:r=0}}Ws(kc),vr(kc,r)}function rf(){Ws(kc),Ws(r_),Ws(UA)}function BO(r){r.memoizedState!==null&&vr(aw,r);var s=kc.current,a=yY(s,r.type);s!==a&&(vr(r_,r),vr(kc,a))}function cw(r){r_.current===r&&(Ws(kc),Ws(r_)),aw.current===r&&(Ws(aw),p_._currentValue=wu)}var cN,a5;function lu(r){if(cN===void 0)try{throw Error()}catch(a){var s=a.stack.trim().match(/\n( *(at )?)/);cN=s&&s[1]||"",a5=-1<a.stack.indexOf(`
    at`)?" (<anonymous>)":-1<a.stack.indexOf("@")?"@unknown:0:0":""}return`
`+cN+r+a5}var lN=!1;function AN(r,s){if(!r||lN)return"";lN=!0;var a=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var c={DetermineComponentFrameRoot:function(){try{if(s){var N=function(){throw Error()};if(Object.defineProperty(N.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(N,[])}catch(k){var B=k}Reflect.construct(r,[],N)}else{try{N.call()}catch(k){B=k}r.call(N.prototype)}}else{try{throw Error()}catch(k){B=k}(N=r())&&typeof N.catch=="function"&&N.catch(function(){})}}catch(k){if(k&&B&&typeof k.stack=="string")return[k.stack,B.stack]}return[null,null]}};c.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var A=Object.getOwnPropertyDescriptor(c.DetermineComponentFrameRoot,"name");A&&A.configurable&&Object.defineProperty(c.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var u=c.DetermineComponentFrameRoot(),m=u[0],E=u[1];if(m&&E){var w=m.split(`
`),C=E.split(`
`);for(A=c=0;c<w.length&&!w[c].includes("DetermineComponentFrameRoot");)c++;for(;A<C.length&&!C[A].includes("DetermineComponentFrameRoot");)A++;if(c===w.length||A===C.length)for(c=w.length-1,A=C.length-1;1<=c&&0<=A&&w[c]!==C[A];)A--;for(;1<=c&&0<=A;c--,A--)if(w[c]!==C[A]){if(c!==1||A!==1)do if(c--,A--,0>A||w[c]!==C[A]){var T=`
`+w[c].replace(" at new "," at ");return r.displayName&&T.includes("<anonymous>")&&(T=T.replace("<anonymous>",r.displayName)),T}while(1<=c&&0<=A);break}}}finally{lN=!1,Error.prepareStackTrace=a}return(a=r?r.displayName||r.name:"")?lu(a):""}function yhe(r,s){switch(r.tag){case 26:case 27:case 5:return lu(r.type);case 16:return lu("Lazy");case 13:return r.child!==s&&s!==null?lu("Suspense Fallback"):lu("Suspense");case 19:return lu("SuspenseList");case 0:case 15:return AN(r.type,!1);case 11:return AN(r.type.render,!1);case 1:return AN(r.type,!0);case 31:return lu("Activity");default:return""}}function o5(r){try{var s="",a=null;do s+=yhe(r,a),a=r,r=r.return;while(r);return s}catch(c){return`
Error generating stack: `+c.message+`
`+c.stack}}var kO=Object.prototype.hasOwnProperty,fD=Ds.unstable_scheduleCallback,dN=Ds.unstable_cancelCallback,whe=Ds.unstable_shouldYield,bhe=Ds.unstable_requestPaint,xa=Ds.unstable_now,She=Ds.unstable_getCurrentPriorityLevel,n8=Ds.unstable_ImmediatePriority,r8=Ds.unstable_UserBlockingPriority,lw=Ds.unstable_NormalPriority,Che=Ds.unstable_LowPriority,s8=Ds.unstable_IdlePriority,The=Ds.log,Rhe=Ds.unstable_setDisableYieldValue,x_=null,Da=null;function TA(r){if(typeof The=="function"&&Rhe(r),Da&&typeof Da.setStrictMode=="function")try{Da.setStrictMode(x_,r)}catch{}}var Ba=Math.clz32?Math.clz32:Ohe,Ihe=Math.log,Nhe=Math.LN2;function Ohe(r){return r>>>=0,r===0?32:31-(Ihe(r)/Nhe|0)|0}var q0=256,X0=262144,J0=4194304;function Au(r){var s=r&42;if(s!==0)return s;switch(r&-r){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return r&261888;case 262144:case 524288:case 1048576:case 2097152:return r&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return r&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return r}}function ab(r,s,a){var c=r.pendingLanes;if(c===0)return 0;var A=0,u=r.suspendedLanes,m=r.pingedLanes;r=r.warmLanes;var E=c&134217727;return E!==0?(c=E&~u,c!==0?A=Au(c):(m&=E,m!==0?A=Au(m):a||(a=E&~r,a!==0&&(A=Au(a))))):(E=c&~u,E!==0?A=Au(E):m!==0?A=Au(m):a||(a=c&~r,a!==0&&(A=Au(a)))),A===0?0:s!==0&&s!==A&&!(s&u)&&(u=A&-A,a=s&-s,u>=a||u===32&&(a&4194048)!==0)?s:A}function D_(r,s){return(r.pendingLanes&~(r.suspendedLanes&~r.pingedLanes)&s)===0}function xhe(r,s){switch(r){case 1:case 2:case 4:case 8:case 64:return s+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return s+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function i8(){var r=J0;return J0<<=1,!(J0&62914560)&&(J0=4194304),r}function uN(r){for(var s=[],a=0;31>a;a++)s.push(r);return s}function B_(r,s){r.pendingLanes|=s,s!==268435456&&(r.suspendedLanes=0,r.pingedLanes=0,r.warmLanes=0)}function Dhe(r,s,a,c,A,u){var m=r.pendingLanes;r.pendingLanes=a,r.suspendedLanes=0,r.pingedLanes=0,r.warmLanes=0,r.expiredLanes&=a,r.entangledLanes&=a,r.errorRecoveryDisabledLanes&=a,r.shellSuspendCounter=0;var E=r.entanglements,w=r.expirationTimes,C=r.hiddenUpdates;for(a=m&~a;0<a;){var T=31-Ba(a),N=1<<T;E[T]=0,w[T]=-1;var B=C[T];if(B!==null)for(C[T]=null,T=0;T<B.length;T++){var k=B[T];k!==null&&(k.lane&=-536870913)}a&=~N}c!==0&&a8(r,c,0),u!==0&&A===0&&r.tag!==0&&(r.suspendedLanes|=u&~(m&~s))}function a8(r,s,a){r.pendingLanes|=s,r.suspendedLanes&=~s;var c=31-Ba(s);r.entangledLanes|=s,r.entanglements[c]=r.entanglements[c]|1073741824|a&261930}function o8(r,s){var a=r.entangledLanes|=s;for(r=r.entanglements;a;){var c=31-Ba(a),A=1<<c;A&s|r[c]&s&&(r[c]|=s),a&=~A}}function c8(r,s){var a=s&-s;return a=a&42?1:mD(a),a&(r.suspendedLanes|s)?0:a}function mD(r){switch(r){case 2:r=1;break;case 8:r=4;break;case 32:r=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:r=128;break;case 268435456:r=134217728;break;default:r=0}return r}function gD(r){return r&=-r,2<r?8<r?r&134217727?32:268435456:8:2}function l8(){var r=Qn.p;return r!==0?r:(r=window.event,r===void 0?32:DY(r.type))}function c5(r,s){var a=Qn.p;try{return Qn.p=r,s()}finally{Qn.p=a}}var $A=Math.random().toString(36).slice(2),ai="__reactFiber$"+$A,sa="__reactProps$"+$A,Ef="__reactContainer$"+$A,LO="__reactEvents$"+$A,Bhe="__reactListeners$"+$A,khe="__reactHandles$"+$A,l5="__reactResources$"+$A,k_="__reactMarker$"+$A;function _D(r){delete r[ai],delete r[sa],delete r[LO],delete r[Bhe],delete r[khe]}function Up(r){var s=r[ai];if(s)return s;for(var a=r.parentNode;a;){if(s=a[Ef]||a[ai]){if(a=s.alternate,s.child!==null||a!==null&&a.child!==null)for(r=m6(r);r!==null;){if(a=r[ai])return a;r=m6(r)}return s}r=a,a=r.parentNode}return null}function vf(r){if(r=r[ai]||r[Ef]){var s=r.tag;if(s===5||s===6||s===13||s===31||s===26||s===27||s===3)return r}return null}function Sg(r){var s=r.tag;if(s===5||s===26||s===27||s===6)return r.stateNode;throw Error(Me(33))}function Wp(r){var s=r[l5];return s||(s=r[l5]={hoistableStyles:new Map,hoistableScripts:new Map}),s}function Gs(r){r[k_]=!0}var A8=new Set,d8={};function Pu(r,s){sf(r,s),sf(r+"Capture",s)}function sf(r,s){for(d8[r]=s,r=0;r<s.length;r++)A8.add(s[r])}var Lhe=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),A5={},d5={};function Uhe(r){return kO.call(d5,r)?!0:kO.call(A5,r)?!1:Lhe.test(r)?d5[r]=!0:(A5[r]=!0,!1)}function Vy(r,s,a){if(Uhe(s))if(a===null)r.removeAttribute(s);else{switch(typeof a){case"undefined":case"function":case"symbol":r.removeAttribute(s);return;case"boolean":var c=s.toLowerCase().slice(0,5);if(c!=="data-"&&c!=="aria-"){r.removeAttribute(s);return}}r.setAttribute(s,""+a)}}function $0(r,s,a){if(a===null)r.removeAttribute(s);else{switch(typeof a){case"undefined":case"function":case"symbol":case"boolean":r.removeAttribute(s);return}r.setAttribute(s,""+a)}}function nl(r,s,a,c){if(c===null)r.removeAttribute(a);else{switch(typeof c){case"undefined":case"function":case"symbol":case"boolean":r.removeAttribute(a);return}r.setAttributeNS(s,a,""+c)}}function uo(r){switch(typeof r){case"bigint":case"boolean":case"number":case"string":case"undefined":return r;case"object":return r;default:return""}}function u8(r){var s=r.type;return(r=r.nodeName)&&r.toLowerCase()==="input"&&(s==="checkbox"||s==="radio")}function Phe(r,s,a){var c=Object.getOwnPropertyDescriptor(r.constructor.prototype,s);if(!r.hasOwnProperty(s)&&typeof c<"u"&&typeof c.get=="function"&&typeof c.set=="function"){var A=c.get,u=c.set;return Object.defineProperty(r,s,{configurable:!0,get:function(){return A.call(this)},set:function(m){a=""+m,u.call(this,m)}}),Object.defineProperty(r,s,{enumerable:c.enumerable}),{getValue:function(){return a},setValue:function(m){a=""+m},stopTracking:function(){r._valueTracker=null,delete r[s]}}}}function UO(r){if(!r._valueTracker){var s=u8(r)?"checked":"value";r._valueTracker=Phe(r,s,""+r[s])}}function h8(r){if(!r)return!1;var s=r._valueTracker;if(!s)return!0;var a=s.getValue(),c="";return r&&(c=u8(r)?r.checked?"true":"false":r.value),r=c,r!==a?(s.setValue(r),!0):!1}function Aw(r){if(r=r||(typeof document<"u"?document:void 0),typeof r>"u")return null;try{return r.activeElement||r.body}catch{return r.body}}var Mhe=/[\n"\\]/g;function mo(r){return r.replace(Mhe,function(s){return"\\"+s.charCodeAt(0).toString(16)+" "})}function PO(r,s,a,c,A,u,m,E){r.name="",m!=null&&typeof m!="function"&&typeof m!="symbol"&&typeof m!="boolean"?r.type=m:r.removeAttribute("type"),s!=null?m==="number"?(s===0&&r.value===""||r.value!=s)&&(r.value=""+uo(s)):r.value!==""+uo(s)&&(r.value=""+uo(s)):m!=="submit"&&m!=="reset"||r.removeAttribute("value"),s!=null?MO(r,m,uo(s)):a!=null?MO(r,m,uo(a)):c!=null&&r.removeAttribute("value"),A==null&&u!=null&&(r.defaultChecked=!!u),A!=null&&(r.checked=A&&typeof A!="function"&&typeof A!="symbol"),E!=null&&typeof E!="function"&&typeof E!="symbol"&&typeof E!="boolean"?r.name=""+uo(E):r.removeAttribute("name")}function p8(r,s,a,c,A,u,m,E){if(u!=null&&typeof u!="function"&&typeof u!="symbol"&&typeof u!="boolean"&&(r.type=u),s!=null||a!=null){if(!(u!=="submit"&&u!=="reset"||s!=null)){UO(r);return}a=a!=null?""+uo(a):"",s=s!=null?""+uo(s):a,E||s===r.value||(r.value=s),r.defaultValue=s}c=c??A,c=typeof c!="function"&&typeof c!="symbol"&&!!c,r.checked=E?r.checked:!!c,r.defaultChecked=!!c,m!=null&&typeof m!="function"&&typeof m!="symbol"&&typeof m!="boolean"&&(r.name=m),UO(r)}function MO(r,s,a){s==="number"&&Aw(r.ownerDocument)===r||r.defaultValue===""+a||(r.defaultValue=""+a)}function Yp(r,s,a,c){if(r=r.options,s){s={};for(var A=0;A<a.length;A++)s["$"+a[A]]=!0;for(a=0;a<r.length;a++)A=s.hasOwnProperty("$"+r[a].value),r[a].selected!==A&&(r[a].selected=A),A&&c&&(r[a].defaultSelected=!0)}else{for(a=""+uo(a),s=null,A=0;A<r.length;A++){if(r[A].value===a){r[A].selected=!0,c&&(r[A].defaultSelected=!0);return}s!==null||r[A].disabled||(s=r[A])}s!==null&&(s.selected=!0)}}function f8(r,s,a){if(s!=null&&(s=""+uo(s),s!==r.value&&(r.value=s),a==null)){r.defaultValue!==s&&(r.defaultValue=s);return}r.defaultValue=a!=null?""+uo(a):""}function m8(r,s,a,c){if(s==null){if(c!=null){if(a!=null)throw Error(Me(92));if(bg(c)){if(1<c.length)throw Error(Me(93));c=c[0]}a=c}a==null&&(a=""),s=a}a=uo(s),r.defaultValue=a,c=r.textContent,c===a&&c!==""&&c!==null&&(r.value=c),UO(r)}function af(r,s){if(s){var a=r.firstChild;if(a&&a===r.lastChild&&a.nodeType===3){a.nodeValue=s;return}}r.textContent=s}var Fhe=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function u5(r,s,a){var c=s.indexOf("--")===0;a==null||typeof a=="boolean"||a===""?c?r.setProperty(s,""):s==="float"?r.cssFloat="":r[s]="":c?r.setProperty(s,a):typeof a!="number"||a===0||Fhe.has(s)?s==="float"?r.cssFloat=a:r[s]=(""+a).trim():r[s]=a+"px"}function g8(r,s,a){if(s!=null&&typeof s!="object")throw Error(Me(62));if(r=r.style,a!=null){for(var c in a)!a.hasOwnProperty(c)||s!=null&&s.hasOwnProperty(c)||(c.indexOf("--")===0?r.setProperty(c,""):c==="float"?r.cssFloat="":r[c]="");for(var A in s)c=s[A],s.hasOwnProperty(A)&&a[A]!==c&&u5(r,A,c)}else for(var u in s)s.hasOwnProperty(u)&&u5(r,u,s[u])}function ED(r){if(r.indexOf("-")===-1)return!1;switch(r){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var jhe=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),Vhe=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Qy(r){return Vhe.test(""+r)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":r}function ml(){}var FO=null;function vD(r){return r=r.target||r.srcElement||window,r.correspondingUseElement&&(r=r.correspondingUseElement),r.nodeType===3?r.parentNode:r}var Pp=null,zp=null;function h5(r){var s=vf(r);if(s&&(r=s.stateNode)){var a=r[sa]||null;e:switch(r=s.stateNode,s.type){case"input":if(PO(r,a.value,a.defaultValue,a.defaultValue,a.checked,a.defaultChecked,a.type,a.name),s=a.name,a.type==="radio"&&s!=null){for(a=r;a.parentNode;)a=a.parentNode;for(a=a.querySelectorAll('input[name="'+mo(""+s)+'"][type="radio"]'),s=0;s<a.length;s++){var c=a[s];if(c!==r&&c.form===r.form){var A=c[sa]||null;if(!A)throw Error(Me(90));PO(c,A.value,A.defaultValue,A.defaultValue,A.checked,A.defaultChecked,A.type,A.name)}}for(s=0;s<a.length;s++)c=a[s],c.form===r.form&&h8(c)}break e;case"textarea":f8(r,a.value,a.defaultValue);break e;case"select":s=a.value,s!=null&&Yp(r,!!a.multiple,s,!1)}}}var hN=!1;function _8(r,s,a){if(hN)return r(s,a);hN=!0;try{var c=r(s);return c}finally{if(hN=!1,(Pp!==null||zp!==null)&&(_b(),Pp&&(s=Pp,r=zp,zp=Pp=null,h5(s),r)))for(s=0;s<r.length;s++)h5(r[s])}}function s_(r,s){var a=r.stateNode;if(a===null)return null;var c=a[sa]||null;if(c===null)return null;a=c[s];e:switch(s){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(c=!c.disabled)||(r=r.type,c=!(r==="button"||r==="input"||r==="select"||r==="textarea")),r=!c;break e;default:r=!1}if(r)return null;if(a&&typeof a!="function")throw Error(Me(231,s,typeof a));return a}var Sl=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),jO=!1;if(Sl)try{var cg={};Object.defineProperty(cg,"passive",{get:function(){jO=!0}}),window.addEventListener("test",cg,cg),window.removeEventListener("test",cg,cg)}catch{jO=!1}var RA=null,yD=null,Hy=null;function E8(){if(Hy)return Hy;var r,s=yD,a=s.length,c,A="value"in RA?RA.value:RA.textContent,u=A.length;for(r=0;r<a&&s[r]===A[r];r++);var m=a-r;for(c=1;c<=m&&s[a-c]===A[u-c];c++);return Hy=A.slice(r,1<c?1-c:void 0)}function Gy(r){var s=r.keyCode;return"charCode"in r?(r=r.charCode,r===0&&s===13&&(r=13)):r=s,r===10&&(r=13),32<=r||r===13?r:0}function Z0(){return!0}function p5(){return!1}function ia(r){function s(a,c,A,u,m){this._reactName=a,this._targetInst=A,this.type=c,this.nativeEvent=u,this.target=m,this.currentTarget=null;for(var E in r)r.hasOwnProperty(E)&&(a=r[E],this[E]=a?a(u):u[E]);return this.isDefaultPrevented=(u.defaultPrevented!=null?u.defaultPrevented:u.returnValue===!1)?Z0:p5,this.isPropagationStopped=p5,this}return Br(s.prototype,{preventDefault:function(){this.defaultPrevented=!0;var a=this.nativeEvent;a&&(a.preventDefault?a.preventDefault():typeof a.returnValue!="unknown"&&(a.returnValue=!1),this.isDefaultPrevented=Z0)},stopPropagation:function(){var a=this.nativeEvent;a&&(a.stopPropagation?a.stopPropagation():typeof a.cancelBubble!="unknown"&&(a.cancelBubble=!0),this.isPropagationStopped=Z0)},persist:function(){},isPersistent:Z0}),s}var Mu={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(r){return r.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},ob=ia(Mu),L_=Br({},Mu,{view:0,detail:0}),Qhe=ia(L_),pN,fN,lg,cb=Br({},L_,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:wD,button:0,buttons:0,relatedTarget:function(r){return r.relatedTarget===void 0?r.fromElement===r.srcElement?r.toElement:r.fromElement:r.relatedTarget},movementX:function(r){return"movementX"in r?r.movementX:(r!==lg&&(lg&&r.type==="mousemove"?(pN=r.screenX-lg.screenX,fN=r.screenY-lg.screenY):fN=pN=0,lg=r),pN)},movementY:function(r){return"movementY"in r?r.movementY:fN}}),f5=ia(cb),Hhe=Br({},cb,{dataTransfer:0}),Ghe=ia(Hhe),Khe=Br({},L_,{relatedTarget:0}),mN=ia(Khe),Whe=Br({},Mu,{animationName:0,elapsedTime:0,pseudoElement:0}),Yhe=ia(Whe),zhe=Br({},Mu,{clipboardData:function(r){return"clipboardData"in r?r.clipboardData:window.clipboardData}}),qhe=ia(zhe),Xhe=Br({},Mu,{data:0}),m5=ia(Xhe),Jhe={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},$he={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Zhe={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function epe(r){var s=this.nativeEvent;return s.getModifierState?s.getModifierState(r):(r=Zhe[r])?!!s[r]:!1}function wD(){return epe}var tpe=Br({},L_,{key:function(r){if(r.key){var s=Jhe[r.key]||r.key;if(s!=="Unidentified")return s}return r.type==="keypress"?(r=Gy(r),r===13?"Enter":String.fromCharCode(r)):r.type==="keydown"||r.type==="keyup"?$he[r.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:wD,charCode:function(r){return r.type==="keypress"?Gy(r):0},keyCode:function(r){return r.type==="keydown"||r.type==="keyup"?r.keyCode:0},which:function(r){return r.type==="keypress"?Gy(r):r.type==="keydown"||r.type==="keyup"?r.keyCode:0}}),npe=ia(tpe),rpe=Br({},cb,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),g5=ia(rpe),spe=Br({},L_,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:wD}),ipe=ia(spe),ape=Br({},Mu,{propertyName:0,elapsedTime:0,pseudoElement:0}),ope=ia(ape),cpe=Br({},cb,{deltaX:function(r){return"deltaX"in r?r.deltaX:"wheelDeltaX"in r?-r.wheelDeltaX:0},deltaY:function(r){return"deltaY"in r?r.deltaY:"wheelDeltaY"in r?-r.wheelDeltaY:"wheelDelta"in r?-r.wheelDelta:0},deltaZ:0,deltaMode:0}),lpe=ia(cpe),Ape=Br({},Mu,{newState:0,oldState:0}),dpe=ia(Ape),upe=[9,13,27,32],bD=Sl&&"CompositionEvent"in window,Pg=null;Sl&&"documentMode"in document&&(Pg=document.documentMode);var hpe=Sl&&"TextEvent"in window&&!Pg,v8=Sl&&(!bD||Pg&&8<Pg&&11>=Pg),_5=" ",E5=!1;function y8(r,s){switch(r){case"keyup":return upe.indexOf(s.keyCode)!==-1;case"keydown":return s.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function w8(r){return r=r.detail,typeof r=="object"&&"data"in r?r.data:null}var Mp=!1;function ppe(r,s){switch(r){case"compositionend":return w8(s);case"keypress":return s.which!==32?null:(E5=!0,_5);case"textInput":return r=s.data,r===_5&&E5?null:r;default:return null}}function fpe(r,s){if(Mp)return r==="compositionend"||!bD&&y8(r,s)?(r=E8(),Hy=yD=RA=null,Mp=!1,r):null;switch(r){case"paste":return null;case"keypress":if(!(s.ctrlKey||s.altKey||s.metaKey)||s.ctrlKey&&s.altKey){if(s.char&&1<s.char.length)return s.char;if(s.which)return String.fromCharCode(s.which)}return null;case"compositionend":return v8&&s.locale!=="ko"?null:s.data;default:return null}}var mpe={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function v5(r){var s=r&&r.nodeName&&r.nodeName.toLowerCase();return s==="input"?!!mpe[r.type]:s==="textarea"}function b8(r,s,a,c){Pp?zp?zp.push(c):zp=[c]:Pp=c,s=Iw(s,"onChange"),0<s.length&&(a=new ob("onChange","change",null,a,c),r.push({event:a,listeners:s}))}var Mg=null,i_=null;function gpe(r){_Y(r,0)}function lb(r){var s=Sg(r);if(h8(s))return r}function y5(r,s){if(r==="change")return s}var S8=!1;if(Sl){var gN;if(Sl){var _N="oninput"in document;if(!_N){var w5=document.createElement("div");w5.setAttribute("oninput","return;"),_N=typeof w5.oninput=="function"}gN=_N}else gN=!1;S8=gN&&(!document.documentMode||9<document.documentMode)}function b5(){Mg&&(Mg.detachEvent("onpropertychange",C8),i_=Mg=null)}function C8(r){if(r.propertyName==="value"&&lb(i_)){var s=[];b8(s,i_,r,vD(r)),_8(gpe,s)}}function _pe(r,s,a){r==="focusin"?(b5(),Mg=s,i_=a,Mg.attachEvent("onpropertychange",C8)):r==="focusout"&&b5()}function Epe(r){if(r==="selectionchange"||r==="keyup"||r==="keydown")return lb(i_)}function vpe(r,s){if(r==="click")return lb(s)}function ype(r,s){if(r==="input"||r==="change")return lb(s)}function wpe(r,s){return r===s&&(r!==0||1/r===1/s)||r!==r&&s!==s}var La=typeof Object.is=="function"?Object.is:wpe;function a_(r,s){if(La(r,s))return!0;if(typeof r!="object"||r===null||typeof s!="object"||s===null)return!1;var a=Object.keys(r),c=Object.keys(s);if(a.length!==c.length)return!1;for(c=0;c<a.length;c++){var A=a[c];if(!kO.call(s,A)||!La(r[A],s[A]))return!1}return!0}function S5(r){for(;r&&r.firstChild;)r=r.firstChild;return r}function C5(r,s){var a=S5(r);r=0;for(var c;a;){if(a.nodeType===3){if(c=r+a.textContent.length,r<=s&&c>=s)return{node:a,offset:s-r};r=c}e:{for(;a;){if(a.nextSibling){a=a.nextSibling;break e}a=a.parentNode}a=void 0}a=S5(a)}}function T8(r,s){return r&&s?r===s?!0:r&&r.nodeType===3?!1:s&&s.nodeType===3?T8(r,s.parentNode):"contains"in r?r.contains(s):r.compareDocumentPosition?!!(r.compareDocumentPosition(s)&16):!1:!1}function R8(r){r=r!=null&&r.ownerDocument!=null&&r.ownerDocument.defaultView!=null?r.ownerDocument.defaultView:window;for(var s=Aw(r.document);s instanceof r.HTMLIFrameElement;){try{var a=typeof s.contentWindow.location.href=="string"}catch{a=!1}if(a)r=s.contentWindow;else break;s=Aw(r.document)}return s}function SD(r){var s=r&&r.nodeName&&r.nodeName.toLowerCase();return s&&(s==="input"&&(r.type==="text"||r.type==="search"||r.type==="tel"||r.type==="url"||r.type==="password")||s==="textarea"||r.contentEditable==="true")}var bpe=Sl&&"documentMode"in document&&11>=document.documentMode,Fp=null,VO=null,Fg=null,QO=!1;function T5(r,s,a){var c=a.window===a?a.document:a.nodeType===9?a:a.ownerDocument;QO||Fp==null||Fp!==Aw(c)||(c=Fp,"selectionStart"in c&&SD(c)?c={start:c.selectionStart,end:c.selectionEnd}:(c=(c.ownerDocument&&c.ownerDocument.defaultView||window).getSelection(),c={anchorNode:c.anchorNode,anchorOffset:c.anchorOffset,focusNode:c.focusNode,focusOffset:c.focusOffset}),Fg&&a_(Fg,c)||(Fg=c,c=Iw(VO,"onSelect"),0<c.length&&(s=new ob("onSelect","select",null,s,a),r.push({event:s,listeners:c}),s.target=Fp)))}function tu(r,s){var a={};return a[r.toLowerCase()]=s.toLowerCase(),a["Webkit"+r]="webkit"+s,a["Moz"+r]="moz"+s,a}var jp={animationend:tu("Animation","AnimationEnd"),animationiteration:tu("Animation","AnimationIteration"),animationstart:tu("Animation","AnimationStart"),transitionrun:tu("Transition","TransitionRun"),transitionstart:tu("Transition","TransitionStart"),transitioncancel:tu("Transition","TransitionCancel"),transitionend:tu("Transition","TransitionEnd")},EN={},I8={};Sl&&(I8=document.createElement("div").style,"AnimationEvent"in window||(delete jp.animationend.animation,delete jp.animationiteration.animation,delete jp.animationstart.animation),"TransitionEvent"in window||delete jp.transitionend.transition);function Fu(r){if(EN[r])return EN[r];if(!jp[r])return r;var s=jp[r],a;for(a in s)if(s.hasOwnProperty(a)&&a in I8)return EN[r]=s[a];return r}var N8=Fu("animationend"),O8=Fu("animationiteration"),x8=Fu("animationstart"),Spe=Fu("transitionrun"),Cpe=Fu("transitionstart"),Tpe=Fu("transitioncancel"),D8=Fu("transitionend"),B8=new Map,HO="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");HO.push("scrollEnd");function tc(r,s){B8.set(r,s),Pu(s,[r])}var dw=typeof reportError=="function"?reportError:function(r){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var s=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof r=="object"&&r!==null&&typeof r.message=="string"?String(r.message):String(r),error:r});if(!window.dispatchEvent(s))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",r);return}console.error(r)},Ao=[],Vp=0,CD=0;function Ab(){for(var r=Vp,s=CD=Vp=0;s<r;){var a=Ao[s];Ao[s++]=null;var c=Ao[s];Ao[s++]=null;var A=Ao[s];Ao[s++]=null;var u=Ao[s];if(Ao[s++]=null,c!==null&&A!==null){var m=c.pending;m===null?A.next=A:(A.next=m.next,m.next=A),c.pending=A}u!==0&&k8(a,A,u)}}function db(r,s,a,c){Ao[Vp++]=r,Ao[Vp++]=s,Ao[Vp++]=a,Ao[Vp++]=c,CD|=c,r.lanes|=c,r=r.alternate,r!==null&&(r.lanes|=c)}function TD(r,s,a,c){return db(r,s,a,c),uw(r)}function ju(r,s){return db(r,null,null,s),uw(r)}function k8(r,s,a){r.lanes|=a;var c=r.alternate;c!==null&&(c.lanes|=a);for(var A=!1,u=r.return;u!==null;)u.childLanes|=a,c=u.alternate,c!==null&&(c.childLanes|=a),u.tag===22&&(r=u.stateNode,r===null||r._visibility&1||(A=!0)),r=u,u=u.return;return r.tag===3?(u=r.stateNode,A&&s!==null&&(A=31-Ba(a),r=u.hiddenUpdates,c=r[A],c===null?r[A]=[s]:c.push(s),s.lane=a|536870912),u):null}function uw(r){if(50<zg)throw zg=0,Ax=null,Error(Me(185));for(var s=r.return;s!==null;)r=s,s=r.return;return r.tag===3?r.stateNode:null}var Qp={};function Rpe(r,s,a,c){this.tag=r,this.key=a,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=s,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=c,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Ra(r,s,a,c){return new Rpe(r,s,a,c)}function RD(r){return r=r.prototype,!(!r||!r.isReactComponent)}function El(r,s){var a=r.alternate;return a===null?(a=Ra(r.tag,s,r.key,r.mode),a.elementType=r.elementType,a.type=r.type,a.stateNode=r.stateNode,a.alternate=r,r.alternate=a):(a.pendingProps=s,a.type=r.type,a.flags=0,a.subtreeFlags=0,a.deletions=null),a.flags=r.flags&65011712,a.childLanes=r.childLanes,a.lanes=r.lanes,a.child=r.child,a.memoizedProps=r.memoizedProps,a.memoizedState=r.memoizedState,a.updateQueue=r.updateQueue,s=r.dependencies,a.dependencies=s===null?null:{lanes:s.lanes,firstContext:s.firstContext},a.sibling=r.sibling,a.index=r.index,a.ref=r.ref,a.refCleanup=r.refCleanup,a}function L8(r,s){r.flags&=65011714;var a=r.alternate;return a===null?(r.childLanes=0,r.lanes=s,r.child=null,r.subtreeFlags=0,r.memoizedProps=null,r.memoizedState=null,r.updateQueue=null,r.dependencies=null,r.stateNode=null):(r.childLanes=a.childLanes,r.lanes=a.lanes,r.child=a.child,r.subtreeFlags=0,r.deletions=null,r.memoizedProps=a.memoizedProps,r.memoizedState=a.memoizedState,r.updateQueue=a.updateQueue,r.type=a.type,s=a.dependencies,r.dependencies=s===null?null:{lanes:s.lanes,firstContext:s.firstContext}),r}function Ky(r,s,a,c,A,u){var m=0;if(c=r,typeof r=="function")RD(r)&&(m=1);else if(typeof r=="string")m=Dfe(r,a,kc.current)?26:r==="html"||r==="head"||r==="body"?27:5;else e:switch(r){case OO:return r=Ra(31,a,s,A),r.elementType=OO,r.lanes=u,r;case kp:return bu(a.children,A,u,s);case e8:m=8,A|=24;break;case RO:return r=Ra(12,a,s,A|2),r.elementType=RO,r.lanes=u,r;case IO:return r=Ra(13,a,s,A),r.elementType=IO,r.lanes=u,r;case NO:return r=Ra(19,a,s,A),r.elementType=NO,r.lanes=u,r;default:if(typeof r=="object"&&r!==null)switch(r.$$typeof){case fl:m=10;break e;case t8:m=9;break e;case hD:m=11;break e;case pD:m=14;break e;case _A:m=16,c=null;break e}m=29,a=Error(Me(130,r===null?"null":typeof r,"")),c=null}return s=Ra(m,a,s,A),s.elementType=r,s.type=c,s.lanes=u,s}function bu(r,s,a,c){return r=Ra(7,r,c,s),r.lanes=a,r}function vN(r,s,a){return r=Ra(6,r,null,s),r.lanes=a,r}function U8(r){var s=Ra(18,null,null,0);return s.stateNode=r,s}function yN(r,s,a){return s=Ra(4,r.children!==null?r.children:[],r.key,s),s.lanes=a,s.stateNode={containerInfo:r.containerInfo,pendingChildren:null,implementation:r.implementation},s}var R5=new WeakMap;function go(r,s){if(typeof r=="object"&&r!==null){var a=R5.get(r);return a!==void 0?a:(s={value:r,source:s,stack:o5(s)},R5.set(r,s),s)}return{value:r,source:s,stack:o5(s)}}var Hp=[],Gp=0,hw=null,o_=0,ho=[],po=0,WA=null,xc=1,Dc="";function ul(r,s){Hp[Gp++]=o_,Hp[Gp++]=hw,hw=r,o_=s}function P8(r,s,a){ho[po++]=xc,ho[po++]=Dc,ho[po++]=WA,WA=r;var c=xc;r=Dc;var A=32-Ba(c)-1;c&=~(1<<A),a+=1;var u=32-Ba(s)+A;if(30<u){var m=A-A%5;u=(c&(1<<m)-1).toString(32),c>>=m,A-=m,xc=1<<32-Ba(s)+A|a<<A|c,Dc=u+r}else xc=1<<u|a<<A|c,Dc=r}function ID(r){r.return!==null&&(ul(r,1),P8(r,1,0))}function ND(r){for(;r===hw;)hw=Hp[--Gp],Hp[Gp]=null,o_=Hp[--Gp],Hp[Gp]=null;for(;r===WA;)WA=ho[--po],ho[po]=null,Dc=ho[--po],ho[po]=null,xc=ho[--po],ho[po]=null}function M8(r,s){ho[po++]=xc,ho[po++]=Dc,ho[po++]=WA,xc=s.id,Dc=s.overflow,WA=r}var oi=null,xr=null,Dn=!1,PA=null,_o=!1,GO=Error(Me(519));function YA(r){var s=Error(Me(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw c_(go(s,r)),GO}function I5(r){var s=r.stateNode,a=r.type,c=r.memoizedProps;switch(s[ai]=r,s[sa]=c,a){case"dialog":Sn("cancel",s),Sn("close",s);break;case"iframe":case"object":case"embed":Sn("load",s);break;case"video":case"audio":for(a=0;a<u_.length;a++)Sn(u_[a],s);break;case"source":Sn("error",s);break;case"img":case"image":case"link":Sn("error",s),Sn("load",s);break;case"details":Sn("toggle",s);break;case"input":Sn("invalid",s),p8(s,c.value,c.defaultValue,c.checked,c.defaultChecked,c.type,c.name,!0);break;case"select":Sn("invalid",s);break;case"textarea":Sn("invalid",s),m8(s,c.value,c.defaultValue,c.children)}a=c.children,typeof a!="string"&&typeof a!="number"&&typeof a!="bigint"||s.textContent===""+a||c.suppressHydrationWarning===!0||vY(s.textContent,a)?(c.popover!=null&&(Sn("beforetoggle",s),Sn("toggle",s)),c.onScroll!=null&&Sn("scroll",s),c.onScrollEnd!=null&&Sn("scrollend",s),c.onClick!=null&&(s.onclick=ml),s=!0):s=!1,s||YA(r,!0)}function N5(r){for(oi=r.return;oi;)switch(oi.tag){case 5:case 31:case 13:_o=!1;return;case 27:case 3:_o=!0;return;default:oi=oi.return}}function dp(r){if(r!==oi)return!1;if(!Dn)return N5(r),Dn=!0,!1;var s=r.tag,a;if((a=s!==3&&s!==27)&&((a=s===5)&&(a=r.type,a=!(a!=="form"&&a!=="button")||fx(r.type,r.memoizedProps)),a=!a),a&&xr&&YA(r),N5(r),s===13){if(r=r.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(Me(317));xr=f6(r)}else if(s===31){if(r=r.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(Me(317));xr=f6(r)}else s===27?(s=xr,ZA(r.type)?(r=Ex,Ex=null,xr=r):xr=s):xr=oi?wo(r.stateNode.nextSibling):null;return!0}function Ou(){xr=oi=null,Dn=!1}function wN(){var r=PA;return r!==null&&(ta===null?ta=r:ta.push.apply(ta,r),PA=null),r}function c_(r){PA===null?PA=[r]:PA.push(r)}var KO=Uc(null),Vu=null,gl=null;function yA(r,s,a){vr(KO,s._currentValue),s._currentValue=a}function vl(r){r._currentValue=KO.current,Ws(KO)}function WO(r,s,a){for(;r!==null;){var c=r.alternate;if((r.childLanes&s)!==s?(r.childLanes|=s,c!==null&&(c.childLanes|=s)):c!==null&&(c.childLanes&s)!==s&&(c.childLanes|=s),r===a)break;r=r.return}}function YO(r,s,a,c){var A=r.child;for(A!==null&&(A.return=r);A!==null;){var u=A.dependencies;if(u!==null){var m=A.child;u=u.firstContext;e:for(;u!==null;){var E=u;u=A;for(var w=0;w<s.length;w++)if(E.context===s[w]){u.lanes|=a,E=u.alternate,E!==null&&(E.lanes|=a),WO(u.return,a,r),c||(m=null);break e}u=E.next}}else if(A.tag===18){if(m=A.return,m===null)throw Error(Me(341));m.lanes|=a,u=m.alternate,u!==null&&(u.lanes|=a),WO(m,a,r),m=null}else m=A.child;if(m!==null)m.return=A;else for(m=A;m!==null;){if(m===r){m=null;break}if(A=m.sibling,A!==null){A.return=m.return,m=A;break}m=m.return}A=m}}function yf(r,s,a,c){r=null;for(var A=s,u=!1;A!==null;){if(!u){if(A.flags&524288)u=!0;else if(A.flags&262144)break}if(A.tag===10){var m=A.alternate;if(m===null)throw Error(Me(387));if(m=m.memoizedProps,m!==null){var E=A.type;La(A.pendingProps.value,m.value)||(r!==null?r.push(E):r=[E])}}else if(A===aw.current){if(m=A.alternate,m===null)throw Error(Me(387));m.memoizedState.memoizedState!==A.memoizedState.memoizedState&&(r!==null?r.push(p_):r=[p_])}A=A.return}r!==null&&YO(s,r,a,c),s.flags|=262144}function pw(r){for(r=r.firstContext;r!==null;){if(!La(r.context._currentValue,r.memoizedValue))return!0;r=r.next}return!1}function xu(r){Vu=r,gl=null,r=r.dependencies,r!==null&&(r.firstContext=null)}function ci(r){return F8(Vu,r)}function ey(r,s){return Vu===null&&xu(r),F8(r,s)}function F8(r,s){var a=s._currentValue;if(s={context:s,memoizedValue:a,next:null},gl===null){if(r===null)throw Error(Me(308));gl=s,r.dependencies={lanes:0,firstContext:s},r.flags|=524288}else gl=gl.next=s;return a}var Ipe=typeof AbortController<"u"?AbortController:function(){var r=[],s=this.signal={aborted:!1,addEventListener:function(a,c){r.push(c)}};this.abort=function(){s.aborted=!0,r.forEach(function(a){return a()})}},Npe=Ds.unstable_scheduleCallback,Ope=Ds.unstable_NormalPriority,ys={$$typeof:fl,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function OD(){return{controller:new Ipe,data:new Map,refCount:0}}function U_(r){r.refCount--,r.refCount===0&&Npe(Ope,function(){r.controller.abort()})}var jg=null,zO=0,of=0,qp=null;function xpe(r,s){if(jg===null){var a=jg=[];zO=0,of=tB(),qp={status:"pending",value:void 0,then:function(c){a.push(c)}}}return zO++,s.then(O5,O5),s}function O5(){if(--zO===0&&jg!==null){qp!==null&&(qp.status="fulfilled");var r=jg;jg=null,of=0,qp=null;for(var s=0;s<r.length;s++)(0,r[s])()}}function Dpe(r,s){var a=[],c={status:"pending",value:null,reason:null,then:function(A){a.push(A)}};return r.then(function(){c.status="fulfilled",c.value=s;for(var A=0;A<a.length;A++)(0,a[A])(s)},function(A){for(c.status="rejected",c.reason=A,A=0;A<a.length;A++)(0,a[A])(void 0)}),c}var x5=Gt.S;Gt.S=function(r,s){ZW=xa(),typeof s=="object"&&s!==null&&typeof s.then=="function"&&xpe(r,s),x5!==null&&x5(r,s)};var Su=Uc(null);function xD(){var r=Su.current;return r!==null?r:mr.pooledCache}function Wy(r,s){s===null?vr(Su,Su.current):vr(Su,s.pool)}function j8(){var r=xD();return r===null?null:{parent:ys._currentValue,pool:r}}var wf=Error(Me(460)),DD=Error(Me(474)),ub=Error(Me(542)),fw={then:function(){}};function D5(r){return r=r.status,r==="fulfilled"||r==="rejected"}function V8(r,s,a){switch(a=r[a],a===void 0?r.push(s):a!==s&&(s.then(ml,ml),s=a),s.status){case"fulfilled":return s.value;case"rejected":throw r=s.reason,k5(r),r;default:if(typeof s.status=="string")s.then(ml,ml);else{if(r=mr,r!==null&&100<r.shellSuspendCounter)throw Error(Me(482));r=s,r.status="pending",r.then(function(c){if(s.status==="pending"){var A=s;A.status="fulfilled",A.value=c}},function(c){if(s.status==="pending"){var A=s;A.status="rejected",A.reason=c}})}switch(s.status){case"fulfilled":return s.value;case"rejected":throw r=s.reason,k5(r),r}throw Cu=s,wf}}function du(r){try{var s=r._init;return s(r._payload)}catch(a){throw a!==null&&typeof a=="object"&&typeof a.then=="function"?(Cu=a,wf):a}}var Cu=null;function B5(){if(Cu===null)throw Error(Me(459));var r=Cu;return Cu=null,r}function k5(r){if(r===wf||r===ub)throw Error(Me(483))}var Xp=null,l_=0;function ty(r){var s=l_;return l_+=1,Xp===null&&(Xp=[]),V8(Xp,r,s)}function Ag(r,s){s=s.props.ref,r.ref=s!==void 0?s:null}function ny(r,s){throw s.$$typeof===_he?Error(Me(525)):(r=Object.prototype.toString.call(s),Error(Me(31,r==="[object Object]"?"object with keys {"+Object.keys(s).join(", ")+"}":r)))}function Q8(r){function s(F,M){if(r){var V=F.deletions;V===null?(F.deletions=[M],F.flags|=16):V.push(M)}}function a(F,M){if(!r)return null;for(;M!==null;)s(F,M),M=M.sibling;return null}function c(F){for(var M=new Map;F!==null;)F.key!==null?M.set(F.key,F):M.set(F.index,F),F=F.sibling;return M}function A(F,M){return F=El(F,M),F.index=0,F.sibling=null,F}function u(F,M,V){return F.index=V,r?(V=F.alternate,V!==null?(V=V.index,V<M?(F.flags|=67108866,M):V):(F.flags|=67108866,M)):(F.flags|=1048576,M)}function m(F){return r&&F.alternate===null&&(F.flags|=67108866),F}function E(F,M,V,W){return M===null||M.tag!==6?(M=vN(V,F.mode,W),M.return=F,M):(M=A(M,V),M.return=F,M)}function w(F,M,V,W){var q=V.type;return q===kp?T(F,M,V.props.children,W,V.key):M!==null&&(M.elementType===q||typeof q=="object"&&q!==null&&q.$$typeof===_A&&du(q)===M.type)?(M=A(M,V.props),Ag(M,V),M.return=F,M):(M=Ky(V.type,V.key,V.props,null,F.mode,W),Ag(M,V),M.return=F,M)}function C(F,M,V,W){return M===null||M.tag!==4||M.stateNode.containerInfo!==V.containerInfo||M.stateNode.implementation!==V.implementation?(M=yN(V,F.mode,W),M.return=F,M):(M=A(M,V.children||[]),M.return=F,M)}function T(F,M,V,W,q){return M===null||M.tag!==7?(M=bu(V,F.mode,W,q),M.return=F,M):(M=A(M,V),M.return=F,M)}function N(F,M,V){if(typeof M=="string"&&M!==""||typeof M=="number"||typeof M=="bigint")return M=vN(""+M,F.mode,V),M.return=F,M;if(typeof M=="object"&&M!==null){switch(M.$$typeof){case z0:return V=Ky(M.type,M.key,M.props,null,F.mode,V),Ag(V,M),V.return=F,V;case wg:return M=yN(M,F.mode,V),M.return=F,M;case _A:return M=du(M),N(F,M,V)}if(bg(M)||og(M))return M=bu(M,F.mode,V,null),M.return=F,M;if(typeof M.then=="function")return N(F,ty(M),V);if(M.$$typeof===fl)return N(F,ey(F,M),V);ny(F,M)}return null}function B(F,M,V,W){var q=M!==null?M.key:null;if(typeof V=="string"&&V!==""||typeof V=="number"||typeof V=="bigint")return q!==null?null:E(F,M,""+V,W);if(typeof V=="object"&&V!==null){switch(V.$$typeof){case z0:return V.key===q?w(F,M,V,W):null;case wg:return V.key===q?C(F,M,V,W):null;case _A:return V=du(V),B(F,M,V,W)}if(bg(V)||og(V))return q!==null?null:T(F,M,V,W,null);if(typeof V.then=="function")return B(F,M,ty(V),W);if(V.$$typeof===fl)return B(F,M,ey(F,V),W);ny(F,V)}return null}function k(F,M,V,W,q){if(typeof W=="string"&&W!==""||typeof W=="number"||typeof W=="bigint")return F=F.get(V)||null,E(M,F,""+W,q);if(typeof W=="object"&&W!==null){switch(W.$$typeof){case z0:return F=F.get(W.key===null?V:W.key)||null,w(M,F,W,q);case wg:return F=F.get(W.key===null?V:W.key)||null,C(M,F,W,q);case _A:return W=du(W),k(F,M,V,W,q)}if(bg(W)||og(W))return F=F.get(V)||null,T(M,F,W,q,null);if(typeof W.then=="function")return k(F,M,V,ty(W),q);if(W.$$typeof===fl)return k(F,M,V,ey(M,W),q);ny(M,W)}return null}function Q(F,M,V,W){for(var q=null,te=null,re=M,de=M=0,ce=null;re!==null&&de<V.length;de++){re.index>de?(ce=re,re=null):ce=re.sibling;var Ae=B(F,re,V[de],W);if(Ae===null){re===null&&(re=ce);break}r&&re&&Ae.alternate===null&&s(F,re),M=u(Ae,M,de),te===null?q=Ae:te.sibling=Ae,te=Ae,re=ce}if(de===V.length)return a(F,re),Dn&&ul(F,de),q;if(re===null){for(;de<V.length;de++)re=N(F,V[de],W),re!==null&&(M=u(re,M,de),te===null?q=re:te.sibling=re,te=re);return Dn&&ul(F,de),q}for(re=c(re);de<V.length;de++)ce=k(re,F,de,V[de],W),ce!==null&&(r&&ce.alternate!==null&&re.delete(ce.key===null?de:ce.key),M=u(ce,M,de),te===null?q=ce:te.sibling=ce,te=ce);return r&&re.forEach(function(ne){return s(F,ne)}),Dn&&ul(F,de),q}function K(F,M,V,W){if(V==null)throw Error(Me(151));for(var q=null,te=null,re=M,de=M=0,ce=null,Ae=V.next();re!==null&&!Ae.done;de++,Ae=V.next()){re.index>de?(ce=re,re=null):ce=re.sibling;var ne=B(F,re,Ae.value,W);if(ne===null){re===null&&(re=ce);break}r&&re&&ne.alternate===null&&s(F,re),M=u(ne,M,de),te===null?q=ne:te.sibling=ne,te=ne,re=ce}if(Ae.done)return a(F,re),Dn&&ul(F,de),q;if(re===null){for(;!Ae.done;de++,Ae=V.next())Ae=N(F,Ae.value,W),Ae!==null&&(M=u(Ae,M,de),te===null?q=Ae:te.sibling=Ae,te=Ae);return Dn&&ul(F,de),q}for(re=c(re);!Ae.done;de++,Ae=V.next())Ae=k(re,F,de,Ae.value,W),Ae!==null&&(r&&Ae.alternate!==null&&re.delete(Ae.key===null?de:Ae.key),M=u(Ae,M,de),te===null?q=Ae:te.sibling=Ae,te=Ae);return r&&re.forEach(function(ue){return s(F,ue)}),Dn&&ul(F,de),q}function Y(F,M,V,W){if(typeof V=="object"&&V!==null&&V.type===kp&&V.key===null&&(V=V.props.children),typeof V=="object"&&V!==null){switch(V.$$typeof){case z0:e:{for(var q=V.key;M!==null;){if(M.key===q){if(q=V.type,q===kp){if(M.tag===7){a(F,M.sibling),W=A(M,V.props.children),W.return=F,F=W;break e}}else if(M.elementType===q||typeof q=="object"&&q!==null&&q.$$typeof===_A&&du(q)===M.type){a(F,M.sibling),W=A(M,V.props),Ag(W,V),W.return=F,F=W;break e}a(F,M);break}else s(F,M);M=M.sibling}V.type===kp?(W=bu(V.props.children,F.mode,W,V.key),W.return=F,F=W):(W=Ky(V.type,V.key,V.props,null,F.mode,W),Ag(W,V),W.return=F,F=W)}return m(F);case wg:e:{for(q=V.key;M!==null;){if(M.key===q)if(M.tag===4&&M.stateNode.containerInfo===V.containerInfo&&M.stateNode.implementation===V.implementation){a(F,M.sibling),W=A(M,V.children||[]),W.return=F,F=W;break e}else{a(F,M);break}else s(F,M);M=M.sibling}W=yN(V,F.mode,W),W.return=F,F=W}return m(F);case _A:return V=du(V),Y(F,M,V,W)}if(bg(V))return Q(F,M,V,W);if(og(V)){if(q=og(V),typeof q!="function")throw Error(Me(150));return V=q.call(V),K(F,M,V,W)}if(typeof V.then=="function")return Y(F,M,ty(V),W);if(V.$$typeof===fl)return Y(F,M,ey(F,V),W);ny(F,V)}return typeof V=="string"&&V!==""||typeof V=="number"||typeof V=="bigint"?(V=""+V,M!==null&&M.tag===6?(a(F,M.sibling),W=A(M,V),W.return=F,F=W):(a(F,M),W=vN(V,F.mode,W),W.return=F,F=W),m(F)):a(F,M)}return function(F,M,V,W){try{l_=0;var q=Y(F,M,V,W);return Xp=null,q}catch(re){if(re===wf||re===ub)throw re;var te=Ra(29,re,null,F.mode);return te.lanes=W,te.return=F,te}finally{}}}var Du=Q8(!0),H8=Q8(!1),EA=!1;function BD(r){r.updateQueue={baseState:r.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function qO(r,s){r=r.updateQueue,s.updateQueue===r&&(s.updateQueue={baseState:r.baseState,firstBaseUpdate:r.firstBaseUpdate,lastBaseUpdate:r.lastBaseUpdate,shared:r.shared,callbacks:null})}function MA(r){return{lane:r,tag:0,payload:null,callback:null,next:null}}function FA(r,s,a){var c=r.updateQueue;if(c===null)return null;if(c=c.shared,Vn&2){var A=c.pending;return A===null?s.next=s:(s.next=A.next,A.next=s),c.pending=s,s=uw(r),k8(r,null,a),s}return db(r,c,s,a),uw(r)}function Vg(r,s,a){if(s=s.updateQueue,s!==null&&(s=s.shared,(a&4194048)!==0)){var c=s.lanes;c&=r.pendingLanes,a|=c,s.lanes=a,o8(r,a)}}function bN(r,s){var a=r.updateQueue,c=r.alternate;if(c!==null&&(c=c.updateQueue,a===c)){var A=null,u=null;if(a=a.firstBaseUpdate,a!==null){do{var m={lane:a.lane,tag:a.tag,payload:a.payload,callback:null,next:null};u===null?A=u=m:u=u.next=m,a=a.next}while(a!==null);u===null?A=u=s:u=u.next=s}else A=u=s;a={baseState:c.baseState,firstBaseUpdate:A,lastBaseUpdate:u,shared:c.shared,callbacks:c.callbacks},r.updateQueue=a;return}r=a.lastBaseUpdate,r===null?a.firstBaseUpdate=s:r.next=s,a.lastBaseUpdate=s}var XO=!1;function Qg(){if(XO){var r=qp;if(r!==null)throw r}}function Hg(r,s,a,c){XO=!1;var A=r.updateQueue;EA=!1;var u=A.firstBaseUpdate,m=A.lastBaseUpdate,E=A.shared.pending;if(E!==null){A.shared.pending=null;var w=E,C=w.next;w.next=null,m===null?u=C:m.next=C,m=w;var T=r.alternate;T!==null&&(T=T.updateQueue,E=T.lastBaseUpdate,E!==m&&(E===null?T.firstBaseUpdate=C:E.next=C,T.lastBaseUpdate=w))}if(u!==null){var N=A.baseState;m=0,T=C=w=null,E=u;do{var B=E.lane&-536870913,k=B!==E.lane;if(k?(Nn&B)===B:(c&B)===B){B!==0&&B===of&&(XO=!0),T!==null&&(T=T.next={lane:0,tag:E.tag,payload:E.payload,callback:null,next:null});e:{var Q=r,K=E;B=s;var Y=a;switch(K.tag){case 1:if(Q=K.payload,typeof Q=="function"){N=Q.call(Y,N,B);break e}N=Q;break e;case 3:Q.flags=Q.flags&-65537|128;case 0:if(Q=K.payload,B=typeof Q=="function"?Q.call(Y,N,B):Q,B==null)break e;N=Br({},N,B);break e;case 2:EA=!0}}B=E.callback,B!==null&&(r.flags|=64,k&&(r.flags|=8192),k=A.callbacks,k===null?A.callbacks=[B]:k.push(B))}else k={lane:B,tag:E.tag,payload:E.payload,callback:E.callback,next:null},T===null?(C=T=k,w=N):T=T.next=k,m|=B;if(E=E.next,E===null){if(E=A.shared.pending,E===null)break;k=E,E=k.next,k.next=null,A.lastBaseUpdate=k,A.shared.pending=null}}while(!0);T===null&&(w=N),A.baseState=w,A.firstBaseUpdate=C,A.lastBaseUpdate=T,u===null&&(A.shared.lanes=0),qA|=m,r.lanes=m,r.memoizedState=N}}function G8(r,s){if(typeof r!="function")throw Error(Me(191,r));r.call(s)}function K8(r,s){var a=r.callbacks;if(a!==null)for(r.callbacks=null,r=0;r<a.length;r++)G8(a[r],s)}var cf=Uc(null),mw=Uc(0);function L5(r,s){r=Il,vr(mw,r),vr(cf,s),Il=r|s.baseLanes}function JO(){vr(mw,Il),vr(cf,cf.current)}function kD(){Il=mw.current,Ws(cf),Ws(mw)}var Ua=Uc(null),yo=null;function wA(r){var s=r.alternate;vr(As,As.current&1),vr(Ua,r),yo===null&&(s===null||cf.current!==null||s.memoizedState!==null)&&(yo=r)}function $O(r){vr(As,As.current),vr(Ua,r),yo===null&&(yo=r)}function W8(r){r.tag===22?(vr(As,As.current),vr(Ua,r),yo===null&&(yo=r)):bA()}function bA(){vr(As,As.current),vr(Ua,Ua.current)}function Ta(r){Ws(Ua),yo===r&&(yo=null),Ws(As)}var As=Uc(0);function gw(r){for(var s=r;s!==null;){if(s.tag===13){var a=s.memoizedState;if(a!==null&&(a=a.dehydrated,a===null||gx(a)||_x(a)))return s}else if(s.tag===19&&(s.memoizedProps.revealOrder==="forwards"||s.memoizedProps.revealOrder==="backwards"||s.memoizedProps.revealOrder==="unstable_legacy-backwards"||s.memoizedProps.revealOrder==="together")){if(s.flags&128)return s}else if(s.child!==null){s.child.return=s,s=s.child;continue}if(s===r)break;for(;s.sibling===null;){if(s.return===null||s.return===r)return null;s=s.return}s.sibling.return=s.return,s=s.sibling}return null}var Cl=0,cn=null,lr=null,Es=null,_w=!1,Jp=!1,Bu=!1,Ew=0,A_=0,$p=null,Bpe=0;function ts(){throw Error(Me(321))}function LD(r,s){if(s===null)return!1;for(var a=0;a<s.length&&a<r.length;a++)if(!La(r[a],s[a]))return!1;return!0}function UD(r,s,a,c,A,u){return Cl=u,cn=s,s.memoizedState=null,s.updateQueue=null,s.lanes=0,Gt.H=r===null||r.memoizedState===null?bW:YD,Bu=!1,u=a(c,A),Bu=!1,Jp&&(u=z8(s,a,c,A)),Y8(r),u}function Y8(r){Gt.H=d_;var s=lr!==null&&lr.next!==null;if(Cl=0,Es=lr=cn=null,_w=!1,A_=0,$p=null,s)throw Error(Me(300));r===null||bs||(r=r.dependencies,r!==null&&pw(r)&&(bs=!0))}function z8(r,s,a,c){cn=r;var A=0;do{if(Jp&&($p=null),A_=0,Jp=!1,25<=A)throw Error(Me(301));if(A+=1,Es=lr=null,r.updateQueue!=null){var u=r.updateQueue;u.lastEffect=null,u.events=null,u.stores=null,u.memoCache!=null&&(u.memoCache.index=0)}Gt.H=SW,u=s(a,c)}while(Jp);return u}function kpe(){var r=Gt.H,s=r.useState()[0];return s=typeof s.then=="function"?P_(s):s,r=r.useState()[0],(lr!==null?lr.memoizedState:null)!==r&&(cn.flags|=1024),s}function PD(){var r=Ew!==0;return Ew=0,r}function MD(r,s,a){s.updateQueue=r.updateQueue,s.flags&=-2053,r.lanes&=~a}function FD(r){if(_w){for(r=r.memoizedState;r!==null;){var s=r.queue;s!==null&&(s.pending=null),r=r.next}_w=!1}Cl=0,Es=lr=cn=null,Jp=!1,A_=Ew=0,$p=null}function Di(){var r={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Es===null?cn.memoizedState=Es=r:Es=Es.next=r,Es}function ds(){if(lr===null){var r=cn.alternate;r=r!==null?r.memoizedState:null}else r=lr.next;var s=Es===null?cn.memoizedState:Es.next;if(s!==null)Es=s,lr=r;else{if(r===null)throw cn.alternate===null?Error(Me(467)):Error(Me(310));lr=r,r={memoizedState:lr.memoizedState,baseState:lr.baseState,baseQueue:lr.baseQueue,queue:lr.queue,next:null},Es===null?cn.memoizedState=Es=r:Es=Es.next=r}return Es}function hb(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function P_(r){var s=A_;return A_+=1,$p===null&&($p=[]),r=V8($p,r,s),s=cn,(Es===null?s.memoizedState:Es.next)===null&&(s=s.alternate,Gt.H=s===null||s.memoizedState===null?bW:YD),r}function pb(r){if(r!==null&&typeof r=="object"){if(typeof r.then=="function")return P_(r);if(r.$$typeof===fl)return ci(r)}throw Error(Me(438,String(r)))}function jD(r){var s=null,a=cn.updateQueue;if(a!==null&&(s=a.memoCache),s==null){var c=cn.alternate;c!==null&&(c=c.updateQueue,c!==null&&(c=c.memoCache,c!=null&&(s={data:c.data.map(function(A){return A.slice()}),index:0})))}if(s==null&&(s={data:[],index:0}),a===null&&(a=hb(),cn.updateQueue=a),a.memoCache=s,a=s.data[s.index],a===void 0)for(a=s.data[s.index]=Array(r),c=0;c<r;c++)a[c]=Ehe;return s.index++,a}function Tl(r,s){return typeof s=="function"?s(r):s}function Yy(r){var s=ds();return VD(s,lr,r)}function VD(r,s,a){var c=r.queue;if(c===null)throw Error(Me(311));c.lastRenderedReducer=a;var A=r.baseQueue,u=c.pending;if(u!==null){if(A!==null){var m=A.next;A.next=u.next,u.next=m}s.baseQueue=A=u,c.pending=null}if(u=r.baseState,A===null)r.memoizedState=u;else{s=A.next;var E=m=null,w=null,C=s,T=!1;do{var N=C.lane&-536870913;if(N!==C.lane?(Nn&N)===N:(Cl&N)===N){var B=C.revertLane;if(B===0)w!==null&&(w=w.next={lane:0,revertLane:0,gesture:null,action:C.action,hasEagerState:C.hasEagerState,eagerState:C.eagerState,next:null}),N===of&&(T=!0);else if((Cl&B)===B){C=C.next,B===of&&(T=!0);continue}else N={lane:0,revertLane:C.revertLane,gesture:null,action:C.action,hasEagerState:C.hasEagerState,eagerState:C.eagerState,next:null},w===null?(E=w=N,m=u):w=w.next=N,cn.lanes|=B,qA|=B;N=C.action,Bu&&a(u,N),u=C.hasEagerState?C.eagerState:a(u,N)}else B={lane:N,revertLane:C.revertLane,gesture:C.gesture,action:C.action,hasEagerState:C.hasEagerState,eagerState:C.eagerState,next:null},w===null?(E=w=B,m=u):w=w.next=B,cn.lanes|=N,qA|=N;C=C.next}while(C!==null&&C!==s);if(w===null?m=u:w.next=E,!La(u,r.memoizedState)&&(bs=!0,T&&(a=qp,a!==null)))throw a;r.memoizedState=u,r.baseState=m,r.baseQueue=w,c.lastRenderedState=u}return A===null&&(c.lanes=0),[r.memoizedState,c.dispatch]}function SN(r){var s=ds(),a=s.queue;if(a===null)throw Error(Me(311));a.lastRenderedReducer=r;var c=a.dispatch,A=a.pending,u=s.memoizedState;if(A!==null){a.pending=null;var m=A=A.next;do u=r(u,m.action),m=m.next;while(m!==A);La(u,s.memoizedState)||(bs=!0),s.memoizedState=u,s.baseQueue===null&&(s.baseState=u),a.lastRenderedState=u}return[u,c]}function q8(r,s,a){var c=cn,A=ds(),u=Dn;if(u){if(a===void 0)throw Error(Me(407));a=a()}else a=s();var m=!La((lr||A).memoizedState,a);if(m&&(A.memoizedState=a,bs=!0),A=A.queue,QD($8.bind(null,c,A,r),[r]),A.getSnapshot!==s||m||Es!==null&&Es.memoizedState.tag&1){if(c.flags|=2048,lf(9,{destroy:void 0},J8.bind(null,c,A,a,s),null),mr===null)throw Error(Me(349));u||Cl&127||X8(c,s,a)}return a}function X8(r,s,a){r.flags|=16384,r={getSnapshot:s,value:a},s=cn.updateQueue,s===null?(s=hb(),cn.updateQueue=s,s.stores=[r]):(a=s.stores,a===null?s.stores=[r]:a.push(r))}function J8(r,s,a,c){s.value=a,s.getSnapshot=c,Z8(s)&&eW(r)}function $8(r,s,a){return a(function(){Z8(s)&&eW(r)})}function Z8(r){var s=r.getSnapshot;r=r.value;try{var a=s();return!La(r,a)}catch{return!0}}function eW(r){var s=ju(r,2);s!==null&&ra(s,r,2)}function ZO(r){var s=Di();if(typeof r=="function"){var a=r;if(r=a(),Bu){TA(!0);try{a()}finally{TA(!1)}}}return s.memoizedState=s.baseState=r,s.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Tl,lastRenderedState:r},s}function tW(r,s,a,c){return r.baseState=a,VD(r,lr,typeof c=="function"?c:Tl)}function Lpe(r,s,a,c,A){if(mb(r))throw Error(Me(485));if(r=s.action,r!==null){var u={payload:A,action:r,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(m){u.listeners.push(m)}};Gt.T!==null?a(!0):u.isTransition=!1,c(u),a=s.pending,a===null?(u.next=s.pending=u,nW(s,u)):(u.next=a.next,s.pending=a.next=u)}}function nW(r,s){var a=s.action,c=s.payload,A=r.state;if(s.isTransition){var u=Gt.T,m={};Gt.T=m;try{var E=a(A,c),w=Gt.S;w!==null&&w(m,E),U5(r,s,E)}catch(C){ex(r,s,C)}finally{u!==null&&m.types!==null&&(u.types=m.types),Gt.T=u}}else try{u=a(A,c),U5(r,s,u)}catch(C){ex(r,s,C)}}function U5(r,s,a){a!==null&&typeof a=="object"&&typeof a.then=="function"?a.then(function(c){P5(r,s,c)},function(c){return ex(r,s,c)}):P5(r,s,a)}function P5(r,s,a){s.status="fulfilled",s.value=a,rW(s),r.state=a,s=r.pending,s!==null&&(a=s.next,a===s?r.pending=null:(a=a.next,s.next=a,nW(r,a)))}function ex(r,s,a){var c=r.pending;if(r.pending=null,c!==null){c=c.next;do s.status="rejected",s.reason=a,rW(s),s=s.next;while(s!==c)}r.action=null}function rW(r){r=r.listeners;for(var s=0;s<r.length;s++)(0,r[s])()}function sW(r,s){return s}function M5(r,s){if(Dn){var a=mr.formState;if(a!==null){e:{var c=cn;if(Dn){if(xr){t:{for(var A=xr,u=_o;A.nodeType!==8;){if(!u){A=null;break t}if(A=wo(A.nextSibling),A===null){A=null;break t}}u=A.data,A=u==="F!"||u==="F"?A:null}if(A){xr=wo(A.nextSibling),c=A.data==="F!";break e}}YA(c)}c=!1}c&&(s=a[0])}}return a=Di(),a.memoizedState=a.baseState=s,c={pending:null,lanes:0,dispatch:null,lastRenderedReducer:sW,lastRenderedState:s},a.queue=c,a=vW.bind(null,cn,c),c.dispatch=a,c=ZO(!1),u=WD.bind(null,cn,!1,c.queue),c=Di(),A={state:s,dispatch:null,action:r,pending:null},c.queue=A,a=Lpe.bind(null,cn,A,u,a),A.dispatch=a,c.memoizedState=r,[s,a,!1]}function F5(r){var s=ds();return iW(s,lr,r)}function iW(r,s,a){if(s=VD(r,s,sW)[0],r=Yy(Tl)[0],typeof s=="object"&&s!==null&&typeof s.then=="function")try{var c=P_(s)}catch(m){throw m===wf?ub:m}else c=s;s=ds();var A=s.queue,u=A.dispatch;return a!==s.memoizedState&&(cn.flags|=2048,lf(9,{destroy:void 0},Upe.bind(null,A,a),null)),[c,u,r]}function Upe(r,s){r.action=s}function j5(r){var s=ds(),a=lr;if(a!==null)return iW(s,a,r);ds(),s=s.memoizedState,a=ds();var c=a.queue.dispatch;return a.memoizedState=r,[s,c,!1]}function lf(r,s,a,c){return r={tag:r,create:a,deps:c,inst:s,next:null},s=cn.updateQueue,s===null&&(s=hb(),cn.updateQueue=s),a=s.lastEffect,a===null?s.lastEffect=r.next=r:(c=a.next,a.next=r,r.next=c,s.lastEffect=r),r}function aW(){return ds().memoizedState}function zy(r,s,a,c){var A=Di();cn.flags|=r,A.memoizedState=lf(1|s,{destroy:void 0},a,c===void 0?null:c)}function fb(r,s,a,c){var A=ds();c=c===void 0?null:c;var u=A.memoizedState.inst;lr!==null&&c!==null&&LD(c,lr.memoizedState.deps)?A.memoizedState=lf(s,u,a,c):(cn.flags|=r,A.memoizedState=lf(1|s,u,a,c))}function V5(r,s){zy(8390656,8,r,s)}function QD(r,s){fb(2048,8,r,s)}function Ppe(r){cn.flags|=4;var s=cn.updateQueue;if(s===null)s=hb(),cn.updateQueue=s,s.events=[r];else{var a=s.events;a===null?s.events=[r]:a.push(r)}}function oW(r){var s=ds().memoizedState;return Ppe({ref:s,nextImpl:r}),function(){if(Vn&2)throw Error(Me(440));return s.impl.apply(void 0,arguments)}}function cW(r,s){return fb(4,2,r,s)}function lW(r,s){return fb(4,4,r,s)}function AW(r,s){if(typeof s=="function"){r=r();var a=s(r);return function(){typeof a=="function"?a():s(null)}}if(s!=null)return r=r(),s.current=r,function(){s.current=null}}function dW(r,s,a){a=a!=null?a.concat([r]):null,fb(4,4,AW.bind(null,s,r),a)}function HD(){}function uW(r,s){var a=ds();s=s===void 0?null:s;var c=a.memoizedState;return s!==null&&LD(s,c[1])?c[0]:(a.memoizedState=[r,s],r)}function hW(r,s){var a=ds();s=s===void 0?null:s;var c=a.memoizedState;if(s!==null&&LD(s,c[1]))return c[0];if(c=r(),Bu){TA(!0);try{r()}finally{TA(!1)}}return a.memoizedState=[c,s],c}function GD(r,s,a){return a===void 0||Cl&1073741824&&!(Nn&261930)?r.memoizedState=s:(r.memoizedState=a,r=tY(),cn.lanes|=r,qA|=r,a)}function pW(r,s,a,c){return La(a,s)?a:cf.current!==null?(r=GD(r,a,c),La(r,s)||(bs=!0),r):!(Cl&42)||Cl&1073741824&&!(Nn&261930)?(bs=!0,r.memoizedState=a):(r=tY(),cn.lanes|=r,qA|=r,s)}function fW(r,s,a,c,A){var u=Qn.p;Qn.p=u!==0&&8>u?u:8;var m=Gt.T,E={};Gt.T=E,WD(r,!1,s,a);try{var w=A(),C=Gt.S;if(C!==null&&C(E,w),w!==null&&typeof w=="object"&&typeof w.then=="function"){var T=Dpe(w,c);Gg(r,s,T,ka(r))}else Gg(r,s,c,ka(r))}catch(N){Gg(r,s,{then:function(){},status:"rejected",reason:N},ka())}finally{Qn.p=u,m!==null&&E.types!==null&&(m.types=E.types),Gt.T=m}}function Mpe(){}function tx(r,s,a,c){if(r.tag!==5)throw Error(Me(476));var A=mW(r).queue;fW(r,A,s,wu,a===null?Mpe:function(){return gW(r),a(c)})}function mW(r){var s=r.memoizedState;if(s!==null)return s;s={memoizedState:wu,baseState:wu,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Tl,lastRenderedState:wu},next:null};var a={};return s.next={memoizedState:a,baseState:a,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Tl,lastRenderedState:a},next:null},r.memoizedState=s,r=r.alternate,r!==null&&(r.memoizedState=s),s}function gW(r){var s=mW(r);s.next===null&&(s=r.alternate.memoizedState),Gg(r,s.next.queue,{},ka())}function KD(){return ci(p_)}function _W(){return ds().memoizedState}function EW(){return ds().memoizedState}function Fpe(r){for(var s=r.return;s!==null;){switch(s.tag){case 24:case 3:var a=ka();r=MA(a);var c=FA(s,r,a);c!==null&&(ra(c,s,a),Vg(c,s,a)),s={cache:OD()},r.payload=s;return}s=s.return}}function jpe(r,s,a){var c=ka();a={lane:c,revertLane:0,gesture:null,action:a,hasEagerState:!1,eagerState:null,next:null},mb(r)?yW(s,a):(a=TD(r,s,a,c),a!==null&&(ra(a,r,c),wW(a,s,c)))}function vW(r,s,a){var c=ka();Gg(r,s,a,c)}function Gg(r,s,a,c){var A={lane:c,revertLane:0,gesture:null,action:a,hasEagerState:!1,eagerState:null,next:null};if(mb(r))yW(s,A);else{var u=r.alternate;if(r.lanes===0&&(u===null||u.lanes===0)&&(u=s.lastRenderedReducer,u!==null))try{var m=s.lastRenderedState,E=u(m,a);if(A.hasEagerState=!0,A.eagerState=E,La(E,m))return db(r,s,A,0),mr===null&&Ab(),!1}catch{}finally{}if(a=TD(r,s,A,c),a!==null)return ra(a,r,c),wW(a,s,c),!0}return!1}function WD(r,s,a,c){if(c={lane:2,revertLane:tB(),gesture:null,action:c,hasEagerState:!1,eagerState:null,next:null},mb(r)){if(s)throw Error(Me(479))}else s=TD(r,a,c,2),s!==null&&ra(s,r,2)}function mb(r){var s=r.alternate;return r===cn||s!==null&&s===cn}function yW(r,s){Jp=_w=!0;var a=r.pending;a===null?s.next=s:(s.next=a.next,a.next=s),r.pending=s}function wW(r,s,a){if(a&4194048){var c=s.lanes;c&=r.pendingLanes,a|=c,s.lanes=a,o8(r,a)}}var d_={readContext:ci,use:pb,useCallback:ts,useContext:ts,useEffect:ts,useImperativeHandle:ts,useLayoutEffect:ts,useInsertionEffect:ts,useMemo:ts,useReducer:ts,useRef:ts,useState:ts,useDebugValue:ts,useDeferredValue:ts,useTransition:ts,useSyncExternalStore:ts,useId:ts,useHostTransitionStatus:ts,useFormState:ts,useActionState:ts,useOptimistic:ts,useMemoCache:ts,useCacheRefresh:ts};d_.useEffectEvent=ts;var bW={readContext:ci,use:pb,useCallback:function(r,s){return Di().memoizedState=[r,s===void 0?null:s],r},useContext:ci,useEffect:V5,useImperativeHandle:function(r,s,a){a=a!=null?a.concat([r]):null,zy(4194308,4,AW.bind(null,s,r),a)},useLayoutEffect:function(r,s){return zy(4194308,4,r,s)},useInsertionEffect:function(r,s){zy(4,2,r,s)},useMemo:function(r,s){var a=Di();s=s===void 0?null:s;var c=r();if(Bu){TA(!0);try{r()}finally{TA(!1)}}return a.memoizedState=[c,s],c},useReducer:function(r,s,a){var c=Di();if(a!==void 0){var A=a(s);if(Bu){TA(!0);try{a(s)}finally{TA(!1)}}}else A=s;return c.memoizedState=c.baseState=A,r={pending:null,lanes:0,dispatch:null,lastRenderedReducer:r,lastRenderedState:A},c.queue=r,r=r.dispatch=jpe.bind(null,cn,r),[c.memoizedState,r]},useRef:function(r){var s=Di();return r={current:r},s.memoizedState=r},useState:function(r){r=ZO(r);var s=r.queue,a=vW.bind(null,cn,s);return s.dispatch=a,[r.memoizedState,a]},useDebugValue:HD,useDeferredValue:function(r,s){var a=Di();return GD(a,r,s)},useTransition:function(){var r=ZO(!1);return r=fW.bind(null,cn,r.queue,!0,!1),Di().memoizedState=r,[!1,r]},useSyncExternalStore:function(r,s,a){var c=cn,A=Di();if(Dn){if(a===void 0)throw Error(Me(407));a=a()}else{if(a=s(),mr===null)throw Error(Me(349));Nn&127||X8(c,s,a)}A.memoizedState=a;var u={value:a,getSnapshot:s};return A.queue=u,V5($8.bind(null,c,u,r),[r]),c.flags|=2048,lf(9,{destroy:void 0},J8.bind(null,c,u,a,s),null),a},useId:function(){var r=Di(),s=mr.identifierPrefix;if(Dn){var a=Dc,c=xc;a=(c&~(1<<32-Ba(c)-1)).toString(32)+a,s="_"+s+"R_"+a,a=Ew++,0<a&&(s+="H"+a.toString(32)),s+="_"}else a=Bpe++,s="_"+s+"r_"+a.toString(32)+"_";return r.memoizedState=s},useHostTransitionStatus:KD,useFormState:M5,useActionState:M5,useOptimistic:function(r){var s=Di();s.memoizedState=s.baseState=r;var a={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return s.queue=a,s=WD.bind(null,cn,!0,a),a.dispatch=s,[r,s]},useMemoCache:jD,useCacheRefresh:function(){return Di().memoizedState=Fpe.bind(null,cn)},useEffectEvent:function(r){var s=Di(),a={impl:r};return s.memoizedState=a,function(){if(Vn&2)throw Error(Me(440));return a.impl.apply(void 0,arguments)}}},YD={readContext:ci,use:pb,useCallback:uW,useContext:ci,useEffect:QD,useImperativeHandle:dW,useInsertionEffect:cW,useLayoutEffect:lW,useMemo:hW,useReducer:Yy,useRef:aW,useState:function(){return Yy(Tl)},useDebugValue:HD,useDeferredValue:function(r,s){var a=ds();return pW(a,lr.memoizedState,r,s)},useTransition:function(){var r=Yy(Tl)[0],s=ds().memoizedState;return[typeof r=="boolean"?r:P_(r),s]},useSyncExternalStore:q8,useId:_W,useHostTransitionStatus:KD,useFormState:F5,useActionState:F5,useOptimistic:function(r,s){var a=ds();return tW(a,lr,r,s)},useMemoCache:jD,useCacheRefresh:EW};YD.useEffectEvent=oW;var SW={readContext:ci,use:pb,useCallback:uW,useContext:ci,useEffect:QD,useImperativeHandle:dW,useInsertionEffect:cW,useLayoutEffect:lW,useMemo:hW,useReducer:SN,useRef:aW,useState:function(){return SN(Tl)},useDebugValue:HD,useDeferredValue:function(r,s){var a=ds();return lr===null?GD(a,r,s):pW(a,lr.memoizedState,r,s)},useTransition:function(){var r=SN(Tl)[0],s=ds().memoizedState;return[typeof r=="boolean"?r:P_(r),s]},useSyncExternalStore:q8,useId:_W,useHostTransitionStatus:KD,useFormState:j5,useActionState:j5,useOptimistic:function(r,s){var a=ds();return lr!==null?tW(a,lr,r,s):(a.baseState=r,[r,a.queue.dispatch])},useMemoCache:jD,useCacheRefresh:EW};SW.useEffectEvent=oW;function CN(r,s,a,c){s=r.memoizedState,a=a(c,s),a=a==null?s:Br({},s,a),r.memoizedState=a,r.lanes===0&&(r.updateQueue.baseState=a)}var nx={enqueueSetState:function(r,s,a){r=r._reactInternals;var c=ka(),A=MA(c);A.payload=s,a!=null&&(A.callback=a),s=FA(r,A,c),s!==null&&(ra(s,r,c),Vg(s,r,c))},enqueueReplaceState:function(r,s,a){r=r._reactInternals;var c=ka(),A=MA(c);A.tag=1,A.payload=s,a!=null&&(A.callback=a),s=FA(r,A,c),s!==null&&(ra(s,r,c),Vg(s,r,c))},enqueueForceUpdate:function(r,s){r=r._reactInternals;var a=ka(),c=MA(a);c.tag=2,s!=null&&(c.callback=s),s=FA(r,c,a),s!==null&&(ra(s,r,a),Vg(s,r,a))}};function Q5(r,s,a,c,A,u,m){return r=r.stateNode,typeof r.shouldComponentUpdate=="function"?r.shouldComponentUpdate(c,u,m):s.prototype&&s.prototype.isPureReactComponent?!a_(a,c)||!a_(A,u):!0}function H5(r,s,a,c){r=s.state,typeof s.componentWillReceiveProps=="function"&&s.componentWillReceiveProps(a,c),typeof s.UNSAFE_componentWillReceiveProps=="function"&&s.UNSAFE_componentWillReceiveProps(a,c),s.state!==r&&nx.enqueueReplaceState(s,s.state,null)}function ku(r,s){var a=s;if("ref"in s){a={};for(var c in s)c!=="ref"&&(a[c]=s[c])}if(r=r.defaultProps){a===s&&(a=Br({},a));for(var A in r)a[A]===void 0&&(a[A]=r[A])}return a}function CW(r){dw(r)}function TW(r){console.error(r)}function RW(r){dw(r)}function vw(r,s){try{var a=r.onUncaughtError;a(s.value,{componentStack:s.stack})}catch(c){setTimeout(function(){throw c})}}function G5(r,s,a){try{var c=r.onCaughtError;c(a.value,{componentStack:a.stack,errorBoundary:s.tag===1?s.stateNode:null})}catch(A){setTimeout(function(){throw A})}}function rx(r,s,a){return a=MA(a),a.tag=3,a.payload={element:null},a.callback=function(){vw(r,s)},a}function IW(r){return r=MA(r),r.tag=3,r}function NW(r,s,a,c){var A=a.type.getDerivedStateFromError;if(typeof A=="function"){var u=c.value;r.payload=function(){return A(u)},r.callback=function(){G5(s,a,c)}}var m=a.stateNode;m!==null&&typeof m.componentDidCatch=="function"&&(r.callback=function(){G5(s,a,c),typeof A!="function"&&(jA===null?jA=new Set([this]):jA.add(this));var E=c.stack;this.componentDidCatch(c.value,{componentStack:E!==null?E:""})})}function Vpe(r,s,a,c,A){if(a.flags|=32768,c!==null&&typeof c=="object"&&typeof c.then=="function"){if(s=a.alternate,s!==null&&yf(s,a,A,!0),a=Ua.current,a!==null){switch(a.tag){case 31:case 13:return yo===null?Cw():a.alternate===null&&ns===0&&(ns=3),a.flags&=-257,a.flags|=65536,a.lanes=A,c===fw?a.flags|=16384:(s=a.updateQueue,s===null?a.updateQueue=new Set([c]):s.add(c),UN(r,c,A)),!1;case 22:return a.flags|=65536,c===fw?a.flags|=16384:(s=a.updateQueue,s===null?(s={transitions:null,markerInstances:null,retryQueue:new Set([c])},a.updateQueue=s):(a=s.retryQueue,a===null?s.retryQueue=new Set([c]):a.add(c)),UN(r,c,A)),!1}throw Error(Me(435,a.tag))}return UN(r,c,A),Cw(),!1}if(Dn)return s=Ua.current,s!==null?(!(s.flags&65536)&&(s.flags|=256),s.flags|=65536,s.lanes=A,c!==GO&&(r=Error(Me(422),{cause:c}),c_(go(r,a)))):(c!==GO&&(s=Error(Me(423),{cause:c}),c_(go(s,a))),r=r.current.alternate,r.flags|=65536,A&=-A,r.lanes|=A,c=go(c,a),A=rx(r.stateNode,c,A),bN(r,A),ns!==4&&(ns=2)),!1;var u=Error(Me(520),{cause:c});if(u=go(u,a),Yg===null?Yg=[u]:Yg.push(u),ns!==4&&(ns=2),s===null)return!0;c=go(c,a),a=s;do{switch(a.tag){case 3:return a.flags|=65536,r=A&-A,a.lanes|=r,r=rx(a.stateNode,c,r),bN(a,r),!1;case 1:if(s=a.type,u=a.stateNode,(a.flags&128)===0&&(typeof s.getDerivedStateFromError=="function"||u!==null&&typeof u.componentDidCatch=="function"&&(jA===null||!jA.has(u))))return a.flags|=65536,A&=-A,a.lanes|=A,A=IW(A),NW(A,r,a,c),bN(a,A),!1}a=a.return}while(a!==null);return!1}var zD=Error(Me(461)),bs=!1;function ii(r,s,a,c){s.child=r===null?H8(s,null,a,c):Du(s,r.child,a,c)}function K5(r,s,a,c,A){a=a.render;var u=s.ref;if("ref"in c){var m={};for(var E in c)E!=="ref"&&(m[E]=c[E])}else m=c;return xu(s),c=UD(r,s,a,m,u,A),E=PD(),r!==null&&!bs?(MD(r,s,A),Rl(r,s,A)):(Dn&&E&&ID(s),s.flags|=1,ii(r,s,c,A),s.child)}function W5(r,s,a,c,A){if(r===null){var u=a.type;return typeof u=="function"&&!RD(u)&&u.defaultProps===void 0&&a.compare===null?(s.tag=15,s.type=u,OW(r,s,u,c,A)):(r=Ky(a.type,null,c,s,s.mode,A),r.ref=s.ref,r.return=s,s.child=r)}if(u=r.child,!qD(r,A)){var m=u.memoizedProps;if(a=a.compare,a=a!==null?a:a_,a(m,c)&&r.ref===s.ref)return Rl(r,s,A)}return s.flags|=1,r=El(u,c),r.ref=s.ref,r.return=s,s.child=r}function OW(r,s,a,c,A){if(r!==null){var u=r.memoizedProps;if(a_(u,c)&&r.ref===s.ref)if(bs=!1,s.pendingProps=c=u,qD(r,A))r.flags&131072&&(bs=!0);else return s.lanes=r.lanes,Rl(r,s,A)}return sx(r,s,a,c,A)}function xW(r,s,a,c){var A=c.children,u=r!==null?r.memoizedState:null;if(r===null&&s.stateNode===null&&(s.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),c.mode==="hidden"){if(s.flags&128){if(u=u!==null?u.baseLanes|a:a,r!==null){for(c=s.child=r.child,A=0;c!==null;)A=A|c.lanes|c.childLanes,c=c.sibling;c=A&~u}else c=0,s.child=null;return Y5(r,s,u,a,c)}if(a&536870912)s.memoizedState={baseLanes:0,cachePool:null},r!==null&&Wy(s,u!==null?u.cachePool:null),u!==null?L5(s,u):JO(),W8(s);else return c=s.lanes=536870912,Y5(r,s,u!==null?u.baseLanes|a:a,a,c)}else u!==null?(Wy(s,u.cachePool),L5(s,u),bA(),s.memoizedState=null):(r!==null&&Wy(s,null),JO(),bA());return ii(r,s,A,a),s.child}function Cg(r,s){return r!==null&&r.tag===22||s.stateNode!==null||(s.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),s.sibling}function Y5(r,s,a,c,A){var u=xD();return u=u===null?null:{parent:ys._currentValue,pool:u},s.memoizedState={baseLanes:a,cachePool:u},r!==null&&Wy(s,null),JO(),W8(s),r!==null&&yf(r,s,c,!0),s.childLanes=A,null}function qy(r,s){return s=yw({mode:s.mode,children:s.children},r.mode),s.ref=r.ref,r.child=s,s.return=r,s}function z5(r,s,a){return Du(s,r.child,null,a),r=qy(s,s.pendingProps),r.flags|=2,Ta(s),s.memoizedState=null,r}function Qpe(r,s,a){var c=s.pendingProps,A=(s.flags&128)!==0;if(s.flags&=-129,r===null){if(Dn){if(c.mode==="hidden")return r=qy(s,c),s.lanes=536870912,Cg(null,r);if($O(s),(r=xr)?(r=bY(r,_o),r=r!==null&&r.data==="&"?r:null,r!==null&&(s.memoizedState={dehydrated:r,treeContext:WA!==null?{id:xc,overflow:Dc}:null,retryLane:536870912,hydrationErrors:null},a=U8(r),a.return=s,s.child=a,oi=s,xr=null)):r=null,r===null)throw YA(s);return s.lanes=536870912,null}return qy(s,c)}var u=r.memoizedState;if(u!==null){var m=u.dehydrated;if($O(s),A)if(s.flags&256)s.flags&=-257,s=z5(r,s,a);else if(s.memoizedState!==null)s.child=r.child,s.flags|=128,s=null;else throw Error(Me(558));else if(bs||yf(r,s,a,!1),A=(a&r.childLanes)!==0,bs||A){if(c=mr,c!==null&&(m=c8(c,a),m!==0&&m!==u.retryLane))throw u.retryLane=m,ju(r,m),ra(c,r,m),zD;Cw(),s=z5(r,s,a)}else r=u.treeContext,xr=wo(m.nextSibling),oi=s,Dn=!0,PA=null,_o=!1,r!==null&&M8(s,r),s=qy(s,c),s.flags|=4096;return s}return r=El(r.child,{mode:c.mode,children:c.children}),r.ref=s.ref,s.child=r,r.return=s,r}function Xy(r,s){var a=s.ref;if(a===null)r!==null&&r.ref!==null&&(s.flags|=4194816);else{if(typeof a!="function"&&typeof a!="object")throw Error(Me(284));(r===null||r.ref!==a)&&(s.flags|=4194816)}}function sx(r,s,a,c,A){return xu(s),a=UD(r,s,a,c,void 0,A),c=PD(),r!==null&&!bs?(MD(r,s,A),Rl(r,s,A)):(Dn&&c&&ID(s),s.flags|=1,ii(r,s,a,A),s.child)}function q5(r,s,a,c,A,u){return xu(s),s.updateQueue=null,a=z8(s,c,a,A),Y8(r),c=PD(),r!==null&&!bs?(MD(r,s,u),Rl(r,s,u)):(Dn&&c&&ID(s),s.flags|=1,ii(r,s,a,u),s.child)}function X5(r,s,a,c,A){if(xu(s),s.stateNode===null){var u=Qp,m=a.contextType;typeof m=="object"&&m!==null&&(u=ci(m)),u=new a(c,u),s.memoizedState=u.state!==null&&u.state!==void 0?u.state:null,u.updater=nx,s.stateNode=u,u._reactInternals=s,u=s.stateNode,u.props=c,u.state=s.memoizedState,u.refs={},BD(s),m=a.contextType,u.context=typeof m=="object"&&m!==null?ci(m):Qp,u.state=s.memoizedState,m=a.getDerivedStateFromProps,typeof m=="function"&&(CN(s,a,m,c),u.state=s.memoizedState),typeof a.getDerivedStateFromProps=="function"||typeof u.getSnapshotBeforeUpdate=="function"||typeof u.UNSAFE_componentWillMount!="function"&&typeof u.componentWillMount!="function"||(m=u.state,typeof u.componentWillMount=="function"&&u.componentWillMount(),typeof u.UNSAFE_componentWillMount=="function"&&u.UNSAFE_componentWillMount(),m!==u.state&&nx.enqueueReplaceState(u,u.state,null),Hg(s,c,u,A),Qg(),u.state=s.memoizedState),typeof u.componentDidMount=="function"&&(s.flags|=4194308),c=!0}else if(r===null){u=s.stateNode;var E=s.memoizedProps,w=ku(a,E);u.props=w;var C=u.context,T=a.contextType;m=Qp,typeof T=="object"&&T!==null&&(m=ci(T));var N=a.getDerivedStateFromProps;T=typeof N=="function"||typeof u.getSnapshotBeforeUpdate=="function",E=s.pendingProps!==E,T||typeof u.UNSAFE_componentWillReceiveProps!="function"&&typeof u.componentWillReceiveProps!="function"||(E||C!==m)&&H5(s,u,c,m),EA=!1;var B=s.memoizedState;u.state=B,Hg(s,c,u,A),Qg(),C=s.memoizedState,E||B!==C||EA?(typeof N=="function"&&(CN(s,a,N,c),C=s.memoizedState),(w=EA||Q5(s,a,w,c,B,C,m))?(T||typeof u.UNSAFE_componentWillMount!="function"&&typeof u.componentWillMount!="function"||(typeof u.componentWillMount=="function"&&u.componentWillMount(),typeof u.UNSAFE_componentWillMount=="function"&&u.UNSAFE_componentWillMount()),typeof u.componentDidMount=="function"&&(s.flags|=4194308)):(typeof u.componentDidMount=="function"&&(s.flags|=4194308),s.memoizedProps=c,s.memoizedState=C),u.props=c,u.state=C,u.context=m,c=w):(typeof u.componentDidMount=="function"&&(s.flags|=4194308),c=!1)}else{u=s.stateNode,qO(r,s),m=s.memoizedProps,T=ku(a,m),u.props=T,N=s.pendingProps,B=u.context,C=a.contextType,w=Qp,typeof C=="object"&&C!==null&&(w=ci(C)),E=a.getDerivedStateFromProps,(C=typeof E=="function"||typeof u.getSnapshotBeforeUpdate=="function")||typeof u.UNSAFE_componentWillReceiveProps!="function"&&typeof u.componentWillReceiveProps!="function"||(m!==N||B!==w)&&H5(s,u,c,w),EA=!1,B=s.memoizedState,u.state=B,Hg(s,c,u,A),Qg();var k=s.memoizedState;m!==N||B!==k||EA||r!==null&&r.dependencies!==null&&pw(r.dependencies)?(typeof E=="function"&&(CN(s,a,E,c),k=s.memoizedState),(T=EA||Q5(s,a,T,c,B,k,w)||r!==null&&r.dependencies!==null&&pw(r.dependencies))?(C||typeof u.UNSAFE_componentWillUpdate!="function"&&typeof u.componentWillUpdate!="function"||(typeof u.componentWillUpdate=="function"&&u.componentWillUpdate(c,k,w),typeof u.UNSAFE_componentWillUpdate=="function"&&u.UNSAFE_componentWillUpdate(c,k,w)),typeof u.componentDidUpdate=="function"&&(s.flags|=4),typeof u.getSnapshotBeforeUpdate=="function"&&(s.flags|=1024)):(typeof u.componentDidUpdate!="function"||m===r.memoizedProps&&B===r.memoizedState||(s.flags|=4),typeof u.getSnapshotBeforeUpdate!="function"||m===r.memoizedProps&&B===r.memoizedState||(s.flags|=1024),s.memoizedProps=c,s.memoizedState=k),u.props=c,u.state=k,u.context=w,c=T):(typeof u.componentDidUpdate!="function"||m===r.memoizedProps&&B===r.memoizedState||(s.flags|=4),typeof u.getSnapshotBeforeUpdate!="function"||m===r.memoizedProps&&B===r.memoizedState||(s.flags|=1024),c=!1)}return u=c,Xy(r,s),c=(s.flags&128)!==0,u||c?(u=s.stateNode,a=c&&typeof a.getDerivedStateFromError!="function"?null:u.render(),s.flags|=1,r!==null&&c?(s.child=Du(s,r.child,null,A),s.child=Du(s,null,a,A)):ii(r,s,a,A),s.memoizedState=u.state,r=s.child):r=Rl(r,s,A),r}function J5(r,s,a,c){return Ou(),s.flags|=256,ii(r,s,a,c),s.child}var TN={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function RN(r){return{baseLanes:r,cachePool:j8()}}function IN(r,s,a){return r=r!==null?r.childLanes&~a:0,s&&(r|=Oa),r}function DW(r,s,a){var c=s.pendingProps,A=!1,u=(s.flags&128)!==0,m;if((m=u)||(m=r!==null&&r.memoizedState===null?!1:(As.current&2)!==0),m&&(A=!0,s.flags&=-129),m=(s.flags&32)!==0,s.flags&=-33,r===null){if(Dn){if(A?wA(s):bA(),(r=xr)?(r=bY(r,_o),r=r!==null&&r.data!=="&"?r:null,r!==null&&(s.memoizedState={dehydrated:r,treeContext:WA!==null?{id:xc,overflow:Dc}:null,retryLane:536870912,hydrationErrors:null},a=U8(r),a.return=s,s.child=a,oi=s,xr=null)):r=null,r===null)throw YA(s);return _x(r)?s.lanes=32:s.lanes=536870912,null}var E=c.children;return c=c.fallback,A?(bA(),A=s.mode,E=yw({mode:"hidden",children:E},A),c=bu(c,A,a,null),E.return=s,c.return=s,E.sibling=c,s.child=E,c=s.child,c.memoizedState=RN(a),c.childLanes=IN(r,m,a),s.memoizedState=TN,Cg(null,c)):(wA(s),ix(s,E))}var w=r.memoizedState;if(w!==null&&(E=w.dehydrated,E!==null)){if(u)s.flags&256?(wA(s),s.flags&=-257,s=NN(r,s,a)):s.memoizedState!==null?(bA(),s.child=r.child,s.flags|=128,s=null):(bA(),E=c.fallback,A=s.mode,c=yw({mode:"visible",children:c.children},A),E=bu(E,A,a,null),E.flags|=2,c.return=s,E.return=s,c.sibling=E,s.child=c,Du(s,r.child,null,a),c=s.child,c.memoizedState=RN(a),c.childLanes=IN(r,m,a),s.memoizedState=TN,s=Cg(null,c));else if(wA(s),_x(E)){if(m=E.nextSibling&&E.nextSibling.dataset,m)var C=m.dgst;m=C,c=Error(Me(419)),c.stack="",c.digest=m,c_({value:c,source:null,stack:null}),s=NN(r,s,a)}else if(bs||yf(r,s,a,!1),m=(a&r.childLanes)!==0,bs||m){if(m=mr,m!==null&&(c=c8(m,a),c!==0&&c!==w.retryLane))throw w.retryLane=c,ju(r,c),ra(m,r,c),zD;gx(E)||Cw(),s=NN(r,s,a)}else gx(E)?(s.flags|=192,s.child=r.child,s=null):(r=w.treeContext,xr=wo(E.nextSibling),oi=s,Dn=!0,PA=null,_o=!1,r!==null&&M8(s,r),s=ix(s,c.children),s.flags|=4096);return s}return A?(bA(),E=c.fallback,A=s.mode,w=r.child,C=w.sibling,c=El(w,{mode:"hidden",children:c.children}),c.subtreeFlags=w.subtreeFlags&65011712,C!==null?E=El(C,E):(E=bu(E,A,a,null),E.flags|=2),E.return=s,c.return=s,c.sibling=E,s.child=c,Cg(null,c),c=s.child,E=r.child.memoizedState,E===null?E=RN(a):(A=E.cachePool,A!==null?(w=ys._currentValue,A=A.parent!==w?{parent:w,pool:w}:A):A=j8(),E={baseLanes:E.baseLanes|a,cachePool:A}),c.memoizedState=E,c.childLanes=IN(r,m,a),s.memoizedState=TN,Cg(r.child,c)):(wA(s),a=r.child,r=a.sibling,a=El(a,{mode:"visible",children:c.children}),a.return=s,a.sibling=null,r!==null&&(m=s.deletions,m===null?(s.deletions=[r],s.flags|=16):m.push(r)),s.child=a,s.memoizedState=null,a)}function ix(r,s){return s=yw({mode:"visible",children:s},r.mode),s.return=r,r.child=s}function yw(r,s){return r=Ra(22,r,null,s),r.lanes=0,r}function NN(r,s,a){return Du(s,r.child,null,a),r=ix(s,s.pendingProps.children),r.flags|=2,s.memoizedState=null,r}function $5(r,s,a){r.lanes|=s;var c=r.alternate;c!==null&&(c.lanes|=s),WO(r.return,s,a)}function ON(r,s,a,c,A,u){var m=r.memoizedState;m===null?r.memoizedState={isBackwards:s,rendering:null,renderingStartTime:0,last:c,tail:a,tailMode:A,treeForkCount:u}:(m.isBackwards=s,m.rendering=null,m.renderingStartTime=0,m.last=c,m.tail=a,m.tailMode=A,m.treeForkCount=u)}function BW(r,s,a){var c=s.pendingProps,A=c.revealOrder,u=c.tail;c=c.children;var m=As.current,E=(m&2)!==0;if(E?(m=m&1|2,s.flags|=128):m&=1,vr(As,m),ii(r,s,c,a),c=Dn?o_:0,!E&&r!==null&&r.flags&128)e:for(r=s.child;r!==null;){if(r.tag===13)r.memoizedState!==null&&$5(r,a,s);else if(r.tag===19)$5(r,a,s);else if(r.child!==null){r.child.return=r,r=r.child;continue}if(r===s)break e;for(;r.sibling===null;){if(r.return===null||r.return===s)break e;r=r.return}r.sibling.return=r.return,r=r.sibling}switch(A){case"forwards":for(a=s.child,A=null;a!==null;)r=a.alternate,r!==null&&gw(r)===null&&(A=a),a=a.sibling;a=A,a===null?(A=s.child,s.child=null):(A=a.sibling,a.sibling=null),ON(s,!1,A,a,u,c);break;case"backwards":case"unstable_legacy-backwards":for(a=null,A=s.child,s.child=null;A!==null;){if(r=A.alternate,r!==null&&gw(r)===null){s.child=A;break}r=A.sibling,A.sibling=a,a=A,A=r}ON(s,!0,a,null,u,c);break;case"together":ON(s,!1,null,null,void 0,c);break;default:s.memoizedState=null}return s.child}function Rl(r,s,a){if(r!==null&&(s.dependencies=r.dependencies),qA|=s.lanes,!(a&s.childLanes))if(r!==null){if(yf(r,s,a,!1),(a&s.childLanes)===0)return null}else return null;if(r!==null&&s.child!==r.child)throw Error(Me(153));if(s.child!==null){for(r=s.child,a=El(r,r.pendingProps),s.child=a,a.return=s;r.sibling!==null;)r=r.sibling,a=a.sibling=El(r,r.pendingProps),a.return=s;a.sibling=null}return s.child}function qD(r,s){return r.lanes&s?!0:(r=r.dependencies,!!(r!==null&&pw(r)))}function Hpe(r,s,a){switch(s.tag){case 3:ow(s,s.stateNode.containerInfo),yA(s,ys,r.memoizedState.cache),Ou();break;case 27:case 5:BO(s);break;case 4:ow(s,s.stateNode.containerInfo);break;case 10:yA(s,s.type,s.memoizedProps.value);break;case 31:if(s.memoizedState!==null)return s.flags|=128,$O(s),null;break;case 13:var c=s.memoizedState;if(c!==null)return c.dehydrated!==null?(wA(s),s.flags|=128,null):a&s.child.childLanes?DW(r,s,a):(wA(s),r=Rl(r,s,a),r!==null?r.sibling:null);wA(s);break;case 19:var A=(r.flags&128)!==0;if(c=(a&s.childLanes)!==0,c||(yf(r,s,a,!1),c=(a&s.childLanes)!==0),A){if(c)return BW(r,s,a);s.flags|=128}if(A=s.memoizedState,A!==null&&(A.rendering=null,A.tail=null,A.lastEffect=null),vr(As,As.current),c)break;return null;case 22:return s.lanes=0,xW(r,s,a,s.pendingProps);case 24:yA(s,ys,r.memoizedState.cache)}return Rl(r,s,a)}function kW(r,s,a){if(r!==null)if(r.memoizedProps!==s.pendingProps)bs=!0;else{if(!qD(r,a)&&!(s.flags&128))return bs=!1,Hpe(r,s,a);bs=!!(r.flags&131072)}else bs=!1,Dn&&s.flags&1048576&&P8(s,o_,s.index);switch(s.lanes=0,s.tag){case 16:e:{var c=s.pendingProps;if(r=du(s.elementType),s.type=r,typeof r=="function")RD(r)?(c=ku(r,c),s.tag=1,s=X5(null,s,r,c,a)):(s.tag=0,s=sx(null,s,r,c,a));else{if(r!=null){var A=r.$$typeof;if(A===hD){s.tag=11,s=K5(null,s,r,c,a);break e}else if(A===pD){s.tag=14,s=W5(null,s,r,c,a);break e}}throw s=xO(r)||r,Error(Me(306,s,""))}}return s;case 0:return sx(r,s,s.type,s.pendingProps,a);case 1:return c=s.type,A=ku(c,s.pendingProps),X5(r,s,c,A,a);case 3:e:{if(ow(s,s.stateNode.containerInfo),r===null)throw Error(Me(387));c=s.pendingProps;var u=s.memoizedState;A=u.element,qO(r,s),Hg(s,c,null,a);var m=s.memoizedState;if(c=m.cache,yA(s,ys,c),c!==u.cache&&YO(s,[ys],a,!0),Qg(),c=m.element,u.isDehydrated)if(u={element:c,isDehydrated:!1,cache:m.cache},s.updateQueue.baseState=u,s.memoizedState=u,s.flags&256){s=J5(r,s,c,a);break e}else if(c!==A){A=go(Error(Me(424)),s),c_(A),s=J5(r,s,c,a);break e}else{switch(r=s.stateNode.containerInfo,r.nodeType){case 9:r=r.body;break;default:r=r.nodeName==="HTML"?r.ownerDocument.body:r}for(xr=wo(r.firstChild),oi=s,Dn=!0,PA=null,_o=!0,a=H8(s,null,c,a),s.child=a;a;)a.flags=a.flags&-3|4096,a=a.sibling}else{if(Ou(),c===A){s=Rl(r,s,a);break e}ii(r,s,c,a)}s=s.child}return s;case 26:return Xy(r,s),r===null?(a=_6(s.type,null,s.pendingProps,null))?s.memoizedState=a:Dn||(a=s.type,r=s.pendingProps,c=Nw(UA.current).createElement(a),c[ai]=s,c[sa]=r,Ai(c,a,r),Gs(c),s.stateNode=c):s.memoizedState=_6(s.type,r.memoizedProps,s.pendingProps,r.memoizedState),null;case 27:return BO(s),r===null&&Dn&&(c=s.stateNode=SY(s.type,s.pendingProps,UA.current),oi=s,_o=!0,A=xr,ZA(s.type)?(Ex=A,xr=wo(c.firstChild)):xr=A),ii(r,s,s.pendingProps.children,a),Xy(r,s),r===null&&(s.flags|=4194304),s.child;case 5:return r===null&&Dn&&((A=c=xr)&&(c=Efe(c,s.type,s.pendingProps,_o),c!==null?(s.stateNode=c,oi=s,xr=wo(c.firstChild),_o=!1,A=!0):A=!1),A||YA(s)),BO(s),A=s.type,u=s.pendingProps,m=r!==null?r.memoizedProps:null,c=u.children,fx(A,u)?c=null:m!==null&&fx(A,m)&&(s.flags|=32),s.memoizedState!==null&&(A=UD(r,s,kpe,null,null,a),p_._currentValue=A),Xy(r,s),ii(r,s,c,a),s.child;case 6:return r===null&&Dn&&((r=a=xr)&&(a=vfe(a,s.pendingProps,_o),a!==null?(s.stateNode=a,oi=s,xr=null,r=!0):r=!1),r||YA(s)),null;case 13:return DW(r,s,a);case 4:return ow(s,s.stateNode.containerInfo),c=s.pendingProps,r===null?s.child=Du(s,null,c,a):ii(r,s,c,a),s.child;case 11:return K5(r,s,s.type,s.pendingProps,a);case 7:return ii(r,s,s.pendingProps,a),s.child;case 8:return ii(r,s,s.pendingProps.children,a),s.child;case 12:return ii(r,s,s.pendingProps.children,a),s.child;case 10:return c=s.pendingProps,yA(s,s.type,c.value),ii(r,s,c.children,a),s.child;case 9:return A=s.type._context,c=s.pendingProps.children,xu(s),A=ci(A),c=c(A),s.flags|=1,ii(r,s,c,a),s.child;case 14:return W5(r,s,s.type,s.pendingProps,a);case 15:return OW(r,s,s.type,s.pendingProps,a);case 19:return BW(r,s,a);case 31:return Qpe(r,s,a);case 22:return xW(r,s,a,s.pendingProps);case 24:return xu(s),c=ci(ys),r===null?(A=xD(),A===null&&(A=mr,u=OD(),A.pooledCache=u,u.refCount++,u!==null&&(A.pooledCacheLanes|=a),A=u),s.memoizedState={parent:c,cache:A},BD(s),yA(s,ys,A)):(r.lanes&a&&(qO(r,s),Hg(s,null,null,a),Qg()),A=r.memoizedState,u=s.memoizedState,A.parent!==c?(A={parent:c,cache:c},s.memoizedState=A,s.lanes===0&&(s.memoizedState=s.updateQueue.baseState=A),yA(s,ys,c)):(c=u.cache,yA(s,ys,c),c!==A.cache&&YO(s,[ys],a,!0))),ii(r,s,s.pendingProps.children,a),s.child;case 29:throw s.pendingProps}throw Error(Me(156,s.tag))}function rl(r){r.flags|=4}function xN(r,s,a,c,A){if((s=(r.mode&32)!==0)&&(s=!1),s){if(r.flags|=16777216,(A&335544128)===A)if(r.stateNode.complete)r.flags|=8192;else if(sY())r.flags|=8192;else throw Cu=fw,DD}else r.flags&=-16777217}function Z5(r,s){if(s.type!=="stylesheet"||s.state.loading&4)r.flags&=-16777217;else if(r.flags|=16777216,!RY(s))if(sY())r.flags|=8192;else throw Cu=fw,DD}function ry(r,s){s!==null&&(r.flags|=4),r.flags&16384&&(s=r.tag!==22?i8():536870912,r.lanes|=s,Af|=s)}function dg(r,s){if(!Dn)switch(r.tailMode){case"hidden":s=r.tail;for(var a=null;s!==null;)s.alternate!==null&&(a=s),s=s.sibling;a===null?r.tail=null:a.sibling=null;break;case"collapsed":a=r.tail;for(var c=null;a!==null;)a.alternate!==null&&(c=a),a=a.sibling;c===null?s||r.tail===null?r.tail=null:r.tail.sibling=null:c.sibling=null}}function Nr(r){var s=r.alternate!==null&&r.alternate.child===r.child,a=0,c=0;if(s)for(var A=r.child;A!==null;)a|=A.lanes|A.childLanes,c|=A.subtreeFlags&65011712,c|=A.flags&65011712,A.return=r,A=A.sibling;else for(A=r.child;A!==null;)a|=A.lanes|A.childLanes,c|=A.subtreeFlags,c|=A.flags,A.return=r,A=A.sibling;return r.subtreeFlags|=c,r.childLanes=a,s}function Gpe(r,s,a){var c=s.pendingProps;switch(ND(s),s.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Nr(s),null;case 1:return Nr(s),null;case 3:return a=s.stateNode,c=null,r!==null&&(c=r.memoizedState.cache),s.memoizedState.cache!==c&&(s.flags|=2048),vl(ys),rf(),a.pendingContext&&(a.context=a.pendingContext,a.pendingContext=null),(r===null||r.child===null)&&(dp(s)?rl(s):r===null||r.memoizedState.isDehydrated&&!(s.flags&256)||(s.flags|=1024,wN())),Nr(s),null;case 26:var A=s.type,u=s.memoizedState;return r===null?(rl(s),u!==null?(Nr(s),Z5(s,u)):(Nr(s),xN(s,A,null,c,a))):u?u!==r.memoizedState?(rl(s),Nr(s),Z5(s,u)):(Nr(s),s.flags&=-16777217):(r=r.memoizedProps,r!==c&&rl(s),Nr(s),xN(s,A,r,c,a)),null;case 27:if(cw(s),a=UA.current,A=s.type,r!==null&&s.stateNode!=null)r.memoizedProps!==c&&rl(s);else{if(!c){if(s.stateNode===null)throw Error(Me(166));return Nr(s),null}r=kc.current,dp(s)?I5(s):(r=SY(A,c,a),s.stateNode=r,rl(s))}return Nr(s),null;case 5:if(cw(s),A=s.type,r!==null&&s.stateNode!=null)r.memoizedProps!==c&&rl(s);else{if(!c){if(s.stateNode===null)throw Error(Me(166));return Nr(s),null}if(u=kc.current,dp(s))I5(s);else{var m=Nw(UA.current);switch(u){case 1:u=m.createElementNS("http://www.w3.org/2000/svg",A);break;case 2:u=m.createElementNS("http://www.w3.org/1998/Math/MathML",A);break;default:switch(A){case"svg":u=m.createElementNS("http://www.w3.org/2000/svg",A);break;case"math":u=m.createElementNS("http://www.w3.org/1998/Math/MathML",A);break;case"script":u=m.createElement("div"),u.innerHTML="<script><\/script>",u=u.removeChild(u.firstChild);break;case"select":u=typeof c.is=="string"?m.createElement("select",{is:c.is}):m.createElement("select"),c.multiple?u.multiple=!0:c.size&&(u.size=c.size);break;default:u=typeof c.is=="string"?m.createElement(A,{is:c.is}):m.createElement(A)}}u[ai]=s,u[sa]=c;e:for(m=s.child;m!==null;){if(m.tag===5||m.tag===6)u.appendChild(m.stateNode);else if(m.tag!==4&&m.tag!==27&&m.child!==null){m.child.return=m,m=m.child;continue}if(m===s)break e;for(;m.sibling===null;){if(m.return===null||m.return===s)break e;m=m.return}m.sibling.return=m.return,m=m.sibling}s.stateNode=u;e:switch(Ai(u,A,c),A){case"button":case"input":case"select":case"textarea":c=!!c.autoFocus;break e;case"img":c=!0;break e;default:c=!1}c&&rl(s)}}return Nr(s),xN(s,s.type,r===null?null:r.memoizedProps,s.pendingProps,a),null;case 6:if(r&&s.stateNode!=null)r.memoizedProps!==c&&rl(s);else{if(typeof c!="string"&&s.stateNode===null)throw Error(Me(166));if(r=UA.current,dp(s)){if(r=s.stateNode,a=s.memoizedProps,c=null,A=oi,A!==null)switch(A.tag){case 27:case 5:c=A.memoizedProps}r[ai]=s,r=!!(r.nodeValue===a||c!==null&&c.suppressHydrationWarning===!0||vY(r.nodeValue,a)),r||YA(s,!0)}else r=Nw(r).createTextNode(c),r[ai]=s,s.stateNode=r}return Nr(s),null;case 31:if(a=s.memoizedState,r===null||r.memoizedState!==null){if(c=dp(s),a!==null){if(r===null){if(!c)throw Error(Me(318));if(r=s.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(Me(557));r[ai]=s}else Ou(),!(s.flags&128)&&(s.memoizedState=null),s.flags|=4;Nr(s),r=!1}else a=wN(),r!==null&&r.memoizedState!==null&&(r.memoizedState.hydrationErrors=a),r=!0;if(!r)return s.flags&256?(Ta(s),s):(Ta(s),null);if(s.flags&128)throw Error(Me(558))}return Nr(s),null;case 13:if(c=s.memoizedState,r===null||r.memoizedState!==null&&r.memoizedState.dehydrated!==null){if(A=dp(s),c!==null&&c.dehydrated!==null){if(r===null){if(!A)throw Error(Me(318));if(A=s.memoizedState,A=A!==null?A.dehydrated:null,!A)throw Error(Me(317));A[ai]=s}else Ou(),!(s.flags&128)&&(s.memoizedState=null),s.flags|=4;Nr(s),A=!1}else A=wN(),r!==null&&r.memoizedState!==null&&(r.memoizedState.hydrationErrors=A),A=!0;if(!A)return s.flags&256?(Ta(s),s):(Ta(s),null)}return Ta(s),s.flags&128?(s.lanes=a,s):(a=c!==null,r=r!==null&&r.memoizedState!==null,a&&(c=s.child,A=null,c.alternate!==null&&c.alternate.memoizedState!==null&&c.alternate.memoizedState.cachePool!==null&&(A=c.alternate.memoizedState.cachePool.pool),u=null,c.memoizedState!==null&&c.memoizedState.cachePool!==null&&(u=c.memoizedState.cachePool.pool),u!==A&&(c.flags|=2048)),a!==r&&a&&(s.child.flags|=8192),ry(s,s.updateQueue),Nr(s),null);case 4:return rf(),r===null&&nB(s.stateNode.containerInfo),Nr(s),null;case 10:return vl(s.type),Nr(s),null;case 19:if(Ws(As),c=s.memoizedState,c===null)return Nr(s),null;if(A=(s.flags&128)!==0,u=c.rendering,u===null)if(A)dg(c,!1);else{if(ns!==0||r!==null&&r.flags&128)for(r=s.child;r!==null;){if(u=gw(r),u!==null){for(s.flags|=128,dg(c,!1),r=u.updateQueue,s.updateQueue=r,ry(s,r),s.subtreeFlags=0,r=a,a=s.child;a!==null;)L8(a,r),a=a.sibling;return vr(As,As.current&1|2),Dn&&ul(s,c.treeForkCount),s.child}r=r.sibling}c.tail!==null&&xa()>bw&&(s.flags|=128,A=!0,dg(c,!1),s.lanes=4194304)}else{if(!A)if(r=gw(u),r!==null){if(s.flags|=128,A=!0,r=r.updateQueue,s.updateQueue=r,ry(s,r),dg(c,!0),c.tail===null&&c.tailMode==="hidden"&&!u.alternate&&!Dn)return Nr(s),null}else 2*xa()-c.renderingStartTime>bw&&a!==536870912&&(s.flags|=128,A=!0,dg(c,!1),s.lanes=4194304);c.isBackwards?(u.sibling=s.child,s.child=u):(r=c.last,r!==null?r.sibling=u:s.child=u,c.last=u)}return c.tail!==null?(r=c.tail,c.rendering=r,c.tail=r.sibling,c.renderingStartTime=xa(),r.sibling=null,a=As.current,vr(As,A?a&1|2:a&1),Dn&&ul(s,c.treeForkCount),r):(Nr(s),null);case 22:case 23:return Ta(s),kD(),c=s.memoizedState!==null,r!==null?r.memoizedState!==null!==c&&(s.flags|=8192):c&&(s.flags|=8192),c?a&536870912&&!(s.flags&128)&&(Nr(s),s.subtreeFlags&6&&(s.flags|=8192)):Nr(s),a=s.updateQueue,a!==null&&ry(s,a.retryQueue),a=null,r!==null&&r.memoizedState!==null&&r.memoizedState.cachePool!==null&&(a=r.memoizedState.cachePool.pool),c=null,s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(c=s.memoizedState.cachePool.pool),c!==a&&(s.flags|=2048),r!==null&&Ws(Su),null;case 24:return a=null,r!==null&&(a=r.memoizedState.cache),s.memoizedState.cache!==a&&(s.flags|=2048),vl(ys),Nr(s),null;case 25:return null;case 30:return null}throw Error(Me(156,s.tag))}function Kpe(r,s){switch(ND(s),s.tag){case 1:return r=s.flags,r&65536?(s.flags=r&-65537|128,s):null;case 3:return vl(ys),rf(),r=s.flags,r&65536&&!(r&128)?(s.flags=r&-65537|128,s):null;case 26:case 27:case 5:return cw(s),null;case 31:if(s.memoizedState!==null){if(Ta(s),s.alternate===null)throw Error(Me(340));Ou()}return r=s.flags,r&65536?(s.flags=r&-65537|128,s):null;case 13:if(Ta(s),r=s.memoizedState,r!==null&&r.dehydrated!==null){if(s.alternate===null)throw Error(Me(340));Ou()}return r=s.flags,r&65536?(s.flags=r&-65537|128,s):null;case 19:return Ws(As),null;case 4:return rf(),null;case 10:return vl(s.type),null;case 22:case 23:return Ta(s),kD(),r!==null&&Ws(Su),r=s.flags,r&65536?(s.flags=r&-65537|128,s):null;case 24:return vl(ys),null;case 25:return null;default:return null}}function LW(r,s){switch(ND(s),s.tag){case 3:vl(ys),rf();break;case 26:case 27:case 5:cw(s);break;case 4:rf();break;case 31:s.memoizedState!==null&&Ta(s);break;case 13:Ta(s);break;case 19:Ws(As);break;case 10:vl(s.type);break;case 22:case 23:Ta(s),kD(),r!==null&&Ws(Su);break;case 24:vl(ys)}}function M_(r,s){try{var a=s.updateQueue,c=a!==null?a.lastEffect:null;if(c!==null){var A=c.next;a=A;do{if((a.tag&r)===r){c=void 0;var u=a.create,m=a.inst;c=u(),m.destroy=c}a=a.next}while(a!==A)}}catch(E){nr(s,s.return,E)}}function zA(r,s,a){try{var c=s.updateQueue,A=c!==null?c.lastEffect:null;if(A!==null){var u=A.next;c=u;do{if((c.tag&r)===r){var m=c.inst,E=m.destroy;if(E!==void 0){m.destroy=void 0,A=s;var w=a,C=E;try{C()}catch(T){nr(A,w,T)}}}c=c.next}while(c!==u)}}catch(T){nr(s,s.return,T)}}function UW(r){var s=r.updateQueue;if(s!==null){var a=r.stateNode;try{K8(s,a)}catch(c){nr(r,r.return,c)}}}function PW(r,s,a){a.props=ku(r.type,r.memoizedProps),a.state=r.memoizedState;try{a.componentWillUnmount()}catch(c){nr(r,s,c)}}function Kg(r,s){try{var a=r.ref;if(a!==null){switch(r.tag){case 26:case 27:case 5:var c=r.stateNode;break;case 30:c=r.stateNode;break;default:c=r.stateNode}typeof a=="function"?r.refCleanup=a(c):a.current=c}}catch(A){nr(r,s,A)}}function Bc(r,s){var a=r.ref,c=r.refCleanup;if(a!==null)if(typeof c=="function")try{c()}catch(A){nr(r,s,A)}finally{r.refCleanup=null,r=r.alternate,r!=null&&(r.refCleanup=null)}else if(typeof a=="function")try{a(null)}catch(A){nr(r,s,A)}else a.current=null}function MW(r){var s=r.type,a=r.memoizedProps,c=r.stateNode;try{e:switch(s){case"button":case"input":case"select":case"textarea":a.autoFocus&&c.focus();break e;case"img":a.src?c.src=a.src:a.srcSet&&(c.srcset=a.srcSet)}}catch(A){nr(r,r.return,A)}}function DN(r,s,a){try{var c=r.stateNode;hfe(c,r.type,a,s),c[sa]=s}catch(A){nr(r,r.return,A)}}function FW(r){return r.tag===5||r.tag===3||r.tag===26||r.tag===27&&ZA(r.type)||r.tag===4}function BN(r){e:for(;;){for(;r.sibling===null;){if(r.return===null||FW(r.return))return null;r=r.return}for(r.sibling.return=r.return,r=r.sibling;r.tag!==5&&r.tag!==6&&r.tag!==18;){if(r.tag===27&&ZA(r.type)||r.flags&2||r.child===null||r.tag===4)continue e;r.child.return=r,r=r.child}if(!(r.flags&2))return r.stateNode}}function ax(r,s,a){var c=r.tag;if(c===5||c===6)r=r.stateNode,s?(a.nodeType===9?a.body:a.nodeName==="HTML"?a.ownerDocument.body:a).insertBefore(r,s):(s=a.nodeType===9?a.body:a.nodeName==="HTML"?a.ownerDocument.body:a,s.appendChild(r),a=a._reactRootContainer,a!=null||s.onclick!==null||(s.onclick=ml));else if(c!==4&&(c===27&&ZA(r.type)&&(a=r.stateNode,s=null),r=r.child,r!==null))for(ax(r,s,a),r=r.sibling;r!==null;)ax(r,s,a),r=r.sibling}function ww(r,s,a){var c=r.tag;if(c===5||c===6)r=r.stateNode,s?a.insertBefore(r,s):a.appendChild(r);else if(c!==4&&(c===27&&ZA(r.type)&&(a=r.stateNode),r=r.child,r!==null))for(ww(r,s,a),r=r.sibling;r!==null;)ww(r,s,a),r=r.sibling}function jW(r){var s=r.stateNode,a=r.memoizedProps;try{for(var c=r.type,A=s.attributes;A.length;)s.removeAttributeNode(A[0]);Ai(s,c,a),s[ai]=r,s[sa]=a}catch(u){nr(r,r.return,u)}}var pl=!1,vs=!1,kN=!1,e6=typeof WeakSet=="function"?WeakSet:Set,Hs=null;function Wpe(r,s){if(r=r.containerInfo,hx=Bw,r=R8(r),SD(r)){if("selectionStart"in r)var a={start:r.selectionStart,end:r.selectionEnd};else e:{a=(a=r.ownerDocument)&&a.defaultView||window;var c=a.getSelection&&a.getSelection();if(c&&c.rangeCount!==0){a=c.anchorNode;var A=c.anchorOffset,u=c.focusNode;c=c.focusOffset;try{a.nodeType,u.nodeType}catch{a=null;break e}var m=0,E=-1,w=-1,C=0,T=0,N=r,B=null;t:for(;;){for(var k;N!==a||A!==0&&N.nodeType!==3||(E=m+A),N!==u||c!==0&&N.nodeType!==3||(w=m+c),N.nodeType===3&&(m+=N.nodeValue.length),(k=N.firstChild)!==null;)B=N,N=k;for(;;){if(N===r)break t;if(B===a&&++C===A&&(E=m),B===u&&++T===c&&(w=m),(k=N.nextSibling)!==null)break;N=B,B=N.parentNode}N=k}a=E===-1||w===-1?null:{start:E,end:w}}else a=null}a=a||{start:0,end:0}}else a=null;for(px={focusedElem:r,selectionRange:a},Bw=!1,Hs=s;Hs!==null;)if(s=Hs,r=s.child,(s.subtreeFlags&1028)!==0&&r!==null)r.return=s,Hs=r;else for(;Hs!==null;){switch(s=Hs,u=s.alternate,r=s.flags,s.tag){case 0:if(r&4&&(r=s.updateQueue,r=r!==null?r.events:null,r!==null))for(a=0;a<r.length;a++)A=r[a],A.ref.impl=A.nextImpl;break;case 11:case 15:break;case 1:if(r&1024&&u!==null){r=void 0,a=s,A=u.memoizedProps,u=u.memoizedState,c=a.stateNode;try{var Q=ku(a.type,A);r=c.getSnapshotBeforeUpdate(Q,u),c.__reactInternalSnapshotBeforeUpdate=r}catch(K){nr(a,a.return,K)}}break;case 3:if(r&1024){if(r=s.stateNode.containerInfo,a=r.nodeType,a===9)mx(r);else if(a===1)switch(r.nodeName){case"HEAD":case"HTML":case"BODY":mx(r);break;default:r.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if(r&1024)throw Error(Me(163))}if(r=s.sibling,r!==null){r.return=s.return,Hs=r;break}Hs=s.return}}function VW(r,s,a){var c=a.flags;switch(a.tag){case 0:case 11:case 15:il(r,a),c&4&&M_(5,a);break;case 1:if(il(r,a),c&4)if(r=a.stateNode,s===null)try{r.componentDidMount()}catch(m){nr(a,a.return,m)}else{var A=ku(a.type,s.memoizedProps);s=s.memoizedState;try{r.componentDidUpdate(A,s,r.__reactInternalSnapshotBeforeUpdate)}catch(m){nr(a,a.return,m)}}c&64&&UW(a),c&512&&Kg(a,a.return);break;case 3:if(il(r,a),c&64&&(r=a.updateQueue,r!==null)){if(s=null,a.child!==null)switch(a.child.tag){case 27:case 5:s=a.child.stateNode;break;case 1:s=a.child.stateNode}try{K8(r,s)}catch(m){nr(a,a.return,m)}}break;case 27:s===null&&c&4&&jW(a);case 26:case 5:il(r,a),s===null&&c&4&&MW(a),c&512&&Kg(a,a.return);break;case 12:il(r,a);break;case 31:il(r,a),c&4&&GW(r,a);break;case 13:il(r,a),c&4&&KW(r,a),c&64&&(r=a.memoizedState,r!==null&&(r=r.dehydrated,r!==null&&(a=tfe.bind(null,a),yfe(r,a))));break;case 22:if(c=a.memoizedState!==null||pl,!c){s=s!==null&&s.memoizedState!==null||vs,A=pl;var u=vs;pl=c,(vs=s)&&!u?Al(r,a,(a.subtreeFlags&8772)!==0):il(r,a),pl=A,vs=u}break;case 30:break;default:il(r,a)}}function QW(r){var s=r.alternate;s!==null&&(r.alternate=null,QW(s)),r.child=null,r.deletions=null,r.sibling=null,r.tag===5&&(s=r.stateNode,s!==null&&_D(s)),r.stateNode=null,r.return=null,r.dependencies=null,r.memoizedProps=null,r.memoizedState=null,r.pendingProps=null,r.stateNode=null,r.updateQueue=null}var Vr=null,ea=!1;function sl(r,s,a){for(a=a.child;a!==null;)HW(r,s,a),a=a.sibling}function HW(r,s,a){if(Da&&typeof Da.onCommitFiberUnmount=="function")try{Da.onCommitFiberUnmount(x_,a)}catch{}switch(a.tag){case 26:vs||Bc(a,s),sl(r,s,a),a.memoizedState?a.memoizedState.count--:a.stateNode&&(a=a.stateNode,a.parentNode.removeChild(a));break;case 27:vs||Bc(a,s);var c=Vr,A=ea;ZA(a.type)&&(Vr=a.stateNode,ea=!1),sl(r,s,a),qg(a.stateNode),Vr=c,ea=A;break;case 5:vs||Bc(a,s);case 6:if(c=Vr,A=ea,Vr=null,sl(r,s,a),Vr=c,ea=A,Vr!==null)if(ea)try{(Vr.nodeType===9?Vr.body:Vr.nodeName==="HTML"?Vr.ownerDocument.body:Vr).removeChild(a.stateNode)}catch(u){nr(a,s,u)}else try{Vr.removeChild(a.stateNode)}catch(u){nr(a,s,u)}break;case 18:Vr!==null&&(ea?(r=Vr,h6(r.nodeType===9?r.body:r.nodeName==="HTML"?r.ownerDocument.body:r,a.stateNode),pf(r)):h6(Vr,a.stateNode));break;case 4:c=Vr,A=ea,Vr=a.stateNode.containerInfo,ea=!0,sl(r,s,a),Vr=c,ea=A;break;case 0:case 11:case 14:case 15:zA(2,a,s),vs||zA(4,a,s),sl(r,s,a);break;case 1:vs||(Bc(a,s),c=a.stateNode,typeof c.componentWillUnmount=="function"&&PW(a,s,c)),sl(r,s,a);break;case 21:sl(r,s,a);break;case 22:vs=(c=vs)||a.memoizedState!==null,sl(r,s,a),vs=c;break;default:sl(r,s,a)}}function GW(r,s){if(s.memoizedState===null&&(r=s.alternate,r!==null&&(r=r.memoizedState,r!==null))){r=r.dehydrated;try{pf(r)}catch(a){nr(s,s.return,a)}}}function KW(r,s){if(s.memoizedState===null&&(r=s.alternate,r!==null&&(r=r.memoizedState,r!==null&&(r=r.dehydrated,r!==null))))try{pf(r)}catch(a){nr(s,s.return,a)}}function Ype(r){switch(r.tag){case 31:case 13:case 19:var s=r.stateNode;return s===null&&(s=r.stateNode=new e6),s;case 22:return r=r.stateNode,s=r._retryCache,s===null&&(s=r._retryCache=new e6),s;default:throw Error(Me(435,r.tag))}}function sy(r,s){var a=Ype(r);s.forEach(function(c){if(!a.has(c)){a.add(c);var A=nfe.bind(null,r,c);c.then(A,A)}})}function Ji(r,s){var a=s.deletions;if(a!==null)for(var c=0;c<a.length;c++){var A=a[c],u=r,m=s,E=m;e:for(;E!==null;){switch(E.tag){case 27:if(ZA(E.type)){Vr=E.stateNode,ea=!1;break e}break;case 5:Vr=E.stateNode,ea=!1;break e;case 3:case 4:Vr=E.stateNode.containerInfo,ea=!0;break e}E=E.return}if(Vr===null)throw Error(Me(160));HW(u,m,A),Vr=null,ea=!1,u=A.alternate,u!==null&&(u.return=null),A.return=null}if(s.subtreeFlags&13886)for(s=s.child;s!==null;)WW(s,r),s=s.sibling}var Zo=null;function WW(r,s){var a=r.alternate,c=r.flags;switch(r.tag){case 0:case 11:case 14:case 15:Ji(s,r),$i(r),c&4&&(zA(3,r,r.return),M_(3,r),zA(5,r,r.return));break;case 1:Ji(s,r),$i(r),c&512&&(vs||a===null||Bc(a,a.return)),c&64&&pl&&(r=r.updateQueue,r!==null&&(c=r.callbacks,c!==null&&(a=r.shared.hiddenCallbacks,r.shared.hiddenCallbacks=a===null?c:a.concat(c))));break;case 26:var A=Zo;if(Ji(s,r),$i(r),c&512&&(vs||a===null||Bc(a,a.return)),c&4){var u=a!==null?a.memoizedState:null;if(c=r.memoizedState,a===null)if(c===null)if(r.stateNode===null){e:{c=r.type,a=r.memoizedProps,A=A.ownerDocument||A;t:switch(c){case"title":u=A.getElementsByTagName("title")[0],(!u||u[k_]||u[ai]||u.namespaceURI==="http://www.w3.org/2000/svg"||u.hasAttribute("itemprop"))&&(u=A.createElement(c),A.head.insertBefore(u,A.querySelector("head > title"))),Ai(u,c,a),u[ai]=r,Gs(u),c=u;break e;case"link":var m=v6("link","href",A).get(c+(a.href||""));if(m){for(var E=0;E<m.length;E++)if(u=m[E],u.getAttribute("href")===(a.href==null||a.href===""?null:a.href)&&u.getAttribute("rel")===(a.rel==null?null:a.rel)&&u.getAttribute("title")===(a.title==null?null:a.title)&&u.getAttribute("crossorigin")===(a.crossOrigin==null?null:a.crossOrigin)){m.splice(E,1);break t}}u=A.createElement(c),Ai(u,c,a),A.head.appendChild(u);break;case"meta":if(m=v6("meta","content",A).get(c+(a.content||""))){for(E=0;E<m.length;E++)if(u=m[E],u.getAttribute("content")===(a.content==null?null:""+a.content)&&u.getAttribute("name")===(a.name==null?null:a.name)&&u.getAttribute("property")===(a.property==null?null:a.property)&&u.getAttribute("http-equiv")===(a.httpEquiv==null?null:a.httpEquiv)&&u.getAttribute("charset")===(a.charSet==null?null:a.charSet)){m.splice(E,1);break t}}u=A.createElement(c),Ai(u,c,a),A.head.appendChild(u);break;default:throw Error(Me(468,c))}u[ai]=r,Gs(u),c=u}r.stateNode=c}else y6(A,r.type,r.stateNode);else r.stateNode=E6(A,c,r.memoizedProps);else u!==c?(u===null?a.stateNode!==null&&(a=a.stateNode,a.parentNode.removeChild(a)):u.count--,c===null?y6(A,r.type,r.stateNode):E6(A,c,r.memoizedProps)):c===null&&r.stateNode!==null&&DN(r,r.memoizedProps,a.memoizedProps)}break;case 27:Ji(s,r),$i(r),c&512&&(vs||a===null||Bc(a,a.return)),a!==null&&c&4&&DN(r,r.memoizedProps,a.memoizedProps);break;case 5:if(Ji(s,r),$i(r),c&512&&(vs||a===null||Bc(a,a.return)),r.flags&32){A=r.stateNode;try{af(A,"")}catch(Q){nr(r,r.return,Q)}}c&4&&r.stateNode!=null&&(A=r.memoizedProps,DN(r,A,a!==null?a.memoizedProps:A)),c&1024&&(kN=!0);break;case 6:if(Ji(s,r),$i(r),c&4){if(r.stateNode===null)throw Error(Me(162));c=r.memoizedProps,a=r.stateNode;try{a.nodeValue=c}catch(Q){nr(r,r.return,Q)}}break;case 3:if(Zy=null,A=Zo,Zo=Ow(s.containerInfo),Ji(s,r),Zo=A,$i(r),c&4&&a!==null&&a.memoizedState.isDehydrated)try{pf(s.containerInfo)}catch(Q){nr(r,r.return,Q)}kN&&(kN=!1,YW(r));break;case 4:c=Zo,Zo=Ow(r.stateNode.containerInfo),Ji(s,r),$i(r),Zo=c;break;case 12:Ji(s,r),$i(r);break;case 31:Ji(s,r),$i(r),c&4&&(c=r.updateQueue,c!==null&&(r.updateQueue=null,sy(r,c)));break;case 13:Ji(s,r),$i(r),r.child.flags&8192&&r.memoizedState!==null!=(a!==null&&a.memoizedState!==null)&&(gb=xa()),c&4&&(c=r.updateQueue,c!==null&&(r.updateQueue=null,sy(r,c)));break;case 22:A=r.memoizedState!==null;var w=a!==null&&a.memoizedState!==null,C=pl,T=vs;if(pl=C||A,vs=T||w,Ji(s,r),vs=T,pl=C,$i(r),c&8192)e:for(s=r.stateNode,s._visibility=A?s._visibility&-2:s._visibility|1,A&&(a===null||w||pl||vs||uu(r)),a=null,s=r;;){if(s.tag===5||s.tag===26){if(a===null){w=a=s;try{if(u=w.stateNode,A)m=u.style,typeof m.setProperty=="function"?m.setProperty("display","none","important"):m.display="none";else{E=w.stateNode;var N=w.memoizedProps.style,B=N!=null&&N.hasOwnProperty("display")?N.display:null;E.style.display=B==null||typeof B=="boolean"?"":(""+B).trim()}}catch(Q){nr(w,w.return,Q)}}}else if(s.tag===6){if(a===null){w=s;try{w.stateNode.nodeValue=A?"":w.memoizedProps}catch(Q){nr(w,w.return,Q)}}}else if(s.tag===18){if(a===null){w=s;try{var k=w.stateNode;A?p6(k,!0):p6(w.stateNode,!1)}catch(Q){nr(w,w.return,Q)}}}else if((s.tag!==22&&s.tag!==23||s.memoizedState===null||s===r)&&s.child!==null){s.child.return=s,s=s.child;continue}if(s===r)break e;for(;s.sibling===null;){if(s.return===null||s.return===r)break e;a===s&&(a=null),s=s.return}a===s&&(a=null),s.sibling.return=s.return,s=s.sibling}c&4&&(c=r.updateQueue,c!==null&&(a=c.retryQueue,a!==null&&(c.retryQueue=null,sy(r,a))));break;case 19:Ji(s,r),$i(r),c&4&&(c=r.updateQueue,c!==null&&(r.updateQueue=null,sy(r,c)));break;case 30:break;case 21:break;default:Ji(s,r),$i(r)}}function $i(r){var s=r.flags;if(s&2){try{for(var a,c=r.return;c!==null;){if(FW(c)){a=c;break}c=c.return}if(a==null)throw Error(Me(160));switch(a.tag){case 27:var A=a.stateNode,u=BN(r);ww(r,u,A);break;case 5:var m=a.stateNode;a.flags&32&&(af(m,""),a.flags&=-33);var E=BN(r);ww(r,E,m);break;case 3:case 4:var w=a.stateNode.containerInfo,C=BN(r);ax(r,C,w);break;default:throw Error(Me(161))}}catch(T){nr(r,r.return,T)}r.flags&=-3}s&4096&&(r.flags&=-4097)}function YW(r){if(r.subtreeFlags&1024)for(r=r.child;r!==null;){var s=r;YW(s),s.tag===5&&s.flags&1024&&s.stateNode.reset(),r=r.sibling}}function il(r,s){if(s.subtreeFlags&8772)for(s=s.child;s!==null;)VW(r,s.alternate,s),s=s.sibling}function uu(r){for(r=r.child;r!==null;){var s=r;switch(s.tag){case 0:case 11:case 14:case 15:zA(4,s,s.return),uu(s);break;case 1:Bc(s,s.return);var a=s.stateNode;typeof a.componentWillUnmount=="function"&&PW(s,s.return,a),uu(s);break;case 27:qg(s.stateNode);case 26:case 5:Bc(s,s.return),uu(s);break;case 22:s.memoizedState===null&&uu(s);break;case 30:uu(s);break;default:uu(s)}r=r.sibling}}function Al(r,s,a){for(a=a&&(s.subtreeFlags&8772)!==0,s=s.child;s!==null;){var c=s.alternate,A=r,u=s,m=u.flags;switch(u.tag){case 0:case 11:case 15:Al(A,u,a),M_(4,u);break;case 1:if(Al(A,u,a),c=u,A=c.stateNode,typeof A.componentDidMount=="function")try{A.componentDidMount()}catch(C){nr(c,c.return,C)}if(c=u,A=c.updateQueue,A!==null){var E=c.stateNode;try{var w=A.shared.hiddenCallbacks;if(w!==null)for(A.shared.hiddenCallbacks=null,A=0;A<w.length;A++)G8(w[A],E)}catch(C){nr(c,c.return,C)}}a&&m&64&&UW(u),Kg(u,u.return);break;case 27:jW(u);case 26:case 5:Al(A,u,a),a&&c===null&&m&4&&MW(u),Kg(u,u.return);break;case 12:Al(A,u,a);break;case 31:Al(A,u,a),a&&m&4&&GW(A,u);break;case 13:Al(A,u,a),a&&m&4&&KW(A,u);break;case 22:u.memoizedState===null&&Al(A,u,a),Kg(u,u.return);break;case 30:break;default:Al(A,u,a)}s=s.sibling}}function XD(r,s){var a=null;r!==null&&r.memoizedState!==null&&r.memoizedState.cachePool!==null&&(a=r.memoizedState.cachePool.pool),r=null,s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(r=s.memoizedState.cachePool.pool),r!==a&&(r!=null&&r.refCount++,a!=null&&U_(a))}function JD(r,s){r=null,s.alternate!==null&&(r=s.alternate.memoizedState.cache),s=s.memoizedState.cache,s!==r&&(s.refCount++,r!=null&&U_(r))}function zo(r,s,a,c){if(s.subtreeFlags&10256)for(s=s.child;s!==null;)zW(r,s,a,c),s=s.sibling}function zW(r,s,a,c){var A=s.flags;switch(s.tag){case 0:case 11:case 15:zo(r,s,a,c),A&2048&&M_(9,s);break;case 1:zo(r,s,a,c);break;case 3:zo(r,s,a,c),A&2048&&(r=null,s.alternate!==null&&(r=s.alternate.memoizedState.cache),s=s.memoizedState.cache,s!==r&&(s.refCount++,r!=null&&U_(r)));break;case 12:if(A&2048){zo(r,s,a,c),r=s.stateNode;try{var u=s.memoizedProps,m=u.id,E=u.onPostCommit;typeof E=="function"&&E(m,s.alternate===null?"mount":"update",r.passiveEffectDuration,-0)}catch(w){nr(s,s.return,w)}}else zo(r,s,a,c);break;case 31:zo(r,s,a,c);break;case 13:zo(r,s,a,c);break;case 23:break;case 22:u=s.stateNode,m=s.alternate,s.memoizedState!==null?u._visibility&2?zo(r,s,a,c):Wg(r,s):u._visibility&2?zo(r,s,a,c):(u._visibility|=2,Tp(r,s,a,c,(s.subtreeFlags&10256)!==0||!1)),A&2048&&XD(m,s);break;case 24:zo(r,s,a,c),A&2048&&JD(s.alternate,s);break;default:zo(r,s,a,c)}}function Tp(r,s,a,c,A){for(A=A&&((s.subtreeFlags&10256)!==0||!1),s=s.child;s!==null;){var u=r,m=s,E=a,w=c,C=m.flags;switch(m.tag){case 0:case 11:case 15:Tp(u,m,E,w,A),M_(8,m);break;case 23:break;case 22:var T=m.stateNode;m.memoizedState!==null?T._visibility&2?Tp(u,m,E,w,A):Wg(u,m):(T._visibility|=2,Tp(u,m,E,w,A)),A&&C&2048&&XD(m.alternate,m);break;case 24:Tp(u,m,E,w,A),A&&C&2048&&JD(m.alternate,m);break;default:Tp(u,m,E,w,A)}s=s.sibling}}function Wg(r,s){if(s.subtreeFlags&10256)for(s=s.child;s!==null;){var a=r,c=s,A=c.flags;switch(c.tag){case 22:Wg(a,c),A&2048&&XD(c.alternate,c);break;case 24:Wg(a,c),A&2048&&JD(c.alternate,c);break;default:Wg(a,c)}s=s.sibling}}var Tg=8192;function up(r,s,a){if(r.subtreeFlags&Tg)for(r=r.child;r!==null;)qW(r,s,a),r=r.sibling}function qW(r,s,a){switch(r.tag){case 26:up(r,s,a),r.flags&Tg&&r.memoizedState!==null&&Bfe(a,Zo,r.memoizedState,r.memoizedProps);break;case 5:up(r,s,a);break;case 3:case 4:var c=Zo;Zo=Ow(r.stateNode.containerInfo),up(r,s,a),Zo=c;break;case 22:r.memoizedState===null&&(c=r.alternate,c!==null&&c.memoizedState!==null?(c=Tg,Tg=16777216,up(r,s,a),Tg=c):up(r,s,a));break;default:up(r,s,a)}}function XW(r){var s=r.alternate;if(s!==null&&(r=s.child,r!==null)){s.child=null;do s=r.sibling,r.sibling=null,r=s;while(r!==null)}}function ug(r){var s=r.deletions;if(r.flags&16){if(s!==null)for(var a=0;a<s.length;a++){var c=s[a];Hs=c,$W(c,r)}XW(r)}if(r.subtreeFlags&10256)for(r=r.child;r!==null;)JW(r),r=r.sibling}function JW(r){switch(r.tag){case 0:case 11:case 15:ug(r),r.flags&2048&&zA(9,r,r.return);break;case 3:ug(r);break;case 12:ug(r);break;case 22:var s=r.stateNode;r.memoizedState!==null&&s._visibility&2&&(r.return===null||r.return.tag!==13)?(s._visibility&=-3,Jy(r)):ug(r);break;default:ug(r)}}function Jy(r){var s=r.deletions;if(r.flags&16){if(s!==null)for(var a=0;a<s.length;a++){var c=s[a];Hs=c,$W(c,r)}XW(r)}for(r=r.child;r!==null;){switch(s=r,s.tag){case 0:case 11:case 15:zA(8,s,s.return),Jy(s);break;case 22:a=s.stateNode,a._visibility&2&&(a._visibility&=-3,Jy(s));break;default:Jy(s)}r=r.sibling}}function $W(r,s){for(;Hs!==null;){var a=Hs;switch(a.tag){case 0:case 11:case 15:zA(8,a,s);break;case 23:case 22:if(a.memoizedState!==null&&a.memoizedState.cachePool!==null){var c=a.memoizedState.cachePool.pool;c!=null&&c.refCount++}break;case 24:U_(a.memoizedState.cache)}if(c=a.child,c!==null)c.return=a,Hs=c;else e:for(a=r;Hs!==null;){c=Hs;var A=c.sibling,u=c.return;if(QW(c),c===a){Hs=null;break e}if(A!==null){A.return=u,Hs=A;break e}Hs=u}}}var zpe={getCacheForType:function(r){var s=ci(ys),a=s.data.get(r);return a===void 0&&(a=r(),s.data.set(r,a)),a},cacheSignal:function(){return ci(ys).controller.signal}},qpe=typeof WeakMap=="function"?WeakMap:Map,Vn=0,mr=null,Cn=null,Nn=0,Zn=0,Ca=null,IA=!1,bf=!1,$D=!1,Il=0,ns=0,qA=0,Tu=0,ZD=0,Oa=0,Af=0,Yg=null,ta=null,ox=!1,gb=0,ZW=0,bw=1/0,Sw=null,jA=null,xs=0,VA=null,df=null,yl=0,cx=0,lx=null,eY=null,zg=0,Ax=null;function ka(){return Vn&2&&Nn!==0?Nn&-Nn:Gt.T!==null?tB():l8()}function tY(){if(Oa===0)if(!(Nn&536870912)||Dn){var r=X0;X0<<=1,!(X0&3932160)&&(X0=262144),Oa=r}else Oa=536870912;return r=Ua.current,r!==null&&(r.flags|=32),Oa}function ra(r,s,a){(r===mr&&(Zn===2||Zn===9)||r.cancelPendingCommit!==null)&&(uf(r,0),NA(r,Nn,Oa,!1)),B_(r,a),(!(Vn&2)||r!==mr)&&(r===mr&&(!(Vn&2)&&(Tu|=a),ns===4&&NA(r,Nn,Oa,!1)),Pc(r))}function nY(r,s,a){if(Vn&6)throw Error(Me(327));var c=!a&&(s&127)===0&&(s&r.expiredLanes)===0||D_(r,s),A=c?$pe(r,s):LN(r,s,!0),u=c;do{if(A===0){bf&&!c&&NA(r,s,0,!1);break}else{if(a=r.current.alternate,u&&!Xpe(a)){A=LN(r,s,!1),u=!1;continue}if(A===2){if(u=s,r.errorRecoveryDisabledLanes&u)var m=0;else m=r.pendingLanes&-536870913,m=m!==0?m:m&536870912?536870912:0;if(m!==0){s=m;e:{var E=r;A=Yg;var w=E.current.memoizedState.isDehydrated;if(w&&(uf(E,m).flags|=256),m=LN(E,m,!1),m!==2){if($D&&!w){E.errorRecoveryDisabledLanes|=u,Tu|=u,A=4;break e}u=ta,ta=A,u!==null&&(ta===null?ta=u:ta.push.apply(ta,u))}A=m}if(u=!1,A!==2)continue}}if(A===1){uf(r,0),NA(r,s,0,!0);break}e:{switch(c=r,u=A,u){case 0:case 1:throw Error(Me(345));case 4:if((s&4194048)!==s)break;case 6:NA(c,s,Oa,!IA);break e;case 2:ta=null;break;case 3:case 5:break;default:throw Error(Me(329))}if((s&62914560)===s&&(A=gb+300-xa(),10<A)){if(NA(c,s,Oa,!IA),ab(c,0,!0)!==0)break e;yl=s,c.timeoutHandle=wY(t6.bind(null,c,a,ta,Sw,ox,s,Oa,Tu,Af,IA,u,"Throttled",-0,0),A);break e}t6(c,a,ta,Sw,ox,s,Oa,Tu,Af,IA,u,null,-0,0)}}break}while(!0);Pc(r)}function t6(r,s,a,c,A,u,m,E,w,C,T,N,B,k){if(r.timeoutHandle=-1,N=s.subtreeFlags,N&8192||(N&16785408)===16785408){N={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:ml},qW(s,u,N);var Q=(u&62914560)===u?gb-xa():(u&4194048)===u?ZW-xa():0;if(Q=kfe(N,Q),Q!==null){yl=u,r.cancelPendingCommit=Q(r6.bind(null,r,s,u,a,c,A,m,E,w,T,N,null,B,k)),NA(r,u,m,!C);return}}r6(r,s,u,a,c,A,m,E,w)}function Xpe(r){for(var s=r;;){var a=s.tag;if((a===0||a===11||a===15)&&s.flags&16384&&(a=s.updateQueue,a!==null&&(a=a.stores,a!==null)))for(var c=0;c<a.length;c++){var A=a[c],u=A.getSnapshot;A=A.value;try{if(!La(u(),A))return!1}catch{return!1}}if(a=s.child,s.subtreeFlags&16384&&a!==null)a.return=s,s=a;else{if(s===r)break;for(;s.sibling===null;){if(s.return===null||s.return===r)return!0;s=s.return}s.sibling.return=s.return,s=s.sibling}}return!0}function NA(r,s,a,c){s&=~ZD,s&=~Tu,r.suspendedLanes|=s,r.pingedLanes&=~s,c&&(r.warmLanes|=s),c=r.expirationTimes;for(var A=s;0<A;){var u=31-Ba(A),m=1<<u;c[u]=-1,A&=~m}a!==0&&a8(r,a,s)}function _b(){return Vn&6?!0:(F_(0),!1)}function eB(){if(Cn!==null){if(Zn===0)var r=Cn.return;else r=Cn,gl=Vu=null,FD(r),Xp=null,l_=0,r=Cn;for(;r!==null;)LW(r.alternate,r),r=r.return;Cn=null}}function uf(r,s){var a=r.timeoutHandle;a!==-1&&(r.timeoutHandle=-1,mfe(a)),a=r.cancelPendingCommit,a!==null&&(r.cancelPendingCommit=null,a()),yl=0,eB(),mr=r,Cn=a=El(r.current,null),Nn=s,Zn=0,Ca=null,IA=!1,bf=D_(r,s),$D=!1,Af=Oa=ZD=Tu=qA=ns=0,ta=Yg=null,ox=!1,s&8&&(s|=s&32);var c=r.entangledLanes;if(c!==0)for(r=r.entanglements,c&=s;0<c;){var A=31-Ba(c),u=1<<A;s|=r[A],c&=~u}return Il=s,Ab(),a}function rY(r,s){cn=null,Gt.H=d_,s===wf||s===ub?(s=B5(),Zn=3):s===DD?(s=B5(),Zn=4):Zn=s===zD?8:s!==null&&typeof s=="object"&&typeof s.then=="function"?6:1,Ca=s,Cn===null&&(ns=1,vw(r,go(s,r.current)))}function sY(){var r=Ua.current;return r===null?!0:(Nn&4194048)===Nn?yo===null:(Nn&62914560)===Nn||Nn&536870912?r===yo:!1}function iY(){var r=Gt.H;return Gt.H=d_,r===null?d_:r}function aY(){var r=Gt.A;return Gt.A=zpe,r}function Cw(){ns=4,IA||(Nn&4194048)!==Nn&&Ua.current!==null||(bf=!0),!(qA&134217727)&&!(Tu&134217727)||mr===null||NA(mr,Nn,Oa,!1)}function LN(r,s,a){var c=Vn;Vn|=2;var A=iY(),u=aY();(mr!==r||Nn!==s)&&(Sw=null,uf(r,s)),s=!1;var m=ns;e:do try{if(Zn!==0&&Cn!==null){var E=Cn,w=Ca;switch(Zn){case 8:eB(),m=6;break e;case 3:case 2:case 9:case 6:Ua.current===null&&(s=!0);var C=Zn;if(Zn=0,Ca=null,Kp(r,E,w,C),a&&bf){m=0;break e}break;default:C=Zn,Zn=0,Ca=null,Kp(r,E,w,C)}}Jpe(),m=ns;break}catch(T){rY(r,T)}while(!0);return s&&r.shellSuspendCounter++,gl=Vu=null,Vn=c,Gt.H=A,Gt.A=u,Cn===null&&(mr=null,Nn=0,Ab()),m}function Jpe(){for(;Cn!==null;)oY(Cn)}function $pe(r,s){var a=Vn;Vn|=2;var c=iY(),A=aY();mr!==r||Nn!==s?(Sw=null,bw=xa()+500,uf(r,s)):bf=D_(r,s);e:do try{if(Zn!==0&&Cn!==null){s=Cn;var u=Ca;t:switch(Zn){case 1:Zn=0,Ca=null,Kp(r,s,u,1);break;case 2:case 9:if(D5(u)){Zn=0,Ca=null,n6(s);break}s=function(){Zn!==2&&Zn!==9||mr!==r||(Zn=7),Pc(r)},u.then(s,s);break e;case 3:Zn=7;break e;case 4:Zn=5;break e;case 7:D5(u)?(Zn=0,Ca=null,n6(s)):(Zn=0,Ca=null,Kp(r,s,u,7));break;case 5:var m=null;switch(Cn.tag){case 26:m=Cn.memoizedState;case 5:case 27:var E=Cn;if(m?RY(m):E.stateNode.complete){Zn=0,Ca=null;var w=E.sibling;if(w!==null)Cn=w;else{var C=E.return;C!==null?(Cn=C,Eb(C)):Cn=null}break t}}Zn=0,Ca=null,Kp(r,s,u,5);break;case 6:Zn=0,Ca=null,Kp(r,s,u,6);break;case 8:eB(),ns=6;break e;default:throw Error(Me(462))}}Zpe();break}catch(T){rY(r,T)}while(!0);return gl=Vu=null,Gt.H=c,Gt.A=A,Vn=a,Cn!==null?0:(mr=null,Nn=0,Ab(),ns)}function Zpe(){for(;Cn!==null&&!whe();)oY(Cn)}function oY(r){var s=kW(r.alternate,r,Il);r.memoizedProps=r.pendingProps,s===null?Eb(r):Cn=s}function n6(r){var s=r,a=s.alternate;switch(s.tag){case 15:case 0:s=q5(a,s,s.pendingProps,s.type,void 0,Nn);break;case 11:s=q5(a,s,s.pendingProps,s.type.render,s.ref,Nn);break;case 5:FD(s);default:LW(a,s),s=Cn=L8(s,Il),s=kW(a,s,Il)}r.memoizedProps=r.pendingProps,s===null?Eb(r):Cn=s}function Kp(r,s,a,c){gl=Vu=null,FD(s),Xp=null,l_=0;var A=s.return;try{if(Vpe(r,A,s,a,Nn)){ns=1,vw(r,go(a,r.current)),Cn=null;return}}catch(u){if(A!==null)throw Cn=A,u;ns=1,vw(r,go(a,r.current)),Cn=null;return}s.flags&32768?(Dn||c===1?r=!0:bf||Nn&536870912?r=!1:(IA=r=!0,(c===2||c===9||c===3||c===6)&&(c=Ua.current,c!==null&&c.tag===13&&(c.flags|=16384))),cY(s,r)):Eb(s)}function Eb(r){var s=r;do{if(s.flags&32768){cY(s,IA);return}r=s.return;var a=Gpe(s.alternate,s,Il);if(a!==null){Cn=a;return}if(s=s.sibling,s!==null){Cn=s;return}Cn=s=r}while(s!==null);ns===0&&(ns=5)}function cY(r,s){do{var a=Kpe(r.alternate,r);if(a!==null){a.flags&=32767,Cn=a;return}if(a=r.return,a!==null&&(a.flags|=32768,a.subtreeFlags=0,a.deletions=null),!s&&(r=r.sibling,r!==null)){Cn=r;return}Cn=r=a}while(r!==null);ns=6,Cn=null}function r6(r,s,a,c,A,u,m,E,w){r.cancelPendingCommit=null;do vb();while(xs!==0);if(Vn&6)throw Error(Me(327));if(s!==null){if(s===r.current)throw Error(Me(177));if(u=s.lanes|s.childLanes,u|=CD,Dhe(r,a,u,m,E,w),r===mr&&(Cn=mr=null,Nn=0),df=s,VA=r,yl=a,cx=u,lx=A,eY=c,s.subtreeFlags&10256||s.flags&10256?(r.callbackNode=null,r.callbackPriority=0,rfe(lw,function(){return hY(),null})):(r.callbackNode=null,r.callbackPriority=0),c=(s.flags&13878)!==0,s.subtreeFlags&13878||c){c=Gt.T,Gt.T=null,A=Qn.p,Qn.p=2,m=Vn,Vn|=4;try{Wpe(r,s,a)}finally{Vn=m,Qn.p=A,Gt.T=c}}xs=1,lY(),AY(),dY()}}function lY(){if(xs===1){xs=0;var r=VA,s=df,a=(s.flags&13878)!==0;if(s.subtreeFlags&13878||a){a=Gt.T,Gt.T=null;var c=Qn.p;Qn.p=2;var A=Vn;Vn|=4;try{WW(s,r);var u=px,m=R8(r.containerInfo),E=u.focusedElem,w=u.selectionRange;if(m!==E&&E&&E.ownerDocument&&T8(E.ownerDocument.documentElement,E)){if(w!==null&&SD(E)){var C=w.start,T=w.end;if(T===void 0&&(T=C),"selectionStart"in E)E.selectionStart=C,E.selectionEnd=Math.min(T,E.value.length);else{var N=E.ownerDocument||document,B=N&&N.defaultView||window;if(B.getSelection){var k=B.getSelection(),Q=E.textContent.length,K=Math.min(w.start,Q),Y=w.end===void 0?K:Math.min(w.end,Q);!k.extend&&K>Y&&(m=Y,Y=K,K=m);var F=C5(E,K),M=C5(E,Y);if(F&&M&&(k.rangeCount!==1||k.anchorNode!==F.node||k.anchorOffset!==F.offset||k.focusNode!==M.node||k.focusOffset!==M.offset)){var V=N.createRange();V.setStart(F.node,F.offset),k.removeAllRanges(),K>Y?(k.addRange(V),k.extend(M.node,M.offset)):(V.setEnd(M.node,M.offset),k.addRange(V))}}}}for(N=[],k=E;k=k.parentNode;)k.nodeType===1&&N.push({element:k,left:k.scrollLeft,top:k.scrollTop});for(typeof E.focus=="function"&&E.focus(),E=0;E<N.length;E++){var W=N[E];W.element.scrollLeft=W.left,W.element.scrollTop=W.top}}Bw=!!hx,px=hx=null}finally{Vn=A,Qn.p=c,Gt.T=a}}r.current=s,xs=2}}function AY(){if(xs===2){xs=0;var r=VA,s=df,a=(s.flags&8772)!==0;if(s.subtreeFlags&8772||a){a=Gt.T,Gt.T=null;var c=Qn.p;Qn.p=2;var A=Vn;Vn|=4;try{VW(r,s.alternate,s)}finally{Vn=A,Qn.p=c,Gt.T=a}}xs=3}}function dY(){if(xs===4||xs===3){xs=0,bhe();var r=VA,s=df,a=yl,c=eY;s.subtreeFlags&10256||s.flags&10256?xs=5:(xs=0,df=VA=null,uY(r,r.pendingLanes));var A=r.pendingLanes;if(A===0&&(jA=null),gD(a),s=s.stateNode,Da&&typeof Da.onCommitFiberRoot=="function")try{Da.onCommitFiberRoot(x_,s,void 0,(s.current.flags&128)===128)}catch{}if(c!==null){s=Gt.T,A=Qn.p,Qn.p=2,Gt.T=null;try{for(var u=r.onRecoverableError,m=0;m<c.length;m++){var E=c[m];u(E.value,{componentStack:E.stack})}}finally{Gt.T=s,Qn.p=A}}yl&3&&vb(),Pc(r),A=r.pendingLanes,a&261930&&A&42?r===Ax?zg++:(zg=0,Ax=r):zg=0,F_(0)}}function uY(r,s){(r.pooledCacheLanes&=s)===0&&(s=r.pooledCache,s!=null&&(r.pooledCache=null,U_(s)))}function vb(){return lY(),AY(),dY(),hY()}function hY(){if(xs!==5)return!1;var r=VA,s=cx;cx=0;var a=gD(yl),c=Gt.T,A=Qn.p;try{Qn.p=32>a?32:a,Gt.T=null,a=lx,lx=null;var u=VA,m=yl;if(xs=0,df=VA=null,yl=0,Vn&6)throw Error(Me(331));var E=Vn;if(Vn|=4,JW(u.current),zW(u,u.current,m,a),Vn=E,F_(0,!1),Da&&typeof Da.onPostCommitFiberRoot=="function")try{Da.onPostCommitFiberRoot(x_,u)}catch{}return!0}finally{Qn.p=A,Gt.T=c,uY(r,s)}}function s6(r,s,a){s=go(a,s),s=rx(r.stateNode,s,2),r=FA(r,s,2),r!==null&&(B_(r,2),Pc(r))}function nr(r,s,a){if(r.tag===3)s6(r,r,a);else for(;s!==null;){if(s.tag===3){s6(s,r,a);break}else if(s.tag===1){var c=s.stateNode;if(typeof s.type.getDerivedStateFromError=="function"||typeof c.componentDidCatch=="function"&&(jA===null||!jA.has(c))){r=go(a,r),a=IW(2),c=FA(s,a,2),c!==null&&(NW(a,c,s,r),B_(c,2),Pc(c));break}}s=s.return}}function UN(r,s,a){var c=r.pingCache;if(c===null){c=r.pingCache=new qpe;var A=new Set;c.set(s,A)}else A=c.get(s),A===void 0&&(A=new Set,c.set(s,A));A.has(a)||($D=!0,A.add(a),r=efe.bind(null,r,s,a),s.then(r,r))}function efe(r,s,a){var c=r.pingCache;c!==null&&c.delete(s),r.pingedLanes|=r.suspendedLanes&a,r.warmLanes&=~a,mr===r&&(Nn&a)===a&&(ns===4||ns===3&&(Nn&62914560)===Nn&&300>xa()-gb?!(Vn&2)&&uf(r,0):ZD|=a,Af===Nn&&(Af=0)),Pc(r)}function pY(r,s){s===0&&(s=i8()),r=ju(r,s),r!==null&&(B_(r,s),Pc(r))}function tfe(r){var s=r.memoizedState,a=0;s!==null&&(a=s.retryLane),pY(r,a)}function nfe(r,s){var a=0;switch(r.tag){case 31:case 13:var c=r.stateNode,A=r.memoizedState;A!==null&&(a=A.retryLane);break;case 19:c=r.stateNode;break;case 22:c=r.stateNode._retryCache;break;default:throw Error(Me(314))}c!==null&&c.delete(s),pY(r,a)}function rfe(r,s){return fD(r,s)}var Tw=null,Rp=null,dx=!1,Rw=!1,PN=!1,OA=0;function Pc(r){r!==Rp&&r.next===null&&(Rp===null?Tw=Rp=r:Rp=Rp.next=r),Rw=!0,dx||(dx=!0,ife())}function F_(r,s){if(!PN&&Rw){PN=!0;do for(var a=!1,c=Tw;c!==null;){if(r!==0){var A=c.pendingLanes;if(A===0)var u=0;else{var m=c.suspendedLanes,E=c.pingedLanes;u=(1<<31-Ba(42|r)+1)-1,u&=A&~(m&~E),u=u&201326741?u&201326741|1:u?u|2:0}u!==0&&(a=!0,i6(c,u))}else u=Nn,u=ab(c,c===mr?u:0,c.cancelPendingCommit!==null||c.timeoutHandle!==-1),!(u&3)||D_(c,u)||(a=!0,i6(c,u));c=c.next}while(a);PN=!1}}function sfe(){fY()}function fY(){Rw=dx=!1;var r=0;OA!==0&&ffe()&&(r=OA);for(var s=xa(),a=null,c=Tw;c!==null;){var A=c.next,u=mY(c,s);u===0?(c.next=null,a===null?Tw=A:a.next=A,A===null&&(Rp=a)):(a=c,(r!==0||u&3)&&(Rw=!0)),c=A}xs!==0&&xs!==5||F_(r),OA!==0&&(OA=0)}function mY(r,s){for(var a=r.suspendedLanes,c=r.pingedLanes,A=r.expirationTimes,u=r.pendingLanes&-62914561;0<u;){var m=31-Ba(u),E=1<<m,w=A[m];w===-1?(!(E&a)||E&c)&&(A[m]=xhe(E,s)):w<=s&&(r.expiredLanes|=E),u&=~E}if(s=mr,a=Nn,a=ab(r,r===s?a:0,r.cancelPendingCommit!==null||r.timeoutHandle!==-1),c=r.callbackNode,a===0||r===s&&(Zn===2||Zn===9)||r.cancelPendingCommit!==null)return c!==null&&c!==null&&dN(c),r.callbackNode=null,r.callbackPriority=0;if(!(a&3)||D_(r,a)){if(s=a&-a,s===r.callbackPriority)return s;switch(c!==null&&dN(c),gD(a)){case 2:case 8:a=r8;break;case 32:a=lw;break;case 268435456:a=s8;break;default:a=lw}return c=gY.bind(null,r),a=fD(a,c),r.callbackPriority=s,r.callbackNode=a,s}return c!==null&&c!==null&&dN(c),r.callbackPriority=2,r.callbackNode=null,2}function gY(r,s){if(xs!==0&&xs!==5)return r.callbackNode=null,r.callbackPriority=0,null;var a=r.callbackNode;if(vb()&&r.callbackNode!==a)return null;var c=Nn;return c=ab(r,r===mr?c:0,r.cancelPendingCommit!==null||r.timeoutHandle!==-1),c===0?null:(nY(r,c,s),mY(r,xa()),r.callbackNode!=null&&r.callbackNode===a?gY.bind(null,r):null)}function i6(r,s){if(vb())return null;nY(r,s,!0)}function ife(){gfe(function(){Vn&6?fD(n8,sfe):fY()})}function tB(){if(OA===0){var r=of;r===0&&(r=q0,q0<<=1,!(q0&261888)&&(q0=256)),OA=r}return OA}function a6(r){return r==null||typeof r=="symbol"||typeof r=="boolean"?null:typeof r=="function"?r:Qy(""+r)}function o6(r,s){var a=s.ownerDocument.createElement("input");return a.name=s.name,a.value=s.value,r.id&&a.setAttribute("form",r.id),s.parentNode.insertBefore(a,s),r=new FormData(r),a.parentNode.removeChild(a),r}function afe(r,s,a,c,A){if(s==="submit"&&a&&a.stateNode===A){var u=a6((A[sa]||null).action),m=c.submitter;m&&(s=(s=m[sa]||null)?a6(s.formAction):m.getAttribute("formAction"),s!==null&&(u=s,m=null));var E=new ob("action","action",null,c,A);r.push({event:E,listeners:[{instance:null,listener:function(){if(c.defaultPrevented){if(OA!==0){var w=m?o6(A,m):new FormData(A);tx(a,{pending:!0,data:w,method:A.method,action:u},null,w)}}else typeof u=="function"&&(E.preventDefault(),w=m?o6(A,m):new FormData(A),tx(a,{pending:!0,data:w,method:A.method,action:u},u,w))},currentTarget:A}]})}}for(var MN=0;MN<HO.length;MN++){var FN=HO[MN],ofe=FN.toLowerCase(),cfe=FN[0].toUpperCase()+FN.slice(1);tc(ofe,"on"+cfe)}tc(N8,"onAnimationEnd");tc(O8,"onAnimationIteration");tc(x8,"onAnimationStart");tc("dblclick","onDoubleClick");tc("focusin","onFocus");tc("focusout","onBlur");tc(Spe,"onTransitionRun");tc(Cpe,"onTransitionStart");tc(Tpe,"onTransitionCancel");tc(D8,"onTransitionEnd");sf("onMouseEnter",["mouseout","mouseover"]);sf("onMouseLeave",["mouseout","mouseover"]);sf("onPointerEnter",["pointerout","pointerover"]);sf("onPointerLeave",["pointerout","pointerover"]);Pu("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Pu("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Pu("onBeforeInput",["compositionend","keypress","textInput","paste"]);Pu("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Pu("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Pu("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var u_="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),lfe=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(u_));function _Y(r,s){s=(s&4)!==0;for(var a=0;a<r.length;a++){var c=r[a],A=c.event;c=c.listeners;e:{var u=void 0;if(s)for(var m=c.length-1;0<=m;m--){var E=c[m],w=E.instance,C=E.currentTarget;if(E=E.listener,w!==u&&A.isPropagationStopped())break e;u=E,A.currentTarget=C;try{u(A)}catch(T){dw(T)}A.currentTarget=null,u=w}else for(m=0;m<c.length;m++){if(E=c[m],w=E.instance,C=E.currentTarget,E=E.listener,w!==u&&A.isPropagationStopped())break e;u=E,A.currentTarget=C;try{u(A)}catch(T){dw(T)}A.currentTarget=null,u=w}}}}function Sn(r,s){var a=s[LO];a===void 0&&(a=s[LO]=new Set);var c=r+"__bubble";a.has(c)||(EY(s,r,2,!1),a.add(c))}function jN(r,s,a){var c=0;s&&(c|=4),EY(a,r,c,s)}var iy="_reactListening"+Math.random().toString(36).slice(2);function nB(r){if(!r[iy]){r[iy]=!0,A8.forEach(function(a){a!=="selectionchange"&&(lfe.has(a)||jN(a,!1,r),jN(a,!0,r))});var s=r.nodeType===9?r:r.ownerDocument;s===null||s[iy]||(s[iy]=!0,jN("selectionchange",!1,s))}}function EY(r,s,a,c){switch(DY(s)){case 2:var A=Pfe;break;case 8:A=Mfe;break;default:A=aB}a=A.bind(null,s,a,r),A=void 0,!jO||s!=="touchstart"&&s!=="touchmove"&&s!=="wheel"||(A=!0),c?A!==void 0?r.addEventListener(s,a,{capture:!0,passive:A}):r.addEventListener(s,a,!0):A!==void 0?r.addEventListener(s,a,{passive:A}):r.addEventListener(s,a,!1)}function VN(r,s,a,c,A){var u=c;if(!(s&1)&&!(s&2)&&c!==null)e:for(;;){if(c===null)return;var m=c.tag;if(m===3||m===4){var E=c.stateNode.containerInfo;if(E===A)break;if(m===4)for(m=c.return;m!==null;){var w=m.tag;if((w===3||w===4)&&m.stateNode.containerInfo===A)return;m=m.return}for(;E!==null;){if(m=Up(E),m===null)return;if(w=m.tag,w===5||w===6||w===26||w===27){c=u=m;continue e}E=E.parentNode}}c=c.return}_8(function(){var C=u,T=vD(a),N=[];e:{var B=B8.get(r);if(B!==void 0){var k=ob,Q=r;switch(r){case"keypress":if(Gy(a)===0)break e;case"keydown":case"keyup":k=npe;break;case"focusin":Q="focus",k=mN;break;case"focusout":Q="blur",k=mN;break;case"beforeblur":case"afterblur":k=mN;break;case"click":if(a.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":k=f5;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":k=Ghe;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":k=ipe;break;case N8:case O8:case x8:k=Yhe;break;case D8:k=ope;break;case"scroll":case"scrollend":k=Qhe;break;case"wheel":k=lpe;break;case"copy":case"cut":case"paste":k=qhe;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":k=g5;break;case"toggle":case"beforetoggle":k=dpe}var K=(s&4)!==0,Y=!K&&(r==="scroll"||r==="scrollend"),F=K?B!==null?B+"Capture":null:B;K=[];for(var M=C,V;M!==null;){var W=M;if(V=W.stateNode,W=W.tag,W!==5&&W!==26&&W!==27||V===null||F===null||(W=s_(M,F),W!=null&&K.push(h_(M,W,V))),Y)break;M=M.return}0<K.length&&(B=new k(B,Q,null,a,T),N.push({event:B,listeners:K}))}}if(!(s&7)){e:{if(B=r==="mouseover"||r==="pointerover",k=r==="mouseout"||r==="pointerout",B&&a!==FO&&(Q=a.relatedTarget||a.fromElement)&&(Up(Q)||Q[Ef]))break e;if((k||B)&&(B=T.window===T?T:(B=T.ownerDocument)?B.defaultView||B.parentWindow:window,k?(Q=a.relatedTarget||a.toElement,k=C,Q=Q?Up(Q):null,Q!==null&&(Y=O_(Q),K=Q.tag,Q!==Y||K!==5&&K!==27&&K!==6)&&(Q=null)):(k=null,Q=C),k!==Q)){if(K=f5,W="onMouseLeave",F="onMouseEnter",M="mouse",(r==="pointerout"||r==="pointerover")&&(K=g5,W="onPointerLeave",F="onPointerEnter",M="pointer"),Y=k==null?B:Sg(k),V=Q==null?B:Sg(Q),B=new K(W,M+"leave",k,a,T),B.target=Y,B.relatedTarget=V,W=null,Up(T)===C&&(K=new K(F,M+"enter",Q,a,T),K.target=V,K.relatedTarget=Y,W=K),Y=W,k&&Q)t:{for(K=Afe,F=k,M=Q,V=0,W=F;W;W=K(W))V++;W=0;for(var q=M;q;q=K(q))W++;for(;0<V-W;)F=K(F),V--;for(;0<W-V;)M=K(M),W--;for(;V--;){if(F===M||M!==null&&F===M.alternate){K=F;break t}F=K(F),M=K(M)}K=null}else K=null;k!==null&&c6(N,B,k,K,!1),Q!==null&&Y!==null&&c6(N,Y,Q,K,!0)}}e:{if(B=C?Sg(C):window,k=B.nodeName&&B.nodeName.toLowerCase(),k==="select"||k==="input"&&B.type==="file")var te=y5;else if(v5(B))if(S8)te=ype;else{te=Epe;var re=_pe}else k=B.nodeName,!k||k.toLowerCase()!=="input"||B.type!=="checkbox"&&B.type!=="radio"?C&&ED(C.elementType)&&(te=y5):te=vpe;if(te&&(te=te(r,C))){b8(N,te,a,T);break e}re&&re(r,B,C),r==="focusout"&&C&&B.type==="number"&&C.memoizedProps.value!=null&&MO(B,"number",B.value)}switch(re=C?Sg(C):window,r){case"focusin":(v5(re)||re.contentEditable==="true")&&(Fp=re,VO=C,Fg=null);break;case"focusout":Fg=VO=Fp=null;break;case"mousedown":QO=!0;break;case"contextmenu":case"mouseup":case"dragend":QO=!1,T5(N,a,T);break;case"selectionchange":if(bpe)break;case"keydown":case"keyup":T5(N,a,T)}var de;if(bD)e:{switch(r){case"compositionstart":var ce="onCompositionStart";break e;case"compositionend":ce="onCompositionEnd";break e;case"compositionupdate":ce="onCompositionUpdate";break e}ce=void 0}else Mp?y8(r,a)&&(ce="onCompositionEnd"):r==="keydown"&&a.keyCode===229&&(ce="onCompositionStart");ce&&(v8&&a.locale!=="ko"&&(Mp||ce!=="onCompositionStart"?ce==="onCompositionEnd"&&Mp&&(de=E8()):(RA=T,yD="value"in RA?RA.value:RA.textContent,Mp=!0)),re=Iw(C,ce),0<re.length&&(ce=new m5(ce,r,null,a,T),N.push({event:ce,listeners:re}),de?ce.data=de:(de=w8(a),de!==null&&(ce.data=de)))),(de=hpe?ppe(r,a):fpe(r,a))&&(ce=Iw(C,"onBeforeInput"),0<ce.length&&(re=new m5("onBeforeInput","beforeinput",null,a,T),N.push({event:re,listeners:ce}),re.data=de)),afe(N,r,C,a,T)}_Y(N,s)})}function h_(r,s,a){return{instance:r,listener:s,currentTarget:a}}function Iw(r,s){for(var a=s+"Capture",c=[];r!==null;){var A=r,u=A.stateNode;if(A=A.tag,A!==5&&A!==26&&A!==27||u===null||(A=s_(r,a),A!=null&&c.unshift(h_(r,A,u)),A=s_(r,s),A!=null&&c.push(h_(r,A,u))),r.tag===3)return c;r=r.return}return[]}function Afe(r){if(r===null)return null;do r=r.return;while(r&&r.tag!==5&&r.tag!==27);return r||null}function c6(r,s,a,c,A){for(var u=s._reactName,m=[];a!==null&&a!==c;){var E=a,w=E.alternate,C=E.stateNode;if(E=E.tag,w!==null&&w===c)break;E!==5&&E!==26&&E!==27||C===null||(w=C,A?(C=s_(a,u),C!=null&&m.unshift(h_(a,C,w))):A||(C=s_(a,u),C!=null&&m.push(h_(a,C,w)))),a=a.return}m.length!==0&&r.push({event:s,listeners:m})}var dfe=/\r\n?/g,ufe=/\u0000|\uFFFD/g;function l6(r){return(typeof r=="string"?r:""+r).replace(dfe,`
`).replace(ufe,"")}function vY(r,s){return s=l6(s),l6(r)===s}function cr(r,s,a,c,A,u){switch(a){case"children":typeof c=="string"?s==="body"||s==="textarea"&&c===""||af(r,c):(typeof c=="number"||typeof c=="bigint")&&s!=="body"&&af(r,""+c);break;case"className":$0(r,"class",c);break;case"tabIndex":$0(r,"tabindex",c);break;case"dir":case"role":case"viewBox":case"width":case"height":$0(r,a,c);break;case"style":g8(r,c,u);break;case"data":if(s!=="object"){$0(r,"data",c);break}case"src":case"href":if(c===""&&(s!=="a"||a!=="href")){r.removeAttribute(a);break}if(c==null||typeof c=="function"||typeof c=="symbol"||typeof c=="boolean"){r.removeAttribute(a);break}c=Qy(""+c),r.setAttribute(a,c);break;case"action":case"formAction":if(typeof c=="function"){r.setAttribute(a,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof u=="function"&&(a==="formAction"?(s!=="input"&&cr(r,s,"name",A.name,A,null),cr(r,s,"formEncType",A.formEncType,A,null),cr(r,s,"formMethod",A.formMethod,A,null),cr(r,s,"formTarget",A.formTarget,A,null)):(cr(r,s,"encType",A.encType,A,null),cr(r,s,"method",A.method,A,null),cr(r,s,"target",A.target,A,null)));if(c==null||typeof c=="symbol"||typeof c=="boolean"){r.removeAttribute(a);break}c=Qy(""+c),r.setAttribute(a,c);break;case"onClick":c!=null&&(r.onclick=ml);break;case"onScroll":c!=null&&Sn("scroll",r);break;case"onScrollEnd":c!=null&&Sn("scrollend",r);break;case"dangerouslySetInnerHTML":if(c!=null){if(typeof c!="object"||!("__html"in c))throw Error(Me(61));if(a=c.__html,a!=null){if(A.children!=null)throw Error(Me(60));r.innerHTML=a}}break;case"multiple":r.multiple=c&&typeof c!="function"&&typeof c!="symbol";break;case"muted":r.muted=c&&typeof c!="function"&&typeof c!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(c==null||typeof c=="function"||typeof c=="boolean"||typeof c=="symbol"){r.removeAttribute("xlink:href");break}a=Qy(""+c),r.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",a);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":c!=null&&typeof c!="function"&&typeof c!="symbol"?r.setAttribute(a,""+c):r.removeAttribute(a);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":c&&typeof c!="function"&&typeof c!="symbol"?r.setAttribute(a,""):r.removeAttribute(a);break;case"capture":case"download":c===!0?r.setAttribute(a,""):c!==!1&&c!=null&&typeof c!="function"&&typeof c!="symbol"?r.setAttribute(a,c):r.removeAttribute(a);break;case"cols":case"rows":case"size":case"span":c!=null&&typeof c!="function"&&typeof c!="symbol"&&!isNaN(c)&&1<=c?r.setAttribute(a,c):r.removeAttribute(a);break;case"rowSpan":case"start":c==null||typeof c=="function"||typeof c=="symbol"||isNaN(c)?r.removeAttribute(a):r.setAttribute(a,c);break;case"popover":Sn("beforetoggle",r),Sn("toggle",r),Vy(r,"popover",c);break;case"xlinkActuate":nl(r,"http://www.w3.org/1999/xlink","xlink:actuate",c);break;case"xlinkArcrole":nl(r,"http://www.w3.org/1999/xlink","xlink:arcrole",c);break;case"xlinkRole":nl(r,"http://www.w3.org/1999/xlink","xlink:role",c);break;case"xlinkShow":nl(r,"http://www.w3.org/1999/xlink","xlink:show",c);break;case"xlinkTitle":nl(r,"http://www.w3.org/1999/xlink","xlink:title",c);break;case"xlinkType":nl(r,"http://www.w3.org/1999/xlink","xlink:type",c);break;case"xmlBase":nl(r,"http://www.w3.org/XML/1998/namespace","xml:base",c);break;case"xmlLang":nl(r,"http://www.w3.org/XML/1998/namespace","xml:lang",c);break;case"xmlSpace":nl(r,"http://www.w3.org/XML/1998/namespace","xml:space",c);break;case"is":Vy(r,"is",c);break;case"innerText":case"textContent":break;default:(!(2<a.length)||a[0]!=="o"&&a[0]!=="O"||a[1]!=="n"&&a[1]!=="N")&&(a=jhe.get(a)||a,Vy(r,a,c))}}function ux(r,s,a,c,A,u){switch(a){case"style":g8(r,c,u);break;case"dangerouslySetInnerHTML":if(c!=null){if(typeof c!="object"||!("__html"in c))throw Error(Me(61));if(a=c.__html,a!=null){if(A.children!=null)throw Error(Me(60));r.innerHTML=a}}break;case"children":typeof c=="string"?af(r,c):(typeof c=="number"||typeof c=="bigint")&&af(r,""+c);break;case"onScroll":c!=null&&Sn("scroll",r);break;case"onScrollEnd":c!=null&&Sn("scrollend",r);break;case"onClick":c!=null&&(r.onclick=ml);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!d8.hasOwnProperty(a))e:{if(a[0]==="o"&&a[1]==="n"&&(A=a.endsWith("Capture"),s=a.slice(2,A?a.length-7:void 0),u=r[sa]||null,u=u!=null?u[a]:null,typeof u=="function"&&r.removeEventListener(s,u,A),typeof c=="function")){typeof u!="function"&&u!==null&&(a in r?r[a]=null:r.hasAttribute(a)&&r.removeAttribute(a)),r.addEventListener(s,c,A);break e}a in r?r[a]=c:c===!0?r.setAttribute(a,""):Vy(r,a,c)}}}function Ai(r,s,a){switch(s){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Sn("error",r),Sn("load",r);var c=!1,A=!1,u;for(u in a)if(a.hasOwnProperty(u)){var m=a[u];if(m!=null)switch(u){case"src":c=!0;break;case"srcSet":A=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(Me(137,s));default:cr(r,s,u,m,a,null)}}A&&cr(r,s,"srcSet",a.srcSet,a,null),c&&cr(r,s,"src",a.src,a,null);return;case"input":Sn("invalid",r);var E=u=m=A=null,w=null,C=null;for(c in a)if(a.hasOwnProperty(c)){var T=a[c];if(T!=null)switch(c){case"name":A=T;break;case"type":m=T;break;case"checked":w=T;break;case"defaultChecked":C=T;break;case"value":u=T;break;case"defaultValue":E=T;break;case"children":case"dangerouslySetInnerHTML":if(T!=null)throw Error(Me(137,s));break;default:cr(r,s,c,T,a,null)}}p8(r,u,E,w,C,m,A,!1);return;case"select":Sn("invalid",r),c=m=u=null;for(A in a)if(a.hasOwnProperty(A)&&(E=a[A],E!=null))switch(A){case"value":u=E;break;case"defaultValue":m=E;break;case"multiple":c=E;default:cr(r,s,A,E,a,null)}s=u,a=m,r.multiple=!!c,s!=null?Yp(r,!!c,s,!1):a!=null&&Yp(r,!!c,a,!0);return;case"textarea":Sn("invalid",r),u=A=c=null;for(m in a)if(a.hasOwnProperty(m)&&(E=a[m],E!=null))switch(m){case"value":c=E;break;case"defaultValue":A=E;break;case"children":u=E;break;case"dangerouslySetInnerHTML":if(E!=null)throw Error(Me(91));break;default:cr(r,s,m,E,a,null)}m8(r,c,A,u);return;case"option":for(w in a)if(a.hasOwnProperty(w)&&(c=a[w],c!=null))switch(w){case"selected":r.selected=c&&typeof c!="function"&&typeof c!="symbol";break;default:cr(r,s,w,c,a,null)}return;case"dialog":Sn("beforetoggle",r),Sn("toggle",r),Sn("cancel",r),Sn("close",r);break;case"iframe":case"object":Sn("load",r);break;case"video":case"audio":for(c=0;c<u_.length;c++)Sn(u_[c],r);break;case"image":Sn("error",r),Sn("load",r);break;case"details":Sn("toggle",r);break;case"embed":case"source":case"link":Sn("error",r),Sn("load",r);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(C in a)if(a.hasOwnProperty(C)&&(c=a[C],c!=null))switch(C){case"children":case"dangerouslySetInnerHTML":throw Error(Me(137,s));default:cr(r,s,C,c,a,null)}return;default:if(ED(s)){for(T in a)a.hasOwnProperty(T)&&(c=a[T],c!==void 0&&ux(r,s,T,c,a,void 0));return}}for(E in a)a.hasOwnProperty(E)&&(c=a[E],c!=null&&cr(r,s,E,c,a,null))}function hfe(r,s,a,c){switch(s){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var A=null,u=null,m=null,E=null,w=null,C=null,T=null;for(k in a){var N=a[k];if(a.hasOwnProperty(k)&&N!=null)switch(k){case"checked":break;case"value":break;case"defaultValue":w=N;default:c.hasOwnProperty(k)||cr(r,s,k,null,c,N)}}for(var B in c){var k=c[B];if(N=a[B],c.hasOwnProperty(B)&&(k!=null||N!=null))switch(B){case"type":u=k;break;case"name":A=k;break;case"checked":C=k;break;case"defaultChecked":T=k;break;case"value":m=k;break;case"defaultValue":E=k;break;case"children":case"dangerouslySetInnerHTML":if(k!=null)throw Error(Me(137,s));break;default:k!==N&&cr(r,s,B,k,c,N)}}PO(r,m,E,w,C,T,u,A);return;case"select":k=m=E=B=null;for(u in a)if(w=a[u],a.hasOwnProperty(u)&&w!=null)switch(u){case"value":break;case"multiple":k=w;default:c.hasOwnProperty(u)||cr(r,s,u,null,c,w)}for(A in c)if(u=c[A],w=a[A],c.hasOwnProperty(A)&&(u!=null||w!=null))switch(A){case"value":B=u;break;case"defaultValue":E=u;break;case"multiple":m=u;default:u!==w&&cr(r,s,A,u,c,w)}s=E,a=m,c=k,B!=null?Yp(r,!!a,B,!1):!!c!=!!a&&(s!=null?Yp(r,!!a,s,!0):Yp(r,!!a,a?[]:"",!1));return;case"textarea":k=B=null;for(E in a)if(A=a[E],a.hasOwnProperty(E)&&A!=null&&!c.hasOwnProperty(E))switch(E){case"value":break;case"children":break;default:cr(r,s,E,null,c,A)}for(m in c)if(A=c[m],u=a[m],c.hasOwnProperty(m)&&(A!=null||u!=null))switch(m){case"value":B=A;break;case"defaultValue":k=A;break;case"children":break;case"dangerouslySetInnerHTML":if(A!=null)throw Error(Me(91));break;default:A!==u&&cr(r,s,m,A,c,u)}f8(r,B,k);return;case"option":for(var Q in a)if(B=a[Q],a.hasOwnProperty(Q)&&B!=null&&!c.hasOwnProperty(Q))switch(Q){case"selected":r.selected=!1;break;default:cr(r,s,Q,null,c,B)}for(w in c)if(B=c[w],k=a[w],c.hasOwnProperty(w)&&B!==k&&(B!=null||k!=null))switch(w){case"selected":r.selected=B&&typeof B!="function"&&typeof B!="symbol";break;default:cr(r,s,w,B,c,k)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var K in a)B=a[K],a.hasOwnProperty(K)&&B!=null&&!c.hasOwnProperty(K)&&cr(r,s,K,null,c,B);for(C in c)if(B=c[C],k=a[C],c.hasOwnProperty(C)&&B!==k&&(B!=null||k!=null))switch(C){case"children":case"dangerouslySetInnerHTML":if(B!=null)throw Error(Me(137,s));break;default:cr(r,s,C,B,c,k)}return;default:if(ED(s)){for(var Y in a)B=a[Y],a.hasOwnProperty(Y)&&B!==void 0&&!c.hasOwnProperty(Y)&&ux(r,s,Y,void 0,c,B);for(T in c)B=c[T],k=a[T],!c.hasOwnProperty(T)||B===k||B===void 0&&k===void 0||ux(r,s,T,B,c,k);return}}for(var F in a)B=a[F],a.hasOwnProperty(F)&&B!=null&&!c.hasOwnProperty(F)&&cr(r,s,F,null,c,B);for(N in c)B=c[N],k=a[N],!c.hasOwnProperty(N)||B===k||B==null&&k==null||cr(r,s,N,B,c,k)}function A6(r){switch(r){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function pfe(){if(typeof performance.getEntriesByType=="function"){for(var r=0,s=0,a=performance.getEntriesByType("resource"),c=0;c<a.length;c++){var A=a[c],u=A.transferSize,m=A.initiatorType,E=A.duration;if(u&&E&&A6(m)){for(m=0,E=A.responseEnd,c+=1;c<a.length;c++){var w=a[c],C=w.startTime;if(C>E)break;var T=w.transferSize,N=w.initiatorType;T&&A6(N)&&(w=w.responseEnd,m+=T*(w<E?1:(E-C)/(w-C)))}if(--c,s+=8*(u+m)/(A.duration/1e3),r++,10<r)break}}if(0<r)return s/r/1e6}return navigator.connection&&(r=navigator.connection.downlink,typeof r=="number")?r:5}var hx=null,px=null;function Nw(r){return r.nodeType===9?r:r.ownerDocument}function d6(r){switch(r){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function yY(r,s){if(r===0)switch(s){case"svg":return 1;case"math":return 2;default:return 0}return r===1&&s==="foreignObject"?0:r}function fx(r,s){return r==="textarea"||r==="noscript"||typeof s.children=="string"||typeof s.children=="number"||typeof s.children=="bigint"||typeof s.dangerouslySetInnerHTML=="object"&&s.dangerouslySetInnerHTML!==null&&s.dangerouslySetInnerHTML.__html!=null}var QN=null;function ffe(){var r=window.event;return r&&r.type==="popstate"?r===QN?!1:(QN=r,!0):(QN=null,!1)}var wY=typeof setTimeout=="function"?setTimeout:void 0,mfe=typeof clearTimeout=="function"?clearTimeout:void 0,u6=typeof Promise=="function"?Promise:void 0,gfe=typeof queueMicrotask=="function"?queueMicrotask:typeof u6<"u"?function(r){return u6.resolve(null).then(r).catch(_fe)}:wY;function _fe(r){setTimeout(function(){throw r})}function ZA(r){return r==="head"}function h6(r,s){var a=s,c=0;do{var A=a.nextSibling;if(r.removeChild(a),A&&A.nodeType===8)if(a=A.data,a==="/$"||a==="/&"){if(c===0){r.removeChild(A),pf(s);return}c--}else if(a==="$"||a==="$?"||a==="$~"||a==="$!"||a==="&")c++;else if(a==="html")qg(r.ownerDocument.documentElement);else if(a==="head"){a=r.ownerDocument.head,qg(a);for(var u=a.firstChild;u;){var m=u.nextSibling,E=u.nodeName;u[k_]||E==="SCRIPT"||E==="STYLE"||E==="LINK"&&u.rel.toLowerCase()==="stylesheet"||a.removeChild(u),u=m}}else a==="body"&&qg(r.ownerDocument.body);a=A}while(a);pf(s)}function p6(r,s){var a=r;r=0;do{var c=a.nextSibling;if(a.nodeType===1?s?(a._stashedDisplay=a.style.display,a.style.display="none"):(a.style.display=a._stashedDisplay||"",a.getAttribute("style")===""&&a.removeAttribute("style")):a.nodeType===3&&(s?(a._stashedText=a.nodeValue,a.nodeValue=""):a.nodeValue=a._stashedText||""),c&&c.nodeType===8)if(a=c.data,a==="/$"){if(r===0)break;r--}else a!=="$"&&a!=="$?"&&a!=="$~"&&a!=="$!"||r++;a=c}while(a)}function mx(r){var s=r.firstChild;for(s&&s.nodeType===10&&(s=s.nextSibling);s;){var a=s;switch(s=s.nextSibling,a.nodeName){case"HTML":case"HEAD":case"BODY":mx(a),_D(a);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(a.rel.toLowerCase()==="stylesheet")continue}r.removeChild(a)}}function Efe(r,s,a,c){for(;r.nodeType===1;){var A=a;if(r.nodeName.toLowerCase()!==s.toLowerCase()){if(!c&&(r.nodeName!=="INPUT"||r.type!=="hidden"))break}else if(c){if(!r[k_])switch(s){case"meta":if(!r.hasAttribute("itemprop"))break;return r;case"link":if(u=r.getAttribute("rel"),u==="stylesheet"&&r.hasAttribute("data-precedence"))break;if(u!==A.rel||r.getAttribute("href")!==(A.href==null||A.href===""?null:A.href)||r.getAttribute("crossorigin")!==(A.crossOrigin==null?null:A.crossOrigin)||r.getAttribute("title")!==(A.title==null?null:A.title))break;return r;case"style":if(r.hasAttribute("data-precedence"))break;return r;case"script":if(u=r.getAttribute("src"),(u!==(A.src==null?null:A.src)||r.getAttribute("type")!==(A.type==null?null:A.type)||r.getAttribute("crossorigin")!==(A.crossOrigin==null?null:A.crossOrigin))&&u&&r.hasAttribute("async")&&!r.hasAttribute("itemprop"))break;return r;default:return r}}else if(s==="input"&&r.type==="hidden"){var u=A.name==null?null:""+A.name;if(A.type==="hidden"&&r.getAttribute("name")===u)return r}else return r;if(r=wo(r.nextSibling),r===null)break}return null}function vfe(r,s,a){if(s==="")return null;for(;r.nodeType!==3;)if((r.nodeType!==1||r.nodeName!=="INPUT"||r.type!=="hidden")&&!a||(r=wo(r.nextSibling),r===null))return null;return r}function bY(r,s){for(;r.nodeType!==8;)if((r.nodeType!==1||r.nodeName!=="INPUT"||r.type!=="hidden")&&!s||(r=wo(r.nextSibling),r===null))return null;return r}function gx(r){return r.data==="$?"||r.data==="$~"}function _x(r){return r.data==="$!"||r.data==="$?"&&r.ownerDocument.readyState!=="loading"}function yfe(r,s){var a=r.ownerDocument;if(r.data==="$~")r._reactRetry=s;else if(r.data!=="$?"||a.readyState!=="loading")s();else{var c=function(){s(),a.removeEventListener("DOMContentLoaded",c)};a.addEventListener("DOMContentLoaded",c),r._reactRetry=c}}function wo(r){for(;r!=null;r=r.nextSibling){var s=r.nodeType;if(s===1||s===3)break;if(s===8){if(s=r.data,s==="$"||s==="$!"||s==="$?"||s==="$~"||s==="&"||s==="F!"||s==="F")break;if(s==="/$"||s==="/&")return null}}return r}var Ex=null;function f6(r){r=r.nextSibling;for(var s=0;r;){if(r.nodeType===8){var a=r.data;if(a==="/$"||a==="/&"){if(s===0)return wo(r.nextSibling);s--}else a!=="$"&&a!=="$!"&&a!=="$?"&&a!=="$~"&&a!=="&"||s++}r=r.nextSibling}return null}function m6(r){r=r.previousSibling;for(var s=0;r;){if(r.nodeType===8){var a=r.data;if(a==="$"||a==="$!"||a==="$?"||a==="$~"||a==="&"){if(s===0)return r;s--}else a!=="/$"&&a!=="/&"||s++}r=r.previousSibling}return null}function SY(r,s,a){switch(s=Nw(a),r){case"html":if(r=s.documentElement,!r)throw Error(Me(452));return r;case"head":if(r=s.head,!r)throw Error(Me(453));return r;case"body":if(r=s.body,!r)throw Error(Me(454));return r;default:throw Error(Me(451))}}function qg(r){for(var s=r.attributes;s.length;)r.removeAttributeNode(s[0]);_D(r)}var bo=new Map,g6=new Set;function Ow(r){return typeof r.getRootNode=="function"?r.getRootNode():r.nodeType===9?r:r.ownerDocument}var Ol=Qn.d;Qn.d={f:wfe,r:bfe,D:Sfe,C:Cfe,L:Tfe,m:Rfe,X:Nfe,S:Ife,M:Ofe};function wfe(){var r=Ol.f(),s=_b();return r||s}function bfe(r){var s=vf(r);s!==null&&s.tag===5&&s.type==="form"?gW(s):Ol.r(r)}var Sf=typeof document>"u"?null:document;function CY(r,s,a){var c=Sf;if(c&&typeof s=="string"&&s){var A=mo(s);A='link[rel="'+r+'"][href="'+A+'"]',typeof a=="string"&&(A+='[crossorigin="'+a+'"]'),g6.has(A)||(g6.add(A),r={rel:r,crossOrigin:a,href:s},c.querySelector(A)===null&&(s=c.createElement("link"),Ai(s,"link",r),Gs(s),c.head.appendChild(s)))}}function Sfe(r){Ol.D(r),CY("dns-prefetch",r,null)}function Cfe(r,s){Ol.C(r,s),CY("preconnect",r,s)}function Tfe(r,s,a){Ol.L(r,s,a);var c=Sf;if(c&&r&&s){var A='link[rel="preload"][as="'+mo(s)+'"]';s==="image"&&a&&a.imageSrcSet?(A+='[imagesrcset="'+mo(a.imageSrcSet)+'"]',typeof a.imageSizes=="string"&&(A+='[imagesizes="'+mo(a.imageSizes)+'"]')):A+='[href="'+mo(r)+'"]';var u=A;switch(s){case"style":u=hf(r);break;case"script":u=Cf(r)}bo.has(u)||(r=Br({rel:"preload",href:s==="image"&&a&&a.imageSrcSet?void 0:r,as:s},a),bo.set(u,r),c.querySelector(A)!==null||s==="style"&&c.querySelector(j_(u))||s==="script"&&c.querySelector(V_(u))||(s=c.createElement("link"),Ai(s,"link",r),Gs(s),c.head.appendChild(s)))}}function Rfe(r,s){Ol.m(r,s);var a=Sf;if(a&&r){var c=s&&typeof s.as=="string"?s.as:"script",A='link[rel="modulepreload"][as="'+mo(c)+'"][href="'+mo(r)+'"]',u=A;switch(c){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":u=Cf(r)}if(!bo.has(u)&&(r=Br({rel:"modulepreload",href:r},s),bo.set(u,r),a.querySelector(A)===null)){switch(c){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(a.querySelector(V_(u)))return}c=a.createElement("link"),Ai(c,"link",r),Gs(c),a.head.appendChild(c)}}}function Ife(r,s,a){Ol.S(r,s,a);var c=Sf;if(c&&r){var A=Wp(c).hoistableStyles,u=hf(r);s=s||"default";var m=A.get(u);if(!m){var E={loading:0,preload:null};if(m=c.querySelector(j_(u)))E.loading=5;else{r=Br({rel:"stylesheet",href:r,"data-precedence":s},a),(a=bo.get(u))&&rB(r,a);var w=m=c.createElement("link");Gs(w),Ai(w,"link",r),w._p=new Promise(function(C,T){w.onload=C,w.onerror=T}),w.addEventListener("load",function(){E.loading|=1}),w.addEventListener("error",function(){E.loading|=2}),E.loading|=4,$y(m,s,c)}m={type:"stylesheet",instance:m,count:1,state:E},A.set(u,m)}}}function Nfe(r,s){Ol.X(r,s);var a=Sf;if(a&&r){var c=Wp(a).hoistableScripts,A=Cf(r),u=c.get(A);u||(u=a.querySelector(V_(A)),u||(r=Br({src:r,async:!0},s),(s=bo.get(A))&&sB(r,s),u=a.createElement("script"),Gs(u),Ai(u,"link",r),a.head.appendChild(u)),u={type:"script",instance:u,count:1,state:null},c.set(A,u))}}function Ofe(r,s){Ol.M(r,s);var a=Sf;if(a&&r){var c=Wp(a).hoistableScripts,A=Cf(r),u=c.get(A);u||(u=a.querySelector(V_(A)),u||(r=Br({src:r,async:!0,type:"module"},s),(s=bo.get(A))&&sB(r,s),u=a.createElement("script"),Gs(u),Ai(u,"link",r),a.head.appendChild(u)),u={type:"script",instance:u,count:1,state:null},c.set(A,u))}}function _6(r,s,a,c){var A=(A=UA.current)?Ow(A):null;if(!A)throw Error(Me(446));switch(r){case"meta":case"title":return null;case"style":return typeof a.precedence=="string"&&typeof a.href=="string"?(s=hf(a.href),a=Wp(A).hoistableStyles,c=a.get(s),c||(c={type:"style",instance:null,count:0,state:null},a.set(s,c)),c):{type:"void",instance:null,count:0,state:null};case"link":if(a.rel==="stylesheet"&&typeof a.href=="string"&&typeof a.precedence=="string"){r=hf(a.href);var u=Wp(A).hoistableStyles,m=u.get(r);if(m||(A=A.ownerDocument||A,m={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},u.set(r,m),(u=A.querySelector(j_(r)))&&!u._p&&(m.instance=u,m.state.loading=5),bo.has(r)||(a={rel:"preload",as:"style",href:a.href,crossOrigin:a.crossOrigin,integrity:a.integrity,media:a.media,hrefLang:a.hrefLang,referrerPolicy:a.referrerPolicy},bo.set(r,a),u||xfe(A,r,a,m.state))),s&&c===null)throw Error(Me(528,""));return m}if(s&&c!==null)throw Error(Me(529,""));return null;case"script":return s=a.async,a=a.src,typeof a=="string"&&s&&typeof s!="function"&&typeof s!="symbol"?(s=Cf(a),a=Wp(A).hoistableScripts,c=a.get(s),c||(c={type:"script",instance:null,count:0,state:null},a.set(s,c)),c):{type:"void",instance:null,count:0,state:null};default:throw Error(Me(444,r))}}function hf(r){return'href="'+mo(r)+'"'}function j_(r){return'link[rel="stylesheet"]['+r+"]"}function TY(r){return Br({},r,{"data-precedence":r.precedence,precedence:null})}function xfe(r,s,a,c){r.querySelector('link[rel="preload"][as="style"]['+s+"]")?c.loading=1:(s=r.createElement("link"),c.preload=s,s.addEventListener("load",function(){return c.loading|=1}),s.addEventListener("error",function(){return c.loading|=2}),Ai(s,"link",a),Gs(s),r.head.appendChild(s))}function Cf(r){return'[src="'+mo(r)+'"]'}function V_(r){return"script[async]"+r}function E6(r,s,a){if(s.count++,s.instance===null)switch(s.type){case"style":var c=r.querySelector('style[data-href~="'+mo(a.href)+'"]');if(c)return s.instance=c,Gs(c),c;var A=Br({},a,{"data-href":a.href,"data-precedence":a.precedence,href:null,precedence:null});return c=(r.ownerDocument||r).createElement("style"),Gs(c),Ai(c,"style",A),$y(c,a.precedence,r),s.instance=c;case"stylesheet":A=hf(a.href);var u=r.querySelector(j_(A));if(u)return s.state.loading|=4,s.instance=u,Gs(u),u;c=TY(a),(A=bo.get(A))&&rB(c,A),u=(r.ownerDocument||r).createElement("link"),Gs(u);var m=u;return m._p=new Promise(function(E,w){m.onload=E,m.onerror=w}),Ai(u,"link",c),s.state.loading|=4,$y(u,a.precedence,r),s.instance=u;case"script":return u=Cf(a.src),(A=r.querySelector(V_(u)))?(s.instance=A,Gs(A),A):(c=a,(A=bo.get(u))&&(c=Br({},a),sB(c,A)),r=r.ownerDocument||r,A=r.createElement("script"),Gs(A),Ai(A,"link",c),r.head.appendChild(A),s.instance=A);case"void":return null;default:throw Error(Me(443,s.type))}else s.type==="stylesheet"&&!(s.state.loading&4)&&(c=s.instance,s.state.loading|=4,$y(c,a.precedence,r));return s.instance}function $y(r,s,a){for(var c=a.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),A=c.length?c[c.length-1]:null,u=A,m=0;m<c.length;m++){var E=c[m];if(E.dataset.precedence===s)u=E;else if(u!==A)break}u?u.parentNode.insertBefore(r,u.nextSibling):(s=a.nodeType===9?a.head:a,s.insertBefore(r,s.firstChild))}function rB(r,s){r.crossOrigin==null&&(r.crossOrigin=s.crossOrigin),r.referrerPolicy==null&&(r.referrerPolicy=s.referrerPolicy),r.title==null&&(r.title=s.title)}function sB(r,s){r.crossOrigin==null&&(r.crossOrigin=s.crossOrigin),r.referrerPolicy==null&&(r.referrerPolicy=s.referrerPolicy),r.integrity==null&&(r.integrity=s.integrity)}var Zy=null;function v6(r,s,a){if(Zy===null){var c=new Map,A=Zy=new Map;A.set(a,c)}else A=Zy,c=A.get(a),c||(c=new Map,A.set(a,c));if(c.has(r))return c;for(c.set(r,null),a=a.getElementsByTagName(r),A=0;A<a.length;A++){var u=a[A];if(!(u[k_]||u[ai]||r==="link"&&u.getAttribute("rel")==="stylesheet")&&u.namespaceURI!=="http://www.w3.org/2000/svg"){var m=u.getAttribute(s)||"";m=r+m;var E=c.get(m);E?E.push(u):c.set(m,[u])}}return c}function y6(r,s,a){r=r.ownerDocument||r,r.head.insertBefore(a,s==="title"?r.querySelector("head > title"):null)}function Dfe(r,s,a){if(a===1||s.itemProp!=null)return!1;switch(r){case"meta":case"title":return!0;case"style":if(typeof s.precedence!="string"||typeof s.href!="string"||s.href==="")break;return!0;case"link":if(typeof s.rel!="string"||typeof s.href!="string"||s.href===""||s.onLoad||s.onError)break;switch(s.rel){case"stylesheet":return r=s.disabled,typeof s.precedence=="string"&&r==null;default:return!0}case"script":if(s.async&&typeof s.async!="function"&&typeof s.async!="symbol"&&!s.onLoad&&!s.onError&&s.src&&typeof s.src=="string")return!0}return!1}function RY(r){return!(r.type==="stylesheet"&&!(r.state.loading&3))}function Bfe(r,s,a,c){if(a.type==="stylesheet"&&(typeof c.media!="string"||matchMedia(c.media).matches!==!1)&&!(a.state.loading&4)){if(a.instance===null){var A=hf(c.href),u=s.querySelector(j_(A));if(u){s=u._p,s!==null&&typeof s=="object"&&typeof s.then=="function"&&(r.count++,r=xw.bind(r),s.then(r,r)),a.state.loading|=4,a.instance=u,Gs(u);return}u=s.ownerDocument||s,c=TY(c),(A=bo.get(A))&&rB(c,A),u=u.createElement("link"),Gs(u);var m=u;m._p=new Promise(function(E,w){m.onload=E,m.onerror=w}),Ai(u,"link",c),a.instance=u}r.stylesheets===null&&(r.stylesheets=new Map),r.stylesheets.set(a,s),(s=a.state.preload)&&!(a.state.loading&3)&&(r.count++,a=xw.bind(r),s.addEventListener("load",a),s.addEventListener("error",a))}}var HN=0;function kfe(r,s){return r.stylesheets&&r.count===0&&ew(r,r.stylesheets),0<r.count||0<r.imgCount?function(a){var c=setTimeout(function(){if(r.stylesheets&&ew(r,r.stylesheets),r.unsuspend){var u=r.unsuspend;r.unsuspend=null,u()}},6e4+s);0<r.imgBytes&&HN===0&&(HN=62500*pfe());var A=setTimeout(function(){if(r.waitingForImages=!1,r.count===0&&(r.stylesheets&&ew(r,r.stylesheets),r.unsuspend)){var u=r.unsuspend;r.unsuspend=null,u()}},(r.imgBytes>HN?50:800)+s);return r.unsuspend=a,function(){r.unsuspend=null,clearTimeout(c),clearTimeout(A)}}:null}function xw(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)ew(this,this.stylesheets);else if(this.unsuspend){var r=this.unsuspend;this.unsuspend=null,r()}}}var Dw=null;function ew(r,s){r.stylesheets=null,r.unsuspend!==null&&(r.count++,Dw=new Map,s.forEach(Lfe,r),Dw=null,xw.call(r))}function Lfe(r,s){if(!(s.state.loading&4)){var a=Dw.get(r);if(a)var c=a.get(null);else{a=new Map,Dw.set(r,a);for(var A=r.querySelectorAll("link[data-precedence],style[data-precedence]"),u=0;u<A.length;u++){var m=A[u];(m.nodeName==="LINK"||m.getAttribute("media")!=="not all")&&(a.set(m.dataset.precedence,m),c=m)}c&&a.set(null,c)}A=s.instance,m=A.getAttribute("data-precedence"),u=a.get(m)||c,u===c&&a.set(null,A),a.set(m,A),this.count++,c=xw.bind(this),A.addEventListener("load",c),A.addEventListener("error",c),u?u.parentNode.insertBefore(A,u.nextSibling):(r=r.nodeType===9?r.head:r,r.insertBefore(A,r.firstChild)),s.state.loading|=4}}var p_={$$typeof:fl,Provider:null,Consumer:null,_currentValue:wu,_currentValue2:wu,_threadCount:0};function Ufe(r,s,a,c,A,u,m,E,w){this.tag=1,this.containerInfo=r,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=uN(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=uN(0),this.hiddenUpdates=uN(null),this.identifierPrefix=c,this.onUncaughtError=A,this.onCaughtError=u,this.onRecoverableError=m,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=w,this.incompleteTransitions=new Map}function IY(r,s,a,c,A,u,m,E,w,C,T,N){return r=new Ufe(r,s,a,m,w,C,T,N,E),s=1,u===!0&&(s|=24),u=Ra(3,null,null,s),r.current=u,u.stateNode=r,s=OD(),s.refCount++,r.pooledCache=s,s.refCount++,u.memoizedState={element:c,isDehydrated:a,cache:s},BD(u),r}function NY(r){return r?(r=Qp,r):Qp}function OY(r,s,a,c,A,u){A=NY(A),c.context===null?c.context=A:c.pendingContext=A,c=MA(s),c.payload={element:a},u=u===void 0?null:u,u!==null&&(c.callback=u),a=FA(r,c,s),a!==null&&(ra(a,r,s),Vg(a,r,s))}function w6(r,s){if(r=r.memoizedState,r!==null&&r.dehydrated!==null){var a=r.retryLane;r.retryLane=a!==0&&a<s?a:s}}function iB(r,s){w6(r,s),(r=r.alternate)&&w6(r,s)}function xY(r){if(r.tag===13||r.tag===31){var s=ju(r,67108864);s!==null&&ra(s,r,67108864),iB(r,67108864)}}function b6(r){if(r.tag===13||r.tag===31){var s=ka();s=mD(s);var a=ju(r,s);a!==null&&ra(a,r,s),iB(r,s)}}var Bw=!0;function Pfe(r,s,a,c){var A=Gt.T;Gt.T=null;var u=Qn.p;try{Qn.p=2,aB(r,s,a,c)}finally{Qn.p=u,Gt.T=A}}function Mfe(r,s,a,c){var A=Gt.T;Gt.T=null;var u=Qn.p;try{Qn.p=8,aB(r,s,a,c)}finally{Qn.p=u,Gt.T=A}}function aB(r,s,a,c){if(Bw){var A=vx(c);if(A===null)VN(r,s,c,kw,a),S6(r,c);else if(jfe(A,r,s,a,c))c.stopPropagation();else if(S6(r,c),s&4&&-1<Ffe.indexOf(r)){for(;A!==null;){var u=vf(A);if(u!==null)switch(u.tag){case 3:if(u=u.stateNode,u.current.memoizedState.isDehydrated){var m=Au(u.pendingLanes);if(m!==0){var E=u;for(E.pendingLanes|=2,E.entangledLanes|=2;m;){var w=1<<31-Ba(m);E.entanglements[1]|=w,m&=~w}Pc(u),!(Vn&6)&&(bw=xa()+500,F_(0))}}break;case 31:case 13:E=ju(u,2),E!==null&&ra(E,u,2),_b(),iB(u,2)}if(u=vx(c),u===null&&VN(r,s,c,kw,a),u===A)break;A=u}A!==null&&c.stopPropagation()}else VN(r,s,c,null,a)}}function vx(r){return r=vD(r),oB(r)}var kw=null;function oB(r){if(kw=null,r=Up(r),r!==null){var s=O_(r);if(s===null)r=null;else{var a=s.tag;if(a===13){if(r=JK(s),r!==null)return r;r=null}else if(a===31){if(r=$K(s),r!==null)return r;r=null}else if(a===3){if(s.stateNode.current.memoizedState.isDehydrated)return s.tag===3?s.stateNode.containerInfo:null;r=null}else s!==r&&(r=null)}}return kw=r,null}function DY(r){switch(r){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(She()){case n8:return 2;case r8:return 8;case lw:case Che:return 32;case s8:return 268435456;default:return 32}default:return 32}}var yx=!1,QA=null,HA=null,GA=null,f_=new Map,m_=new Map,SA=[],Ffe="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function S6(r,s){switch(r){case"focusin":case"focusout":QA=null;break;case"dragenter":case"dragleave":HA=null;break;case"mouseover":case"mouseout":GA=null;break;case"pointerover":case"pointerout":f_.delete(s.pointerId);break;case"gotpointercapture":case"lostpointercapture":m_.delete(s.pointerId)}}function hg(r,s,a,c,A,u){return r===null||r.nativeEvent!==u?(r={blockedOn:s,domEventName:a,eventSystemFlags:c,nativeEvent:u,targetContainers:[A]},s!==null&&(s=vf(s),s!==null&&xY(s)),r):(r.eventSystemFlags|=c,s=r.targetContainers,A!==null&&s.indexOf(A)===-1&&s.push(A),r)}function jfe(r,s,a,c,A){switch(s){case"focusin":return QA=hg(QA,r,s,a,c,A),!0;case"dragenter":return HA=hg(HA,r,s,a,c,A),!0;case"mouseover":return GA=hg(GA,r,s,a,c,A),!0;case"pointerover":var u=A.pointerId;return f_.set(u,hg(f_.get(u)||null,r,s,a,c,A)),!0;case"gotpointercapture":return u=A.pointerId,m_.set(u,hg(m_.get(u)||null,r,s,a,c,A)),!0}return!1}function BY(r){var s=Up(r.target);if(s!==null){var a=O_(s);if(a!==null){if(s=a.tag,s===13){if(s=JK(a),s!==null){r.blockedOn=s,c5(r.priority,function(){b6(a)});return}}else if(s===31){if(s=$K(a),s!==null){r.blockedOn=s,c5(r.priority,function(){b6(a)});return}}else if(s===3&&a.stateNode.current.memoizedState.isDehydrated){r.blockedOn=a.tag===3?a.stateNode.containerInfo:null;return}}}r.blockedOn=null}function tw(r){if(r.blockedOn!==null)return!1;for(var s=r.targetContainers;0<s.length;){var a=vx(r.nativeEvent);if(a===null){a=r.nativeEvent;var c=new a.constructor(a.type,a);FO=c,a.target.dispatchEvent(c),FO=null}else return s=vf(a),s!==null&&xY(s),r.blockedOn=a,!1;s.shift()}return!0}function C6(r,s,a){tw(r)&&a.delete(s)}function Vfe(){yx=!1,QA!==null&&tw(QA)&&(QA=null),HA!==null&&tw(HA)&&(HA=null),GA!==null&&tw(GA)&&(GA=null),f_.forEach(C6),m_.forEach(C6)}function ay(r,s){r.blockedOn===s&&(r.blockedOn=null,yx||(yx=!0,Ds.unstable_scheduleCallback(Ds.unstable_NormalPriority,Vfe)))}var oy=null;function T6(r){oy!==r&&(oy=r,Ds.unstable_scheduleCallback(Ds.unstable_NormalPriority,function(){oy===r&&(oy=null);for(var s=0;s<r.length;s+=3){var a=r[s],c=r[s+1],A=r[s+2];if(typeof c!="function"){if(oB(c||a)===null)continue;break}var u=vf(a);u!==null&&(r.splice(s,3),s-=3,tx(u,{pending:!0,data:A,method:a.method,action:c},c,A))}}))}function pf(r){function s(w){return ay(w,r)}QA!==null&&ay(QA,r),HA!==null&&ay(HA,r),GA!==null&&ay(GA,r),f_.forEach(s),m_.forEach(s);for(var a=0;a<SA.length;a++){var c=SA[a];c.blockedOn===r&&(c.blockedOn=null)}for(;0<SA.length&&(a=SA[0],a.blockedOn===null);)BY(a),a.blockedOn===null&&SA.shift();if(a=(r.ownerDocument||r).$$reactFormReplay,a!=null)for(c=0;c<a.length;c+=3){var A=a[c],u=a[c+1],m=A[sa]||null;if(typeof u=="function")m||T6(a);else if(m){var E=null;if(u&&u.hasAttribute("formAction")){if(A=u,m=u[sa]||null)E=m.formAction;else if(oB(A)!==null)continue}else E=m.action;typeof E=="function"?a[c+1]=E:(a.splice(c,3),c-=3),T6(a)}}}function kY(){function r(u){u.canIntercept&&u.info==="react-transition"&&u.intercept({handler:function(){return new Promise(function(m){return A=m})},focusReset:"manual",scroll:"manual"})}function s(){A!==null&&(A(),A=null),c||setTimeout(a,20)}function a(){if(!c&&!navigation.transition){var u=navigation.currentEntry;u&&u.url!=null&&navigation.navigate(u.url,{state:u.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var c=!1,A=null;return navigation.addEventListener("navigate",r),navigation.addEventListener("navigatesuccess",s),navigation.addEventListener("navigateerror",s),setTimeout(a,100),function(){c=!0,navigation.removeEventListener("navigate",r),navigation.removeEventListener("navigatesuccess",s),navigation.removeEventListener("navigateerror",s),A!==null&&(A(),A=null)}}}function cB(r){this._internalRoot=r}yb.prototype.render=cB.prototype.render=function(r){var s=this._internalRoot;if(s===null)throw Error(Me(409));var a=s.current,c=ka();OY(a,c,r,s,null,null)};yb.prototype.unmount=cB.prototype.unmount=function(){var r=this._internalRoot;if(r!==null){this._internalRoot=null;var s=r.containerInfo;OY(r.current,2,null,r,null,null),_b(),s[Ef]=null}};function yb(r){this._internalRoot=r}yb.prototype.unstable_scheduleHydration=function(r){if(r){var s=l8();r={blockedOn:null,target:r,priority:s};for(var a=0;a<SA.length&&s!==0&&s<SA[a].priority;a++);SA.splice(a,0,r),a===0&&BY(r)}};var R6=qK.version;if(R6!=="19.2.0")throw Error(Me(527,R6,"19.2.0"));Qn.findDOMNode=function(r){var s=r._reactInternals;if(s===void 0)throw typeof r.render=="function"?Error(Me(188)):(r=Object.keys(r).join(","),Error(Me(268,r)));return r=ghe(s),r=r!==null?ZK(r):null,r=r===null?null:r.stateNode,r};var Qfe={bundleType:0,version:"19.2.0",rendererPackageName:"react-dom",currentDispatcherRef:Gt,reconcilerVersion:"19.2.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var cy=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!cy.isDisabled&&cy.supportsFiber)try{x_=cy.inject(Qfe),Da=cy}catch{}}sb.createRoot=function(r,s){if(!XK(r))throw Error(Me(299));var a=!1,c="",A=CW,u=TW,m=RW;return s!=null&&(s.unstable_strictMode===!0&&(a=!0),s.identifierPrefix!==void 0&&(c=s.identifierPrefix),s.onUncaughtError!==void 0&&(A=s.onUncaughtError),s.onCaughtError!==void 0&&(u=s.onCaughtError),s.onRecoverableError!==void 0&&(m=s.onRecoverableError)),s=IY(r,1,!1,null,null,a,c,null,A,u,m,kY),r[Ef]=s.current,nB(r),new cB(s)};sb.hydrateRoot=function(r,s,a){if(!XK(r))throw Error(Me(299));var c=!1,A="",u=CW,m=TW,E=RW,w=null;return a!=null&&(a.unstable_strictMode===!0&&(c=!0),a.identifierPrefix!==void 0&&(A=a.identifierPrefix),a.onUncaughtError!==void 0&&(u=a.onUncaughtError),a.onCaughtError!==void 0&&(m=a.onCaughtError),a.onRecoverableError!==void 0&&(E=a.onRecoverableError),a.formState!==void 0&&(w=a.formState)),s=IY(r,1,!0,s,a??null,c,A,w,u,m,E,kY),s.context=NY(null),a=s.current,c=ka(),c=mD(c),A=MA(c),A.callback=null,FA(a,A,c),a=c,s.current.lanes=a,B_(s,a),Pc(s),r[Ef]=s.current,nB(r),new yb(s)};sb.version="19.2.0";function LY(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(LY)}catch(r){console.error(r)}}LY(),HK.exports=sb;var Hfe=HK.exports;/**
 * @remix-run/router v1.23.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function g_(){return g_=Object.assign?Object.assign.bind():function(r){for(var s=1;s<arguments.length;s++){var a=arguments[s];for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(r[c]=a[c])}return r},g_.apply(this,arguments)}var xA;(function(r){r.Pop="POP",r.Push="PUSH",r.Replace="REPLACE"})(xA||(xA={}));const I6="popstate";function Gfe(r){r===void 0&&(r={});function s(c,A){let{pathname:u,search:m,hash:E}=c.location;return wx("",{pathname:u,search:m,hash:E},A.state&&A.state.usr||null,A.state&&A.state.key||"default")}function a(c,A){return typeof A=="string"?A:UY(A)}return Wfe(s,a,null,r)}function Ss(r,s){if(r===!1||r===null||typeof r>"u")throw new Error(s)}function lB(r,s){if(!r){typeof console<"u"&&console.warn(s);try{throw new Error(s)}catch{}}}function Kfe(){return Math.random().toString(36).substr(2,8)}function N6(r,s){return{usr:r.state,key:r.key,idx:s}}function wx(r,s,a,c){return a===void 0&&(a=null),g_({pathname:typeof r=="string"?r:r.pathname,search:"",hash:""},typeof s=="string"?Tf(s):s,{state:a,key:s&&s.key||c||Kfe()})}function UY(r){let{pathname:s="/",search:a="",hash:c=""}=r;return a&&a!=="?"&&(s+=a.charAt(0)==="?"?a:"?"+a),c&&c!=="#"&&(s+=c.charAt(0)==="#"?c:"#"+c),s}function Tf(r){let s={};if(r){let a=r.indexOf("#");a>=0&&(s.hash=r.substr(a),r=r.substr(0,a));let c=r.indexOf("?");c>=0&&(s.search=r.substr(c),r=r.substr(0,c)),r&&(s.pathname=r)}return s}function Wfe(r,s,a,c){c===void 0&&(c={});let{window:A=document.defaultView,v5Compat:u=!1}=c,m=A.history,E=xA.Pop,w=null,C=T();C==null&&(C=0,m.replaceState(g_({},m.state,{idx:C}),""));function T(){return(m.state||{idx:null}).idx}function N(){E=xA.Pop;let Y=T(),F=Y==null?null:Y-C;C=Y,w&&w({action:E,location:K.location,delta:F})}function B(Y,F){E=xA.Push;let M=wx(K.location,Y,F);C=T()+1;let V=N6(M,C),W=K.createHref(M);try{m.pushState(V,"",W)}catch(q){if(q instanceof DOMException&&q.name==="DataCloneError")throw q;A.location.assign(W)}u&&w&&w({action:E,location:K.location,delta:1})}function k(Y,F){E=xA.Replace;let M=wx(K.location,Y,F);C=T();let V=N6(M,C),W=K.createHref(M);m.replaceState(V,"",W),u&&w&&w({action:E,location:K.location,delta:0})}function Q(Y){let F=A.location.origin!=="null"?A.location.origin:A.location.href,M=typeof Y=="string"?Y:UY(Y);return M=M.replace(/ $/,"%20"),Ss(F,"No window.location.(origin|href) available to create URL for href: "+M),new URL(M,F)}let K={get action(){return E},get location(){return r(A,m)},listen(Y){if(w)throw new Error("A history only accepts one active listener");return A.addEventListener(I6,N),w=Y,()=>{A.removeEventListener(I6,N),w=null}},createHref(Y){return s(A,Y)},createURL:Q,encodeLocation(Y){let F=Q(Y);return{pathname:F.pathname,search:F.search,hash:F.hash}},push:B,replace:k,go(Y){return m.go(Y)}};return K}var O6;(function(r){r.data="data",r.deferred="deferred",r.redirect="redirect",r.error="error"})(O6||(O6={}));function Yfe(r,s,a){return a===void 0&&(a="/"),zfe(r,s,a)}function zfe(r,s,a,c){let A=typeof s=="string"?Tf(s):s,u=FY(A.pathname||"/",a);if(u==null)return null;let m=PY(r);qfe(m);let E=null;for(let w=0;E==null&&w<m.length;++w){let C=ome(u);E=sme(m[w],C)}return E}function PY(r,s,a,c){s===void 0&&(s=[]),a===void 0&&(a=[]),c===void 0&&(c="");let A=(u,m,E)=>{let w={relativePath:E===void 0?u.path||"":E,caseSensitive:u.caseSensitive===!0,childrenIndex:m,route:u};w.relativePath.startsWith("/")&&(Ss(w.relativePath.startsWith(c),'Absolute route path "'+w.relativePath+'" nested under path '+('"'+c+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),w.relativePath=w.relativePath.slice(c.length));let C=Ru([c,w.relativePath]),T=a.concat(w);u.children&&u.children.length>0&&(Ss(u.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+C+'".')),PY(u.children,s,T,C)),!(u.path==null&&!u.index)&&s.push({path:C,score:nme(C,u.index),routesMeta:T})};return r.forEach((u,m)=>{var E;if(u.path===""||!((E=u.path)!=null&&E.includes("?")))A(u,m);else for(let w of MY(u.path))A(u,m,w)}),s}function MY(r){let s=r.split("/");if(s.length===0)return[];let[a,...c]=s,A=a.endsWith("?"),u=a.replace(/\?$/,"");if(c.length===0)return A?[u,""]:[u];let m=MY(c.join("/")),E=[];return E.push(...m.map(w=>w===""?u:[u,w].join("/"))),A&&E.push(...m),E.map(w=>r.startsWith("/")&&w===""?"/":w)}function qfe(r){r.sort((s,a)=>s.score!==a.score?a.score-s.score:rme(s.routesMeta.map(c=>c.childrenIndex),a.routesMeta.map(c=>c.childrenIndex)))}const Xfe=/^:[\w-]+$/,Jfe=3,$fe=2,Zfe=1,eme=10,tme=-2,x6=r=>r==="*";function nme(r,s){let a=r.split("/"),c=a.length;return a.some(x6)&&(c+=tme),s&&(c+=$fe),a.filter(A=>!x6(A)).reduce((A,u)=>A+(Xfe.test(u)?Jfe:u===""?Zfe:eme),c)}function rme(r,s){return r.length===s.length&&r.slice(0,-1).every((c,A)=>c===s[A])?r[r.length-1]-s[s.length-1]:0}function sme(r,s,a){let{routesMeta:c}=r,A={},u="/",m=[];for(let E=0;E<c.length;++E){let w=c[E],C=E===c.length-1,T=u==="/"?s:s.slice(u.length)||"/",N=ime({path:w.relativePath,caseSensitive:w.caseSensitive,end:C},T),B=w.route;if(!N)return null;Object.assign(A,N.params),m.push({params:A,pathname:Ru([u,N.pathname]),pathnameBase:ume(Ru([u,N.pathnameBase])),route:B}),N.pathnameBase!=="/"&&(u=Ru([u,N.pathnameBase]))}return m}function ime(r,s){typeof r=="string"&&(r={path:r,caseSensitive:!1,end:!0});let[a,c]=ame(r.path,r.caseSensitive,r.end),A=s.match(a);if(!A)return null;let u=A[0],m=u.replace(/(.)\/+$/,"$1"),E=A.slice(1);return{params:c.reduce((C,T,N)=>{let{paramName:B,isOptional:k}=T;if(B==="*"){let K=E[N]||"";m=u.slice(0,u.length-K.length).replace(/(.)\/+$/,"$1")}const Q=E[N];return k&&!Q?C[B]=void 0:C[B]=(Q||"").replace(/%2F/g,"/"),C},{}),pathname:u,pathnameBase:m,pattern:r}}function ame(r,s,a){s===void 0&&(s=!1),a===void 0&&(a=!0),lB(r==="*"||!r.endsWith("*")||r.endsWith("/*"),'Route path "'+r+'" will be treated as if it were '+('"'+r.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+r.replace(/\*$/,"/*")+'".'));let c=[],A="^"+r.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(m,E,w)=>(c.push({paramName:E,isOptional:w!=null}),w?"/?([^\\/]+)?":"/([^\\/]+)"));return r.endsWith("*")?(c.push({paramName:"*"}),A+=r==="*"||r==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):a?A+="\\/*$":r!==""&&r!=="/"&&(A+="(?:(?=\\/|$))"),[new RegExp(A,s?void 0:"i"),c]}function ome(r){try{return r.split("/").map(s=>decodeURIComponent(s).replace(/\//g,"%2F")).join("/")}catch(s){return lB(!1,'The URL path "'+r+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+s+").")),r}}function FY(r,s){if(s==="/")return r;if(!r.toLowerCase().startsWith(s.toLowerCase()))return null;let a=s.endsWith("/")?s.length-1:s.length,c=r.charAt(a);return c&&c!=="/"?null:r.slice(a)||"/"}const cme=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,lme=r=>cme.test(r);function Ame(r,s){s===void 0&&(s="/");let{pathname:a,search:c="",hash:A=""}=typeof r=="string"?Tf(r):r,u;if(a)if(lme(a))u=a;else{if(a.includes("//")){let m=a;a=a.replace(/\/\/+/g,"/"),lB(!1,"Pathnames cannot have embedded double slashes - normalizing "+(m+" -> "+a))}a.startsWith("/")?u=D6(a.substring(1),"/"):u=D6(a,s)}else u=s;return{pathname:u,search:hme(c),hash:pme(A)}}function D6(r,s){let a=s.replace(/\/+$/,"").split("/");return r.split("/").forEach(A=>{A===".."?a.length>1&&a.pop():A!=="."&&a.push(A)}),a.length>1?a.join("/"):"/"}function GN(r,s,a,c){return"Cannot include a '"+r+"' character in a manually specified "+("`to."+s+"` field ["+JSON.stringify(c)+"].  Please separate it out to the ")+("`to."+a+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function dme(r){return r.filter((s,a)=>a===0||s.route.path&&s.route.path.length>0)}function jY(r,s){let a=dme(r);return s?a.map((c,A)=>A===a.length-1?c.pathname:c.pathnameBase):a.map(c=>c.pathnameBase)}function VY(r,s,a,c){c===void 0&&(c=!1);let A;typeof r=="string"?A=Tf(r):(A=g_({},r),Ss(!A.pathname||!A.pathname.includes("?"),GN("?","pathname","search",A)),Ss(!A.pathname||!A.pathname.includes("#"),GN("#","pathname","hash",A)),Ss(!A.search||!A.search.includes("#"),GN("#","search","hash",A)));let u=r===""||A.pathname==="",m=u?"/":A.pathname,E;if(m==null)E=a;else{let N=s.length-1;if(!c&&m.startsWith("..")){let B=m.split("/");for(;B[0]==="..";)B.shift(),N-=1;A.pathname=B.join("/")}E=N>=0?s[N]:"/"}let w=Ame(A,E),C=m&&m!=="/"&&m.endsWith("/"),T=(u||m===".")&&a.endsWith("/");return!w.pathname.endsWith("/")&&(C||T)&&(w.pathname+="/"),w}const Ru=r=>r.join("/").replace(/\/\/+/g,"/"),ume=r=>r.replace(/\/+$/,"").replace(/^\/*/,"/"),hme=r=>!r||r==="?"?"":r.startsWith("?")?r:"?"+r,pme=r=>!r||r==="#"?"":r.startsWith("#")?r:"#"+r;function fme(r){return r!=null&&typeof r.status=="number"&&typeof r.statusText=="string"&&typeof r.internal=="boolean"&&"data"in r}const QY=["post","put","patch","delete"];new Set(QY);const mme=["get",...QY];new Set(mme);/**
 * React Router v6.30.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function __(){return __=Object.assign?Object.assign.bind():function(r){for(var s=1;s<arguments.length;s++){var a=arguments[s];for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(r[c]=a[c])}return r},__.apply(this,arguments)}const AB=z.createContext(null),gme=z.createContext(null),Q_=z.createContext(null),wb=z.createContext(null),ed=z.createContext({outlet:null,matches:[],isDataRoute:!1}),HY=z.createContext(null);function H_(){return z.useContext(wb)!=null}function dB(){return H_()||Ss(!1),z.useContext(wb).location}function GY(r){z.useContext(Q_).static||z.useLayoutEffect(r)}function ss(){let{isDataRoute:r}=z.useContext(ed);return r?Ome():_me()}function _me(){H_()||Ss(!1);let r=z.useContext(AB),{basename:s,future:a,navigator:c}=z.useContext(Q_),{matches:A}=z.useContext(ed),{pathname:u}=dB(),m=JSON.stringify(jY(A,a.v7_relativeSplatPath)),E=z.useRef(!1);return GY(()=>{E.current=!0}),z.useCallback(function(C,T){if(T===void 0&&(T={}),!E.current)return;if(typeof C=="number"){c.go(C);return}let N=VY(C,JSON.parse(m),u,T.relative==="path");r==null&&s!=="/"&&(N.pathname=N.pathname==="/"?s:Ru([s,N.pathname])),(T.replace?c.replace:c.push)(N,T.state,T)},[s,c,m,u,r])}function bb(){let{matches:r}=z.useContext(ed),s=r[r.length-1];return s?s.params:{}}function Eme(r,s){return vme(r,s)}function vme(r,s,a,c){H_()||Ss(!1);let{navigator:A}=z.useContext(Q_),{matches:u}=z.useContext(ed),m=u[u.length-1],E=m?m.params:{};m&&m.pathname;let w=m?m.pathnameBase:"/";m&&m.route;let C=dB(),T;if(s){var N;let Y=typeof s=="string"?Tf(s):s;w==="/"||(N=Y.pathname)!=null&&N.startsWith(w)||Ss(!1),T=Y}else T=C;let B=T.pathname||"/",k=B;if(w!=="/"){let Y=w.replace(/^\//,"").split("/");k="/"+B.replace(/^\//,"").split("/").slice(Y.length).join("/")}let Q=Yfe(r,{pathname:k}),K=Cme(Q&&Q.map(Y=>Object.assign({},Y,{params:Object.assign({},E,Y.params),pathname:Ru([w,A.encodeLocation?A.encodeLocation(Y.pathname).pathname:Y.pathname]),pathnameBase:Y.pathnameBase==="/"?w:Ru([w,A.encodeLocation?A.encodeLocation(Y.pathnameBase).pathname:Y.pathnameBase])})),u,a,c);return s&&K?z.createElement(wb.Provider,{value:{location:__({pathname:"/",search:"",hash:"",state:null,key:"default"},T),navigationType:xA.Pop}},K):K}function yme(){let r=Nme(),s=fme(r)?r.status+" "+r.statusText:r instanceof Error?r.message:JSON.stringify(r),a=r instanceof Error?r.stack:null,A={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return z.createElement(z.Fragment,null,z.createElement("h2",null,"Unexpected Application Error!"),z.createElement("h3",{style:{fontStyle:"italic"}},s),a?z.createElement("pre",{style:A},a):null,null)}const wme=z.createElement(yme,null);class bme extends z.Component{constructor(s){super(s),this.state={location:s.location,revalidation:s.revalidation,error:s.error}}static getDerivedStateFromError(s){return{error:s}}static getDerivedStateFromProps(s,a){return a.location!==s.location||a.revalidation!=="idle"&&s.revalidation==="idle"?{error:s.error,location:s.location,revalidation:s.revalidation}:{error:s.error!==void 0?s.error:a.error,location:a.location,revalidation:s.revalidation||a.revalidation}}componentDidCatch(s,a){console.error("React Router caught the following error during render",s,a)}render(){return this.state.error!==void 0?z.createElement(ed.Provider,{value:this.props.routeContext},z.createElement(HY.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function Sme(r){let{routeContext:s,match:a,children:c}=r,A=z.useContext(AB);return A&&A.static&&A.staticContext&&(a.route.errorElement||a.route.ErrorBoundary)&&(A.staticContext._deepestRenderedBoundaryId=a.route.id),z.createElement(ed.Provider,{value:s},c)}function Cme(r,s,a,c){var A;if(s===void 0&&(s=[]),a===void 0&&(a=null),c===void 0&&(c=null),r==null){var u;if(!a)return null;if(a.errors)r=a.matches;else if((u=c)!=null&&u.v7_partialHydration&&s.length===0&&!a.initialized&&a.matches.length>0)r=a.matches;else return null}let m=r,E=(A=a)==null?void 0:A.errors;if(E!=null){let T=m.findIndex(N=>N.route.id&&(E==null?void 0:E[N.route.id])!==void 0);T>=0||Ss(!1),m=m.slice(0,Math.min(m.length,T+1))}let w=!1,C=-1;if(a&&c&&c.v7_partialHydration)for(let T=0;T<m.length;T++){let N=m[T];if((N.route.HydrateFallback||N.route.hydrateFallbackElement)&&(C=T),N.route.id){let{loaderData:B,errors:k}=a,Q=N.route.loader&&B[N.route.id]===void 0&&(!k||k[N.route.id]===void 0);if(N.route.lazy||Q){w=!0,C>=0?m=m.slice(0,C+1):m=[m[0]];break}}}return m.reduceRight((T,N,B)=>{let k,Q=!1,K=null,Y=null;a&&(k=E&&N.route.id?E[N.route.id]:void 0,K=N.route.errorElement||wme,w&&(C<0&&B===0?(xme("route-fallback"),Q=!0,Y=null):C===B&&(Q=!0,Y=N.route.hydrateFallbackElement||null)));let F=s.concat(m.slice(0,B+1)),M=()=>{let V;return k?V=K:Q?V=Y:N.route.Component?V=z.createElement(N.route.Component,null):N.route.element?V=N.route.element:V=T,z.createElement(Sme,{match:N,routeContext:{outlet:T,matches:F,isDataRoute:a!=null},children:V})};return a&&(N.route.ErrorBoundary||N.route.errorElement||B===0)?z.createElement(bme,{location:a.location,revalidation:a.revalidation,component:K,error:k,children:M(),routeContext:{outlet:null,matches:F,isDataRoute:!0}}):M()},null)}var KY=function(r){return r.UseBlocker="useBlocker",r.UseRevalidator="useRevalidator",r.UseNavigateStable="useNavigate",r}(KY||{}),WY=function(r){return r.UseBlocker="useBlocker",r.UseLoaderData="useLoaderData",r.UseActionData="useActionData",r.UseRouteError="useRouteError",r.UseNavigation="useNavigation",r.UseRouteLoaderData="useRouteLoaderData",r.UseMatches="useMatches",r.UseRevalidator="useRevalidator",r.UseNavigateStable="useNavigate",r.UseRouteId="useRouteId",r}(WY||{});function Tme(r){let s=z.useContext(AB);return s||Ss(!1),s}function Rme(r){let s=z.useContext(gme);return s||Ss(!1),s}function Ime(r){let s=z.useContext(ed);return s||Ss(!1),s}function YY(r){let s=Ime(),a=s.matches[s.matches.length-1];return a.route.id||Ss(!1),a.route.id}function Nme(){var r;let s=z.useContext(HY),a=Rme(),c=YY();return s!==void 0?s:(r=a.errors)==null?void 0:r[c]}function Ome(){let{router:r}=Tme(KY.UseNavigateStable),s=YY(WY.UseNavigateStable),a=z.useRef(!1);return GY(()=>{a.current=!0}),z.useCallback(function(A,u){u===void 0&&(u={}),a.current&&(typeof A=="number"?r.navigate(A):r.navigate(A,__({fromRouteId:s},u)))},[r,s])}const B6={};function xme(r,s,a){B6[r]||(B6[r]=!0)}function Dme(r,s){r==null||r.v7_startTransition,r==null||r.v7_relativeSplatPath}function Bme(r){let{to:s,replace:a,state:c,relative:A}=r;H_()||Ss(!1);let{future:u,static:m}=z.useContext(Q_),{matches:E}=z.useContext(ed),{pathname:w}=dB(),C=ss(),T=VY(s,jY(E,u.v7_relativeSplatPath),w,A==="path"),N=JSON.stringify(T);return z.useEffect(()=>C(JSON.parse(N),{replace:a,state:c,relative:A}),[C,N,A,a,c]),null}function Zt(r){Ss(!1)}function kme(r){let{basename:s="/",children:a=null,location:c,navigationType:A=xA.Pop,navigator:u,static:m=!1,future:E}=r;H_()&&Ss(!1);let w=s.replace(/^\/*/,"/"),C=z.useMemo(()=>({basename:w,navigator:u,static:m,future:__({v7_relativeSplatPath:!1},E)}),[w,E,u,m]);typeof c=="string"&&(c=Tf(c));let{pathname:T="/",search:N="",hash:B="",state:k=null,key:Q="default"}=c,K=z.useMemo(()=>{let Y=FY(T,w);return Y==null?null:{location:{pathname:Y,search:N,hash:B,state:k,key:Q},navigationType:A}},[w,T,N,B,k,Q,A]);return K==null?null:z.createElement(Q_.Provider,{value:C},z.createElement(wb.Provider,{children:a,value:K}))}function Lme(r){let{children:s,location:a}=r;return Eme(bx(s),a)}new Promise(()=>{});function bx(r,s){s===void 0&&(s=[]);let a=[];return z.Children.forEach(r,(c,A)=>{if(!z.isValidElement(c))return;let u=[...s,A];if(c.type===z.Fragment){a.push.apply(a,bx(c.props.children,u));return}c.type!==Zt&&Ss(!1),!c.props.index||!c.props.children||Ss(!1);let m={id:c.props.id||u.join("-"),caseSensitive:c.props.caseSensitive,element:c.props.element,Component:c.props.Component,index:c.props.index,path:c.props.path,loader:c.props.loader,action:c.props.action,errorElement:c.props.errorElement,ErrorBoundary:c.props.ErrorBoundary,hasErrorBoundary:c.props.ErrorBoundary!=null||c.props.errorElement!=null,shouldRevalidate:c.props.shouldRevalidate,handle:c.props.handle,lazy:c.props.lazy};c.props.children&&(m.children=bx(c.props.children,u)),a.push(m)}),a}/**
 * React Router DOM v6.30.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */const Ume="6";try{window.__reactRouterVersion=Ume}catch{}const Pme="startTransition",k6=QK[Pme];function Mme(r){let{basename:s,children:a,future:c,window:A}=r,u=z.useRef();u.current==null&&(u.current=Gfe({window:A,v5Compat:!0}));let m=u.current,[E,w]=z.useState({action:m.action,location:m.location}),{v7_startTransition:C}=c||{},T=z.useCallback(N=>{C&&k6?k6(()=>w(N)):w(N)},[w,C]);return z.useLayoutEffect(()=>m.listen(T),[m,T]),z.useEffect(()=>Dme(c),[c]),z.createElement(kme,{basename:s,children:a,location:E.location,navigationType:E.action,navigator:m,future:c})}var L6;(function(r){r.UseScrollRestoration="useScrollRestoration",r.UseSubmit="useSubmit",r.UseSubmitFetcher="useSubmitFetcher",r.UseFetcher="useFetcher",r.useViewTransitionState="useViewTransitionState"})(L6||(L6={}));var U6;(function(r){r.UseFetcher="useFetcher",r.UseFetchers="useFetchers",r.UseScrollRestoration="useScrollRestoration"})(U6||(U6={}));var Sx=function(r,s){return Sx=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,c){a.__proto__=c}||function(a,c){for(var A in c)Object.prototype.hasOwnProperty.call(c,A)&&(a[A]=c[A])},Sx(r,s)};function zY(r,s){if(typeof s!="function"&&s!==null)throw new TypeError("Class extends value "+String(s)+" is not a constructor or null");Sx(r,s);function a(){this.constructor=r}r.prototype=s===null?Object.create(s):(a.prototype=s.prototype,new a)}var Lw=function(){return Lw=Object.assign||function(s){for(var a,c=1,A=arguments.length;c<A;c++){a=arguments[c];for(var u in a)Object.prototype.hasOwnProperty.call(a,u)&&(s[u]=a[u])}return s},Lw.apply(this,arguments)};function Rf(r,s){var a={};for(var c in r)Object.prototype.hasOwnProperty.call(r,c)&&s.indexOf(c)<0&&(a[c]=r[c]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var A=0,c=Object.getOwnPropertySymbols(r);A<c.length;A++)s.indexOf(c[A])<0&&Object.prototype.propertyIsEnumerable.call(r,c[A])&&(a[c[A]]=r[c[A]]);return a}function qY(r,s,a,c){var A=arguments.length,u=A<3?s:c===null?c=Object.getOwnPropertyDescriptor(s,a):c,m;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")u=Reflect.decorate(r,s,a,c);else for(var E=r.length-1;E>=0;E--)(m=r[E])&&(u=(A<3?m(u):A>3?m(s,a,u):m(s,a))||u);return A>3&&u&&Object.defineProperty(s,a,u),u}function XY(r,s){return function(a,c){s(a,c,r)}}function JY(r,s,a,c,A,u){function m(F){if(F!==void 0&&typeof F!="function")throw new TypeError("Function expected");return F}for(var E=c.kind,w=E==="getter"?"get":E==="setter"?"set":"value",C=!s&&r?c.static?r:r.prototype:null,T=s||(C?Object.getOwnPropertyDescriptor(C,c.name):{}),N,B=!1,k=a.length-1;k>=0;k--){var Q={};for(var K in c)Q[K]=K==="access"?{}:c[K];for(var K in c.access)Q.access[K]=c.access[K];Q.addInitializer=function(F){if(B)throw new TypeError("Cannot add initializers after decoration has completed");u.push(m(F||null))};var Y=(0,a[k])(E==="accessor"?{get:T.get,set:T.set}:T[w],Q);if(E==="accessor"){if(Y===void 0)continue;if(Y===null||typeof Y!="object")throw new TypeError("Object expected");(N=m(Y.get))&&(T.get=N),(N=m(Y.set))&&(T.set=N),(N=m(Y.init))&&A.unshift(N)}else(N=m(Y))&&(E==="field"?A.unshift(N):T[w]=N)}C&&Object.defineProperty(C,c.name,T),B=!0}function $Y(r,s,a){for(var c=arguments.length>2,A=0;A<s.length;A++)a=c?s[A].call(r,a):s[A].call(r);return c?a:void 0}function ZY(r){return typeof r=="symbol"?r:"".concat(r)}function ez(r,s,a){return typeof s=="symbol"&&(s=s.description?"[".concat(s.description,"]"):""),Object.defineProperty(r,"name",{configurable:!0,value:a?"".concat(a," ",s):s})}function tz(r,s){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,s)}function vt(r,s,a,c){function A(u){return u instanceof a?u:new a(function(m){m(u)})}return new(a||(a=Promise))(function(u,m){function E(T){try{C(c.next(T))}catch(N){m(N)}}function w(T){try{C(c.throw(T))}catch(N){m(N)}}function C(T){T.done?u(T.value):A(T.value).then(E,w)}C((c=c.apply(r,s||[])).next())})}function nz(r,s){var a={label:0,sent:function(){if(u[0]&1)throw u[1];return u[1]},trys:[],ops:[]},c,A,u,m=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return m.next=E(0),m.throw=E(1),m.return=E(2),typeof Symbol=="function"&&(m[Symbol.iterator]=function(){return this}),m;function E(C){return function(T){return w([C,T])}}function w(C){if(c)throw new TypeError("Generator is already executing.");for(;m&&(m=0,C[0]&&(a=0)),a;)try{if(c=1,A&&(u=C[0]&2?A.return:C[0]?A.throw||((u=A.return)&&u.call(A),0):A.next)&&!(u=u.call(A,C[1])).done)return u;switch(A=0,u&&(C=[C[0]&2,u.value]),C[0]){case 0:case 1:u=C;break;case 4:return a.label++,{value:C[1],done:!1};case 5:a.label++,A=C[1],C=[0];continue;case 7:C=a.ops.pop(),a.trys.pop();continue;default:if(u=a.trys,!(u=u.length>0&&u[u.length-1])&&(C[0]===6||C[0]===2)){a=0;continue}if(C[0]===3&&(!u||C[1]>u[0]&&C[1]<u[3])){a.label=C[1];break}if(C[0]===6&&a.label<u[1]){a.label=u[1],u=C;break}if(u&&a.label<u[2]){a.label=u[2],a.ops.push(C);break}u[2]&&a.ops.pop(),a.trys.pop();continue}C=s.call(r,a)}catch(T){C=[6,T],A=0}finally{c=u=0}if(C[0]&5)throw C[1];return{value:C[0]?C[1]:void 0,done:!0}}}var Sb=Object.create?function(r,s,a,c){c===void 0&&(c=a);var A=Object.getOwnPropertyDescriptor(s,a);(!A||("get"in A?!s.__esModule:A.writable||A.configurable))&&(A={enumerable:!0,get:function(){return s[a]}}),Object.defineProperty(r,c,A)}:function(r,s,a,c){c===void 0&&(c=a),r[c]=s[a]};function rz(r,s){for(var a in r)a!=="default"&&!Object.prototype.hasOwnProperty.call(s,a)&&Sb(s,r,a)}function Uw(r){var s=typeof Symbol=="function"&&Symbol.iterator,a=s&&r[s],c=0;if(a)return a.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&c>=r.length&&(r=void 0),{value:r&&r[c++],done:!r}}};throw new TypeError(s?"Object is not iterable.":"Symbol.iterator is not defined.")}function uB(r,s){var a=typeof Symbol=="function"&&r[Symbol.iterator];if(!a)return r;var c=a.call(r),A,u=[],m;try{for(;(s===void 0||s-- >0)&&!(A=c.next()).done;)u.push(A.value)}catch(E){m={error:E}}finally{try{A&&!A.done&&(a=c.return)&&a.call(c)}finally{if(m)throw m.error}}return u}function sz(){for(var r=[],s=0;s<arguments.length;s++)r=r.concat(uB(arguments[s]));return r}function iz(){for(var r=0,s=0,a=arguments.length;s<a;s++)r+=arguments[s].length;for(var c=Array(r),A=0,s=0;s<a;s++)for(var u=arguments[s],m=0,E=u.length;m<E;m++,A++)c[A]=u[m];return c}function az(r,s,a){if(a||arguments.length===2)for(var c=0,A=s.length,u;c<A;c++)(u||!(c in s))&&(u||(u=Array.prototype.slice.call(s,0,c)),u[c]=s[c]);return r.concat(u||Array.prototype.slice.call(s))}function ff(r){return this instanceof ff?(this.v=r,this):new ff(r)}function oz(r,s,a){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var c=a.apply(r,s||[]),A,u=[];return A=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),E("next"),E("throw"),E("return",m),A[Symbol.asyncIterator]=function(){return this},A;function m(k){return function(Q){return Promise.resolve(Q).then(k,N)}}function E(k,Q){c[k]&&(A[k]=function(K){return new Promise(function(Y,F){u.push([k,K,Y,F])>1||w(k,K)})},Q&&(A[k]=Q(A[k])))}function w(k,Q){try{C(c[k](Q))}catch(K){B(u[0][3],K)}}function C(k){k.value instanceof ff?Promise.resolve(k.value.v).then(T,N):B(u[0][2],k)}function T(k){w("next",k)}function N(k){w("throw",k)}function B(k,Q){k(Q),u.shift(),u.length&&w(u[0][0],u[0][1])}}function cz(r){var s,a;return s={},c("next"),c("throw",function(A){throw A}),c("return"),s[Symbol.iterator]=function(){return this},s;function c(A,u){s[A]=r[A]?function(m){return(a=!a)?{value:ff(r[A](m)),done:!1}:u?u(m):m}:u}}function lz(r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var s=r[Symbol.asyncIterator],a;return s?s.call(r):(r=typeof Uw=="function"?Uw(r):r[Symbol.iterator](),a={},c("next"),c("throw"),c("return"),a[Symbol.asyncIterator]=function(){return this},a);function c(u){a[u]=r[u]&&function(m){return new Promise(function(E,w){m=r[u](m),A(E,w,m.done,m.value)})}}function A(u,m,E,w){Promise.resolve(w).then(function(C){u({value:C,done:E})},m)}}function Az(r,s){return Object.defineProperty?Object.defineProperty(r,"raw",{value:s}):r.raw=s,r}var Fme=Object.create?function(r,s){Object.defineProperty(r,"default",{enumerable:!0,value:s})}:function(r,s){r.default=s},Cx=function(r){return Cx=Object.getOwnPropertyNames||function(s){var a=[];for(var c in s)Object.prototype.hasOwnProperty.call(s,c)&&(a[a.length]=c);return a},Cx(r)};function dz(r){if(r&&r.__esModule)return r;var s={};if(r!=null)for(var a=Cx(r),c=0;c<a.length;c++)a[c]!=="default"&&Sb(s,r,a[c]);return Fme(s,r),s}function uz(r){return r&&r.__esModule?r:{default:r}}function hz(r,s,a,c){if(a==="a"&&!c)throw new TypeError("Private accessor was defined without a getter");if(typeof s=="function"?r!==s||!c:!s.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return a==="m"?c:a==="a"?c.call(r):c?c.value:s.get(r)}function pz(r,s,a,c,A){if(c==="m")throw new TypeError("Private method is not writable");if(c==="a"&&!A)throw new TypeError("Private accessor was defined without a setter");if(typeof s=="function"?r!==s||!A:!s.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return c==="a"?A.call(r,a):A?A.value=a:s.set(r,a),a}function fz(r,s){if(s===null||typeof s!="object"&&typeof s!="function")throw new TypeError("Cannot use 'in' operator on non-object");return typeof r=="function"?s===r:r.has(s)}function mz(r,s,a){if(s!=null){if(typeof s!="object"&&typeof s!="function")throw new TypeError("Object expected.");var c,A;if(a){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");c=s[Symbol.asyncDispose]}if(c===void 0){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");c=s[Symbol.dispose],a&&(A=c)}if(typeof c!="function")throw new TypeError("Object not disposable.");A&&(c=function(){try{A.call(this)}catch(u){return Promise.reject(u)}}),r.stack.push({value:s,dispose:c,async:a})}else a&&r.stack.push({async:!0});return s}var jme=typeof SuppressedError=="function"?SuppressedError:function(r,s,a){var c=new Error(a);return c.name="SuppressedError",c.error=r,c.suppressed=s,c};function gz(r){function s(u){r.error=r.hasError?new jme(u,r.error,"An error was suppressed during disposal."):u,r.hasError=!0}var a,c=0;function A(){for(;a=r.stack.pop();)try{if(!a.async&&c===1)return c=0,r.stack.push(a),Promise.resolve().then(A);if(a.dispose){var u=a.dispose.call(a.value);if(a.async)return c|=2,Promise.resolve(u).then(A,function(m){return s(m),A()})}else c|=1}catch(m){s(m)}if(c===1)return r.hasError?Promise.reject(r.error):Promise.resolve();if(r.hasError)throw r.error}return A()}function _z(r,s){return typeof r=="string"&&/^\.\.?\//.test(r)?r.replace(/\.(tsx)$|((?:\.d)?)((?:\.[^./]+?)?)\.([cm]?)ts$/i,function(a,c,A,u,m){return c?s?".jsx":".js":A&&(!u||!m)?a:A+u+"."+m.toLowerCase()+"js"}):r}const Vme={__extends:zY,__assign:Lw,__rest:Rf,__decorate:qY,__param:XY,__esDecorate:JY,__runInitializers:$Y,__propKey:ZY,__setFunctionName:ez,__metadata:tz,__awaiter:vt,__generator:nz,__createBinding:Sb,__exportStar:rz,__values:Uw,__read:uB,__spread:sz,__spreadArrays:iz,__spreadArray:az,__await:ff,__asyncGenerator:oz,__asyncDelegator:cz,__asyncValues:lz,__makeTemplateObject:Az,__importStar:dz,__importDefault:uz,__classPrivateFieldGet:hz,__classPrivateFieldSet:pz,__classPrivateFieldIn:fz,__addDisposableResource:mz,__disposeResources:gz,__rewriteRelativeImportExtension:_z},Qme=Object.freeze(Object.defineProperty({__proto__:null,__addDisposableResource:mz,get __assign(){return Lw},__asyncDelegator:cz,__asyncGenerator:oz,__asyncValues:lz,__await:ff,__awaiter:vt,__classPrivateFieldGet:hz,__classPrivateFieldIn:fz,__classPrivateFieldSet:pz,__createBinding:Sb,__decorate:qY,__disposeResources:gz,__esDecorate:JY,__exportStar:rz,__extends:zY,__generator:nz,__importDefault:uz,__importStar:dz,__makeTemplateObject:Az,__metadata:tz,__param:XY,__propKey:ZY,__read:uB,__rest:Rf,__rewriteRelativeImportExtension:_z,__runInitializers:$Y,__setFunctionName:ez,__spread:sz,__spreadArray:az,__spreadArrays:iz,__values:Uw,default:Vme},Symbol.toStringTag,{value:"Module"})),Hme=r=>r?(...s)=>r(...s):(...s)=>fetch(...s);class hB extends Error{constructor(s,a="FunctionsError",c){super(s),this.name=a,this.context=c}}class Gme extends hB{constructor(s){super("Failed to send a request to the Edge Function","FunctionsFetchError",s)}}class P6 extends hB{constructor(s){super("Relay Error invoking the Edge Function","FunctionsRelayError",s)}}class M6 extends hB{constructor(s){super("Edge Function returned a non-2xx status code","FunctionsHttpError",s)}}var Tx;(function(r){r.Any="any",r.ApNortheast1="ap-northeast-1",r.ApNortheast2="ap-northeast-2",r.ApSouth1="ap-south-1",r.ApSoutheast1="ap-southeast-1",r.ApSoutheast2="ap-southeast-2",r.CaCentral1="ca-central-1",r.EuCentral1="eu-central-1",r.EuWest1="eu-west-1",r.EuWest2="eu-west-2",r.EuWest3="eu-west-3",r.SaEast1="sa-east-1",r.UsEast1="us-east-1",r.UsWest1="us-west-1",r.UsWest2="us-west-2"})(Tx||(Tx={}));class Kme{constructor(s,{headers:a={},customFetch:c,region:A=Tx.Any}={}){this.url=s,this.headers=a,this.region=A,this.fetch=Hme(c)}setAuth(s){this.headers.Authorization=`Bearer ${s}`}invoke(s){return vt(this,arguments,void 0,function*(a,c={}){var A;let u,m;try{const{headers:E,method:w,body:C,signal:T,timeout:N}=c;let B={},{region:k}=c;k||(k=this.region);const Q=new URL(`${this.url}/${a}`);k&&k!=="any"&&(B["x-region"]=k,Q.searchParams.set("forceFunctionRegion",k));let K;C&&(E&&!Object.prototype.hasOwnProperty.call(E,"Content-Type")||!E)?typeof Blob<"u"&&C instanceof Blob||C instanceof ArrayBuffer?(B["Content-Type"]="application/octet-stream",K=C):typeof C=="string"?(B["Content-Type"]="text/plain",K=C):typeof FormData<"u"&&C instanceof FormData?K=C:(B["Content-Type"]="application/json",K=JSON.stringify(C)):K=C;let Y=T;N&&(m=new AbortController,u=setTimeout(()=>m.abort(),N),T?(Y=m.signal,T.addEventListener("abort",()=>m.abort())):Y=m.signal);const F=yield this.fetch(Q.toString(),{method:w||"POST",headers:Object.assign(Object.assign(Object.assign({},B),this.headers),E),body:K,signal:Y}).catch(q=>{throw new Gme(q)}),M=F.headers.get("x-relay-error");if(M&&M==="true")throw new P6(F);if(!F.ok)throw new M6(F);let V=((A=F.headers.get("Content-Type"))!==null&&A!==void 0?A:"text/plain").split(";")[0].trim(),W;return V==="application/json"?W=yield F.json():V==="application/octet-stream"||V==="application/pdf"?W=yield F.blob():V==="text/event-stream"?W=F:V==="multipart/form-data"?W=yield F.formData():W=yield F.text(),{data:W,error:null,response:F}}catch(E){return{data:null,error:E,response:E instanceof M6||E instanceof P6?E.context:void 0}}finally{u&&clearTimeout(u)}})}}var Bi={};const If=Wue(Qme);var ly={},Ay={},dy={},uy={},hy={},py={},F6;function Ez(){if(F6)return py;F6=1,Object.defineProperty(py,"__esModule",{value:!0});class r extends Error{constructor(a){super(a.message),this.name="PostgrestError",this.details=a.details,this.hint=a.hint,this.code=a.code}}return py.default=r,py}var j6;function vz(){if(j6)return hy;j6=1,Object.defineProperty(hy,"__esModule",{value:!0});const s=If.__importDefault(Ez());class a{constructor(A){var u,m;this.shouldThrowOnError=!1,this.method=A.method,this.url=A.url,this.headers=new Headers(A.headers),this.schema=A.schema,this.body=A.body,this.shouldThrowOnError=(u=A.shouldThrowOnError)!==null&&u!==void 0?u:!1,this.signal=A.signal,this.isMaybeSingle=(m=A.isMaybeSingle)!==null&&m!==void 0?m:!1,A.fetch?this.fetch=A.fetch:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(A,u){return this.headers=new Headers(this.headers),this.headers.set(A,u),this}then(A,u){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const m=this.fetch;let E=m(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async w=>{var C,T,N,B;let k=null,Q=null,K=null,Y=w.status,F=w.statusText;if(w.ok){if(this.method!=="HEAD"){const q=await w.text();q===""||(this.headers.get("Accept")==="text/csv"||this.headers.get("Accept")&&(!((C=this.headers.get("Accept"))===null||C===void 0)&&C.includes("application/vnd.pgrst.plan+text"))?Q=q:Q=JSON.parse(q))}const V=(T=this.headers.get("Prefer"))===null||T===void 0?void 0:T.match(/count=(exact|planned|estimated)/),W=(N=w.headers.get("content-range"))===null||N===void 0?void 0:N.split("/");V&&W&&W.length>1&&(K=parseInt(W[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(Q)&&(Q.length>1?(k={code:"PGRST116",details:`Results contain ${Q.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},Q=null,K=null,Y=406,F="Not Acceptable"):Q.length===1?Q=Q[0]:Q=null)}else{const V=await w.text();try{k=JSON.parse(V),Array.isArray(k)&&w.status===404&&(Q=[],k=null,Y=200,F="OK")}catch{w.status===404&&V===""?(Y=204,F="No Content"):k={message:V}}if(k&&this.isMaybeSingle&&(!((B=k==null?void 0:k.details)===null||B===void 0)&&B.includes("0 rows"))&&(k=null,Y=200,F="OK"),k&&this.shouldThrowOnError)throw new s.default(k)}return{error:k,data:Q,count:K,status:Y,statusText:F}});return this.shouldThrowOnError||(E=E.catch(w=>{var C,T,N,B,k,Q;let K="";const Y=w==null?void 0:w.cause;if(Y){const F=(C=Y==null?void 0:Y.message)!==null&&C!==void 0?C:"",M=(T=Y==null?void 0:Y.code)!==null&&T!==void 0?T:"";K=`${(N=w==null?void 0:w.name)!==null&&N!==void 0?N:"FetchError"}: ${w==null?void 0:w.message}`,K+=`

Caused by: ${(B=Y==null?void 0:Y.name)!==null&&B!==void 0?B:"Error"}: ${F}`,M&&(K+=` (${M})`),Y!=null&&Y.stack&&(K+=`
${Y.stack}`)}else K=(k=w==null?void 0:w.stack)!==null&&k!==void 0?k:"";return{error:{message:`${(Q=w==null?void 0:w.name)!==null&&Q!==void 0?Q:"FetchError"}: ${w==null?void 0:w.message}`,details:K,hint:"",code:""},data:null,count:null,status:0,statusText:""}})),E.then(A,u)}returns(){return this}overrideTypes(){return this}}return hy.default=a,hy}var V6;function yz(){if(V6)return uy;V6=1,Object.defineProperty(uy,"__esModule",{value:!0});const s=If.__importDefault(vz());class a extends s.default{select(A){let u=!1;const m=(A??"*").split("").map(E=>/\s/.test(E)&&!u?"":(E==='"'&&(u=!u),E)).join("");return this.url.searchParams.set("select",m),this.headers.append("Prefer","return=representation"),this}order(A,{ascending:u=!0,nullsFirst:m,foreignTable:E,referencedTable:w=E}={}){const C=w?`${w}.order`:"order",T=this.url.searchParams.get(C);return this.url.searchParams.set(C,`${T?`${T},`:""}${A}.${u?"asc":"desc"}${m===void 0?"":m?".nullsfirst":".nullslast"}`),this}limit(A,{foreignTable:u,referencedTable:m=u}={}){const E=typeof m>"u"?"limit":`${m}.limit`;return this.url.searchParams.set(E,`${A}`),this}range(A,u,{foreignTable:m,referencedTable:E=m}={}){const w=typeof E>"u"?"offset":`${E}.offset`,C=typeof E>"u"?"limit":`${E}.limit`;return this.url.searchParams.set(w,`${A}`),this.url.searchParams.set(C,`${u-A+1}`),this}abortSignal(A){return this.signal=A,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:A=!1,verbose:u=!1,settings:m=!1,buffers:E=!1,wal:w=!1,format:C="text"}={}){var T;const N=[A?"analyze":null,u?"verbose":null,m?"settings":null,E?"buffers":null,w?"wal":null].filter(Boolean).join("|"),B=(T=this.headers.get("Accept"))!==null&&T!==void 0?T:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${C}; for="${B}"; options=${N};`),C==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(A){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${A}`),this}}return uy.default=a,uy}var Q6;function pB(){if(Q6)return dy;Q6=1,Object.defineProperty(dy,"__esModule",{value:!0});const s=If.__importDefault(yz()),a=new RegExp("[,()]");class c extends s.default{eq(u,m){return this.url.searchParams.append(u,`eq.${m}`),this}neq(u,m){return this.url.searchParams.append(u,`neq.${m}`),this}gt(u,m){return this.url.searchParams.append(u,`gt.${m}`),this}gte(u,m){return this.url.searchParams.append(u,`gte.${m}`),this}lt(u,m){return this.url.searchParams.append(u,`lt.${m}`),this}lte(u,m){return this.url.searchParams.append(u,`lte.${m}`),this}like(u,m){return this.url.searchParams.append(u,`like.${m}`),this}likeAllOf(u,m){return this.url.searchParams.append(u,`like(all).{${m.join(",")}}`),this}likeAnyOf(u,m){return this.url.searchParams.append(u,`like(any).{${m.join(",")}}`),this}ilike(u,m){return this.url.searchParams.append(u,`ilike.${m}`),this}ilikeAllOf(u,m){return this.url.searchParams.append(u,`ilike(all).{${m.join(",")}}`),this}ilikeAnyOf(u,m){return this.url.searchParams.append(u,`ilike(any).{${m.join(",")}}`),this}regexMatch(u,m){return this.url.searchParams.append(u,`match.${m}`),this}regexIMatch(u,m){return this.url.searchParams.append(u,`imatch.${m}`),this}is(u,m){return this.url.searchParams.append(u,`is.${m}`),this}isDistinct(u,m){return this.url.searchParams.append(u,`isdistinct.${m}`),this}in(u,m){const E=Array.from(new Set(m)).map(w=>typeof w=="string"&&a.test(w)?`"${w}"`:`${w}`).join(",");return this.url.searchParams.append(u,`in.(${E})`),this}contains(u,m){return typeof m=="string"?this.url.searchParams.append(u,`cs.${m}`):Array.isArray(m)?this.url.searchParams.append(u,`cs.{${m.join(",")}}`):this.url.searchParams.append(u,`cs.${JSON.stringify(m)}`),this}containedBy(u,m){return typeof m=="string"?this.url.searchParams.append(u,`cd.${m}`):Array.isArray(m)?this.url.searchParams.append(u,`cd.{${m.join(",")}}`):this.url.searchParams.append(u,`cd.${JSON.stringify(m)}`),this}rangeGt(u,m){return this.url.searchParams.append(u,`sr.${m}`),this}rangeGte(u,m){return this.url.searchParams.append(u,`nxl.${m}`),this}rangeLt(u,m){return this.url.searchParams.append(u,`sl.${m}`),this}rangeLte(u,m){return this.url.searchParams.append(u,`nxr.${m}`),this}rangeAdjacent(u,m){return this.url.searchParams.append(u,`adj.${m}`),this}overlaps(u,m){return typeof m=="string"?this.url.searchParams.append(u,`ov.${m}`):this.url.searchParams.append(u,`ov.{${m.join(",")}}`),this}textSearch(u,m,{config:E,type:w}={}){let C="";w==="plain"?C="pl":w==="phrase"?C="ph":w==="websearch"&&(C="w");const T=E===void 0?"":`(${E})`;return this.url.searchParams.append(u,`${C}fts${T}.${m}`),this}match(u){return Object.entries(u).forEach(([m,E])=>{this.url.searchParams.append(m,`eq.${E}`)}),this}not(u,m,E){return this.url.searchParams.append(u,`not.${m}.${E}`),this}or(u,{foreignTable:m,referencedTable:E=m}={}){const w=E?`${E}.or`:"or";return this.url.searchParams.append(w,`(${u})`),this}filter(u,m,E){return this.url.searchParams.append(u,`${m}.${E}`),this}}return dy.default=c,dy}var H6;function wz(){if(H6)return Ay;H6=1,Object.defineProperty(Ay,"__esModule",{value:!0});const s=If.__importDefault(pB());class a{constructor(A,{headers:u={},schema:m,fetch:E}){this.url=A,this.headers=new Headers(u),this.schema=m,this.fetch=E}select(A,u){const{head:m=!1,count:E}=u??{},w=m?"HEAD":"GET";let C=!1;const T=(A??"*").split("").map(N=>/\s/.test(N)&&!C?"":(N==='"'&&(C=!C),N)).join("");return this.url.searchParams.set("select",T),E&&this.headers.append("Prefer",`count=${E}`),new s.default({method:w,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch})}insert(A,{count:u,defaultToNull:m=!0}={}){var E;const w="POST";if(u&&this.headers.append("Prefer",`count=${u}`),m||this.headers.append("Prefer","missing=default"),Array.isArray(A)){const C=A.reduce((T,N)=>T.concat(Object.keys(N)),[]);if(C.length>0){const T=[...new Set(C)].map(N=>`"${N}"`);this.url.searchParams.set("columns",T.join(","))}}return new s.default({method:w,url:this.url,headers:this.headers,schema:this.schema,body:A,fetch:(E=this.fetch)!==null&&E!==void 0?E:fetch})}upsert(A,{onConflict:u,ignoreDuplicates:m=!1,count:E,defaultToNull:w=!0}={}){var C;const T="POST";if(this.headers.append("Prefer",`resolution=${m?"ignore":"merge"}-duplicates`),u!==void 0&&this.url.searchParams.set("on_conflict",u),E&&this.headers.append("Prefer",`count=${E}`),w||this.headers.append("Prefer","missing=default"),Array.isArray(A)){const N=A.reduce((B,k)=>B.concat(Object.keys(k)),[]);if(N.length>0){const B=[...new Set(N)].map(k=>`"${k}"`);this.url.searchParams.set("columns",B.join(","))}}return new s.default({method:T,url:this.url,headers:this.headers,schema:this.schema,body:A,fetch:(C=this.fetch)!==null&&C!==void 0?C:fetch})}update(A,{count:u}={}){var m;const E="PATCH";return u&&this.headers.append("Prefer",`count=${u}`),new s.default({method:E,url:this.url,headers:this.headers,schema:this.schema,body:A,fetch:(m=this.fetch)!==null&&m!==void 0?m:fetch})}delete({count:A}={}){var u;const m="DELETE";return A&&this.headers.append("Prefer",`count=${A}`),new s.default({method:m,url:this.url,headers:this.headers,schema:this.schema,fetch:(u=this.fetch)!==null&&u!==void 0?u:fetch})}}return Ay.default=a,Ay}var G6;function Wme(){if(G6)return ly;G6=1,Object.defineProperty(ly,"__esModule",{value:!0});const r=If,s=r.__importDefault(wz()),a=r.__importDefault(pB());class c{constructor(u,{headers:m={},schema:E,fetch:w}={}){this.url=u,this.headers=new Headers(m),this.schemaName=E,this.fetch=w}from(u){if(!u||typeof u!="string"||u.trim()==="")throw new Error("Invalid relation name: relation must be a non-empty string.");const m=new URL(`${this.url}/${u}`);return new s.default(m,{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(u){return new c(this.url,{headers:this.headers,schema:u,fetch:this.fetch})}rpc(u,m={},{head:E=!1,get:w=!1,count:C}={}){var T;let N;const B=new URL(`${this.url}/rpc/${u}`);let k;E||w?(N=E?"HEAD":"GET",Object.entries(m).filter(([K,Y])=>Y!==void 0).map(([K,Y])=>[K,Array.isArray(Y)?`{${Y.join(",")}}`:`${Y}`]).forEach(([K,Y])=>{B.searchParams.append(K,Y)})):(N="POST",k=m);const Q=new Headers(this.headers);return C&&Q.set("Prefer",`count=${C}`),new a.default({method:N,url:B,headers:Q,schema:this.schemaName,body:k,fetch:(T=this.fetch)!==null&&T!==void 0?T:fetch})}}return ly.default=c,ly}Object.defineProperty(Bi,"__esModule",{value:!0});var bz=Bi.PostgrestError=Bz=Bi.PostgrestBuilder=xz=Bi.PostgrestTransformBuilder=Nz=Bi.PostgrestFilterBuilder=Rz=Bi.PostgrestQueryBuilder=Cz=Bi.PostgrestClient=void 0;const Nf=If,Sz=Nf.__importDefault(Wme());var Cz=Bi.PostgrestClient=Sz.default;const Tz=Nf.__importDefault(wz());var Rz=Bi.PostgrestQueryBuilder=Tz.default;const Iz=Nf.__importDefault(pB());var Nz=Bi.PostgrestFilterBuilder=Iz.default;const Oz=Nf.__importDefault(yz());var xz=Bi.PostgrestTransformBuilder=Oz.default;const Dz=Nf.__importDefault(vz());var Bz=Bi.PostgrestBuilder=Dz.default;const kz=Nf.__importDefault(Ez());bz=Bi.PostgrestError=kz.default;var Lz=Bi.default={PostgrestClient:Sz.default,PostgrestQueryBuilder:Tz.default,PostgrestFilterBuilder:Iz.default,PostgrestTransformBuilder:Oz.default,PostgrestBuilder:Dz.default,PostgrestError:kz.default};const Yme=xK({__proto__:null,get PostgrestBuilder(){return Bz},get PostgrestClient(){return Cz},get PostgrestError(){return bz},get PostgrestFilterBuilder(){return Nz},get PostgrestQueryBuilder(){return Rz},get PostgrestTransformBuilder(){return xz},default:Lz},[Bi]),{PostgrestClient:zme,PostgrestQueryBuilder:pIe,PostgrestFilterBuilder:fIe,PostgrestTransformBuilder:mIe,PostgrestBuilder:gIe,PostgrestError:_Ie}=Lz||Yme;class qme{constructor(){}static detectEnvironment(){var s;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((s=navigator.userAgent)===null||s===void 0)&&s.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};if(typeof process<"u"){const a=process.versions;if(a&&a.node){const c=a.node,A=parseInt(c.replace(/^v/,"").split(".")[0]);return A>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${A} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${A} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const s=this.detectEnvironment();if(s.constructor)return s.constructor;let a=s.error||"WebSocket not supported in this environment.";throw s.workaround&&(a+=`

Suggested solution: ${s.workaround}`),new Error(a)}static createWebSocket(s,a){const c=this.getWebSocketConstructor();return new c(s,a)}static isWebSocketSupported(){try{const s=this.detectEnvironment();return s.type==="native"||s.type==="ws"}catch{return!1}}}const Xme="2.84.0",Jme=`realtime-js/${Xme}`,Uz="1.0.0",$me="2.0.0",K6=Uz,Rx=1e4,Zme=1e3,ege=100;var mu;(function(r){r[r.connecting=0]="connecting",r[r.open=1]="open",r[r.closing=2]="closing",r[r.closed=3]="closed"})(mu||(mu={}));var Ns;(function(r){r.closed="closed",r.errored="errored",r.joined="joined",r.joining="joining",r.leaving="leaving"})(Ns||(Ns={}));var ec;(function(r){r.close="phx_close",r.error="phx_error",r.join="phx_join",r.reply="phx_reply",r.leave="phx_leave",r.access_token="access_token"})(ec||(ec={}));var Ix;(function(r){r.websocket="websocket"})(Ix||(Ix={}));var gu;(function(r){r.Connecting="connecting",r.Open="open",r.Closing="closing",r.Closed="closed"})(gu||(gu={}));class tge{constructor(){this.HEADER_LENGTH=1,this.META_LENGTH=4,this.USER_BROADCAST_PUSH_META_LENGTH=5,this.KINDS={userBroadcastPush:3,userBroadcast:4},this.BINARY_ENCODING=0,this.JSON_ENCODING=1,this.BROADCAST_EVENT="broadcast"}encode(s,a){if(s.event===this.BROADCAST_EVENT&&!(s.payload instanceof ArrayBuffer)&&typeof s.payload.event=="string")return a(this._binaryEncodeUserBroadcastPush(s));let c=[s.join_ref,s.ref,s.topic,s.event,s.payload];return a(JSON.stringify(c))}_binaryEncodeUserBroadcastPush(s){var a;return this._isArrayBuffer((a=s.payload)===null||a===void 0?void 0:a.payload)?this._encodeBinaryUserBroadcastPush(s):this._encodeJsonUserBroadcastPush(s)}_encodeBinaryUserBroadcastPush(s){var a,c,A,u;const m=s.topic,E=(a=s.ref)!==null&&a!==void 0?a:"",w=(c=s.join_ref)!==null&&c!==void 0?c:"",C=s.payload.event,T=(u=(A=s.payload)===null||A===void 0?void 0:A.payload)!==null&&u!==void 0?u:new ArrayBuffer(0),N=this.USER_BROADCAST_PUSH_META_LENGTH+w.length+E.length+m.length+C.length,B=new ArrayBuffer(this.HEADER_LENGTH+N);let k=new DataView(B),Q=0;k.setUint8(Q++,this.KINDS.userBroadcastPush),k.setUint8(Q++,w.length),k.setUint8(Q++,E.length),k.setUint8(Q++,m.length),k.setUint8(Q++,C.length),k.setUint8(Q++,this.BINARY_ENCODING),Array.from(w,Y=>k.setUint8(Q++,Y.charCodeAt(0))),Array.from(E,Y=>k.setUint8(Q++,Y.charCodeAt(0))),Array.from(m,Y=>k.setUint8(Q++,Y.charCodeAt(0))),Array.from(C,Y=>k.setUint8(Q++,Y.charCodeAt(0)));var K=new Uint8Array(B.byteLength+T.byteLength);return K.set(new Uint8Array(B),0),K.set(new Uint8Array(T),B.byteLength),K.buffer}_encodeJsonUserBroadcastPush(s){var a,c,A,u;const m=s.topic,E=(a=s.ref)!==null&&a!==void 0?a:"",w=(c=s.join_ref)!==null&&c!==void 0?c:"",C=s.payload.event,T=(u=(A=s.payload)===null||A===void 0?void 0:A.payload)!==null&&u!==void 0?u:{},B=new TextEncoder().encode(JSON.stringify(T)).buffer,k=this.USER_BROADCAST_PUSH_META_LENGTH+w.length+E.length+m.length+C.length,Q=new ArrayBuffer(this.HEADER_LENGTH+k);let K=new DataView(Q),Y=0;K.setUint8(Y++,this.KINDS.userBroadcastPush),K.setUint8(Y++,w.length),K.setUint8(Y++,E.length),K.setUint8(Y++,m.length),K.setUint8(Y++,C.length),K.setUint8(Y++,this.JSON_ENCODING),Array.from(w,M=>K.setUint8(Y++,M.charCodeAt(0))),Array.from(E,M=>K.setUint8(Y++,M.charCodeAt(0))),Array.from(m,M=>K.setUint8(Y++,M.charCodeAt(0))),Array.from(C,M=>K.setUint8(Y++,M.charCodeAt(0)));var F=new Uint8Array(Q.byteLength+B.byteLength);return F.set(new Uint8Array(Q),0),F.set(new Uint8Array(B),Q.byteLength),F.buffer}decode(s,a){if(this._isArrayBuffer(s)){let c=this._binaryDecode(s);return a(c)}if(typeof s=="string"){const c=JSON.parse(s),[A,u,m,E,w]=c;return a({join_ref:A,ref:u,topic:m,event:E,payload:w})}return a({})}_binaryDecode(s){const a=new DataView(s),c=a.getUint8(0),A=new TextDecoder;switch(c){case this.KINDS.userBroadcast:return this._decodeUserBroadcast(s,a,A)}}_decodeUserBroadcast(s,a,c){const A=a.getUint8(1),u=a.getUint8(2),m=a.getUint8(3),E=a.getUint8(4);let w=this.HEADER_LENGTH+4;const C=c.decode(s.slice(w,w+A));w=w+A;const T=c.decode(s.slice(w,w+u));w=w+u;const N=c.decode(s.slice(w,w+m));w=w+m;const B=s.slice(w,s.byteLength),k=E===this.JSON_ENCODING?JSON.parse(c.decode(B)):B,Q={type:this.BROADCAST_EVENT,event:T,payload:k};return m>0&&(Q.meta=JSON.parse(N)),{join_ref:null,ref:null,topic:C,event:this.BROADCAST_EVENT,payload:Q}}_isArrayBuffer(s){var a;return s instanceof ArrayBuffer||((a=s==null?void 0:s.constructor)===null||a===void 0?void 0:a.name)==="ArrayBuffer"}}class Pz{constructor(s,a){this.callback=s,this.timerCalc=a,this.timer=void 0,this.tries=0,this.callback=s,this.timerCalc=a}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var _r;(function(r){r.abstime="abstime",r.bool="bool",r.date="date",r.daterange="daterange",r.float4="float4",r.float8="float8",r.int2="int2",r.int4="int4",r.int4range="int4range",r.int8="int8",r.int8range="int8range",r.json="json",r.jsonb="jsonb",r.money="money",r.numeric="numeric",r.oid="oid",r.reltime="reltime",r.text="text",r.time="time",r.timestamp="timestamp",r.timestamptz="timestamptz",r.timetz="timetz",r.tsrange="tsrange",r.tstzrange="tstzrange"})(_r||(_r={}));const W6=(r,s,a={})=>{var c;const A=(c=a.skipTypes)!==null&&c!==void 0?c:[];return s?Object.keys(s).reduce((u,m)=>(u[m]=nge(m,r,s,A),u),{}):{}},nge=(r,s,a,c)=>{const A=s.find(E=>E.name===r),u=A==null?void 0:A.type,m=a[r];return u&&!c.includes(u)?Mz(u,m):Nx(m)},Mz=(r,s)=>{if(r.charAt(0)==="_"){const a=r.slice(1,r.length);return age(s,a)}switch(r){case _r.bool:return rge(s);case _r.float4:case _r.float8:case _r.int2:case _r.int4:case _r.int8:case _r.numeric:case _r.oid:return sge(s);case _r.json:case _r.jsonb:return ige(s);case _r.timestamp:return oge(s);case _r.abstime:case _r.date:case _r.daterange:case _r.int4range:case _r.int8range:case _r.money:case _r.reltime:case _r.text:case _r.time:case _r.timestamptz:case _r.timetz:case _r.tsrange:case _r.tstzrange:return Nx(s);default:return Nx(s)}},Nx=r=>r,rge=r=>{switch(r){case"t":return!0;case"f":return!1;default:return r}},sge=r=>{if(typeof r=="string"){const s=parseFloat(r);if(!Number.isNaN(s))return s}return r},ige=r=>{if(typeof r=="string")try{return JSON.parse(r)}catch(s){return console.log(`JSON parse error: ${s}`),r}return r},age=(r,s)=>{if(typeof r!="string")return r;const a=r.length-1,c=r[a];if(r[0]==="{"&&c==="}"){let u;const m=r.slice(1,a);try{u=JSON.parse("["+m+"]")}catch{u=m?m.split(","):[]}return u.map(E=>Mz(s,E))}return r},oge=r=>typeof r=="string"?r.replace(" ","T"):r,Fz=r=>{const s=new URL(r);return s.protocol=s.protocol.replace(/^ws/i,"http"),s.pathname=s.pathname.replace(/\/+$/,"").replace(/\/socket\/websocket$/i,"").replace(/\/socket$/i,"").replace(/\/websocket$/i,""),s.pathname===""||s.pathname==="/"?s.pathname="/api/broadcast":s.pathname=s.pathname+"/api/broadcast",s.href};class KN{constructor(s,a,c={},A=Rx){this.channel=s,this.event=a,this.payload=c,this.timeout=A,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(s){this.timeout=s,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(s){this.payload=Object.assign(Object.assign({},this.payload),s)}receive(s,a){var c;return this._hasReceived(s)&&a((c=this.receivedResp)===null||c===void 0?void 0:c.response),this.recHooks.push({status:s,callback:a}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const s=a=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=a,this._matchReceive(a)};this.channel._on(this.refEvent,{},s),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(s,a){this.refEvent&&this.channel._trigger(this.refEvent,{status:s,response:a})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:s,response:a}){this.recHooks.filter(c=>c.status===s).forEach(c=>c.callback(a))}_hasReceived(s){return this.receivedResp&&this.receivedResp.status===s}}var Y6;(function(r){r.SYNC="sync",r.JOIN="join",r.LEAVE="leave"})(Y6||(Y6={}));class Xg{constructor(s,a){this.channel=s,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const c=(a==null?void 0:a.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(c.state,{},A=>{const{onJoin:u,onLeave:m,onSync:E}=this.caller;this.joinRef=this.channel._joinRef(),this.state=Xg.syncState(this.state,A,u,m),this.pendingDiffs.forEach(w=>{this.state=Xg.syncDiff(this.state,w,u,m)}),this.pendingDiffs=[],E()}),this.channel._on(c.diff,{},A=>{const{onJoin:u,onLeave:m,onSync:E}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(A):(this.state=Xg.syncDiff(this.state,A,u,m),E())}),this.onJoin((A,u,m)=>{this.channel._trigger("presence",{event:"join",key:A,currentPresences:u,newPresences:m})}),this.onLeave((A,u,m)=>{this.channel._trigger("presence",{event:"leave",key:A,currentPresences:u,leftPresences:m})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(s,a,c,A){const u=this.cloneDeep(s),m=this.transformState(a),E={},w={};return this.map(u,(C,T)=>{m[C]||(w[C]=T)}),this.map(m,(C,T)=>{const N=u[C];if(N){const B=T.map(Y=>Y.presence_ref),k=N.map(Y=>Y.presence_ref),Q=T.filter(Y=>k.indexOf(Y.presence_ref)<0),K=N.filter(Y=>B.indexOf(Y.presence_ref)<0);Q.length>0&&(E[C]=Q),K.length>0&&(w[C]=K)}else E[C]=T}),this.syncDiff(u,{joins:E,leaves:w},c,A)}static syncDiff(s,a,c,A){const{joins:u,leaves:m}={joins:this.transformState(a.joins),leaves:this.transformState(a.leaves)};return c||(c=()=>{}),A||(A=()=>{}),this.map(u,(E,w)=>{var C;const T=(C=s[E])!==null&&C!==void 0?C:[];if(s[E]=this.cloneDeep(w),T.length>0){const N=s[E].map(k=>k.presence_ref),B=T.filter(k=>N.indexOf(k.presence_ref)<0);s[E].unshift(...B)}c(E,T,w)}),this.map(m,(E,w)=>{let C=s[E];if(!C)return;const T=w.map(N=>N.presence_ref);C=C.filter(N=>T.indexOf(N.presence_ref)<0),s[E]=C,A(E,C,w),C.length===0&&delete s[E]}),s}static map(s,a){return Object.getOwnPropertyNames(s).map(c=>a(c,s[c]))}static transformState(s){return s=this.cloneDeep(s),Object.getOwnPropertyNames(s).reduce((a,c)=>{const A=s[c];return"metas"in A?a[c]=A.metas.map(u=>(u.presence_ref=u.phx_ref,delete u.phx_ref,delete u.phx_ref_prev,u)):a[c]=A,a},{})}static cloneDeep(s){return JSON.parse(JSON.stringify(s))}onJoin(s){this.caller.onJoin=s}onLeave(s){this.caller.onLeave=s}onSync(s){this.caller.onSync=s}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var z6;(function(r){r.ALL="*",r.INSERT="INSERT",r.UPDATE="UPDATE",r.DELETE="DELETE"})(z6||(z6={}));var Jg;(function(r){r.BROADCAST="broadcast",r.PRESENCE="presence",r.POSTGRES_CHANGES="postgres_changes",r.SYSTEM="system"})(Jg||(Jg={}));var dl;(function(r){r.SUBSCRIBED="SUBSCRIBED",r.TIMED_OUT="TIMED_OUT",r.CLOSED="CLOSED",r.CHANNEL_ERROR="CHANNEL_ERROR"})(dl||(dl={}));class fB{constructor(s,a={config:{}},c){var A,u;if(this.topic=s,this.params=a,this.socket=c,this.bindings={},this.state=Ns.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=s.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},a.config),this.timeout=this.socket.timeout,this.joinPush=new KN(this,ec.join,this.params,this.timeout),this.rejoinTimer=new Pz(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=Ns.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(m=>m.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=Ns.closed,this.socket._remove(this)}),this._onError(m=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,m),this.state=Ns.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=Ns.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",m=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,m),this.state=Ns.errored,this.rejoinTimer.scheduleTimeout())}),this._on(ec.reply,{},(m,E)=>{this._trigger(this._replyEventName(E),m)}),this.presence=new Xg(this),this.broadcastEndpointURL=Fz(this.socket.endPoint),this.private=this.params.config.private||!1,!this.private&&(!((u=(A=this.params.config)===null||A===void 0?void 0:A.broadcast)===null||u===void 0)&&u.replay))throw`tried to use replay on public channel '${this.topic}'. It must be a private channel.`}subscribe(s,a=this.timeout){var c,A,u;if(this.socket.isConnected()||this.socket.connect(),this.state==Ns.closed){const{config:{broadcast:m,presence:E,private:w}}=this.params,C=(A=(c=this.bindings.postgres_changes)===null||c===void 0?void 0:c.map(k=>k.filter))!==null&&A!==void 0?A:[],T=!!this.bindings[Jg.PRESENCE]&&this.bindings[Jg.PRESENCE].length>0||((u=this.params.config.presence)===null||u===void 0?void 0:u.enabled)===!0,N={},B={broadcast:m,presence:Object.assign(Object.assign({},E),{enabled:T}),postgres_changes:C,private:w};this.socket.accessTokenValue&&(N.access_token=this.socket.accessTokenValue),this._onError(k=>s==null?void 0:s(dl.CHANNEL_ERROR,k)),this._onClose(()=>s==null?void 0:s(dl.CLOSED)),this.updateJoinPayload(Object.assign({config:B},N)),this.joinedOnce=!0,this._rejoin(a),this.joinPush.receive("ok",async({postgres_changes:k})=>{var Q;if(this.socket.setAuth(),k===void 0){s==null||s(dl.SUBSCRIBED);return}else{const K=this.bindings.postgres_changes,Y=(Q=K==null?void 0:K.length)!==null&&Q!==void 0?Q:0,F=[];for(let M=0;M<Y;M++){const V=K[M],{filter:{event:W,schema:q,table:te,filter:re}}=V,de=k&&k[M];if(de&&de.event===W&&de.schema===q&&de.table===te&&de.filter===re)F.push(Object.assign(Object.assign({},V),{id:de.id}));else{this.unsubscribe(),this.state=Ns.errored,s==null||s(dl.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=F,s&&s(dl.SUBSCRIBED);return}}).receive("error",k=>{this.state=Ns.errored,s==null||s(dl.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(k).join(", ")||"error")))}).receive("timeout",()=>{s==null||s(dl.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(s,a={}){return await this.send({type:"presence",event:"track",payload:s},a.timeout||this.timeout)}async untrack(s={}){return await this.send({type:"presence",event:"untrack"},s)}on(s,a,c){return this.state===Ns.joined&&s===Jg.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(()=>this.subscribe())),this._on(s,a,c)}async httpSend(s,a,c={}){var A;const u=this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"";if(a==null)return Promise.reject("Payload is required for httpSend()");const m={method:"POST",headers:{Authorization:u,apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:s,payload:a,private:this.private}]})},E=await this._fetchWithTimeout(this.broadcastEndpointURL,m,(A=c.timeout)!==null&&A!==void 0?A:this.timeout);if(E.status===202)return{success:!0};let w=E.statusText;try{const C=await E.json();w=C.error||C.message||w}catch{}return Promise.reject(new Error(w))}async send(s,a={}){var c,A;if(!this._canPush()&&s.type==="broadcast"){console.warn("Realtime send() is automatically falling back to REST API. This behavior will be deprecated in the future. Please use httpSend() explicitly for REST delivery.");const{event:u,payload:m}=s,w={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:u,payload:m,private:this.private}]})};try{const C=await this._fetchWithTimeout(this.broadcastEndpointURL,w,(c=a.timeout)!==null&&c!==void 0?c:this.timeout);return await((A=C.body)===null||A===void 0?void 0:A.cancel()),C.ok?"ok":"error"}catch(C){return C.name==="AbortError"?"timed out":"error"}}else return new Promise(u=>{var m,E,w;const C=this._push(s.type,s,a.timeout||this.timeout);s.type==="broadcast"&&!(!((w=(E=(m=this.params)===null||m===void 0?void 0:m.config)===null||E===void 0?void 0:E.broadcast)===null||w===void 0)&&w.ack)&&u("ok"),C.receive("ok",()=>u("ok")),C.receive("error",()=>u("error")),C.receive("timeout",()=>u("timed out"))})}updateJoinPayload(s){this.joinPush.updatePayload(s)}unsubscribe(s=this.timeout){this.state=Ns.leaving;const a=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(ec.close,"leave",this._joinRef())};this.joinPush.destroy();let c=null;return new Promise(A=>{c=new KN(this,ec.leave,{},s),c.receive("ok",()=>{a(),A("ok")}).receive("timeout",()=>{a(),A("timed out")}).receive("error",()=>{A("error")}),c.send(),this._canPush()||c.trigger("ok",{})}).finally(()=>{c==null||c.destroy()})}teardown(){this.pushBuffer.forEach(s=>s.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=Ns.closed,this.bindings={}}async _fetchWithTimeout(s,a,c){const A=new AbortController,u=setTimeout(()=>A.abort(),c),m=await this.socket.fetch(s,Object.assign(Object.assign({},a),{signal:A.signal}));return clearTimeout(u),m}_push(s,a,c=this.timeout){if(!this.joinedOnce)throw`tried to push '${s}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let A=new KN(this,s,a,c);return this._canPush()?A.send():this._addToPushBuffer(A),A}_addToPushBuffer(s){if(s.startTimeout(),this.pushBuffer.push(s),this.pushBuffer.length>ege){const a=this.pushBuffer.shift();a&&(a.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${a.event}`,a.payload))}}_onMessage(s,a,c){return a}_isMember(s){return this.topic===s}_joinRef(){return this.joinPush.ref}_trigger(s,a,c){var A,u;const m=s.toLocaleLowerCase(),{close:E,error:w,leave:C,join:T}=ec;if(c&&[E,w,C,T].indexOf(m)>=0&&c!==this._joinRef())return;let B=this._onMessage(m,a,c);if(a&&!B)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(m)?(A=this.bindings.postgres_changes)===null||A===void 0||A.filter(k=>{var Q,K,Y;return((Q=k.filter)===null||Q===void 0?void 0:Q.event)==="*"||((Y=(K=k.filter)===null||K===void 0?void 0:K.event)===null||Y===void 0?void 0:Y.toLocaleLowerCase())===m}).map(k=>k.callback(B,c)):(u=this.bindings[m])===null||u===void 0||u.filter(k=>{var Q,K,Y,F,M,V;if(["broadcast","presence","postgres_changes"].includes(m))if("id"in k){const W=k.id,q=(Q=k.filter)===null||Q===void 0?void 0:Q.event;return W&&((K=a.ids)===null||K===void 0?void 0:K.includes(W))&&(q==="*"||(q==null?void 0:q.toLocaleLowerCase())===((Y=a.data)===null||Y===void 0?void 0:Y.type.toLocaleLowerCase()))}else{const W=(M=(F=k==null?void 0:k.filter)===null||F===void 0?void 0:F.event)===null||M===void 0?void 0:M.toLocaleLowerCase();return W==="*"||W===((V=a==null?void 0:a.event)===null||V===void 0?void 0:V.toLocaleLowerCase())}else return k.type.toLocaleLowerCase()===m}).map(k=>{if(typeof B=="object"&&"ids"in B){const Q=B.data,{schema:K,table:Y,commit_timestamp:F,type:M,errors:V}=Q;B=Object.assign(Object.assign({},{schema:K,table:Y,commit_timestamp:F,eventType:M,new:{},old:{},errors:V}),this._getPayloadRecords(Q))}k.callback(B,c)})}_isClosed(){return this.state===Ns.closed}_isJoined(){return this.state===Ns.joined}_isJoining(){return this.state===Ns.joining}_isLeaving(){return this.state===Ns.leaving}_replyEventName(s){return`chan_reply_${s}`}_on(s,a,c){const A=s.toLocaleLowerCase(),u={type:A,filter:a,callback:c};return this.bindings[A]?this.bindings[A].push(u):this.bindings[A]=[u],this}_off(s,a){const c=s.toLocaleLowerCase();return this.bindings[c]&&(this.bindings[c]=this.bindings[c].filter(A=>{var u;return!(((u=A.type)===null||u===void 0?void 0:u.toLocaleLowerCase())===c&&fB.isEqual(A.filter,a))})),this}static isEqual(s,a){if(Object.keys(s).length!==Object.keys(a).length)return!1;for(const c in s)if(s[c]!==a[c])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(s){this._on(ec.close,{},s)}_onError(s){this._on(ec.error,{},a=>s(a))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(s=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=Ns.joining,this.joinPush.resend(s))}_getPayloadRecords(s){const a={new:{},old:{}};return(s.type==="INSERT"||s.type==="UPDATE")&&(a.new=W6(s.columns,s.record)),(s.type==="UPDATE"||s.type==="DELETE")&&(a.old=W6(s.columns,s.old_record)),a}}const WN=()=>{},fy={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},cge=[1e3,2e3,5e3,1e4],lge=1e4,Age=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class dge{constructor(s,a){var c;if(this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=Rx,this.transport=null,this.heartbeatIntervalMs=fy.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=WN,this.ref=0,this.reconnectTimer=null,this.vsn=K6,this.logger=WN,this.conn=null,this.sendBuffer=[],this.serializer=new tge,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._resolveFetch=A=>A?(...u)=>A(...u):(...u)=>fetch(...u),!(!((c=a==null?void 0:a.params)===null||c===void 0)&&c.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=a.params.apikey,this.endPoint=`${s}/${Ix.websocket}`,this.httpEndpoint=Fz(s),this._initializeOptions(a),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(a==null?void 0:a.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this.accessToken&&!this._authPromise&&this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=qme.createWebSocket(this.endpointURL())}catch(s){this._setConnectionState("disconnected");const a=s.message;throw a.includes("Node.js")?new Error(`${a}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${a}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:this.vsn}))}disconnect(s,a){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const c=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(c),this._setConnectionState("disconnected")},typeof this.conn.close=="function"&&(s?this.conn.close(s,a??""):this.conn.close()),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(s){const a=await s.unsubscribe();return this.channels.length===0&&this.disconnect(),a}async removeAllChannels(){const s=await Promise.all(this.channels.map(a=>a.unsubscribe()));return this.channels=[],this.disconnect(),s}log(s,a,c){this.logger(s,a,c)}connectionState(){switch(this.conn&&this.conn.readyState){case mu.connecting:return gu.Connecting;case mu.open:return gu.Open;case mu.closing:return gu.Closing;default:return gu.Closed}}isConnected(){return this.connectionState()===gu.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(s,a={config:{}}){const c=`realtime:${s}`,A=this.getChannels().find(u=>u.topic===c);if(A)return A;{const u=new fB(`realtime:${s}`,a,this);return this.channels.push(u),u}}push(s){const{topic:a,event:c,payload:A,ref:u}=s,m=()=>{this.encode(s,E=>{var w;(w=this.conn)===null||w===void 0||w.send(E)})};this.log("push",`${a} ${c} (${u})`,A),this.isConnected()?m():this.sendBuffer.push(m)}async setAuth(s=null){this._authPromise=this._performAuth(s);try{await this._authPromise}finally{this._authPromise=null}}async sendHeartbeat(){var s;if(!this.isConnected()){try{this.heartbeatCallback("disconnected")}catch(a){this.log("error","error in heartbeat callback",a)}return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(a){this.log("error","error in heartbeat callback",a)}this._wasManualDisconnect=!1,(s=this.conn)===null||s===void 0||s.close(Zme,"heartbeat timeout"),setTimeout(()=>{var a;this.isConnected()||(a=this.reconnectTimer)===null||a===void 0||a.scheduleTimeout()},fy.HEARTBEAT_TIMEOUT_FALLBACK);return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(a){this.log("error","error in heartbeat callback",a)}this._setAuthSafely("heartbeat")}onHeartbeat(s){this.heartbeatCallback=s}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(s=>s()),this.sendBuffer=[])}_makeRef(){let s=this.ref+1;return s===this.ref?this.ref=0:this.ref=s,this.ref.toString()}_leaveOpenTopic(s){let a=this.channels.find(c=>c.topic===s&&(c._isJoined()||c._isJoining()));a&&(this.log("transport",`leaving duplicate topic "${s}"`),a.unsubscribe())}_remove(s){this.channels=this.channels.filter(a=>a.topic!==s.topic)}_onConnMessage(s){this.decode(s.data,a=>{if(a.topic==="phoenix"&&a.event==="phx_reply")try{this.heartbeatCallback(a.payload.status==="ok"?"ok":"error")}catch(C){this.log("error","error in heartbeat callback",C)}a.ref&&a.ref===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null);const{topic:c,event:A,payload:u,ref:m}=a,E=m?`(${m})`:"",w=u.status||"";this.log("receive",`${w} ${c} ${A} ${E}`.trim(),u),this.channels.filter(C=>C._isMember(c)).forEach(C=>C._trigger(A,u,m)),this._triggerStateCallbacks("message",a)})}_clearTimer(s){var a;s==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):s==="reconnect"&&((a=this.reconnectTimer)===null||a===void 0||a.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=s=>this._onConnError(s),this.conn.onmessage=s=>this._onConnMessage(s),this.conn.onclose=s=>this._onConnClose(s))}_teardownConnection(){if(this.conn){if(this.conn.readyState===mu.open||this.conn.readyState===mu.connecting)try{this.conn.close()}catch(s){this.log("error","Error closing connection",s)}this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null}this._clearAllTimers(),this.channels.forEach(s=>s.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),(this._authPromise||(this.accessToken&&!this.accessTokenValue?this.setAuth():Promise.resolve())).then(()=>{this.flushSendBuffer()}).catch(a=>{this.log("error","error waiting for auth on connect",a),this.flushSendBuffer()}),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const s=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(s),this.workerRef.onerror=a=>{this.log("worker","worker error",a.message),this.workerRef.terminate()},this.workerRef.onmessage=a=>{a.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(s){var a;this._setConnectionState("disconnected"),this.log("transport","close",s),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(a=this.reconnectTimer)===null||a===void 0||a.scheduleTimeout(),this._triggerStateCallbacks("close",s)}_onConnError(s){this._setConnectionState("disconnected"),this.log("transport",`${s}`),this._triggerChanError(),this._triggerStateCallbacks("error",s)}_triggerChanError(){this.channels.forEach(s=>s._trigger(ec.error))}_appendParams(s,a){if(Object.keys(a).length===0)return s;const c=s.match(/\?/)?"&":"?",A=new URLSearchParams(a);return`${s}${c}${A}`}_workerObjectUrl(s){let a;if(s)a=s;else{const c=new Blob([Age],{type:"application/javascript"});a=URL.createObjectURL(c)}return a}_setConnectionState(s,a=!1){this._connectionState=s,s==="connecting"?this._wasManualDisconnect=!1:s==="disconnecting"&&(this._wasManualDisconnect=a)}async _performAuth(s=null){let a;s?a=s:this.accessToken?a=await this.accessToken():a=this.accessTokenValue,this.accessTokenValue!=a&&(this.accessTokenValue=a,this.channels.forEach(c=>{const A={access_token:a,version:Jme};a&&c.updateJoinPayload(A),c.joinedOnce&&c._isJoined()&&c._push(ec.access_token,{access_token:a})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(s="general"){this.setAuth().catch(a=>{this.log("error",`error setting auth in ${s}`,a)})}_triggerStateCallbacks(s,a){try{this.stateChangeCallbacks[s].forEach(c=>{try{c(a)}catch(A){this.log("error",`error in ${s} callback`,A)}})}catch(c){this.log("error",`error triggering ${s} callbacks`,c)}}_setupReconnectionTimer(){this.reconnectTimer=new Pz(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},fy.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(s){var a,c,A,u,m,E,w,C,T,N,B,k;switch(this.transport=(a=s==null?void 0:s.transport)!==null&&a!==void 0?a:null,this.timeout=(c=s==null?void 0:s.timeout)!==null&&c!==void 0?c:Rx,this.heartbeatIntervalMs=(A=s==null?void 0:s.heartbeatIntervalMs)!==null&&A!==void 0?A:fy.HEARTBEAT_INTERVAL,this.worker=(u=s==null?void 0:s.worker)!==null&&u!==void 0?u:!1,this.accessToken=(m=s==null?void 0:s.accessToken)!==null&&m!==void 0?m:null,this.heartbeatCallback=(E=s==null?void 0:s.heartbeatCallback)!==null&&E!==void 0?E:WN,this.vsn=(w=s==null?void 0:s.vsn)!==null&&w!==void 0?w:K6,s!=null&&s.params&&(this.params=s.params),s!=null&&s.logger&&(this.logger=s.logger),(s!=null&&s.logLevel||s!=null&&s.log_level)&&(this.logLevel=s.logLevel||s.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(C=s==null?void 0:s.reconnectAfterMs)!==null&&C!==void 0?C:Q=>cge[Q-1]||lge,this.vsn){case Uz:this.encode=(T=s==null?void 0:s.encode)!==null&&T!==void 0?T:(Q,K)=>K(JSON.stringify(Q)),this.decode=(N=s==null?void 0:s.decode)!==null&&N!==void 0?N:(Q,K)=>K(JSON.parse(Q));break;case $me:this.encode=(B=s==null?void 0:s.encode)!==null&&B!==void 0?B:this.serializer.encode.bind(this.serializer),this.decode=(k=s==null?void 0:s.decode)!==null&&k!==void 0?k:this.serializer.decode.bind(this.serializer);break;default:throw new Error(`Unsupported serializer version: ${this.vsn}`)}if(this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=s==null?void 0:s.workerUrl}}}class mB extends Error{constructor(s){super(s),this.__isStorageError=!0,this.name="StorageError"}}function zr(r){return typeof r=="object"&&r!==null&&"__isStorageError"in r}class uge extends mB{constructor(s,a,c){super(s),this.name="StorageApiError",this.status=a,this.statusCode=c}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class Ox extends mB{constructor(s,a){super(s),this.name="StorageUnknownError",this.originalError=a}}const gB=r=>r?(...s)=>r(...s):(...s)=>fetch(...s),hge=()=>Response,xx=r=>{if(Array.isArray(r))return r.map(a=>xx(a));if(typeof r=="function"||r!==Object(r))return r;const s={};return Object.entries(r).forEach(([a,c])=>{const A=a.replace(/([-_][a-z])/gi,u=>u.toUpperCase().replace(/[-_]/g,""));s[A]=xx(c)}),s},pge=r=>{if(typeof r!="object"||r===null)return!1;const s=Object.getPrototypeOf(r);return(s===null||s===Object.prototype||Object.getPrototypeOf(s)===null)&&!(Symbol.toStringTag in r)&&!(Symbol.iterator in r)},YN=r=>{var s;return r.msg||r.message||r.error_description||(typeof r.error=="string"?r.error:(s=r.error)===null||s===void 0?void 0:s.message)||JSON.stringify(r)},fge=(r,s,a)=>vt(void 0,void 0,void 0,function*(){const c=yield hge();r instanceof c&&!(a!=null&&a.noResolveJson)?r.json().then(A=>{const u=r.status||500,m=(A==null?void 0:A.statusCode)||u+"";s(new uge(YN(A),u,m))}).catch(A=>{s(new Ox(YN(A),A))}):s(new Ox(YN(r),r))}),mge=(r,s,a,c)=>{const A={method:r,headers:(s==null?void 0:s.headers)||{}};return r==="GET"||!c?A:(pge(c)?(A.headers=Object.assign({"Content-Type":"application/json"},s==null?void 0:s.headers),A.body=JSON.stringify(c)):A.body=c,s!=null&&s.duplex&&(A.duplex=s.duplex),Object.assign(Object.assign({},A),a))};function G_(r,s,a,c,A,u){return vt(this,void 0,void 0,function*(){return new Promise((m,E)=>{r(a,mge(s,c,A,u)).then(w=>{if(!w.ok)throw w;return c!=null&&c.noResolveJson?w:w.json()}).then(w=>m(w)).catch(w=>fge(w,E,c))})})}function E_(r,s,a,c){return vt(this,void 0,void 0,function*(){return G_(r,"GET",s,a,c)})}function $o(r,s,a,c,A){return vt(this,void 0,void 0,function*(){return G_(r,"POST",s,c,A,a)})}function Dx(r,s,a,c,A){return vt(this,void 0,void 0,function*(){return G_(r,"PUT",s,c,A,a)})}function gge(r,s,a,c){return vt(this,void 0,void 0,function*(){return G_(r,"HEAD",s,Object.assign(Object.assign({},a),{noResolveJson:!0}),c)})}function _B(r,s,a,c,A){return vt(this,void 0,void 0,function*(){return G_(r,"DELETE",s,c,A,a)})}class _ge{constructor(s,a){this.downloadFn=s,this.shouldThrowOnError=a}then(s,a){return this.execute().then(s,a)}execute(){return vt(this,void 0,void 0,function*(){try{return{data:(yield this.downloadFn()).body,error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(zr(s))return{data:null,error:s};throw s}})}}var jz;class Ege{constructor(s,a){this.downloadFn=s,this.shouldThrowOnError=a,this[jz]="BlobDownloadBuilder",this.promise=null}asStream(){return new _ge(this.downloadFn,this.shouldThrowOnError)}then(s,a){return this.getPromise().then(s,a)}catch(s){return this.getPromise().catch(s)}finally(s){return this.getPromise().finally(s)}getPromise(){return this.promise||(this.promise=this.execute()),this.promise}execute(){return vt(this,void 0,void 0,function*(){try{return{data:yield(yield this.downloadFn()).blob(),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(zr(s))return{data:null,error:s};throw s}})}}jz=Symbol.toStringTag;const vge={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},q6={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class yge{constructor(s,a={},c,A){this.shouldThrowOnError=!1,this.url=s,this.headers=a,this.bucketId=c,this.fetch=gB(A)}throwOnError(){return this.shouldThrowOnError=!0,this}uploadOrUpdate(s,a,c,A){return vt(this,void 0,void 0,function*(){try{let u;const m=Object.assign(Object.assign({},q6),A);let E=Object.assign(Object.assign({},this.headers),s==="POST"&&{"x-upsert":String(m.upsert)});const w=m.metadata;typeof Blob<"u"&&c instanceof Blob?(u=new FormData,u.append("cacheControl",m.cacheControl),w&&u.append("metadata",this.encodeMetadata(w)),u.append("",c)):typeof FormData<"u"&&c instanceof FormData?(u=c,u.has("cacheControl")||u.append("cacheControl",m.cacheControl),w&&!u.has("metadata")&&u.append("metadata",this.encodeMetadata(w))):(u=c,E["cache-control"]=`max-age=${m.cacheControl}`,E["content-type"]=m.contentType,w&&(E["x-metadata"]=this.toBase64(this.encodeMetadata(w))),(typeof ReadableStream<"u"&&u instanceof ReadableStream||u&&typeof u=="object"&&"pipe"in u&&typeof u.pipe=="function")&&!m.duplex&&(m.duplex="half")),A!=null&&A.headers&&(E=Object.assign(Object.assign({},E),A.headers));const C=this._removeEmptyFolders(a),T=this._getFinalPath(C),N=yield(s=="PUT"?Dx:$o)(this.fetch,`${this.url}/object/${T}`,u,Object.assign({headers:E},m!=null&&m.duplex?{duplex:m.duplex}:{}));return{data:{path:C,id:N.Id,fullPath:N.Key},error:null}}catch(u){if(this.shouldThrowOnError)throw u;if(zr(u))return{data:null,error:u};throw u}})}upload(s,a,c){return vt(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",s,a,c)})}uploadToSignedUrl(s,a,c,A){return vt(this,void 0,void 0,function*(){const u=this._removeEmptyFolders(s),m=this._getFinalPath(u),E=new URL(this.url+`/object/upload/sign/${m}`);E.searchParams.set("token",a);try{let w;const C=Object.assign({upsert:q6.upsert},A),T=Object.assign(Object.assign({},this.headers),{"x-upsert":String(C.upsert)});typeof Blob<"u"&&c instanceof Blob?(w=new FormData,w.append("cacheControl",C.cacheControl),w.append("",c)):typeof FormData<"u"&&c instanceof FormData?(w=c,w.append("cacheControl",C.cacheControl)):(w=c,T["cache-control"]=`max-age=${C.cacheControl}`,T["content-type"]=C.contentType);const N=yield Dx(this.fetch,E.toString(),w,{headers:T});return{data:{path:u,fullPath:N.Key},error:null}}catch(w){if(this.shouldThrowOnError)throw w;if(zr(w))return{data:null,error:w};throw w}})}createSignedUploadUrl(s,a){return vt(this,void 0,void 0,function*(){try{let c=this._getFinalPath(s);const A=Object.assign({},this.headers);a!=null&&a.upsert&&(A["x-upsert"]="true");const u=yield $o(this.fetch,`${this.url}/object/upload/sign/${c}`,{},{headers:A}),m=new URL(this.url+u.url),E=m.searchParams.get("token");if(!E)throw new mB("No token returned by API");return{data:{signedUrl:m.toString(),path:s,token:E},error:null}}catch(c){if(this.shouldThrowOnError)throw c;if(zr(c))return{data:null,error:c};throw c}})}update(s,a,c){return vt(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",s,a,c)})}move(s,a,c){return vt(this,void 0,void 0,function*(){try{return{data:yield $o(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:s,destinationKey:a,destinationBucket:c==null?void 0:c.destinationBucket},{headers:this.headers}),error:null}}catch(A){if(this.shouldThrowOnError)throw A;if(zr(A))return{data:null,error:A};throw A}})}copy(s,a,c){return vt(this,void 0,void 0,function*(){try{return{data:{path:(yield $o(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:s,destinationKey:a,destinationBucket:c==null?void 0:c.destinationBucket},{headers:this.headers})).Key},error:null}}catch(A){if(this.shouldThrowOnError)throw A;if(zr(A))return{data:null,error:A};throw A}})}createSignedUrl(s,a,c){return vt(this,void 0,void 0,function*(){try{let A=this._getFinalPath(s),u=yield $o(this.fetch,`${this.url}/object/sign/${A}`,Object.assign({expiresIn:a},c!=null&&c.transform?{transform:c.transform}:{}),{headers:this.headers});const m=c!=null&&c.download?`&download=${c.download===!0?"":c.download}`:"";return u={signedUrl:encodeURI(`${this.url}${u.signedURL}${m}`)},{data:u,error:null}}catch(A){if(this.shouldThrowOnError)throw A;if(zr(A))return{data:null,error:A};throw A}})}createSignedUrls(s,a,c){return vt(this,void 0,void 0,function*(){try{const A=yield $o(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:a,paths:s},{headers:this.headers}),u=c!=null&&c.download?`&download=${c.download===!0?"":c.download}`:"";return{data:A.map(m=>Object.assign(Object.assign({},m),{signedUrl:m.signedURL?encodeURI(`${this.url}${m.signedURL}${u}`):null})),error:null}}catch(A){if(this.shouldThrowOnError)throw A;if(zr(A))return{data:null,error:A};throw A}})}download(s,a){const A=typeof(a==null?void 0:a.transform)<"u"?"render/image/authenticated":"object",u=this.transformOptsToQueryString((a==null?void 0:a.transform)||{}),m=u?`?${u}`:"",E=this._getFinalPath(s),w=()=>E_(this.fetch,`${this.url}/${A}/${E}${m}`,{headers:this.headers,noResolveJson:!0});return new Ege(w,this.shouldThrowOnError)}info(s){return vt(this,void 0,void 0,function*(){const a=this._getFinalPath(s);try{const c=yield E_(this.fetch,`${this.url}/object/info/${a}`,{headers:this.headers});return{data:xx(c),error:null}}catch(c){if(this.shouldThrowOnError)throw c;if(zr(c))return{data:null,error:c};throw c}})}exists(s){return vt(this,void 0,void 0,function*(){const a=this._getFinalPath(s);try{return yield gge(this.fetch,`${this.url}/object/${a}`,{headers:this.headers}),{data:!0,error:null}}catch(c){if(this.shouldThrowOnError)throw c;if(zr(c)&&c instanceof Ox){const A=c.originalError;if([400,404].includes(A==null?void 0:A.status))return{data:!1,error:c}}throw c}})}getPublicUrl(s,a){const c=this._getFinalPath(s),A=[],u=a!=null&&a.download?`download=${a.download===!0?"":a.download}`:"";u!==""&&A.push(u);const E=typeof(a==null?void 0:a.transform)<"u"?"render/image":"object",w=this.transformOptsToQueryString((a==null?void 0:a.transform)||{});w!==""&&A.push(w);let C=A.join("&");return C!==""&&(C=`?${C}`),{data:{publicUrl:encodeURI(`${this.url}/${E}/public/${c}${C}`)}}}remove(s){return vt(this,void 0,void 0,function*(){try{return{data:yield _B(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:s},{headers:this.headers}),error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(zr(a))return{data:null,error:a};throw a}})}list(s,a,c){return vt(this,void 0,void 0,function*(){try{const A=Object.assign(Object.assign(Object.assign({},vge),a),{prefix:s||""});return{data:yield $o(this.fetch,`${this.url}/object/list/${this.bucketId}`,A,{headers:this.headers},c),error:null}}catch(A){if(this.shouldThrowOnError)throw A;if(zr(A))return{data:null,error:A};throw A}})}listV2(s,a){return vt(this,void 0,void 0,function*(){try{const c=Object.assign({},s);return{data:yield $o(this.fetch,`${this.url}/object/list-v2/${this.bucketId}`,c,{headers:this.headers},a),error:null}}catch(c){if(this.shouldThrowOnError)throw c;if(zr(c))return{data:null,error:c};throw c}})}encodeMetadata(s){return JSON.stringify(s)}toBase64(s){return typeof Buffer<"u"?Buffer.from(s).toString("base64"):btoa(s)}_getFinalPath(s){return`${this.bucketId}/${s.replace(/^\/+/,"")}`}_removeEmptyFolders(s){return s.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(s){const a=[];return s.width&&a.push(`width=${s.width}`),s.height&&a.push(`height=${s.height}`),s.resize&&a.push(`resize=${s.resize}`),s.format&&a.push(`format=${s.format}`),s.quality&&a.push(`quality=${s.quality}`),a.join("&")}}const Vz="2.84.0",Qz={"X-Client-Info":`storage-js/${Vz}`};class wge{constructor(s,a={},c,A){this.shouldThrowOnError=!1;const u=new URL(s);A!=null&&A.useNewHostname&&/supabase\.(co|in|red)$/.test(u.hostname)&&!u.hostname.includes("storage.supabase.")&&(u.hostname=u.hostname.replace("supabase.","storage.supabase.")),this.url=u.href.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},Qz),a),this.fetch=gB(c)}throwOnError(){return this.shouldThrowOnError=!0,this}listBuckets(s){return vt(this,void 0,void 0,function*(){try{const a=this.listBucketOptionsToQueryString(s);return{data:yield E_(this.fetch,`${this.url}/bucket${a}`,{headers:this.headers}),error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(zr(a))return{data:null,error:a};throw a}})}getBucket(s){return vt(this,void 0,void 0,function*(){try{return{data:yield E_(this.fetch,`${this.url}/bucket/${s}`,{headers:this.headers}),error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(zr(a))return{data:null,error:a};throw a}})}createBucket(s){return vt(this,arguments,void 0,function*(a,c={public:!1}){try{return{data:yield $o(this.fetch,`${this.url}/bucket`,{id:a,name:a,type:c.type,public:c.public,file_size_limit:c.fileSizeLimit,allowed_mime_types:c.allowedMimeTypes},{headers:this.headers}),error:null}}catch(A){if(this.shouldThrowOnError)throw A;if(zr(A))return{data:null,error:A};throw A}})}updateBucket(s,a){return vt(this,void 0,void 0,function*(){try{return{data:yield Dx(this.fetch,`${this.url}/bucket/${s}`,{id:s,name:s,public:a.public,file_size_limit:a.fileSizeLimit,allowed_mime_types:a.allowedMimeTypes},{headers:this.headers}),error:null}}catch(c){if(this.shouldThrowOnError)throw c;if(zr(c))return{data:null,error:c};throw c}})}emptyBucket(s){return vt(this,void 0,void 0,function*(){try{return{data:yield $o(this.fetch,`${this.url}/bucket/${s}/empty`,{},{headers:this.headers}),error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(zr(a))return{data:null,error:a};throw a}})}deleteBucket(s){return vt(this,void 0,void 0,function*(){try{return{data:yield _B(this.fetch,`${this.url}/bucket/${s}`,{},{headers:this.headers}),error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(zr(a))return{data:null,error:a};throw a}})}listBucketOptionsToQueryString(s){const a={};return s&&("limit"in s&&(a.limit=String(s.limit)),"offset"in s&&(a.offset=String(s.offset)),s.search&&(a.search=s.search),s.sortColumn&&(a.sortColumn=s.sortColumn),s.sortOrder&&(a.sortOrder=s.sortOrder)),Object.keys(a).length>0?"?"+new URLSearchParams(a).toString():""}}class bge{constructor(s,a={},c){this.shouldThrowOnError=!1,this.url=s.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},Qz),a),this.fetch=gB(c)}throwOnError(){return this.shouldThrowOnError=!0,this}createBucket(s){return vt(this,void 0,void 0,function*(){try{return{data:yield $o(this.fetch,`${this.url}/bucket`,{name:s},{headers:this.headers}),error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(zr(a))return{data:null,error:a};throw a}})}listBuckets(s){return vt(this,void 0,void 0,function*(){try{const a=new URLSearchParams;(s==null?void 0:s.limit)!==void 0&&a.set("limit",s.limit.toString()),(s==null?void 0:s.offset)!==void 0&&a.set("offset",s.offset.toString()),s!=null&&s.sortColumn&&a.set("sortColumn",s.sortColumn),s!=null&&s.sortOrder&&a.set("sortOrder",s.sortOrder),s!=null&&s.search&&a.set("search",s.search);const c=a.toString(),A=c?`${this.url}/bucket?${c}`:`${this.url}/bucket`;return{data:yield E_(this.fetch,A,{headers:this.headers}),error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(zr(a))return{data:null,error:a};throw a}})}deleteBucket(s){return vt(this,void 0,void 0,function*(){try{return{data:yield _B(this.fetch,`${this.url}/bucket/${s}`,{},{headers:this.headers}),error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(zr(a))return{data:null,error:a};throw a}})}}const EB={"X-Client-Info":`storage-js/${Vz}`,"Content-Type":"application/json"};class Hz extends Error{constructor(s){super(s),this.__isStorageVectorsError=!0,this.name="StorageVectorsError"}}function Ia(r){return typeof r=="object"&&r!==null&&"__isStorageVectorsError"in r}class zN extends Hz{constructor(s,a,c){super(s),this.name="StorageVectorsApiError",this.status=a,this.statusCode=c}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class Sge extends Hz{constructor(s,a){super(s),this.name="StorageVectorsUnknownError",this.originalError=a}}var X6;(function(r){r.InternalError="InternalError",r.S3VectorConflictException="S3VectorConflictException",r.S3VectorNotFoundException="S3VectorNotFoundException",r.S3VectorBucketNotEmpty="S3VectorBucketNotEmpty",r.S3VectorMaxBucketsExceeded="S3VectorMaxBucketsExceeded",r.S3VectorMaxIndexesExceeded="S3VectorMaxIndexesExceeded"})(X6||(X6={}));const vB=r=>r?(...s)=>r(...s):(...s)=>fetch(...s),Cge=r=>{if(typeof r!="object"||r===null)return!1;const s=Object.getPrototypeOf(r);return(s===null||s===Object.prototype||Object.getPrototypeOf(s)===null)&&!(Symbol.toStringTag in r)&&!(Symbol.iterator in r)},J6=r=>r.msg||r.message||r.error_description||r.error||JSON.stringify(r),Tge=(r,s,a)=>vt(void 0,void 0,void 0,function*(){if(r&&typeof r=="object"&&"status"in r&&"ok"in r&&typeof r.status=="number"&&!(a!=null&&a.noResolveJson)){const A=r.status||500,u=r;if(typeof u.json=="function")u.json().then(m=>{const E=(m==null?void 0:m.statusCode)||(m==null?void 0:m.code)||A+"";s(new zN(J6(m),A,E))}).catch(()=>{const m=A+"",E=u.statusText||`HTTP ${A} error`;s(new zN(E,A,m))});else{const m=A+"",E=u.statusText||`HTTP ${A} error`;s(new zN(E,A,m))}}else s(new Sge(J6(r),r))}),Rge=(r,s,a,c)=>{const A={method:r,headers:(s==null?void 0:s.headers)||{}};return c?(Cge(c)?(A.headers=Object.assign({"Content-Type":"application/json"},s==null?void 0:s.headers),A.body=JSON.stringify(c)):A.body=c,Object.assign(Object.assign({},A),a)):A};function Ige(r,s,a,c,A,u){return vt(this,void 0,void 0,function*(){return new Promise((m,E)=>{r(a,Rge(s,c,A,u)).then(w=>{if(!w.ok)throw w;if(c!=null&&c.noResolveJson)return w;const C=w.headers.get("content-type");return!C||!C.includes("application/json")?{}:w.json()}).then(w=>m(w)).catch(w=>Tge(w,E,c))})})}function Na(r,s,a,c,A){return vt(this,void 0,void 0,function*(){return Ige(r,"POST",s,c,A,a)})}class Nge{constructor(s,a={},c){this.shouldThrowOnError=!1,this.url=s.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},EB),a),this.fetch=vB(c)}throwOnError(){return this.shouldThrowOnError=!0,this}createIndex(s){return vt(this,void 0,void 0,function*(){try{return{data:(yield Na(this.fetch,`${this.url}/CreateIndex`,s,{headers:this.headers}))||{},error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(Ia(a))return{data:null,error:a};throw a}})}getIndex(s,a){return vt(this,void 0,void 0,function*(){try{return{data:yield Na(this.fetch,`${this.url}/GetIndex`,{vectorBucketName:s,indexName:a},{headers:this.headers}),error:null}}catch(c){if(this.shouldThrowOnError)throw c;if(Ia(c))return{data:null,error:c};throw c}})}listIndexes(s){return vt(this,void 0,void 0,function*(){try{return{data:yield Na(this.fetch,`${this.url}/ListIndexes`,s,{headers:this.headers}),error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(Ia(a))return{data:null,error:a};throw a}})}deleteIndex(s,a){return vt(this,void 0,void 0,function*(){try{return{data:(yield Na(this.fetch,`${this.url}/DeleteIndex`,{vectorBucketName:s,indexName:a},{headers:this.headers}))||{},error:null}}catch(c){if(this.shouldThrowOnError)throw c;if(Ia(c))return{data:null,error:c};throw c}})}}class Oge{constructor(s,a={},c){this.shouldThrowOnError=!1,this.url=s.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},EB),a),this.fetch=vB(c)}throwOnError(){return this.shouldThrowOnError=!0,this}putVectors(s){return vt(this,void 0,void 0,function*(){try{if(s.vectors.length<1||s.vectors.length>500)throw new Error("Vector batch size must be between 1 and 500 items");return{data:(yield Na(this.fetch,`${this.url}/PutVectors`,s,{headers:this.headers}))||{},error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(Ia(a))return{data:null,error:a};throw a}})}getVectors(s){return vt(this,void 0,void 0,function*(){try{return{data:yield Na(this.fetch,`${this.url}/GetVectors`,s,{headers:this.headers}),error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(Ia(a))return{data:null,error:a};throw a}})}listVectors(s){return vt(this,void 0,void 0,function*(){try{if(s.segmentCount!==void 0){if(s.segmentCount<1||s.segmentCount>16)throw new Error("segmentCount must be between 1 and 16");if(s.segmentIndex!==void 0&&(s.segmentIndex<0||s.segmentIndex>=s.segmentCount))throw new Error(`segmentIndex must be between 0 and ${s.segmentCount-1}`)}return{data:yield Na(this.fetch,`${this.url}/ListVectors`,s,{headers:this.headers}),error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(Ia(a))return{data:null,error:a};throw a}})}queryVectors(s){return vt(this,void 0,void 0,function*(){try{return{data:yield Na(this.fetch,`${this.url}/QueryVectors`,s,{headers:this.headers}),error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(Ia(a))return{data:null,error:a};throw a}})}deleteVectors(s){return vt(this,void 0,void 0,function*(){try{if(s.keys.length<1||s.keys.length>500)throw new Error("Keys batch size must be between 1 and 500 items");return{data:(yield Na(this.fetch,`${this.url}/DeleteVectors`,s,{headers:this.headers}))||{},error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(Ia(a))return{data:null,error:a};throw a}})}}class xge{constructor(s,a={},c){this.shouldThrowOnError=!1,this.url=s.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},EB),a),this.fetch=vB(c)}throwOnError(){return this.shouldThrowOnError=!0,this}createBucket(s){return vt(this,void 0,void 0,function*(){try{return{data:(yield Na(this.fetch,`${this.url}/CreateVectorBucket`,{vectorBucketName:s},{headers:this.headers}))||{},error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(Ia(a))return{data:null,error:a};throw a}})}getBucket(s){return vt(this,void 0,void 0,function*(){try{return{data:yield Na(this.fetch,`${this.url}/GetVectorBucket`,{vectorBucketName:s},{headers:this.headers}),error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(Ia(a))return{data:null,error:a};throw a}})}listBuckets(){return vt(this,arguments,void 0,function*(s={}){try{return{data:yield Na(this.fetch,`${this.url}/ListVectorBuckets`,s,{headers:this.headers}),error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(Ia(a))return{data:null,error:a};throw a}})}deleteBucket(s){return vt(this,void 0,void 0,function*(){try{return{data:(yield Na(this.fetch,`${this.url}/DeleteVectorBucket`,{vectorBucketName:s},{headers:this.headers}))||{},error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(Ia(a))return{data:null,error:a};throw a}})}}class Dge extends xge{constructor(s,a={}){super(s,a.headers||{},a.fetch)}from(s){return new Bge(this.url,this.headers,s,this.fetch)}}class Bge extends Nge{constructor(s,a,c,A){super(s,a,A),this.vectorBucketName=c}createIndex(s){const a=Object.create(null,{createIndex:{get:()=>super.createIndex}});return vt(this,void 0,void 0,function*(){return a.createIndex.call(this,Object.assign(Object.assign({},s),{vectorBucketName:this.vectorBucketName}))})}listIndexes(){const s=Object.create(null,{listIndexes:{get:()=>super.listIndexes}});return vt(this,arguments,void 0,function*(a={}){return s.listIndexes.call(this,Object.assign(Object.assign({},a),{vectorBucketName:this.vectorBucketName}))})}getIndex(s){const a=Object.create(null,{getIndex:{get:()=>super.getIndex}});return vt(this,void 0,void 0,function*(){return a.getIndex.call(this,this.vectorBucketName,s)})}deleteIndex(s){const a=Object.create(null,{deleteIndex:{get:()=>super.deleteIndex}});return vt(this,void 0,void 0,function*(){return a.deleteIndex.call(this,this.vectorBucketName,s)})}index(s){return new kge(this.url,this.headers,this.vectorBucketName,s,this.fetch)}}class kge extends Oge{constructor(s,a,c,A,u){super(s,a,u),this.vectorBucketName=c,this.indexName=A}putVectors(s){const a=Object.create(null,{putVectors:{get:()=>super.putVectors}});return vt(this,void 0,void 0,function*(){return a.putVectors.call(this,Object.assign(Object.assign({},s),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}getVectors(s){const a=Object.create(null,{getVectors:{get:()=>super.getVectors}});return vt(this,void 0,void 0,function*(){return a.getVectors.call(this,Object.assign(Object.assign({},s),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}listVectors(){const s=Object.create(null,{listVectors:{get:()=>super.listVectors}});return vt(this,arguments,void 0,function*(a={}){return s.listVectors.call(this,Object.assign(Object.assign({},a),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}queryVectors(s){const a=Object.create(null,{queryVectors:{get:()=>super.queryVectors}});return vt(this,void 0,void 0,function*(){return a.queryVectors.call(this,Object.assign(Object.assign({},s),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}deleteVectors(s){const a=Object.create(null,{deleteVectors:{get:()=>super.deleteVectors}});return vt(this,void 0,void 0,function*(){return a.deleteVectors.call(this,Object.assign(Object.assign({},s),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}}class Lge extends wge{constructor(s,a={},c,A){super(s,a,c,A)}from(s){return new yge(this.url,this.headers,s,this.fetch)}get vectors(){return new Dge(this.url+"/vector",{headers:this.headers,fetch:this.fetch})}get analytics(){return new bge(this.url+"/iceberg",this.headers,this.fetch)}}const Uge="2.84.0";let Rg="";typeof Deno<"u"?Rg="deno":typeof document<"u"?Rg="web":typeof navigator<"u"&&navigator.product==="ReactNative"?Rg="react-native":Rg="node";const Pge={"X-Client-Info":`supabase-js-${Rg}/${Uge}`},Mge={headers:Pge},Fge={schema:"public"},jge={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},Vge={},Qge=r=>r?(...s)=>r(...s):(...s)=>fetch(...s),Hge=()=>Headers,Gge=(r,s,a)=>{const c=Qge(a),A=Hge();return async(u,m)=>{var E;const w=(E=await s())!==null&&E!==void 0?E:r;let C=new A(m==null?void 0:m.headers);return C.has("apikey")||C.set("apikey",r),C.has("Authorization")||C.set("Authorization",`Bearer ${w}`),c(u,Object.assign(Object.assign({},m),{headers:C}))}};function Kge(r){return r.endsWith("/")?r:r+"/"}function Wge(r,s){var a,c;const{db:A,auth:u,realtime:m,global:E}=r,{db:w,auth:C,realtime:T,global:N}=s,B={db:Object.assign(Object.assign({},w),A),auth:Object.assign(Object.assign({},C),u),realtime:Object.assign(Object.assign({},T),m),storage:{},global:Object.assign(Object.assign(Object.assign({},N),E),{headers:Object.assign(Object.assign({},(a=N==null?void 0:N.headers)!==null&&a!==void 0?a:{}),(c=E==null?void 0:E.headers)!==null&&c!==void 0?c:{})}),accessToken:async()=>""};return r.accessToken?B.accessToken=r.accessToken:delete B.accessToken,B}function Yge(r){const s=r==null?void 0:r.trim();if(!s)throw new Error("supabaseUrl is required.");if(!s.match(/^https?:\/\//i))throw new Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL(Kge(s))}catch{throw Error("Invalid supabaseUrl: Provided URL is malformed.")}}const Gz="2.84.0",Ip=30*1e3,Bx=3,qN=Bx*Ip,zge="http://localhost:9999",qge="supabase.auth.token",Xge={"X-Client-Info":`gotrue-js/${Gz}`},kx="X-Supabase-Api-Version",Kz={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},Jge=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,$ge=10*60*1e3;class v_ extends Error{constructor(s,a,c){super(s),this.__isAuthError=!0,this.name="AuthError",this.status=a,this.code=c}}function Rt(r){return typeof r=="object"&&r!==null&&"__isAuthError"in r}class Zge extends v_{constructor(s,a,c){super(s,a,c),this.name="AuthApiError",this.status=a,this.code=c}}function e_e(r){return Rt(r)&&r.name==="AuthApiError"}class _u extends v_{constructor(s,a){super(s),this.name="AuthUnknownError",this.originalError=a}}class td extends v_{constructor(s,a,c,A){super(s,c,A),this.name=a,this.status=c}}class ya extends td{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function t_e(r){return Rt(r)&&r.name==="AuthSessionMissingError"}class hp extends td{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class my extends td{constructor(s){super(s,"AuthInvalidCredentialsError",400,void 0)}}class gy extends td{constructor(s,a=null){super(s,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=a}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function n_e(r){return Rt(r)&&r.name==="AuthImplicitGrantRedirectError"}class $6 extends td{constructor(s,a=null){super(s,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=a}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class Lx extends td{constructor(s,a){super(s,"AuthRetryableFetchError",a,void 0)}}function XN(r){return Rt(r)&&r.name==="AuthRetryableFetchError"}class Z6 extends td{constructor(s,a,c){super(s,"AuthWeakPasswordError",a,"weak_password"),this.reasons=c}}class Ux extends td{constructor(s){super(s,"AuthInvalidJwtError",400,"invalid_jwt")}}const Pw="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),eG=` 	
\r=`.split(""),r_e=(()=>{const r=new Array(128);for(let s=0;s<r.length;s+=1)r[s]=-1;for(let s=0;s<eG.length;s+=1)r[eG[s].charCodeAt(0)]=-2;for(let s=0;s<Pw.length;s+=1)r[Pw[s].charCodeAt(0)]=s;return r})();function tG(r,s,a){if(r!==null)for(s.queue=s.queue<<8|r,s.queuedBits+=8;s.queuedBits>=6;){const c=s.queue>>s.queuedBits-6&63;a(Pw[c]),s.queuedBits-=6}else if(s.queuedBits>0)for(s.queue=s.queue<<6-s.queuedBits,s.queuedBits=6;s.queuedBits>=6;){const c=s.queue>>s.queuedBits-6&63;a(Pw[c]),s.queuedBits-=6}}function Wz(r,s,a){const c=r_e[r];if(c>-1)for(s.queue=s.queue<<6|c,s.queuedBits+=6;s.queuedBits>=8;)a(s.queue>>s.queuedBits-8&255),s.queuedBits-=8;else{if(c===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(r)}"`)}}function nG(r){const s=[],a=m=>{s.push(String.fromCodePoint(m))},c={utf8seq:0,codepoint:0},A={queue:0,queuedBits:0},u=m=>{a_e(m,c,a)};for(let m=0;m<r.length;m+=1)Wz(r.charCodeAt(m),A,u);return s.join("")}function s_e(r,s){if(r<=127){s(r);return}else if(r<=2047){s(192|r>>6),s(128|r&63);return}else if(r<=65535){s(224|r>>12),s(128|r>>6&63),s(128|r&63);return}else if(r<=1114111){s(240|r>>18),s(128|r>>12&63),s(128|r>>6&63),s(128|r&63);return}throw new Error(`Unrecognized Unicode codepoint: ${r.toString(16)}`)}function i_e(r,s){for(let a=0;a<r.length;a+=1){let c=r.charCodeAt(a);if(c>55295&&c<=56319){const A=(c-55296)*1024&65535;c=(r.charCodeAt(a+1)-56320&65535|A)+65536,a+=1}s_e(c,s)}}function a_e(r,s,a){if(s.utf8seq===0){if(r<=127){a(r);return}for(let c=1;c<6;c+=1)if(!(r>>7-c&1)){s.utf8seq=c;break}if(s.utf8seq===2)s.codepoint=r&31;else if(s.utf8seq===3)s.codepoint=r&15;else if(s.utf8seq===4)s.codepoint=r&7;else throw new Error("Invalid UTF-8 sequence");s.utf8seq-=1}else if(s.utf8seq>0){if(r<=127)throw new Error("Invalid UTF-8 sequence");s.codepoint=s.codepoint<<6|r&63,s.utf8seq-=1,s.utf8seq===0&&a(s.codepoint)}}function Zp(r){const s=[],a={queue:0,queuedBits:0},c=A=>{s.push(A)};for(let A=0;A<r.length;A+=1)Wz(r.charCodeAt(A),a,c);return new Uint8Array(s)}function o_e(r){const s=[];return i_e(r,a=>s.push(a)),new Uint8Array(s)}function vu(r){const s=[],a={queue:0,queuedBits:0},c=A=>{s.push(A)};return r.forEach(A=>tG(A,a,c)),tG(null,a,c),s.join("")}function c_e(r){return Math.round(Date.now()/1e3)+r}function l_e(){return Symbol("auth-callback")}const si=()=>typeof window<"u"&&typeof document<"u",nu={tested:!1,writable:!1},Yz=()=>{if(!si())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(nu.tested)return nu.writable;const r=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(r,r),globalThis.localStorage.removeItem(r),nu.tested=!0,nu.writable=!0}catch{nu.tested=!0,nu.writable=!1}return nu.writable};function A_e(r){const s={},a=new URL(r);if(a.hash&&a.hash[0]==="#")try{new URLSearchParams(a.hash.substring(1)).forEach((A,u)=>{s[u]=A})}catch{}return a.searchParams.forEach((c,A)=>{s[A]=c}),s}const zz=r=>r?(...s)=>r(...s):(...s)=>fetch(...s),d_e=r=>typeof r=="object"&&r!==null&&"status"in r&&"ok"in r&&"json"in r&&typeof r.json=="function",Np=async(r,s,a)=>{await r.setItem(s,JSON.stringify(a))},ru=async(r,s)=>{const a=await r.getItem(s);if(!a)return null;try{return JSON.parse(a)}catch{return a}},dA=async(r,s)=>{await r.removeItem(s)};class Cb{constructor(){this.promise=new Cb.promiseConstructor((s,a)=>{this.resolve=s,this.reject=a})}}Cb.promiseConstructor=Promise;function JN(r){const s=r.split(".");if(s.length!==3)throw new Ux("Invalid JWT structure");for(let c=0;c<s.length;c++)if(!Jge.test(s[c]))throw new Ux("JWT not in base64url format");return{header:JSON.parse(nG(s[0])),payload:JSON.parse(nG(s[1])),signature:Zp(s[2]),raw:{header:s[0],payload:s[1]}}}async function u_e(r){return await new Promise(s=>{setTimeout(()=>s(null),r)})}function h_e(r,s){return new Promise((c,A)=>{(async()=>{for(let u=0;u<1/0;u++)try{const m=await r(u);if(!s(u,null,m)){c(m);return}}catch(m){if(!s(u,m)){A(m);return}}})()})}function p_e(r){return("0"+r.toString(16)).substr(-2)}function f_e(){const s=new Uint32Array(56);if(typeof crypto>"u"){const a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",c=a.length;let A="";for(let u=0;u<56;u++)A+=a.charAt(Math.floor(Math.random()*c));return A}return crypto.getRandomValues(s),Array.from(s,p_e).join("")}async function m_e(r){const a=new TextEncoder().encode(r),c=await crypto.subtle.digest("SHA-256",a),A=new Uint8Array(c);return Array.from(A).map(u=>String.fromCharCode(u)).join("")}async function g_e(r){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),r;const a=await m_e(r);return btoa(a).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function pp(r,s,a=!1){const c=f_e();let A=c;a&&(A+="/PASSWORD_RECOVERY"),await Np(r,`${s}-code-verifier`,A);const u=await g_e(c);return[u,c===u?"plain":"s256"]}const __e=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function E_e(r){const s=r.headers.get(kx);if(!s||!s.match(__e))return null;try{return new Date(`${s}T00:00:00.0Z`)}catch{return null}}function v_e(r){if(!r)throw new Error("Missing exp claim");const s=Math.floor(Date.now()/1e3);if(r<=s)throw new Error("JWT has expired")}function y_e(r){switch(r){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const w_e=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function fp(r){if(!w_e.test(r))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function $N(){const r={};return new Proxy(r,{get:(s,a)=>{if(a==="__isUserNotAvailableProxy")return!0;if(typeof a=="symbol"){const c=a.toString();if(c==="Symbol(Symbol.toPrimitive)"||c==="Symbol(Symbol.toStringTag)"||c==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${a}" property of the session object is not supported. Please use getUser() instead.`)},set:(s,a)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${a}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(s,a)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${a}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function b_e(r,s){return new Proxy(r,{get:(a,c,A)=>{if(c==="__isInsecureUserWarningProxy")return!0;if(typeof c=="symbol"){const u=c.toString();if(u==="Symbol(Symbol.toPrimitive)"||u==="Symbol(Symbol.toStringTag)"||u==="Symbol(util.inspect.custom)"||u==="Symbol(nodejs.util.inspect.custom)")return Reflect.get(a,c,A)}return!s.value&&typeof c=="string"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),s.value=!0),Reflect.get(a,c,A)}})}function rG(r){return JSON.parse(JSON.stringify(r))}const hu=r=>r.msg||r.message||r.error_description||r.error||JSON.stringify(r),S_e=[502,503,504];async function sG(r){var s;if(!d_e(r))throw new Lx(hu(r),0);if(S_e.includes(r.status))throw new Lx(hu(r),r.status);let a;try{a=await r.json()}catch(u){throw new _u(hu(u),u)}let c;const A=E_e(r);if(A&&A.getTime()>=Kz["2024-01-01"].timestamp&&typeof a=="object"&&a&&typeof a.code=="string"?c=a.code:typeof a=="object"&&a&&typeof a.error_code=="string"&&(c=a.error_code),c){if(c==="weak_password")throw new Z6(hu(a),r.status,((s=a.weak_password)===null||s===void 0?void 0:s.reasons)||[]);if(c==="session_not_found")throw new ya}else if(typeof a=="object"&&a&&typeof a.weak_password=="object"&&a.weak_password&&Array.isArray(a.weak_password.reasons)&&a.weak_password.reasons.length&&a.weak_password.reasons.reduce((u,m)=>u&&typeof m=="string",!0))throw new Z6(hu(a),r.status,a.weak_password.reasons);throw new Zge(hu(a),r.status||500,c)}const C_e=(r,s,a,c)=>{const A={method:r,headers:(s==null?void 0:s.headers)||{}};return r==="GET"?A:(A.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},s==null?void 0:s.headers),A.body=JSON.stringify(c),Object.assign(Object.assign({},A),a))};async function Ft(r,s,a,c){var A;const u=Object.assign({},c==null?void 0:c.headers);u[kx]||(u[kx]=Kz["2024-01-01"].name),c!=null&&c.jwt&&(u.Authorization=`Bearer ${c.jwt}`);const m=(A=c==null?void 0:c.query)!==null&&A!==void 0?A:{};c!=null&&c.redirectTo&&(m.redirect_to=c.redirectTo);const E=Object.keys(m).length?"?"+new URLSearchParams(m).toString():"",w=await T_e(r,s,a+E,{headers:u,noResolveJson:c==null?void 0:c.noResolveJson},{},c==null?void 0:c.body);return c!=null&&c.xform?c==null?void 0:c.xform(w):{data:Object.assign({},w),error:null}}async function T_e(r,s,a,c,A,u){const m=C_e(s,c,A,u);let E;try{E=await r(a,Object.assign({},m))}catch(w){throw console.error(w),new Lx(hu(w),0)}if(E.ok||await sG(E),c!=null&&c.noResolveJson)return E;try{return await E.json()}catch(w){await sG(w)}}function Xo(r){var s;let a=null;N_e(r)&&(a=Object.assign({},r),r.expires_at||(a.expires_at=c_e(r.expires_in)));const c=(s=r.user)!==null&&s!==void 0?s:r;return{data:{session:a,user:c},error:null}}function iG(r){const s=Xo(r);return!s.error&&r.weak_password&&typeof r.weak_password=="object"&&Array.isArray(r.weak_password.reasons)&&r.weak_password.reasons.length&&r.weak_password.message&&typeof r.weak_password.message=="string"&&r.weak_password.reasons.reduce((a,c)=>a&&typeof c=="string",!0)&&(s.data.weak_password=r.weak_password),s}function CA(r){var s;return{data:{user:(s=r.user)!==null&&s!==void 0?s:r},error:null}}function R_e(r){return{data:r,error:null}}function I_e(r){const{action_link:s,email_otp:a,hashed_token:c,redirect_to:A,verification_type:u}=r,m=Rf(r,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),E={action_link:s,email_otp:a,hashed_token:c,redirect_to:A,verification_type:u},w=Object.assign({},m);return{data:{properties:E,user:w},error:null}}function aG(r){return r}function N_e(r){return r.access_token&&r.refresh_token&&r.expires_in}const ZN=["global","local","others"];class O_e{constructor({url:s="",headers:a={},fetch:c}){this.url=s,this.headers=a,this.fetch=zz(c),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)},this.oauth={listClients:this._listOAuthClients.bind(this),createClient:this._createOAuthClient.bind(this),getClient:this._getOAuthClient.bind(this),updateClient:this._updateOAuthClient.bind(this),deleteClient:this._deleteOAuthClient.bind(this),regenerateClientSecret:this._regenerateOAuthClientSecret.bind(this)}}async signOut(s,a=ZN[0]){if(ZN.indexOf(a)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${ZN.join(", ")}`);try{return await Ft(this.fetch,"POST",`${this.url}/logout?scope=${a}`,{headers:this.headers,jwt:s,noResolveJson:!0}),{data:null,error:null}}catch(c){if(Rt(c))return{data:null,error:c};throw c}}async inviteUserByEmail(s,a={}){try{return await Ft(this.fetch,"POST",`${this.url}/invite`,{body:{email:s,data:a.data},headers:this.headers,redirectTo:a.redirectTo,xform:CA})}catch(c){if(Rt(c))return{data:{user:null},error:c};throw c}}async generateLink(s){try{const{options:a}=s,c=Rf(s,["options"]),A=Object.assign(Object.assign({},c),a);return"newEmail"in c&&(A.new_email=c==null?void 0:c.newEmail,delete A.newEmail),await Ft(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:A,headers:this.headers,xform:I_e,redirectTo:a==null?void 0:a.redirectTo})}catch(a){if(Rt(a))return{data:{properties:null,user:null},error:a};throw a}}async createUser(s){try{return await Ft(this.fetch,"POST",`${this.url}/admin/users`,{body:s,headers:this.headers,xform:CA})}catch(a){if(Rt(a))return{data:{user:null},error:a};throw a}}async listUsers(s){var a,c,A,u,m,E,w;try{const C={nextPage:null,lastPage:0,total:0},T=await Ft(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(c=(a=s==null?void 0:s.page)===null||a===void 0?void 0:a.toString())!==null&&c!==void 0?c:"",per_page:(u=(A=s==null?void 0:s.perPage)===null||A===void 0?void 0:A.toString())!==null&&u!==void 0?u:""},xform:aG});if(T.error)throw T.error;const N=await T.json(),B=(m=T.headers.get("x-total-count"))!==null&&m!==void 0?m:0,k=(w=(E=T.headers.get("link"))===null||E===void 0?void 0:E.split(","))!==null&&w!==void 0?w:[];return k.length>0&&(k.forEach(Q=>{const K=parseInt(Q.split(";")[0].split("=")[1].substring(0,1)),Y=JSON.parse(Q.split(";")[1].split("=")[1]);C[`${Y}Page`]=K}),C.total=parseInt(B)),{data:Object.assign(Object.assign({},N),C),error:null}}catch(C){if(Rt(C))return{data:{users:[]},error:C};throw C}}async getUserById(s){fp(s);try{return await Ft(this.fetch,"GET",`${this.url}/admin/users/${s}`,{headers:this.headers,xform:CA})}catch(a){if(Rt(a))return{data:{user:null},error:a};throw a}}async updateUserById(s,a){fp(s);try{return await Ft(this.fetch,"PUT",`${this.url}/admin/users/${s}`,{body:a,headers:this.headers,xform:CA})}catch(c){if(Rt(c))return{data:{user:null},error:c};throw c}}async deleteUser(s,a=!1){fp(s);try{return await Ft(this.fetch,"DELETE",`${this.url}/admin/users/${s}`,{headers:this.headers,body:{should_soft_delete:a},xform:CA})}catch(c){if(Rt(c))return{data:{user:null},error:c};throw c}}async _listFactors(s){fp(s.userId);try{const{data:a,error:c}=await Ft(this.fetch,"GET",`${this.url}/admin/users/${s.userId}/factors`,{headers:this.headers,xform:A=>({data:{factors:A},error:null})});return{data:a,error:c}}catch(a){if(Rt(a))return{data:null,error:a};throw a}}async _deleteFactor(s){fp(s.userId),fp(s.id);try{return{data:await Ft(this.fetch,"DELETE",`${this.url}/admin/users/${s.userId}/factors/${s.id}`,{headers:this.headers}),error:null}}catch(a){if(Rt(a))return{data:null,error:a};throw a}}async _listOAuthClients(s){var a,c,A,u,m,E,w;try{const C={nextPage:null,lastPage:0,total:0},T=await Ft(this.fetch,"GET",`${this.url}/admin/oauth/clients`,{headers:this.headers,noResolveJson:!0,query:{page:(c=(a=s==null?void 0:s.page)===null||a===void 0?void 0:a.toString())!==null&&c!==void 0?c:"",per_page:(u=(A=s==null?void 0:s.perPage)===null||A===void 0?void 0:A.toString())!==null&&u!==void 0?u:""},xform:aG});if(T.error)throw T.error;const N=await T.json(),B=(m=T.headers.get("x-total-count"))!==null&&m!==void 0?m:0,k=(w=(E=T.headers.get("link"))===null||E===void 0?void 0:E.split(","))!==null&&w!==void 0?w:[];return k.length>0&&(k.forEach(Q=>{const K=parseInt(Q.split(";")[0].split("=")[1].substring(0,1)),Y=JSON.parse(Q.split(";")[1].split("=")[1]);C[`${Y}Page`]=K}),C.total=parseInt(B)),{data:Object.assign(Object.assign({},N),C),error:null}}catch(C){if(Rt(C))return{data:{clients:[]},error:C};throw C}}async _createOAuthClient(s){try{return await Ft(this.fetch,"POST",`${this.url}/admin/oauth/clients`,{body:s,headers:this.headers,xform:a=>({data:a,error:null})})}catch(a){if(Rt(a))return{data:null,error:a};throw a}}async _getOAuthClient(s){try{return await Ft(this.fetch,"GET",`${this.url}/admin/oauth/clients/${s}`,{headers:this.headers,xform:a=>({data:a,error:null})})}catch(a){if(Rt(a))return{data:null,error:a};throw a}}async _updateOAuthClient(s,a){try{return await Ft(this.fetch,"PUT",`${this.url}/admin/oauth/clients/${s}`,{body:a,headers:this.headers,xform:c=>({data:c,error:null})})}catch(c){if(Rt(c))return{data:null,error:c};throw c}}async _deleteOAuthClient(s){try{return await Ft(this.fetch,"DELETE",`${this.url}/admin/oauth/clients/${s}`,{headers:this.headers,noResolveJson:!0}),{data:null,error:null}}catch(a){if(Rt(a))return{data:null,error:a};throw a}}async _regenerateOAuthClientSecret(s){try{return await Ft(this.fetch,"POST",`${this.url}/admin/oauth/clients/${s}/regenerate_secret`,{headers:this.headers,xform:a=>({data:a,error:null})})}catch(a){if(Rt(a))return{data:null,error:a};throw a}}}function oG(r={}){return{getItem:s=>r[s]||null,setItem:(s,a)=>{r[s]=a},removeItem:s=>{delete r[s]}}}const mp={debug:!!(globalThis&&Yz()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class qz extends Error{constructor(s){super(s),this.isAcquireTimeout=!0}}class x_e extends qz{}async function D_e(r,s,a){mp.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",r,s);const c=new globalThis.AbortController;return s>0&&setTimeout(()=>{c.abort(),mp.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",r)},s),await Promise.resolve().then(()=>globalThis.navigator.locks.request(r,s===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:c.signal},async A=>{if(A){mp.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",r,A.name);try{return await a()}finally{mp.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",r,A.name)}}else{if(s===0)throw mp.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",r),new x_e(`Acquiring an exclusive Navigator LockManager lock "${r}" immediately failed`);if(mp.debug)try{const u=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(u,null,"  "))}catch(u){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",u)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await a()}}))}function B_e(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}function Xz(r){if(!/^0x[a-fA-F0-9]{40}$/.test(r))throw new Error(`@supabase/auth-js: Address "${r}" is invalid.`);return r.toLowerCase()}function k_e(r){return parseInt(r,16)}function L_e(r){const s=new TextEncoder().encode(r);return"0x"+Array.from(s,c=>c.toString(16).padStart(2,"0")).join("")}function U_e(r){var s;const{chainId:a,domain:c,expirationTime:A,issuedAt:u=new Date,nonce:m,notBefore:E,requestId:w,resources:C,scheme:T,uri:N,version:B}=r;{if(!Number.isInteger(a))throw new Error(`@supabase/auth-js: Invalid SIWE message field "chainId". Chain ID must be a EIP-155 chain ID. Provided value: ${a}`);if(!c)throw new Error('@supabase/auth-js: Invalid SIWE message field "domain". Domain must be provided.');if(m&&m.length<8)throw new Error(`@supabase/auth-js: Invalid SIWE message field "nonce". Nonce must be at least 8 characters. Provided value: ${m}`);if(!N)throw new Error('@supabase/auth-js: Invalid SIWE message field "uri". URI must be provided.');if(B!=="1")throw new Error(`@supabase/auth-js: Invalid SIWE message field "version". Version must be '1'. Provided value: ${B}`);if(!((s=r.statement)===null||s===void 0)&&s.includes(`
`))throw new Error(`@supabase/auth-js: Invalid SIWE message field "statement". Statement must not include '\\n'. Provided value: ${r.statement}`)}const k=Xz(r.address),Q=T?`${T}://${c}`:c,K=r.statement?`${r.statement}
`:"",Y=`${Q} wants you to sign in with your Ethereum account:
${k}

${K}`;let F=`URI: ${N}
Version: ${B}
Chain ID: ${a}${m?`
Nonce: ${m}`:""}
Issued At: ${u.toISOString()}`;if(A&&(F+=`
Expiration Time: ${A.toISOString()}`),E&&(F+=`
Not Before: ${E.toISOString()}`),w&&(F+=`
Request ID: ${w}`),C){let M=`
Resources:`;for(const V of C){if(!V||typeof V!="string")throw new Error(`@supabase/auth-js: Invalid SIWE message field "resources". Every resource must be a valid string. Provided value: ${V}`);M+=`
- ${V}`}F+=M}return`${Y}
${F}`}class _s extends Error{constructor({message:s,code:a,cause:c,name:A}){var u;super(s,{cause:c}),this.__isWebAuthnError=!0,this.name=(u=A??(c instanceof Error?c.name:void 0))!==null&&u!==void 0?u:"Unknown Error",this.code=a}}class Mw extends _s{constructor(s,a){super({code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:a,message:s}),this.name="WebAuthnUnknownError",this.originalError=a}}function P_e({error:r,options:s}){var a,c,A;const{publicKey:u}=s;if(!u)throw Error("options was missing required publicKey property");if(r.name==="AbortError"){if(s.signal instanceof AbortSignal)return new _s({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:r})}else if(r.name==="ConstraintError"){if(((a=u.authenticatorSelection)===null||a===void 0?void 0:a.requireResidentKey)===!0)return new _s({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:r});if(s.mediation==="conditional"&&((c=u.authenticatorSelection)===null||c===void 0?void 0:c.userVerification)==="required")return new _s({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:r});if(((A=u.authenticatorSelection)===null||A===void 0?void 0:A.userVerification)==="required")return new _s({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:r})}else{if(r.name==="InvalidStateError")return new _s({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:r});if(r.name==="NotAllowedError")return new _s({message:r.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:r});if(r.name==="NotSupportedError")return u.pubKeyCredParams.filter(E=>E.type==="public-key").length===0?new _s({message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:r}):new _s({message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:r});if(r.name==="SecurityError"){const m=window.location.hostname;if(Jz(m)){if(u.rp.id!==m)return new _s({message:`The RP ID "${u.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:r})}else return new _s({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:r})}else if(r.name==="TypeError"){if(u.user.id.byteLength<1||u.user.id.byteLength>64)return new _s({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:r})}else if(r.name==="UnknownError")return new _s({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:r})}return new _s({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:r})}function M_e({error:r,options:s}){const{publicKey:a}=s;if(!a)throw Error("options was missing required publicKey property");if(r.name==="AbortError"){if(s.signal instanceof AbortSignal)return new _s({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:r})}else{if(r.name==="NotAllowedError")return new _s({message:r.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:r});if(r.name==="SecurityError"){const c=window.location.hostname;if(Jz(c)){if(a.rpId!==c)return new _s({message:`The RP ID "${a.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:r})}else return new _s({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:r})}else if(r.name==="UnknownError")return new _s({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:r})}return new _s({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:r})}class F_e{createNewAbortSignal(){if(this.controller){const a=new Error("Cancelling existing WebAuthn API call for new one");a.name="AbortError",this.controller.abort(a)}const s=new AbortController;return this.controller=s,s.signal}cancelCeremony(){if(this.controller){const s=new Error("Manually cancelling existing WebAuthn API call");s.name="AbortError",this.controller.abort(s),this.controller=void 0}}}const j_e=new F_e;function V_e(r){if(!r)throw new Error("Credential creation options are required");if(typeof PublicKeyCredential<"u"&&"parseCreationOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseCreationOptionsFromJSON=="function")return PublicKeyCredential.parseCreationOptionsFromJSON(r);const{challenge:s,user:a,excludeCredentials:c}=r,A=Rf(r,["challenge","user","excludeCredentials"]),u=Zp(s).buffer,m=Object.assign(Object.assign({},a),{id:Zp(a.id).buffer}),E=Object.assign(Object.assign({},A),{challenge:u,user:m});if(c&&c.length>0){E.excludeCredentials=new Array(c.length);for(let w=0;w<c.length;w++){const C=c[w];E.excludeCredentials[w]=Object.assign(Object.assign({},C),{id:Zp(C.id).buffer,type:C.type||"public-key",transports:C.transports})}}return E}function Q_e(r){if(!r)throw new Error("Credential request options are required");if(typeof PublicKeyCredential<"u"&&"parseRequestOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseRequestOptionsFromJSON=="function")return PublicKeyCredential.parseRequestOptionsFromJSON(r);const{challenge:s,allowCredentials:a}=r,c=Rf(r,["challenge","allowCredentials"]),A=Zp(s).buffer,u=Object.assign(Object.assign({},c),{challenge:A});if(a&&a.length>0){u.allowCredentials=new Array(a.length);for(let m=0;m<a.length;m++){const E=a[m];u.allowCredentials[m]=Object.assign(Object.assign({},E),{id:Zp(E.id).buffer,type:E.type||"public-key",transports:E.transports})}}return u}function H_e(r){var s;if("toJSON"in r&&typeof r.toJSON=="function")return r.toJSON();const a=r;return{id:r.id,rawId:r.id,response:{attestationObject:vu(new Uint8Array(r.response.attestationObject)),clientDataJSON:vu(new Uint8Array(r.response.clientDataJSON))},type:"public-key",clientExtensionResults:r.getClientExtensionResults(),authenticatorAttachment:(s=a.authenticatorAttachment)!==null&&s!==void 0?s:void 0}}function G_e(r){var s;if("toJSON"in r&&typeof r.toJSON=="function")return r.toJSON();const a=r,c=r.getClientExtensionResults(),A=r.response;return{id:r.id,rawId:r.id,response:{authenticatorData:vu(new Uint8Array(A.authenticatorData)),clientDataJSON:vu(new Uint8Array(A.clientDataJSON)),signature:vu(new Uint8Array(A.signature)),userHandle:A.userHandle?vu(new Uint8Array(A.userHandle)):void 0},type:"public-key",clientExtensionResults:c,authenticatorAttachment:(s=a.authenticatorAttachment)!==null&&s!==void 0?s:void 0}}function Jz(r){return r==="localhost"||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(r)}function cG(){var r,s;return!!(si()&&"PublicKeyCredential"in window&&window.PublicKeyCredential&&"credentials"in navigator&&typeof((r=navigator==null?void 0:navigator.credentials)===null||r===void 0?void 0:r.create)=="function"&&typeof((s=navigator==null?void 0:navigator.credentials)===null||s===void 0?void 0:s.get)=="function")}async function K_e(r){try{const s=await navigator.credentials.create(r);return s?s instanceof PublicKeyCredential?{data:s,error:null}:{data:null,error:new Mw("Browser returned unexpected credential type",s)}:{data:null,error:new Mw("Empty credential response",s)}}catch(s){return{data:null,error:P_e({error:s,options:r})}}}async function W_e(r){try{const s=await navigator.credentials.get(r);return s?s instanceof PublicKeyCredential?{data:s,error:null}:{data:null,error:new Mw("Browser returned unexpected credential type",s)}:{data:null,error:new Mw("Empty credential response",s)}}catch(s){return{data:null,error:M_e({error:s,options:r})}}}const Y_e={hints:["security-key"],authenticatorSelection:{authenticatorAttachment:"cross-platform",requireResidentKey:!1,userVerification:"preferred",residentKey:"discouraged"},attestation:"direct"},z_e={userVerification:"preferred",hints:["security-key"],attestation:"direct"};function Fw(...r){const s=A=>A!==null&&typeof A=="object"&&!Array.isArray(A),a=A=>A instanceof ArrayBuffer||ArrayBuffer.isView(A),c={};for(const A of r)if(A)for(const u in A){const m=A[u];if(m!==void 0)if(Array.isArray(m))c[u]=m;else if(a(m))c[u]=m;else if(s(m)){const E=c[u];s(E)?c[u]=Fw(E,m):c[u]=Fw(m)}else c[u]=m}return c}function q_e(r,s){return Fw(Y_e,r,s||{})}function X_e(r,s){return Fw(z_e,r,s||{})}class J_e{constructor(s){this.client=s,this.enroll=this._enroll.bind(this),this.challenge=this._challenge.bind(this),this.verify=this._verify.bind(this),this.authenticate=this._authenticate.bind(this),this.register=this._register.bind(this)}async _enroll(s){return this.client.mfa.enroll(Object.assign(Object.assign({},s),{factorType:"webauthn"}))}async _challenge({factorId:s,webauthn:a,friendlyName:c,signal:A},u){try{const{data:m,error:E}=await this.client.mfa.challenge({factorId:s,webauthn:a});if(!m)return{data:null,error:E};const w=A??j_e.createNewAbortSignal();if(m.webauthn.type==="create"){const{user:C}=m.webauthn.credential_options.publicKey;C.name||(C.name=`${C.id}:${c}`),C.displayName||(C.displayName=C.name)}switch(m.webauthn.type){case"create":{const C=q_e(m.webauthn.credential_options.publicKey,u==null?void 0:u.create),{data:T,error:N}=await K_e({publicKey:C,signal:w});return T?{data:{factorId:s,challengeId:m.id,webauthn:{type:m.webauthn.type,credential_response:T}},error:null}:{data:null,error:N}}case"request":{const C=X_e(m.webauthn.credential_options.publicKey,u==null?void 0:u.request),{data:T,error:N}=await W_e(Object.assign(Object.assign({},m.webauthn.credential_options),{publicKey:C,signal:w}));return T?{data:{factorId:s,challengeId:m.id,webauthn:{type:m.webauthn.type,credential_response:T}},error:null}:{data:null,error:N}}}}catch(m){return Rt(m)?{data:null,error:m}:{data:null,error:new _u("Unexpected error in challenge",m)}}}async _verify({challengeId:s,factorId:a,webauthn:c}){return this.client.mfa.verify({factorId:a,challengeId:s,webauthn:c})}async _authenticate({factorId:s,webauthn:{rpId:a=typeof window<"u"?window.location.hostname:void 0,rpOrigins:c=typeof window<"u"?[window.location.origin]:void 0,signal:A}={}},u){if(!a)return{data:null,error:new v_("rpId is required for WebAuthn authentication")};try{if(!cG())return{data:null,error:new _u("Browser does not support WebAuthn",null)};const{data:m,error:E}=await this.challenge({factorId:s,webauthn:{rpId:a,rpOrigins:c},signal:A},{request:u});if(!m)return{data:null,error:E};const{webauthn:w}=m;return this._verify({factorId:s,challengeId:m.challengeId,webauthn:{type:w.type,rpId:a,rpOrigins:c,credential_response:w.credential_response}})}catch(m){return Rt(m)?{data:null,error:m}:{data:null,error:new _u("Unexpected error in authenticate",m)}}}async _register({friendlyName:s,webauthn:{rpId:a=typeof window<"u"?window.location.hostname:void 0,rpOrigins:c=typeof window<"u"?[window.location.origin]:void 0,signal:A}={}},u){if(!a)return{data:null,error:new v_("rpId is required for WebAuthn registration")};try{if(!cG())return{data:null,error:new _u("Browser does not support WebAuthn",null)};const{data:m,error:E}=await this._enroll({friendlyName:s});if(!m)return await this.client.mfa.listFactors().then(T=>{var N;return(N=T.data)===null||N===void 0?void 0:N.all.find(B=>B.factor_type==="webauthn"&&B.friendly_name===s&&B.status!=="unverified")}).then(T=>T?this.client.mfa.unenroll({factorId:T==null?void 0:T.id}):void 0),{data:null,error:E};const{data:w,error:C}=await this._challenge({factorId:m.id,friendlyName:m.friendly_name,webauthn:{rpId:a,rpOrigins:c},signal:A},{create:u});return w?this._verify({factorId:m.id,challengeId:w.challengeId,webauthn:{rpId:a,rpOrigins:c,type:w.webauthn.type,credential_response:w.webauthn.credential_response}}):{data:null,error:C}}catch(m){return Rt(m)?{data:null,error:m}:{data:null,error:new _u("Unexpected error in register",m)}}}}B_e();const $_e={url:zge,storageKey:qge,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:Xge,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1,throwOnError:!1};async function lG(r,s,a){return await a()}const gp={};class y_{get jwks(){var s,a;return(a=(s=gp[this.storageKey])===null||s===void 0?void 0:s.jwks)!==null&&a!==void 0?a:{keys:[]}}set jwks(s){gp[this.storageKey]=Object.assign(Object.assign({},gp[this.storageKey]),{jwks:s})}get jwks_cached_at(){var s,a;return(a=(s=gp[this.storageKey])===null||s===void 0?void 0:s.cachedAt)!==null&&a!==void 0?a:Number.MIN_SAFE_INTEGER}set jwks_cached_at(s){gp[this.storageKey]=Object.assign(Object.assign({},gp[this.storageKey]),{cachedAt:s})}constructor(s){var a,c,A;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log;const u=Object.assign(Object.assign({},$_e),s);if(this.storageKey=u.storageKey,this.instanceID=(a=y_.nextInstanceID[this.storageKey])!==null&&a!==void 0?a:0,y_.nextInstanceID[this.storageKey]=this.instanceID+1,this.logDebugMessages=!!u.debug,typeof u.debug=="function"&&(this.logger=u.debug),this.instanceID>0&&si()){const m=`${this._logPrefix()} Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.`;console.warn(m),this.logDebugMessages&&console.trace(m)}if(this.persistSession=u.persistSession,this.autoRefreshToken=u.autoRefreshToken,this.admin=new O_e({url:u.url,headers:u.headers,fetch:u.fetch}),this.url=u.url,this.headers=u.headers,this.fetch=zz(u.fetch),this.lock=u.lock||lG,this.detectSessionInUrl=u.detectSessionInUrl,this.flowType=u.flowType,this.hasCustomAuthorizationHeader=u.hasCustomAuthorizationHeader,this.throwOnError=u.throwOnError,u.lock?this.lock=u.lock:si()&&(!((c=globalThis==null?void 0:globalThis.navigator)===null||c===void 0)&&c.locks)?this.lock=D_e:this.lock=lG,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this),webauthn:new J_e(this)},this.oauth={getAuthorizationDetails:this._getAuthorizationDetails.bind(this),approveAuthorization:this._approveAuthorization.bind(this),denyAuthorization:this._denyAuthorization.bind(this),listGrants:this._listOAuthGrants.bind(this),revokeGrant:this._revokeOAuthGrant.bind(this)},this.persistSession?(u.storage?this.storage=u.storage:Yz()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=oG(this.memoryStorage)),u.userStorage&&(this.userStorage=u.userStorage)):(this.memoryStorage={},this.storage=oG(this.memoryStorage)),si()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(m){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",m)}(A=this.broadcastChannel)===null||A===void 0||A.addEventListener("message",async m=>{this._debug("received broadcast notification from other tab or client",m),await this._notifyAllSubscribers(m.data.event,m.data.session,!1)})}this.initialize()}isThrowOnErrorEnabled(){return this.throwOnError}_returnResult(s){if(this.throwOnError&&s&&s.error)throw s.error;return s}_logPrefix(){return`GoTrueClient@${this.storageKey}:${this.instanceID} (${Gz}) ${new Date().toISOString()}`}_debug(...s){return this.logDebugMessages&&this.logger(this._logPrefix(),...s),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var s;try{let a={},c="none";if(si()&&(a=A_e(window.location.href),this._isImplicitGrantCallback(a)?c="implicit":await this._isPKCECallback(a)&&(c="pkce")),si()&&this.detectSessionInUrl&&c!=="none"){const{data:A,error:u}=await this._getSessionFromURL(a,c);if(u){if(this._debug("#_initialize()","error detecting session from URL",u),n_e(u)){const w=(s=u.details)===null||s===void 0?void 0:s.code;if(w==="identity_already_exists"||w==="identity_not_found"||w==="single_identity_not_deletable")return{error:u}}return await this._removeSession(),{error:u}}const{session:m,redirectType:E}=A;return this._debug("#_initialize()","detected session in URL",m,"redirect type",E),await this._saveSession(m),setTimeout(async()=>{E==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",m):await this._notifyAllSubscribers("SIGNED_IN",m)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(a){return Rt(a)?this._returnResult({error:a}):this._returnResult({error:new _u("Unexpected error during initialization",a)})}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(s){var a,c,A;try{const u=await Ft(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(c=(a=s==null?void 0:s.options)===null||a===void 0?void 0:a.data)!==null&&c!==void 0?c:{},gotrue_meta_security:{captcha_token:(A=s==null?void 0:s.options)===null||A===void 0?void 0:A.captchaToken}},xform:Xo}),{data:m,error:E}=u;if(E||!m)return this._returnResult({data:{user:null,session:null},error:E});const w=m.session,C=m.user;return m.session&&(await this._saveSession(m.session),await this._notifyAllSubscribers("SIGNED_IN",w)),this._returnResult({data:{user:C,session:w},error:null})}catch(u){if(Rt(u))return this._returnResult({data:{user:null,session:null},error:u});throw u}}async signUp(s){var a,c,A;try{let u;if("email"in s){const{email:T,password:N,options:B}=s;let k=null,Q=null;this.flowType==="pkce"&&([k,Q]=await pp(this.storage,this.storageKey)),u=await Ft(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:B==null?void 0:B.emailRedirectTo,body:{email:T,password:N,data:(a=B==null?void 0:B.data)!==null&&a!==void 0?a:{},gotrue_meta_security:{captcha_token:B==null?void 0:B.captchaToken},code_challenge:k,code_challenge_method:Q},xform:Xo})}else if("phone"in s){const{phone:T,password:N,options:B}=s;u=await Ft(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:T,password:N,data:(c=B==null?void 0:B.data)!==null&&c!==void 0?c:{},channel:(A=B==null?void 0:B.channel)!==null&&A!==void 0?A:"sms",gotrue_meta_security:{captcha_token:B==null?void 0:B.captchaToken}},xform:Xo})}else throw new my("You must provide either an email or phone number and a password");const{data:m,error:E}=u;if(E||!m)return this._returnResult({data:{user:null,session:null},error:E});const w=m.session,C=m.user;return m.session&&(await this._saveSession(m.session),await this._notifyAllSubscribers("SIGNED_IN",w)),this._returnResult({data:{user:C,session:w},error:null})}catch(u){if(Rt(u))return this._returnResult({data:{user:null,session:null},error:u});throw u}}async signInWithPassword(s){try{let a;if("email"in s){const{email:u,password:m,options:E}=s;a=await Ft(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:u,password:m,gotrue_meta_security:{captcha_token:E==null?void 0:E.captchaToken}},xform:iG})}else if("phone"in s){const{phone:u,password:m,options:E}=s;a=await Ft(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:u,password:m,gotrue_meta_security:{captcha_token:E==null?void 0:E.captchaToken}},xform:iG})}else throw new my("You must provide either an email or phone number and a password");const{data:c,error:A}=a;if(A)return this._returnResult({data:{user:null,session:null},error:A});if(!c||!c.session||!c.user){const u=new hp;return this._returnResult({data:{user:null,session:null},error:u})}return c.session&&(await this._saveSession(c.session),await this._notifyAllSubscribers("SIGNED_IN",c.session)),this._returnResult({data:Object.assign({user:c.user,session:c.session},c.weak_password?{weakPassword:c.weak_password}:null),error:A})}catch(a){if(Rt(a))return this._returnResult({data:{user:null,session:null},error:a});throw a}}async signInWithOAuth(s){var a,c,A,u;return await this._handleProviderSignIn(s.provider,{redirectTo:(a=s.options)===null||a===void 0?void 0:a.redirectTo,scopes:(c=s.options)===null||c===void 0?void 0:c.scopes,queryParams:(A=s.options)===null||A===void 0?void 0:A.queryParams,skipBrowserRedirect:(u=s.options)===null||u===void 0?void 0:u.skipBrowserRedirect})}async exchangeCodeForSession(s){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(s))}async signInWithWeb3(s){const{chain:a}=s;switch(a){case"ethereum":return await this.signInWithEthereum(s);case"solana":return await this.signInWithSolana(s);default:throw new Error(`@supabase/auth-js: Unsupported chain "${a}"`)}}async signInWithEthereum(s){var a,c,A,u,m,E,w,C,T,N,B;let k,Q;if("message"in s)k=s.message,Q=s.signature;else{const{chain:K,wallet:Y,statement:F,options:M}=s;let V;if(si())if(typeof Y=="object")V=Y;else{const ce=window;if("ethereum"in ce&&typeof ce.ethereum=="object"&&"request"in ce.ethereum&&typeof ce.ethereum.request=="function")V=ce.ethereum;else throw new Error("@supabase/auth-js: No compatible Ethereum wallet interface on the window object (window.ethereum) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'ethereum', wallet: resolvedUserWallet }) instead.")}else{if(typeof Y!="object"||!(M!=null&&M.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");V=Y}const W=new URL((a=M==null?void 0:M.url)!==null&&a!==void 0?a:window.location.href),q=await V.request({method:"eth_requestAccounts"}).then(ce=>ce).catch(()=>{throw new Error("@supabase/auth-js: Wallet method eth_requestAccounts is missing or invalid")});if(!q||q.length===0)throw new Error("@supabase/auth-js: No accounts available. Please ensure the wallet is connected.");const te=Xz(q[0]);let re=(c=M==null?void 0:M.signInWithEthereum)===null||c===void 0?void 0:c.chainId;if(!re){const ce=await V.request({method:"eth_chainId"});re=k_e(ce)}const de={domain:W.host,address:te,statement:F,uri:W.href,version:"1",chainId:re,nonce:(A=M==null?void 0:M.signInWithEthereum)===null||A===void 0?void 0:A.nonce,issuedAt:(m=(u=M==null?void 0:M.signInWithEthereum)===null||u===void 0?void 0:u.issuedAt)!==null&&m!==void 0?m:new Date,expirationTime:(E=M==null?void 0:M.signInWithEthereum)===null||E===void 0?void 0:E.expirationTime,notBefore:(w=M==null?void 0:M.signInWithEthereum)===null||w===void 0?void 0:w.notBefore,requestId:(C=M==null?void 0:M.signInWithEthereum)===null||C===void 0?void 0:C.requestId,resources:(T=M==null?void 0:M.signInWithEthereum)===null||T===void 0?void 0:T.resources};k=U_e(de),Q=await V.request({method:"personal_sign",params:[L_e(k),te]})}try{const{data:K,error:Y}=await Ft(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"ethereum",message:k,signature:Q},!((N=s.options)===null||N===void 0)&&N.captchaToken?{gotrue_meta_security:{captcha_token:(B=s.options)===null||B===void 0?void 0:B.captchaToken}}:null),xform:Xo});if(Y)throw Y;if(!K||!K.session||!K.user){const F=new hp;return this._returnResult({data:{user:null,session:null},error:F})}return K.session&&(await this._saveSession(K.session),await this._notifyAllSubscribers("SIGNED_IN",K.session)),this._returnResult({data:Object.assign({},K),error:Y})}catch(K){if(Rt(K))return this._returnResult({data:{user:null,session:null},error:K});throw K}}async signInWithSolana(s){var a,c,A,u,m,E,w,C,T,N,B,k;let Q,K;if("message"in s)Q=s.message,K=s.signature;else{const{chain:Y,wallet:F,statement:M,options:V}=s;let W;if(si())if(typeof F=="object")W=F;else{const te=window;if("solana"in te&&typeof te.solana=="object"&&("signIn"in te.solana&&typeof te.solana.signIn=="function"||"signMessage"in te.solana&&typeof te.solana.signMessage=="function"))W=te.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof F!="object"||!(V!=null&&V.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");W=F}const q=new URL((a=V==null?void 0:V.url)!==null&&a!==void 0?a:window.location.href);if("signIn"in W&&W.signIn){const te=await W.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},V==null?void 0:V.signInWithSolana),{version:"1",domain:q.host,uri:q.href}),M?{statement:M}:null));let re;if(Array.isArray(te)&&te[0]&&typeof te[0]=="object")re=te[0];else if(te&&typeof te=="object"&&"signedMessage"in te&&"signature"in te)re=te;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in re&&"signature"in re&&(typeof re.signedMessage=="string"||re.signedMessage instanceof Uint8Array)&&re.signature instanceof Uint8Array)Q=typeof re.signedMessage=="string"?re.signedMessage:new TextDecoder().decode(re.signedMessage),K=re.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in W)||typeof W.signMessage!="function"||!("publicKey"in W)||typeof W!="object"||!W.publicKey||!("toBase58"in W.publicKey)||typeof W.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");Q=[`${q.host} wants you to sign in with your Solana account:`,W.publicKey.toBase58(),...M?["",M,""]:[""],"Version: 1",`URI: ${q.href}`,`Issued At: ${(A=(c=V==null?void 0:V.signInWithSolana)===null||c===void 0?void 0:c.issuedAt)!==null&&A!==void 0?A:new Date().toISOString()}`,...!((u=V==null?void 0:V.signInWithSolana)===null||u===void 0)&&u.notBefore?[`Not Before: ${V.signInWithSolana.notBefore}`]:[],...!((m=V==null?void 0:V.signInWithSolana)===null||m===void 0)&&m.expirationTime?[`Expiration Time: ${V.signInWithSolana.expirationTime}`]:[],...!((E=V==null?void 0:V.signInWithSolana)===null||E===void 0)&&E.chainId?[`Chain ID: ${V.signInWithSolana.chainId}`]:[],...!((w=V==null?void 0:V.signInWithSolana)===null||w===void 0)&&w.nonce?[`Nonce: ${V.signInWithSolana.nonce}`]:[],...!((C=V==null?void 0:V.signInWithSolana)===null||C===void 0)&&C.requestId?[`Request ID: ${V.signInWithSolana.requestId}`]:[],...!((N=(T=V==null?void 0:V.signInWithSolana)===null||T===void 0?void 0:T.resources)===null||N===void 0)&&N.length?["Resources",...V.signInWithSolana.resources.map(re=>`- ${re}`)]:[]].join(`
`);const te=await W.signMessage(new TextEncoder().encode(Q),"utf8");if(!te||!(te instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");K=te}}try{const{data:Y,error:F}=await Ft(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:Q,signature:vu(K)},!((B=s.options)===null||B===void 0)&&B.captchaToken?{gotrue_meta_security:{captcha_token:(k=s.options)===null||k===void 0?void 0:k.captchaToken}}:null),xform:Xo});if(F)throw F;if(!Y||!Y.session||!Y.user){const M=new hp;return this._returnResult({data:{user:null,session:null},error:M})}return Y.session&&(await this._saveSession(Y.session),await this._notifyAllSubscribers("SIGNED_IN",Y.session)),this._returnResult({data:Object.assign({},Y),error:F})}catch(Y){if(Rt(Y))return this._returnResult({data:{user:null,session:null},error:Y});throw Y}}async _exchangeCodeForSession(s){const a=await ru(this.storage,`${this.storageKey}-code-verifier`),[c,A]=(a??"").split("/");try{const{data:u,error:m}=await Ft(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:s,code_verifier:c},xform:Xo});if(await dA(this.storage,`${this.storageKey}-code-verifier`),m)throw m;if(!u||!u.session||!u.user){const E=new hp;return this._returnResult({data:{user:null,session:null,redirectType:null},error:E})}return u.session&&(await this._saveSession(u.session),await this._notifyAllSubscribers("SIGNED_IN",u.session)),this._returnResult({data:Object.assign(Object.assign({},u),{redirectType:A??null}),error:m})}catch(u){if(Rt(u))return this._returnResult({data:{user:null,session:null,redirectType:null},error:u});throw u}}async signInWithIdToken(s){try{const{options:a,provider:c,token:A,access_token:u,nonce:m}=s,E=await Ft(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:c,id_token:A,access_token:u,nonce:m,gotrue_meta_security:{captcha_token:a==null?void 0:a.captchaToken}},xform:Xo}),{data:w,error:C}=E;if(C)return this._returnResult({data:{user:null,session:null},error:C});if(!w||!w.session||!w.user){const T=new hp;return this._returnResult({data:{user:null,session:null},error:T})}return w.session&&(await this._saveSession(w.session),await this._notifyAllSubscribers("SIGNED_IN",w.session)),this._returnResult({data:w,error:C})}catch(a){if(Rt(a))return this._returnResult({data:{user:null,session:null},error:a});throw a}}async signInWithOtp(s){var a,c,A,u,m;try{if("email"in s){const{email:E,options:w}=s;let C=null,T=null;this.flowType==="pkce"&&([C,T]=await pp(this.storage,this.storageKey));const{error:N}=await Ft(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:E,data:(a=w==null?void 0:w.data)!==null&&a!==void 0?a:{},create_user:(c=w==null?void 0:w.shouldCreateUser)!==null&&c!==void 0?c:!0,gotrue_meta_security:{captcha_token:w==null?void 0:w.captchaToken},code_challenge:C,code_challenge_method:T},redirectTo:w==null?void 0:w.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:N})}if("phone"in s){const{phone:E,options:w}=s,{data:C,error:T}=await Ft(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:E,data:(A=w==null?void 0:w.data)!==null&&A!==void 0?A:{},create_user:(u=w==null?void 0:w.shouldCreateUser)!==null&&u!==void 0?u:!0,gotrue_meta_security:{captcha_token:w==null?void 0:w.captchaToken},channel:(m=w==null?void 0:w.channel)!==null&&m!==void 0?m:"sms"}});return this._returnResult({data:{user:null,session:null,messageId:C==null?void 0:C.message_id},error:T})}throw new my("You must provide either an email or phone number.")}catch(E){if(Rt(E))return this._returnResult({data:{user:null,session:null},error:E});throw E}}async verifyOtp(s){var a,c;try{let A,u;"options"in s&&(A=(a=s.options)===null||a===void 0?void 0:a.redirectTo,u=(c=s.options)===null||c===void 0?void 0:c.captchaToken);const{data:m,error:E}=await Ft(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},s),{gotrue_meta_security:{captcha_token:u}}),redirectTo:A,xform:Xo});if(E)throw E;if(!m)throw new Error("An error occurred on token verification.");const w=m.session,C=m.user;return w!=null&&w.access_token&&(await this._saveSession(w),await this._notifyAllSubscribers(s.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",w)),this._returnResult({data:{user:C,session:w},error:null})}catch(A){if(Rt(A))return this._returnResult({data:{user:null,session:null},error:A});throw A}}async signInWithSSO(s){var a,c,A,u,m;try{let E=null,w=null;this.flowType==="pkce"&&([E,w]=await pp(this.storage,this.storageKey));const C=await Ft(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in s?{provider_id:s.providerId}:null),"domain"in s?{domain:s.domain}:null),{redirect_to:(c=(a=s.options)===null||a===void 0?void 0:a.redirectTo)!==null&&c!==void 0?c:void 0}),!((A=s==null?void 0:s.options)===null||A===void 0)&&A.captchaToken?{gotrue_meta_security:{captcha_token:s.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:E,code_challenge_method:w}),headers:this.headers,xform:R_e});return!((u=C.data)===null||u===void 0)&&u.url&&si()&&!(!((m=s.options)===null||m===void 0)&&m.skipBrowserRedirect)&&window.location.assign(C.data.url),this._returnResult(C)}catch(E){if(Rt(E))return this._returnResult({data:null,error:E});throw E}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async s=>{const{data:{session:a},error:c}=s;if(c)throw c;if(!a)throw new ya;const{error:A}=await Ft(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:a.access_token});return this._returnResult({data:{user:null,session:null},error:A})})}catch(s){if(Rt(s))return this._returnResult({data:{user:null,session:null},error:s});throw s}}async resend(s){try{const a=`${this.url}/resend`;if("email"in s){const{email:c,type:A,options:u}=s,{error:m}=await Ft(this.fetch,"POST",a,{headers:this.headers,body:{email:c,type:A,gotrue_meta_security:{captcha_token:u==null?void 0:u.captchaToken}},redirectTo:u==null?void 0:u.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:m})}else if("phone"in s){const{phone:c,type:A,options:u}=s,{data:m,error:E}=await Ft(this.fetch,"POST",a,{headers:this.headers,body:{phone:c,type:A,gotrue_meta_security:{captcha_token:u==null?void 0:u.captchaToken}}});return this._returnResult({data:{user:null,session:null,messageId:m==null?void 0:m.message_id},error:E})}throw new my("You must provide either an email or phone number and a type")}catch(a){if(Rt(a))return this._returnResult({data:{user:null,session:null},error:a});throw a}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async a=>a))}async _acquireLock(s,a){this._debug("#_acquireLock","begin",s);try{if(this.lockAcquired){const c=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),A=(async()=>(await c,await a()))();return this.pendingInLock.push((async()=>{try{await A}catch{}})()),A}return await this.lock(`lock:${this.storageKey}`,s,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const c=a();for(this.pendingInLock.push((async()=>{try{await c}catch{}})()),await c;this.pendingInLock.length;){const A=[...this.pendingInLock];await Promise.all(A),this.pendingInLock.splice(0,A.length)}return await c}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(s){this._debug("#_useSession","begin");try{const a=await this.__loadSession();return await s(a)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let s=null;const a=await ru(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",a),a!==null&&(this._isValidSession(a)?s=a:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!s)return{data:{session:null},error:null};const c=s.expires_at?s.expires_at*1e3-Date.now()<qN:!1;if(this._debug("#__loadSession()",`session has${c?"":" not"} expired`,"expires_at",s.expires_at),!c){if(this.userStorage){const m=await ru(this.userStorage,this.storageKey+"-user");m!=null&&m.user?s.user=m.user:s.user=$N()}if(this.storage.isServer&&s.user&&!s.user.__isUserNotAvailableProxy){const m={value:this.suppressGetSessionWarning};s.user=b_e(s.user,m),m.value&&(this.suppressGetSessionWarning=!0)}return{data:{session:s},error:null}}const{data:A,error:u}=await this._callRefreshToken(s.refresh_token);return u?this._returnResult({data:{session:null},error:u}):this._returnResult({data:{session:A},error:null})}finally{this._debug("#__loadSession()","end")}}async getUser(s){return s?await this._getUser(s):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(s){try{return s?await Ft(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:s,xform:CA}):await this._useSession(async a=>{var c,A,u;const{data:m,error:E}=a;if(E)throw E;return!(!((c=m.session)===null||c===void 0)&&c.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new ya}:await Ft(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(u=(A=m.session)===null||A===void 0?void 0:A.access_token)!==null&&u!==void 0?u:void 0,xform:CA})})}catch(a){if(Rt(a))return t_e(a)&&(await this._removeSession(),await dA(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({data:{user:null},error:a});throw a}}async updateUser(s,a={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(s,a))}async _updateUser(s,a={}){try{return await this._useSession(async c=>{const{data:A,error:u}=c;if(u)throw u;if(!A.session)throw new ya;const m=A.session;let E=null,w=null;this.flowType==="pkce"&&s.email!=null&&([E,w]=await pp(this.storage,this.storageKey));const{data:C,error:T}=await Ft(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:a==null?void 0:a.emailRedirectTo,body:Object.assign(Object.assign({},s),{code_challenge:E,code_challenge_method:w}),jwt:m.access_token,xform:CA});if(T)throw T;return m.user=C.user,await this._saveSession(m),await this._notifyAllSubscribers("USER_UPDATED",m),this._returnResult({data:{user:m.user},error:null})})}catch(c){if(Rt(c))return this._returnResult({data:{user:null},error:c});throw c}}async setSession(s){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(s))}async _setSession(s){try{if(!s.access_token||!s.refresh_token)throw new ya;const a=Date.now()/1e3;let c=a,A=!0,u=null;const{payload:m}=JN(s.access_token);if(m.exp&&(c=m.exp,A=c<=a),A){const{data:E,error:w}=await this._callRefreshToken(s.refresh_token);if(w)return this._returnResult({data:{user:null,session:null},error:w});if(!E)return{data:{user:null,session:null},error:null};u=E}else{const{data:E,error:w}=await this._getUser(s.access_token);if(w)throw w;u={access_token:s.access_token,refresh_token:s.refresh_token,user:E.user,token_type:"bearer",expires_in:c-a,expires_at:c},await this._saveSession(u),await this._notifyAllSubscribers("SIGNED_IN",u)}return this._returnResult({data:{user:u.user,session:u},error:null})}catch(a){if(Rt(a))return this._returnResult({data:{session:null,user:null},error:a});throw a}}async refreshSession(s){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(s))}async _refreshSession(s){try{return await this._useSession(async a=>{var c;if(!s){const{data:m,error:E}=a;if(E)throw E;s=(c=m.session)!==null&&c!==void 0?c:void 0}if(!(s!=null&&s.refresh_token))throw new ya;const{data:A,error:u}=await this._callRefreshToken(s.refresh_token);return u?this._returnResult({data:{user:null,session:null},error:u}):A?this._returnResult({data:{user:A.user,session:A},error:null}):this._returnResult({data:{user:null,session:null},error:null})})}catch(a){if(Rt(a))return this._returnResult({data:{user:null,session:null},error:a});throw a}}async _getSessionFromURL(s,a){try{if(!si())throw new gy("No browser detected.");if(s.error||s.error_description||s.error_code)throw new gy(s.error_description||"Error in URL with unspecified error_description",{error:s.error||"unspecified_error",code:s.error_code||"unspecified_code"});switch(a){case"implicit":if(this.flowType==="pkce")throw new $6("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new gy("Not a valid implicit grant flow url.");break;default:}if(a==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!s.code)throw new $6("No code detected.");const{data:M,error:V}=await this._exchangeCodeForSession(s.code);if(V)throw V;const W=new URL(window.location.href);return W.searchParams.delete("code"),window.history.replaceState(window.history.state,"",W.toString()),{data:{session:M.session,redirectType:null},error:null}}const{provider_token:c,provider_refresh_token:A,access_token:u,refresh_token:m,expires_in:E,expires_at:w,token_type:C}=s;if(!u||!E||!m||!C)throw new gy("No session defined in URL");const T=Math.round(Date.now()/1e3),N=parseInt(E);let B=T+N;w&&(B=parseInt(w));const k=B-T;k*1e3<=Ip&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${k}s, should have been closer to ${N}s`);const Q=B-N;T-Q>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",Q,B,T):T-Q<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",Q,B,T);const{data:K,error:Y}=await this._getUser(u);if(Y)throw Y;const F={provider_token:c,provider_refresh_token:A,access_token:u,expires_in:N,expires_at:B,refresh_token:m,token_type:C,user:K.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),this._returnResult({data:{session:F,redirectType:s.type},error:null})}catch(c){if(Rt(c))return this._returnResult({data:{session:null,redirectType:null},error:c});throw c}}_isImplicitGrantCallback(s){return!!(s.access_token||s.error_description)}async _isPKCECallback(s){const a=await ru(this.storage,`${this.storageKey}-code-verifier`);return!!(s.code&&a)}async signOut(s={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(s))}async _signOut({scope:s}={scope:"global"}){return await this._useSession(async a=>{var c;const{data:A,error:u}=a;if(u)return this._returnResult({error:u});const m=(c=A.session)===null||c===void 0?void 0:c.access_token;if(m){const{error:E}=await this.admin.signOut(m,s);if(E&&!(e_e(E)&&(E.status===404||E.status===401||E.status===403)))return this._returnResult({error:E})}return s!=="others"&&(await this._removeSession(),await dA(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({error:null})})}onAuthStateChange(s){const a=l_e(),c={id:a,callback:s,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",a),this.stateChangeEmitters.delete(a)}};return this._debug("#onAuthStateChange()","registered callback with id",a),this.stateChangeEmitters.set(a,c),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(a)})))(),{data:{subscription:c}}}async _emitInitialSession(s){return await this._useSession(async a=>{var c,A;try{const{data:{session:u},error:m}=a;if(m)throw m;await((c=this.stateChangeEmitters.get(s))===null||c===void 0?void 0:c.callback("INITIAL_SESSION",u)),this._debug("INITIAL_SESSION","callback id",s,"session",u)}catch(u){await((A=this.stateChangeEmitters.get(s))===null||A===void 0?void 0:A.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",s,"error",u),console.error(u)}})}async resetPasswordForEmail(s,a={}){let c=null,A=null;this.flowType==="pkce"&&([c,A]=await pp(this.storage,this.storageKey,!0));try{return await Ft(this.fetch,"POST",`${this.url}/recover`,{body:{email:s,code_challenge:c,code_challenge_method:A,gotrue_meta_security:{captcha_token:a.captchaToken}},headers:this.headers,redirectTo:a.redirectTo})}catch(u){if(Rt(u))return this._returnResult({data:null,error:u});throw u}}async getUserIdentities(){var s;try{const{data:a,error:c}=await this.getUser();if(c)throw c;return this._returnResult({data:{identities:(s=a.user.identities)!==null&&s!==void 0?s:[]},error:null})}catch(a){if(Rt(a))return this._returnResult({data:null,error:a});throw a}}async linkIdentity(s){return"token"in s?this.linkIdentityIdToken(s):this.linkIdentityOAuth(s)}async linkIdentityOAuth(s){var a;try{const{data:c,error:A}=await this._useSession(async u=>{var m,E,w,C,T;const{data:N,error:B}=u;if(B)throw B;const k=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,s.provider,{redirectTo:(m=s.options)===null||m===void 0?void 0:m.redirectTo,scopes:(E=s.options)===null||E===void 0?void 0:E.scopes,queryParams:(w=s.options)===null||w===void 0?void 0:w.queryParams,skipBrowserRedirect:!0});return await Ft(this.fetch,"GET",k,{headers:this.headers,jwt:(T=(C=N.session)===null||C===void 0?void 0:C.access_token)!==null&&T!==void 0?T:void 0})});if(A)throw A;return si()&&!(!((a=s.options)===null||a===void 0)&&a.skipBrowserRedirect)&&window.location.assign(c==null?void 0:c.url),this._returnResult({data:{provider:s.provider,url:c==null?void 0:c.url},error:null})}catch(c){if(Rt(c))return this._returnResult({data:{provider:s.provider,url:null},error:c});throw c}}async linkIdentityIdToken(s){return await this._useSession(async a=>{var c;try{const{error:A,data:{session:u}}=a;if(A)throw A;const{options:m,provider:E,token:w,access_token:C,nonce:T}=s,N=await Ft(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,jwt:(c=u==null?void 0:u.access_token)!==null&&c!==void 0?c:void 0,body:{provider:E,id_token:w,access_token:C,nonce:T,link_identity:!0,gotrue_meta_security:{captcha_token:m==null?void 0:m.captchaToken}},xform:Xo}),{data:B,error:k}=N;return k?this._returnResult({data:{user:null,session:null},error:k}):!B||!B.session||!B.user?this._returnResult({data:{user:null,session:null},error:new hp}):(B.session&&(await this._saveSession(B.session),await this._notifyAllSubscribers("USER_UPDATED",B.session)),this._returnResult({data:B,error:k}))}catch(A){if(Rt(A))return this._returnResult({data:{user:null,session:null},error:A});throw A}})}async unlinkIdentity(s){try{return await this._useSession(async a=>{var c,A;const{data:u,error:m}=a;if(m)throw m;return await Ft(this.fetch,"DELETE",`${this.url}/user/identities/${s.identity_id}`,{headers:this.headers,jwt:(A=(c=u.session)===null||c===void 0?void 0:c.access_token)!==null&&A!==void 0?A:void 0})})}catch(a){if(Rt(a))return this._returnResult({data:null,error:a});throw a}}async _refreshAccessToken(s){const a=`#_refreshAccessToken(${s.substring(0,5)}...)`;this._debug(a,"begin");try{const c=Date.now();return await h_e(async A=>(A>0&&await u_e(200*Math.pow(2,A-1)),this._debug(a,"refreshing attempt",A),await Ft(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:s},headers:this.headers,xform:Xo})),(A,u)=>{const m=200*Math.pow(2,A);return u&&XN(u)&&Date.now()+m-c<Ip})}catch(c){if(this._debug(a,"error",c),Rt(c))return this._returnResult({data:{session:null,user:null},error:c});throw c}finally{this._debug(a,"end")}}_isValidSession(s){return typeof s=="object"&&s!==null&&"access_token"in s&&"refresh_token"in s&&"expires_at"in s}async _handleProviderSignIn(s,a){const c=await this._getUrlForProvider(`${this.url}/authorize`,s,{redirectTo:a.redirectTo,scopes:a.scopes,queryParams:a.queryParams});return this._debug("#_handleProviderSignIn()","provider",s,"options",a,"url",c),si()&&!a.skipBrowserRedirect&&window.location.assign(c),{data:{provider:s,url:c},error:null}}async _recoverAndRefresh(){var s,a;const c="#_recoverAndRefresh()";this._debug(c,"begin");try{const A=await ru(this.storage,this.storageKey);if(A&&this.userStorage){let m=await ru(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!m&&(m={user:A.user},await Np(this.userStorage,this.storageKey+"-user",m)),A.user=(s=m==null?void 0:m.user)!==null&&s!==void 0?s:$N()}else if(A&&!A.user&&!A.user){const m=await ru(this.storage,this.storageKey+"-user");m&&(m!=null&&m.user)?(A.user=m.user,await dA(this.storage,this.storageKey+"-user"),await Np(this.storage,this.storageKey,A)):A.user=$N()}if(this._debug(c,"session from storage",A),!this._isValidSession(A)){this._debug(c,"session is not valid"),A!==null&&await this._removeSession();return}const u=((a=A.expires_at)!==null&&a!==void 0?a:1/0)*1e3-Date.now()<qN;if(this._debug(c,`session has${u?"":" not"} expired with margin of ${qN}s`),u){if(this.autoRefreshToken&&A.refresh_token){const{error:m}=await this._callRefreshToken(A.refresh_token);m&&(console.error(m),XN(m)||(this._debug(c,"refresh failed with a non-retryable error, removing the session",m),await this._removeSession()))}}else if(A.user&&A.user.__isUserNotAvailableProxy===!0)try{const{data:m,error:E}=await this._getUser(A.access_token);!E&&(m!=null&&m.user)?(A.user=m.user,await this._saveSession(A),await this._notifyAllSubscribers("SIGNED_IN",A)):this._debug(c,"could not get user data, skipping SIGNED_IN notification")}catch(m){console.error("Error getting user data:",m),this._debug(c,"error getting user data, skipping SIGNED_IN notification",m)}else await this._notifyAllSubscribers("SIGNED_IN",A)}catch(A){this._debug(c,"error",A),console.error(A);return}finally{this._debug(c,"end")}}async _callRefreshToken(s){var a,c;if(!s)throw new ya;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const A=`#_callRefreshToken(${s.substring(0,5)}...)`;this._debug(A,"begin");try{this.refreshingDeferred=new Cb;const{data:u,error:m}=await this._refreshAccessToken(s);if(m)throw m;if(!u.session)throw new ya;await this._saveSession(u.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",u.session);const E={data:u.session,error:null};return this.refreshingDeferred.resolve(E),E}catch(u){if(this._debug(A,"error",u),Rt(u)){const m={data:null,error:u};return XN(u)||await this._removeSession(),(a=this.refreshingDeferred)===null||a===void 0||a.resolve(m),m}throw(c=this.refreshingDeferred)===null||c===void 0||c.reject(u),u}finally{this.refreshingDeferred=null,this._debug(A,"end")}}async _notifyAllSubscribers(s,a,c=!0){const A=`#_notifyAllSubscribers(${s})`;this._debug(A,"begin",a,`broadcast = ${c}`);try{this.broadcastChannel&&c&&this.broadcastChannel.postMessage({event:s,session:a});const u=[],m=Array.from(this.stateChangeEmitters.values()).map(async E=>{try{await E.callback(s,a)}catch(w){u.push(w)}});if(await Promise.all(m),u.length>0){for(let E=0;E<u.length;E+=1)console.error(u[E]);throw u[0]}}finally{this._debug(A,"end")}}async _saveSession(s){this._debug("#_saveSession()",s),this.suppressGetSessionWarning=!0;const a=Object.assign({},s),c=a.user&&a.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!c&&a.user&&await Np(this.userStorage,this.storageKey+"-user",{user:a.user});const A=Object.assign({},a);delete A.user;const u=rG(A);await Np(this.storage,this.storageKey,u)}else{const A=rG(a);await Np(this.storage,this.storageKey,A)}}async _removeSession(){this._debug("#_removeSession()"),await dA(this.storage,this.storageKey),await dA(this.storage,this.storageKey+"-code-verifier"),await dA(this.storage,this.storageKey+"-user"),this.userStorage&&await dA(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const s=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{s&&si()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",s)}catch(a){console.error("removing visibilitychange callback failed",a)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const s=setInterval(()=>this._autoRefreshTokenTick(),Ip);this.autoRefreshTicker=s,s&&typeof s=="object"&&typeof s.unref=="function"?s.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(s),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const s=this.autoRefreshTicker;this.autoRefreshTicker=null,s&&clearInterval(s)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const s=Date.now();try{return await this._useSession(async a=>{const{data:{session:c}}=a;if(!c||!c.refresh_token||!c.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const A=Math.floor((c.expires_at*1e3-s)/Ip);this._debug("#_autoRefreshTokenTick()",`access token expires in ${A} ticks, a tick lasts ${Ip}ms, refresh threshold is ${Bx} ticks`),A<=Bx&&await this._callRefreshToken(c.refresh_token)})}catch(a){console.error("Auto refresh tick failed with error. This is likely a transient error.",a)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(s){if(s.isAcquireTimeout||s instanceof qz)this._debug("auto refresh token tick lock not available");else throw s}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!si()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(s){console.error("_handleVisibilityChange",s)}}async _onVisibilityChanged(s){const a=`#_onVisibilityChanged(${s})`;this._debug(a,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),s||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(a,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(s,a,c){const A=[`provider=${encodeURIComponent(a)}`];if(c!=null&&c.redirectTo&&A.push(`redirect_to=${encodeURIComponent(c.redirectTo)}`),c!=null&&c.scopes&&A.push(`scopes=${encodeURIComponent(c.scopes)}`),this.flowType==="pkce"){const[u,m]=await pp(this.storage,this.storageKey),E=new URLSearchParams({code_challenge:`${encodeURIComponent(u)}`,code_challenge_method:`${encodeURIComponent(m)}`});A.push(E.toString())}if(c!=null&&c.queryParams){const u=new URLSearchParams(c.queryParams);A.push(u.toString())}return c!=null&&c.skipBrowserRedirect&&A.push(`skip_http_redirect=${c.skipBrowserRedirect}`),`${s}?${A.join("&")}`}async _unenroll(s){try{return await this._useSession(async a=>{var c;const{data:A,error:u}=a;return u?this._returnResult({data:null,error:u}):await Ft(this.fetch,"DELETE",`${this.url}/factors/${s.factorId}`,{headers:this.headers,jwt:(c=A==null?void 0:A.session)===null||c===void 0?void 0:c.access_token})})}catch(a){if(Rt(a))return this._returnResult({data:null,error:a});throw a}}async _enroll(s){try{return await this._useSession(async a=>{var c,A;const{data:u,error:m}=a;if(m)return this._returnResult({data:null,error:m});const E=Object.assign({friendly_name:s.friendlyName,factor_type:s.factorType},s.factorType==="phone"?{phone:s.phone}:s.factorType==="totp"?{issuer:s.issuer}:{}),{data:w,error:C}=await Ft(this.fetch,"POST",`${this.url}/factors`,{body:E,headers:this.headers,jwt:(c=u==null?void 0:u.session)===null||c===void 0?void 0:c.access_token});return C?this._returnResult({data:null,error:C}):(s.factorType==="totp"&&w.type==="totp"&&(!((A=w==null?void 0:w.totp)===null||A===void 0)&&A.qr_code)&&(w.totp.qr_code=`data:image/svg+xml;utf-8,${w.totp.qr_code}`),this._returnResult({data:w,error:null}))})}catch(a){if(Rt(a))return this._returnResult({data:null,error:a});throw a}}async _verify(s){return this._acquireLock(-1,async()=>{try{return await this._useSession(async a=>{var c;const{data:A,error:u}=a;if(u)return this._returnResult({data:null,error:u});const m=Object.assign({challenge_id:s.challengeId},"webauthn"in s?{webauthn:Object.assign(Object.assign({},s.webauthn),{credential_response:s.webauthn.type==="create"?H_e(s.webauthn.credential_response):G_e(s.webauthn.credential_response)})}:{code:s.code}),{data:E,error:w}=await Ft(this.fetch,"POST",`${this.url}/factors/${s.factorId}/verify`,{body:m,headers:this.headers,jwt:(c=A==null?void 0:A.session)===null||c===void 0?void 0:c.access_token});return w?this._returnResult({data:null,error:w}):(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+E.expires_in},E)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",E),this._returnResult({data:E,error:w}))})}catch(a){if(Rt(a))return this._returnResult({data:null,error:a});throw a}})}async _challenge(s){return this._acquireLock(-1,async()=>{try{return await this._useSession(async a=>{var c;const{data:A,error:u}=a;if(u)return this._returnResult({data:null,error:u});const m=await Ft(this.fetch,"POST",`${this.url}/factors/${s.factorId}/challenge`,{body:s,headers:this.headers,jwt:(c=A==null?void 0:A.session)===null||c===void 0?void 0:c.access_token});if(m.error)return m;const{data:E}=m;if(E.type!=="webauthn")return{data:E,error:null};switch(E.webauthn.type){case"create":return{data:Object.assign(Object.assign({},E),{webauthn:Object.assign(Object.assign({},E.webauthn),{credential_options:Object.assign(Object.assign({},E.webauthn.credential_options),{publicKey:V_e(E.webauthn.credential_options.publicKey)})})}),error:null};case"request":return{data:Object.assign(Object.assign({},E),{webauthn:Object.assign(Object.assign({},E.webauthn),{credential_options:Object.assign(Object.assign({},E.webauthn.credential_options),{publicKey:Q_e(E.webauthn.credential_options.publicKey)})})}),error:null}}})}catch(a){if(Rt(a))return this._returnResult({data:null,error:a});throw a}})}async _challengeAndVerify(s){const{data:a,error:c}=await this._challenge({factorId:s.factorId});return c?this._returnResult({data:null,error:c}):await this._verify({factorId:s.factorId,challengeId:a.id,code:s.code})}async _listFactors(){var s;const{data:{user:a},error:c}=await this.getUser();if(c)return{data:null,error:c};const A={all:[],phone:[],totp:[],webauthn:[]};for(const u of(s=a==null?void 0:a.factors)!==null&&s!==void 0?s:[])A.all.push(u),u.status==="verified"&&A[u.factor_type].push(u);return{data:A,error:null}}async _getAuthenticatorAssuranceLevel(){var s,a;const{data:{session:c},error:A}=await this.getSession();if(A)return this._returnResult({data:null,error:A});if(!c)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:u}=JN(c.access_token);let m=null;u.aal&&(m=u.aal);let E=m;((a=(s=c.user.factors)===null||s===void 0?void 0:s.filter(T=>T.status==="verified"))!==null&&a!==void 0?a:[]).length>0&&(E="aal2");const C=u.amr||[];return{data:{currentLevel:m,nextLevel:E,currentAuthenticationMethods:C},error:null}}async _getAuthorizationDetails(s){try{return await this._useSession(async a=>{const{data:{session:c},error:A}=a;return A?this._returnResult({data:null,error:A}):c?await Ft(this.fetch,"GET",`${this.url}/oauth/authorizations/${s}`,{headers:this.headers,jwt:c.access_token,xform:u=>({data:u,error:null})}):this._returnResult({data:null,error:new ya})})}catch(a){if(Rt(a))return this._returnResult({data:null,error:a});throw a}}async _approveAuthorization(s,a){try{return await this._useSession(async c=>{const{data:{session:A},error:u}=c;if(u)return this._returnResult({data:null,error:u});if(!A)return this._returnResult({data:null,error:new ya});const m=await Ft(this.fetch,"POST",`${this.url}/oauth/authorizations/${s}/consent`,{headers:this.headers,jwt:A.access_token,body:{action:"approve"},xform:E=>({data:E,error:null})});return m.data&&m.data.redirect_url&&si()&&!(a!=null&&a.skipBrowserRedirect)&&window.location.assign(m.data.redirect_url),m})}catch(c){if(Rt(c))return this._returnResult({data:null,error:c});throw c}}async _denyAuthorization(s,a){try{return await this._useSession(async c=>{const{data:{session:A},error:u}=c;if(u)return this._returnResult({data:null,error:u});if(!A)return this._returnResult({data:null,error:new ya});const m=await Ft(this.fetch,"POST",`${this.url}/oauth/authorizations/${s}/consent`,{headers:this.headers,jwt:A.access_token,body:{action:"deny"},xform:E=>({data:E,error:null})});return m.data&&m.data.redirect_url&&si()&&!(a!=null&&a.skipBrowserRedirect)&&window.location.assign(m.data.redirect_url),m})}catch(c){if(Rt(c))return this._returnResult({data:null,error:c});throw c}}async _listOAuthGrants(){try{return await this._useSession(async s=>{const{data:{session:a},error:c}=s;return c?this._returnResult({data:null,error:c}):a?await Ft(this.fetch,"GET",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:a.access_token,xform:A=>({data:A,error:null})}):this._returnResult({data:null,error:new ya})})}catch(s){if(Rt(s))return this._returnResult({data:null,error:s});throw s}}async _revokeOAuthGrant(s){try{return await this._useSession(async a=>{const{data:{session:c},error:A}=a;return A?this._returnResult({data:null,error:A}):c?await Ft(this.fetch,"DELETE",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:c.access_token,query:{client_id:s.clientId},xform:()=>({data:{},error:null})}):this._returnResult({data:null,error:new ya})})}catch(a){if(Rt(a))return this._returnResult({data:null,error:a});throw a}}async fetchJwk(s,a={keys:[]}){let c=a.keys.find(E=>E.kid===s);if(c)return c;const A=Date.now();if(c=this.jwks.keys.find(E=>E.kid===s),c&&this.jwks_cached_at+$ge>A)return c;const{data:u,error:m}=await Ft(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(m)throw m;return!u.keys||u.keys.length===0||(this.jwks=u,this.jwks_cached_at=A,c=u.keys.find(E=>E.kid===s),!c)?null:c}async getClaims(s,a={}){try{let c=s;if(!c){const{data:k,error:Q}=await this.getSession();if(Q||!k.session)return this._returnResult({data:null,error:Q});c=k.session.access_token}const{header:A,payload:u,signature:m,raw:{header:E,payload:w}}=JN(c);a!=null&&a.allowExpired||v_e(u.exp);const C=!A.alg||A.alg.startsWith("HS")||!A.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(A.kid,a!=null&&a.keys?{keys:a.keys}:a==null?void 0:a.jwks);if(!C){const{error:k}=await this.getUser(c);if(k)throw k;return{data:{claims:u,header:A,signature:m},error:null}}const T=y_e(A.alg),N=await crypto.subtle.importKey("jwk",C,T,!0,["verify"]);if(!await crypto.subtle.verify(T,N,m,o_e(`${E}.${w}`)))throw new Ux("Invalid JWT signature");return{data:{claims:u,header:A,signature:m},error:null}}catch(c){if(Rt(c))return this._returnResult({data:null,error:c});throw c}}}y_.nextInstanceID={};const Z_e=y_;class eEe extends Z_e{constructor(s){super(s)}}class tEe{constructor(s,a,c){var A,u,m;this.supabaseUrl=s,this.supabaseKey=a;const E=Yge(s);if(!a)throw new Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",E),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",E),this.storageUrl=new URL("storage/v1",E),this.functionsUrl=new URL("functions/v1",E);const w=`sb-${E.hostname.split(".")[0]}-auth-token`,C={db:Fge,realtime:Vge,auth:Object.assign(Object.assign({},jge),{storageKey:w}),global:Mge},T=Wge(c??{},C);this.storageKey=(A=T.auth.storageKey)!==null&&A!==void 0?A:"",this.headers=(u=T.global.headers)!==null&&u!==void 0?u:{},T.accessToken?(this.accessToken=T.accessToken,this.auth=new Proxy({},{get:(N,B)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(B)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((m=T.auth)!==null&&m!==void 0?m:{},this.headers,T.global.fetch),this.fetch=Gge(a,this._getAccessToken.bind(this),T.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},T.realtime)),this.accessToken&&this.accessToken().then(N=>this.realtime.setAuth(N)).catch(N=>console.warn("Failed to set initial Realtime auth token:",N)),this.rest=new zme(new URL("rest/v1",E).href,{headers:this.headers,schema:T.db.schema,fetch:this.fetch}),this.storage=new Lge(this.storageUrl.href,this.headers,this.fetch,c==null?void 0:c.storage),T.accessToken||this._listenForAuthEvents()}get functions(){return new Kme(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(s){return this.rest.from(s)}schema(s){return this.rest.schema(s)}rpc(s,a={},c={head:!1,get:!1,count:void 0}){return this.rest.rpc(s,a,c)}channel(s,a={config:{}}){return this.realtime.channel(s,a)}getChannels(){return this.realtime.getChannels()}removeChannel(s){return this.realtime.removeChannel(s)}removeAllChannels(){return this.realtime.removeAllChannels()}async _getAccessToken(){var s,a;if(this.accessToken)return await this.accessToken();const{data:c}=await this.auth.getSession();return(a=(s=c.session)===null||s===void 0?void 0:s.access_token)!==null&&a!==void 0?a:this.supabaseKey}_initSupabaseAuthClient({autoRefreshToken:s,persistSession:a,detectSessionInUrl:c,storage:A,userStorage:u,storageKey:m,flowType:E,lock:w,debug:C,throwOnError:T},N,B){const k={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new eEe({url:this.authUrl.href,headers:Object.assign(Object.assign({},k),N),storageKey:m,autoRefreshToken:s,persistSession:a,detectSessionInUrl:c,storage:A,userStorage:u,flowType:E,lock:w,debug:C,throwOnError:T,fetch:B,hasCustomAuthorizationHeader:Object.keys(this.headers).some(Q=>Q.toLowerCase()==="authorization")})}_initRealtimeClient(s){return new dge(this.realtimeUrl.href,Object.assign(Object.assign({},s),{params:Object.assign({apikey:this.supabaseKey},s==null?void 0:s.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((a,c)=>{this._handleTokenChanged(a,"CLIENT",c==null?void 0:c.access_token)})}_handleTokenChanged(s,a,c){(s==="TOKEN_REFRESHED"||s==="SIGNED_IN")&&this.changedAccessToken!==c?(this.changedAccessToken=c,this.realtime.setAuth(c)):s==="SIGNED_OUT"&&(this.realtime.setAuth(),a=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const nEe=(r,s,a)=>new tEe(r,s,a);function rEe(){if(typeof window<"u"||typeof process>"u")return!1;const r=process.version;if(r==null)return!1;const s=r.match(/^v(\d+)\./);return s?parseInt(s[1],10)<=18:!1}rEe()&&console.warn("  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const sEe="https://jtmmeumzjcldqukpqcfi.supabase.co",iEe="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imp0bW1ldW16amNsZHF1a3BxY2ZpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjMzMjU3NTUsImV4cCI6MjA3ODkwMTc1NX0.Bp-7JF66UIVuzKtVmilxovkEwe-TSXHMT_eqETHVPLo",oe=nEe(sEe,iEe,{auth:{persistSession:!0,autoRefreshToken:!0,detectSessionInUrl:!0,storageKey:"masjid-auth",storage:window.localStorage,flowType:"pkce",debug:!1},global:{headers:{"X-Client-Info":"masjid-app"}},realtime:{params:{eventsPerSecond:10}}}),$z=z.createContext(void 0),aEe=({children:r})=>{const[s,a]=z.useState(null),[c,A]=z.useState(null),[u,m]=z.useState(null),[E,w]=z.useState(!0),[C,T]=z.useState(!1);z.useEffect(()=>{let Y=!0;return(async()=>{var M;console.log(" AuthContext: Initializing authentication...");try{const{data:{session:V}}=await oe.auth.getSession();if(!Y)return;if(V){console.log(" Active session found:",V.user.email),m(V),a(V.user),localStorage.setItem("masjid-last-activity",new Date().toISOString()),await N(V.user.id),w(!1),T(!0);return}console.log(" No active session, attempting recovery...");const W=["masjid-auth","sb-masjid-auth","supabase.auth.token"];let q=!1;for(const te of W)try{const re=localStorage.getItem(te);if(!re)continue;const de=JSON.parse(re),ce=(de==null?void 0:de.refresh_token)||((M=de==null?void 0:de.currentSession)==null?void 0:M.refresh_token);if(ce){console.log(` Found refresh token in '${te}', attempting refresh...`);const{data:Ae,error:ne}=await oe.auth.refreshSession({refresh_token:ce});if(!Y)return;if(Ae!=null&&Ae.session&&!ne){console.log(" Session restored successfully!"),m(Ae.session),a(Ae.session.user),localStorage.setItem("masjid-last-activity",new Date().toISOString()),await N(Ae.session.user.id),q=!0;break}else console.warn(` Refresh failed for '${te}':`,ne==null?void 0:ne.message)}}catch{console.warn(` Failed to parse stored auth from '${te}'`)}if(!Y)return;q||console.log(" No session to recover - user needs to log in")}catch(V){console.error(" Auth initialization error:",V)}finally{Y&&(w(!1),T(!0))}})(),()=>{Y=!1}},[]);const N=async(Y,F=0)=>{var V,W;console.log("Fetching profile for user:",Y,"attempt:",F+1);try{const{data:q,error:te}=await oe.from("profiles").select("*").eq("id",Y).single();if(te){if(console.error("Error fetching profile:",te),te.code==="PGRST116"){console.log("Profile not found, attempting to create...");const{data:{user:re}}=await oe.auth.getUser();if(re){const{error:de}=await oe.from("profiles").insert({id:re.id,email:re.email,full_name:((V=re.user_metadata)==null?void 0:V.full_name)||re.email.split("@")[0],role:((W=re.user_metadata)==null?void 0:W.role)||"user"});if(de){if(console.error("Failed to create profile:",de),F<3)return console.log("Retrying profile creation..."),await new Promise(ce=>setTimeout(ce,500)),N(Y,F+1)}else{console.log("Profile created successfully, refetching..."),await new Promise(ne=>setTimeout(ne,300));const{data:ce,error:Ae}=await oe.from("profiles").select("*").eq("id",Y).single();if(ce){console.log("New profile fetched successfully"),A(ce),w(!1);return}else if(Ae&&F<3)return console.log("Retry fetching new profile..."),await new Promise(ne=>setTimeout(ne,500)),N(Y,F+1)}}}else if(F<3)return console.log("Retrying due to error..."),await new Promise(re=>setTimeout(re,500)),N(Y,F+1);w(!1);return}q?(console.log("Profile fetched successfully:",q.email),A(q),w(!1),T(!0)):(w(!1),T(!0))}catch(q){if(console.error("Error in fetchProfile:",q),F<3)return console.log("Retrying after exception..."),await new Promise(te=>setTimeout(te,200)),N(Y,F+1);w(!1),T(!0)}},B=async(Y,F)=>{if(console.log(" SignIn: Starting authentication for",Y),!navigator.onLine)throw console.error(" No internet connection"),new Error("No internet connection. Please check your network and try again.");try{const{error:W}=await oe.from("profiles").select("id").limit(1);if(W&&W.message.includes("Failed to fetch"))throw new Error("Cannot connect to server. Please check your internet connection.")}catch(W){if(W.message.includes("Failed to fetch")||W.message.includes("NetworkError"))throw new Error("Cannot connect to server. Please check your internet connection.")}const{data:M,error:V}=await oe.auth.signInWithPassword({email:Y,password:F});if(V)throw console.error(" SignIn: Authentication failed",V),V.message.includes("Email not confirmed")?new Error("Please verify your email address. Check your inbox for the confirmation link."):V.message.includes("Invalid login credentials")?new Error("Invalid email or password. Please check your credentials and try again."):new Error(V.message);if(!M.user)throw new Error("Authentication failed. Please try again.");if(console.log(" SignIn: Authentication successful"),m(M.session),a(M.user),localStorage.setItem("masjid-last-activity",new Date().toISOString()),M.session)try{localStorage.setItem("masjid-auth",JSON.stringify({access_token:M.session.access_token,refresh_token:M.session.refresh_token,expires_at:M.session.expires_at,user:M.session.user})),console.log(" Session persisted to localStorage")}catch(W){console.warn(" Failed to persist session:",W)}N(M.user.id).catch(W=>{console.error("Profile fetch failed during sign-in:",W)}),console.log(" SignIn: Complete - session secured")},k=async(Y,F,M,V)=>{const{data:W,error:q}=await oe.auth.signUp({email:Y,password:F,options:{data:{full_name:V,role:M},emailRedirectTo:`${window.location.origin}/dashboard`}});if(q)throw q.message.includes("User already registered")?new Error("This email is already registered. Please sign in or use a different email."):new Error(q.message);if(W.user&&!W.session)throw new Error("CONFIRMATION_REQUIRED");if(W.session&&W.user){await new Promise(re=>setTimeout(re,1e3));const{data:te}=await oe.from("profiles").select("id").eq("id",W.user.id).single();if(!te){const{error:re}=await oe.from("profiles").insert({id:W.user.id,email:Y,full_name:V,role:M});re&&console.error("Profile creation error:",re)}}},Q=async()=>{const{error:Y}=await oe.auth.signOut();if(Y)throw Y},K=async Y=>{if(!s)throw new Error("No user logged in");const{error:F}=await oe.from("profiles").update(Y).eq("id",s.id);if(F)throw F;A(M=>M?{...M,...Y}:null)};return p.jsx($z.Provider,{value:{user:s,profile:c,session:u,loading:E,signIn:B,signUp:k,signOut:Q,updateProfile:K},children:r})},gr=()=>{const r=z.useContext($z);if(r===void 0)throw new Error("useAuth must be used within an AuthProvider");return r};/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oEe=r=>r.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),cEe=r=>r.replace(/^([A-Z])|[\s-_]+(\w)/g,(s,a,c)=>c?c.toUpperCase():a.toLowerCase()),AG=r=>{const s=cEe(r);return s.charAt(0).toUpperCase()+s.slice(1)},Zz=(...r)=>r.filter((s,a,c)=>!!s&&s.trim()!==""&&c.indexOf(s)===a).join(" ").trim(),lEe=r=>{for(const s in r)if(s.startsWith("aria-")||s==="role"||s==="title")return!0};/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var AEe={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dEe=z.forwardRef(({color:r="currentColor",size:s=24,strokeWidth:a=2,absoluteStrokeWidth:c,className:A="",children:u,iconNode:m,...E},w)=>z.createElement("svg",{ref:w,...AEe,width:s,height:s,stroke:r,strokeWidth:c?Number(a)*24/Number(s):a,className:Zz("lucide",A),...!u&&!lEe(E)&&{"aria-hidden":"true"},...E},[...m.map(([C,T])=>z.createElement(C,T)),...Array.isArray(u)?u:[u]]));/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rt=(r,s)=>{const a=z.forwardRef(({className:c,...A},u)=>z.createElement(dEe,{ref:u,iconNode:s,className:Zz(`lucide-${oEe(AG(r))}`,`lucide-${r}`,c),...A}));return a.displayName=AG(r),a};/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const uEe=[["path",{d:"M12 17V3",key:"1cwfxf"}],["path",{d:"m6 11 6 6 6-6",key:"12ii2o"}],["path",{d:"M19 21H5",key:"150jfl"}]],eO=rt("arrow-down-to-line",uEe);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hEe=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],Qu=rt("arrow-left",hEe);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pEe=[["path",{d:"m15.477 12.89 1.515 8.526a.5.5 0 0 1-.81.47l-3.58-2.687a1 1 0 0 0-1.197 0l-3.586 2.686a.5.5 0 0 1-.81-.469l1.514-8.526",key:"1yiouv"}],["circle",{cx:"12",cy:"8",r:"6",key:"1vp47v"}]],fEe=rt("award",pEe);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mEe=[["path",{d:"M10 16c.5.3 1.2.5 2 .5s1.5-.2 2-.5",key:"1u7htd"}],["path",{d:"M15 12h.01",key:"1k8ypt"}],["path",{d:"M19.38 6.813A9 9 0 0 1 20.8 10.2a2 2 0 0 1 0 3.6 9 9 0 0 1-17.6 0 2 2 0 0 1 0-3.6A9 9 0 0 1 12 3c2 0 3.5 1.1 3.5 2.5s-.9 2.5-2 2.5c-.8 0-1.5-.4-1.5-1",key:"11xh7x"}],["path",{d:"M9 12h.01",key:"157uk2"}]],gEe=rt("baby",mEe);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _Ee=[["path",{d:"M4.929 4.929 19.07 19.071",key:"196cmz"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],EEe=rt("ban",_Ee);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vEe=[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M3.262 15.326A1 1 0 0 0 4 17h16a1 1 0 0 0 .74-1.673C19.41 13.956 18 12.499 18 8A6 6 0 0 0 6 8c0 4.499-1.411 5.956-2.738 7.326",key:"11g9vi"}]],eq=rt("bell",vEe);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yEe=[["path",{d:"M12 7v14",key:"1akyts"}],["path",{d:"M3 18a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h5a4 4 0 0 1 4 4 4 4 0 0 1 4-4h5a1 1 0 0 1 1 1v13a1 1 0 0 1-1 1h-6a3 3 0 0 0-3 3 3 3 0 0 0-3-3z",key:"ruj8y"}]],w_=rt("book-open",yEe);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wEe=[["path",{d:"M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H19a1 1 0 0 1 1 1v18a1 1 0 0 1-1 1H6.5a1 1 0 0 1 0-5H20",key:"k3hazp"}]],bEe=rt("book",wEe);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const SEe=[["path",{d:"m19 21-7-4-7 4V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v16z",key:"1fy3hk"}]],CEe=rt("bookmark",SEe);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const TEe=[["path",{d:"M16 20V4a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16",key:"jecpp"}],["rect",{width:"20",height:"14",x:"2",y:"6",rx:"2",key:"i6l2r4"}]],REe=rt("briefcase",TEe);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const IEe=[["path",{d:"M10 12h4",key:"a56b0p"}],["path",{d:"M10 8h4",key:"1sr2af"}],["path",{d:"M14 21v-3a2 2 0 0 0-4 0v3",key:"1rgiei"}],["path",{d:"M6 10H4a2 2 0 0 0-2 2v7a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-2",key:"secmi2"}],["path",{d:"M6 21V5a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v16",key:"16ra0t"}]],tq=rt("building-2",IEe);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const NEe=[["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M12 6h.01",key:"1vi96p"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M16 6h.01",key:"1x0f13"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M8 6h.01",key:"1dz90k"}],["path",{d:"M9 22v-3a1 1 0 0 1 1-1h4a1 1 0 0 1 1 1v3",key:"cabbwy"}],["rect",{x:"4",y:"2",width:"16",height:"20",rx:"2",key:"1uxh74"}]],OEe=rt("building",NEe);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xEe=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]],fr=rt("calendar",xEe);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const DEe=[["path",{d:"M13.997 4a2 2 0 0 1 1.76 1.05l.486.9A2 2 0 0 0 18.003 7H20a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V9a2 2 0 0 1 2-2h1.997a2 2 0 0 0 1.759-1.048l.489-.904A2 2 0 0 1 10.004 4z",key:"18u6gg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]],tO=rt("camera",DEe);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const BEe=[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]],nq=rt("chart-column",BEe);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kEe=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],LEe=rt("check",kEe);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const UEe=[["path",{d:"M17 21a1 1 0 0 0 1-1v-5.35c0-.457.316-.844.727-1.041a4 4 0 0 0-2.134-7.589 5 5 0 0 0-9.186 0 4 4 0 0 0-2.134 7.588c.411.198.727.585.727 1.041V20a1 1 0 0 0 1 1Z",key:"1qvrer"}],["path",{d:"M6 17h12",key:"1jwigz"}]],PEe=rt("chef-hat",UEe);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const MEe=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],Of=rt("circle-alert",MEe);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const FEe=[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],Ks=rt("circle-check-big",FEe);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jEe=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],VEe=rt("circle-check",jEe);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const QEe=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["rect",{x:"9",y:"9",width:"6",height:"6",rx:"1",key:"1ssd4o"}]],nO=rt("circle-stop",QEe);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const HEe=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],hl=rt("circle-x",HEe);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const GEe=[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],Pa=rt("clock",GEe);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const KEe=[["circle",{cx:"8",cy:"8",r:"6",key:"3yglwk"}],["path",{d:"M18.09 10.37A6 6 0 1 1 10.34 18",key:"t5s6rm"}],["path",{d:"M7 6h1v4",key:"1obek4"}],["path",{d:"m16.71 13.88.7.71-2.82 2.82",key:"1rbuyh"}]],Tb=rt("coins",KEe);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const WEe=[["path",{d:"m16.24 7.76-1.804 5.411a2 2 0 0 1-1.265 1.265L7.76 16.24l1.804-5.411a2 2 0 0 1 1.265-1.265z",key:"9ktpf1"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],jw=rt("compass",WEe);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const YEe=[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]],Lc=rt("dollar-sign",YEe);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zEe=[["path",{d:"M17.596 12.768a2 2 0 1 0 2.829-2.829l-1.768-1.767a2 2 0 0 0 2.828-2.829l-2.828-2.828a2 2 0 0 0-2.829 2.828l-1.767-1.768a2 2 0 1 0-2.829 2.829z",key:"9m4mmf"}],["path",{d:"m2.5 21.5 1.4-1.4",key:"17g3f0"}],["path",{d:"m20.1 3.9 1.4-1.4",key:"1qn309"}],["path",{d:"M5.343 21.485a2 2 0 1 0 2.829-2.828l1.767 1.768a2 2 0 1 0 2.829-2.829l-6.364-6.364a2 2 0 1 0-2.829 2.829l1.768 1.767a2 2 0 0 0-2.828 2.829z",key:"1t2c92"}],["path",{d:"m9.6 14.4 4.8-4.8",key:"6umqxw"}]],qEe=rt("dumbbell",zEe);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const XEe=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]],rq=rt("external-link",XEe);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const JEe=[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],$Ee=rt("eye-off",JEe);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ZEe=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],sq=rt("eye",ZEe);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const eve=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]],tve=rt("file-text",eve);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nve=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M7 3v18",key:"bbkbws"}],["path",{d:"M3 7.5h4",key:"zfgn84"}],["path",{d:"M3 12h18",key:"1i2n21"}],["path",{d:"M3 16.5h4",key:"1230mu"}],["path",{d:"M17 3v18",key:"in4fa5"}],["path",{d:"M17 7.5h4",key:"myr1c1"}],["path",{d:"M17 16.5h4",key:"go4c1d"}]],Px=rt("film",nve);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rve=[["path",{d:"M4 22V4a1 1 0 0 1 .4-.8A6 6 0 0 1 8 2c3 0 5 2 7.333 2q2 0 3.067-.8A1 1 0 0 1 20 4v10a1 1 0 0 1-.4.8A6 6 0 0 1 16 16c-3 0-5-2-8-2a6 6 0 0 0-4 1.528",key:"1jaruq"}]],dG=rt("flag",rve);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sve=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]],iq=rt("globe",sve);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ive=[["path",{d:"M21.42 10.922a1 1 0 0 0-.019-1.838L12.83 5.18a2 2 0 0 0-1.66 0L2.6 9.08a1 1 0 0 0 0 1.832l8.57 3.908a2 2 0 0 0 1.66 0z",key:"j76jl0"}],["path",{d:"M22 10v6",key:"1lu8f3"}],["path",{d:"M6 12.5V16a6 3 0 0 0 12 0v-3.5",key:"1r8lef"}]],Mx=rt("graduation-cap",ive);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ave=[["path",{d:"M2 9.5a5.5 5.5 0 0 1 9.591-3.676.56.56 0 0 0 .818 0A5.49 5.49 0 0 1 22 9.5c0 2.29-1.5 4-3 5.5l-5.492 5.313a2 2 0 0 1-3 .019L5 15c-1.5-1.5-3-3.2-3-5.5",key:"mvr1a0"}]],Ma=rt("heart",ave);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ove=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]],cve=rt("info",ove);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lve=[["path",{d:"m16 17 5-5-5-5",key:"1bji2h"}],["path",{d:"M21 12H9",key:"dn1m92"}],["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}]],Ave=rt("log-out",lve);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dve=[["path",{d:"m22 7-8.991 5.727a2 2 0 0 1-2.009 0L2 7",key:"132q7q"}],["rect",{x:"2",y:"4",width:"20",height:"16",rx:"2",key:"izxlao"}]],uG=rt("mail",dve);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const uve=[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]],wl=rt("map-pin",uve);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hve=[["path",{d:"M8 3H5a2 2 0 0 0-2 2v3",key:"1dcmit"}],["path",{d:"M21 8V5a2 2 0 0 0-2-2h-3",key:"1e4gt3"}],["path",{d:"M3 16v3a2 2 0 0 0 2 2h3",key:"wsl5sc"}],["path",{d:"M16 21h3a2 2 0 0 0 2-2v-3",key:"18trek"}]],pve=rt("maximize",hve);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fve=[["path",{d:"M2.992 16.342a2 2 0 0 1 .094 1.167l-1.065 3.29a1 1 0 0 0 1.236 1.168l3.413-.998a2 2 0 0 1 1.099.092 10 10 0 1 0-4.777-4.719",key:"1sd12s"}]],Nl=rt("message-circle",fve);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mve=[["path",{d:"M22 17a2 2 0 0 1-2 2H6.828a2 2 0 0 0-1.414.586l-2.202 2.202A.71.71 0 0 1 2 21.286V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2z",key:"18887p"}]],Fx=rt("message-square",mve);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gve=[["path",{d:"M12 19v3",key:"npa21l"}],["path",{d:"M15 9.34V5a3 3 0 0 0-5.68-1.33",key:"1gzdoj"}],["path",{d:"M16.95 16.95A7 7 0 0 1 5 12v-2",key:"cqa7eg"}],["path",{d:"M18.89 13.23A7 7 0 0 0 19 12v-2",key:"16hl24"}],["path",{d:"m2 2 20 20",key:"1ooewy"}],["path",{d:"M9 9v3a3 3 0 0 0 5.12 2.12",key:"r2i35w"}]],_ve=rt("mic-off",gve);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Eve=[["path",{d:"M12 19v3",key:"npa21l"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["rect",{x:"9",y:"2",width:"6",height:"13",rx:"3",key:"s6n7sd"}]],vve=rt("mic",Eve);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yve=[["path",{d:"M8 3v3a2 2 0 0 1-2 2H3",key:"hohbtr"}],["path",{d:"M21 8h-3a2 2 0 0 1-2-2V3",key:"5jw1f3"}],["path",{d:"M3 16h3a2 2 0 0 1 2 2v3",key:"198tvr"}],["path",{d:"M16 21v-3a2 2 0 0 1 2-2h3",key:"ph8mxp"}]],wve=rt("minimize",yve);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bve=[["path",{d:"M9 18V5l12-2v13",key:"1jmyc2"}],["circle",{cx:"6",cy:"18",r:"3",key:"fqmcym"}],["circle",{cx:"18",cy:"16",r:"3",key:"1hluhg"}]],Sve=rt("music",bve);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Cve=[["rect",{x:"14",y:"3",width:"5",height:"18",rx:"1",key:"kaeet6"}],["rect",{x:"5",y:"3",width:"5",height:"18",rx:"1",key:"1wsw3u"}]],Tve=rt("pause",Cve);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rve=[["path",{d:"M13.832 16.568a1 1 0 0 0 1.213-.303l.355-.465A2 2 0 0 1 17 15h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2A18 18 0 0 1 2 4a2 2 0 0 1 2-2h3a2 2 0 0 1 2 2v3a2 2 0 0 1-.8 1.6l-.468.351a1 1 0 0 0-.292 1.233 14 14 0 0 0 6.392 6.384",key:"9njp5v"}]],mf=rt("phone",Rve);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ive=[["path",{d:"M21 9V6a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v10c0 1.1.9 2 2 2h4",key:"daa4of"}],["rect",{width:"10",height:"7",x:"12",y:"13",rx:"2",key:"1nb8gs"}]],Nve=rt("picture-in-picture-2",Ive);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ove=[["path",{d:"M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z",key:"10ikf1"}]],hG=rt("play",Ove);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xve=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]],aq=rt("refresh-cw",xve);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Dve=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],Bve=rt("search",Dve);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kve=[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]],oq=rt("send",kve);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lve=[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],cq=rt("settings",Lve);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Uve=[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]],Pve=rt("share-2",Uve);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mve=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]],pG=rt("shield",Mve);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fve=[["path",{d:"M17.971 4.285A2 2 0 0 1 21 6v12a2 2 0 0 1-3.029 1.715l-9.997-5.998a2 2 0 0 1-.003-3.432z",key:"15892j"}],["path",{d:"M3 20V4",key:"1ptbpl"}]],jve=rt("skip-back",Fve);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vve=[["path",{d:"M21 4v16",key:"7j8fe9"}],["path",{d:"M6.029 4.285A2 2 0 0 0 3 6v12a2 2 0 0 0 3.029 1.715l9.997-5.998a2 2 0 0 0 .003-3.432z",key:"zs4d6"}]],Qve=rt("skip-forward",Vve);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hve=[["path",{d:"M11.017 2.814a1 1 0 0 1 1.966 0l1.051 5.558a2 2 0 0 0 1.594 1.594l5.558 1.051a1 1 0 0 1 0 1.966l-5.558 1.051a2 2 0 0 0-1.594 1.594l-1.051 5.558a1 1 0 0 1-1.966 0l-1.051-5.558a2 2 0 0 0-1.594-1.594l-5.558-1.051a1 1 0 0 1 0-1.966l5.558-1.051a2 2 0 0 0 1.594-1.594z",key:"1s2grr"}],["path",{d:"M20 2v4",key:"1rf3ol"}],["path",{d:"M22 4h-4",key:"gwowj6"}],["circle",{cx:"4",cy:"20",r:"2",key:"6kqj1y"}]],Gve=rt("sparkles",Hve);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Kve=[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]],xf=rt("star",Kve);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wve=[["path",{d:"M17 14V2",key:"8ymqnk"}],["path",{d:"M9 18.12 10 14H4.17a2 2 0 0 1-1.92-2.56l2.33-8A2 2 0 0 1 6.5 2H20a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2h-2.76a2 2 0 0 0-1.79 1.11L12 22a3.13 3.13 0 0 1-3-3.88Z",key:"m61m77"}]],b_=rt("thumbs-down",Wve);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yve=[["path",{d:"M7 10v12",key:"1qc93n"}],["path",{d:"M15 5.88 14 10h5.83a2 2 0 0 1 1.92 2.56l-2.33 8A2 2 0 0 1 17.5 22H4a2 2 0 0 1-2-2v-8a2 2 0 0 1 2-2h2.76a2 2 0 0 0 1.79-1.11L12 2a3.13 3.13 0 0 1 3 3.88Z",key:"emmmcr"}]],jx=rt("thumbs-up",Yve);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zve=[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]],lq=rt("trash-2",zve);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qve=[["path",{d:"M16 7h6v6",key:"box55l"}],["path",{d:"m22 7-8.5 8.5-5-5L2 17",key:"1t1m79"}]],Rb=rt("trending-up",qve);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xve=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],Aq=rt("triangle-alert",Xve);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jve=[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]],rO=rt("upload",Jve);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $ve=[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]],yB=rt("user",$ve);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zve=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],yi=rt("users",Zve);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const e0e=[["path",{d:"m16 2-2.3 2.3a3 3 0 0 0 0 4.2l1.8 1.8a3 3 0 0 0 4.2 0L22 8",key:"n7qcjb"}],["path",{d:"M15 15 3.3 3.3a4.2 4.2 0 0 0 0 6l7.3 7.3c.7.7 2 .7 2.8 0L15 15Zm0 0 7 7",key:"d0u48b"}],["path",{d:"m2.1 21.8 6.4-6.3",key:"yn04lh"}],["path",{d:"m19 5-7 7",key:"194lzd"}]],Vw=rt("utensils-crossed",e0e);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const t0e=[["path",{d:"M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2",key:"cjf0a3"}],["path",{d:"M7 2v20",key:"1473qp"}],["path",{d:"M21 15V2a5 5 0 0 0-5 5v6c0 1.1.9 2 2 2h3Zm0 0v7",key:"j28e5"}]],Qw=rt("utensils",t0e);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const n0e=[["path",{d:"M10.66 6H14a2 2 0 0 1 2 2v2.5l5.248-3.062A.5.5 0 0 1 22 7.87v8.196",key:"w8jjjt"}],["path",{d:"M16 16a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h2",key:"1xawa7"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],fG=rt("video-off",n0e);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const r0e=[["path",{d:"m16 13 5.223 3.482a.5.5 0 0 0 .777-.416V7.87a.5.5 0 0 0-.752-.432L16 10.5",key:"ftymec"}],["rect",{x:"2",y:"6",width:"14",height:"12",rx:"2",key:"158x01"}]],bl=rt("video",r0e);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const s0e=[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["path",{d:"M16 9a5 5 0 0 1 0 6",key:"1q6k2b"}],["path",{d:"M19.364 18.364a9 9 0 0 0 0-12.728",key:"ijwkga"}]],i0e=rt("volume-2",s0e);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const a0e=[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["line",{x1:"22",x2:"16",y1:"9",y2:"15",key:"1ewh16"}],["line",{x1:"16",x2:"22",y1:"9",y2:"15",key:"5ykzw1"}]],o0e=rt("volume-x",a0e);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const c0e=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],Hw=rt("x",c0e);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const l0e=[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]],A0e=rt("zap",l0e);function d0e({message:r,type:s,onClose:a,duration:c=5e3}){z.useEffect(()=>{if(c>0){const E=setTimeout(()=>{a()},c);return()=>clearTimeout(E)}},[c,a]);const A=()=>{switch(s){case"success":return p.jsx(Ks,{className:"h-5 w-5 text-green-600"});case"error":return p.jsx(Of,{className:"h-5 w-5 text-red-600"});case"payment":return p.jsx(Lc,{className:"h-5 w-5 text-emerald-600"});default:return p.jsx(cve,{className:"h-5 w-5 text-blue-600"})}},u=()=>{switch(s){case"success":return"bg-green-50 border-green-200";case"error":return"bg-red-50 border-red-200";case"payment":return"bg-emerald-50 border-emerald-200";default:return"bg-blue-50 border-blue-200"}},m=()=>{switch(s){case"success":return"text-green-800";case"error":return"text-red-800";case"payment":return"text-emerald-800";default:return"text-blue-800"}};return p.jsx("div",{className:`fixed top-20 right-4 z-50 max-w-md w-full ${u()} border-2 rounded-lg shadow-lg p-4 animate-in slide-in-from-right duration-300`,role:"alert",children:p.jsxs("div",{className:"flex items-start gap-3",children:[A(),p.jsx("div",{className:"flex-1",children:p.jsx("p",{className:`text-sm font-medium ${m()}`,children:r})}),p.jsx("button",{onClick:a,className:"text-gray-400 hover:text-gray-600 transition-colors","aria-label":"Close notification",children:p.jsx(Hw,{className:"h-4 w-4"})})]})})}const dq=z.createContext(void 0);function u0e({children:r}){const[s,a]=z.useState([]),c=(u,m)=>{const E=Math.random().toString(36).substring(7);a(w=>[...w,{id:E,message:u,type:m}])},A=u=>{a(m=>m.filter(E=>E.id!==u))};return p.jsxs(dq.Provider,{value:{showNotification:c},children:[r,s.map(u=>p.jsx(d0e,{message:u.message,type:u.type,onClose:()=>A(u.id)},u.id))]})}function Hu(){const r=z.useContext(dq);if(!r)throw new Error("useNotification must be used within NotificationProvider");return r}const Rn=({children:r,allowedRoles:s,redirectTo:a="/signin"})=>{const{user:c,profile:A,loading:u}=gr(),[m,E]=_i.useState(!1);return _i.useEffect(()=>{c&&A?E(!0):u||E(!0)},[c,A,u]),u&&!c&&!A?null:!c||!A?(console.log("ProtectedRoute: No user or profile, redirecting to sign in"),p.jsx(Bme,{to:a,replace:!0})):s&&!s.includes(A.role)?p.jsx("div",{className:"min-h-screen flex items-center justify-center p-4",children:p.jsxs("div",{className:"text-center max-w-md",children:[p.jsx("h1",{className:"text-2xl font-bold text-destructive mb-4",children:"Access Denied"}),p.jsxs("p",{className:"text-muted-foreground mb-4",children:["You don't have permission to access this page. This page is restricted to"," ",s.join(", ")," only."]}),p.jsxs("p",{className:"text-sm text-muted-foreground",children:["Your current role: ",p.jsx("span",{className:"font-semibold",children:A.role})]})]})}):p.jsx(p.Fragment,{children:r})},wB=()=>{const{profile:r}=gr();return{canStream:(r==null?void 0:r.role)==="scholar"||(r==null?void 0:r.role)==="imam",canDonate:(r==null?void 0:r.role)==="user",canBookConsultation:(r==null?void 0:r.role)==="user",canManageConsultations:(r==null?void 0:r.role)==="scholar"||(r==null?void 0:r.role)==="imam",canAccessWallet:(r==null?void 0:r.role)==="scholar"||(r==null?void 0:r.role)==="imam",isScholar:(r==null?void 0:r.role)==="scholar",isImam:(r==null?void 0:r.role)==="imam",isUser:(r==null?void 0:r.role)==="user",isAdmin:(r==null?void 0:r.role)==="admin"}};let fA=null,Vx=null;const uq=async()=>{try{const r=window.Capacitor;if(r&&typeof r.isNativePlatform=="function"&&r.isNativePlatform()){const s=await n_(()=>import("./index-BWEtM_lB.js"),__vite__mapDeps([0,1]),import.meta.url),a=await n_(()=>import("./index-BdLuVvBa.js"),__vite__mapDeps([2,1]),import.meta.url);return fA=s.PushNotifications,Vx=a.LocalNotifications,!0}}catch(r){console.warn("Capacitor plugins not available:",r)}return!1},h0e=async()=>{if(!await uq()||!fA){console.log("Push notifications not available on this platform");return}try{(await fA.requestPermissions()).receive==="granted"?(await fA.register(),console.log(" Push notifications initialized"),await fA.addListener("registration",async a=>{console.log(" Push registration success, token: "+a.value);const{data:{user:c}}=await oe.auth.getUser();c&&await oe.from("profiles").update({push_token:a.value}).eq("id",c.id)}),await fA.addListener("registrationError",a=>{console.error(" Push registration error:",a)}),await fA.addListener("pushNotificationReceived",a=>{var c;console.log(" Push notification received:",a),Df({title:a.title||"Masjid App",body:a.body||"",data:a.data,type:(c=a.data)==null?void 0:c.type})}),await fA.addListener("pushNotificationActionPerformed",a=>{console.log(" Push notification action performed:",a),f0e(a.notification.data)})):console.warn("Push notification permission denied")}catch(s){console.error("Error initializing push notifications:",s)}},Df=async r=>{if(!await uq()||!Vx){console.log("Local notifications not available, showing toast instead");return}try{const a=Date.now();await Vx.schedule({notifications:[{title:r.title,body:r.body,id:a,schedule:{at:new Date(Date.now()+100)},sound:"default",attachments:r.largeIcon?[{id:"icon",url:r.largeIcon}]:void 0,actionTypeId:r.type||"general",extra:r.data||{}}]}),console.log(" Local notification scheduled:",r.title)}catch(a){console.error("Error showing local notification:",a)}},p0e=async(r,s)=>{try{const{data:a}=await oe.from("profiles").select("push_token").eq("id",r).single();if(!(a!=null&&a.push_token)){console.log("No push token for user:",r);return}const{data:c,error:A}=await oe.functions.invoke("send-push-notification",{body:{token:a.push_token,notification:{title:s.title,body:s.body,icon:"/app-icon.png",data:{...s.data,type:s.type}}}});if(A)throw A;return console.log(" Push notification sent:",c),c}catch(a){throw console.error("Error sending push notification:",a),a}},f0e=r=>{const s=r==null?void 0:r.type,a=r==null?void 0:r.id;switch(s){case"reel_upload":case"reel_trending":a?window.location.href=`/reels/${a}`:window.location.href="/reels";break;case"coin_reward":window.location.href="/coin";break;case"consultation":a?window.location.href=`/consultations/${a}`:window.location.href="/my-bookings";break;case"livestream":a?window.location.href=`/livestream/${a}`:window.location.href="/livestream";break;case"donation":window.location.href="/scholar-wallet";break;default:window.location.href="/dashboard";break}},m0e=async(r,s)=>{await Df({title:" New Reel Uploaded!",body:`${r} just uploaded: "${s}"`,type:"reel_upload",data:{uploaderName:r,reelTitle:s}})},g0e=async(r,s)=>{await Df({title:" Coins Earned!",body:`You earned ${r} coins! ${s}`,type:"coin_reward",data:{coins:r,reason:s}})},_0e=async(r,s)=>{await Df({title:" Consultation Booked",body:`Your ${s}-minute consultation with ${r} is confirmed!`,type:"consultation",data:{scholarName:r,duration:s}})},E0e=async(r,s)=>{await Df({title:" Livestream Starting!",body:`${r} is going live: "${s}"`,type:"livestream",data:{scholarName:r,title:s}})},v0e=async(r,s)=>{await Df({title:" Donation Received",body:`${r} donated ${s.toFixed(2)}. Jazakallah khair!`,type:"donation",data:{donorName:r,amount:s}})};function hq(r){var s,a,c="";if(typeof r=="string"||typeof r=="number")c+=r;else if(typeof r=="object")if(Array.isArray(r)){var A=r.length;for(s=0;s<A;s++)r[s]&&(a=hq(r[s]))&&(c&&(c+=" "),c+=a)}else for(a in r)r[a]&&(c&&(c+=" "),c+=a);return c}function pq(){for(var r,s,a=0,c="",A=arguments.length;a<A;a++)(r=arguments[a])&&(s=hq(r))&&(c&&(c+=" "),c+=s);return c}const bB="-",y0e=r=>{const s=b0e(r),{conflictingClassGroups:a,conflictingClassGroupModifiers:c}=r;return{getClassGroupId:m=>{const E=m.split(bB);return E[0]===""&&E.length!==1&&E.shift(),fq(E,s)||w0e(m)},getConflictingClassGroupIds:(m,E)=>{const w=a[m]||[];return E&&c[m]?[...w,...c[m]]:w}}},fq=(r,s)=>{var m;if(r.length===0)return s.classGroupId;const a=r[0],c=s.nextPart.get(a),A=c?fq(r.slice(1),c):void 0;if(A)return A;if(s.validators.length===0)return;const u=r.join(bB);return(m=s.validators.find(({validator:E})=>E(u)))==null?void 0:m.classGroupId},mG=/^\[(.+)\]$/,w0e=r=>{if(mG.test(r)){const s=mG.exec(r)[1],a=s==null?void 0:s.substring(0,s.indexOf(":"));if(a)return"arbitrary.."+a}},b0e=r=>{const{theme:s,prefix:a}=r,c={nextPart:new Map,validators:[]};return C0e(Object.entries(r.classGroups),a).forEach(([u,m])=>{Qx(m,c,u,s)}),c},Qx=(r,s,a,c)=>{r.forEach(A=>{if(typeof A=="string"){const u=A===""?s:gG(s,A);u.classGroupId=a;return}if(typeof A=="function"){if(S0e(A)){Qx(A(c),s,a,c);return}s.validators.push({validator:A,classGroupId:a});return}Object.entries(A).forEach(([u,m])=>{Qx(m,gG(s,u),a,c)})})},gG=(r,s)=>{let a=r;return s.split(bB).forEach(c=>{a.nextPart.has(c)||a.nextPart.set(c,{nextPart:new Map,validators:[]}),a=a.nextPart.get(c)}),a},S0e=r=>r.isThemeGetter,C0e=(r,s)=>s?r.map(([a,c])=>{const A=c.map(u=>typeof u=="string"?s+u:typeof u=="object"?Object.fromEntries(Object.entries(u).map(([m,E])=>[s+m,E])):u);return[a,A]}):r,T0e=r=>{if(r<1)return{get:()=>{},set:()=>{}};let s=0,a=new Map,c=new Map;const A=(u,m)=>{a.set(u,m),s++,s>r&&(s=0,c=a,a=new Map)};return{get(u){let m=a.get(u);if(m!==void 0)return m;if((m=c.get(u))!==void 0)return A(u,m),m},set(u,m){a.has(u)?a.set(u,m):A(u,m)}}},mq="!",R0e=r=>{const{separator:s,experimentalParseClassName:a}=r,c=s.length===1,A=s[0],u=s.length,m=E=>{const w=[];let C=0,T=0,N;for(let Y=0;Y<E.length;Y++){let F=E[Y];if(C===0){if(F===A&&(c||E.slice(Y,Y+u)===s)){w.push(E.slice(T,Y)),T=Y+u;continue}if(F==="/"){N=Y;continue}}F==="["?C++:F==="]"&&C--}const B=w.length===0?E:E.substring(T),k=B.startsWith(mq),Q=k?B.substring(1):B,K=N&&N>T?N-T:void 0;return{modifiers:w,hasImportantModifier:k,baseClassName:Q,maybePostfixModifierPosition:K}};return a?E=>a({className:E,parseClassName:m}):m},I0e=r=>{if(r.length<=1)return r;const s=[];let a=[];return r.forEach(c=>{c[0]==="["?(s.push(...a.sort(),c),a=[]):a.push(c)}),s.push(...a.sort()),s},N0e=r=>({cache:T0e(r.cacheSize),parseClassName:R0e(r),...y0e(r)}),O0e=/\s+/,x0e=(r,s)=>{const{parseClassName:a,getClassGroupId:c,getConflictingClassGroupIds:A}=s,u=[],m=r.trim().split(O0e);let E="";for(let w=m.length-1;w>=0;w-=1){const C=m[w],{modifiers:T,hasImportantModifier:N,baseClassName:B,maybePostfixModifierPosition:k}=a(C);let Q=!!k,K=c(Q?B.substring(0,k):B);if(!K){if(!Q){E=C+(E.length>0?" "+E:E);continue}if(K=c(B),!K){E=C+(E.length>0?" "+E:E);continue}Q=!1}const Y=I0e(T).join(":"),F=N?Y+mq:Y,M=F+K;if(u.includes(M))continue;u.push(M);const V=A(K,Q);for(let W=0;W<V.length;++W){const q=V[W];u.push(F+q)}E=C+(E.length>0?" "+E:E)}return E};function D0e(){let r=0,s,a,c="";for(;r<arguments.length;)(s=arguments[r++])&&(a=gq(s))&&(c&&(c+=" "),c+=a);return c}const gq=r=>{if(typeof r=="string")return r;let s,a="";for(let c=0;c<r.length;c++)r[c]&&(s=gq(r[c]))&&(a&&(a+=" "),a+=s);return a};function B0e(r,...s){let a,c,A,u=m;function m(w){const C=s.reduce((T,N)=>N(T),r());return a=N0e(C),c=a.cache.get,A=a.cache.set,u=E,E(w)}function E(w){const C=c(w);if(C)return C;const T=x0e(w,a);return A(w,T),T}return function(){return u(D0e.apply(null,arguments))}}const Or=r=>{const s=a=>a[r]||[];return s.isThemeGetter=!0,s},_q=/^\[(?:([a-z-]+):)?(.+)\]$/i,k0e=/^\d+\/\d+$/,L0e=new Set(["px","full","screen"]),U0e=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,P0e=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,M0e=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,F0e=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,j0e=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,al=r=>ef(r)||L0e.has(r)||k0e.test(r),uA=r=>Bf(r,"length",z0e),ef=r=>!!r&&!Number.isNaN(Number(r)),sO=r=>Bf(r,"number",ef),pg=r=>!!r&&Number.isInteger(Number(r)),V0e=r=>r.endsWith("%")&&ef(r.slice(0,-1)),un=r=>_q.test(r),hA=r=>U0e.test(r),Q0e=new Set(["length","size","percentage"]),H0e=r=>Bf(r,Q0e,Eq),G0e=r=>Bf(r,"position",Eq),K0e=new Set(["image","url"]),W0e=r=>Bf(r,K0e,X0e),Y0e=r=>Bf(r,"",q0e),fg=()=>!0,Bf=(r,s,a)=>{const c=_q.exec(r);return c?c[1]?typeof s=="string"?c[1]===s:s.has(c[1]):a(c[2]):!1},z0e=r=>P0e.test(r)&&!M0e.test(r),Eq=()=>!1,q0e=r=>F0e.test(r),X0e=r=>j0e.test(r),J0e=()=>{const r=Or("colors"),s=Or("spacing"),a=Or("blur"),c=Or("brightness"),A=Or("borderColor"),u=Or("borderRadius"),m=Or("borderSpacing"),E=Or("borderWidth"),w=Or("contrast"),C=Or("grayscale"),T=Or("hueRotate"),N=Or("invert"),B=Or("gap"),k=Or("gradientColorStops"),Q=Or("gradientColorStopPositions"),K=Or("inset"),Y=Or("margin"),F=Or("opacity"),M=Or("padding"),V=Or("saturate"),W=Or("scale"),q=Or("sepia"),te=Or("skew"),re=Or("space"),de=Or("translate"),ce=()=>["auto","contain","none"],Ae=()=>["auto","hidden","clip","visible","scroll"],ne=()=>["auto",un,s],ue=()=>[un,s],ye=()=>["",al,uA],De=()=>["auto",ef,un],Xe=()=>["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"],we=()=>["solid","dashed","dotted","double","none"],Se=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],Qe=()=>["start","end","center","between","around","evenly","stretch"],Ye=()=>["","0",un],It=()=>["auto","avoid","all","avoid-page","page","left","right","column"],Fe=()=>[ef,un];return{cacheSize:500,separator:":",theme:{colors:[fg],spacing:[al,uA],blur:["none","",hA,un],brightness:Fe(),borderColor:[r],borderRadius:["none","","full",hA,un],borderSpacing:ue(),borderWidth:ye(),contrast:Fe(),grayscale:Ye(),hueRotate:Fe(),invert:Ye(),gap:ue(),gradientColorStops:[r],gradientColorStopPositions:[V0e,uA],inset:ne(),margin:ne(),opacity:Fe(),padding:ue(),saturate:Fe(),scale:Fe(),sepia:Ye(),skew:Fe(),space:ue(),translate:ue()},classGroups:{aspect:[{aspect:["auto","square","video",un]}],container:["container"],columns:[{columns:[hA]}],"break-after":[{"break-after":It()}],"break-before":[{"break-before":It()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[...Xe(),un]}],overflow:[{overflow:Ae()}],"overflow-x":[{"overflow-x":Ae()}],"overflow-y":[{"overflow-y":Ae()}],overscroll:[{overscroll:ce()}],"overscroll-x":[{"overscroll-x":ce()}],"overscroll-y":[{"overscroll-y":ce()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[K]}],"inset-x":[{"inset-x":[K]}],"inset-y":[{"inset-y":[K]}],start:[{start:[K]}],end:[{end:[K]}],top:[{top:[K]}],right:[{right:[K]}],bottom:[{bottom:[K]}],left:[{left:[K]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",pg,un]}],basis:[{basis:ne()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",un]}],grow:[{grow:Ye()}],shrink:[{shrink:Ye()}],order:[{order:["first","last","none",pg,un]}],"grid-cols":[{"grid-cols":[fg]}],"col-start-end":[{col:["auto",{span:["full",pg,un]},un]}],"col-start":[{"col-start":De()}],"col-end":[{"col-end":De()}],"grid-rows":[{"grid-rows":[fg]}],"row-start-end":[{row:["auto",{span:[pg,un]},un]}],"row-start":[{"row-start":De()}],"row-end":[{"row-end":De()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",un]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",un]}],gap:[{gap:[B]}],"gap-x":[{"gap-x":[B]}],"gap-y":[{"gap-y":[B]}],"justify-content":[{justify:["normal",...Qe()]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal",...Qe(),"baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":[...Qe(),"baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[M]}],px:[{px:[M]}],py:[{py:[M]}],ps:[{ps:[M]}],pe:[{pe:[M]}],pt:[{pt:[M]}],pr:[{pr:[M]}],pb:[{pb:[M]}],pl:[{pl:[M]}],m:[{m:[Y]}],mx:[{mx:[Y]}],my:[{my:[Y]}],ms:[{ms:[Y]}],me:[{me:[Y]}],mt:[{mt:[Y]}],mr:[{mr:[Y]}],mb:[{mb:[Y]}],ml:[{ml:[Y]}],"space-x":[{"space-x":[re]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[re]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",un,s]}],"min-w":[{"min-w":[un,s,"min","max","fit"]}],"max-w":[{"max-w":[un,s,"none","full","min","max","fit","prose",{screen:[hA]},hA]}],h:[{h:[un,s,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[un,s,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[un,s,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[un,s,"auto","min","max","fit"]}],"font-size":[{text:["base",hA,uA]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",sO]}],"font-family":[{font:[fg]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",un]}],"line-clamp":[{"line-clamp":["none",ef,sO]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",al,un]}],"list-image":[{"list-image":["none",un]}],"list-style-type":[{list:["none","disc","decimal",un]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[r]}],"placeholder-opacity":[{"placeholder-opacity":[F]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[r]}],"text-opacity":[{"text-opacity":[F]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...we(),"wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",al,uA]}],"underline-offset":[{"underline-offset":["auto",al,un]}],"text-decoration-color":[{decoration:[r]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:ue()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",un]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",un]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[F]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[...Xe(),G0e]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",H0e]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},W0e]}],"bg-color":[{bg:[r]}],"gradient-from-pos":[{from:[Q]}],"gradient-via-pos":[{via:[Q]}],"gradient-to-pos":[{to:[Q]}],"gradient-from":[{from:[k]}],"gradient-via":[{via:[k]}],"gradient-to":[{to:[k]}],rounded:[{rounded:[u]}],"rounded-s":[{"rounded-s":[u]}],"rounded-e":[{"rounded-e":[u]}],"rounded-t":[{"rounded-t":[u]}],"rounded-r":[{"rounded-r":[u]}],"rounded-b":[{"rounded-b":[u]}],"rounded-l":[{"rounded-l":[u]}],"rounded-ss":[{"rounded-ss":[u]}],"rounded-se":[{"rounded-se":[u]}],"rounded-ee":[{"rounded-ee":[u]}],"rounded-es":[{"rounded-es":[u]}],"rounded-tl":[{"rounded-tl":[u]}],"rounded-tr":[{"rounded-tr":[u]}],"rounded-br":[{"rounded-br":[u]}],"rounded-bl":[{"rounded-bl":[u]}],"border-w":[{border:[E]}],"border-w-x":[{"border-x":[E]}],"border-w-y":[{"border-y":[E]}],"border-w-s":[{"border-s":[E]}],"border-w-e":[{"border-e":[E]}],"border-w-t":[{"border-t":[E]}],"border-w-r":[{"border-r":[E]}],"border-w-b":[{"border-b":[E]}],"border-w-l":[{"border-l":[E]}],"border-opacity":[{"border-opacity":[F]}],"border-style":[{border:[...we(),"hidden"]}],"divide-x":[{"divide-x":[E]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[E]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[F]}],"divide-style":[{divide:we()}],"border-color":[{border:[A]}],"border-color-x":[{"border-x":[A]}],"border-color-y":[{"border-y":[A]}],"border-color-s":[{"border-s":[A]}],"border-color-e":[{"border-e":[A]}],"border-color-t":[{"border-t":[A]}],"border-color-r":[{"border-r":[A]}],"border-color-b":[{"border-b":[A]}],"border-color-l":[{"border-l":[A]}],"divide-color":[{divide:[A]}],"outline-style":[{outline:["",...we()]}],"outline-offset":[{"outline-offset":[al,un]}],"outline-w":[{outline:[al,uA]}],"outline-color":[{outline:[r]}],"ring-w":[{ring:ye()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[r]}],"ring-opacity":[{"ring-opacity":[F]}],"ring-offset-w":[{"ring-offset":[al,uA]}],"ring-offset-color":[{"ring-offset":[r]}],shadow:[{shadow:["","inner","none",hA,Y0e]}],"shadow-color":[{shadow:[fg]}],opacity:[{opacity:[F]}],"mix-blend":[{"mix-blend":[...Se(),"plus-lighter","plus-darker"]}],"bg-blend":[{"bg-blend":Se()}],filter:[{filter:["","none"]}],blur:[{blur:[a]}],brightness:[{brightness:[c]}],contrast:[{contrast:[w]}],"drop-shadow":[{"drop-shadow":["","none",hA,un]}],grayscale:[{grayscale:[C]}],"hue-rotate":[{"hue-rotate":[T]}],invert:[{invert:[N]}],saturate:[{saturate:[V]}],sepia:[{sepia:[q]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[a]}],"backdrop-brightness":[{"backdrop-brightness":[c]}],"backdrop-contrast":[{"backdrop-contrast":[w]}],"backdrop-grayscale":[{"backdrop-grayscale":[C]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[T]}],"backdrop-invert":[{"backdrop-invert":[N]}],"backdrop-opacity":[{"backdrop-opacity":[F]}],"backdrop-saturate":[{"backdrop-saturate":[V]}],"backdrop-sepia":[{"backdrop-sepia":[q]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[m]}],"border-spacing-x":[{"border-spacing-x":[m]}],"border-spacing-y":[{"border-spacing-y":[m]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",un]}],duration:[{duration:Fe()}],ease:[{ease:["linear","in","out","in-out",un]}],delay:[{delay:Fe()}],animate:[{animate:["none","spin","ping","pulse","bounce",un]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[W]}],"scale-x":[{"scale-x":[W]}],"scale-y":[{"scale-y":[W]}],rotate:[{rotate:[pg,un]}],"translate-x":[{"translate-x":[de]}],"translate-y":[{"translate-y":[de]}],"skew-x":[{"skew-x":[te]}],"skew-y":[{"skew-y":[te]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",un]}],accent:[{accent:["auto",r]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",un]}],"caret-color":[{caret:[r]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":ue()}],"scroll-mx":[{"scroll-mx":ue()}],"scroll-my":[{"scroll-my":ue()}],"scroll-ms":[{"scroll-ms":ue()}],"scroll-me":[{"scroll-me":ue()}],"scroll-mt":[{"scroll-mt":ue()}],"scroll-mr":[{"scroll-mr":ue()}],"scroll-mb":[{"scroll-mb":ue()}],"scroll-ml":[{"scroll-ml":ue()}],"scroll-p":[{"scroll-p":ue()}],"scroll-px":[{"scroll-px":ue()}],"scroll-py":[{"scroll-py":ue()}],"scroll-ps":[{"scroll-ps":ue()}],"scroll-pe":[{"scroll-pe":ue()}],"scroll-pt":[{"scroll-pt":ue()}],"scroll-pr":[{"scroll-pr":ue()}],"scroll-pb":[{"scroll-pb":ue()}],"scroll-pl":[{"scroll-pl":ue()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",un]}],fill:[{fill:[r,"none"]}],"stroke-w":[{stroke:[al,uA,sO]}],stroke:[{stroke:[r,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}},$0e=B0e(J0e);function nd(...r){return $0e(pq(r))}const qe=z.forwardRef(({className:r,...s},a)=>p.jsx("div",{ref:a,className:nd("rounded-lg border bg-card text-card-foreground shadow-sm",r),...s}));qe.displayName="Card";const Pt=z.forwardRef(({className:r,...s},a)=>p.jsx("div",{ref:a,className:nd("flex flex-col space-y-1.5 p-6",r),...s}));Pt.displayName="CardHeader";const Vt=z.forwardRef(({className:r,...s},a)=>p.jsx("h3",{ref:a,className:nd("text-2xl font-semibold leading-none tracking-tight",r),...s}));Vt.displayName="CardTitle";const vi=z.forwardRef(({className:r,...s},a)=>p.jsx("p",{ref:a,className:nd("text-sm text-muted-foreground",r),...s}));vi.displayName="CardDescription";const $e=z.forwardRef(({className:r,...s},a)=>p.jsx("div",{ref:a,className:nd("p-6 pt-0",r),...s}));$e.displayName="CardContent";const S_=z.forwardRef(({className:r,...s},a)=>p.jsx("div",{ref:a,className:nd("flex items-center p-6 pt-0",r),...s}));S_.displayName="CardFooter";const er=z.forwardRef(({className:r,type:s,...a},c)=>p.jsx("input",{type:s,className:nd("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",r),ref:c,...a}));er.displayName="Input";function _G(r,s){if(typeof r=="function")return r(s);r!=null&&(r.current=s)}function Z0e(...r){return s=>{let a=!1;const c=r.map(A=>{const u=_G(A,s);return!a&&typeof u=="function"&&(a=!0),u});if(a)return()=>{for(let A=0;A<c.length;A++){const u=c[A];typeof u=="function"?u():_G(r[A],null)}}}}var eye=Symbol.for("react.lazy"),Gw=QK[" use ".trim().toString()];function tye(r){return typeof r=="object"&&r!==null&&"then"in r}function vq(r){return r!=null&&typeof r=="object"&&"$$typeof"in r&&r.$$typeof===eye&&"_payload"in r&&tye(r._payload)}function nye(r){const s=sye(r),a=z.forwardRef((c,A)=>{let{children:u,...m}=c;vq(u)&&typeof Gw=="function"&&(u=Gw(u._payload));const E=z.Children.toArray(u),w=E.find(aye);if(w){const C=w.props.children,T=E.map(N=>N===w?z.Children.count(C)>1?z.Children.only(null):z.isValidElement(C)?C.props.children:null:N);return p.jsx(s,{...m,ref:A,children:z.isValidElement(C)?z.cloneElement(C,void 0,T):null})}return p.jsx(s,{...m,ref:A,children:u})});return a.displayName=`${r}.Slot`,a}var rye=nye("Slot");function sye(r){const s=z.forwardRef((a,c)=>{let{children:A,...u}=a;if(vq(A)&&typeof Gw=="function"&&(A=Gw(A._payload)),z.isValidElement(A)){const m=cye(A),E=oye(u,A.props);return A.type!==z.Fragment&&(E.ref=c?Z0e(c,m):m),z.cloneElement(A,E)}return z.Children.count(A)>1?z.Children.only(null):null});return s.displayName=`${r}.SlotClone`,s}var iye=Symbol("radix.slottable");function aye(r){return z.isValidElement(r)&&typeof r.type=="function"&&"__radixId"in r.type&&r.type.__radixId===iye}function oye(r,s){const a={...s};for(const c in s){const A=r[c],u=s[c];/^on[A-Z]/.test(c)?A&&u?a[c]=(...E)=>{const w=u(...E);return A(...E),w}:A&&(a[c]=A):c==="style"?a[c]={...A,...u}:c==="className"&&(a[c]=[A,u].filter(Boolean).join(" "))}return{...r,...a}}function cye(r){var c,A;let s=(c=Object.getOwnPropertyDescriptor(r.props,"ref"))==null?void 0:c.get,a=s&&"isReactWarning"in s&&s.isReactWarning;return a?r.ref:(s=(A=Object.getOwnPropertyDescriptor(r,"ref"))==null?void 0:A.get,a=s&&"isReactWarning"in s&&s.isReactWarning,a?r.props.ref:r.props.ref||r.ref)}const EG=r=>typeof r=="boolean"?`${r}`:r===0?"0":r,vG=pq,lye=(r,s)=>a=>{var c;if((s==null?void 0:s.variants)==null)return vG(r,a==null?void 0:a.class,a==null?void 0:a.className);const{variants:A,defaultVariants:u}=s,m=Object.keys(A).map(C=>{const T=a==null?void 0:a[C],N=u==null?void 0:u[C];if(T===null)return null;const B=EG(T)||EG(N);return A[C][B]}),E=a&&Object.entries(a).reduce((C,T)=>{let[N,B]=T;return B===void 0||(C[N]=B),C},{}),w=s==null||(c=s.compoundVariants)===null||c===void 0?void 0:c.reduce((C,T)=>{let{class:N,className:B,...k}=T;return Object.entries(k).every(Q=>{let[K,Y]=Q;return Array.isArray(Y)?Y.includes({...u,...E}[K]):{...u,...E}[K]===Y})?[...C,N,B]:C},[]);return vG(r,m,w,a==null?void 0:a.class,a==null?void 0:a.className)},Aye=lye("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),Re=z.forwardRef(({className:r,variant:s,size:a,asChild:c=!1,...A},u)=>{const m=c?rye:"button";return p.jsx(m,{className:nd(Aye({variant:s,size:a,className:r})),ref:u,...A})});Re.displayName="Button";const dye=()=>{const[r,s]=z.useState(""),[a,c]=z.useState(""),[A,u]=z.useState(!1),[m,E]=z.useState(""),[w,C]=z.useState(!1),[T,N]=z.useState(new Date),[B,k]=z.useState("Loading..."),{signIn:Q}=gr(),K=ss();_i.useEffect(()=>{C(!1),E("");const M=localStorage.getItem("rememberedEmail"),V=localStorage.getItem("rememberedPassword");M&&(s(M),u(!0)),V&&c(V),new URLSearchParams(window.location.search).get("clear")==="true"&&(localStorage.clear(),sessionStorage.clear(),window.location.href="/")},[]),_i.useEffect(()=>{const M=setInterval(()=>N(new Date),1e3);return()=>clearInterval(M)},[]),_i.useEffect(()=>{navigator.geolocation&&navigator.geolocation.getCurrentPosition(async M=>{var V,W;try{const te=await(await fetch(`https://nominatim.openstreetmap.org/reverse?lat=${M.coords.latitude}&lon=${M.coords.longitude}&format=json`)).json();k(((V=te.address)==null?void 0:V.city)||((W=te.address)==null?void 0:W.town)||"Your Location")}catch{k("Unknown")}},()=>k("Unavailable"))},[]);const Y=()=>T.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0}),F=async M=>{M.preventDefault(),console.log("UserSignIn: Form submitted"),E(""),C(!0);const V=setTimeout(()=>{console.warn("Sign-in timeout reached, resetting loading state"),C(!1),E("Sign-in is taking too long. Please refresh and try again.")},1e4);try{console.log("UserSignIn: Calling signIn..."),await Q(r,a),console.log("UserSignIn: signIn completed successfully, navigating..."),A?(localStorage.setItem("rememberedEmail",r),localStorage.setItem("rememberedPassword",a)):(localStorage.removeItem("rememberedEmail"),localStorage.removeItem("rememberedPassword")),clearTimeout(V),C(!1),K("/dashboard",{replace:!0})}catch(W){console.error("UserSignIn: Sign in error:",W),clearTimeout(V),E(W.message||"Failed to sign in"),C(!1)}};return p.jsx("div",{className:"min-h-screen bg-gradient-to-b from-emerald-50 to-white overflow-y-auto",children:p.jsxs("div",{className:"container mx-auto p-4 max-w-md py-8",children:[p.jsxs("div",{className:"mb-6 text-center",children:[p.jsx("div",{className:"flex justify-center mb-3",children:p.jsx("img",{src:"/masjid-logo.png",alt:"Masjid Logo",className:"h-20 w-auto"})}),p.jsx("h2",{className:"text-2xl font-bold text-emerald-800 mb-1",style:{fontFamily:'"Amiri", serif'},children:" "}),p.jsx("p",{className:"text-sm text-emerald-600 font-semibold",children:"As-salamu alaykum"}),p.jsxs("div",{className:"flex items-center justify-center space-x-4 mt-2 text-xs text-gray-600",children:[p.jsxs("span",{children:[" ",B]}),p.jsxs("span",{children:[" ",Y()]})]})]}),p.jsxs(qe,{className:"w-full shadow-lg",children:[p.jsxs(Pt,{className:"bg-gradient-to-r from-emerald-600 to-emerald-700 text-white rounded-t-lg",children:[p.jsx(Vt,{className:"text-2xl",children:"Sign In"}),p.jsx(vi,{className:"text-emerald-100",children:"Welcome back! Sign in to your account"})]}),p.jsx($e,{className:"pt-6",children:p.jsxs("form",{onSubmit:F,className:"space-y-4",children:[p.jsxs("div",{children:[p.jsx("label",{htmlFor:"email",className:"block text-sm font-medium mb-2",children:"Email"}),p.jsx(er,{id:"email",type:"email",value:r,onChange:M=>s(M.target.value),placeholder:"Enter your email",required:!0})]}),p.jsxs("div",{children:[p.jsx("label",{htmlFor:"password",className:"block text-sm font-medium mb-2",children:"Password"}),p.jsx(er,{id:"password",type:"password",value:a,onChange:M=>c(M.target.value),placeholder:"Enter your password",required:!0})]}),p.jsxs("div",{className:"flex items-center space-x-2",children:[p.jsx("input",{id:"rememberMe",type:"checkbox",checked:A,onChange:M=>u(M.target.checked),className:"w-4 h-4 text-emerald-600 bg-gray-100 border-gray-300 rounded focus:ring-emerald-500 focus:ring-2"}),p.jsx("label",{htmlFor:"rememberMe",className:"text-sm font-medium text-gray-700 cursor-pointer",children:"Remember my email and password"})]}),m&&p.jsxs("div",{className:"p-4 bg-destructive/10 border border-destructive rounded-md",children:[p.jsxs("p",{className:"text-sm text-destructive font-medium mb-2",children:[" ",m]}),m.includes("verify your email")&&p.jsxs("div",{className:"mt-3 text-xs text-gray-700 bg-white p-3 rounded border border-gray-200",children:[p.jsx("p",{className:"font-semibold mb-1",children:"Next steps:"}),p.jsxs("ol",{className:"list-decimal list-inside space-y-1",children:[p.jsx("li",{children:"Check your email inbox for the confirmation link"}),p.jsx("li",{children:"Click the confirmation link in the email"}),p.jsx("li",{children:"Return here and sign in with your credentials"})]}),p.jsx("p",{className:"mt-2 text-emerald-700",children:" Check your spam folder if you don't see the email"})]})]}),p.jsx(Re,{type:"submit",className:"w-full bg-emerald-600 hover:bg-emerald-700 text-white h-12 text-base font-semibold",disabled:w,children:w?"Signing in...":"Sign In"}),p.jsxs("div",{className:"text-center text-sm text-muted-foreground pt-2",children:["Don't have an account?"," ",p.jsx("a",{href:"/signup",className:"text-emerald-600 hover:underline font-medium",children:"Sign Up"})]})]})})]}),p.jsx("div",{className:"h-32"})]})})},uye=()=>{const[r,s]=z.useState(""),[a,c]=z.useState(""),[A,u]=z.useState(""),[m,E]=z.useState(""),[w,C]=z.useState("user"),[T,N]=z.useState(""),[B,k]=z.useState(""),[Q,K]=z.useState(!1),[Y,F]=z.useState(!1),[M,V]=z.useState(new Date),[W,q]=z.useState("Loading..."),{signUp:te}=gr(),re=ss();_i.useEffect(()=>{const Ae=setInterval(()=>V(new Date),1e3);return()=>clearInterval(Ae)},[]),_i.useEffect(()=>{navigator.geolocation&&navigator.geolocation.getCurrentPosition(async Ae=>{var ne,ue;try{const De=await(await fetch(`https://nominatim.openstreetmap.org/reverse?lat=${Ae.coords.latitude}&lon=${Ae.coords.longitude}&format=json`)).json();q(((ne=De.address)==null?void 0:ne.city)||((ue=De.address)==null?void 0:ue.town)||"Your Location")}catch{q("Unknown")}},()=>q("Unavailable"))},[]);const de=()=>M.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0}),ce=async Ae=>{if(Ae.preventDefault(),N(""),k(""),!Y){N("Please agree to the Privacy Policy and Terms of Service");return}if(a!==m){N("Passwords do not match");return}if(a.length<6){N("Password must be at least 6 characters");return}K(!0);try{await te(r,a,w,A),setTimeout(()=>{re("/dashboard"),K(!1)},500)}catch(ne){ne.message==="CONFIRMATION_REQUIRED"?k("Account created successfully! Please check your email to verify your account before signing in."):N(ne.message||"Failed to create account"),K(!1)}};return p.jsx("div",{className:"min-h-screen bg-gradient-to-b from-emerald-50 to-white overflow-y-auto",children:p.jsxs("div",{className:"container mx-auto p-4 max-w-md py-8",children:[p.jsxs("div",{className:"mb-6 text-center",children:[p.jsx("div",{className:"flex justify-center mb-3",children:p.jsx("img",{src:"/crescent-logo.svg",alt:"Islamic Crescent",className:"h-16 w-16"})}),p.jsx("h2",{className:"text-2xl font-bold text-emerald-800 mb-1",style:{fontFamily:'"Amiri", serif'},children:""}),p.jsx("p",{className:"text-sm text-emerald-600 font-semibold",children:"Marhaban - Welcome"}),p.jsxs("div",{className:"flex items-center justify-center space-x-4 mt-2 text-xs text-gray-600",children:[p.jsxs("span",{children:[" ",W]}),p.jsxs("span",{children:[" ",de()]})]})]}),p.jsxs(qe,{className:"w-full shadow-lg",children:[p.jsxs(Pt,{className:"bg-gradient-to-r from-emerald-600 to-emerald-700 text-white rounded-t-lg",children:[p.jsx(Vt,{className:"text-2xl",children:"Create Account"}),p.jsx(vi,{className:"text-emerald-100",children:"Join our Islamic community platform"})]}),p.jsx($e,{className:"pt-6",children:p.jsxs("form",{onSubmit:ce,className:"space-y-4",children:[p.jsxs("div",{children:[p.jsx("label",{htmlFor:"fullName",className:"block text-sm font-medium mb-2",children:"Full Name"}),p.jsx(er,{id:"fullName",type:"text",value:A,onChange:Ae=>u(Ae.target.value),placeholder:"Enter your full name",required:!0})]}),p.jsxs("div",{children:[p.jsx("label",{htmlFor:"role",className:"block text-sm font-medium mb-2",children:"Account Type"}),p.jsxs("select",{id:"role",value:w,onChange:Ae=>C(Ae.target.value),className:"w-full px-3 py-2 border border-input bg-background rounded-md focus:outline-none focus:ring-2 focus:ring-ring",required:!0,children:[p.jsx("option",{value:"user",children:"Community Member"}),p.jsx("option",{value:"imam",children:"Imam"}),p.jsx("option",{value:"scholar",children:"Scholar"})]})]}),p.jsxs("div",{children:[p.jsx("label",{htmlFor:"email",className:"block text-sm font-medium mb-2",children:"Email"}),p.jsx(er,{id:"email",type:"email",value:r,onChange:Ae=>s(Ae.target.value),placeholder:"Enter your email",required:!0})]}),p.jsxs("div",{children:[p.jsx("label",{htmlFor:"password",className:"block text-sm font-medium mb-2",children:"Password"}),p.jsx(er,{id:"password",type:"password",value:a,onChange:Ae=>c(Ae.target.value),placeholder:"Create a password",required:!0})]}),p.jsxs("div",{children:[p.jsx("label",{htmlFor:"confirmPassword",className:"block text-sm font-medium mb-2",children:"Confirm Password"}),p.jsx(er,{id:"confirmPassword",type:"password",value:m,onChange:Ae=>E(Ae.target.value),placeholder:"Confirm your password",required:!0})]}),T&&p.jsx("div",{className:"p-3 bg-destructive/10 border border-destructive rounded-md",children:p.jsx("p",{className:"text-sm text-destructive",children:T})}),B&&p.jsxs("div",{className:"p-4 bg-emerald-50 border border-emerald-300 rounded-md",children:[p.jsxs("p",{className:"text-sm text-emerald-800 font-medium mb-2",children:[" ",B]}),p.jsx("p",{className:"text-xs text-emerald-700",children:" Check your spam folder if you don't see the email within a few minutes."})]}),p.jsxs("div",{className:"flex items-start space-x-2 p-3 bg-gray-50 rounded-lg",children:[p.jsx("input",{type:"checkbox",id:"terms",checked:Y,onChange:Ae=>F(Ae.target.checked),className:"mt-1 h-4 w-4 text-emerald-600 focus:ring-emerald-500 border-gray-300 rounded",required:!0}),p.jsxs("label",{htmlFor:"terms",className:"text-xs text-gray-700",children:["I agree to the"," ",p.jsx("a",{href:"/privacy-policy",target:"_blank",className:"text-emerald-600 hover:underline font-medium",children:"Privacy Policy"})," ","and"," ",p.jsx("a",{href:"/terms-of-service",target:"_blank",className:"text-emerald-600 hover:underline font-medium",children:"Terms of Service"})]})]}),p.jsx(Re,{type:"submit",className:"w-full bg-emerald-600 hover:bg-emerald-700 text-white h-12 text-base font-semibold",disabled:Q||!Y,children:Q?"Creating account...":"Sign Up"}),p.jsxs("div",{className:"text-center text-sm text-muted-foreground pt-2",children:["Already have an account?"," ",p.jsx("a",{href:"/signin",className:"text-emerald-600 hover:underline font-medium",children:"Sign In"})]})]})})]}),p.jsx("div",{className:"h-32"})]})})},hye=()=>{const[r,s]=z.useState([]),[a,c]=z.useState("Lagos, Nigeria"),[A,u]=z.useState(""),[m,E]=z.useState(""),[w,C]=z.useState(0);z.useEffect(()=>{T();const M=setInterval(()=>{Q()},6e4);return()=>clearInterval(M)},[]),z.useEffect(()=>{if(r.length>0){const M=r.length+1,V=setInterval(()=>{C(W=>(W+1)%M)},3e3);return()=>clearInterval(V)}},[r.length]);const T=async()=>{try{navigator.geolocation?navigator.geolocation.getCurrentPosition(async M=>{const{latitude:V,longitude:W}=M.coords;await N(V,W)},()=>{B("Lagos","NG")}):B("Lagos","NG")}catch(M){console.error("Error fetching prayer times:",M)}},N=async(M,V)=>{try{const q=Math.floor(new Date().getTime()/1e3),re=await(await fetch(`https://api.aladhan.com/v1/timings/${q}?latitude=${M}&longitude=${V}&method=2`)).json();re.code===200&&(k(re.data),c(`${re.data.meta.timezone}`))}catch(W){console.error("Error fetching prayer times by coords:",W)}},B=async(M,V)=>{try{const W=new Date,q=W.getDate(),te=W.getMonth()+1,re=W.getFullYear(),ce=await(await fetch(`https://api.aladhan.com/v1/timingsByCity/${q}-${te}-${re}?city=${M}&country=${V}&method=2`)).json();ce.code===200&&(k(ce.data),c(`${M}, ${V}`))}catch(W){console.error("Error fetching prayer times by city:",W)}},k=M=>{const V=M.timings,W=[{name:"Fajr",time:V.Fajr,arabic:""},{name:"Dhuhr",time:V.Dhuhr,arabic:""},{name:"Asr",time:V.Asr,arabic:""},{name:"Maghrib",time:V.Maghrib,arabic:""},{name:"Isha",time:V.Isha,arabic:""}];s(W),Q(W)},Q=(M=r)=>{if(M.length===0)return;const V=new Date,W=V.getHours()*60+V.getMinutes();for(let q=0;q<M.length;q++){const[te,re]=M[q].time.split(":").map(Number),de=te*60+re;if(W<de){E(M[q].name),q>0?u(M[q-1].name):u("Isha");return}}u("Isha"),E("Fajr")},K=M=>M===m,Y=M=>M===A,F=[...r,{name:"Jumu'ah",time:"1:30 PM",arabic:""}];return p.jsx(qe,{className:"bg-gradient-to-br from-emerald-600 to-teal-700 text-white shadow-lg",children:p.jsxs($e,{className:"p-3",children:[p.jsx("div",{className:"flex items-center justify-between mb-2",children:p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx(Pa,{className:"h-4 w-4"}),p.jsx("h3",{className:"font-bold text-sm",children:"Prayer Times"})]})}),p.jsx("div",{className:"relative overflow-hidden h-20",children:p.jsx("div",{className:"flex transition-transform duration-700 ease-in-out",style:{transform:`translateX(-${w*100}%)`},children:F.map((M,V)=>p.jsx("div",{className:"min-w-full flex items-center justify-center",children:p.jsxs("div",{className:`text-center p-2 rounded-lg w-full ${M.name==="Jumu'ah"?"bg-green-500/30 border border-green-300":K(M.name)?"bg-amber-500/30 border border-amber-300":Y(M.name)?"bg-emerald-800/50":"bg-white/10"}`,children:[p.jsx("div",{className:"text-xs font-bold mb-0.5",children:M.arabic}),p.jsx("div",{className:"text-sm font-semibold mb-0.5",children:M.name}),p.jsx("div",{className:"text-lg font-bold",children:M.time}),M.name==="Jumu'ah"&&p.jsx("div",{className:"text-xs mt-0.5 opacity-75",children:"Every Friday"}),K(M.name)&&M.name!=="Jumu'ah"&&p.jsx("div",{className:"text-xs mt-0.5 font-semibold",children:" Next"})]})},V))})})]})})};function pye(){const{profile:r,signOut:s}=gr(),a=ss(),[c,A]=_i.useState(new Date),[u,m]=_i.useState("Loading..."),[E,w]=_i.useState(!1),[C,T]=_i.useState(0),[N,B]=_i.useState(0),k=_i.useRef(null),Q=(r==null?void 0:r.role)==="scholar"||(r==null?void 0:r.role)==="imam",K=(r==null?void 0:r.full_name)||"User",Y=async()=>{try{await s(),a("/signin")}catch(ne){console.error("Sign out error:",ne)}};_i.useEffect(()=>{const ne=setInterval(()=>A(new Date),1e3);return()=>clearInterval(ne)},[]),_i.useEffect(()=>{navigator.geolocation&&navigator.geolocation.getCurrentPosition(async ne=>{var ue,ye,De;try{const we=await(await fetch(`https://nominatim.openstreetmap.org/reverse?lat=${ne.coords.latitude}&lon=${ne.coords.longitude}&format=json`)).json();m(((ue=we.address)==null?void 0:ue.city)||((ye=we.address)==null?void 0:ye.town)||((De=we.address)==null?void 0:De.county)||"Unknown Location")}catch{m("Location Unknown")}},()=>m("Location Unavailable"))},[]);const F=ne=>{k.current&&k.current.scrollTop===0&&T(ne.touches[0].clientY)},M=ne=>{if(C===0||E)return;const ye=ne.touches[0].clientY-C;ye>0&&ye<150&&B(ye)},V=async()=>{if(N>80&&!E){w(!0),B(0);try{navigator.geolocation&&navigator.geolocation.getCurrentPosition(async ne=>{var ue,ye,De;try{const we=await(await fetch(`https://nominatim.openstreetmap.org/reverse?lat=${ne.coords.latitude}&lon=${ne.coords.longitude}&format=json`)).json();m(((ue=we.address)==null?void 0:ue.city)||((ye=we.address)==null?void 0:ye.town)||((De=we.address)==null?void 0:De.county)||"Unknown Location")}catch{m("Location Unknown")}}),A(new Date),await new Promise(ne=>setTimeout(ne,800))}catch(ne){console.error("Refresh error:",ne)}finally{w(!1)}}else B(0);T(0)},W=()=>{const ne=c.getHours();return ne<12?"  - Good Morning":ne<18?"  - Good Afternoon":"  - Good Evening"},q=()=>c.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0}),te=[{title:"Holy Quran",description:"Read with audio",detail:"Read and listen to the Holy Quran",icon:w_,color:"bg-emerald-50",iconColor:"text-emerald-600",buttonColor:"bg-emerald-500 hover:bg-emerald-600",path:"/quran"},{title:"Qibla Direction",description:"Find prayer direction",detail:"Find the direction to Makkah",icon:jw,color:"bg-cyan-50",iconColor:"text-cyan-600",buttonColor:"bg-cyan-500 hover:bg-cyan-600",path:"/qibla"}],re=[{title:"Join Live Streams",description:"Watch prayers & lectures",detail:"Join existing streams from scholars and imams",icon:bl,color:"bg-red-50",iconColor:"text-red-600",buttonColor:"bg-red-500 hover:bg-red-600",path:"/livestreams"},{title:"Find Scholars",description:"Book consultations",detail:"Browse available scholars and book consultation sessions",icon:Mx,color:"bg-blue-50",iconColor:"text-blue-600",buttonColor:"bg-blue-500 hover:bg-blue-600",path:"/book-consultation"},{title:"My Bookings",description:"View your consultations",detail:"Manage your consultation bookings and chat with scholars",icon:fr,color:"bg-purple-50",iconColor:"text-purple-600",buttonColor:"bg-purple-500 hover:bg-purple-600",path:"/book-consultation"},{title:"Zakat & Donations",description:"Support our community",detail:"Give Zakat and support community initiatives",icon:Ma,color:"bg-green-50",iconColor:"text-green-600",buttonColor:"bg-green-500 hover:bg-green-600",path:"/donate"},{title:"Islamic Reels",description:"Watch & Upload Reels",detail:"Share Islamic content through short videos",icon:Px,color:"bg-pink-50",iconColor:"text-pink-600",buttonColor:"bg-pink-500 hover:bg-pink-600",path:"/reels"},{title:"Activities & Restaurants",description:"Community & Halal Food",detail:"Discover events and halal dining options",icon:Vw,color:"bg-orange-50",iconColor:"text-orange-600",buttonColor:"bg-orange-500 hover:bg-orange-600",path:"/activities"}],de=[{title:"Start Live Stream",description:"Begin broadcasting",detail:"Start streaming live prayer service or lecture",icon:bl,color:"bg-red-50",iconColor:"text-red-600",buttonColor:"bg-red-500 hover:bg-red-600",path:"/start-stream"},{title:"Manage Consultations",description:"Consultation & Activities",detail:"View consultation bookings, activities, and chat with members",icon:fr,color:"bg-violet-50",iconColor:"text-violet-600",buttonColor:"bg-violet-500 hover:bg-violet-600",path:"/manage-consultations"},{title:"Scholar Analytics",description:"Performance & Insights",detail:"View consultation history, earnings analytics, and statistics",icon:nq,color:"bg-amber-50",iconColor:"text-amber-600",buttonColor:"bg-amber-500 hover:bg-amber-600",path:"/scholar-dashboard"},{title:"Manage Zakat and Donations",description:"Zakat & Charitable Giving",detail:"Manage zakat from livestreams and donations, view history, and withdraw funds",icon:Ma,color:"bg-green-50",iconColor:"text-green-600",buttonColor:"bg-green-500 hover:bg-green-600",path:"/wallet"}],ce=[{title:"Access premium features and content",icon:Gve,color:"bg-gradient-to-br from-amber-50 to-orange-50",iconColor:"text-amber-600",buttonColor:"bg-amber-500 hover:bg-amber-600",buttonText:"Open"},{title:"Discover and book halal restaurants",icon:Vw,color:"bg-gradient-to-br from-cyan-50 to-blue-50",iconColor:"text-cyan-600",buttonColor:"bg-cyan-500 hover:bg-cyan-600",buttonText:"Open",path:"/activities/restaurant"}],Ae=Q?de:re;return p.jsxs("div",{ref:k,className:"min-h-screen bg-gradient-to-b from-emerald-50 to-white pb-28 overflow-y-auto",onTouchStart:F,onTouchMove:M,onTouchEnd:V,children:[N>0&&p.jsx("div",{className:"fixed left-0 right-0 z-50 flex items-center justify-center bg-emerald-500 text-white transition-all duration-300",style:{top:0,height:`${N}px`,opacity:N/100,paddingTop:"env(safe-area-inset-top)"},children:p.jsx("div",{className:"text-sm font-medium",children:N>80?" Release to refresh":" Pull down to refresh"})}),E&&p.jsx("div",{className:"fixed top-4 left-0 right-0 z-50 flex items-center justify-center",children:p.jsx("div",{className:"bg-white rounded-full p-3 shadow-lg",children:p.jsx("div",{className:"animate-spin h-6 w-6 border-4 border-emerald-500 border-t-transparent rounded-full"})})}),p.jsx("div",{className:"bg-gradient-to-r from-emerald-600 to-emerald-700 text-white p-6 shadow-lg",children:p.jsxs("div",{className:"flex justify-between items-start",children:[p.jsxs("div",{className:"flex items-center space-x-2 sm:space-x-3",children:[p.jsxs("div",{className:"relative flex-shrink-0",children:[p.jsx("div",{className:"absolute inset-0 bg-emerald-300/30 rounded-full blur-lg animate-pulse"}),p.jsx("img",{src:"/masjid-logo-dashboard.png",alt:"Masjid Logo",className:"relative h-12 w-12 sm:h-14 sm:w-14 md:h-16 md:w-16 object-contain drop-shadow-2xl",style:{filter:"drop-shadow(0 0 8px rgba(16, 185, 129, 0.6)) drop-shadow(0 4px 12px rgba(0, 0, 0, 0.4))"},crossOrigin:"anonymous"})]}),p.jsxs("div",{className:"flex-1 min-w-0",children:[p.jsx("h1",{className:"text-2xl sm:text-3xl font-bold tracking-wider truncate",style:{fontFamily:'"Amiri", "Arabic Typesetting", serif',textShadow:"2px 2px 4px rgba(0,0,0,0.3)"},children:""}),p.jsx("p",{className:"text-xs text-emerald-100 mt-0.5 truncate",children:W()}),p.jsxs("p",{className:"text-emerald-200 text-xs sm:text-sm font-semibold mt-1 truncate",children:["As-salamu alaykum, ",K]})]})]}),p.jsxs("div",{className:"flex flex-col items-end space-y-1",children:[p.jsxs("div",{className:"flex items-center space-x-2",children:[p.jsx(Re,{variant:"ghost",size:"icon",className:"text-white hover:bg-emerald-600 rounded-full bg-emerald-500/40 shadow-lg",onClick:()=>a("/profile-settings"),title:"Settings",children:p.jsx(cq,{className:"h-6 w-6 drop-shadow-md"})}),p.jsx(Re,{variant:"ghost",size:"icon",className:"text-white hover:bg-red-600 rounded-full bg-red-500/40 shadow-lg",onClick:Y,title:"Sign Out",children:p.jsx(Ave,{className:"h-6 w-6 drop-shadow-md"})})]}),p.jsxs("div",{className:"text-right",children:[p.jsx("p",{className:"text-xs text-emerald-100",children:u}),p.jsx("p",{className:"text-sm font-bold",children:q()})]})]})]})}),p.jsxs("div",{className:"p-4 space-y-6",children:[p.jsx(hye,{}),!Q&&p.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:ce.map((ne,ue)=>p.jsx(qe,{className:`${ne.color} border-none shadow-md`,children:p.jsx($e,{className:"p-4",children:p.jsxs("div",{className:"flex items-center justify-between",children:[p.jsx("div",{className:"flex-1",children:p.jsx("p",{className:"text-sm text-gray-700 font-medium",children:ne.title})}),p.jsx(Re,{className:`${ne.buttonColor} text-white ml-4`,onClick:()=>ne.path&&a(ne.path),children:ne.buttonText})]})})},ue))}),p.jsx("div",{className:"grid grid-cols-2 gap-2",children:te.map(ne=>{const ue=ne.icon;return p.jsx(qe,{className:`${ne.color} border-none shadow-md hover:shadow-lg transition-all`,children:p.jsx($e,{className:"p-3",children:p.jsxs("div",{className:"flex flex-col items-center text-center space-y-2",children:[p.jsx("div",{className:`p-3 rounded-xl shadow-md ${ne.color}`,children:p.jsx(ue,{className:`h-8 w-8 ${ne.iconColor} drop-shadow-md`})}),p.jsx("h3",{className:`text-xs font-bold ${ne.iconColor}`,children:ne.title}),p.jsx(Re,{className:`w-full ${ne.buttonColor} text-white text-xs h-8 shadow-md hover:shadow-lg`,onClick:()=>a(ne.path),children:"Open"})]})})},ne.title)})}),p.jsx("div",{className:"grid grid-cols-2 gap-2",children:Ae.map(ne=>{const ue=ne.icon;return p.jsx(qe,{className:`${ne.color} border-none shadow-md hover:shadow-lg transition-all`,children:p.jsx($e,{className:"p-2.5",children:p.jsxs("div",{className:"flex flex-col items-center text-center space-y-1.5",children:[p.jsx("div",{className:`p-2.5 rounded-xl shadow-md ${ne.color}`,children:p.jsx(ue,{className:`h-7 w-7 ${ne.iconColor} drop-shadow-md`})}),p.jsx("h3",{className:`text-[11px] font-bold ${ne.iconColor} leading-tight`,children:ne.title}),p.jsx(Re,{className:`w-full ${ne.buttonColor} text-white text-[11px] h-7 shadow-md hover:shadow-lg`,onClick:()=>a(ne.path),children:"Open"})]})})},ne.title)})}),!Q&&p.jsx(qe,{className:"bg-gradient-to-br from-amber-50 to-yellow-50 border-2 border-amber-200 shadow-lg hover:shadow-xl transition-shadow",children:p.jsx($e,{className:"p-3",children:p.jsxs("div",{className:"flex items-center justify-between",children:[p.jsxs("div",{className:"flex items-center space-x-2",children:[p.jsx("div",{className:"p-2 rounded-lg bg-gradient-to-br from-amber-100 to-yellow-100 shadow-md",children:p.jsx(Tb,{className:"h-6 w-6 text-amber-600"})}),p.jsx("div",{children:p.jsx("h3",{className:"text-base font-bold text-amber-800",children:"Coin Wallet"})})]}),p.jsxs(Re,{className:"bg-amber-500 hover:bg-amber-600 text-white shadow-md h-8 text-xs",onClick:()=>a("/coin-wallet"),children:[p.jsx(Rb,{className:"h-3 w-3 mr-1"}),"Open"]})]})})}),!Q&&p.jsxs("div",{className:"mt-8",children:[p.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-4",children:"This Week's Jummah"}),p.jsx(qe,{className:"bg-gradient-to-br from-green-50 to-emerald-50 border-2 border-green-200 shadow-lg hover:shadow-xl transition-shadow mb-6",children:p.jsx($e,{className:"p-6",children:p.jsxs("div",{className:"flex items-start space-x-4",children:[p.jsx("div",{className:"p-4 rounded-xl bg-gradient-to-br from-green-100 to-emerald-100 shadow-md",children:p.jsx(yi,{className:"h-10 w-10 text-green-600"})}),p.jsxs("div",{className:"flex-1",children:[p.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[p.jsx("h3",{className:"text-2xl font-bold text-gray-800",children:"Friday Congregational Prayer"}),p.jsx("span",{className:"px-2 py-1 bg-green-500 text-white text-xs rounded-full font-semibold",children:"LIVE"})]}),p.jsx("p",{className:"text-gray-600 mb-4",children:"Join us live for the weekly Friday prayer service with khutbah (sermon) delivered in Arabic and English."}),p.jsxs("div",{className:"space-y-2 mb-4",children:[p.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[p.jsx(Mx,{className:"h-4 w-4 mr-2"}),p.jsx("span",{children:"Led by Imam Abdullah"})]}),p.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[p.jsx(wl,{className:"h-4 w-4 mr-2"}),p.jsx("span",{children:"Main Prayer Hall - Live Stream"})]}),p.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[p.jsx(fr,{className:"h-4 w-4 mr-2"}),p.jsx("span",{className:"font-semibold",children:"Every Friday at 12:30 PM"})]})]}),p.jsx(Re,{className:"bg-green-500 hover:bg-green-600 text-white w-full shadow-md hover:shadow-lg",onClick:()=>a("/livestreams"),children:"Join Live Stream"})]})]})})})]})]}),p.jsx("div",{className:"fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 shadow-lg z-50",style:{paddingBottom:"env(safe-area-inset-bottom)"},children:p.jsxs("div",{className:"flex justify-between items-center py-1 px-0.5 max-w-2xl mx-auto gap-0.5",children:[p.jsx(su,{icon:wl,label:"Masjid",active:!0,onClick:()=>a("/dashboard")}),p.jsx(su,{icon:bl,label:"Live",onClick:()=>a(Q?"/start-stream":"/livestreams")}),p.jsx(su,{icon:w_,label:"Quran",onClick:()=>a("/quran")}),p.jsx(su,{icon:jw,label:"Qibla",onClick:()=>a("/qibla")}),Q?p.jsx(su,{icon:fr,label:"Manage",onClick:()=>a("/manage-consultations")}):p.jsxs(p.Fragment,{children:[p.jsx(su,{icon:fr,label:"Activities",onClick:()=>a("/activity-categories")}),p.jsx(su,{icon:eq,label:"Bookings",onClick:()=>a("/my-bookings")})]})]})})]})}function su({icon:r,label:s,active:a=!1,onClick:c}){return p.jsxs("button",{onClick:c,className:`flex flex-col items-center justify-center flex-1 min-w-0 py-1 px-0.5 rounded-lg transition-all ${a?"text-emerald-600 bg-emerald-100":"text-gray-600 hover:text-emerald-600 hover:bg-emerald-50"}`,children:[p.jsx(r,{className:`h-4 w-4 sm:h-5 sm:w-5 flex-shrink-0 ${a?"text-emerald-600":""}`}),p.jsx("span",{className:"text-[9px] sm:text-[10px] mt-0.5 font-semibold leading-tight text-center truncate w-full",children:s})]})}function fye(){const r=ss(),[s,a]=z.useState(!0),[c,A]=z.useState(!1);return z.useEffect(()=>{const u=setTimeout(()=>{A(!0)},2e3),m=setTimeout(()=>{a(!1),r("/landing")},2800);return()=>{clearTimeout(u),clearTimeout(m)}},[r]),s?p.jsxs("div",{className:`fixed inset-0 bg-gradient-to-br from-emerald-600 via-emerald-700 to-teal-800 flex flex-col items-center justify-center z-[9999] transition-opacity duration-800 ${c?"opacity-0":"opacity-100"}`,children:[p.jsxs("div",{className:"absolute inset-0 opacity-10",children:[p.jsx("div",{className:"absolute top-1/4 left-1/4 w-64 h-64 bg-white rounded-full blur-3xl animate-pulse"}),p.jsx("div",{className:"absolute bottom-1/4 right-1/4 w-64 h-64 bg-emerald-300 rounded-full blur-3xl animate-pulse",style:{animationDelay:"700ms"}})]}),p.jsxs("div",{className:"relative z-10 flex flex-col items-center space-y-6",children:[p.jsxs("div",{className:"relative",children:[p.jsx("div",{className:"absolute inset-0 bg-emerald-300/50 rounded-2xl blur-2xl animate-pulse"}),p.jsx("img",{src:"/masjid-logo.png",alt:"Masjid",className:"relative h-32 w-auto drop-shadow-2xl",style:{filter:"drop-shadow(0 0 20px rgba(255, 255, 255, 0.8)) drop-shadow(0 8px 24px rgba(0, 0, 0, 0.4))",animation:"fadeIn 1s ease-in-out, float 3s ease-in-out infinite"}})]}),p.jsxs("div",{className:"text-center space-y-2",style:{animation:"fadeIn 1s ease-in-out 0.3s backwards"},children:[p.jsx("h1",{className:"text-5xl font-bold text-white tracking-wider drop-shadow-lg",style:{fontFamily:'"Amiri", "Arabic Typesetting", serif',textShadow:"0 4px 12px rgba(0, 0, 0, 0.5)"},children:""}),p.jsx("p",{className:"text-xl text-emerald-100 font-medium tracking-wide",children:"Islamic Community App"})]}),p.jsxs("div",{className:"flex space-x-2 mt-8",children:[p.jsx("div",{className:"w-2 h-2 bg-white rounded-full animate-bounce",style:{animationDelay:"0ms"}}),p.jsx("div",{className:"w-2 h-2 bg-white rounded-full animate-bounce",style:{animationDelay:"150ms"}}),p.jsx("div",{className:"w-2 h-2 bg-white rounded-full animate-bounce",style:{animationDelay:"300ms"}})]})]}),p.jsxs("div",{className:"absolute bottom-12 text-center px-6",children:[p.jsx("p",{className:"text-emerald-100 text-sm opacity-80",children:"   "}),p.jsx("p",{className:"text-white/70 text-xs mt-2",children:"In the name of Allah, the Most Gracious, the Most Merciful"})]}),p.jsx("style",{children:`
        @keyframes fadeIn {
          from {
            opacity: 0;
            transform: scale(0.9);
          }
          to {
            opacity: 1;
            transform: scale(1);
          }
        }

        @keyframes float {
          0%, 100% {
            transform: translateY(0);
          }
          50% {
            transform: translateY(-10px);
          }
        }
      `})]}):null}const mye=()=>{const r=ss(),s="https://petal-salto-1a6.notion.site/MASJIDMOBILE-APP-PRIVACY-POLICY-EULA-2cd859eb5c00806a9948eb3d1695f9dc";return p.jsxs("div",{className:"min-h-screen bg-gradient-to-b from-emerald-50 to-white flex flex-col",children:[p.jsx("div",{className:"bg-gradient-to-r from-emerald-600 to-emerald-700 text-white p-4 sticky top-0 z-10 shadow-lg",children:p.jsxs("div",{className:"flex items-center justify-between",children:[p.jsxs("div",{className:"flex items-center",children:[p.jsx(Re,{variant:"ghost",size:"icon",className:"text-white hover:bg-emerald-500 mr-2",onClick:()=>r(-1),children:p.jsx(Qu,{className:"h-6 w-6"})}),p.jsx("h1",{className:"text-xl font-bold",children:"Privacy Policy"})]}),p.jsxs("a",{href:s,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-1 text-sm hover:underline",children:[p.jsx(rq,{className:"h-4 w-4"}),p.jsx("span",{className:"hidden sm:inline",children:"Open in new tab"})]})]})}),p.jsx("div",{className:"flex-1 w-full",children:p.jsx("iframe",{src:s,className:"w-full h-full border-0",style:{minHeight:"calc(100vh - 64px)"},title:"Privacy Policy"})})]})},gye=()=>{const r=ss(),s="https://petal-salto-1a6.notion.site/MASJID-PRIVACY-POLICY-TERMS-OF-SERVICE-END-USER-LICENSE-AGREEMENT-EULA-2cd859eb5c00806a9948eb3d1695f9dc?source=copy_link";return p.jsxs("div",{className:"min-h-screen bg-gradient-to-b from-emerald-50 to-white flex flex-col",children:[p.jsx("div",{className:"bg-gradient-to-r from-emerald-600 to-emerald-700 text-white p-4 sticky top-0 z-10 shadow-lg",children:p.jsxs("div",{className:"flex items-center justify-between",children:[p.jsxs("div",{className:"flex items-center",children:[p.jsx(Re,{variant:"ghost",size:"icon",className:"text-white hover:bg-emerald-500 mr-2",onClick:()=>r(-1),children:p.jsx(Qu,{className:"h-6 w-6"})}),p.jsx("h1",{className:"text-xl font-bold",children:"Terms of Service"})]}),p.jsxs("a",{href:s,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-1 text-sm hover:underline",children:[p.jsx(rq,{className:"h-4 w-4"}),p.jsx("span",{className:"hidden sm:inline",children:"Open in new tab"})]})]})}),p.jsx("div",{className:"flex-1 w-full",children:p.jsx("iframe",{src:s,className:"w-full h-full border-0",style:{minHeight:"calc(100vh - 64px)"},title:"Terms of Service"})})]})},Hx={Shafi:"shafi",Hanafi:"hanafi"};function _ye(r){switch(r){case Hx.Shafi:return 1;case Hx.Hanafi:return 2;default:throw"Invalid Madhab"}}const _y={MiddleOfTheNight:"middleofthenight",SeventhOfTheNight:"seventhofthenight",TwilightAngle:"twilightangle"};class SB{constructor(s,a){this.latitude=s,this.longitude=a}}const $g={Nearest:"nearest",Up:"up",None:"none"};function C_(r,s){const a=r.getFullYear(),c=r.getMonth(),A=r.getDate()+s,u=r.getHours(),m=r.getMinutes(),E=r.getSeconds();return new Date(a,c,A,u,m,E)}function iu(r,s){return DA(r,s*60)}function DA(r,s){return new Date(r.getTime()+s*1e3)}function au(r,s=$g.Nearest){const a=r.getUTCSeconds();let c=a>=30?60-a:-1*a;return s===$g.Up?c=60-a:s===$g.None&&(c=0),DA(r,c)}function yG(r){let s=0;const c=[31,tr.isLeapYear(r.getFullYear())?29:28,31,30,31,30,31,31,30,31,30,31];for(let A=0;A<r.getMonth();A++)s+=c[A];return s+=r.getDate(),s}function wG(r){return r instanceof Date&&!isNaN(r.valueOf())}function xn(r){return r*Math.PI/180}function gf(r){return r*180/Math.PI}function yq(r,s){return r-s*Math.floor(r/s)}function Zi(r){return yq(r,360)}function Eye(r){return r>=-180&&r<=180?r:r-360*Math.round(r/360)}const Gx={General:"general",Ahmer:"ahmer",Abyad:"abyad"},tr={meanSolarLongitude(r){const s=r,a=280.4664567,c=36000.76983*s,A=3032e-7*Math.pow(s,2),u=a+c+A;return Zi(u)},meanLunarLongitude(r){const s=r,a=218.3165,c=481267.8813*s,A=a+c;return Zi(A)},ascendingLunarNodeLongitude(r){const s=r,a=125.04452,c=1934.136261*s,A=.0020708*Math.pow(s,2),u=Math.pow(s,3)/45e4,m=a-c+A+u;return Zi(m)},meanSolarAnomaly(r){const s=r,a=357.52911,c=35999.05029*s,A=1537e-7*Math.pow(s,2),u=a+c-A;return Zi(u)},solarEquationOfTheCenter(r,s){const a=r,c=xn(s),A=(1.914602-.004817*a-14e-6*Math.pow(a,2))*Math.sin(c),u=(.019993-101e-6*a)*Math.sin(2*c),m=289e-6*Math.sin(3*c);return A+u+m},apparentSolarLongitude(r,s){const a=r,A=s+tr.solarEquationOfTheCenter(a,tr.meanSolarAnomaly(a)),u=125.04-1934.136*a,m=A-.00569-.00478*Math.sin(xn(u));return Zi(m)},meanObliquityOfTheEcliptic(r){const s=r,a=23.439291,c=.013004167*s,A=1639e-10*Math.pow(s,2),u=5036e-10*Math.pow(s,3);return a-c-A+u},apparentObliquityOfTheEcliptic(r,s){const a=r,c=s,A=125.04-1934.136*a;return c+.00256*Math.cos(xn(A))},meanSiderealTime(r){const s=r,a=s*36525+2451545,c=280.46061837,A=360.98564736629*(a-2451545),u=387933e-9*Math.pow(s,2),m=Math.pow(s,3)/3871e4,E=c+A+u-m;return Zi(E)},nutationInLongitude(r,s,a,c){const A=s,u=a,m=c,E=-17.2/3600*Math.sin(xn(m)),w=1.32/3600*Math.sin(2*xn(A)),C=.23/3600*Math.sin(2*xn(u)),T=.21/3600*Math.sin(2*xn(m));return E-w-C+T},nutationInObliquity(r,s,a,c){const A=s,u=a,m=c,E=9.2/3600*Math.cos(xn(m)),w=.57/3600*Math.cos(2*xn(A)),C=.1/3600*Math.cos(2*xn(u)),T=.09/3600*Math.cos(2*xn(m));return E+w+C-T},altitudeOfCelestialBody(r,s,a){const c=r,A=s,u=a,m=Math.sin(xn(c))*Math.sin(xn(A)),E=Math.cos(xn(c))*Math.cos(xn(A))*Math.cos(xn(u));return gf(Math.asin(m+E))},approximateTransit(r,s,a){const c=r,A=s,u=a,m=c*-1;return yq((u+m-A)/360,1)},correctedTransit(r,s,a,c,A,u){const m=r,E=s,w=a,C=c,T=A,N=u,B=E*-1,k=Zi(w+360.985647*m),Q=Zi(tr.interpolateAngles(C,T,N,m)),Y=Eye(k-B-Q)/-360;return(m+Y)*24},correctedHourAngle(r,s,a,c,A,u,m,E,w,C,T){const N=r,B=s,k=A,Q=u,K=m,Y=E,F=w,M=C,V=T,W=a.longitude*-1,q=Math.sin(xn(B))-Math.sin(xn(a.latitude))*Math.sin(xn(F)),te=Math.cos(xn(a.latitude))*Math.cos(xn(F)),re=gf(Math.acos(q/te)),de=c?N+re/360:N-re/360,ce=Zi(k+360.985647*de),Ae=Zi(tr.interpolateAngles(Q,K,Y,de)),ne=tr.interpolate(F,M,V,de),ue=ce-W-Ae,De=tr.altitudeOfCelestialBody(a.latitude,ne,ue)-B,Xe=360*Math.cos(xn(ne))*Math.cos(xn(a.latitude))*Math.sin(xn(ue)),we=De/Xe;return(de+we)*24},interpolate(r,s,a,c){const A=r-s,u=a-r,m=u-A;return r+c/2*(A+u+c*m)},interpolateAngles(r,s,a,c){const A=Zi(r-s),u=Zi(a-r),m=u-A;return r+c/2*(A+u+c*m)},julianDay(r,s,a,c=0){const A=Math.trunc,u=A(s>2?r:r-1),m=A(s>2?s:s+12),E=a+c/24,w=A(u/100),C=A(2-w+A(w/4)),T=A(365.25*(u+4716)),N=A(30.6001*(m+1));return T+N+E+C-1524.5},julianCentury(r){return(r-2451545)/36525},isLeapYear(r){return!(r%4!==0||r%100===0&&r%400!==0)},seasonAdjustedMorningTwilight(r,s,a,c){const A=75+.5209090909090909*Math.abs(r),u=75+19.44/55*Math.abs(r),m=75+32.74/55*Math.abs(r),E=75+48.1/55*Math.abs(r),w=function(){const C=tr.daysSinceSolstice(s,a,r);return C<91?A+(u-A)/91*C:C<137?u+(m-u)/46*(C-91):C<183?m+(E-m)/46*(C-137):C<229?E+(m-E)/46*(C-183):C<275?m+(u-m)/46*(C-229):u+(A-u)/91*(C-275)}();return DA(c,Math.round(w*-60))},seasonAdjustedEveningTwilight(r,s,a,c,A){let u,m,E,w;A===Gx.Ahmer?(u=62+17.4/55*Math.abs(r),m=62-7.16/55*Math.abs(r),E=62+5.12/55*Math.abs(r),w=62+19.44/55*Math.abs(r)):A===Gx.Abyad?(u=75+25.6/55*Math.abs(r),m=75+7.16/55*Math.abs(r),E=75+36.84/55*Math.abs(r),w=75+81.84/55*Math.abs(r)):(u=75+25.6/55*Math.abs(r),m=75+2.05/55*Math.abs(r),E=75-9.21/55*Math.abs(r),w=75+6.14/55*Math.abs(r));const C=function(){const T=tr.daysSinceSolstice(s,a,r);return T<91?u+(m-u)/91*T:T<137?m+(E-m)/46*(T-91):T<183?E+(w-E)/46*(T-137):T<229?w+(E-w)/46*(T-183):T<275?E+(m-E)/46*(T-229):m+(u-m)/91*(T-275)}();return DA(c,Math.round(C*60))},daysSinceSolstice(r,s,a){let c=0;const A=10,u=tr.isLeapYear(s)?173:172,m=tr.isLeapYear(s)?366:365;return a>=0?(c=r+A,c>=m&&(c=c-m)):(c=r-u,c<0&&(c=c+m)),c}};class iO{constructor(s){const a=tr.julianCentury(s),c=tr.meanSolarLongitude(a),A=tr.meanLunarLongitude(a),u=tr.ascendingLunarNodeLongitude(a),m=xn(tr.apparentSolarLongitude(a,c)),E=tr.meanSiderealTime(a),w=tr.nutationInLongitude(a,c,A,u),C=tr.nutationInObliquity(a,c,A,u),T=tr.meanObliquityOfTheEcliptic(a),N=xn(tr.apparentObliquityOfTheEcliptic(a,T));this.declination=gf(Math.asin(Math.sin(N)*Math.sin(m))),this.rightAscension=Zi(gf(Math.atan2(Math.cos(N)*Math.sin(m),Math.cos(m)))),this.apparentSiderealTime=E+w*3600*Math.cos(xn(T+C))/3600}}class XA{constructor(s,a){const c=tr.julianDay(s.getFullYear(),s.getMonth()+1,s.getDate(),0);this.observer=a,this.solar=new iO(c),this.prevSolar=new iO(c-1),this.nextSolar=new iO(c+1);const A=tr.approximateTransit(a.longitude,this.solar.apparentSiderealTime,this.solar.rightAscension),u=-50/60;this.approxTransit=A,this.transit=tr.correctedTransit(A,a.longitude,this.solar.apparentSiderealTime,this.solar.rightAscension,this.prevSolar.rightAscension,this.nextSolar.rightAscension),this.sunrise=tr.correctedHourAngle(A,u,a,!1,this.solar.apparentSiderealTime,this.solar.rightAscension,this.prevSolar.rightAscension,this.nextSolar.rightAscension,this.solar.declination,this.prevSolar.declination,this.nextSolar.declination),this.sunset=tr.correctedHourAngle(A,u,a,!0,this.solar.apparentSiderealTime,this.solar.rightAscension,this.prevSolar.rightAscension,this.nextSolar.rightAscension,this.solar.declination,this.prevSolar.declination,this.nextSolar.declination)}hourAngle(s,a){return tr.correctedHourAngle(this.approxTransit,s,this.observer,a,this.solar.apparentSiderealTime,this.solar.rightAscension,this.prevSolar.rightAscension,this.nextSolar.rightAscension,this.solar.declination,this.prevSolar.declination,this.nextSolar.declination)}afternoon(s){const a=Math.abs(this.observer.latitude-this.solar.declination),c=s+Math.tan(xn(a)),A=gf(Math.atan(1/c));return this.hourAngle(A,!0)}}const Kw={AqrabBalad:"AqrabBalad",AqrabYaum:"AqrabYaum",Unresolved:"Unresolved"},wq=.5,vye=65,Ww=r=>!isNaN(r.sunrise)&&!isNaN(r.sunset),bq=(r,s,a=1,c=1)=>{if(a>Math.ceil(365/2))return null;const A=new Date(s.getTime());A.setDate(A.getDate()+c*a);const u=C_(A,1),m=new XA(A,r),E=new XA(u,r);return!Ww(m)||!Ww(E)?bq(r,s,a+(c>0?0:1),-c):{date:s,tomorrow:u,coordinates:r,solarTime:m,tomorrowSolarTime:E}},Sq=(r,s,a)=>{const c=new XA(s,{...r,latitude:a}),A=C_(s,1),u=new XA(A,{...r,latitude:a});return!Ww(c)||!Ww(u)?Math.abs(a)>=vye?Sq(r,s,a-Math.sign(a)*wq):null:{date:s,tomorrow:A,coordinates:new SB(a,r.longitude),solarTime:c,tomorrowSolarTime:u}},yye=(r,s,a)=>{const c={date:s,tomorrow:C_(s,1),coordinates:a,solarTime:new XA(s,a),tomorrowSolarTime:new XA(C_(s,1),a)};switch(r){case Kw.AqrabYaum:return bq(a,s)||c;case Kw.AqrabBalad:{const{latitude:A}=a;return Sq(a,s,A-Math.sign(A)*wq)||c}default:return c}};class va{constructor(s,a=0,c=0,A=0,u=0){Nc(this,"madhab",Hx.Shafi);Nc(this,"highLatitudeRule",_y.MiddleOfTheNight);Nc(this,"adjustments",{fajr:0,sunrise:0,dhuhr:0,asr:0,maghrib:0,isha:0});Nc(this,"methodAdjustments",{fajr:0,sunrise:0,dhuhr:0,asr:0,maghrib:0,isha:0});Nc(this,"polarCircleResolution",Kw.Unresolved);Nc(this,"rounding",$g.Nearest);Nc(this,"shafaq",Gx.General);this.method=s,this.fajrAngle=a,this.ishaAngle=c,this.ishaInterval=A,this.maghribAngle=u,this.method===null&&(this.method="Other")}nightPortions(){switch(this.highLatitudeRule){case _y.MiddleOfTheNight:return{fajr:1/2,isha:1/2};case _y.SeventhOfTheNight:return{fajr:1/7,isha:1/7};case _y.TwilightAngle:return{fajr:this.fajrAngle/60,isha:this.ishaAngle/60};default:throw`Invalid high latitude rule found when attempting to compute night portions: ${this.highLatitudeRule}`}}}const wye={MuslimWorldLeague(){const r=new va("MuslimWorldLeague",18,17);return r.methodAdjustments.dhuhr=1,r},Egyptian(){const r=new va("Egyptian",19.5,17.5);return r.methodAdjustments.dhuhr=1,r},Karachi(){const r=new va("Karachi",18,18);return r.methodAdjustments.dhuhr=1,r},UmmAlQura(){return new va("UmmAlQura",18.5,0,90)},Dubai(){const r=new va("Dubai",18.2,18.2);return r.methodAdjustments={...r.methodAdjustments,sunrise:-3,dhuhr:3,asr:3,maghrib:3},r},MoonsightingCommittee(){const r=new va("MoonsightingCommittee",18,18);return r.methodAdjustments={...r.methodAdjustments,dhuhr:5,maghrib:3},r},NorthAmerica(){const r=new va("NorthAmerica",15,15);return r.methodAdjustments.dhuhr=1,r},Kuwait(){return new va("Kuwait",18,17.5)},Qatar(){return new va("Qatar",18,0,90)},Singapore(){const r=new va("Singapore",20,18);return r.methodAdjustments.dhuhr=1,r.rounding=$g.Up,r},Tehran(){return new va("Tehran",17.7,14,0,4.5)},Turkey(){const r=new va("Turkey",18,17);return r.methodAdjustments={...r.methodAdjustments,sunrise:-7,dhuhr:5,asr:4,maghrib:7},r},Other(){return new va("Other",0,0)}},gs={Fajr:"fajr",Sunrise:"sunrise",Dhuhr:"dhuhr",Asr:"asr",Maghrib:"maghrib",Isha:"isha",None:"none"};class qo{constructor(s){return this.hours=Math.floor(s),this.minutes=Math.floor((s-this.hours)*60),this.seconds=Math.floor((s-(this.hours+this.minutes/60))*60*60),this}utcDate(s,a,c){return new Date(Date.UTC(s,a,c,this.hours,this.minutes,this.seconds))}}let bye=class{constructor(s,a,c){this.coordinates=s,this.date=a,this.calculationParameters=c;let A=new XA(a,s),u,m,E,w,C,T,N,B;E=new qo(A.transit).utcDate(a.getFullYear(),a.getMonth(),a.getDate()),m=new qo(A.sunrise).utcDate(a.getFullYear(),a.getMonth(),a.getDate()),C=new qo(A.sunset).utcDate(a.getFullYear(),a.getMonth(),a.getDate());const k=C_(a,1);let Q=new XA(k,s);const K=c.polarCircleResolution;if((!wG(m)||!wG(C)||isNaN(Q.sunrise))&&K!==Kw.Unresolved){const ce=yye(K,a,s);A=ce.solarTime,Q=ce.tomorrowSolarTime;const Ae=[a.getFullYear(),a.getMonth(),a.getDate()];E=new qo(A.transit).utcDate(...Ae),m=new qo(A.sunrise).utcDate(...Ae),C=new qo(A.sunset).utcDate(...Ae)}w=new qo(A.afternoon(_ye(c.madhab))).utcDate(a.getFullYear(),a.getMonth(),a.getDate());const Y=new qo(Q.sunrise).utcDate(k.getFullYear(),k.getMonth(),k.getDate()),F=(Number(Y)-Number(C))/1e3;u=new qo(A.hourAngle(-1*c.fajrAngle,!1)).utcDate(a.getFullYear(),a.getMonth(),a.getDate()),c.method==="MoonsightingCommittee"&&s.latitude>=55&&(B=F/7,u=DA(m,-B));const M=function(){return c.method==="MoonsightingCommittee"?tr.seasonAdjustedMorningTwilight(s.latitude,yG(a),a.getFullYear(),m):(B=c.nightPortions().fajr*F,DA(m,-B))}();if((isNaN(u.getTime())||M>u)&&(u=M),c.ishaInterval>0)N=iu(C,c.ishaInterval);else{N=new qo(A.hourAngle(-1*c.ishaAngle,!0)).utcDate(a.getFullYear(),a.getMonth(),a.getDate()),c.method==="MoonsightingCommittee"&&s.latitude>=55&&(B=F/7,N=DA(C,B));const ce=function(){return c.method==="MoonsightingCommittee"?tr.seasonAdjustedEveningTwilight(s.latitude,yG(a),a.getFullYear(),C,c.shafaq):(B=c.nightPortions().isha*F,DA(C,B))}();(isNaN(N.getTime())||ce<N)&&(N=ce)}if(T=C,c.maghribAngle){const ce=new qo(A.hourAngle(-1*c.maghribAngle,!0)).utcDate(a.getFullYear(),a.getMonth(),a.getDate());C<ce&&N>ce&&(T=ce)}const V=(c.adjustments.fajr||0)+(c.methodAdjustments.fajr||0),W=(c.adjustments.sunrise||0)+(c.methodAdjustments.sunrise||0),q=(c.adjustments.dhuhr||0)+(c.methodAdjustments.dhuhr||0),te=(c.adjustments.asr||0)+(c.methodAdjustments.asr||0),re=(c.adjustments.maghrib||0)+(c.methodAdjustments.maghrib||0),de=(c.adjustments.isha||0)+(c.methodAdjustments.isha||0);this.fajr=au(iu(u,V),c.rounding),this.sunrise=au(iu(m,W),c.rounding),this.dhuhr=au(iu(E,q),c.rounding),this.asr=au(iu(w,te),c.rounding),this.sunset=au(C,c.rounding),this.maghrib=au(iu(T,re),c.rounding),this.isha=au(iu(N,de),c.rounding)}timeForPrayer(s){return s===gs.Fajr?this.fajr:s===gs.Sunrise?this.sunrise:s===gs.Dhuhr?this.dhuhr:s===gs.Asr?this.asr:s===gs.Maghrib?this.maghrib:s===gs.Isha?this.isha:null}currentPrayer(s=new Date){return s>=this.isha?gs.Isha:s>=this.maghrib?gs.Maghrib:s>=this.asr?gs.Asr:s>=this.dhuhr?gs.Dhuhr:s>=this.sunrise?gs.Sunrise:s>=this.fajr?gs.Fajr:gs.None}nextPrayer(s=new Date){return s>=this.isha?gs.None:s>=this.maghrib?gs.Isha:s>=this.asr?gs.Maghrib:s>=this.dhuhr?gs.Asr:s>=this.sunrise?gs.Dhuhr:s>=this.fajr?gs.Sunrise:gs.Fajr}};function Sye(r){const s=new SB(21.4225241,39.8261818),a=Math.sin(xn(s.longitude)-xn(r.longitude)),c=Math.cos(xn(r.latitude))*Math.tan(xn(s.latitude)),A=Math.sin(xn(r.latitude))*Math.cos(xn(s.longitude)-xn(r.longitude)),u=Math.atan2(a,c-A);return Zi(gf(u))}function nc(r){const s=Object.prototype.toString.call(r);return r instanceof Date||typeof r=="object"&&s==="[object Date]"?new r.constructor(+r):typeof r=="number"||s==="[object Number]"||typeof r=="string"||s==="[object String]"?new Date(r):new Date(NaN)}function Lu(r,s){return r instanceof Date?new r.constructor(s):new Date(s)}const Cq=6048e5,Cye=864e5;let Tye={};function Ib(){return Tye}function T_(r,s){var E,w,C,T;const a=Ib(),c=(s==null?void 0:s.weekStartsOn)??((w=(E=s==null?void 0:s.locale)==null?void 0:E.options)==null?void 0:w.weekStartsOn)??a.weekStartsOn??((T=(C=a.locale)==null?void 0:C.options)==null?void 0:T.weekStartsOn)??0,A=nc(r),u=A.getDay(),m=(u<c?7:0)+u-c;return A.setDate(A.getDate()-m),A.setHours(0,0,0,0),A}function Yw(r){return T_(r,{weekStartsOn:1})}function Tq(r){const s=nc(r),a=s.getFullYear(),c=Lu(r,0);c.setFullYear(a+1,0,4),c.setHours(0,0,0,0);const A=Yw(c),u=Lu(r,0);u.setFullYear(a,0,4),u.setHours(0,0,0,0);const m=Yw(u);return s.getTime()>=A.getTime()?a+1:s.getTime()>=m.getTime()?a:a-1}function bG(r){const s=nc(r);return s.setHours(0,0,0,0),s}function SG(r){const s=nc(r),a=new Date(Date.UTC(s.getFullYear(),s.getMonth(),s.getDate(),s.getHours(),s.getMinutes(),s.getSeconds(),s.getMilliseconds()));return a.setUTCFullYear(s.getFullYear()),+r-+a}function Rye(r,s){const a=bG(r),c=bG(s),A=+a-SG(a),u=+c-SG(c);return Math.round((A-u)/Cye)}function Iye(r){const s=Tq(r),a=Lu(r,0);return a.setFullYear(s,0,4),a.setHours(0,0,0,0),Yw(a)}function Nye(r){return r instanceof Date||typeof r=="object"&&Object.prototype.toString.call(r)==="[object Date]"}function Oye(r){if(!Nye(r)&&typeof r!="number")return!1;const s=nc(r);return!isNaN(Number(s))}function xye(r){const s=nc(r),a=Lu(r,0);return a.setFullYear(s.getFullYear(),0,1),a.setHours(0,0,0,0),a}const Dye={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},Bye=(r,s,a)=>{let c;const A=Dye[r];return typeof A=="string"?c=A:s===1?c=A.one:c=A.other.replace("{{count}}",s.toString()),a!=null&&a.addSuffix?a.comparison&&a.comparison>0?"in "+c:c+" ago":c};function aO(r){return(s={})=>{const a=s.width?String(s.width):r.defaultWidth;return r.formats[a]||r.formats[r.defaultWidth]}}const kye={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},Lye={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},Uye={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},Pye={date:aO({formats:kye,defaultWidth:"full"}),time:aO({formats:Lye,defaultWidth:"full"}),dateTime:aO({formats:Uye,defaultWidth:"full"})},Mye={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},Fye=(r,s,a,c)=>Mye[r];function mg(r){return(s,a)=>{const c=a!=null&&a.context?String(a.context):"standalone";let A;if(c==="formatting"&&r.formattingValues){const m=r.defaultFormattingWidth||r.defaultWidth,E=a!=null&&a.width?String(a.width):m;A=r.formattingValues[E]||r.formattingValues[m]}else{const m=r.defaultWidth,E=a!=null&&a.width?String(a.width):r.defaultWidth;A=r.values[E]||r.values[m]}const u=r.argumentCallback?r.argumentCallback(s):s;return A[u]}}const jye={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},Vye={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},Qye={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},Hye={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},Gye={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},Kye={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},Wye=(r,s)=>{const a=Number(r),c=a%100;if(c>20||c<10)switch(c%10){case 1:return a+"st";case 2:return a+"nd";case 3:return a+"rd"}return a+"th"},Yye={ordinalNumber:Wye,era:mg({values:jye,defaultWidth:"wide"}),quarter:mg({values:Vye,defaultWidth:"wide",argumentCallback:r=>r-1}),month:mg({values:Qye,defaultWidth:"wide"}),day:mg({values:Hye,defaultWidth:"wide"}),dayPeriod:mg({values:Gye,defaultWidth:"wide",formattingValues:Kye,defaultFormattingWidth:"wide"})};function gg(r){return(s,a={})=>{const c=a.width,A=c&&r.matchPatterns[c]||r.matchPatterns[r.defaultMatchWidth],u=s.match(A);if(!u)return null;const m=u[0],E=c&&r.parsePatterns[c]||r.parsePatterns[r.defaultParseWidth],w=Array.isArray(E)?qye(E,N=>N.test(m)):zye(E,N=>N.test(m));let C;C=r.valueCallback?r.valueCallback(w):w,C=a.valueCallback?a.valueCallback(C):C;const T=s.slice(m.length);return{value:C,rest:T}}}function zye(r,s){for(const a in r)if(Object.prototype.hasOwnProperty.call(r,a)&&s(r[a]))return a}function qye(r,s){for(let a=0;a<r.length;a++)if(s(r[a]))return a}function Xye(r){return(s,a={})=>{const c=s.match(r.matchPattern);if(!c)return null;const A=c[0],u=s.match(r.parsePattern);if(!u)return null;let m=r.valueCallback?r.valueCallback(u[0]):u[0];m=a.valueCallback?a.valueCallback(m):m;const E=s.slice(A.length);return{value:m,rest:E}}}const Jye=/^(\d+)(th|st|nd|rd)?/i,$ye=/\d+/i,Zye={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},ewe={any:[/^b/i,/^(a|c)/i]},twe={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},nwe={any:[/1/i,/2/i,/3/i,/4/i]},rwe={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},swe={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},iwe={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},awe={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},owe={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},cwe={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},lwe={ordinalNumber:Xye({matchPattern:Jye,parsePattern:$ye,valueCallback:r=>parseInt(r,10)}),era:gg({matchPatterns:Zye,defaultMatchWidth:"wide",parsePatterns:ewe,defaultParseWidth:"any"}),quarter:gg({matchPatterns:twe,defaultMatchWidth:"wide",parsePatterns:nwe,defaultParseWidth:"any",valueCallback:r=>r+1}),month:gg({matchPatterns:rwe,defaultMatchWidth:"wide",parsePatterns:swe,defaultParseWidth:"any"}),day:gg({matchPatterns:iwe,defaultMatchWidth:"wide",parsePatterns:awe,defaultParseWidth:"any"}),dayPeriod:gg({matchPatterns:owe,defaultMatchWidth:"any",parsePatterns:cwe,defaultParseWidth:"any"})},Awe={code:"en-US",formatDistance:Bye,formatLong:Pye,formatRelative:Fye,localize:Yye,match:lwe,options:{weekStartsOn:0,firstWeekContainsDate:1}};function dwe(r){const s=nc(r);return Rye(s,xye(s))+1}function uwe(r){const s=nc(r),a=+Yw(s)-+Iye(s);return Math.round(a/Cq)+1}function Rq(r,s){var T,N,B,k;const a=nc(r),c=a.getFullYear(),A=Ib(),u=(s==null?void 0:s.firstWeekContainsDate)??((N=(T=s==null?void 0:s.locale)==null?void 0:T.options)==null?void 0:N.firstWeekContainsDate)??A.firstWeekContainsDate??((k=(B=A.locale)==null?void 0:B.options)==null?void 0:k.firstWeekContainsDate)??1,m=Lu(r,0);m.setFullYear(c+1,0,u),m.setHours(0,0,0,0);const E=T_(m,s),w=Lu(r,0);w.setFullYear(c,0,u),w.setHours(0,0,0,0);const C=T_(w,s);return a.getTime()>=E.getTime()?c+1:a.getTime()>=C.getTime()?c:c-1}function hwe(r,s){var E,w,C,T;const a=Ib(),c=(s==null?void 0:s.firstWeekContainsDate)??((w=(E=s==null?void 0:s.locale)==null?void 0:E.options)==null?void 0:w.firstWeekContainsDate)??a.firstWeekContainsDate??((T=(C=a.locale)==null?void 0:C.options)==null?void 0:T.firstWeekContainsDate)??1,A=Rq(r,s),u=Lu(r,0);return u.setFullYear(A,0,c),u.setHours(0,0,0,0),T_(u,s)}function pwe(r,s){const a=nc(r),c=+T_(a,s)-+hwe(a,s);return Math.round(c/Cq)+1}function $n(r,s){const a=r<0?"-":"",c=Math.abs(r).toString().padStart(s,"0");return a+c}const pA={y(r,s){const a=r.getFullYear(),c=a>0?a:1-a;return $n(s==="yy"?c%100:c,s.length)},M(r,s){const a=r.getMonth();return s==="M"?String(a+1):$n(a+1,2)},d(r,s){return $n(r.getDate(),s.length)},a(r,s){const a=r.getHours()/12>=1?"pm":"am";switch(s){case"a":case"aa":return a.toUpperCase();case"aaa":return a;case"aaaaa":return a[0];case"aaaa":default:return a==="am"?"a.m.":"p.m."}},h(r,s){return $n(r.getHours()%12||12,s.length)},H(r,s){return $n(r.getHours(),s.length)},m(r,s){return $n(r.getMinutes(),s.length)},s(r,s){return $n(r.getSeconds(),s.length)},S(r,s){const a=s.length,c=r.getMilliseconds(),A=Math.trunc(c*Math.pow(10,a-3));return $n(A,s.length)}},_p={midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},CG={G:function(r,s,a){const c=r.getFullYear()>0?1:0;switch(s){case"G":case"GG":case"GGG":return a.era(c,{width:"abbreviated"});case"GGGGG":return a.era(c,{width:"narrow"});case"GGGG":default:return a.era(c,{width:"wide"})}},y:function(r,s,a){if(s==="yo"){const c=r.getFullYear(),A=c>0?c:1-c;return a.ordinalNumber(A,{unit:"year"})}return pA.y(r,s)},Y:function(r,s,a,c){const A=Rq(r,c),u=A>0?A:1-A;if(s==="YY"){const m=u%100;return $n(m,2)}return s==="Yo"?a.ordinalNumber(u,{unit:"year"}):$n(u,s.length)},R:function(r,s){const a=Tq(r);return $n(a,s.length)},u:function(r,s){const a=r.getFullYear();return $n(a,s.length)},Q:function(r,s,a){const c=Math.ceil((r.getMonth()+1)/3);switch(s){case"Q":return String(c);case"QQ":return $n(c,2);case"Qo":return a.ordinalNumber(c,{unit:"quarter"});case"QQQ":return a.quarter(c,{width:"abbreviated",context:"formatting"});case"QQQQQ":return a.quarter(c,{width:"narrow",context:"formatting"});case"QQQQ":default:return a.quarter(c,{width:"wide",context:"formatting"})}},q:function(r,s,a){const c=Math.ceil((r.getMonth()+1)/3);switch(s){case"q":return String(c);case"qq":return $n(c,2);case"qo":return a.ordinalNumber(c,{unit:"quarter"});case"qqq":return a.quarter(c,{width:"abbreviated",context:"standalone"});case"qqqqq":return a.quarter(c,{width:"narrow",context:"standalone"});case"qqqq":default:return a.quarter(c,{width:"wide",context:"standalone"})}},M:function(r,s,a){const c=r.getMonth();switch(s){case"M":case"MM":return pA.M(r,s);case"Mo":return a.ordinalNumber(c+1,{unit:"month"});case"MMM":return a.month(c,{width:"abbreviated",context:"formatting"});case"MMMMM":return a.month(c,{width:"narrow",context:"formatting"});case"MMMM":default:return a.month(c,{width:"wide",context:"formatting"})}},L:function(r,s,a){const c=r.getMonth();switch(s){case"L":return String(c+1);case"LL":return $n(c+1,2);case"Lo":return a.ordinalNumber(c+1,{unit:"month"});case"LLL":return a.month(c,{width:"abbreviated",context:"standalone"});case"LLLLL":return a.month(c,{width:"narrow",context:"standalone"});case"LLLL":default:return a.month(c,{width:"wide",context:"standalone"})}},w:function(r,s,a,c){const A=pwe(r,c);return s==="wo"?a.ordinalNumber(A,{unit:"week"}):$n(A,s.length)},I:function(r,s,a){const c=uwe(r);return s==="Io"?a.ordinalNumber(c,{unit:"week"}):$n(c,s.length)},d:function(r,s,a){return s==="do"?a.ordinalNumber(r.getDate(),{unit:"date"}):pA.d(r,s)},D:function(r,s,a){const c=dwe(r);return s==="Do"?a.ordinalNumber(c,{unit:"dayOfYear"}):$n(c,s.length)},E:function(r,s,a){const c=r.getDay();switch(s){case"E":case"EE":case"EEE":return a.day(c,{width:"abbreviated",context:"formatting"});case"EEEEE":return a.day(c,{width:"narrow",context:"formatting"});case"EEEEEE":return a.day(c,{width:"short",context:"formatting"});case"EEEE":default:return a.day(c,{width:"wide",context:"formatting"})}},e:function(r,s,a,c){const A=r.getDay(),u=(A-c.weekStartsOn+8)%7||7;switch(s){case"e":return String(u);case"ee":return $n(u,2);case"eo":return a.ordinalNumber(u,{unit:"day"});case"eee":return a.day(A,{width:"abbreviated",context:"formatting"});case"eeeee":return a.day(A,{width:"narrow",context:"formatting"});case"eeeeee":return a.day(A,{width:"short",context:"formatting"});case"eeee":default:return a.day(A,{width:"wide",context:"formatting"})}},c:function(r,s,a,c){const A=r.getDay(),u=(A-c.weekStartsOn+8)%7||7;switch(s){case"c":return String(u);case"cc":return $n(u,s.length);case"co":return a.ordinalNumber(u,{unit:"day"});case"ccc":return a.day(A,{width:"abbreviated",context:"standalone"});case"ccccc":return a.day(A,{width:"narrow",context:"standalone"});case"cccccc":return a.day(A,{width:"short",context:"standalone"});case"cccc":default:return a.day(A,{width:"wide",context:"standalone"})}},i:function(r,s,a){const c=r.getDay(),A=c===0?7:c;switch(s){case"i":return String(A);case"ii":return $n(A,s.length);case"io":return a.ordinalNumber(A,{unit:"day"});case"iii":return a.day(c,{width:"abbreviated",context:"formatting"});case"iiiii":return a.day(c,{width:"narrow",context:"formatting"});case"iiiiii":return a.day(c,{width:"short",context:"formatting"});case"iiii":default:return a.day(c,{width:"wide",context:"formatting"})}},a:function(r,s,a){const A=r.getHours()/12>=1?"pm":"am";switch(s){case"a":case"aa":return a.dayPeriod(A,{width:"abbreviated",context:"formatting"});case"aaa":return a.dayPeriod(A,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return a.dayPeriod(A,{width:"narrow",context:"formatting"});case"aaaa":default:return a.dayPeriod(A,{width:"wide",context:"formatting"})}},b:function(r,s,a){const c=r.getHours();let A;switch(c===12?A=_p.noon:c===0?A=_p.midnight:A=c/12>=1?"pm":"am",s){case"b":case"bb":return a.dayPeriod(A,{width:"abbreviated",context:"formatting"});case"bbb":return a.dayPeriod(A,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return a.dayPeriod(A,{width:"narrow",context:"formatting"});case"bbbb":default:return a.dayPeriod(A,{width:"wide",context:"formatting"})}},B:function(r,s,a){const c=r.getHours();let A;switch(c>=17?A=_p.evening:c>=12?A=_p.afternoon:c>=4?A=_p.morning:A=_p.night,s){case"B":case"BB":case"BBB":return a.dayPeriod(A,{width:"abbreviated",context:"formatting"});case"BBBBB":return a.dayPeriod(A,{width:"narrow",context:"formatting"});case"BBBB":default:return a.dayPeriod(A,{width:"wide",context:"formatting"})}},h:function(r,s,a){if(s==="ho"){let c=r.getHours()%12;return c===0&&(c=12),a.ordinalNumber(c,{unit:"hour"})}return pA.h(r,s)},H:function(r,s,a){return s==="Ho"?a.ordinalNumber(r.getHours(),{unit:"hour"}):pA.H(r,s)},K:function(r,s,a){const c=r.getHours()%12;return s==="Ko"?a.ordinalNumber(c,{unit:"hour"}):$n(c,s.length)},k:function(r,s,a){let c=r.getHours();return c===0&&(c=24),s==="ko"?a.ordinalNumber(c,{unit:"hour"}):$n(c,s.length)},m:function(r,s,a){return s==="mo"?a.ordinalNumber(r.getMinutes(),{unit:"minute"}):pA.m(r,s)},s:function(r,s,a){return s==="so"?a.ordinalNumber(r.getSeconds(),{unit:"second"}):pA.s(r,s)},S:function(r,s){return pA.S(r,s)},X:function(r,s,a){const c=r.getTimezoneOffset();if(c===0)return"Z";switch(s){case"X":return RG(c);case"XXXX":case"XX":return pu(c);case"XXXXX":case"XXX":default:return pu(c,":")}},x:function(r,s,a){const c=r.getTimezoneOffset();switch(s){case"x":return RG(c);case"xxxx":case"xx":return pu(c);case"xxxxx":case"xxx":default:return pu(c,":")}},O:function(r,s,a){const c=r.getTimezoneOffset();switch(s){case"O":case"OO":case"OOO":return"GMT"+TG(c,":");case"OOOO":default:return"GMT"+pu(c,":")}},z:function(r,s,a){const c=r.getTimezoneOffset();switch(s){case"z":case"zz":case"zzz":return"GMT"+TG(c,":");case"zzzz":default:return"GMT"+pu(c,":")}},t:function(r,s,a){const c=Math.trunc(r.getTime()/1e3);return $n(c,s.length)},T:function(r,s,a){const c=r.getTime();return $n(c,s.length)}};function TG(r,s=""){const a=r>0?"-":"+",c=Math.abs(r),A=Math.trunc(c/60),u=c%60;return u===0?a+String(A):a+String(A)+s+$n(u,2)}function RG(r,s){return r%60===0?(r>0?"-":"+")+$n(Math.abs(r)/60,2):pu(r,s)}function pu(r,s=""){const a=r>0?"-":"+",c=Math.abs(r),A=$n(Math.trunc(c/60),2),u=$n(c%60,2);return a+A+s+u}const IG=(r,s)=>{switch(r){case"P":return s.date({width:"short"});case"PP":return s.date({width:"medium"});case"PPP":return s.date({width:"long"});case"PPPP":default:return s.date({width:"full"})}},Iq=(r,s)=>{switch(r){case"p":return s.time({width:"short"});case"pp":return s.time({width:"medium"});case"ppp":return s.time({width:"long"});case"pppp":default:return s.time({width:"full"})}},fwe=(r,s)=>{const a=r.match(/(P+)(p+)?/)||[],c=a[1],A=a[2];if(!A)return IG(r,s);let u;switch(c){case"P":u=s.dateTime({width:"short"});break;case"PP":u=s.dateTime({width:"medium"});break;case"PPP":u=s.dateTime({width:"long"});break;case"PPPP":default:u=s.dateTime({width:"full"});break}return u.replace("{{date}}",IG(c,s)).replace("{{time}}",Iq(A,s))},mwe={p:Iq,P:fwe},gwe=/^D+$/,_we=/^Y+$/,Ewe=["D","DD","YY","YYYY"];function vwe(r){return gwe.test(r)}function ywe(r){return _we.test(r)}function wwe(r,s,a){const c=bwe(r,s,a);if(console.warn(c),Ewe.includes(r))throw new RangeError(c)}function bwe(r,s,a){const c=r[0]==="Y"?"years":"days of the month";return`Use \`${r.toLowerCase()}\` instead of \`${r}\` (in \`${s}\`) for formatting ${c} to the input \`${a}\`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md`}const Swe=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,Cwe=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,Twe=/^'([^]*?)'?$/,Rwe=/''/g,Iwe=/[a-zA-Z]/;function Nwe(r,s,a){var T,N,B,k;const c=Ib(),A=c.locale??Awe,u=c.firstWeekContainsDate??((N=(T=c.locale)==null?void 0:T.options)==null?void 0:N.firstWeekContainsDate)??1,m=c.weekStartsOn??((k=(B=c.locale)==null?void 0:B.options)==null?void 0:k.weekStartsOn)??0,E=nc(r);if(!Oye(E))throw new RangeError("Invalid time value");let w=s.match(Cwe).map(Q=>{const K=Q[0];if(K==="p"||K==="P"){const Y=mwe[K];return Y(Q,A.formatLong)}return Q}).join("").match(Swe).map(Q=>{if(Q==="''")return{isToken:!1,value:"'"};const K=Q[0];if(K==="'")return{isToken:!1,value:Owe(Q)};if(CG[K])return{isToken:!0,value:Q};if(K.match(Iwe))throw new RangeError("Format string contains an unescaped latin alphabet character `"+K+"`");return{isToken:!1,value:Q}});A.localize.preprocessor&&(w=A.localize.preprocessor(E,w));const C={firstWeekContainsDate:u,weekStartsOn:m,locale:A};return w.map(Q=>{if(!Q.isToken)return Q.value;const K=Q.value;(ywe(K)||vwe(K))&&wwe(K,s,String(r));const Y=CG[K[0]];return Y(E,K,A.localize,C)}).join("")}function Owe(r){const s=r.match(Twe);return s?s[1].replace(Rwe,"'"):r}const xwe=(r,s,a=new Date)=>{const c=new SB(r,s),A=wye.MuslimWorldLeague(),u=new bye(c,a,A),m=Sye(c),E=w=>Nwe(w,"h:mm a");return{fajr:{name:"Fajr",time:u.fajr,displayTime:E(u.fajr)},sunrise:{name:"Sunrise",time:u.sunrise,displayTime:E(u.sunrise)},dhuhr:{name:"Dhuhr",time:u.dhuhr,displayTime:E(u.dhuhr)},asr:{name:"Asr",time:u.asr,displayTime:E(u.asr)},maghrib:{name:"Maghrib",time:u.maghrib,displayTime:E(u.maghrib)},isha:{name:"Isha",time:u.isha,displayTime:E(u.isha)},date:a,qiblaDirection:m}},Dwe=r=>{const s=new Date,a=[{name:"Fajr",time:r.fajr.time},{name:"Sunrise",time:r.sunrise.time},{name:"Dhuhr",time:r.dhuhr.time},{name:"Asr",time:r.asr.time},{name:"Maghrib",time:r.maghrib.time},{name:"Isha",time:r.isha.time}];for(let c=0;c<a.length-1;c++)if(s>=a[c].time&&s<a[c+1].time)return a[c].name;return s>=a[a.length-1].time?"Isha":"Fajr"},Bwe=r=>{const s=new Date,a=[r.fajr,r.dhuhr,r.asr,r.maghrib,r.isha];for(const c of a)if(s<c.time)return c;return null};function yr({children:r,title:s,showBack:a=!0,showBottomNav:c=!0}){const A=ss(),{profile:u}=gr(),m=(u==null?void 0:u.role)==="scholar"||(u==null?void 0:u.role)==="imam";return p.jsxs("div",{className:"min-h-screen bg-gradient-to-b from-emerald-50 to-white flex flex-col",children:[p.jsx("div",{className:"bg-gradient-to-r from-emerald-600 to-emerald-700 text-white p-4 sticky top-0 z-50 shadow-lg",children:p.jsxs("div",{className:"flex items-center",children:[a&&p.jsx(Re,{variant:"ghost",size:"icon",className:"text-white hover:bg-emerald-500 mr-2",onClick:()=>A("/dashboard"),children:p.jsx(Qu,{className:"h-6 w-6"})}),p.jsx("h1",{className:"text-xl font-bold",children:s})]})}),p.jsx("div",{className:"flex-1 overflow-y-auto pb-24",children:r}),c&&p.jsx("div",{className:"fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 shadow-lg z-50",style:{paddingBottom:"env(safe-area-inset-bottom)"},children:p.jsxs("div",{className:"flex justify-between items-center py-1 px-0.5 max-w-2xl mx-auto gap-0.5",children:[p.jsx(ou,{icon:wl,label:"Masjid",onClick:()=>A("/dashboard")}),p.jsx(ou,{icon:bl,label:"Live",onClick:()=>A(m?"/start-stream":"/livestreams")}),p.jsx(ou,{icon:w_,label:"Quran",onClick:()=>A("/quran")}),p.jsx(ou,{icon:jw,label:"Qibla",onClick:()=>A("/qibla")}),m?p.jsx(p.Fragment,{children:p.jsx(ou,{icon:fr,label:"Manage",onClick:()=>A("/manage-consultations")})}):p.jsxs(p.Fragment,{children:[p.jsx(ou,{icon:fr,label:"Activities",onClick:()=>A("/activity-categories")}),p.jsx(ou,{icon:eq,label:"Bookings",onClick:()=>A("/my-bookings")})]})]})})]})}function ou({icon:r,label:s,onClick:a}){return p.jsxs("button",{onClick:a,className:"flex flex-col items-center justify-center flex-1 min-w-0 py-1 px-0.5 rounded-lg transition-all text-gray-600 hover:text-emerald-600 hover:bg-emerald-50",children:[p.jsx(r,{className:"h-4 w-4 sm:h-5 sm:w-5 flex-shrink-0"}),p.jsx("span",{className:"text-[9px] sm:text-[10px] mt-0.5 font-semibold leading-tight text-center truncate w-full",children:s})]})}const kwe=()=>{const[r,s]=z.useState(null),[a,c]=z.useState(null),[A,u]=z.useState(!1),[m,E]=z.useState(""),[w,C]=z.useState(new Date);z.useEffect(()=>{const K=setInterval(()=>{C(new Date)},1e3);return()=>clearInterval(K)},[]);const T=()=>{if(u(!0),E(""),!navigator.geolocation){E("Geolocation is not supported by your browser"),u(!1);return}navigator.geolocation.getCurrentPosition(K=>{const{latitude:Y,longitude:F}=K.coords;c({latitude:Y,longitude:F});const M=xwe(Y,F);s(M),u(!1)},K=>{E(`Error: ${K.message}`),u(!1)})};z.useEffect(()=>{T()},[]);const N=r?Dwe(r):null,B=r?Bwe(r):null,k=K=>K.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",second:"2-digit"}),Q=()=>{if(!B)return null;const K=B.time.getTime()-w.getTime(),Y=Math.floor(K/(1e3*60*60)),F=Math.floor(K%(1e3*60*60)/(1e3*60)),M=Math.floor(K%(1e3*60)/1e3);return`${Y}h ${F}m ${M}s`};return p.jsx(yr,{title:"Prayer Times",children:p.jsxs(qe,{children:[p.jsx(Pt,{children:p.jsx(Vt,{className:"text-center",children:"Prayer Times"})}),p.jsx($e,{children:A?p.jsx("div",{className:"text-center py-8",children:p.jsx("p",{children:"Loading prayer times..."})}):m?p.jsxs("div",{className:"text-center space-y-4",children:[p.jsx("p",{className:"text-destructive",children:m}),p.jsx(Re,{onClick:T,children:"Try Again"})]}):r?p.jsxs("div",{className:"space-y-6",children:[p.jsxs("div",{className:"text-center space-y-2 p-4 bg-secondary rounded-lg",children:[p.jsx("p",{className:"text-2xl font-bold",children:k(w)}),p.jsx("p",{className:"text-sm text-muted-foreground",children:a?`${a.latitude.toFixed(4)}, ${a.longitude.toFixed(4)}`:""}),p.jsxs("p",{className:"text-sm",children:["Current: ",p.jsx("span",{className:"font-semibold",children:N})]}),B&&p.jsxs("p",{className:"text-xs text-muted-foreground",children:["Next: ",B.name," in ",Q()]})]}),p.jsx("div",{className:"space-y-3",children:[{prayer:r.fajr,icon:"",arabic:"",description:"Dawn Prayer"},{prayer:r.sunrise,icon:"",arabic:"",description:"Sunrise"},{prayer:r.dhuhr,icon:"",arabic:"",description:"Noon Prayer"},{prayer:r.asr,icon:"",arabic:"",description:"Afternoon Prayer"},{prayer:r.maghrib,icon:"",arabic:"",description:"Sunset Prayer"},{prayer:r.isha,icon:"",arabic:"",description:"Night Prayer"}].map(({prayer:K,icon:Y,arabic:F,description:M})=>{const V=N===K.name,W=(B==null?void 0:B.name)===K.name;return p.jsxs("div",{className:`relative flex items-center justify-between p-4 rounded-lg border-2 transition-all ${V?"bg-gradient-to-r from-emerald-50 to-green-50 border-emerald-500 shadow-lg scale-105":W?"bg-amber-50 border-amber-400":"bg-card border-gray-200"}`,children:[V&&p.jsx("div",{className:"absolute top-2 right-2",children:p.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-semibold bg-emerald-600 text-white animate-pulse",children:"Current Prayer"})}),W&&!V&&p.jsx("div",{className:"absolute top-2 right-2",children:p.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-semibold bg-amber-600 text-white",children:["Next: ",Q()]})}),p.jsxs("div",{className:"flex items-center gap-4",children:[p.jsx("span",{className:"text-3xl",children:Y}),p.jsxs("div",{children:[p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx("span",{className:`font-bold ${V?"text-emerald-700 text-lg":"text-base"}`,children:K.name}),p.jsx("span",{className:"text-sm text-muted-foreground",children:M})]}),p.jsx("p",{className:`font-arabic text-lg ${V?"text-emerald-600":"text-gray-500"}`,children:F})]})]}),p.jsx("span",{className:`text-xl font-mono ${V?"text-emerald-700 font-bold":""}`,children:K.displayTime})]},K.name)})}),p.jsxs("div",{className:"text-center p-4 bg-secondary rounded-lg",children:[p.jsx("p",{className:"text-sm text-muted-foreground",children:"Qibla Direction"}),p.jsxs("p",{className:"text-2xl font-bold",children:[r.qiblaDirection.toFixed(1),""]})]}),p.jsx(Re,{onClick:T,variant:"outline",className:"w-full",children:"Refresh Prayer Times"})]}):p.jsxs("div",{className:"text-center space-y-4",children:[p.jsx("p",{className:"text-muted-foreground",children:"Allow location access to see prayer times"}),p.jsx(Re,{onClick:T,children:"Get Prayer Times"})]})})]})})},Lwe=()=>{const[r,s]=z.useState([]),[a,c]=z.useState(1),[A,u]=z.useState([]),[m,E]=z.useState(0),[w,C]=z.useState(!1),[T,N]=z.useState(!0),B=z.useRef(null);z.useEffect(()=>{fetch("https://api.alquran.cloud/v1/surah").then(F=>F.json()).then(F=>{s(F.data)}).catch(F=>console.error("Error fetching surahs:",F))},[]),z.useEffect(()=>{a&&Promise.all([fetch(`https://api.alquran.cloud/v1/surah/${a}`).then(F=>F.json()),fetch(`https://api.alquran.cloud/v1/surah/${a}/en.asad`).then(F=>F.json()),fetch(`https://api.alquran.cloud/v1/surah/${a}/ar.alafasy`).then(F=>F.json())]).then(([F,M,V])=>{const W=F.data.ayahs.map((q,te)=>{var re,de;return{number:q.number,text:q.text,numberInSurah:q.numberInSurah,audio:((re=V.data.ayahs[te])==null?void 0:re.audio)||"",translation:((de=M.data.ayahs[te])==null?void 0:de.text)||""}});u(W),E(0)}).catch(F=>console.error("Error fetching ayahs:",F))},[a]),z.useEffect(()=>{var F;B.current&&((F=A[m])!=null&&F.audio)&&(B.current.src=A[m].audio,w&&B.current.play())},[m,A]);const k=()=>{B.current&&(w?B.current.pause():B.current.play(),C(!w))},Q=()=>{m<A.length-1?E(m+1):C(!1)},K=()=>{m<A.length-1&&E(m+1)},Y=()=>{m>0&&E(m-1)};return p.jsx(yr,{title:"Quran Reader",children:p.jsxs(qe,{children:[p.jsx(Pt,{children:p.jsx(Vt,{className:"text-center text-2xl",children:"  - Holy Quran"})}),p.jsxs($e,{children:[p.jsxs("div",{className:"mb-6",children:[p.jsx("label",{className:"block text-sm font-medium mb-2",children:"Select Surah:"}),p.jsx("select",{className:"w-full p-2 border rounded-md",value:a,onChange:F=>c(Number(F.target.value)),children:r.map(F=>p.jsxs("option",{value:F.number,children:[F.number,". ",F.englishName," (",F.name,")"]},F.number))})]}),p.jsxs("div",{className:"flex items-center justify-center gap-4 mb-6 p-4 bg-secondary rounded-lg",children:[p.jsx(Re,{variant:"outline",size:"icon",onClick:Y,disabled:m===0,children:p.jsx(jve,{className:"h-4 w-4"})}),p.jsx(Re,{variant:"default",size:"icon",onClick:k,children:w?p.jsx(Tve,{className:"h-4 w-4"}):p.jsx(hG,{className:"h-4 w-4"})}),p.jsx(Re,{variant:"outline",size:"icon",onClick:K,disabled:m===A.length-1,children:p.jsx(Qve,{className:"h-4 w-4"})}),p.jsxs("span",{className:"text-sm",children:["Ayah ",m+1," / ",A.length]})]}),p.jsx("audio",{ref:B,onEnded:Q}),p.jsx("div",{className:"mb-4 text-center",children:p.jsxs(Re,{variant:"outline",size:"sm",onClick:()=>N(!T),children:[T?"Hide":"Show"," Translation"]})}),p.jsx("div",{className:"space-y-6 max-h-[600px] overflow-y-auto",children:A.map((F,M)=>p.jsxs("div",{className:`p-4 rounded-lg border ${M===m?"bg-primary/10 border-primary":"bg-card"}`,children:[p.jsxs("div",{className:"flex justify-between items-start mb-2",children:[p.jsxs("span",{className:"text-xs text-muted-foreground",children:["Ayah ",F.numberInSurah]}),p.jsx(Re,{variant:"ghost",size:"sm",onClick:()=>{E(M),C(!0)},children:p.jsx(hG,{className:"h-3 w-3"})})]}),p.jsx("p",{className:"text-right text-2xl leading-loose mb-4 font-arabic",children:F.text}),T&&p.jsx("p",{className:"text-sm text-muted-foreground italic",children:F.translation})]},F.number))})]})]})})},Uwe=()=>{const[r,s]=z.useState(null),[a,c]=z.useState(0),[A,u]=z.useState(0),[m,E]=z.useState(""),[w,C]=z.useState(!1),[T,N]=z.useState(!1),[B,k]=z.useState(!0),[Q,K]=z.useState(null),Y=z.useRef(0),F=z.useRef(null),M=z.useRef(Date.now()),V=.15,W={latitude:21.422487,longitude:39.826206},q=(Ae,ne)=>{const ue=Ae*Math.PI/180,ye=ne*Math.PI/180,De=W.latitude*Math.PI/180,we=W.longitude*Math.PI/180-ye,Se=Math.sin(we)*Math.cos(De),Qe=Math.cos(ue)*Math.sin(De)-Math.sin(ue)*Math.cos(De)*Math.cos(we);let Ye=Math.atan2(Se,Qe);return Ye=Ye*180/Math.PI,Ye=(Ye+360)%360,Ye},te=(Ae,ne,ue,ye)=>{const Xe=(ue-Ae)*Math.PI/180,we=(ye-ne)*Math.PI/180,Se=Math.sin(Xe/2)*Math.sin(Xe/2)+Math.cos(Ae*Math.PI/180)*Math.cos(ue*Math.PI/180)*Math.sin(we/2)*Math.sin(we/2);return 6371*(2*Math.atan2(Math.sqrt(Se),Math.sqrt(1-Se)))},re=()=>{if(C(!0),E(""),!navigator.geolocation){E("Geolocation is not supported by your browser"),C(!1);return}navigator.geolocation.getCurrentPosition(Ae=>{const{latitude:ne,longitude:ue}=Ae.coords;s({latitude:ne,longitude:ue});const ye=q(ne,ue);c(ye),C(!1)},Ae=>{E(`Location error: ${Ae.message}. Please enable location services in your device settings.`),C(!1)},{enableHighAccuracy:!0,timeout:1e4,maximumAge:0})};z.useEffect(()=>{if(!T)return;let Ae=Y.current,ne=!0,ue=!1;const ye=Se=>{if(!ue&&(Se.alpha!==null||Se.beta!==null||Se.gamma!==null)){M.current=Date.now();let Qe=Se.alpha||0;const Ye=Se;Ye.webkitCompassHeading!==void 0?(Qe=Ye.webkitCompassHeading,Ye.webkitCompassAccuracy!==void 0&&K(Ye.webkitCompassAccuracy)):Qe=(360-Qe)%360,Ae=Qe,k(!0)}},De=Se=>{if(Se.absolute&&Se.alpha!==null){M.current=Date.now(),ue=!0;let Qe=Se.alpha;Qe=(360-Qe)%360,Ae=Qe,k(!0)}},Xe=setInterval(()=>{Date.now()-M.current>3e3&&T&&k(!1)},3e3),we=()=>{if(!ne)return;let Se=Ae-Y.current;Se>180&&(Se-=360),Se<-180&&(Se+=360),Y.current+=Se*V,Y.current=(Y.current+360)%360,u(Y.current),F.current=requestAnimationFrame(we)};return window.DeviceOrientationEvent&&(window.addEventListener("deviceorientation",ye,!0),window.addEventListener("deviceorientationabsolute",De,!0),we()),()=>{ne=!1,F.current&&cancelAnimationFrame(F.current),Xe&&clearInterval(Xe),window.removeEventListener("deviceorientation",ye,!0),window.removeEventListener("deviceorientationabsolute",De,!0)}},[T]);const de=async()=>{if(E(""),C(!0),typeof DeviceOrientationEvent.requestPermission=="function")try{await DeviceOrientationEvent.requestPermission()==="granted"?(N(!0),re()):(E("Compass permission denied. Please enable motion & orientation access in your device settings."),C(!1))}catch{E("Unable to access device compass. Please check your browser settings."),C(!1)}else if(window.DeviceOrientationEvent){const Ae=ne=>{(ne.alpha!==null||ne.webkitCompassHeading!==void 0)&&(N(!0),re(),window.removeEventListener("deviceorientation",Ae),window.removeEventListener("deviceorientationabsolute",Ae))};window.addEventListener("deviceorientation",Ae),window.addEventListener("deviceorientationabsolute",Ae),setTimeout(()=>{window.removeEventListener("deviceorientation",Ae),window.removeEventListener("deviceorientationabsolute",Ae),T||(N(!0),re())},2e3)}else E("Device orientation not supported on this device. Compass features require a device with gyroscope/magnetometer sensors.")},ce=a-A;return p.jsx(yr,{title:"Qibla Direction",children:p.jsxs(qe,{children:[p.jsx(Pt,{children:p.jsx(Vt,{className:"text-center",children:"Qibla Direction"})}),p.jsx($e,{children:r?p.jsxs("div",{className:"space-y-6",children:[!B&&p.jsxs("div",{className:"bg-yellow-50 border border-yellow-300 p-3 rounded-lg",children:[p.jsx("p",{className:"text-sm font-semibold text-yellow-800 mb-1",children:" Compass sensor not detected"}),p.jsx("p",{className:"text-xs text-yellow-700",children:"Your device may not have a magnetometer, or the sensor is disabled. You can still see the static Qibla direction below."})]}),B&&Q&&Q>30&&p.jsxs("div",{className:"bg-orange-50 border border-orange-300 p-3 rounded-lg",children:[p.jsx("p",{className:"text-sm font-semibold text-orange-800 mb-1",children:" Low compass accuracy"}),p.jsx("p",{className:"text-xs text-orange-700",children:"Move your phone in a figure-8 pattern to calibrate the compass sensor."})]}),B&&(!Q||Q<=15)&&p.jsx("div",{className:"bg-green-50 border border-green-300 p-2 rounded-lg",children:p.jsxs("p",{className:"text-xs font-semibold text-green-800",children:[" Compass working ",Q?`(${Q.toFixed(0)})`:""]})}),p.jsxs("div",{className:"relative w-72 h-72 mx-auto",children:[p.jsxs("div",{className:`absolute inset-0 rounded-full border-8 bg-gradient-to-br from-emerald-50 to-white shadow-xl ${B?"border-emerald-600":"border-gray-400"}`,style:{transform:B?`rotate(${-A}deg)`:"rotate(0deg)",transition:B?"none":"transform 0.5s ease"},children:[p.jsx("div",{className:"absolute top-4 left-1/2 -translate-x-1/2 text-lg font-bold text-red-600",children:"N"}),p.jsx("div",{className:"absolute right-4 top-1/2 -translate-y-1/2 text-base font-bold text-gray-600",children:"E"}),p.jsx("div",{className:"absolute bottom-4 left-1/2 -translate-x-1/2 text-base font-bold text-gray-600",children:"S"}),p.jsx("div",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-base font-bold text-gray-600",children:"W"}),[...Array(36)].map((Ae,ne)=>p.jsx("div",{className:"absolute top-2 left-1/2 -translate-x-1/2 origin-bottom h-32",style:{transform:`translateX(-50%) rotate(${ne*10}deg)`},children:p.jsx("div",{className:`w-0.5 ${ne%3===0?"h-3 bg-emerald-600":"h-2 bg-emerald-400"}`})},ne))]}),p.jsx("div",{className:"absolute inset-0 flex items-center justify-center",style:{transform:`rotate(${ce}deg)`,transition:"none"},children:p.jsxs("div",{className:"relative",children:[p.jsxs("svg",{width:"120",height:"120",viewBox:"0 0 120 120",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:"drop-shadow-2xl",children:[p.jsx("path",{d:"M60 10 L80 40 L70 40 L70 70 L50 70 L50 40 L40 40 Z",fill:"#10b981",stroke:"#059669",strokeWidth:"2"}),p.jsx("rect",{x:"40",y:"75",width:"40",height:"30",fill:"#1f2937",stroke:"#374151",strokeWidth:"2"}),p.jsx("rect",{x:"40",y:"85",width:"40",height:"8",fill:"#fbbf24",opacity:"0.8"}),p.jsx("rect",{x:"52",y:"92",width:"16",height:"13",fill:"#78350f",stroke:"#92400e",strokeWidth:"1"})]}),p.jsx("div",{className:"absolute -bottom-6 left-1/2 -translate-x-1/2 whitespace-nowrap",children:p.jsx("span",{className:"text-xs font-bold text-emerald-700 bg-white px-3 py-1 rounded-full shadow-lg",children:" Makkah"})})]})}),p.jsx("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-6 h-6 rounded-full bg-emerald-600 shadow-lg border-2 border-white"})]}),p.jsxs("div",{className:"text-center space-y-3 mt-6",children:[p.jsxs("div",{className:"bg-emerald-50 p-4 rounded-lg",children:[p.jsxs("p",{className:"text-2xl font-bold text-emerald-800",children:[a.toFixed(1),""]}),p.jsx("p",{className:"text-sm text-emerald-600",children:"Qibla Direction from North"})]}),p.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[p.jsxs("div",{className:"bg-gray-50 p-3 rounded",children:[p.jsx("p",{className:"font-semibold text-gray-700",children:"Your Heading"}),p.jsxs("p",{className:"text-gray-600",children:[A.toFixed(1),""]})]}),p.jsxs("div",{className:"bg-gray-50 p-3 rounded",children:[p.jsx("p",{className:"font-semibold text-gray-700",children:"Distance"}),p.jsxs("p",{className:"text-gray-600",children:[Math.round(te(r.latitude,r.longitude,W.latitude,W.longitude))," km"]})]})]}),p.jsxs("p",{className:"text-sm text-muted-foreground",children:[" ",r.latitude.toFixed(4),", ",r.longitude.toFixed(4),""]}),B?p.jsxs("div",{className:"bg-blue-50 p-3 rounded-lg mt-4",children:[p.jsx("p",{className:"text-sm font-medium text-blue-800",children:" Rotate your device until the green arrow points upward"}),p.jsx("p",{className:"text-xs text-blue-600 mt-1",children:"Keep device flat and away from metal objects"})]}):p.jsxs("div",{className:"bg-gray-50 p-3 rounded-lg mt-4 border border-gray-300",children:[p.jsx("p",{className:"text-sm font-medium text-gray-800",children:" Static Direction (No Compass)"}),p.jsxs("p",{className:"text-xs text-gray-600 mt-1",children:["Face ",a.toFixed(1)," from North to face Qibla. The arrow above shows the direction."]})]}),B&&p.jsxs("div",{className:"bg-amber-50 p-3 rounded-lg mt-2 border border-amber-200",children:[p.jsx("p",{className:"text-xs font-medium text-amber-800 mb-1",children:" Compass not accurate? Calibrate it:"}),p.jsx("p",{className:"text-xs text-amber-700",children:"Move your phone in a figure-8 pattern () in the air a few times. This recalibrates the magnetometer sensor."})]}),!B&&p.jsxs("div",{className:"bg-purple-50 p-3 rounded-lg mt-2 border border-purple-200",children:[p.jsx("p",{className:"text-xs font-medium text-purple-800 mb-1",children:" Using manual compass:"}),p.jsxs("p",{className:"text-xs text-purple-700",children:["Use a physical compass or compass app to find North, then rotate ",a.toFixed(1)," clockwise to face Qibla."]})]})]}),p.jsxs("div",{className:"space-y-2",children:[p.jsx(Re,{onClick:de,variant:"outline",className:"w-full",children:B?"Recalibrate Compass":"Retry Compass Detection"}),!B&&p.jsx("p",{className:"text-xs text-center text-muted-foreground",children:"This device may not have a magnetometer sensor. Using static direction mode."})]})]}):p.jsxs("div",{className:"text-center space-y-4",children:[p.jsx("div",{className:"flex justify-center mb-4",children:p.jsx(jw,{className:"h-16 w-16 text-primary"})}),p.jsx("p",{className:"text-muted-foreground",children:"Click the button below and allow location access when prompted"}),p.jsx(Re,{onClick:de,disabled:w,className:"bg-emerald-600 hover:bg-emerald-700",children:w?"Getting Location...":"Show Compass"}),m&&p.jsxs("div",{className:"p-4 bg-destructive/10 border border-destructive rounded-md",children:[p.jsx("p",{className:"text-destructive text-sm font-medium",children:m}),p.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:"Make sure you allow location access in your browser settings"})]}),p.jsxs("div",{className:"mt-6 text-left bg-blue-50 p-4 rounded-lg",children:[p.jsx("p",{className:"text-sm font-semibold mb-2",children:" All Devices:"}),p.jsxs("ul",{className:"text-xs text-muted-foreground space-y-1 list-disc list-inside",children:[p.jsx("li",{children:'Click "Allow" when browser asks for location permission'}),p.jsx("li",{children:"Make sure location services are enabled on your device"}),p.jsx("li",{children:"Works best on mobile devices with compass sensor"}),p.jsx("li",{children:"Tablets/desktops show static direction (no live compass)"}),p.jsx("li",{children:"Keep away from magnets, metal objects, and electronics"})]})]}),p.jsxs("div",{className:"mt-4 text-left bg-amber-50 p-4 rounded-lg border border-amber-200",children:[p.jsx("p",{className:"text-sm font-semibold mb-2 text-amber-800",children:" Android/Samsung:"}),p.jsxs("ul",{className:"text-xs text-amber-700 space-y-1 list-disc list-inside",children:[p.jsx("li",{children:"Calibrate: Move device in figure-8 pattern () in the air"}),p.jsx("li",{children:'Settings  Display  Enable "Motion sensors"'}),p.jsx("li",{children:"Chrome: Settings  Site settings  Permissions  Motion sensors"}),p.jsx("li",{children:"Disable battery optimization for browser app"}),p.jsx("li",{children:"Try in open area away from metal structures"})]})]}),p.jsxs("div",{className:"mt-4 text-left bg-purple-50 p-4 rounded-lg border border-purple-200",children:[p.jsx("p",{className:"text-sm font-semibold mb-2 text-purple-800",children:" iOS/iPhone:"}),p.jsxs("ul",{className:"text-xs text-purple-700 space-y-1 list-disc list-inside",children:[p.jsx("li",{children:"Settings  Privacy  Motion & Orientation  Enable for Safari/Chrome"}),p.jsx("li",{children:'Settings  Compass  Enable "Use True North"'}),p.jsx("li",{children:"Calibrate by tilting screen to complete red circle"}),p.jsx("li",{children:"Works best in Safari browser"}),p.jsx("li",{children:'May need to tap "Allow" multiple times'})]})]}),p.jsxs("div",{className:"mt-4 text-left bg-green-50 p-4 rounded-lg border border-green-200",children:[p.jsx("p",{className:"text-sm font-semibold mb-2 text-green-800",children:" Other Browsers:"}),p.jsxs("ul",{className:"text-xs text-green-700 space-y-1 list-disc list-inside",children:[p.jsx("li",{children:"Chrome/Edge: Works on most devices"}),p.jsx("li",{children:"Firefox: May need to enable motion sensors in settings"}),p.jsx("li",{children:"Samsung Internet: Usually works well"}),p.jsx("li",{children:"Opera: Enable device sensors in site settings"}),p.jsx("li",{children:"If stuck, try different browser or use static mode"})]})]})]})})]})})};var Nq={exports:{}};(function(r,s){(function(a,c){r.exports=c()})(W0,function(){function a(e,t){return t.forEach(function(n){n&&typeof n!="string"&&!Array.isArray(n)&&Object.keys(n).forEach(function(i){if(i!=="default"&&!(i in e)){var o=Object.getOwnPropertyDescriptor(n,i);Object.defineProperty(e,i,o.get?o:{enumerable:!0,get:function(){return n[i]}})}})}),Object.freeze(e)}var c=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof W0<"u"?W0:typeof self<"u"?self:{};function A(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var u=function(e){try{return!!e()}catch{return!0}},m=!u(function(){var e=(function(){}).bind();return typeof e!="function"||e.hasOwnProperty("prototype")}),E=m,w=Function.prototype,C=w.call,T=E&&w.bind.bind(C,C),N=E?T:function(e){return function(){return C.apply(e,arguments)}},B=N({}.isPrototypeOf),k=function(e){return e&&e.Math===Math&&e},Q=k(typeof globalThis=="object"&&globalThis)||k(typeof window=="object"&&window)||k(typeof self=="object"&&self)||k(typeof c=="object"&&c)||k(typeof c=="object"&&c)||function(){return this}()||Function("return this")(),K=m,Y=Function.prototype,F=Y.apply,M=Y.call,V=typeof Reflect=="object"&&Reflect.apply||(K?M.bind(F):function(){return M.apply(F,arguments)}),W=N,q=W({}.toString),te=W("".slice),re=function(e){return te(q(e),8,-1)},de=re,ce=N,Ae=function(e){if(de(e)==="Function")return ce(e)},ne=typeof document=="object"&&document.all,ue=ne===void 0&&ne!==void 0?function(e){return typeof e=="function"||e===ne}:function(e){return typeof e=="function"},ye={},De=!u(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!==7}),Xe=m,we=Function.prototype.call,Se=Xe?we.bind(we):function(){return we.apply(we,arguments)},Qe={},Ye={}.propertyIsEnumerable,It=Object.getOwnPropertyDescriptor,Fe=It&&!Ye.call({1:2},1);Qe.f=Fe?function(e){var t=It(this,e);return!!t&&t.enumerable}:Ye;var Ge,dt,Nt=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},hn=u,rr=re,He=Object,Pe=N("".split),yt=hn(function(){return!He("z").propertyIsEnumerable(0)})?function(e){return rr(e)==="String"?Pe(e,""):He(e)}:He,st=function(e){return e==null},qr=st,Ze=TypeError,Qt=function(e){if(qr(e))throw new Ze("Can't call method on "+e);return e},wr=yt,Oe=Qt,Et=function(e){return wr(Oe(e))},mt=ue,ut=function(e){return typeof e=="object"?e!==null:mt(e)},Ot={},pn=Ot,Fn=Q,rd=ue,xl=function(e){return rd(e)?e:void 0},Qr=function(e,t){return arguments.length<2?xl(pn[e])||xl(Fn[e]):pn[e]&&pn[e][t]||Fn[e]&&Fn[e][t]},Ys=Q.navigator,di=Ys&&Ys.userAgent,wi=di?String(di):"",aa=Q,sc=wi,Dl=aa.process,Cs=aa.Deno,zs=Dl&&Dl.versions||Cs&&Cs.version,Bs=zs&&zs.v8;Bs&&(dt=(Ge=Bs.split("."))[0]>0&&Ge[0]<4?1:+(Ge[0]+Ge[1])),!dt&&sc&&(!(Ge=sc.match(/Edge\/(\d+)/))||Ge[1]>=74)&&(Ge=sc.match(/Chrome\/(\d+)/))&&(dt=+Ge[1]);var Fa=dt,kf=Fa,Hr=u,jc=Q.String,Ui=!!Object.getOwnPropertySymbols&&!Hr(function(){var e=Symbol("symbol detection");return!jc(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&kf&&kf<41}),us=Ui&&!Symbol.sham&&typeof Symbol.iterator=="symbol",Gu=Qr,mn=ue,Xr=B,Hn=Object,bi=us?function(e){return typeof e=="symbol"}:function(e){var t=Gu("Symbol");return mn(t)&&Xr(t.prototype,Hn(e))},sd=String,So=function(e){try{return sd(e)}catch{return"Object"}},D9=ue,B9=So,k9=TypeError,Pi=function(e){if(D9(e))return e;throw new k9(B9(e)+" is not a function")},L9=Pi,U9=st,Lf=function(e,t){var n=e[t];return U9(n)?void 0:L9(n)},BB=Se,kB=ue,LB=ut,P9=TypeError,UB={exports:{}},PB=Q,M9=Object.defineProperty,F9=Q,j9=function(e,t){try{M9(PB,e,{value:t,configurable:!0,writable:!0})}catch{PB[e]=t}return t},MB="__core-js_shared__",FB=UB.exports=F9[MB]||j9(MB,{});(FB.versions||(FB.versions=[])).push({version:"3.46.0",mode:"pure",copyright:" 2014-2025 Denis Pushkarev (zloirock.ru), 2025 CoreJS Company (core-js.io)",license:"https://github.com/zloirock/core-js/blob/v3.46.0/LICENSE",source:"https://github.com/zloirock/core-js"});var jb=UB.exports,jB=jb,Ku=function(e,t){return jB[e]||(jB[e]=t||{})},V9=Qt,Q9=Object,ic=function(e){return Q9(V9(e))},H9=ic,G9=N({}.hasOwnProperty),hs=Object.hasOwn||function(e,t){return G9(H9(e),t)},K9=N,W9=0,Y9=Math.random(),z9=K9(1.1.toString),Vb=function(e){return"Symbol("+(e===void 0?"":e)+")_"+z9(++W9+Y9,36)},q9=Ku,VB=hs,X9=Vb,J9=Ui,$9=us,Wu=Q.Symbol,Qb=q9("wks"),Z9=$9?Wu.for||Wu:Wu&&Wu.withoutSetter||X9,sr=function(e){return VB(Qb,e)||(Qb[e]=J9&&VB(Wu,e)?Wu[e]:Z9("Symbol."+e)),Qb[e]},e7=Se,QB=ut,HB=bi,t7=Lf,n7=function(e,t){var n,i;if(kB(n=e.toString)&&!LB(i=BB(n,e))||kB(n=e.valueOf)&&!LB(i=BB(n,e)))return i;throw new P9("Can't convert object to primitive value")},r7=TypeError,s7=sr("toPrimitive"),i7=function(e,t){if(!QB(e)||HB(e))return e;var n,i=t7(e,s7);if(i){if(n=e7(i,e,t),!QB(n)||HB(n))return n;throw new r7("Can't convert object to primitive value")}return n7(e)},a7=bi,Hb=function(e){var t=i7(e,"string");return a7(t)?t:t+""},GB=ut,Gb=Q.document,o7=GB(Gb)&&GB(Gb.createElement),Kb=function(e){return o7?Gb.createElement(e):{}},c7=Kb,KB=!De&&!u(function(){return Object.defineProperty(c7("div"),"a",{get:function(){return 7}}).a!==7}),l7=De,A7=Se,d7=Qe,u7=Nt,h7=Et,p7=Hb,f7=hs,m7=KB,WB=Object.getOwnPropertyDescriptor;ye.f=l7?WB:function(e,t){if(e=h7(e),t=p7(t),m7)try{return WB(e,t)}catch{}if(f7(e,t))return u7(!A7(d7.f,e,t),e[t])};var g7=u,_7=ue,E7=/#|\.prototype\./,Uf=function(e,t){var n=y7[v7(e)];return n===b7||n!==w7&&(_7(t)?g7(t):!!t)},v7=Uf.normalize=function(e){return String(e).replace(E7,".").toLowerCase()},y7=Uf.data={},w7=Uf.NATIVE="N",b7=Uf.POLYFILL="P",YB=Uf,S7=Pi,C7=m,T7=Ae(Ae.bind),Bl=function(e,t){return S7(e),t===void 0?e:C7?T7(e,t):function(){return e.apply(t,arguments)}},ja={},zB=De&&u(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!==42}),R7=ut,I7=String,N7=TypeError,Si=function(e){if(R7(e))return e;throw new N7(I7(e)+" is not an object")},O7=De,x7=KB,D7=zB,Y_=Si,qB=Hb,B7=TypeError,Wb=Object.defineProperty,k7=Object.getOwnPropertyDescriptor,Yb="enumerable",zb="configurable",qb="writable";ja.f=O7?D7?function(e,t,n){if(Y_(e),t=qB(t),Y_(n),typeof e=="function"&&t==="prototype"&&"value"in n&&qb in n&&!n[qb]){var i=k7(e,t);i&&i[qb]&&(e[t]=n.value,n={configurable:zb in n?n[zb]:i[zb],enumerable:Yb in n?n[Yb]:i[Yb],writable:!1})}return Wb(e,t,n)}:Wb:function(e,t,n){if(Y_(e),t=qB(t),Y_(n),x7)try{return Wb(e,t,n)}catch{}if("get"in n||"set"in n)throw new B7("Accessors not supported");return"value"in n&&(e[t]=n.value),e};var L7=ja,U7=Nt,id=De?function(e,t,n){return L7.f(e,t,U7(1,n))}:function(e,t,n){return e[t]=n,e},Pf=Q,P7=V,M7=Ae,F7=ue,j7=ye.f,V7=YB,Yu=Ot,Q7=Bl,zu=id,XB=hs,H7=function(e){var t=function(n,i,o){if(this instanceof t){switch(arguments.length){case 0:return new e;case 1:return new e(n);case 2:return new e(n,i)}return new e(n,i,o)}return P7(e,this,arguments)};return t.prototype=e.prototype,t},Yt=function(e,t){var n,i,o,l,d,h,f,g,_,v=e.target,y=e.global,b=e.stat,D=e.proto,I=y?Pf:b?Pf[v]:Pf[v]&&Pf[v].prototype,O=y?Yu:Yu[v]||zu(Yu,v,{})[v],U=O.prototype;for(l in t)i=!(n=V7(y?l:v+(b?".":"#")+l,e.forced))&&I&&XB(I,l),h=O[l],i&&(f=e.dontCallGetSet?(_=j7(I,l))&&_.value:I[l]),d=i&&f?f:t[l],(n||D||typeof h!=typeof d)&&(g=e.bind&&i?Q7(d,Pf):e.wrap&&i?H7(d):D&&F7(d)?M7(d):d,(e.sham||d&&d.sham||h&&h.sham)&&zu(g,"sham",!0),zu(O,l,g),D&&(XB(Yu,o=v+"Prototype")||zu(Yu,o,{}),zu(Yu[o],l,d),e.real&&U&&(n||!U[l])&&zu(U,l,d)))},G7=Math.ceil,K7=Math.floor,W7=Math.trunc||function(e){var t=+e;return(t>0?K7:G7)(t)},Y7=W7,Xb=function(e){var t=+e;return t!=t||t===0?0:Y7(t)},z7=Xb,q7=Math.max,X7=Math.min,Jb=function(e,t){var n=z7(e);return n<0?q7(n+t,0):X7(n,t)},J7=Xb,$7=Math.min,JB=function(e){var t=J7(e);return t>0?$7(t,9007199254740991):0},Z7=JB,kl=function(e){return Z7(e.length)},eX=Et,tX=Jb,nX=kl,$B=function(e){return function(t,n,i){var o=eX(t),l=nX(o);if(l===0)return!e&&-1;var d,h=tX(i,l);if(e&&n!=n){for(;l>h;)if((d=o[h++])!=d)return!0}else for(;l>h;h++)if((e||h in o)&&o[h]===n)return e||h||0;return!e&&-1}},$b={includes:$B(!0),indexOf:$B(!1)},rX=$b.includes;Yt({target:"Array",proto:!0,forced:u(function(){return!Array(1).includes()})},{includes:function(e){return rX(this,e,arguments.length>1?arguments[1]:void 0)}});var sX=Q,iX=Ot,oa=function(e,t){var n=iX[e+"Prototype"],i=n&&n[t];if(i)return i;var o=sX[e],l=o&&o.prototype;return l&&l[t]},aX=oa("Array","includes"),oX=ut,cX=re,lX=sr("match"),Zb=function(e){var t;return oX(e)&&((t=e[lX])!==void 0?!!t:cX(e)==="RegExp")},AX=Zb,dX=TypeError,ZB={};ZB[sr("toStringTag")]="z";var eS=String(ZB)==="[object z]",uX=eS,hX=ue,z_=re,pX=sr("toStringTag"),fX=Object,mX=z_(function(){return arguments}())==="Arguments",Ll=uX?z_:function(e){var t,n,i;return e===void 0?"Undefined":e===null?"Null":typeof(n=function(o,l){try{return o[l]}catch{}}(t=fX(e),pX))=="string"?n:mX?z_(t):(i=z_(t))==="Object"&&hX(t.callee)?"Arguments":i},gX=Ll,_X=String,Ci=function(e){if(gX(e)==="Symbol")throw new TypeError("Cannot convert a Symbol value to a string");return _X(e)},EX=sr("match"),vX=Yt,yX=function(e){if(AX(e))throw new dX("The method doesn't accept regular expressions");return e},wX=Qt,e1=Ci,bX=function(e){var t=/./;try{"/./"[e](t)}catch{try{return t[EX]=!1,"/./"[e](t)}catch{}}return!1},SX=N("".indexOf);vX({target:"String",proto:!0,forced:!bX("includes")},{includes:function(e){return!!~SX(e1(wX(this)),e1(yX(e)),arguments.length>1?arguments[1]:void 0)}});var CX=oa("String","includes"),t1=B,TX=aX,RX=CX,tS=Array.prototype,nS=String.prototype,IX=function(e){var t=e.includes;return e===tS||t1(tS,e)&&t===tS.includes?TX:typeof e=="string"||e===nS||t1(nS,e)&&t===nS.includes?RX:t},me=A(IX),NX=Pi,OX=ic,xX=yt,DX=kl,n1=TypeError,r1="Reduce of empty array with no initial value",BX=function(e){return function(t,n,i,o){var l=OX(t),d=xX(l),h=DX(l);if(NX(n),h===0&&i<2)throw new n1(r1);var f=e?h-1:0,g=e?-1:1;if(i<2)for(;;){if(f in d){o=d[f],f+=g;break}if(f+=g,e?f<0:h<=f)throw new n1(r1)}for(;e?f>=0:h>f;f+=g)f in d&&(o=n(o,d[f],f,l));return o}},kX={left:BX(!1)},LX=u,q_=function(e,t){var n=[][e];return!!n&&LX(function(){n.call(null,t||function(){return 1},1)})},Mf=Q,UX=wi,PX=re,X_=function(e){return UX.slice(0,e.length)===e},rS=X_("Bun/")?"BUN":X_("Cloudflare-Workers")?"CLOUDFLARE":X_("Deno/")?"DENO":X_("Node.js/")?"NODE":Mf.Bun&&typeof Bun.version=="string"?"BUN":Mf.Deno&&typeof Deno.version=="object"?"DENO":PX(Mf.process)==="process"?"NODE":Mf.window&&Mf.document?"BROWSER":"REST",J_=rS==="NODE",MX=kX.left;Yt({target:"Array",proto:!0,forced:!J_&&Fa>79&&Fa<83||!q_("reduce")},{reduce:function(e){var t=arguments.length;return MX(this,e,t,t>1?arguments[1]:void 0)}});var FX=oa("Array","reduce"),jX=B,VX=FX,sS=Array.prototype,QX=function(e){var t=e.reduce;return e===sS||jX(sS,e)&&t===sS.reduce?VX:t},s1=QX,ca=A(s1),HX=re,Ff=Array.isArray||function(e){return HX(e)==="Array"},GX=Yt,KX=Ff,WX=N([].reverse),i1=[1,2];GX({target:"Array",proto:!0,forced:String(i1)===String(i1.reverse())},{reverse:function(){return KX(this)&&(this.length=this.length),WX(this)}});var YX=oa("Array","reverse"),zX=B,qX=YX,iS=Array.prototype,XX=function(e){var t=e.reverse;return e===iS||zX(iS,e)&&t===iS.reverse?qX:t},a1=XX,o1=A(a1),JX=Vb,c1=Ku("keys"),$_=function(e){return c1[e]||(c1[e]=JX(e))},$X=!u(function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}),ZX=hs,eJ=ue,tJ=ic,nJ=$X,l1=$_("IE_PROTO"),aS=Object,rJ=aS.prototype,oS=nJ?aS.getPrototypeOf:function(e){var t=tJ(e);if(ZX(t,l1))return t[l1];var n=t.constructor;return eJ(n)&&t instanceof n?n.prototype:t instanceof aS?rJ:null},sJ=N,iJ=Pi,aJ=ut,oJ=function(e){return aJ(e)||e===null},cJ=String,lJ=TypeError,AJ=function(e,t,n){try{return sJ(iJ(Object.getOwnPropertyDescriptor(e,t)[n]))}catch{}},dJ=ut,uJ=Qt,hJ=function(e){if(oJ(e))return e;throw new lJ("Can't set "+cJ(e)+" as a prototype")},pJ=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,n={};try{(e=AJ(Object.prototype,"__proto__","set"))(n,[]),t=n instanceof Array}catch{}return function(i,o){return uJ(i),hJ(o),dJ(i)&&(t?e(i,o):i.__proto__=o),i}}():void 0),Z_={},eE={},cS=hs,fJ=Et,mJ=$b.indexOf,gJ=eE,A1=N([].push),d1=function(e,t){var n,i=fJ(e),o=0,l=[];for(n in i)!cS(gJ,n)&&cS(i,n)&&A1(l,n);for(;t.length>o;)cS(i,n=t[o++])&&(~mJ(l,n)||A1(l,n));return l},lS=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],_J=d1,EJ=lS.concat("length","prototype");Z_.f=Object.getOwnPropertyNames||function(e){return _J(e,EJ)};var jf={};jf.f=Object.getOwnPropertySymbols;var vJ=Qr,yJ=Z_,wJ=jf,bJ=Si,SJ=N([].concat),CJ=vJ("Reflect","ownKeys")||function(e){var t=yJ.f(bJ(e)),n=wJ.f;return n?SJ(t,n(e)):t},u1=hs,TJ=CJ,RJ=ye,IJ=ja,AS={},NJ=d1,OJ=lS,tE=Object.keys||function(e){return NJ(e,OJ)},xJ=De,DJ=zB,BJ=ja,kJ=Si,LJ=Et,UJ=tE;AS.f=xJ&&!DJ?Object.defineProperties:function(e,t){kJ(e);for(var n,i=LJ(t),o=UJ(t),l=o.length,d=0;l>d;)BJ.f(e,n=o[d++],i[n]);return e};var nE,h1=Qr("document","documentElement"),PJ=Si,MJ=AS,p1=lS,FJ=eE,jJ=h1,VJ=Kb,dS="prototype",uS="script",f1=$_("IE_PROTO"),hS=function(){},m1=function(e){return"<"+uS+">"+e+"</"+uS+">"},g1=function(e){e.write(m1("")),e.close();var t=e.parentWindow.Object;return e=null,t},rE=function(){try{nE=new ActiveXObject("htmlfile")}catch{}var e,t,n;rE=typeof document<"u"?document.domain&&nE?g1(nE):(t=VJ("iframe"),n="java"+uS+":",t.style.display="none",jJ.appendChild(t),t.src=String(n),(e=t.contentWindow.document).open(),e.write(m1("document.F=Object")),e.close(),e.F):g1(nE);for(var i=p1.length;i--;)delete rE[dS][p1[i]];return rE()};FJ[f1]=!0;var Vf=Object.create||function(e,t){var n;return e!==null?(hS[dS]=PJ(e),n=new hS,hS[dS]=null,n[f1]=e):n=rE(),t===void 0?n:MJ.f(n,t)},QJ=ut,HJ=id,_1=Error,GJ=N("".replace),KJ=String(new _1("zxcasd").stack),E1=/\n\s*at [^:]*:[^\n]*/,WJ=E1.test(KJ),YJ=Nt,zJ=!u(function(){var e=new Error("a");return!("stack"in e)||(Object.defineProperty(e,"stack",YJ(1,7)),e.stack!==7)}),qJ=id,XJ=function(e,t){if(WJ&&typeof e=="string"&&!_1.prepareStackTrace)for(;t--;)e=GJ(e,E1,"");return e},JJ=zJ,v1=Error.captureStackTrace,qu={},$J=qu,ZJ=sr("iterator"),e$=Array.prototype,y1=function(e){return e!==void 0&&($J.Array===e||e$[ZJ]===e)},t$=Ll,w1=Lf,n$=st,r$=qu,s$=sr("iterator"),sE=function(e){if(!n$(e))return w1(e,s$)||w1(e,"@@iterator")||r$[t$(e)]},i$=Se,a$=Pi,o$=Si,c$=So,l$=sE,A$=TypeError,pS=function(e,t){var n=arguments.length<2?l$(e):t;if(a$(n))return o$(i$(n,e));throw new A$(c$(e)+" is not iterable")},d$=Se,b1=Si,u$=Lf,S1=function(e,t,n){var i,o;b1(e);try{if(!(i=u$(e,"return"))){if(t==="throw")throw n;return n}i=d$(i,e)}catch(l){o=!0,i=l}if(t==="throw")throw n;if(o)throw i;return b1(i),n},h$=Bl,p$=Se,f$=Si,m$=So,g$=y1,_$=kl,C1=B,E$=pS,v$=sE,T1=S1,y$=TypeError,iE=function(e,t){this.stopped=e,this.result=t},R1=iE.prototype,Qf=function(e,t,n){var i,o,l,d,h,f,g,_=n&&n.that,v=!(!n||!n.AS_ENTRIES),y=!(!n||!n.IS_RECORD),b=!(!n||!n.IS_ITERATOR),D=!(!n||!n.INTERRUPTED),I=h$(t,_),O=function(j){return i&&T1(i,"normal"),new iE(!0,j)},U=function(j){return v?(f$(j),D?I(j[0],j[1],O):I(j[0],j[1])):D?I(j,O):I(j)};if(y)i=e.iterator;else if(b)i=e;else{if(!(o=v$(e)))throw new y$(m$(e)+" is not iterable");if(g$(o)){for(l=0,d=_$(e);d>l;l++)if((h=U(e[l]))&&C1(R1,h))return h;return new iE(!1)}i=E$(e,o)}for(f=y?e.next:i.next;!(g=p$(f,i)).done;){try{h=U(g.value)}catch(j){T1(i,"throw",j)}if(typeof h=="object"&&h&&C1(R1,h))return h}return new iE(!1)},w$=Ci,b$=Yt,S$=B,C$=oS,aE=pJ,T$=function(e,t,n){for(var i=TJ(t),o=IJ.f,l=RJ.f,d=0;d<i.length;d++){var h=i[d];u1(e,h)||n&&u1(n,h)||o(e,h,l(t,h))}},I1=Vf,fS=id,mS=Nt,R$=function(e,t){QJ(t)&&"cause"in t&&HJ(e,"cause",t.cause)},I$=function(e,t,n,i){JJ&&(v1?v1(e,t):qJ(e,"stack",XJ(n,i)))},N$=Qf,O$=function(e,t){return e===void 0?arguments.length<2?"":t:w$(e)},x$=sr("toStringTag"),oE=Error,D$=[].push,Xu=function(e,t){var n,i=S$(gS,this);aE?n=aE(new oE,i?C$(this):gS):(n=i?this:I1(gS),fS(n,x$,"Error")),t!==void 0&&fS(n,"message",O$(t)),I$(n,Xu,n.stack,1),arguments.length>2&&R$(n,arguments[2]);var o=[];return N$(e,D$,{that:o}),fS(n,"errors",o),n};aE?aE(Xu,oE):T$(Xu,oE,{name:!0});var gS=Xu.prototype=I1(oE.prototype,{constructor:mS(1,Xu),message:mS(1,""),name:mS(1,"AggregateError")});b$({global:!0},{AggregateError:Xu});var cE,Hf,lE,B$=ue,N1=Q.WeakMap,k$=B$(N1)&&/native code/.test(String(N1)),O1=Q,L$=ut,U$=id,_S=hs,ES=jb,P$=$_,M$=eE,x1="Object already initialized",vS=O1.TypeError,F$=O1.WeakMap;if(k$||ES.state){var ac=ES.state||(ES.state=new F$);ac.get=ac.get,ac.has=ac.has,ac.set=ac.set,cE=function(e,t){if(ac.has(e))throw new vS(x1);return t.facade=e,ac.set(e,t),t},Hf=function(e){return ac.get(e)||{}},lE=function(e){return ac.has(e)}}else{var Ju=P$("state");M$[Ju]=!0,cE=function(e,t){if(_S(e,Ju))throw new vS(x1);return t.facade=e,U$(e,Ju,t),t},Hf=function(e){return _S(e,Ju)?e[Ju]:{}},lE=function(e){return _S(e,Ju)}}var ad,D1,B1,od={set:cE,get:Hf,has:lE,enforce:function(e){return lE(e)?Hf(e):cE(e,{})},getterFor:function(e){return function(t){var n;if(!L$(t)||(n=Hf(t)).type!==e)throw new vS("Incompatible receiver, "+e+" required");return n}}},yS=De,j$=hs,k1=Function.prototype,V$=yS&&Object.getOwnPropertyDescriptor,L1=j$(k1,"name"),U1={PROPER:L1&&(function(){}).name==="something",CONFIGURABLE:L1&&(!yS||yS&&V$(k1,"name").configurable)},Q$=id,Ul=function(e,t,n,i){return i&&i.enumerable?e[t]=n:Q$(e,t,n),e},H$=u,G$=ue,K$=ut,W$=Vf,P1=oS,Y$=Ul,wS=sr("iterator"),M1=!1;[].keys&&("next"in(B1=[].keys())?(D1=P1(P1(B1)))!==Object.prototype&&(ad=D1):M1=!0);var z$=!K$(ad)||H$(function(){var e={};return ad[wS].call(e)!==e});G$((ad=z$?{}:W$(ad))[wS])||Y$(ad,wS,function(){return this});var F1={IteratorPrototype:ad,BUGGY_SAFARI_ITERATORS:M1},q$=Ll,X$=eS?{}.toString:function(){return"[object "+q$(this)+"]"},J$=eS,$$=ja.f,Z$=id,eZ=hs,tZ=X$,j1=sr("toStringTag"),Vc=function(e,t,n,i){var o=n?e:e&&e.prototype;o&&(eZ(o,j1)||$$(o,j1,{configurable:!0,value:t}),i&&!J$&&Z$(o,"toString",tZ))},nZ=F1.IteratorPrototype,rZ=Vf,sZ=Nt,iZ=Vc,aZ=qu,oZ=function(){return this},bS=function(e,t,n,i){var o=t+" Iterator";return e.prototype=rZ(nZ,{next:sZ(+!i,n)}),iZ(e,o,!1,!0),aZ[o]=oZ,e},cZ=Yt,lZ=Se,AZ=U1,dZ=bS,uZ=oS,hZ=Vc,V1=Ul,Q1=qu,pZ=F1,fZ=AZ.PROPER,AE=pZ.BUGGY_SAFARI_ITERATORS,SS=sr("iterator"),H1="keys",dE="values",G1="entries",mZ=function(){return this},K1=function(e,t,n,i,o,l,d){dZ(n,t,i);var h,f,g,_=function(U){if(U===o&&I)return I;if(!AE&&U&&U in b)return b[U];switch(U){case H1:case dE:case G1:return function(){return new n(this,U)}}return function(){return new n(this)}},v=t+" Iterator",y=!1,b=e.prototype,D=b[SS]||b["@@iterator"]||o&&b[o],I=!AE&&D||_(o),O=t==="Array"&&b.entries||D;if(O&&(h=uZ(O.call(new e)))!==Object.prototype&&h.next&&(hZ(h,v,!0,!0),Q1[v]=mZ),fZ&&o===dE&&D&&D.name!==dE&&(y=!0,I=function(){return lZ(D,this)}),o)if(f={values:_(dE),keys:l?I:_(H1),entries:_(G1)},d)for(g in f)(AE||y||!(g in b))&&V1(b,g,f[g]);else cZ({target:t,proto:!0,forced:AE||y},f);return d&&b[SS]!==I&&V1(b,SS,I,{}),Q1[t]=I,f},uE=function(e,t){return{value:e,done:t}},gZ=Et,W1=qu,Y1=od;ja.f;var _Z=K1,hE=uE,z1="Array Iterator",EZ=Y1.set,vZ=Y1.getterFor(z1);_Z(Array,"Array",function(e,t){EZ(this,{type:z1,target:gZ(e),index:0,kind:t})},function(){var e=vZ(this),t=e.target,n=e.index++;if(!t||n>=t.length)return e.target=null,hE(void 0,!0);switch(e.kind){case"keys":return hE(n,!1);case"values":return hE(t[n],!1)}return hE([n,t[n]],!1)},"values"),W1.Arguments=W1.Array;var yZ=ja,pE=function(e,t,n){return yZ.f(e,t,n)},wZ=Qr,bZ=pE,SZ=De,q1=sr("species"),CZ=B,TZ=TypeError,CS=function(e,t){if(CZ(t,e))return e;throw new TZ("Incorrect invocation")},RZ=ue,TS=jb,IZ=N(Function.toString);RZ(TS.inspectSource)||(TS.inspectSource=function(e){return IZ(e)});var X1=TS.inspectSource,NZ=N,OZ=u,J1=ue,xZ=Ll,DZ=X1,$1=function(){},Z1=Qr("Reflect","construct"),RS=/^\s*(?:class|function)\b/,BZ=NZ(RS.exec),kZ=!RS.test($1),Gf=function(e){if(!J1(e))return!1;try{return Z1($1,[],e),!0}catch{return!1}},ek=function(e){if(!J1(e))return!1;switch(xZ(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return kZ||!!BZ(RS,DZ(e))}catch{return!0}};ek.sham=!0;var Kf,$u,tk,IS,fE=!Z1||OZ(function(){var e;return Gf(Gf.call)||!Gf(Object)||!Gf(function(){e=!0})||e})?ek:Gf,LZ=fE,UZ=So,PZ=TypeError,nk=Si,MZ=function(e){if(LZ(e))return e;throw new PZ(UZ(e)+" is not a constructor")},FZ=st,jZ=sr("species"),NS=function(e,t){var n,i=nk(e).constructor;return i===void 0||FZ(n=nk(i)[jZ])?t:MZ(n)},Pl=N([].slice),VZ=TypeError,cd=function(e,t){if(e<t)throw new VZ("Not enough arguments");return e},rk=/(?:ipad|iphone|ipod).*applewebkit/i.test(wi),la=Q,QZ=V,HZ=Bl,sk=ue,GZ=hs,ik=u,ak=h1,KZ=Pl,ok=Kb,WZ=cd,YZ=rk,zZ=J_,OS=la.setImmediate,xS=la.clearImmediate,qZ=la.process,DS=la.Dispatch,XZ=la.Function,ck=la.MessageChannel,JZ=la.String,BS=0,Wf={},lk="onreadystatechange";ik(function(){Kf=la.location});var kS=function(e){if(GZ(Wf,e)){var t=Wf[e];delete Wf[e],t()}},LS=function(e){return function(){kS(e)}},Ak=function(e){kS(e.data)},dk=function(e){la.postMessage(JZ(e),Kf.protocol+"//"+Kf.host)};OS&&xS||(OS=function(e){WZ(arguments.length,1);var t=sk(e)?e:XZ(e),n=KZ(arguments,1);return Wf[++BS]=function(){QZ(t,void 0,n)},$u(BS),BS},xS=function(e){delete Wf[e]},zZ?$u=function(e){qZ.nextTick(LS(e))}:DS&&DS.now?$u=function(e){DS.now(LS(e))}:ck&&!YZ?(IS=(tk=new ck).port2,tk.port1.onmessage=Ak,$u=HZ(IS.postMessage,IS)):la.addEventListener&&sk(la.postMessage)&&!la.importScripts&&Kf&&Kf.protocol!=="file:"&&!ik(dk)?($u=dk,la.addEventListener("message",Ak,!1)):$u=lk in ok("script")?function(e){ak.appendChild(ok("script"))[lk]=function(){ak.removeChild(this),kS(e)}}:function(e){setTimeout(LS(e),0)});var mE={set:OS,clear:xS},uk=Q,$Z=De,ZZ=Object.getOwnPropertyDescriptor,hk=function(e){if(!$Z)return uk[e];var t=ZZ(uk,e);return t&&t.value},pk=function(){this.head=null,this.tail=null};pk.prototype={add:function(e){var t={item:e,next:null},n=this.tail;n?n.next=t:this.head=t,this.tail=t},get:function(){var e=this.head;if(e)return(this.head=e.next)===null&&(this.tail=null),e.item}};var Zu,US,PS,MS,fk,mk=pk,eee=/ipad|iphone|ipod/i.test(wi)&&typeof Pebble<"u",tee=/web0s(?!.*chrome)/i.test(wi),eh=Q,nee=hk,gk=Bl,FS=mE.set,ree=mk,see=rk,iee=eee,aee=tee,jS=J_,_k=eh.MutationObserver||eh.WebKitMutationObserver,Ek=eh.document,vk=eh.process,gE=eh.Promise,VS=nee("queueMicrotask");if(!VS){var _E=new ree,EE=function(){var e,t;for(jS&&(e=vk.domain)&&e.exit();t=_E.get();)try{t()}catch(n){throw _E.head&&Zu(),n}e&&e.enter()};see||jS||aee||!_k||!Ek?!iee&&gE&&gE.resolve?((MS=gE.resolve(void 0)).constructor=gE,fk=gk(MS.then,MS),Zu=function(){fk(EE)}):jS?Zu=function(){vk.nextTick(EE)}:(FS=gk(FS,eh),Zu=function(){FS(EE)}):(US=!0,PS=Ek.createTextNode(""),new _k(EE).observe(PS,{characterData:!0}),Zu=function(){PS.data=US=!US}),VS=function(e){_E.head||Zu(),_E.add(e)}}var yk=VS,th=function(e){try{return{error:!1,value:e()}}catch(t){return{error:!0,value:t}}},ld=Q.Promise,oee=Q,Yf=ld,cee=ue,lee=YB,Aee=X1,dee=sr,wk=rS,QS=Fa,bk=Yf&&Yf.prototype,uee=dee("species"),Sk=cee(oee.PromiseRejectionEvent),hee=lee("Promise",function(){var e=Aee(Yf),t=e!==String(Yf);if(!t&&QS===66||!bk.catch||!bk.finally)return!0;if(!QS||QS<51||!/native code/.test(e)){var n=new Yf(function(o){o(1)}),i=function(o){o(function(){},function(){})};if((n.constructor={})[uee]=i,!(n.then(function(){})instanceof i))return!0}return!(t||wk!=="BROWSER"&&wk!=="DENO"||Sk)}),zf={CONSTRUCTOR:hee,REJECTION_EVENT:Sk},oc={},Ck=Pi,pee=TypeError,fee=function(e){var t,n;this.promise=new e(function(i,o){if(t!==void 0||n!==void 0)throw new pee("Bad Promise constructor");t=i,n=o}),this.resolve=Ck(t),this.reject=Ck(n)};oc.f=function(e){return new fee(e)};var HS,Tk,Rk,mee=Yt,vE=J_,Ml=Q,gee=Ot,qf=Se,_ee=Ul,Eee=Vc,vee=function(e){var t=wZ(e);SZ&&t&&!t[q1]&&bZ(t,q1,{configurable:!0,get:function(){return this}})},yee=Pi,GS=ue,wee=ut,bee=CS,See=NS,Ik=mE.set,KS=yk,Cee=function(e,t){try{arguments.length===1?console.error(e):console.error(e,t)}catch{}},Tee=th,Ree=mk,Nk=od,WS=ld,Ok=zf,xk=oc,yE="Promise",Dk=Ok.CONSTRUCTOR,Iee=Ok.REJECTION_EVENT,YS=Nk.getterFor(yE),Nee=Nk.set,Oee=WS&&WS.prototype,Xf=WS,zS=Oee,Bk=Ml.TypeError,qS=Ml.document,XS=Ml.process,JS=xk.f,xee=JS,Dee=!!(qS&&qS.createEvent&&Ml.dispatchEvent),kk="unhandledrejection",Lk=function(e){var t;return!(!wee(e)||!GS(t=e.then))&&t},Uk=function(e,t){var n,i,o,l=t.value,d=t.state===1,h=d?e.ok:e.fail,f=e.resolve,g=e.reject,_=e.domain;try{h?(d||(t.rejection===2&&kee(t),t.rejection=1),h===!0?n=l:(_&&_.enter(),n=h(l),_&&(_.exit(),o=!0)),n===e.promise?g(new Bk("Promise-chain cycle")):(i=Lk(n))?qf(i,n,f,g):f(n)):g(l)}catch(v){_&&!o&&_.exit(),g(v)}},Pk=function(e,t){e.notified||(e.notified=!0,KS(function(){for(var n,i=e.reactions;n=i.get();)Uk(n,e);e.notified=!1,t&&!e.rejection&&Bee(e)}))},Mk=function(e,t,n){var i,o;Dee?((i=qS.createEvent("Event")).promise=t,i.reason=n,i.initEvent(e,!1,!0),Ml.dispatchEvent(i)):i={promise:t,reason:n},!Iee&&(o=Ml["on"+e])?o(i):e===kk&&Cee("Unhandled promise rejection",n)},Bee=function(e){qf(Ik,Ml,function(){var t,n=e.facade,i=e.value;if(Fk(e)&&(t=Tee(function(){vE?XS.emit("unhandledRejection",i,n):Mk(kk,n,i)}),e.rejection=vE||Fk(e)?2:1,t.error))throw t.value})},Fk=function(e){return e.rejection!==1&&!e.parent},kee=function(e){qf(Ik,Ml,function(){var t=e.facade;vE?XS.emit("rejectionHandled",t):Mk("rejectionhandled",t,e.value)})},nh=function(e,t,n){return function(i){e(t,i,n)}},rh=function(e,t,n){e.done||(e.done=!0,n&&(e=n),e.value=t,e.state=2,Pk(e,!0))},$S=function(e,t,n){if(!e.done){e.done=!0,n&&(e=n);try{if(e.facade===t)throw new Bk("Promise can't be resolved itself");var i=Lk(t);i?KS(function(){var o={done:!1};try{qf(i,t,nh($S,o,e),nh(rh,o,e))}catch(l){rh(o,l,e)}}):(e.value=t,e.state=1,Pk(e,!1))}catch(o){rh({done:!1},o,e)}}};Dk&&(zS=(Xf=function(e){bee(this,zS),yee(e),qf(HS,this);var t=YS(this);try{e(nh($S,t),nh(rh,t))}catch(n){rh(t,n)}}).prototype,(HS=function(e){Nee(this,{type:yE,done:!1,notified:!1,parent:!1,reactions:new Ree,rejection:!1,state:0,value:null})}).prototype=_ee(zS,"then",function(e,t){var n=YS(this),i=JS(See(this,Xf));return n.parent=!0,i.ok=!GS(e)||e,i.fail=GS(t)&&t,i.domain=vE?XS.domain:void 0,n.state===0?n.reactions.add(i):KS(function(){Uk(i,n)}),i.promise}),Tk=function(){var e=new HS,t=YS(e);this.promise=e,this.resolve=nh($S,t),this.reject=nh(rh,t)},xk.f=JS=function(e){return e===Xf||e===Rk?new Tk(e):xee(e)}),mee({global:!0,wrap:!0,forced:Dk},{Promise:Xf}),Rk=gee.Promise,Eee(Xf,yE,!1,!0),vee(yE);var jk=sr("iterator"),Vk=!1;try{var Lee=0,Qk={next:function(){return{done:!!Lee++}},return:function(){Vk=!0}};Qk[jk]=function(){return this},Array.from(Qk,function(){throw 2})}catch{}var Uee=ld,Pee=function(e,t){try{if(!t&&!Vk)return!1}catch{return!1}var n=!1;try{var i={};i[jk]=function(){return{next:function(){return{done:n=!0}}}},e(i)}catch{}return n},wE=zf.CONSTRUCTOR||!Pee(function(e){Uee.all(e).then(void 0,function(){})}),Mee=Se,Fee=Pi,jee=oc,Vee=th,Qee=Qf;Yt({target:"Promise",stat:!0,forced:wE},{all:function(e){var t=this,n=jee.f(t),i=n.resolve,o=n.reject,l=Vee(function(){var d=Fee(t.resolve),h=[],f=0,g=1;Qee(e,function(_){var v=f++,y=!1;g++,Mee(d,t,_).then(function(b){y||(y=!0,h[v]=b,--g||i(h))},o)}),--g||i(h)});return l.error&&o(l.value),n.promise}});var Hee=Yt,Gee=zf.CONSTRUCTOR;ld&&ld.prototype,Hee({target:"Promise",proto:!0,forced:Gee,real:!0},{catch:function(e){return this.then(void 0,e)}});var Kee=Se,Wee=Pi,Yee=oc,zee=th,qee=Qf;Yt({target:"Promise",stat:!0,forced:wE},{race:function(e){var t=this,n=Yee.f(t),i=n.reject,o=zee(function(){var l=Wee(t.resolve);qee(e,function(d){Kee(l,t,d).then(n.resolve,i)})});return o.error&&i(o.value),n.promise}});var Xee=oc;Yt({target:"Promise",stat:!0,forced:zf.CONSTRUCTOR},{reject:function(e){var t=Xee.f(this);return(0,t.reject)(e),t.promise}});var Jee=Si,$ee=ut,Zee=oc,Hk=function(e,t){if(Jee(e),$ee(t)&&t.constructor===e)return t;var n=Zee.f(e);return(0,n.resolve)(t),n.promise},ete=Yt,tte=ld,nte=zf.CONSTRUCTOR,rte=Hk,ste=Qr("Promise"),ite=!nte;ete({target:"Promise",stat:!0,forced:!0},{resolve:function(e){return rte(ite&&this===ste?tte:this,e)}});var ate=Se,ote=Pi,cte=oc,lte=th,Ate=Qf;Yt({target:"Promise",stat:!0,forced:wE},{allSettled:function(e){var t=this,n=cte.f(t),i=n.resolve,o=n.reject,l=lte(function(){var d=ote(t.resolve),h=[],f=0,g=1;Ate(e,function(_){var v=f++,y=!1;g++,ate(d,t,_).then(function(b){y||(y=!0,h[v]={status:"fulfilled",value:b},--g||i(h))},function(b){y||(y=!0,h[v]={status:"rejected",reason:b},--g||i(h))})}),--g||i(h)});return l.error&&o(l.value),n.promise}});var dte=Se,ute=Pi,hte=Qr,pte=oc,fte=th,mte=Qf,Gk="No one promise resolved";Yt({target:"Promise",stat:!0,forced:wE},{any:function(e){var t=this,n=hte("AggregateError"),i=pte.f(t),o=i.resolve,l=i.reject,d=fte(function(){var h=ute(t.resolve),f=[],g=0,_=1,v=!1;mte(e,function(y){var b=g++,D=!1;_++,dte(h,t,y).then(function(I){D||v||(v=!0,o(I))},function(I){D||v||(D=!0,f[b]=I,--_||l(new n(f,Gk)))})}),--_||l(new n(f,Gk))});return d.error&&l(d.value),i.promise}});var gte=Yt,_te=V,Ete=Pl,vte=oc,yte=Pi,Kk=th,ZS=Q.Promise,Wk=!1;gte({target:"Promise",stat:!0,forced:!ZS||!ZS.try||Kk(function(){ZS.try(function(e){Wk=e===8},8)}).error||!Wk},{try:function(e){var t=arguments.length>1?Ete(arguments,1):[],n=vte.f(this),i=Kk(function(){return _te(yte(e),void 0,t)});return(i.error?n.reject:n.resolve)(i.value),n.promise}});var wte=oc;Yt({target:"Promise",stat:!0},{withResolvers:function(){var e=wte.f(this);return{promise:e.promise,resolve:e.resolve,reject:e.reject}}});var bte=Yt,eC=ld,Ste=u,Cte=Qr,Tte=ue,Rte=NS,Yk=Hk,Ite=eC&&eC.prototype;bte({target:"Promise",proto:!0,real:!0,forced:!!eC&&Ste(function(){Ite.finally.call({then:function(){}},function(){})})},{finally:function(e){var t=Rte(this,Cte("Promise")),n=Tte(e);return this.then(n?function(i){return Yk(t,e()).then(function(){return i})}:e,n?function(i){return Yk(t,e()).then(function(){throw i})}:e)}});var tC=N,Nte=Xb,Ote=Ci,xte=Qt,Dte=tC("".charAt),zk=tC("".charCodeAt),Bte=tC("".slice),qk=function(e){return function(t,n){var i,o,l=Ote(xte(t)),d=Nte(n),h=l.length;return d<0||d>=h?e?"":void 0:(i=zk(l,d))<55296||i>56319||d+1===h||(o=zk(l,d+1))<56320||o>57343?e?Dte(l,d):i:e?Bte(l,d,d+2):o-56320+(i-55296<<10)+65536}},nC={codeAt:qk(!1),charAt:qk(!0)},kte=nC.charAt,Lte=Ci,Xk=od,Ute=K1,Jk=uE,$k="String Iterator",Pte=Xk.set,Mte=Xk.getterFor($k);Ute(String,"String",function(e){Pte(this,{type:$k,string:Lte(e),index:0})},function(){var e,t=Mte(this),n=t.string,i=t.index;return i>=n.length?Jk(void 0,!0):(e=kte(n,i),t.index+=e.length,Jk(e,!1))});var Fte=Ot.Promise,jte={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},Vte=Q,Qte=Vc,Zk=qu;for(var rC in jte)Qte(Vte[rC],rC),Zk[rC]=Zk.Array;var eL=Fte,be=A(eL),Hte=oa("Array","values"),Gte=Ll,Kte=hs,Wte=B,Yte=Hte,sC=Array.prototype,zte={DOMTokenList:!0,NodeList:!0},qte=function(e){var t=e.values;return e===sC||Wte(sC,e)&&t===sC.values||Kte(zte,Gte(e))?Yte:t},Ti=A(qte),tL=So,Xte=TypeError,nL=Pl,Jte=Math.floor,iC=function(e,t){var n=e.length;if(n<8)for(var i,o,l=1;l<n;){for(o=l,i=e[l];o&&t(e[o-1],i)>0;)e[o]=e[--o];o!==l++&&(e[o]=i)}else for(var d=Jte(n/2),h=iC(nL(e,0,d),t),f=iC(nL(e,d),t),g=h.length,_=f.length,v=0,y=0;v<g||y<_;)e[v+y]=v<g&&y<_?t(h[v],f[y])<=0?h[v++]:f[y++]:v<g?h[v++]:f[y++];return e},rL=iC,sL=wi.match(/firefox\/(\d+)/i),$te=!!sL&&+sL[1],Zte=/MSIE|Trident/.test(wi),iL=wi.match(/AppleWebKit\/(\d+)\./),ene=!!iL&&+iL[1],tne=Yt,aL=N,nne=Pi,rne=ic,oL=kl,sne=function(e,t){if(!delete e[t])throw new Xte("Cannot delete property "+tL(t)+" of "+tL(e))},cL=Ci,aC=u,ine=rL,ane=q_,lL=$te,one=Zte,AL=Fa,dL=ene,Fl=[],uL=aL(Fl.sort),cne=aL(Fl.push),lne=aC(function(){Fl.sort(void 0)}),Ane=aC(function(){Fl.sort(null)}),dne=ane("sort"),hL=!aC(function(){if(AL)return AL<70;if(!(lL&&lL>3)){if(one)return!0;if(dL)return dL<603;var e,t,n,i,o="";for(e=65;e<76;e++){switch(t=String.fromCharCode(e),e){case 66:case 69:case 70:case 72:n=3;break;case 68:case 71:n=4;break;default:n=2}for(i=0;i<47;i++)Fl.push({k:t+i,v:n})}for(Fl.sort(function(l,d){return d.v-l.v}),i=0;i<Fl.length;i++)t=Fl[i].k.charAt(0),o.charAt(o.length-1)!==t&&(o+=t);return o!=="DGBEFHACIJK"}});tne({target:"Array",proto:!0,forced:lne||!Ane||!dne||!hL},{sort:function(e){e!==void 0&&nne(e);var t=rne(this);if(hL)return e===void 0?uL(t):uL(t,e);var n,i,o=[],l=oL(t);for(i=0;i<l;i++)i in t&&cne(o,t[i]);for(ine(o,function(d){return function(h,f){return f===void 0?-1:h===void 0?1:d!==void 0?+d(h,f)||0:cL(h)>cL(f)?1:-1}}(e)),n=oL(o),i=0;i<n;)t[i]=o[i++];for(;i<l;)sne(t,i++);return t}});var une=oa("Array","sort"),hne=B,pne=une,oC=Array.prototype,fne=function(e){var t=e.sort;return e===oC||hne(oC,e)&&t===oC.sort?pne:t},Ad=A(fne),mne=Yt,gne=N,_ne=Jb,Ene=RangeError,pL=String.fromCharCode,fL=String.fromCodePoint,vne=gne([].join);mne({target:"String",stat:!0,forced:!!fL&&fL.length!==1},{fromCodePoint:function(e){for(var t,n=[],i=arguments.length,o=0;i>o;){if(t=+arguments[o++],_ne(t,1114111)!==t)throw new Ene(t+" is not a valid code point");n[o]=t<65536?pL(t):pL(55296+((t-=65536)>>10),t%1024+56320)}return vne(n,"")}});var yne=u,wne=sr("iterator"),bE=!yne(function(){var e=new URL("b?a=1&b=2&c=3","https://a"),t=e.searchParams,n=new URLSearchParams("a=1&a=2&b=3"),i="";return e.pathname="c%20d",t.forEach(function(o,l){t.delete("b"),i+=l+o}),n.delete("a",2),n.delete("b",void 0),!e.toJSON||!n.has("a",1)||n.has("a",2)||!n.has("a",void 0)||n.has("b")||!t.size&&!0||!t.sort||e.href!=="https://a/c%20d?a=1&c=3"||t.get("c")!=="3"||String(new URLSearchParams("?a=1"))!=="a=1"||!t[wne]||new URL("https://a@b").username!=="a"||new URLSearchParams(new URLSearchParams("a=b")).get("a")!=="b"||new URL("https://").host!=="xn--e1aybc"||new URL("https://a#").hash!=="#%D0%B1"||i!=="a1c3"||new URL("https://x",void 0).host!=="x"}),bne=Ul,cC=Yt,mL=Q,lC=hk,Sne=Qr,SE=Se,Co=N,Jf=De,gL=bE,_L=Ul,Cne=pE,Tne=function(e,t,n){for(var i in t)n&&n.unsafe&&e[i]?e[i]=t[i]:bne(e,i,t[i],n);return e},Rne=Vc,Ine=bS,AC=od,EL=CS,dC=ue,Nne=hs,One=Bl,xne=Ll,Dne=Si,vL=ut,Ri=Ci,Bne=Vf,yL=Nt,wL=pS,kne=sE,CE=uE,sh=cd,Lne=rL,Une=sr("iterator"),ih="URLSearchParams",bL=ih+"Iterator",SL=AC.set,Va=AC.getterFor(ih),Pne=AC.getterFor(bL),CL=lC("fetch"),TE=lC("Request"),$f=lC("Headers"),uC=TE&&TE.prototype,TL=$f&&$f.prototype,Mne=mL.TypeError,Fne=mL.encodeURIComponent,jne=String.fromCharCode,Vne=Sne("String","fromCodePoint"),Qne=parseInt,RE=Co("".charAt),RL=Co([].join),jl=Co([].push),IL=Co("".replace),Hne=Co([].shift),NL=Co([].splice),OL=Co("".split),xL=Co("".slice),Gne=Co(/./.exec),Kne=/\+/g,Wne=/^[0-9a-f]+$/i,DL=function(e,t){var n=xL(e,t,t+2);return Gne(Wne,n)?Qne(n,16):NaN},Yne=function(e){for(var t=0,n=128;n>0&&e&n;n>>=1)t++;return t},zne=function(e){var t=null;switch(e.length){case 1:t=e[0];break;case 2:t=(31&e[0])<<6|63&e[1];break;case 3:t=(15&e[0])<<12|(63&e[1])<<6|63&e[2];break;case 4:t=(7&e[0])<<18|(63&e[1])<<12|(63&e[2])<<6|63&e[3]}return t>1114111?null:t},BL=function(e){for(var t=(e=IL(e,Kne," ")).length,n="",i=0;i<t;){var o=RE(e,i);if(o==="%"){if(RE(e,i+1)==="%"||i+3>t){n+="%",i++;continue}var l=DL(e,i+1);if(l!=l){n+=o,i++;continue}i+=2;var d=Yne(l);if(d===0)o=jne(l);else{if(d===1||d>4){n+="",i++;continue}for(var h=[l],f=1;f<d&&!(++i+3>t||RE(e,i)!=="%");){var g=DL(e,i+1);if(g!=g){i+=3;break}if(g>191||g<128)break;jl(h,g),i+=2,f++}if(h.length!==d){n+="";continue}var _=zne(h);_===null?n+="":o=Vne(_)}}n+=o,i++}return n},qne=/[!'()~]|%20/g,Xne={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},Jne=function(e){return Xne[e]},kL=function(e){return IL(Fne(e),qne,Jne)},hC=Ine(function(e,t){SL(this,{type:bL,target:Va(e).entries,index:0,kind:t})},ih,function(){var e=Pne(this),t=e.target,n=e.index++;if(!t||n>=t.length)return e.target=null,CE(void 0,!0);var i=t[n];switch(e.kind){case"keys":return CE(i.key,!1);case"values":return CE(i.value,!1)}return CE([i.key,i.value],!1)},!0),LL=function(e){this.entries=[],this.url=null,e!==void 0&&(vL(e)?this.parseObject(e):this.parseQuery(typeof e=="string"?RE(e,0)==="?"?xL(e,1):e:Ri(e)))};LL.prototype={type:ih,bindURL:function(e){this.url=e,this.update()},parseObject:function(e){var t,n,i,o,l,d,h,f=this.entries,g=kne(e);if(g)for(n=(t=wL(e,g)).next;!(i=SE(n,t)).done;){if(l=(o=wL(Dne(i.value))).next,(d=SE(l,o)).done||(h=SE(l,o)).done||!SE(l,o).done)throw new Mne("Expected sequence with length 2");jl(f,{key:Ri(d.value),value:Ri(h.value)})}else for(var _ in e)Nne(e,_)&&jl(f,{key:_,value:Ri(e[_])})},parseQuery:function(e){if(e)for(var t,n,i=this.entries,o=OL(e,"&"),l=0;l<o.length;)(t=o[l++]).length&&(n=OL(t,"="),jl(i,{key:BL(Hne(n)),value:BL(RL(n,"="))}))},serialize:function(){for(var e,t=this.entries,n=[],i=0;i<t.length;)e=t[i++],jl(n,kL(e.key)+"="+kL(e.value));return RL(n,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var IE=function(){EL(this,ah);var e=SL(this,new LL(arguments.length>0?arguments[0]:void 0));Jf||(this.size=e.entries.length)},ah=IE.prototype;if(Tne(ah,{append:function(e,t){var n=Va(this);sh(arguments.length,2),jl(n.entries,{key:Ri(e),value:Ri(t)}),Jf||this.length++,n.updateURL()},delete:function(e){for(var t=Va(this),n=sh(arguments.length,1),i=t.entries,o=Ri(e),l=n<2?void 0:arguments[1],d=l===void 0?l:Ri(l),h=0;h<i.length;){var f=i[h];if(f.key!==o||d!==void 0&&f.value!==d)h++;else if(NL(i,h,1),d!==void 0)break}Jf||(this.size=i.length),t.updateURL()},get:function(e){var t=Va(this).entries;sh(arguments.length,1);for(var n=Ri(e),i=0;i<t.length;i++)if(t[i].key===n)return t[i].value;return null},getAll:function(e){var t=Va(this).entries;sh(arguments.length,1);for(var n=Ri(e),i=[],o=0;o<t.length;o++)t[o].key===n&&jl(i,t[o].value);return i},has:function(e){for(var t=Va(this).entries,n=sh(arguments.length,1),i=Ri(e),o=n<2?void 0:arguments[1],l=o===void 0?o:Ri(o),d=0;d<t.length;){var h=t[d++];if(h.key===i&&(l===void 0||h.value===l))return!0}return!1},set:function(e,t){var n=Va(this);sh(arguments.length,1);for(var i,o=n.entries,l=!1,d=Ri(e),h=Ri(t),f=0;f<o.length;f++)(i=o[f]).key===d&&(l?NL(o,f--,1):(l=!0,i.value=h));l||jl(o,{key:d,value:h}),Jf||(this.size=o.length),n.updateURL()},sort:function(){var e=Va(this);Lne(e.entries,function(t,n){return t.key>n.key?1:-1}),e.updateURL()},forEach:function(e){for(var t,n=Va(this).entries,i=One(e,arguments.length>1?arguments[1]:void 0),o=0;o<n.length;)i((t=n[o++]).value,t.key,this)},keys:function(){return new hC(this,"keys")},values:function(){return new hC(this,"values")},entries:function(){return new hC(this,"entries")}},{enumerable:!0}),_L(ah,Une,ah.entries,{}),_L(ah,"toString",function(){return Va(this).serialize()},{enumerable:!0}),Jf&&Cne(ah,"size",{get:function(){return Va(this).entries.length},configurable:!0,enumerable:!0}),Rne(IE,ih),cC({global:!0,forced:!gL},{URLSearchParams:IE}),!gL&&dC($f)){var $ne=Co(TL.has),Zne=Co(TL.set),UL=function(e){if(vL(e)){var t,n=e.body;if(xne(n)===ih)return t=e.headers?new $f(e.headers):new $f,$ne(t,"content-type")||Zne(t,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),Bne(e,{body:yL(0,Ri(n)),headers:yL(0,t)})}return e};if(dC(CL)&&cC({global:!0,dontCallGetSet:!0,forced:!0},{fetch:function(e){return CL(e,arguments.length>1?UL(arguments[1]):{})}}),dC(TE)){var pC=function(e){return EL(this,uC),new TE(e,arguments.length>1?UL(arguments[1]):{})};uC.constructor=pC,pC.prototype=uC,cC({global:!0,dontCallGetSet:!0,forced:!0},{Request:pC})}}var Qa,ere={URLSearchParams:IE,getState:Va},tre=Ot.URLSearchParams,PL=De,nre=N,rre=Se,sre=u,fC=tE,ire=jf,are=Qe,ore=ic,cre=yt,oh=Object.assign,ML=Object.defineProperty,lre=nre([].concat),Are=!oh||sre(function(){if(PL&&oh({b:1},oh(ML({},"a",{enumerable:!0,get:function(){ML(this,"b",{value:3,enumerable:!1})}}),{b:2})).b!==1)return!0;var e={},t={},n=Symbol("assign detection"),i="abcdefghijklmnopqrst";return e[n]=7,i.split("").forEach(function(o){t[o]=o}),oh({},e)[n]!==7||fC(oh({},t)).join("")!==i})?function(e,t){for(var n=ore(e),i=arguments.length,o=1,l=ire.f,d=are.f;i>o;)for(var h,f=cre(arguments[o++]),g=l?lre(fC(f),l(f)):fC(f),_=g.length,v=0;_>v;)h=g[v++],PL&&!rre(d,f,h)||(n[h]=f[h]);return n}:oh,dre=Si,ure=S1,hre=De,pre=ja,fre=Nt,mC=function(e,t,n){hre?pre.f(e,t,fre(0,n)):e[t]=n},mre=Bl,gre=Se,_re=ic,Ere=function(e,t,n,i){try{return i?t(dre(n)[0],n[1]):t(n)}catch(o){ure(e,"throw",o)}},vre=y1,yre=fE,wre=kl,FL=mC,bre=pS,Sre=sE,jL=Array,dd=N,gC=2147483647,Cre=/[^\0-\u007E]/,VL=/[.\u3002\uFF0E\uFF61]/g,QL="Overflow: input needs wider integers to process",HL=RangeError,Tre=dd(VL.exec),ch=Math.floor,_C=String.fromCharCode,GL=dd("".charCodeAt),KL=dd([].join),Vl=dd([].push),Rre=dd("".replace),Ire=dd("".split),Nre=dd("".toLowerCase),WL=function(e){return e+22+75*(e<26)},Ore=function(e,t,n){var i=0;for(e=n?ch(e/700):e>>1,e+=ch(e/t);e>455;)e=ch(e/35),i+=36;return ch(i+36*e/(e+38))},xre=function(e){var t=[];e=function(U){for(var j=[],G=0,$=U.length;G<$;){var Z=GL(U,G++);if(Z>=55296&&Z<=56319&&G<$){var X=GL(U,G++);(64512&X)==56320?Vl(j,((1023&Z)<<10)+(1023&X)+65536):(Vl(j,Z),G--)}else Vl(j,Z)}return j}(e);var n,i,o=e.length,l=128,d=0,h=72;for(n=0;n<e.length;n++)(i=e[n])<128&&Vl(t,_C(i));var f=t.length,g=f;for(f&&Vl(t,"-");g<o;){var _=gC;for(n=0;n<e.length;n++)(i=e[n])>=l&&i<_&&(_=i);var v=g+1;if(_-l>ch((gC-d)/v))throw new HL(QL);for(d+=(_-l)*v,l=_,n=0;n<e.length;n++){if((i=e[n])<l&&++d>gC)throw new HL(QL);if(i===l){for(var y=d,b=36;;){var D=b<=h?1:b>=h+26?26:b-h;if(y<D)break;var I=y-D,O=36-D;Vl(t,_C(WL(D+I%O))),y=ch(I/O),b+=36}Vl(t,_C(WL(y))),h=Ore(d,v,g===f),d=0,g++}}d++,l++}return KL(t,"")},Dre=Yt,EC=De,Bre=bE,vC=Q,YL=Bl,Ha=N,NE=Ul,Ga=pE,kre=CS,yC=hs,wC=Are,lh=function(e){var t=_re(e),n=yre(this),i=arguments.length,o=i>1?arguments[1]:void 0,l=o!==void 0;l&&(o=mre(o,i>2?arguments[2]:void 0));var d,h,f,g,_,v,y=Sre(t),b=0;if(!y||this===jL&&vre(y))for(d=wre(t),h=n?new this(d):jL(d);d>b;b++)v=l?o(t[b],b):t[b],FL(h,b,v);else for(h=n?new this:[],_=(g=bre(t,y)).next;!(f=gre(_,g)).done;b++)v=l?Ere(g,o,[f.value,b],!0):f.value,FL(h,b,v);return h.length=b,h},To=Pl,Lre=nC.codeAt,Ure=function(e){var t,n,i=[],o=Ire(Rre(Nre(e),VL,"."),".");for(t=0;t<o.length;t++)n=o[t],Vl(i,Tre(Cre,n)?"xn--"+xre(n):n);return KL(i,".")},Qc=Ci,Pre=Vc,Mre=cd,zL=ere,qL=od,Fre=qL.set,OE=qL.getterFor("URL"),jre=zL.URLSearchParams,Vre=zL.getState,Zf=vC.URL,bC=vC.TypeError,xE=vC.parseInt,Qre=Math.floor,XL=Math.pow,Ka=Ha("".charAt),Ro=Ha(/./.exec),em=Ha([].join),Hre=Ha(1.1.toString),Gre=Ha([].pop),Ah=Ha([].push),SC=Ha("".replace),Kre=Ha([].shift),Wre=Ha("".split),tm=Ha("".slice),DE=Ha("".toLowerCase),Yre=Ha([].unshift),CC="Invalid scheme",ud="Invalid host",JL="Invalid port",$L=/[a-z]/i,zre=/[\d+-.a-z]/i,TC=/\d/,qre=/^0x/i,Xre=/^[0-7]+$/,Jre=/^\d+$/,ZL=/^[\da-f]+$/i,$re=/[\0\t\n\r #%/:<>?@[\\\]^|]/,Zre=/[\0\t\n\r #/:<>?@[\\\]^|]/,ese=/^[\u0000-\u0020]+/,tse=/(^|[^\u0000-\u0020])[\u0000-\u0020]+$/,nse=/[\t\n\r]/g,nm=function(e){var t,n,i,o;if(typeof e=="number"){for(t=[],n=0;n<4;n++)Yre(t,e%256),e=Qre(e/256);return em(t,".")}if(typeof e=="object"){for(t="",i=function(l){for(var d=null,h=1,f=null,g=0,_=0;_<8;_++)l[_]!==0?(g>h&&(d=f,h=g),f=null,g=0):(f===null&&(f=_),++g);return g>h?f:d}(e),n=0;n<8;n++)o&&e[n]===0||(o&&(o=!1),i===n?(t+=n?":":"::",o=!0):(t+=Hre(e[n],16),n<7&&(t+=":")));return"["+t+"]"}return e},BE={},eU=wC({},BE,{" ":1,'"':1,"<":1,">":1,"`":1}),tU=wC({},eU,{"#":1,"?":1,"{":1,"}":1}),RC=wC({},tU,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),Ql=function(e,t){var n=Lre(e,0);return n>32&&n<127&&!yC(t,e)?e:encodeURIComponent(e)},kE={ftp:21,file:null,http:80,https:443,ws:80,wss:443},rm=function(e,t){var n;return e.length===2&&Ro($L,Ka(e,0))&&((n=Ka(e,1))===":"||!t&&n==="|")},nU=function(e){var t;return e.length>1&&rm(tm(e,0,2))&&(e.length===2||(t=Ka(e,2))==="/"||t==="\\"||t==="?"||t==="#")},rse=function(e){return e==="."||DE(e)==="%2e"},IC={},rU={},NC={},sU={},iU={},OC={},aU={},oU={},LE={},UE={},xC={},DC={},BC={},kC={},cU={},LC={},dh={},cc={},lU={},hd={},Hc={},UC=function(e,t,n){var i,o,l,d=Qc(e);if(t){if(o=this.parse(d))throw new bC(o);this.searchParams=null}else{if(n!==void 0&&(i=new UC(n,!0)),o=this.parse(d,null,i))throw new bC(o);(l=Vre(new jre)).bindURL(this),this.searchParams=l}};UC.prototype={type:"URL",parse:function(e,t,n){var i,o,l,d,h,f=this,g=t||IC,_=0,v="",y=!1,b=!1,D=!1;for(e=Qc(e),t||(f.scheme="",f.username="",f.password="",f.host=null,f.port=null,f.path=[],f.query=null,f.fragment=null,f.cannotBeABaseURL=!1,e=SC(e,ese,""),e=SC(e,tse,"$1")),e=SC(e,nse,""),i=lh(e);_<=i.length;){switch(o=i[_],g){case IC:if(!o||!Ro($L,o)){if(t)return CC;g=NC;continue}v+=DE(o),g=rU;break;case rU:if(o&&(Ro(zre,o)||o==="+"||o==="-"||o==="."))v+=DE(o);else{if(o!==":"){if(t)return CC;v="",g=NC,_=0;continue}if(t&&(f.isSpecial()!==yC(kE,v)||v==="file"&&(f.includesCredentials()||f.port!==null)||f.scheme==="file"&&!f.host))return;if(f.scheme=v,t)return void(f.isSpecial()&&kE[f.scheme]===f.port&&(f.port=null));v="",f.scheme==="file"?g=kC:f.isSpecial()&&n&&n.scheme===f.scheme?g=sU:f.isSpecial()?g=oU:i[_+1]==="/"?(g=iU,_++):(f.cannotBeABaseURL=!0,Ah(f.path,""),g=lU)}break;case NC:if(!n||n.cannotBeABaseURL&&o!=="#")return CC;if(n.cannotBeABaseURL&&o==="#"){f.scheme=n.scheme,f.path=To(n.path),f.query=n.query,f.fragment="",f.cannotBeABaseURL=!0,g=Hc;break}g=n.scheme==="file"?kC:OC;continue;case sU:if(o!=="/"||i[_+1]!=="/"){g=OC;continue}g=LE,_++;break;case iU:if(o==="/"){g=UE;break}g=cc;continue;case OC:if(f.scheme=n.scheme,o===Qa)f.username=n.username,f.password=n.password,f.host=n.host,f.port=n.port,f.path=To(n.path),f.query=n.query;else if(o==="/"||o==="\\"&&f.isSpecial())g=aU;else if(o==="?")f.username=n.username,f.password=n.password,f.host=n.host,f.port=n.port,f.path=To(n.path),f.query="",g=hd;else{if(o!=="#"){f.username=n.username,f.password=n.password,f.host=n.host,f.port=n.port,f.path=To(n.path),f.path.length--,g=cc;continue}f.username=n.username,f.password=n.password,f.host=n.host,f.port=n.port,f.path=To(n.path),f.query=n.query,f.fragment="",g=Hc}break;case aU:if(!f.isSpecial()||o!=="/"&&o!=="\\"){if(o!=="/"){f.username=n.username,f.password=n.password,f.host=n.host,f.port=n.port,g=cc;continue}g=UE}else g=LE;break;case oU:if(g=LE,o!=="/"||Ka(v,_+1)!=="/")continue;_++;break;case LE:if(o!=="/"&&o!=="\\"){g=UE;continue}break;case UE:if(o==="@"){y&&(v="%40"+v),y=!0,l=lh(v);for(var I=0;I<l.length;I++){var O=l[I];if(O!==":"||D){var U=Ql(O,RC);D?f.password+=U:f.username+=U}else D=!0}v=""}else if(o===Qa||o==="/"||o==="?"||o==="#"||o==="\\"&&f.isSpecial()){if(y&&v==="")return"Invalid authority";_-=lh(v).length+1,v="",g=xC}else v+=o;break;case xC:case DC:if(t&&f.scheme==="file"){g=LC;continue}if(o!==":"||b){if(o===Qa||o==="/"||o==="?"||o==="#"||o==="\\"&&f.isSpecial()){if(f.isSpecial()&&v==="")return ud;if(t&&v===""&&(f.includesCredentials()||f.port!==null))return;if(d=f.parseHost(v))return d;if(v="",g=dh,t)return;continue}o==="["?b=!0:o==="]"&&(b=!1),v+=o}else{if(v==="")return ud;if(d=f.parseHost(v))return d;if(v="",g=BC,t===DC)return}break;case BC:if(!Ro(TC,o)){if(o===Qa||o==="/"||o==="?"||o==="#"||o==="\\"&&f.isSpecial()||t){if(v!==""){var j=xE(v,10);if(j>65535)return JL;f.port=f.isSpecial()&&j===kE[f.scheme]?null:j,v=""}if(t)return;g=dh;continue}return JL}v+=o;break;case kC:if(f.scheme="file",o==="/"||o==="\\")g=cU;else{if(!n||n.scheme!=="file"){g=cc;continue}switch(o){case Qa:f.host=n.host,f.path=To(n.path),f.query=n.query;break;case"?":f.host=n.host,f.path=To(n.path),f.query="",g=hd;break;case"#":f.host=n.host,f.path=To(n.path),f.query=n.query,f.fragment="",g=Hc;break;default:nU(em(To(i,_),""))||(f.host=n.host,f.path=To(n.path),f.shortenPath()),g=cc;continue}}break;case cU:if(o==="/"||o==="\\"){g=LC;break}n&&n.scheme==="file"&&!nU(em(To(i,_),""))&&(rm(n.path[0],!0)?Ah(f.path,n.path[0]):f.host=n.host),g=cc;continue;case LC:if(o===Qa||o==="/"||o==="\\"||o==="?"||o==="#"){if(!t&&rm(v))g=cc;else if(v===""){if(f.host="",t)return;g=dh}else{if(d=f.parseHost(v))return d;if(f.host==="localhost"&&(f.host=""),t)return;v="",g=dh}continue}v+=o;break;case dh:if(f.isSpecial()){if(g=cc,o!=="/"&&o!=="\\")continue}else if(t||o!=="?")if(t||o!=="#"){if(o!==Qa&&(g=cc,o!=="/"))continue}else f.fragment="",g=Hc;else f.query="",g=hd;break;case cc:if(o===Qa||o==="/"||o==="\\"&&f.isSpecial()||!t&&(o==="?"||o==="#")){if((h=DE(h=v))===".."||h==="%2e."||h===".%2e"||h==="%2e%2e"?(f.shortenPath(),o==="/"||o==="\\"&&f.isSpecial()||Ah(f.path,"")):rse(v)?o==="/"||o==="\\"&&f.isSpecial()||Ah(f.path,""):(f.scheme==="file"&&!f.path.length&&rm(v)&&(f.host&&(f.host=""),v=Ka(v,0)+":"),Ah(f.path,v)),v="",f.scheme==="file"&&(o===Qa||o==="?"||o==="#"))for(;f.path.length>1&&f.path[0]==="";)Kre(f.path);o==="?"?(f.query="",g=hd):o==="#"&&(f.fragment="",g=Hc)}else v+=Ql(o,tU);break;case lU:o==="?"?(f.query="",g=hd):o==="#"?(f.fragment="",g=Hc):o!==Qa&&(f.path[0]+=Ql(o,BE));break;case hd:t||o!=="#"?o!==Qa&&(o==="'"&&f.isSpecial()?f.query+="%27":f.query+=o==="#"?"%23":Ql(o,BE)):(f.fragment="",g=Hc);break;case Hc:o!==Qa&&(f.fragment+=Ql(o,eU))}_++}},parseHost:function(e){var t,n,i;if(Ka(e,0)==="["){if(Ka(e,e.length-1)!=="]"||(t=function(o){var l,d,h,f,g,_,v,y=[0,0,0,0,0,0,0,0],b=0,D=null,I=0,O=function(){return Ka(o,I)};if(O()===":"){if(Ka(o,1)!==":")return;I+=2,D=++b}for(;O();){if(b===8)return;if(O()!==":"){for(l=d=0;d<4&&Ro(ZL,O());)l=16*l+xE(O(),16),I++,d++;if(O()==="."){if(d===0||(I-=d,b>6))return;for(h=0;O();){if(f=null,h>0){if(!(O()==="."&&h<4))return;I++}if(!Ro(TC,O()))return;for(;Ro(TC,O());){if(g=xE(O(),10),f===null)f=g;else{if(f===0)return;f=10*f+g}if(f>255)return;I++}y[b]=256*y[b]+f,++h!=2&&h!==4||b++}if(h!==4)return;break}if(O()===":"){if(I++,!O())return}else if(O())return;y[b++]=l}else{if(D!==null)return;I++,D=++b}}if(D!==null)for(_=b-D,b=7;b!==0&&_>0;)v=y[b],y[b--]=y[D+_-1],y[D+--_]=v;else if(b!==8)return;return y}(tm(e,1,-1)),!t))return ud;this.host=t}else if(this.isSpecial()){if(e=Ure(e),Ro($re,e)||(t=function(o){var l,d,h,f,g,_,v,y=Wre(o,".");if(y.length&&y[y.length-1]===""&&y.length--,(l=y.length)>4)return o;for(d=[],h=0;h<l;h++){if((f=y[h])==="")return o;if(g=10,f.length>1&&Ka(f,0)==="0"&&(g=Ro(qre,f)?16:8,f=tm(f,g===8?1:2)),f==="")_=0;else{if(!Ro(g===10?Jre:g===8?Xre:ZL,f))return o;_=xE(f,g)}Ah(d,_)}for(h=0;h<l;h++)if(_=d[h],h===l-1){if(_>=XL(256,5-l))return null}else if(_>255)return null;for(v=Gre(d),h=0;h<d.length;h++)v+=d[h]*XL(256,3-h);return v}(e),t===null))return ud;this.host=t}else{if(Ro(Zre,e))return ud;for(t="",n=lh(e),i=0;i<n.length;i++)t+=Ql(n[i],BE);this.host=t}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||this.scheme==="file"},includesCredentials:function(){return this.username!==""||this.password!==""},isSpecial:function(){return yC(kE,this.scheme)},shortenPath:function(){var e=this.path,t=e.length;!t||this.scheme==="file"&&t===1&&rm(e[0],!0)||e.length--},serialize:function(){var e=this,t=e.scheme,n=e.username,i=e.password,o=e.host,l=e.port,d=e.path,h=e.query,f=e.fragment,g=t+":";return o!==null?(g+="//",e.includesCredentials()&&(g+=n+(i?":"+i:"")+"@"),g+=nm(o),l!==null&&(g+=":"+l)):t==="file"&&(g+="//"),g+=e.cannotBeABaseURL?d[0]:d.length?"/"+em(d,"/"):"",h!==null&&(g+="?"+h),f!==null&&(g+="#"+f),g},setHref:function(e){var t=this.parse(e);if(t)throw new bC(t);this.searchParams.update()},getOrigin:function(){var e=this.scheme,t=this.port;if(e==="blob")try{return new uh(e.path[0]).origin}catch{return"null"}return e!=="file"&&this.isSpecial()?e+"://"+nm(this.host)+(t!==null?":"+t:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(e){this.parse(Qc(e)+":",IC)},getUsername:function(){return this.username},setUsername:function(e){var t=lh(Qc(e));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var n=0;n<t.length;n++)this.username+=Ql(t[n],RC)}},getPassword:function(){return this.password},setPassword:function(e){var t=lh(Qc(e));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var n=0;n<t.length;n++)this.password+=Ql(t[n],RC)}},getHost:function(){var e=this.host,t=this.port;return e===null?"":t===null?nm(e):nm(e)+":"+t},setHost:function(e){this.cannotBeABaseURL||this.parse(e,xC)},getHostname:function(){var e=this.host;return e===null?"":nm(e)},setHostname:function(e){this.cannotBeABaseURL||this.parse(e,DC)},getPort:function(){var e=this.port;return e===null?"":Qc(e)},setPort:function(e){this.cannotHaveUsernamePasswordPort()||((e=Qc(e))===""?this.port=null:this.parse(e,BC))},getPathname:function(){var e=this.path;return this.cannotBeABaseURL?e[0]:e.length?"/"+em(e,"/"):""},setPathname:function(e){this.cannotBeABaseURL||(this.path=[],this.parse(e,dh))},getSearch:function(){var e=this.query;return e?"?"+e:""},setSearch:function(e){(e=Qc(e))===""?this.query=null:(Ka(e,0)==="?"&&(e=tm(e,1)),this.query="",this.parse(e,hd)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var e=this.fragment;return e?"#"+e:""},setHash:function(e){(e=Qc(e))!==""?(Ka(e,0)==="#"&&(e=tm(e,1)),this.fragment="",this.parse(e,Hc)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var uh=function(e){var t=kre(this,Ii),n=Mre(arguments.length,1)>1?arguments[1]:void 0,i=Fre(t,new UC(e,!1,n));EC||(t.href=i.serialize(),t.origin=i.getOrigin(),t.protocol=i.getProtocol(),t.username=i.getUsername(),t.password=i.getPassword(),t.host=i.getHost(),t.hostname=i.getHostname(),t.port=i.getPort(),t.pathname=i.getPathname(),t.search=i.getSearch(),t.searchParams=i.getSearchParams(),t.hash=i.getHash())},Ii=uh.prototype,Wa=function(e,t){return{get:function(){return OE(this)[e]()},set:t&&function(n){return OE(this)[t](n)},configurable:!0,enumerable:!0}};if(EC&&(Ga(Ii,"href",Wa("serialize","setHref")),Ga(Ii,"origin",Wa("getOrigin")),Ga(Ii,"protocol",Wa("getProtocol","setProtocol")),Ga(Ii,"username",Wa("getUsername","setUsername")),Ga(Ii,"password",Wa("getPassword","setPassword")),Ga(Ii,"host",Wa("getHost","setHost")),Ga(Ii,"hostname",Wa("getHostname","setHostname")),Ga(Ii,"port",Wa("getPort","setPort")),Ga(Ii,"pathname",Wa("getPathname","setPathname")),Ga(Ii,"search",Wa("getSearch","setSearch")),Ga(Ii,"searchParams",Wa("getSearchParams")),Ga(Ii,"hash",Wa("getHash","setHash"))),NE(Ii,"toJSON",function(){return OE(this).serialize()},{enumerable:!0}),NE(Ii,"toString",function(){return OE(this).serialize()},{enumerable:!0}),Zf){var AU=Zf.createObjectURL,dU=Zf.revokeObjectURL;AU&&NE(uh,"createObjectURL",YL(AU,Zf)),dU&&NE(uh,"revokeObjectURL",YL(dU,Zf))}Pre(uh,"URL"),Dre({global:!0,forced:!Bre,sham:!EC},{URL:uh});var sse=Yt,uU=u,ise=cd,hU=Ci,ase=bE,PC=Qr("URL"),ose=ase&&uU(function(){PC.canParse()}),cse=uU(function(){return PC.canParse.length!==1});sse({target:"URL",stat:!0,forced:!ose||cse},{canParse:function(e){var t=ise(arguments.length,1),n=hU(e),i=t<2||arguments[1]===void 0?void 0:hU(arguments[1]);try{return!!new PC(n,i)}catch{return!1}}});var lse=Yt,Ase=cd,pU=Ci,dse=bE,use=Qr("URL");lse({target:"URL",stat:!0,forced:!dse},{parse:function(e){var t=Ase(arguments.length,1),n=pU(e),i=t<2||arguments[1]===void 0?void 0:pU(arguments[1]);try{return new use(n,i)}catch{return null}}});var PE=A(Ot.URL);let fU=!0,mU=!0;function ME(e,t,n){const i=e.match(t);return i&&i.length>=n&&parseInt(i[n],10)}function pd(e,t,n){if(!e.RTCPeerConnection)return;const i=e.RTCPeerConnection.prototype,o=i.addEventListener;i.addEventListener=function(d,h){if(d!==t)return o.apply(this,arguments);const f=g=>{const _=n(g);_&&(h.handleEvent?h.handleEvent(_):h(_))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(h,f),o.apply(this,[d,f])};const l=i.removeEventListener;i.removeEventListener=function(d,h){if(d!==t||!this._eventMap||!this._eventMap[t])return l.apply(this,arguments);if(!this._eventMap[t].has(h))return l.apply(this,arguments);const f=this._eventMap[t].get(h);return this._eventMap[t].delete(h),this._eventMap[t].size===0&&delete this._eventMap[t],Object.keys(this._eventMap).length===0&&delete this._eventMap,l.apply(this,[d,f])},Object.defineProperty(i,"on"+t,{get(){return this["_on"+t]},set(d){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),d&&this.addEventListener(t,this["_on"+t]=d)},enumerable:!0,configurable:!0})}function hse(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(fU=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function pse(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(mU=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function gU(){if(typeof window=="object"){if(fU)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function MC(e,t){mU&&console.warn(e+" is deprecated, please use "+t+" instead.")}function _U(e){return Object.prototype.toString.call(e)==="[object Object]"}function EU(e){var t;return _U(e)?ca(t=Object.keys(e)).call(t,function(n,i){const o=_U(e[i]),l=o?EU(e[i]):e[i],d=o&&!Object.keys(l).length;return l===void 0||d?n:Object.assign(n,{[i]:l})},{}):e}function FC(e,t,n){t&&!n.has(t.id)&&(n.set(t.id,t),Object.keys(t).forEach(i=>{i.endsWith("Id")?FC(e,e.get(t[i]),n):i.endsWith("Ids")&&t[i].forEach(o=>{FC(e,e.get(o),n)})}))}function vU(e,t,n){const i=n?"outbound-rtp":"inbound-rtp",o=new Map;if(t===null)return o;const l=[];return e.forEach(d=>{d.type==="track"&&d.trackIdentifier===t.id&&l.push(d)}),l.forEach(d=>{e.forEach(h=>{h.type===i&&h.trackId===d.id&&FC(e,h,o)})}),o}const yU=gU;function wU(e,t){const n=e&&e.navigator;if(!n.mediaDevices)return;const i=function(d){if(typeof d!="object"||d.mandatory||d.optional)return d;const h={};return Object.keys(d).forEach(f=>{if(f==="require"||f==="advanced"||f==="mediaSource")return;const g=typeof d[f]=="object"?d[f]:{ideal:d[f]};g.exact!==void 0&&typeof g.exact=="number"&&(g.min=g.max=g.exact);const _=function(v,y){return v?v+y.charAt(0).toUpperCase()+y.slice(1):y==="deviceId"?"sourceId":y};if(g.ideal!==void 0){h.optional=h.optional||[];let v={};typeof g.ideal=="number"?(v[_("min",f)]=g.ideal,h.optional.push(v),v={},v[_("max",f)]=g.ideal,h.optional.push(v)):(v[_("",f)]=g.ideal,h.optional.push(v))}g.exact!==void 0&&typeof g.exact!="number"?(h.mandatory=h.mandatory||{},h.mandatory[_("",f)]=g.exact):["min","max"].forEach(v=>{g[v]!==void 0&&(h.mandatory=h.mandatory||{},h.mandatory[_(v,f)]=g[v])})}),d.advanced&&(h.optional=(h.optional||[]).concat(d.advanced)),h},o=function(d,h){if(t.version>=61)return h(d);if((d=JSON.parse(JSON.stringify(d)))&&typeof d.audio=="object"){const f=function(g,_,v){_ in g&&!(v in g)&&(g[v]=g[_],delete g[_])};f((d=JSON.parse(JSON.stringify(d))).audio,"autoGainControl","googAutoGainControl"),f(d.audio,"noiseSuppression","googNoiseSuppression"),d.audio=i(d.audio)}if(d&&typeof d.video=="object"){let f=d.video.facingMode;f=f&&(typeof f=="object"?f:{ideal:f});const g=t.version<66;if(f&&(f.exact==="user"||f.exact==="environment"||f.ideal==="user"||f.ideal==="environment")&&(!n.mediaDevices.getSupportedConstraints||!n.mediaDevices.getSupportedConstraints().facingMode||g)){let _;if(delete d.video.facingMode,f.exact==="environment"||f.ideal==="environment"?_=["back","rear"]:f.exact!=="user"&&f.ideal!=="user"||(_=["front"]),_)return n.mediaDevices.enumerateDevices().then(v=>{v=v.filter(b=>b.kind==="videoinput");let y=v.find(b=>_.some(D=>{var I;return me(I=b.label.toLowerCase()).call(I,D)}));return!y&&v.length&&me(_).call(_,"back")&&(y=v[v.length-1]),y&&(d.video.deviceId=f.exact?{exact:y.deviceId}:{ideal:y.deviceId}),d.video=i(d.video),yU("chrome: "+JSON.stringify(d)),h(d)})}d.video=i(d.video)}return yU("chrome: "+JSON.stringify(d)),h(d)},l=function(d){return t.version>=64?d:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[d.name]||d.name,message:d.message,constraint:d.constraint||d.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(n.getUserMedia=(function(d,h,f){o(d,g=>{n.webkitGetUserMedia(g,h,_=>{f&&f(l(_))})})}).bind(n),n.mediaDevices.getUserMedia){const d=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(h){return o(h,f=>d(f).then(g=>{if(f.audio&&!g.getAudioTracks().length||f.video&&!g.getVideoTracks().length)throw g.getTracks().forEach(_=>{_.stop()}),new DOMException("","NotFoundError");return g},g=>be.reject(l(g))))}}}function bU(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function SU(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(n){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=n)},enumerable:!0,configurable:!0});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=n=>{n.stream.addEventListener("addtrack",i=>{let o;o=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(d=>d.track&&d.track.id===i.track.id):{track:i.track};const l=new Event("track");l.track=i.track,l.receiver=o,l.transceiver={receiver:o},l.streams=[n.stream],this.dispatchEvent(l)}),n.stream.getTracks().forEach(i=>{let o;o=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(d=>d.track&&d.track.id===i.id):{track:i};const l=new Event("track");l.track=i,l.receiver=o,l.transceiver={receiver:o},l.streams=[n.stream],this.dispatchEvent(l)})},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else pd(e,"track",t=>(t.transceiver||Object.defineProperty(t,"transceiver",{value:{receiver:t.receiver}}),t))}function CU(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){const t=function(o,l){return{track:l,get dtmf(){return this._dtmf===void 0&&(l.kind==="audio"?this._dtmf=o.createDTMFSender(l):this._dtmf=null),this._dtmf},_pc:o}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const o=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(d,h){let f=o.apply(this,arguments);return f||(f=t(this,d),this._senders.push(f)),f};const l=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(d){l.apply(this,arguments);const h=this._senders.indexOf(d);h!==-1&&this._senders.splice(h,1)}}const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(o){this._senders=this._senders||[],n.apply(this,[o]),o.getTracks().forEach(l=>{this._senders.push(t(this,l))})};const i=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(o){this._senders=this._senders||[],i.apply(this,[o]),o.getTracks().forEach(l=>{const d=this._senders.find(h=>h.track===l);d&&this._senders.splice(this._senders.indexOf(d),1)})}}else if(typeof e=="object"&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){const n=t.apply(this,[]);return n.forEach(i=>i._pc=this),n},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function TU(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[n,i,o]=arguments;if(arguments.length>0&&typeof n=="function")return t.apply(this,arguments);if(t.length===0&&(arguments.length===0||typeof n!="function"))return t.apply(this,[]);const l=function(h){const f={};return h.result().forEach(g=>{const _={id:g.id,timestamp:g.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[g.type]||g.type};g.names().forEach(v=>{_[v]=g.stat(v)}),f[_.id]=_}),f},d=function(h){return new Map(Object.keys(h).map(f=>[f,h[f]]))};if(arguments.length>=2){const h=function(f){i(d(l(f)))};return t.apply(this,[h,n])}return new be((h,f)=>{t.apply(this,[function(g){h(d(l(g)))},f])}).then(i,o)}}function RU(e){if(!(typeof e=="object"&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){const n=e.RTCPeerConnection.prototype.getSenders;n&&(e.RTCPeerConnection.prototype.getSenders=function(){const o=n.apply(this,[]);return o.forEach(l=>l._pc=this),o});const i=e.RTCPeerConnection.prototype.addTrack;i&&(e.RTCPeerConnection.prototype.addTrack=function(){const o=i.apply(this,arguments);return o._pc=this,o}),e.RTCRtpSender.prototype.getStats=function(){const o=this;return this._pc.getStats().then(l=>vU(l,o.track,!0))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){const n=e.RTCPeerConnection.prototype.getReceivers;n&&(e.RTCPeerConnection.prototype.getReceivers=function(){const i=n.apply(this,[]);return i.forEach(o=>o._pc=this),i}),pd(e,"track",i=>(i.receiver._pc=i.srcElement,i)),e.RTCRtpReceiver.prototype.getStats=function(){const i=this;return this._pc.getStats().then(o=>vU(o,i.track,!1))}}if(!("getStats"in e.RTCRtpSender.prototype)||!("getStats"in e.RTCRtpReceiver.prototype))return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){const n=arguments[0];let i,o,l;return this.getSenders().forEach(d=>{d.track===n&&(i?l=!0:i=d)}),this.getReceivers().forEach(d=>(d.track===n&&(o?l=!0:o=d),d.track===n)),l||i&&o?be.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):i?i.getStats():o?o.getStats():be.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function IU(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(l=>this._shimmedLocalStreams[l][0])};const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(l,d){if(!d)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const h=t.apply(this,arguments);return this._shimmedLocalStreams[d.id]?this._shimmedLocalStreams[d.id].indexOf(h)===-1&&this._shimmedLocalStreams[d.id].push(h):this._shimmedLocalStreams[d.id]=[d,h],h};const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(l){this._shimmedLocalStreams=this._shimmedLocalStreams||{},l.getTracks().forEach(f=>{if(this.getSenders().find(_=>_.track===f))throw new DOMException("Track already exists.","InvalidAccessError")});const d=this.getSenders();n.apply(this,arguments);const h=this.getSenders().filter(f=>d.indexOf(f)===-1);this._shimmedLocalStreams[l.id]=[l].concat(h)};const i=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(l){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[l.id],i.apply(this,arguments)};const o=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(l){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},l&&Object.keys(this._shimmedLocalStreams).forEach(d=>{const h=this._shimmedLocalStreams[d].indexOf(l);h!==-1&&this._shimmedLocalStreams[d].splice(h,1),this._shimmedLocalStreams[d].length===1&&delete this._shimmedLocalStreams[d]}),o.apply(this,arguments)}}function NU(e,t){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return IU(e);const n=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){const f=n.apply(this);return this._reverseStreams=this._reverseStreams||{},f.map(g=>this._reverseStreams[g.id])};const i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(f){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},f.getTracks().forEach(g=>{if(this.getSenders().find(v=>v.track===g))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[f.id]){const g=new e.MediaStream(f.getTracks());this._streams[f.id]=g,this._reverseStreams[g.id]=f,f=g}i.apply(this,[f])};const o=e.RTCPeerConnection.prototype.removeStream;function l(f,g){let _=g.sdp;return Object.keys(f._reverseStreams||[]).forEach(v=>{const y=f._reverseStreams[v],b=f._streams[y.id];_=_.replace(new RegExp(b.id,"g"),y.id)}),new RTCSessionDescription({type:g.type,sdp:_})}e.RTCPeerConnection.prototype.removeStream=function(f){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},o.apply(this,[this._streams[f.id]||f]),delete this._reverseStreams[this._streams[f.id]?this._streams[f.id].id:f.id],delete this._streams[f.id]},e.RTCPeerConnection.prototype.addTrack=function(f,g){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const _=[].slice.call(arguments,1);if(_.length!==1||!_[0].getTracks().find(b=>b===f))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(b=>b.track===f))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const y=this._streams[g.id];if(y)y.addTrack(f),be.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const b=new e.MediaStream([f]);this._streams[g.id]=b,this._reverseStreams[b.id]=g,this.addStream(b)}return this.getSenders().find(b=>b.track===f)},["createOffer","createAnswer"].forEach(function(f){const g=e.RTCPeerConnection.prototype[f],_={[f](){const v=arguments;return arguments.length&&typeof arguments[0]=="function"?g.apply(this,[y=>{const b=l(this,y);v[0].apply(null,[b])},y=>{v[1]&&v[1].apply(null,y)},arguments[2]]):g.apply(this,arguments).then(y=>l(this,y))}};e.RTCPeerConnection.prototype[f]=_[f]});const d=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(f,g){let _=g.sdp;return Object.keys(f._reverseStreams||[]).forEach(v=>{const y=f._reverseStreams[v],b=f._streams[y.id];_=_.replace(new RegExp(y.id,"g"),b.id)}),new RTCSessionDescription({type:g.type,sdp:_})}(this,arguments[0]),d.apply(this,arguments)):d.apply(this,arguments)};const h=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){const f=h.get.apply(this);return f.type===""?f:l(this,f)}}),e.RTCPeerConnection.prototype.removeTrack=function(f){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!f._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(f._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let g;this._streams=this._streams||{},Object.keys(this._streams).forEach(_=>{this._streams[_].getTracks().find(v=>f.track===v)&&(g=this._streams[_])}),g&&(g.getTracks().length===1?this.removeStream(this._reverseStreams[g.id]):g.removeTrack(f.track),this.dispatchEvent(new Event("negotiationneeded")))}}function jC(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(n){const i=e.RTCPeerConnection.prototype[n],o={[n](){return arguments[0]=new(n==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),i.apply(this,arguments)}};e.RTCPeerConnection.prototype[n]=o[n]})}function OU(e,t){pd(e,"negotiationneeded",n=>{const i=n.target;if(!(t.version<72||i.getConfiguration&&i.getConfiguration().sdpSemantics==="plan-b")||i.signalingState==="stable")return n})}var xU=Object.freeze({__proto__:null,fixNegotiationNeeded:OU,shimAddTrackRemoveTrack:NU,shimAddTrackRemoveTrackWithNative:IU,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(typeof t=="function"?e.navigator.mediaDevices.getDisplayMedia=function(n){return t(n).then(i=>{const o=n.video&&n.video.width,l=n.video&&n.video.height,d=n.video&&n.video.frameRate;return n.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:i,maxFrameRate:d||3}},o&&(n.video.mandatory.maxWidth=o),l&&(n.video.mandatory.maxHeight=l),e.navigator.mediaDevices.getUserMedia(n)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))},shimGetSendersWithDtmf:CU,shimGetStats:TU,shimGetUserMedia:wU,shimMediaStream:bU,shimOnTrack:SU,shimPeerConnection:jC,shimSenderReceiverGetStats:RU});function DU(e,t){const n=e&&e.navigator,i=e&&e.MediaStreamTrack;if(n.getUserMedia=function(o,l,d){MC("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(o).then(l,d)},!(t.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){const o=function(d,h,f){h in d&&!(f in d)&&(d[f]=d[h],delete d[h])},l=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(d){return typeof d=="object"&&typeof d.audio=="object"&&(d=JSON.parse(JSON.stringify(d)),o(d.audio,"autoGainControl","mozAutoGainControl"),o(d.audio,"noiseSuppression","mozNoiseSuppression")),l(d)},i&&i.prototype.getSettings){const d=i.prototype.getSettings;i.prototype.getSettings=function(){const h=d.apply(this,arguments);return o(h,"mozAutoGainControl","autoGainControl"),o(h,"mozNoiseSuppression","noiseSuppression"),h}}if(i&&i.prototype.applyConstraints){const d=i.prototype.applyConstraints;i.prototype.applyConstraints=function(h){return this.kind==="audio"&&typeof h=="object"&&(h=JSON.parse(JSON.stringify(h)),o(h,"autoGainControl","mozAutoGainControl"),o(h,"noiseSuppression","mozNoiseSuppression")),d.apply(this,[h])}}}}function BU(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function VC(e,t){if(typeof e!="object"||!e.RTCPeerConnection&&!e.mozRTCPeerConnection)return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(o){const l=e.RTCPeerConnection.prototype[o],d={[o](){return arguments[0]=new(o==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),l.apply(this,arguments)}};e.RTCPeerConnection.prototype[o]=d[o]});const n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},i=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[o,l,d]=arguments;return i.apply(this,[o||null]).then(h=>{if(t.version<53&&!l)try{h.forEach(f=>{f.type=n[f.type]||f.type})}catch(f){if(f.name!=="TypeError")throw f;h.forEach((g,_)=>{h.set(_,Object.assign({},g,{type:n[g.type]||g.type}))})}return h}).then(l,d)}}function kU(e){if(typeof e!="object"||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const i=t.apply(this,[]);return i.forEach(o=>o._pc=this),i});const n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){const i=n.apply(this,arguments);return i._pc=this,i}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):be.resolve(new Map)}}function LU(e){if(typeof e!="object"||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const n=t.apply(this,[]);return n.forEach(i=>i._pc=this),n}),pd(e,"track",n=>(n.receiver._pc=n.srcElement,n)),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function UU(e){e.RTCPeerConnection&&!("removeStream"in e.RTCPeerConnection.prototype)&&(e.RTCPeerConnection.prototype.removeStream=function(t){MC("removeStream","removeTrack"),this.getSenders().forEach(n=>{var i;n.track&&me(i=t.getTracks()).call(i,n.track)&&this.removeTrack(n)})})}function PU(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function MU(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let n=arguments[1]&&arguments[1].sendEncodings;n===void 0&&(n=[]),n=[...n];const i=n.length>0;i&&n.forEach(l=>{if("rid"in l&&!/^[a-z0-9]{0,16}$/i.test(l.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in l&&!(parseFloat(l.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in l&&!(parseFloat(l.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const o=t.apply(this,arguments);if(i){const{sender:l}=o,d=l.getParameters();(!("encodings"in d)||d.encodings.length===1&&Object.keys(d.encodings[0]).length===0)&&(d.encodings=n,l.sendEncodings=n,this.setParametersPromises.push(l.setParameters(d).then(()=>{delete l.sendEncodings}).catch(()=>{delete l.sendEncodings})))}return o})}function FU(e){if(typeof e!="object"||!e.RTCRtpSender)return;const t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){const n=t.apply(this,arguments);return"encodings"in n||(n.encodings=[].concat(this.sendEncodings||[{}])),n})}function jU(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?be.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}function VU(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?be.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}var QU=Object.freeze({__proto__:null,shimAddTransceiver:MU,shimCreateAnswer:VU,shimCreateOffer:jU,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(n){if(!n||!n.video){const i=new DOMException("getDisplayMedia without video constraints is undefined");return i.name="NotFoundError",i.code=8,be.reject(i)}return n.video===!0?n.video={mediaSource:t}:n.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(n)})},shimGetParameters:FU,shimGetUserMedia:DU,shimOnTrack:BU,shimPeerConnection:VC,shimRTCDataChannel:PU,shimReceiverGetStats:LU,shimRemoveStream:UU,shimSenderGetStats:kU});function HU(e){if(typeof e=="object"&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(n){var i;this._localStreams||(this._localStreams=[]),me(i=this._localStreams).call(i,n)||this._localStreams.push(n),n.getAudioTracks().forEach(o=>t.call(this,o,n)),n.getVideoTracks().forEach(o=>t.call(this,o,n))},e.RTCPeerConnection.prototype.addTrack=function(n){for(var i=arguments.length,o=new Array(i>1?i-1:0),l=1;l<i;l++)o[l-1]=arguments[l];return o&&o.forEach(d=>{var h;this._localStreams?me(h=this._localStreams).call(h,d)||this._localStreams.push(d):this._localStreams=[d]}),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(t){this._localStreams||(this._localStreams=[]);const n=this._localStreams.indexOf(t);if(n===-1)return;this._localStreams.splice(n,1);const i=t.getTracks();this.getSenders().forEach(o=>{me(i).call(i,o.track)&&this.removeTrack(o)})})}}function GU(e){if(typeof e=="object"&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(n){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=n),this.addEventListener("track",this._onaddstreampoly=i=>{i.streams.forEach(o=>{var l;if(this._remoteStreams||(this._remoteStreams=[]),me(l=this._remoteStreams).call(l,o))return;this._remoteStreams.push(o);const d=new Event("addstream");d.stream=o,this.dispatchEvent(d)})})}});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){const n=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(i){i.streams.forEach(o=>{if(n._remoteStreams||(n._remoteStreams=[]),n._remoteStreams.indexOf(o)>=0)return;n._remoteStreams.push(o);const l=new Event("addstream");l.stream=o,n.dispatchEvent(l)})}),t.apply(n,arguments)}}}function KU(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype,n=t.createOffer,i=t.createAnswer,o=t.setLocalDescription,l=t.setRemoteDescription,d=t.addIceCandidate;t.createOffer=function(f,g){const _=arguments.length>=2?arguments[2]:arguments[0],v=n.apply(this,[_]);return g?(v.then(f,g),be.resolve()):v},t.createAnswer=function(f,g){const _=arguments.length>=2?arguments[2]:arguments[0],v=i.apply(this,[_]);return g?(v.then(f,g),be.resolve()):v};let h=function(f,g,_){const v=o.apply(this,[f]);return _?(v.then(g,_),be.resolve()):v};t.setLocalDescription=h,h=function(f,g,_){const v=l.apply(this,[f]);return _?(v.then(g,_),be.resolve()):v},t.setRemoteDescription=h,h=function(f,g,_){const v=d.apply(this,[f]);return _?(v.then(g,_),be.resolve()):v},t.addIceCandidate=h}function WU(e){const t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){const n=t.mediaDevices,i=n.getUserMedia.bind(n);t.mediaDevices.getUserMedia=o=>i(YU(o))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=(function(n,i,o){t.mediaDevices.getUserMedia(n).then(i,o)}).bind(t))}function YU(e){return e&&e.video!==void 0?Object.assign({},e,{video:EU(e.video)}):e}function zU(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection;e.RTCPeerConnection=function(n,i){if(n&&n.iceServers){const o=[];for(let l=0;l<n.iceServers.length;l++){let d=n.iceServers[l];!d.hasOwnProperty("urls")&&d.hasOwnProperty("url")?(MC("RTCIceServer.url","RTCIceServer.urls"),d=JSON.parse(JSON.stringify(d)),d.urls=d.url,delete d.url,o.push(d)):o.push(n.iceServers[l])}n.iceServers=o}return new t(n,i)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:()=>t.generateCertificate})}function qU(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function XU(e){const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(n){if(n){n.offerToReceiveAudio!==void 0&&(n.offerToReceiveAudio=!!n.offerToReceiveAudio);const i=this.getTransceivers().find(l=>l.receiver.track.kind==="audio");n.offerToReceiveAudio===!1&&i?i.direction==="sendrecv"?i.setDirection?i.setDirection("sendonly"):i.direction="sendonly":i.direction==="recvonly"&&(i.setDirection?i.setDirection("inactive"):i.direction="inactive"):n.offerToReceiveAudio!==!0||i||this.addTransceiver("audio",{direction:"recvonly"}),n.offerToReceiveVideo!==void 0&&(n.offerToReceiveVideo=!!n.offerToReceiveVideo);const o=this.getTransceivers().find(l=>l.receiver.track.kind==="video");n.offerToReceiveVideo===!1&&o?o.direction==="sendrecv"?o.setDirection?o.setDirection("sendonly"):o.direction="sendonly":o.direction==="recvonly"&&(o.setDirection?o.setDirection("inactive"):o.direction="inactive"):n.offerToReceiveVideo!==!0||o||this.addTransceiver("video",{direction:"recvonly"})}return t.apply(this,arguments)}}function JU(e){typeof e!="object"||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var $U=Object.freeze({__proto__:null,shimAudioContext:JU,shimCallbacksAPI:KU,shimConstraints:YU,shimCreateOfferLegacy:XU,shimGetUserMedia:WU,shimLocalStreamsAPI:HU,shimRTCIceServerUrls:zU,shimRemoteStreamsAPI:GU,shimTrackEventTransceiver:qU}),ZU=`	
\v\f\r \u2028\u2029\uFEFF`,fse=Qt,mse=Ci,QC=ZU,eP=N("".replace),gse=RegExp("^["+QC+"]+"),_se=RegExp("(^|[^"+QC+"])["+QC+"]+$"),Ese=function(e){return function(t){var n=mse(fse(t));return 1&e&&(n=eP(n,gse,"")),2&e&&(n=eP(n,_se,"$1")),n}},vse={trim:Ese(3)},yse=U1.PROPER,wse=u,tP=ZU,bse=vse.trim;Yt({target:"String",proto:!0,forced:function(e){return wse(function(){return!!tP[e]()||""[e]()!==""||yse&&tP[e].name!==e})}("trim")},{trim:function(){return bse(this)}});var Sse=oa("String","trim"),Cse=B,Tse=Sse,HC=String.prototype,Rse=function(e){var t=e.trim;return typeof e=="string"||e===HC||Cse(HC,e)&&t===HC.trim?Tse:t},ks=A(Rse),nP={exports:{}};(function(e){const t={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};t.localCName=t.generateIdentifier(),t.splitLines=function(n){return n.trim().split(`
`).map(i=>i.trim())},t.splitSections=function(n){return n.split(`
m=`).map((i,o)=>(o>0?"m="+i:i).trim()+`\r
`)},t.getDescription=function(n){const i=t.splitSections(n);return i&&i[0]},t.getMediaSections=function(n){const i=t.splitSections(n);return i.shift(),i},t.matchPrefix=function(n,i){return t.splitLines(n).filter(o=>o.indexOf(i)===0)},t.parseCandidate=function(n){let i;i=n.indexOf("a=candidate:")===0?n.substring(12).split(" "):n.substring(10).split(" ");const o={foundation:i[0],component:{1:"rtp",2:"rtcp"}[i[1]]||i[1],protocol:i[2].toLowerCase(),priority:parseInt(i[3],10),ip:i[4],address:i[4],port:parseInt(i[5],10),type:i[7]};for(let l=8;l<i.length;l+=2)switch(i[l]){case"raddr":o.relatedAddress=i[l+1];break;case"rport":o.relatedPort=parseInt(i[l+1],10);break;case"tcptype":o.tcpType=i[l+1];break;case"ufrag":o.ufrag=i[l+1],o.usernameFragment=i[l+1];break;default:o[i[l]]===void 0&&(o[i[l]]=i[l+1])}return o},t.writeCandidate=function(n){const i=[];i.push(n.foundation);const o=n.component;o==="rtp"?i.push(1):o==="rtcp"?i.push(2):i.push(o),i.push(n.protocol.toUpperCase()),i.push(n.priority),i.push(n.address||n.ip),i.push(n.port);const l=n.type;return i.push("typ"),i.push(l),l!=="host"&&n.relatedAddress&&n.relatedPort&&(i.push("raddr"),i.push(n.relatedAddress),i.push("rport"),i.push(n.relatedPort)),n.tcpType&&n.protocol.toLowerCase()==="tcp"&&(i.push("tcptype"),i.push(n.tcpType)),(n.usernameFragment||n.ufrag)&&(i.push("ufrag"),i.push(n.usernameFragment||n.ufrag)),"candidate:"+i.join(" ")},t.parseIceOptions=function(n){return n.substring(14).split(" ")},t.parseRtpMap=function(n){let i=n.substring(9).split(" ");const o={payloadType:parseInt(i.shift(),10)};return i=i[0].split("/"),o.name=i[0],o.clockRate=parseInt(i[1],10),o.channels=i.length===3?parseInt(i[2],10):1,o.numChannels=o.channels,o},t.writeRtpMap=function(n){let i=n.payloadType;n.preferredPayloadType!==void 0&&(i=n.preferredPayloadType);const o=n.channels||n.numChannels||1;return"a=rtpmap:"+i+" "+n.name+"/"+n.clockRate+(o!==1?"/"+o:"")+`\r
`},t.parseExtmap=function(n){const i=n.substring(9).split(" ");return{id:parseInt(i[0],10),direction:i[0].indexOf("/")>0?i[0].split("/")[1]:"sendrecv",uri:i[1],attributes:i.slice(2).join(" ")}},t.writeExtmap=function(n){return"a=extmap:"+(n.id||n.preferredId)+(n.direction&&n.direction!=="sendrecv"?"/"+n.direction:"")+" "+n.uri+(n.attributes?" "+n.attributes:"")+`\r
`},t.parseFmtp=function(n){const i={};let o;const l=n.substring(n.indexOf(" ")+1).split(";");for(let d=0;d<l.length;d++)o=l[d].trim().split("="),i[o[0].trim()]=o[1];return i},t.writeFmtp=function(n){let i="",o=n.payloadType;if(n.preferredPayloadType!==void 0&&(o=n.preferredPayloadType),n.parameters&&Object.keys(n.parameters).length){const l=[];Object.keys(n.parameters).forEach(d=>{n.parameters[d]!==void 0?l.push(d+"="+n.parameters[d]):l.push(d)}),i+="a=fmtp:"+o+" "+l.join(";")+`\r
`}return i},t.parseRtcpFb=function(n){const i=n.substring(n.indexOf(" ")+1).split(" ");return{type:i.shift(),parameter:i.join(" ")}},t.writeRtcpFb=function(n){let i="",o=n.payloadType;return n.preferredPayloadType!==void 0&&(o=n.preferredPayloadType),n.rtcpFeedback&&n.rtcpFeedback.length&&n.rtcpFeedback.forEach(l=>{i+="a=rtcp-fb:"+o+" "+l.type+(l.parameter&&l.parameter.length?" "+l.parameter:"")+`\r
`}),i},t.parseSsrcMedia=function(n){const i=n.indexOf(" "),o={ssrc:parseInt(n.substring(7,i),10)},l=n.indexOf(":",i);return l>-1?(o.attribute=n.substring(i+1,l),o.value=n.substring(l+1)):o.attribute=n.substring(i+1),o},t.parseSsrcGroup=function(n){const i=n.substring(13).split(" ");return{semantics:i.shift(),ssrcs:i.map(o=>parseInt(o,10))}},t.getMid=function(n){const i=t.matchPrefix(n,"a=mid:")[0];if(i)return i.substring(6)},t.parseFingerprint=function(n){const i=n.substring(14).split(" ");return{algorithm:i[0].toLowerCase(),value:i[1].toUpperCase()}},t.getDtlsParameters=function(n,i){return{role:"auto",fingerprints:t.matchPrefix(n+i,"a=fingerprint:").map(t.parseFingerprint)}},t.writeDtlsParameters=function(n,i){let o="a=setup:"+i+`\r
`;return n.fingerprints.forEach(l=>{o+="a=fingerprint:"+l.algorithm+" "+l.value+`\r
`}),o},t.parseCryptoLine=function(n){const i=n.substring(9).split(" ");return{tag:parseInt(i[0],10),cryptoSuite:i[1],keyParams:i[2],sessionParams:i.slice(3)}},t.writeCryptoLine=function(n){return"a=crypto:"+n.tag+" "+n.cryptoSuite+" "+(typeof n.keyParams=="object"?t.writeCryptoKeyParams(n.keyParams):n.keyParams)+(n.sessionParams?" "+n.sessionParams.join(" "):"")+`\r
`},t.parseCryptoKeyParams=function(n){if(n.indexOf("inline:")!==0)return null;const i=n.substring(7).split("|");return{keyMethod:"inline",keySalt:i[0],lifeTime:i[1],mkiValue:i[2]?i[2].split(":")[0]:void 0,mkiLength:i[2]?i[2].split(":")[1]:void 0}},t.writeCryptoKeyParams=function(n){return n.keyMethod+":"+n.keySalt+(n.lifeTime?"|"+n.lifeTime:"")+(n.mkiValue&&n.mkiLength?"|"+n.mkiValue+":"+n.mkiLength:"")},t.getCryptoParameters=function(n,i){return t.matchPrefix(n+i,"a=crypto:").map(t.parseCryptoLine)},t.getIceParameters=function(n,i){const o=t.matchPrefix(n+i,"a=ice-ufrag:")[0],l=t.matchPrefix(n+i,"a=ice-pwd:")[0];return o&&l?{usernameFragment:o.substring(12),password:l.substring(10)}:null},t.writeIceParameters=function(n){let i="a=ice-ufrag:"+n.usernameFragment+`\r
a=ice-pwd:`+n.password+`\r
`;return n.iceLite&&(i+=`a=ice-lite\r
`),i},t.parseRtpParameters=function(n){const i={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},o=t.splitLines(n)[0].split(" ");i.profile=o[2];for(let d=3;d<o.length;d++){const h=o[d],f=t.matchPrefix(n,"a=rtpmap:"+h+" ")[0];if(f){const g=t.parseRtpMap(f),_=t.matchPrefix(n,"a=fmtp:"+h+" ");switch(g.parameters=_.length?t.parseFmtp(_[0]):{},g.rtcpFeedback=t.matchPrefix(n,"a=rtcp-fb:"+h+" ").map(t.parseRtcpFb),i.codecs.push(g),g.name.toUpperCase()){case"RED":case"ULPFEC":i.fecMechanisms.push(g.name.toUpperCase())}}}t.matchPrefix(n,"a=extmap:").forEach(d=>{i.headerExtensions.push(t.parseExtmap(d))});const l=t.matchPrefix(n,"a=rtcp-fb:* ").map(t.parseRtcpFb);return i.codecs.forEach(d=>{l.forEach(h=>{d.rtcpFeedback.find(f=>f.type===h.type&&f.parameter===h.parameter)||d.rtcpFeedback.push(h)})}),i},t.writeRtpDescription=function(n,i){let o="";o+="m="+n+" ",o+=i.codecs.length>0?"9":"0",o+=" "+(i.profile||"UDP/TLS/RTP/SAVPF")+" ",o+=i.codecs.map(d=>d.preferredPayloadType!==void 0?d.preferredPayloadType:d.payloadType).join(" ")+`\r
`,o+=`c=IN IP4 0.0.0.0\r
`,o+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,i.codecs.forEach(d=>{o+=t.writeRtpMap(d),o+=t.writeFmtp(d),o+=t.writeRtcpFb(d)});let l=0;return i.codecs.forEach(d=>{d.maxptime>l&&(l=d.maxptime)}),l>0&&(o+="a=maxptime:"+l+`\r
`),i.headerExtensions&&i.headerExtensions.forEach(d=>{o+=t.writeExtmap(d)}),o},t.parseRtpEncodingParameters=function(n){const i=[],o=t.parseRtpParameters(n),l=o.fecMechanisms.indexOf("RED")!==-1,d=o.fecMechanisms.indexOf("ULPFEC")!==-1,h=t.matchPrefix(n,"a=ssrc:").map(y=>t.parseSsrcMedia(y)).filter(y=>y.attribute==="cname"),f=h.length>0&&h[0].ssrc;let g;const _=t.matchPrefix(n,"a=ssrc-group:FID").map(y=>y.substring(17).split(" ").map(b=>parseInt(b,10)));_.length>0&&_[0].length>1&&_[0][0]===f&&(g=_[0][1]),o.codecs.forEach(y=>{if(y.name.toUpperCase()==="RTX"&&y.parameters.apt){let b={ssrc:f,codecPayloadType:parseInt(y.parameters.apt,10)};f&&g&&(b.rtx={ssrc:g}),i.push(b),l&&(b=JSON.parse(JSON.stringify(b)),b.fec={ssrc:f,mechanism:d?"red+ulpfec":"red"},i.push(b))}}),i.length===0&&f&&i.push({ssrc:f});let v=t.matchPrefix(n,"b=");return v.length&&(v=v[0].indexOf("b=TIAS:")===0?parseInt(v[0].substring(7),10):v[0].indexOf("b=AS:")===0?1e3*parseInt(v[0].substring(5),10)*.95-16e3:void 0,i.forEach(y=>{y.maxBitrate=v})),i},t.parseRtcpParameters=function(n){const i={},o=t.matchPrefix(n,"a=ssrc:").map(h=>t.parseSsrcMedia(h)).filter(h=>h.attribute==="cname")[0];o&&(i.cname=o.value,i.ssrc=o.ssrc);const l=t.matchPrefix(n,"a=rtcp-rsize");i.reducedSize=l.length>0,i.compound=l.length===0;const d=t.matchPrefix(n,"a=rtcp-mux");return i.mux=d.length>0,i},t.writeRtcpParameters=function(n){let i="";return n.reducedSize&&(i+=`a=rtcp-rsize\r
`),n.mux&&(i+=`a=rtcp-mux\r
`),n.ssrc!==void 0&&n.cname&&(i+="a=ssrc:"+n.ssrc+" cname:"+n.cname+`\r
`),i},t.parseMsid=function(n){let i;const o=t.matchPrefix(n,"a=msid:");if(o.length===1)return i=o[0].substring(7).split(" "),{stream:i[0],track:i[1]};const l=t.matchPrefix(n,"a=ssrc:").map(d=>t.parseSsrcMedia(d)).filter(d=>d.attribute==="msid");return l.length>0?(i=l[0].value.split(" "),{stream:i[0],track:i[1]}):void 0},t.parseSctpDescription=function(n){const i=t.parseMLine(n),o=t.matchPrefix(n,"a=max-message-size:");let l;o.length>0&&(l=parseInt(o[0].substring(19),10)),isNaN(l)&&(l=65536);const d=t.matchPrefix(n,"a=sctp-port:");if(d.length>0)return{port:parseInt(d[0].substring(12),10),protocol:i.fmt,maxMessageSize:l};const h=t.matchPrefix(n,"a=sctpmap:");if(h.length>0){const f=h[0].substring(10).split(" ");return{port:parseInt(f[0],10),protocol:f[1],maxMessageSize:l}}},t.writeSctpDescription=function(n,i){let o=[];return o=n.protocol!=="DTLS/SCTP"?["m="+n.kind+" 9 "+n.protocol+" "+i.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+i.port+`\r
`]:["m="+n.kind+" 9 "+n.protocol+" "+i.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+i.port+" "+i.protocol+` 65535\r
`],i.maxMessageSize!==void 0&&o.push("a=max-message-size:"+i.maxMessageSize+`\r
`),o.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,22)},t.writeSessionBoilerplate=function(n,i,o){let l;const d=i!==void 0?i:2;return l=n||t.generateSessionId(),`v=0\r
o=`+(o||"thisisadapterortc")+" "+l+" "+d+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},t.getDirection=function(n,i){const o=t.splitLines(n);for(let l=0;l<o.length;l++)switch(o[l]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return o[l].substring(2)}return i?t.getDirection(i):"sendrecv"},t.getKind=function(n){return t.splitLines(n)[0].split(" ")[0].substring(2)},t.isRejected=function(n){return n.split(" ",2)[1]==="0"},t.parseMLine=function(n){const i=t.splitLines(n)[0].substring(2).split(" ");return{kind:i[0],port:parseInt(i[1],10),protocol:i[2],fmt:i.slice(3).join(" ")}},t.parseOLine=function(n){const i=t.matchPrefix(n,"o=")[0].substring(2).split(" ");return{username:i[0],sessionId:i[1],sessionVersion:parseInt(i[2],10),netType:i[3],addressType:i[4],address:i[5]}},t.isValidSDP=function(n){if(typeof n!="string"||n.length===0)return!1;const i=t.splitLines(n);for(let o=0;o<i.length;o++)if(i[o].length<2||i[o].charAt(1)!=="=")return!1;return!0},e.exports=t})(nP);var rP=nP.exports,hh=A(rP),Ise=a({__proto__:null,default:hh},[rP]);function FE(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;const t=e.RTCIceCandidate;e.RTCIceCandidate=function(n){if(typeof n=="object"&&n.candidate&&n.candidate.indexOf("a=")===0&&((n=JSON.parse(JSON.stringify(n))).candidate=n.candidate.substr(2)),n.candidate&&n.candidate.length){const i=new t(n),o=hh.parseCandidate(n.candidate),l=Object.assign(i,o);return l.toJSON=function(){return{candidate:l.candidate,sdpMid:l.sdpMid,sdpMLineIndex:l.sdpMLineIndex,usernameFragment:l.usernameFragment}},l}return new t(n)},e.RTCIceCandidate.prototype=t.prototype,pd(e,"icecandidate",n=>(n.candidate&&Object.defineProperty(n,"candidate",{value:new e.RTCIceCandidate(n.candidate),writable:"false"}),n))}function GC(e){!e.RTCIceCandidate||e.RTCIceCandidate&&"relayProtocol"in e.RTCIceCandidate.prototype||pd(e,"icecandidate",t=>{if(t.candidate){const n=hh.parseCandidate(t.candidate.candidate);n.type==="relay"&&(t.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[n.priority>>24])}return t})}function jE(e,t){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return this._sctp===void 0?null:this._sctp}});const n=function(h){if(!h||!h.sdp)return!1;const f=hh.splitSections(h.sdp);return f.shift(),f.some(g=>{const _=hh.parseMLine(g);return _&&_.kind==="application"&&_.protocol.indexOf("SCTP")!==-1})},i=function(h){const f=h.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(f===null||f.length<2)return-1;const g=parseInt(f[1],10);return g!=g?-1:g},o=function(h){let f=65536;return t.browser==="firefox"&&(f=t.version<57?h===-1?16384:2147483637:t.version<60?t.version===57?65535:65536:2147483637),f},l=function(h,f){let g=65536;t.browser==="firefox"&&t.version===57&&(g=65535);const _=hh.matchPrefix(h.sdp,"a=max-message-size:");return _.length>0?g=parseInt(_[0].substr(19),10):t.browser==="firefox"&&f!==-1&&(g=2147483637),g},d=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,t.browser==="chrome"&&t.version>=76){const{sdpSemantics:h}=this.getConfiguration();h==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return this._sctp===void 0?null:this._sctp},enumerable:!0,configurable:!0})}if(n(arguments[0])){const h=i(arguments[0]),f=o(h),g=l(arguments[0],h);let _;_=f===0&&g===0?Number.POSITIVE_INFINITY:f===0||g===0?Math.max(f,g):Math.min(f,g);const v={};Object.defineProperty(v,"maxMessageSize",{get:()=>_}),this._sctp=v}return d.apply(this,arguments)}}function VE(e){if(!e.RTCPeerConnection||!("createDataChannel"in e.RTCPeerConnection.prototype))return;function t(i,o){const l=i.send;i.send=function(){const d=arguments[0],h=d.length||d.size||d.byteLength;if(i.readyState==="open"&&o.sctp&&h>o.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+o.sctp.maxMessageSize+" bytes)");return l.apply(i,arguments)}}const n=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){const i=n.apply(this,arguments);return t(i,this),i},pd(e,"datachannel",i=>(t(i.channel,i.target),i))}function KC(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;const t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(n){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),n&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=n)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(n=>{const i=t[n];t[n]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=o=>{const l=o.target;if(l._lastConnectionState!==l.connectionState){l._lastConnectionState=l.connectionState;const d=new Event("connectionstatechange",o);l.dispatchEvent(d)}return o},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),i.apply(this,arguments)}})}function WC(e,t){if(!e.RTCPeerConnection||t.browser==="chrome"&&t.version>=71||t.browser==="safari"&&t.version>=605)return;const n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(i){if(i&&i.sdp&&i.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const o=i.sdp.split(`
`).filter(l=>ks(l).call(l)!=="a=extmap-allow-mixed").join(`
`);e.RTCSessionDescription&&i instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:i.type,sdp:o}):i.sdp=o}return n.apply(this,arguments)}}function QE(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const n=e.RTCPeerConnection.prototype.addIceCandidate;n&&n.length!==0&&(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(t.browser==="chrome"&&t.version<78||t.browser==="firefox"&&t.version<68||t.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?be.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),be.resolve())})}function HE(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const n=e.RTCPeerConnection.prototype.setLocalDescription;n&&n.length!==0&&(e.RTCPeerConnection.prototype.setLocalDescription=function(){let i=arguments[0]||{};if(typeof i!="object"||i.type&&i.sdp)return n.apply(this,arguments);if(i={type:i.type,sdp:i.sdp},!i.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":i.type="offer";break;default:i.type="answer"}return i.sdp||i.type!=="offer"&&i.type!=="answer"?n.apply(this,[i]):(i.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(o=>n.apply(this,[o]))})}var Nse=Object.freeze({__proto__:null,removeExtmapAllowMixed:WC,shimAddIceCandidateNullOrEmpty:QE,shimConnectionState:KC,shimMaxMessageSize:jE,shimParameterlessSetLocalDescription:HE,shimRTCIceCandidate:FE,shimRTCIceCandidateRelayProtocol:GC,shimSendThrowTypeError:VE});(function(){let{window:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const n=gU,i=function(l){const d={browser:null,version:null};if(l===void 0||!l.navigator)return d.browser="Not a browser.",d;const{navigator:h}=l;if(h.mozGetUserMedia)d.browser="firefox",d.version=ME(h.userAgent,/Firefox\/(\d+)\./,1);else if(h.webkitGetUserMedia||l.isSecureContext===!1&&l.webkitRTCPeerConnection)d.browser="chrome",d.version=ME(h.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!l.RTCPeerConnection||!h.userAgent.match(/AppleWebKit\/(\d+)\./))return d.browser="Not a supported browser.",d;d.browser="safari",d.version=ME(h.userAgent,/AppleWebKit\/(\d+)\./,1),d.supportsUnifiedPlan=l.RTCRtpTransceiver&&"currentDirection"in l.RTCRtpTransceiver.prototype}return d}(e),o={browserDetails:i,commonShim:Nse,extractVersion:ME,disableLog:hse,disableWarnings:pse,sdp:Ise};switch(i.browser){case"chrome":if(!xU||!jC||!t.shimChrome)return n("Chrome shim is not included in this adapter release."),o;if(i.version===null)return n("Chrome shim can not determine version, not shimming."),o;n("adapter.js shimming chrome."),o.browserShim=xU,QE(e,i),HE(e),wU(e,i),bU(e),jC(e,i),SU(e),NU(e,i),CU(e),TU(e),RU(e),OU(e,i),FE(e),GC(e),KC(e),jE(e,i),VE(e),WC(e,i);break;case"firefox":if(!QU||!VC||!t.shimFirefox)return n("Firefox shim is not included in this adapter release."),o;n("adapter.js shimming firefox."),o.browserShim=QU,QE(e,i),HE(e),DU(e,i),VC(e,i),BU(e),UU(e),kU(e),LU(e),PU(e),MU(e),FU(e),jU(e),VU(e),FE(e),KC(e),jE(e,i),VE(e);break;case"safari":if(!$U||!t.shimSafari)return n("Safari shim is not included in this adapter release."),o;n("adapter.js shimming safari."),o.browserShim=$U,QE(e,i),HE(e),zU(e),XU(e),KU(e),HU(e),GU(e),qU(e),WU(e),JU(e),FE(e),GC(e),jE(e,i),VE(e),WC(e,i);break;default:n("Unsupported browser!")}})({window:typeof window>"u"?void 0:window});var Ose=u,sP=Q.RegExp,xse=!Ose(function(){var e=!0;try{sP(".","d")}catch{e=!1}var t={},n="",i=e?"dgimsy":"gimsy",o=function(h,f){Object.defineProperty(t,h,{get:function(){return n+=f,!0}})},l={dotAll:"s",global:"g",ignoreCase:"i",multiline:"m",sticky:"y"};for(var d in e&&(l.hasIndices="d"),l)o(d,l[d]);return Object.getOwnPropertyDescriptor(sP.prototype,"flags").get.call(t)!==i||n!==i}),Dse=Si,Bse=Se,kse=hs,Lse=B,iP={correct:xse},Use=function(){var e=Dse(this),t="";return e.hasIndices&&(t+="d"),e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.unicodeSets&&(t+="v"),e.sticky&&(t+="y"),t},Pse=RegExp.prototype,YC=iP.correct?function(e){return e.flags}:function(e){return iP.correct||!Lse(Pse,e)||kse(e,"flags")?e.flags:Bse(Use,e)},zC=N,Mse=Math.floor,qC=zC("".charAt),Fse=zC("".replace),XC=zC("".slice),jse=/\$([$&'`]|\d{1,2})/g,Vse=Yt,Qse=Se,JC=N,aP=Qt,Hse=ue,Gse=ut,Kse=Zb,ph=Ci,Wse=Lf,Yse=YC,zse=function(e,t,n,i,o,l){var d=n+e.length,h=i.length,f=jse;return Fse(l,f,function(g,_){var v;switch(qC(_,0)){case"$":return"$";case"&":return e;case"`":return XC(t,0,n);case"'":return XC(t,d);case"<":v=o[XC(_,1,-1)];break;default:var y=+_;if(y===0)return g;if(y>h){var b=Mse(y/10);return b===0?g:b<=h?i[b-1]===void 0?qC(_,1):i[b-1]+qC(_,1):g}v=i[y-1]}return v===void 0?"":v})},qse=sr("replace"),Xse=TypeError,$C=JC("".indexOf),Jse=JC("".replace),oP=JC("".slice),$se=Math.max;Vse({target:"String",proto:!0},{replaceAll:function(e,t){var n,i,o,l,d,h,f,g,_,v,y=aP(this),b=0,D="";if(Gse(e)){if((n=Kse(e))&&(i=ph(aP(Yse(e))),!~$C(i,"g")))throw new Xse("`.replaceAll` does not allow non-global regexes");if(o=Wse(e,qse))return Qse(o,e,y,t);if(n)return Jse(ph(y),e,t)}for(l=ph(y),d=ph(e),(h=Hse(t))||(t=ph(t)),f=d.length,g=$se(1,f),_=$C(l,d);_!==-1;)v=h?ph(t(d,_,l)):zse(d,l,_,[],void 0,t),D+=oP(l,b,_)+v,b=_+f,_=_+g>l.length?-1:$C(l,d,_+g);return b<l.length&&(D+=oP(l,b)),D}});var Zse=oa("String","replaceAll"),eie=B,tie=Zse,ZC=String.prototype,nie=function(e){var t=e.replaceAll;return typeof e=="string"||e===ZC||eie(ZC,e)&&t===ZC.replaceAll?tie:t},rie=A(nie),eT=Q;Yt({global:!0,forced:eT.globalThis!==eT},{globalThis:eT});var cP=A(Q),tT={exports:{}};(function(e,t){(function(n,i){var o="function",l="undefined",d="object",h="string",f="major",g="model",_="name",v="type",y="vendor",b="version",D="architecture",I="console",O="mobile",U="tablet",j="smarttv",G="wearable",$="embedded",Z="Amazon",X="Apple",ee="ASUS",le="BlackBerry",fe="Browser",Ie="Chrome",et="Firefox",Je="Google",pt="Honor",ct="Huawei",jt="LG",bn="Microsoft",he="Motorola",ve="Nvidia",Be="OnePlus",pe="Opera",R="OPPO",H="Samsung",J="Sharp",_e="Sony",it="Xiaomi",dn="Zebra",Ir="Facebook",Ea="Chromium OS",cA="Mac OS",H0=" Browser",lp=function(or){for(var pr={},vn=0;vn<or.length;vn++)pr[or[vn].toUpperCase()]=or[vn];return pr},G0=function(or,pr){return typeof or===h&&$d(pr).indexOf($d(or))!==-1},$d=function(or){return or.toLowerCase()},ag=function(or,pr){if(typeof or===h)return or=or.replace(/^\s\s*/,""),typeof pr===l?or:or.substring(0,500)},Zd=function(or,pr){for(var vn,gi,Wo,Wn,tl,kt,Yo=0;Yo<pr.length&&!tl;){var eu=pr[Yo],Ic=pr[Yo+1];for(vn=gi=0;vn<eu.length&&!tl&&eu[vn];)if(tl=eu[vn++].exec(or))for(Wo=0;Wo<Ic.length;Wo++)kt=tl[++gi],typeof(Wn=Ic[Wo])===d&&Wn.length>0?Wn.length===2?typeof Wn[1]==o?this[Wn[0]]=Wn[1].call(this,kt):this[Wn[0]]=Wn[1]:Wn.length===3?typeof Wn[1]!==o||Wn[1].exec&&Wn[1].test?this[Wn[0]]=kt?kt.replace(Wn[1],Wn[2]):i:this[Wn[0]]=kt?Wn[1].call(this,kt,Wn[2]):i:Wn.length===4&&(this[Wn[0]]=kt?Wn[3].call(this,kt.replace(Wn[1],Wn[2])):i):this[Wn]=kt||i;Yo+=2}},lA=function(or,pr){for(var vn in pr)if(typeof pr[vn]===d&&pr[vn].length>0){for(var gi=0;gi<pr[vn].length;gi++)if(G0(pr[vn][gi],or))return vn==="?"?i:vn}else if(G0(pr[vn],or))return vn==="?"?i:vn;return pr.hasOwnProperty("*")?pr["*"]:or},JH={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},$H={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[b,[_,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[b,[_,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[_,b],[/opios[\/ ]+([\w\.]+)/i],[b,[_,pe+" Mini"]],[/\bop(?:rg)?x\/([\w\.]+)/i],[b,[_,pe+" GX"]],[/\bopr\/([\w\.]+)/i],[b,[_,pe]],[/\bb[ai]*d(?:uhd|[ub]*[aekoprswx]{5,6})[\/ ]?([\w\.]+)/i],[b,[_,"Baidu"]],[/\b(?:mxbrowser|mxios|myie2)\/?([-\w\.]*)\b/i],[b,[_,"Maxthon"]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer|sleipnir)[\/ ]?([\w\.]*)/i,/(avant|iemobile|slim(?:browser|boat|jet))[\/ ]?([\d\.]*)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|duckduckgo|klar|helio|(?=comodo_)?dragon)\/([-\w\.]+)/i,/(heytap|ovi|115)browser\/([\d\.]+)/i,/(weibo)__([\d\.]+)/i],[_,b],[/quark(?:pc)?\/([-\w\.]+)/i],[b,[_,"Quark"]],[/\bddg\/([\w\.]+)/i],[b,[_,"DuckDuckGo"]],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[b,[_,"UC"+fe]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i,/micromessenger\/([\w\.]+)/i],[b,[_,"WeChat"]],[/konqueror\/([\w\.]+)/i],[b,[_,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[b,[_,"IE"]],[/ya(?:search)?browser\/([\w\.]+)/i],[b,[_,"Yandex"]],[/slbrowser\/([\w\.]+)/i],[b,[_,"Smart Lenovo "+fe]],[/(avast|avg)\/([\w\.]+)/i],[[_,/(.+)/,"$1 Secure "+fe],b],[/\bfocus\/([\w\.]+)/i],[b,[_,et+" Focus"]],[/\bopt\/([\w\.]+)/i],[b,[_,pe+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[b,[_,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[b,[_,"Dolphin"]],[/coast\/([\w\.]+)/i],[b,[_,pe+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[b,[_,"MIUI"+H0]],[/fxios\/([\w\.-]+)/i],[b,[_,et]],[/\bqihoobrowser\/?([\w\.]*)/i],[b,[_,"360"]],[/\b(qq)\/([\w\.]+)/i],[[_,/(.+)/,"$1Browser"],b],[/(oculus|sailfish|huawei|vivo|pico)browser\/([\w\.]+)/i],[[_,/(.+)/,"$1"+H0],b],[/samsungbrowser\/([\w\.]+)/i],[b,[_,H+" Internet"]],[/metasr[\/ ]?([\d\.]+)/i],[b,[_,"Sogou Explorer"]],[/(sogou)mo\w+\/([\d\.]+)/i],[[_,"Sogou Mobile"],b],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|2345(?=browser|chrome|explorer))\w*[\/ ]?v?([\w\.]+)/i],[_,b],[/(lbbrowser|rekonq)/i,/\[(linkedin)app\]/i],[_],[/ome\/([\w\.]+) \w* ?(iron) saf/i,/ome\/([\w\.]+).+qihu (360)[es]e/i],[b,_],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[_,Ir],b],[/(Klarna)\/([\w\.]+)/i,/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/(daum)apps[\/ ]([\w\.]+)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(alipay)client\/([\w\.]+)/i,/(twitter)(?:and| f.+e\/([\w\.]+))/i,/(chromium|instagram|snapchat)[\/ ]([-\w\.]+)/i],[_,b],[/\bgsa\/([\w\.]+) .*safari\//i],[b,[_,"GSA"]],[/musical_ly(?:.+app_?version\/|_)([\w\.]+)/i],[b,[_,"TikTok"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[b,[_,Ie+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[_,Ie+" WebView"],b],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[b,[_,"Android "+fe]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[_,b],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[b,[_,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[b,_],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[_,[b,lA,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[_,b],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[_,"Netscape"],b],[/(wolvic|librewolf)\/([\w\.]+)/i],[_,b],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[b,[_,et+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(amaya|dillo|doris|icab|ladybird|lynx|mosaic|netsurf|obigo|polaris|w3m|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/\b(links) \(([\w\.]+)/i],[_,[b,/_/g,"."]],[/(cobalt)\/([\w\.]+)/i],[_,[b,/master.|lts./,""]]],cpu:[[/\b((amd|x|x86[-_]?|wow|win)64)\b/i],[[D,"amd64"]],[/(ia32(?=;))/i,/\b((i[346]|x)86)(pc)?\b/i],[[D,"ia32"]],[/\b(aarch64|arm(v?[89]e?l?|_?64))\b/i],[[D,"arm64"]],[/\b(arm(v[67])?ht?n?[fl]p?)\b/i],[[D,"armhf"]],[/( (ce|mobile); ppc;|\/[\w\.]+arm\b)/i],[[D,"arm"]],[/((ppc|powerpc)(64)?)( mac|;|\))/i],[[D,/ower/,"",$d]],[/ sun4\w[;\)]/i],[[D,"sparc"]],[/\b(avr32|ia64(?=;)|68k(?=\))|\barm(?=v([1-7]|[5-7]1)l?|;|eabi)|(irix|mips|sparc)(64)?\b|pa-risc)/i],[[D,$d]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[g,[y,H],[v,U]],[/\b((?:s[cgp]h|gt|sm)-(?![lr])\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]((?!sm-[lr])[-\w]+)/i,/sec-(sgh\w+)/i],[g,[y,H],[v,O]],[/(?:\/|\()(ip(?:hone|od)[\w, ]*)(?:\/|;)/i],[g,[y,X],[v,O]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[g,[y,X],[v,U]],[/(macintosh);/i],[g,[y,X]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[g,[y,J],[v,O]],[/\b((?:brt|eln|hey2?|gdi|jdn)-a?[lnw]09|(?:ag[rm]3?|jdn2|kob2)-a?[lw]0[09]hn)(?: bui|\)|;)/i],[g,[y,pt],[v,U]],[/honor([-\w ]+)[;\)]/i],[g,[y,pt],[v,O]],[/\b((?:ag[rs][2356]?k?|bah[234]?|bg[2o]|bt[kv]|cmr|cpn|db[ry]2?|jdn2|got|kob2?k?|mon|pce|scm|sht?|[tw]gr|vrd)-[ad]?[lw][0125][09]b?|605hw|bg2-u03|(?:gem|fdr|m2|ple|t1)-[7a]0[1-4][lu]|t1-a2[13][lw]|mediapad[\w\. ]*(?= bui|\)))\b(?!.+d\/s)/i],[g,[y,ct],[v,U]],[/(?:huawei)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[g,[y,ct],[v,O]],[/oid[^\)]+; (2[\dbc]{4}(182|283|rp\w{2})[cgl]|m2105k81a?c)(?: bui|\))/i,/\b((?:red)?mi[-_ ]?pad[\w- ]*)(?: bui|\))/i],[[g,/_/g," "],[y,it],[v,U]],[/\b(poco[\w ]+|m2\d{3}j\d\d[a-z]{2})(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/oid[^\)]+; (m?[12][0-389][01]\w{3,6}[c-y])( bui|; wv|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite|pro)?)(?: bui|\))/i,/ ([\w ]+) miui\/v?\d/i],[[g,/_/g," "],[y,it],[v,O]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[g,[y,R],[v,O]],[/\b(opd2(\d{3}a?))(?: bui|\))/i],[g,[y,lA,{OnePlus:["304","403","203"],"*":R}],[v,U]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[g,[y,"Vivo"],[v,O]],[/\b(rmx[1-3]\d{3})(?: bui|;|\))/i],[g,[y,"Realme"],[v,O]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto(?! 360)[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[g,[y,he],[v,O]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[g,[y,he],[v,U]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[g,[y,jt],[v,U]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv|watch)\w+)/i,/\blg-?([\d\w]+) bui/i],[g,[y,jt],[v,O]],[/(ideatab[-\w ]+|602lv|d-42a|a101lv|a2109a|a3500-hv|s[56]000|pb-6505[my]|tb-?x?\d{3,4}(?:f[cu]|xu|[av])|yt\d?-[jx]?\d+[lfmx])( bui|;|\)|\/)/i,/lenovo ?(b[68]0[08]0-?[hf]?|tab(?:[\w- ]+?)|tb[\w-]{6,7})( bui|;|\)|\/)/i],[g,[y,"Lenovo"],[v,U]],[/(nokia) (t[12][01])/i],[y,g,[v,U]],[/(?:maemo|nokia).*(n900|lumia \d+|rm-\d+)/i,/nokia[-_ ]?(([-\w\. ]*))/i],[[g,/_/g," "],[v,O],[y,"Nokia"]],[/(pixel (c|tablet))\b/i],[g,[y,Je],[v,U]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[g,[y,Je],[v,O]],[/droid.+; (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[g,[y,_e],[v,O]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[g,"Xperia Tablet"],[y,_e],[v,U]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[g,[y,Be],[v,O]],[/(alexa)webm/i,/(kf[a-z]{2}wi|aeo(?!bc)\w\w)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[g,[y,Z],[v,U]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[g,/(.+)/g,"Fire Phone $1"],[y,Z],[v,O]],[/(playbook);[-\w\),; ]+(rim)/i],[g,y,[v,U]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[g,[y,le],[v,O]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[g,[y,ee],[v,U]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[g,[y,ee],[v,O]],[/(nexus 9)/i],[g,[y,"HTC"],[v,U]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[y,[g,/_/g," "],[v,O]],[/droid [\w\.]+; ((?:8[14]9[16]|9(?:0(?:48|60|8[01])|1(?:3[27]|66)|2(?:6[69]|9[56])|466))[gqswx])\w*(\)| bui)/i],[g,[y,"TCL"],[v,U]],[/(itel) ((\w+))/i],[[y,$d],g,[v,lA,{tablet:["p10001l","w7001"],"*":"mobile"}]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[g,[y,"Acer"],[v,U]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[g,[y,"Meizu"],[v,O]],[/; ((?:power )?armor(?:[\w ]{0,8}))(?: bui|\))/i],[g,[y,"Ulefone"],[v,O]],[/; (energy ?\w+)(?: bui|\))/i,/; energizer ([\w ]+)(?: bui|\))/i],[g,[y,"Energizer"],[v,O]],[/; cat (b35);/i,/; (b15q?|s22 flip|s48c|s62 pro)(?: bui|\))/i],[g,[y,"Cat"],[v,O]],[/((?:new )?andromax[\w- ]+)(?: bui|\))/i],[g,[y,"Smartfren"],[v,O]],[/droid.+; (a(?:015|06[35]|142p?))/i],[g,[y,"Nothing"],[v,O]],[/; (x67 5g|tikeasy \w+|ac[1789]\d\w+)( b|\))/i,/archos ?(5|gamepad2?|([\w ]*[t1789]|hello) ?\d+[\w ]*)( b|\))/i],[g,[y,"Archos"],[v,U]],[/archos ([\w ]+)( b|\))/i,/; (ac[3-6]\d\w{2,8})( b|\))/i],[g,[y,"Archos"],[v,O]],[/(imo) (tab \w+)/i,/(infinix) (x1101b?)/i],[y,g,[v,U]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus(?! zenw)|dell|jolla|meizu|motorola|polytron|infinix|tecno|micromax|advan)[-_ ]?([-\w]*)/i,/; (hmd|imo) ([\w ]+?)(?: bui|\))/i,/(hp) ([\w ]+\w)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w ]+?)(?: bui|\)|\/)/i,/(oppo) ?([\w ]+) bui/i],[y,g,[v,O]],[/(kobo)\s(ereader|touch)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[y,g,[v,U]],[/(surface duo)/i],[g,[y,bn],[v,U]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[g,[y,"Fairphone"],[v,O]],[/(u304aa)/i],[g,[y,"AT&T"],[v,O]],[/\bsie-(\w*)/i],[g,[y,"Siemens"],[v,O]],[/\b(rct\w+) b/i],[g,[y,"RCA"],[v,U]],[/\b(venue[\d ]{2,7}) b/i],[g,[y,"Dell"],[v,U]],[/\b(q(?:mv|ta)\w+) b/i],[g,[y,"Verizon"],[v,U]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[g,[y,"Barnes & Noble"],[v,U]],[/\b(tm\d{3}\w+) b/i],[g,[y,"NuVision"],[v,U]],[/\b(k88) b/i],[g,[y,"ZTE"],[v,U]],[/\b(nx\d{3}j) b/i],[g,[y,"ZTE"],[v,O]],[/\b(gen\d{3}) b.+49h/i],[g,[y,"Swiss"],[v,O]],[/\b(zur\d{3}) b/i],[g,[y,"Swiss"],[v,U]],[/\b((zeki)?tb.*\b) b/i],[g,[y,"Zeki"],[v,U]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[y,"Dragon Touch"],g,[v,U]],[/\b(ns-?\w{0,9}) b/i],[g,[y,"Insignia"],[v,U]],[/\b((nxa|next)-?\w{0,9}) b/i],[g,[y,"NextBook"],[v,U]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[y,"Voice"],g,[v,O]],[/\b(lvtel\-)?(v1[12]) b/i],[[y,"LvTel"],g,[v,O]],[/\b(ph-1) /i],[g,[y,"Essential"],[v,O]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[g,[y,"Envizen"],[v,U]],[/\b(trio[-\w\. ]+) b/i],[g,[y,"MachSpeed"],[v,U]],[/\btu_(1491) b/i],[g,[y,"Rotor"],[v,U]],[/((?:tegranote|shield t(?!.+d tv))[\w- ]*?)(?: b|\))/i],[g,[y,ve],[v,U]],[/(sprint) (\w+)/i],[y,g,[v,O]],[/(kin\.[onetw]{3})/i],[[g,/\./g," "],[y,bn],[v,O]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[g,[y,dn],[v,U]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[g,[y,dn],[v,O]],[/smart-tv.+(samsung)/i],[y,[v,j]],[/hbbtv.+maple;(\d+)/i],[[g,/^/,"SmartTV"],[y,H],[v,j]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[y,jt],[v,j]],[/(apple) ?tv/i],[y,[g,X+" TV"],[v,j]],[/crkey/i],[[g,Ie+"cast"],[y,Je],[v,j]],[/droid.+aft(\w+)( bui|\))/i],[g,[y,Z],[v,j]],[/(shield \w+ tv)/i],[g,[y,ve],[v,j]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[g,[y,J],[v,j]],[/(bravia[\w ]+)( bui|\))/i],[g,[y,_e],[v,j]],[/(mi(tv|box)-?\w+) bui/i],[g,[y,it],[v,j]],[/Hbbtv.*(technisat) (.*);/i],[y,g,[v,j]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[y,ag],[g,ag],[v,j]],[/droid.+; ([\w- ]+) (?:android tv|smart[- ]?tv)/i],[g,[v,j]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[v,j]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[y,g,[v,I]],[/droid.+; (shield)( bui|\))/i],[g,[y,ve],[v,I]],[/(playstation \w+)/i],[g,[y,_e],[v,I]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[g,[y,bn],[v,I]],[/\b(sm-[lr]\d\d[0156][fnuw]?s?|gear live)\b/i],[g,[y,H],[v,G]],[/((pebble))app/i,/(asus|google|lg|oppo) ((pixel |zen)?watch[\w ]*)( bui|\))/i],[y,g,[v,G]],[/(ow(?:19|20)?we?[1-3]{1,3})/i],[g,[y,R],[v,G]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[g,[y,X],[v,G]],[/(opwwe\d{3})/i],[g,[y,Be],[v,G]],[/(moto 360)/i],[g,[y,he],[v,G]],[/(smartwatch 3)/i],[g,[y,_e],[v,G]],[/(g watch r)/i],[g,[y,jt],[v,G]],[/droid.+; (wt63?0{2,3})\)/i],[g,[y,dn],[v,G]],[/droid.+; (glass) \d/i],[g,[y,Je],[v,G]],[/(pico) (4|neo3(?: link|pro)?)/i],[y,g,[v,G]],[/; (quest( \d| pro)?)/i],[g,[y,Ir],[v,G]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[y,[v,$]],[/(aeobc)\b/i],[g,[y,Z],[v,$]],[/(homepod).+mac os/i],[g,[y,X],[v,$]],[/windows iot/i],[[v,$]],[/droid .+?; ([^;]+?)(?: bui|; wv\)|\) applew).+? mobile safari/i],[g,[v,O]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[g,[v,U]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[v,U]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[v,O]],[/droid .+?; ([\w\. -]+)( bui|\))/i],[g,[y,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[b,[_,"EdgeHTML"]],[/(arkweb)\/([\w\.]+)/i],[_,b],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[b,[_,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna|servo)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i,/\b(libweb)/i],[_,b],[/ladybird\//i],[[_,"LibWeb"]],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[b,_]],os:[[/microsoft (windows) (vista|xp)/i],[_,b],[/(windows (?:phone(?: os)?|mobile|iot))[\/ ]?([\d\.\w ]*)/i],[_,[b,lA,JH]],[/windows nt 6\.2; (arm)/i,/windows[\/ ]([ntce\d\. ]+\w)(?!.+xbox)/i,/(?:win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[b,lA,JH],[_,"Windows"]],[/[adehimnop]{4,7}\b(?:.*os ([\w]+) like mac|; opera)/i,/(?:ios;fbsv\/|iphone.+ios[\/ ])([\d\.]+)/i,/cfnetwork\/.+darwin/i],[[b,/_/g,"."],[_,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[_,cA],[b,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[b,_],[/(ubuntu) ([\w\.]+) like android/i],[[_,/(.+)/,"$1 Touch"],b],[/(android|bada|blackberry|kaios|maemo|meego|openharmony|qnx|rim tablet os|sailfish|series40|symbian|tizen|webos)\w*[-\/; ]?([\d\.]*)/i],[_,b],[/\(bb(10);/i],[b,[_,le]],[/(?:symbian ?os|symbos|s60(?=;)|series ?60)[-\/ ]?([\w\.]*)/i],[b,[_,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[b,[_,et+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[b,[_,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[b,[_,"watchOS"]],[/crkey\/([\d\.]+)/i],[b,[_,Ie+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[_,Ea],b],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux)(?: arm\w*| x86\w*| ?)([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[_,b],[/(sunos) ?([\w\.\d]*)/i],[[_,"Solaris"],b],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux|serenityos)/i,/(unix) ?([\w\.]*)/i],[_,b]]},Ko=function(or,pr){if(typeof or===d&&(pr=or,or=i),!(this instanceof Ko))return new Ko(or,pr).getResult();var vn=typeof n!==l&&n.navigator?n.navigator:i,gi=or||(vn&&vn.userAgent?vn.userAgent:""),Wo=vn&&vn.userAgentData?vn.userAgentData:i,Wn=pr?function(kt,Yo){var eu={};for(var Ic in kt)Yo[Ic]&&Yo[Ic].length%2==0?eu[Ic]=Yo[Ic].concat(kt[Ic]):eu[Ic]=kt[Ic];return eu}($H,pr):$H,tl=vn&&vn.userAgent==gi;return this.getBrowser=function(){var kt={};return kt[_]=i,kt[b]=i,Zd.call(kt,gi,Wn.browser),kt[f]=function(Yo){return typeof Yo===h?Yo.replace(/[^\d\.]/g,"").split(".")[0]:i}(kt[b]),tl&&vn&&vn.brave&&typeof vn.brave.isBrave==o&&(kt[_]="Brave"),kt},this.getCPU=function(){var kt={};return kt[D]=i,Zd.call(kt,gi,Wn.cpu),kt},this.getDevice=function(){var kt={};return kt[y]=i,kt[g]=i,kt[v]=i,Zd.call(kt,gi,Wn.device),tl&&!kt[v]&&Wo&&Wo.mobile&&(kt[v]=O),tl&&kt[g]=="Macintosh"&&vn&&typeof vn.standalone!==l&&vn.maxTouchPoints&&vn.maxTouchPoints>2&&(kt[g]="iPad",kt[v]=U),kt},this.getEngine=function(){var kt={};return kt[_]=i,kt[b]=i,Zd.call(kt,gi,Wn.engine),kt},this.getOS=function(){var kt={};return kt[_]=i,kt[b]=i,Zd.call(kt,gi,Wn.os),tl&&!kt[_]&&Wo&&Wo.platform&&Wo.platform!="Unknown"&&(kt[_]=Wo.platform.replace(/chrome os/i,Ea).replace(/macos/i,cA)),kt},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return gi},this.setUA=function(kt){return gi=typeof kt===h&&kt.length>500?ag(kt,500):kt,this},this.setUA(gi),this};Ko.VERSION="0.7.41",Ko.BROWSER=lp([_,b,f]),Ko.CPU=lp([D]),Ko.DEVICE=lp([g,y,v,I,O,j,U,G,$]),Ko.ENGINE=Ko.OS=lp([_,b]),e.exports&&(t=e.exports=Ko),t.UAParser=Ko;var Ap=typeof n!==l&&(n.jQuery||n.Zepto);if(Ap&&!Ap.ua){var K0=new Ko;Ap.ua=K0.getResult(),Ap.ua.get=function(){return K0.getUA()},Ap.ua.set=function(or){K0.setUA(or);var pr=K0.getResult();for(var vn in pr)Ap.ua[vn]=pr[vn]}}})(typeof window=="object"?window:c)})(tT,tT.exports);var sie=A(tT.exports),lP=mE.clear;Yt({global:!0,bind:!0,forced:Q.clearImmediate!==lP},{clearImmediate:lP});var AP=Q,iie=V,aie=ue,oie=rS,cie=wi,lie=Pl,Aie=cd,die=AP.Function,uie=/MSIE .\./.test(cie)||oie==="BUN"&&function(){var e=AP.Bun.version.split(".");return e.length<3||e[0]==="0"&&(e[1]<3||e[1]==="3"&&e[2]==="0")}(),hie=Yt,dP=Q,uP=mE.set,pie=function(e,t){var n=1;return uie?function(i,o){var l=Aie(arguments.length,1)>n,d=aie(i)?i:die(i),h=l?lie(arguments,n):[],f=l?function(){iie(d,this,h)}:d;return e(f)}:e},hP=dP.setImmediate?pie(uP):uP;hie({global:!0,bind:!0,forced:dP.setImmediate!==hP},{setImmediate:hP});var pP=A(Ot.setImmediate),fie=Q,mie=yk,gie=Pi,_ie=cd,Eie=De;Yt({global:!0,dontCallGetSet:!0,forced:u(function(){return Eie&&Object.getOwnPropertyDescriptor(fie,"queueMicrotask").value.length!==1})},{queueMicrotask:function(e){_ie(arguments.length,1),mie(gie(e))}});var fP=A(Ot.queueMicrotask);function mP(e,t){return function(){return e.apply(t,arguments)}}const{toString:vie}=Object.prototype,{getPrototypeOf:nT}=Object,{iterator:GE,toStringTag:gP}=Symbol,KE=(rT=Object.create(null),e=>{const t=vie.call(e);return rT[t]||(rT[t]=t.slice(8,-1).toLowerCase())});var rT;const Io=e=>(e=e.toLowerCase(),t=>KE(t)===e),WE=e=>t=>typeof t===e,{isArray:fh}=Array,mh=WE("undefined");function sm(e){return e!==null&&!mh(e)&&e.constructor!==null&&!mh(e.constructor)&&Mi(e.constructor.isBuffer)&&e.constructor.isBuffer(e)}const _P=Io("ArrayBuffer"),yie=WE("string"),Mi=WE("function"),EP=WE("number"),im=e=>e!==null&&typeof e=="object",YE=e=>{if(KE(e)!=="object")return!1;const t=nT(e);return!(t!==null&&t!==Object.prototype&&Object.getPrototypeOf(t)!==null||gP in e||GE in e)},wie=Io("Date"),bie=Io("File"),Sie=Io("Blob"),Cie=Io("FileList"),Tie=Io("URLSearchParams"),[Rie,Iie,Nie,Oie]=["ReadableStream","Request","Response","Headers"].map(Io);function am(e,t){let n,i,{allOwnKeys:o=!1}=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(e!=null)if(typeof e!="object"&&(e=[e]),fh(e))for(n=0,i=e.length;n<i;n++)t.call(null,e[n],n,e);else{if(sm(e))return;const l=o?Object.getOwnPropertyNames(e):Object.keys(e),d=l.length;let h;for(n=0;n<d;n++)h=l[n],t.call(null,e[h],h,e)}}function vP(e,t){if(sm(e))return null;t=t.toLowerCase();const n=Object.keys(e);let i,o=n.length;for(;o-- >0;)if(i=n[o],t===i.toLowerCase())return i;return null}const fd=cP!==void 0?cP:typeof self<"u"?self:typeof window<"u"?window:W0,yP=e=>!mh(e)&&e!==fd,xie=(sT=typeof Uint8Array<"u"&&nT(Uint8Array),e=>sT&&e instanceof sT);var sT;const Die=Io("HTMLFormElement"),wP=(e=>{let{hasOwnProperty:t}=e;return(n,i)=>t.call(n,i)})(Object.prototype),Bie=Io("RegExp"),bP=(e,t)=>{const n=Object.getOwnPropertyDescriptors(e),i={};am(n,(o,l)=>{let d;(d=t(o,l,e))!==!1&&(i[l]=d||o)}),Object.defineProperties(e,i)},kie=Io("AsyncFunction"),SP=(CP=typeof pP=="function",TP=Mi(fd.postMessage),CP?pP:TP?(iT="axios@".concat(Math.random()),zE=[],fd.addEventListener("message",e=>{let{source:t,data:n}=e;t===fd&&n===iT&&zE.length&&zE.shift()()},!1),e=>{zE.push(e),fd.postMessage(iT,"*")}):e=>setTimeout(e));var CP,TP,iT,zE;const Lie=fP!==void 0?fP.bind(fd):typeof process<"u"&&process.nextTick||SP;var Te={isArray:fh,isArrayBuffer:_P,isBuffer:sm,isFormData:e=>{let t;return e&&(typeof FormData=="function"&&e instanceof FormData||Mi(e.append)&&((t=KE(e))==="formdata"||t==="object"&&Mi(e.toString)&&e.toString()==="[object FormData]"))},isArrayBufferView:function(e){let t;return t=typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&_P(e.buffer),t},isString:yie,isNumber:EP,isBoolean:e=>e===!0||e===!1,isObject:im,isPlainObject:YE,isEmptyObject:e=>{if(!im(e)||sm(e))return!1;try{return Object.keys(e).length===0&&Object.getPrototypeOf(e)===Object.prototype}catch{return!1}},isReadableStream:Rie,isRequest:Iie,isResponse:Nie,isHeaders:Oie,isUndefined:mh,isDate:wie,isFile:bie,isBlob:Sie,isRegExp:Bie,isFunction:Mi,isStream:e=>im(e)&&Mi(e.pipe),isURLSearchParams:Tie,isTypedArray:xie,isFileList:Cie,forEach:am,merge:function e(){const{caseless:t,skipUndefined:n}=yP(this)&&this||{},i={},o=(l,d)=>{const h=t&&vP(i,d)||d;YE(i[h])&&YE(l)?i[h]=e(i[h],l):YE(l)?i[h]=e({},l):fh(l)?i[h]=l.slice():n&&mh(l)||(i[h]=l)};for(let l=0,d=arguments.length;l<d;l++)arguments[l]&&am(arguments[l],o);return i},extend:function(e,t,n){let{allOwnKeys:i}=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return am(t,(o,l)=>{n&&Mi(o)?e[l]=mP(o,n):e[l]=o},{allOwnKeys:i}),e},trim:e=>ks(e)?ks(e).call(e):e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:e=>(e.charCodeAt(0)===65279&&(e=e.slice(1)),e),inherits:(e,t,n,i)=>{e.prototype=Object.create(t.prototype,i),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),n&&Object.assign(e.prototype,n)},toFlatObject:(e,t,n,i)=>{let o,l,d;const h={};if(t=t||{},e==null)return t;do{for(o=Object.getOwnPropertyNames(e),l=o.length;l-- >0;)d=o[l],i&&!i(d,e,t)||h[d]||(t[d]=e[d],h[d]=!0);e=n!==!1&&nT(e)}while(e&&(!n||n(e,t))&&e!==Object.prototype);return t},kindOf:KE,kindOfTest:Io,endsWith:(e,t,n)=>{e=String(e),(n===void 0||n>e.length)&&(n=e.length),n-=t.length;const i=e.indexOf(t,n);return i!==-1&&i===n},toArray:e=>{if(!e)return null;if(fh(e))return e;let t=e.length;if(!EP(t))return null;const n=new Array(t);for(;t-- >0;)n[t]=e[t];return n},forEachEntry:(e,t)=>{const n=(e&&e[GE]).call(e);let i;for(;(i=n.next())&&!i.done;){const o=i.value;t.call(e,o[0],o[1])}},matchAll:(e,t)=>{let n;const i=[];for(;(n=e.exec(t))!==null;)i.push(n);return i},isHTMLForm:Die,hasOwnProperty:wP,hasOwnProp:wP,reduceDescriptors:bP,freezeMethods:e=>{bP(e,(t,n)=>{if(Mi(e)&&["arguments","caller","callee"].indexOf(n)!==-1)return!1;const i=e[n];Mi(i)&&(t.enumerable=!1,"writable"in t?t.writable=!1:t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+n+"'")}))})},toObjectSet:(e,t)=>{const n={},i=o=>{o.forEach(l=>{n[l]=!0})};return fh(e)?i(e):i(String(e).split(t)),n},toCamelCase:e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(t,n,i){return n.toUpperCase()+i}),noop:()=>{},toFiniteNumber:(e,t)=>e!=null&&Number.isFinite(e=+e)?e:t,findKey:vP,global:fd,isContextDefined:yP,isSpecCompliantForm:function(e){return!!(e&&Mi(e.append)&&e[gP]==="FormData"&&e[GE])},toJSONObject:e=>{const t=new Array(10),n=(i,o)=>{if(im(i)){if(t.indexOf(i)>=0)return;if(sm(i))return i;if(!("toJSON"in i)){t[o]=i;const l=fh(i)?[]:{};return am(i,(d,h)=>{const f=n(d,o+1);!mh(f)&&(l[h]=f)}),t[o]=void 0,l}}return i};return n(e,0)},isAsyncFn:kie,isThenable:e=>e&&(im(e)||Mi(e))&&Mi(e.then)&&Mi(e.catch),setImmediate:SP,asap:Lie,isIterable:e=>e!=null&&Mi(e[GE])};function rn(e,t,n,i,o){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=e,this.name="AxiosError",t&&(this.code=t),n&&(this.config=n),i&&(this.request=i),o&&(this.response=o,this.status=o.status?o.status:null)}Te.inherits(rn,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:Te.toJSONObject(this.config),code:this.code,status:this.status}}});const RP=rn.prototype,IP={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(e=>{IP[e]={value:e}}),Object.defineProperties(rn,IP),Object.defineProperty(RP,"isAxiosError",{value:!0}),rn.from=(e,t,n,i,o,l)=>{const d=Object.create(RP);Te.toFlatObject(e,d,function(g){return g!==Error.prototype},g=>g!=="isAxiosError");const h=e&&e.message?e.message:"Error",f=t==null&&e?e.code:t;return rn.call(d,h,f,n,i,o),e&&d.cause==null&&Object.defineProperty(d,"cause",{value:e,configurable:!0}),d.name=e&&e.name||"Error",l&&Object.assign(d,l),d};function aT(e){return Te.isPlainObject(e)||Te.isArray(e)}function NP(e){return Te.endsWith(e,"[]")?e.slice(0,-2):e}function OP(e,t,n){return e?e.concat(t).map(function(i,o){return i=NP(i),!n&&o?"["+i+"]":i}).join(n?".":""):t}const Uie=Te.toFlatObject(Te,{},null,function(e){return/^is[A-Z]/.test(e)});function qE(e,t,n){if(!Te.isObject(e))throw new TypeError("target must be an object");t=t||new FormData;const i=(n=Te.toFlatObject(n,{metaTokens:!0,dots:!1,indexes:!1},!1,function(y,b){return!Te.isUndefined(b[y])})).metaTokens,o=n.visitor||g,l=n.dots,d=n.indexes,h=(n.Blob||typeof Blob<"u"&&Blob)&&Te.isSpecCompliantForm(t);if(!Te.isFunction(o))throw new TypeError("visitor must be a function");function f(y){if(y===null)return"";if(Te.isDate(y))return y.toISOString();if(Te.isBoolean(y))return y.toString();if(!h&&Te.isBlob(y))throw new rn("Blob is not supported. Use a Buffer instead.");return Te.isArrayBuffer(y)||Te.isTypedArray(y)?h&&typeof Blob=="function"?new Blob([y]):Buffer.from(y):y}function g(y,b,D){let I=y;if(y&&!D&&typeof y=="object"){if(Te.endsWith(b,"{}"))b=i?b:b.slice(0,-2),y=JSON.stringify(y);else if(Te.isArray(y)&&function(O){return Te.isArray(O)&&!O.some(aT)}(y)||(Te.isFileList(y)||Te.endsWith(b,"[]"))&&(I=Te.toArray(y)))return b=NP(b),I.forEach(function(O,U){!Te.isUndefined(O)&&O!==null&&t.append(d===!0?OP([b],U,l):d===null?b:b+"[]",f(O))}),!1}return!!aT(y)||(t.append(OP(D,b,l),f(y)),!1)}const _=[],v=Object.assign(Uie,{defaultVisitor:g,convertValue:f,isVisitable:aT});if(!Te.isObject(e))throw new TypeError("data must be an object");return function y(b,D){if(!Te.isUndefined(b)){if(_.indexOf(b)!==-1)throw Error("Circular reference detected in "+D.join("."));_.push(b),Te.forEach(b,function(I,O){(!(Te.isUndefined(I)||I===null)&&o.call(t,I,Te.isString(O)?ks(O).call(O):O,D,v))===!0&&y(I,D?D.concat(O):[O])}),_.pop()}}(e),t}function xP(e){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(n){return t[n]})}function oT(e,t){this._pairs=[],e&&qE(e,this,t)}const DP=oT.prototype;function Pie(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+")}function BP(e,t,n){if(!t)return e;const i=n&&n.encode||Pie;Te.isFunction(n)&&(n={serialize:n});const o=n&&n.serialize;let l;if(l=o?o(t,n):Te.isURLSearchParams(t)?t.toString():new oT(t,n).toString(i),l){const d=e.indexOf("#");d!==-1&&(e=e.slice(0,d)),e+=(e.indexOf("?")===-1?"?":"&")+l}return e}DP.append=function(e,t){this._pairs.push([e,t])},DP.toString=function(e){const t=e?function(n){return e.call(this,n,xP)}:xP;return this._pairs.map(function(n){return t(n[0])+"="+t(n[1])},"").join("&")};var kP=class{constructor(){this.handlers=[]}use(e,t,n){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!n&&n.synchronous,runWhen:n?n.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){Te.forEach(this.handlers,function(t){t!==null&&e(t)})}},LP={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},UP={exports:{}},Mie=Yt,Fie=De,PP=ja.f;Mie({target:"Object",stat:!0,forced:Object.defineProperty!==PP,sham:!Fie},{defineProperty:PP});var MP=Ot.Object,jie=UP.exports=function(e,t,n){return MP.defineProperty(e,t,n)};MP.defineProperty.sham&&(jie.sham=!0);var FP=A(UP.exports),Vie=TypeError,jP=Ff,Qie=fE,Hie=ut,Gie=sr("species"),VP=Array,Kie=function(e){var t;return jP(e)&&(t=e.constructor,(Qie(t)&&(t===VP||jP(t.prototype))||Hie(t)&&(t=t[Gie])===null)&&(t=void 0)),t===void 0?VP:t},QP=function(e,t){return new(Kie(e))(t===0?0:t)},Wie=u,Yie=Fa,zie=sr("species"),HP=function(e){return Yie>=51||!Wie(function(){var t=[];return(t.constructor={})[zie]=function(){return{foo:1}},t[e](Boolean).foo!==1})},qie=Yt,Xie=u,Jie=Ff,$ie=ut,Zie=ic,eae=kl,GP=function(e){if(e>9007199254740991)throw Vie("Maximum allowed index exceeded");return e},KP=mC,tae=QP,nae=HP,rae=Fa,WP=sr("isConcatSpreadable"),sae=rae>=51||!Xie(function(){var e=[];return e[WP]=!1,e.concat()[0]!==e}),iae=function(e){if(!$ie(e))return!1;var t=e[WP];return t!==void 0?!!t:Jie(e)};qie({target:"Array",proto:!0,forced:!sae||!nae("concat")},{concat:function(e){var t,n,i,o,l,d=Zie(this),h=tae(d,0),f=0;for(t=-1,i=arguments.length;t<i;t++)if(iae(l=t===-1?d:arguments[t]))for(o=eae(l),GP(f+o),n=0;n<o;n++,f++)n in l&&KP(h,f,l[n]);else GP(f+1),KP(h,f++,l);return h.length=f,h}});var YP={},aae=re,oae=Et,zP=Z_.f,cae=Pl,qP=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];YP.f=function(e){return qP&&aae(e)==="Window"?function(t){try{return zP(t)}catch{return cae(qP)}}(e):zP(oae(e))};var gh={},lae=sr;gh.f=lae;var XP=Ot,Aae=hs,dae=gh,uae=ja.f,Gr=function(e){var t=XP.Symbol||(XP.Symbol={});Aae(t,e)||uae(t,e,{value:dae.f(e)})},hae=Se,pae=Qr,fae=sr,mae=Ul,JP=function(){var e=pae("Symbol"),t=e&&e.prototype,n=t&&t.valueOf,i=fae("toPrimitive");t&&!t[i]&&mae(t,i,function(o){return hae(n,this)},{})},gae=Bl,_ae=yt,Eae=ic,vae=kl,yae=QP,$P=N([].push),wae=function(e){var t=e===1,n=e===2,i=e===3,o=e===4,l=e===6,d=e===7,h=e===5||l;return function(f,g,_,v){for(var y,b,D=Eae(f),I=_ae(D),O=vae(I),U=gae(g,_),j=0,G=v||yae,$=t?G(f,O):n||d?G(f,0):void 0;O>j;j++)if((h||j in I)&&(b=U(y=I[j],j,D),e))if(t)$[j]=b;else if(b)switch(e){case 3:return!0;case 5:return y;case 6:return j;case 2:$P($,y)}else switch(e){case 4:return!1;case 7:$P($,y)}return l?-1:i||o?o:$}},ZP={forEach:wae(0)},XE=Yt,om=Q,cT=Se,bae=N,_h=De,Eh=Ui,Sae=u,Ls=hs,Cae=B,lT=Si,JE=Et,AT=Hb,Tae=Ci,dT=Nt,vh=Vf,e2=tE,Rae=Z_,t2=YP,Iae=jf,n2=ye,r2=ja,Nae=AS,s2=Qe,i2=Ul,Oae=pE,uT=Ku,a2=eE,o2=Vb,xae=sr,Dae=gh,Bae=Gr,kae=JP,Lae=Vc,c2=od,$E=ZP.forEach,Fi=$_("hidden"),ZE="Symbol",cm="prototype",Uae=c2.set,l2=c2.getterFor(ZE),No=Object[cm],md=om.Symbol,ev=md&&md[cm],Pae=om.RangeError,Mae=om.TypeError,hT=om.QObject,A2=n2.f,gd=r2.f,d2=t2.f,Fae=s2.f,u2=bae([].push),Gc=uT("symbols"),lm=uT("op-symbols"),jae=uT("wks"),pT=!hT||!hT[cm]||!hT[cm].findChild,h2=function(e,t,n){var i=A2(No,t);i&&delete No[t],gd(e,t,n),i&&e!==No&&gd(No,t,i)},fT=_h&&Sae(function(){return vh(gd({},"a",{get:function(){return gd(this,"a",{value:7}).a}})).a!==7})?h2:gd,mT=function(e,t){var n=Gc[e]=vh(ev);return Uae(n,{type:ZE,tag:e,description:t}),_h||(n.description=t),n},tv=function(e,t,n){e===No&&tv(lm,t,n),lT(e);var i=AT(t);return lT(n),Ls(Gc,i)?(n.enumerable?(Ls(e,Fi)&&e[Fi][i]&&(e[Fi][i]=!1),n=vh(n,{enumerable:dT(0,!1)})):(Ls(e,Fi)||gd(e,Fi,dT(1,vh(null))),e[Fi][i]=!0),fT(e,i,n)):gd(e,i,n)},gT=function(e,t){lT(e);var n=JE(t),i=e2(n).concat(g2(n));return $E(i,function(o){_h&&!cT(p2,n,o)||tv(e,o,n[o])}),e},p2=function(e){var t=AT(e),n=cT(Fae,this,t);return!(this===No&&Ls(Gc,t)&&!Ls(lm,t))&&(!(n||!Ls(this,t)||!Ls(Gc,t)||Ls(this,Fi)&&this[Fi][t])||n)},f2=function(e,t){var n=JE(e),i=AT(t);if(n!==No||!Ls(Gc,i)||Ls(lm,i)){var o=A2(n,i);return!o||!Ls(Gc,i)||Ls(n,Fi)&&n[Fi][i]||(o.enumerable=!0),o}},m2=function(e){var t=d2(JE(e)),n=[];return $E(t,function(i){Ls(Gc,i)||Ls(a2,i)||u2(n,i)}),n},g2=function(e){var t=e===No,n=d2(t?lm:JE(e)),i=[];return $E(n,function(o){!Ls(Gc,o)||t&&!Ls(No,o)||u2(i,Gc[o])}),i};Eh||(md=function(){if(Cae(ev,this))throw new Mae("Symbol is not a constructor");var e=arguments.length&&arguments[0]!==void 0?Tae(arguments[0]):void 0,t=o2(e),n=function(i){var o=this===void 0?om:this;o===No&&cT(n,lm,i),Ls(o,Fi)&&Ls(o[Fi],t)&&(o[Fi][t]=!1);var l=dT(1,i);try{fT(o,t,l)}catch(d){if(!(d instanceof Pae))throw d;h2(o,t,l)}};return _h&&pT&&fT(No,t,{configurable:!0,set:n}),mT(t,e)},i2(ev=md[cm],"toString",function(){return l2(this).tag}),i2(md,"withoutSetter",function(e){return mT(o2(e),e)}),s2.f=p2,r2.f=tv,Nae.f=gT,n2.f=f2,Rae.f=t2.f=m2,Iae.f=g2,Dae.f=function(e){return mT(xae(e),e)},_h&&Oae(ev,"description",{configurable:!0,get:function(){return l2(this).description}})),XE({global:!0,wrap:!0,forced:!Eh,sham:!Eh},{Symbol:md}),$E(e2(jae),function(e){Bae(e)}),XE({target:ZE,stat:!0,forced:!Eh},{useSetter:function(){pT=!0},useSimple:function(){pT=!1}}),XE({target:"Object",stat:!0,forced:!Eh,sham:!_h},{create:function(e,t){return t===void 0?vh(e):gT(vh(e),t)},defineProperty:tv,defineProperties:gT,getOwnPropertyDescriptor:f2}),XE({target:"Object",stat:!0,forced:!Eh},{getOwnPropertyNames:m2}),kae(),Lae(md,ZE),a2[Fi]=!0;var _2=Ui&&!!Symbol.for&&!!Symbol.keyFor,Vae=Yt,Qae=Qr,Hae=hs,Gae=Ci,E2=Ku,Kae=_2,_T=E2("string-to-symbol-registry"),Wae=E2("symbol-to-string-registry");Vae({target:"Symbol",stat:!0,forced:!Kae},{for:function(e){var t=Gae(e);if(Hae(_T,t))return _T[t];var n=Qae("Symbol")(t);return _T[t]=n,Wae[n]=t,n}});var Yae=Yt,zae=hs,qae=bi,Xae=So,Jae=_2,v2=Ku("symbol-to-string-registry");Yae({target:"Symbol",stat:!0,forced:!Jae},{keyFor:function(e){if(!qae(e))throw new TypeError(Xae(e)+" is not a symbol");if(zae(v2,e))return v2[e]}});var y2=Ff,$ae=ue,w2=re,Zae=Ci,b2=N([].push),eoe=Yt,S2=Qr,C2=V,toe=Se,Am=N,T2=u,R2=ue,I2=bi,N2=Pl,noe=function(e){if($ae(e))return e;if(y2(e)){for(var t=e.length,n=[],i=0;i<t;i++){var o=e[i];typeof o=="string"?b2(n,o):typeof o!="number"&&w2(o)!=="Number"&&w2(o)!=="String"||b2(n,Zae(o))}var l=n.length,d=!0;return function(h,f){if(d)return d=!1,f;if(y2(this))return f;for(var g=0;g<l;g++)if(n[g]===h)return f}}},roe=Ui,soe=String,Hl=S2("JSON","stringify"),nv=Am(/./.exec),O2=Am("".charAt),ioe=Am("".charCodeAt),aoe=Am("".replace),ooe=Am(1.1.toString),coe=/[\uD800-\uDFFF]/g,x2=/^[\uD800-\uDBFF]$/,D2=/^[\uDC00-\uDFFF]$/,B2=!roe||T2(function(){var e=S2("Symbol")("stringify detection");return Hl([e])!=="[null]"||Hl({a:e})!=="{}"||Hl(Object(e))!=="{}"}),k2=T2(function(){return Hl("\uDF06\uD834")!=='"\\udf06\\ud834"'||Hl("\uDEAD")!=='"\\udead"'}),loe=function(e,t){var n=N2(arguments),i=noe(t);if(R2(i)||e!==void 0&&!I2(e))return n[1]=function(o,l){if(R2(i)&&(l=toe(i,this,soe(o),l)),!I2(l))return l},C2(Hl,null,n)},Aoe=function(e,t,n){var i=O2(n,t-1),o=O2(n,t+1);return nv(x2,e)&&!nv(D2,o)||nv(D2,e)&&!nv(x2,i)?"\\u"+ooe(ioe(e,0),16):e};Hl&&eoe({target:"JSON",stat:!0,forced:B2||k2},{stringify:function(e,t,n){var i=N2(arguments),o=C2(B2?loe:Hl,null,i);return k2&&typeof o=="string"?aoe(o,coe,Aoe):o}});var L2=jf,doe=ic;Yt({target:"Object",stat:!0,forced:!Ui||u(function(){L2.f(1)})},{getOwnPropertySymbols:function(e){var t=L2.f;return t?t(doe(e)):[]}}),Gr("asyncDispose"),Gr("asyncIterator"),Gr("dispose"),Gr("hasInstance"),Gr("isConcatSpreadable"),Gr("iterator"),Gr("match"),Gr("matchAll"),Gr("replace"),Gr("search"),Gr("species"),Gr("split");var uoe=JP;Gr("toPrimitive"),uoe();var hoe=Qr,poe=Vc;Gr("toStringTag"),poe(hoe("Symbol"),"Symbol"),Gr("unscopables"),Vc(Q.JSON,"JSON",!0);var foe=Ot.Symbol,moe=sr,goe=ja.f,U2=moe("metadata"),P2=Function.prototype;P2[U2]===void 0&&goe(P2,U2,{value:null}),Gr("metadata");var _oe=foe,Eoe=N,ET=Qr("Symbol"),voe=ET.keyFor,yoe=Eoe(ET.prototype.valueOf),M2=ET.isRegisteredSymbol||function(e){try{return voe(yoe(e))!==void 0}catch{return!1}};Yt({target:"Symbol",stat:!0},{isRegisteredSymbol:M2});for(var woe=Ku,F2=Qr,boe=N,Soe=bi,Coe=sr,rv=F2("Symbol"),j2=rv.isWellKnownSymbol,V2=F2("Object","getOwnPropertyNames"),Toe=boe(rv.prototype.valueOf),Q2=woe("wks"),vT=0,H2=V2(rv),Roe=H2.length;vT<Roe;vT++)try{var G2=H2[vT];Soe(rv[G2])&&Coe(G2)}catch{}var K2=function(e){if(j2&&j2(e))return!0;try{for(var t=Toe(e),n=0,i=V2(Q2),o=i.length;n<o;n++)if(Q2[i[n]]==t)return!0}catch{}return!1};Yt({target:"Symbol",stat:!0,forced:!0},{isWellKnownSymbol:K2}),Gr("customMatcher"),Gr("observable"),Yt({target:"Symbol",stat:!0},{isRegistered:M2}),Yt({target:"Symbol",stat:!0,forced:!0},{isWellKnown:K2}),Gr("matcher"),Gr("metadataKey"),Gr("patternMatch"),Gr("replaceAll");var yh=A(_oe),W2=A(gh.f("iterator"));function dm(e){return dm=typeof yh=="function"&&typeof W2=="symbol"?function(t){return typeof t}:function(t){return t&&typeof yh=="function"&&t.constructor===yh&&t!==yh.prototype?"symbol":typeof t},dm(e)}var Ioe=A(gh.f("toPrimitive"));function Noe(e){var t=function(n,i){if(dm(n)!="object"||!n)return n;var o=n[Ioe];if(o!==void 0){var l=o.call(n,i);if(dm(l)!="object")return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return(i==="string"?String:Number)(n)}(e,"string");return dm(t)=="symbol"?t:t+""}function x(e,t,n){return(t=Noe(t))in e?FP(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Y2=A(tre),Ooe={isBrowser:!0,classes:{URLSearchParams:Y2!==void 0?Y2:oT,FormData:typeof FormData<"u"?FormData:null,Blob:typeof Blob<"u"?Blob:null},protocols:["http","https","file","blob","url","data"]};const yT=typeof window<"u"&&typeof document<"u",wT=typeof navigator=="object"&&navigator||void 0,xoe=yT&&(!wT||["ReactNative","NativeScript","NS"].indexOf(wT.product)<0),Doe=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",Boe=yT&&window.location.href||"http://localhost";function z2(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}function q2(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?z2(Object(n),!0).forEach(function(i){x(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):z2(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}var ui=q2(q2({},Object.freeze({__proto__:null,hasBrowserEnv:yT,hasStandardBrowserEnv:xoe,hasStandardBrowserWebWorkerEnv:Doe,navigator:wT,origin:Boe})),Ooe);function X2(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}function koe(e,t){return qE(e,new ui.classes.URLSearchParams,function(n){for(var i=1;i<arguments.length;i++){var o=arguments[i]!=null?arguments[i]:{};i%2?X2(Object(o),!0).forEach(function(l){x(n,l,o[l])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(o)):X2(Object(o)).forEach(function(l){Object.defineProperty(n,l,Object.getOwnPropertyDescriptor(o,l))})}return n}({visitor:function(n,i,o,l){return ui.isNode&&Te.isBuffer(n)?(this.append(i,n.toString("base64")),!1):l.defaultVisitor.apply(this,arguments)}},t))}var Loe=nC.charAt,J2=Se,Uoe=Si,Poe=ue,Moe=re,Foe=/./.exec,joe=TypeError,Voe=Yt,$2=Se,Z2=Ae,Qoe=bS,sv=uE,eM=Qt,tM=JB,um=Ci,Hoe=Si,Goe=ut,Koe=re,Woe=Zb,nM=YC,Yoe=Lf,zoe=u,qoe=NS,Xoe=function(e,t,n){return t+(n?Loe(e,t).length:1)},Joe=function(e,t){var n=e.exec;if(Poe(n)){var i=J2(n,e,t);return i!==null&&Uoe(i),i}if(Moe(e)==="RegExp")return J2(Foe,e,t);throw new joe("RegExp#exec called on incompatible receiver")},rM=od,$oe=sr("matchAll"),sM="RegExp String",iM=sM+" Iterator",Zoe=rM.set,ece=rM.getterFor(iM),tce=TypeError,bT=Z2("".indexOf),iv=Z2("".matchAll),ST=!!iv&&!zoe(function(){iv("a",/./)}),nce=Qoe(function(e,t,n,i){Zoe(this,{type:iM,regexp:e,string:t,global:n,unicode:i,done:!1})},sM,function(){var e=ece(this);if(e.done)return sv(void 0,!0);var t=e.regexp,n=e.string,i=Joe(t,n);return i===null?(e.done=!0,sv(void 0,!0)):e.global?(um(i[0])===""&&(t.lastIndex=Xoe(n,tM(t.lastIndex),e.unicode)),sv(i,!1)):(e.done=!0,sv(i,!1))}),aM=function(e){var t,n,i,o=Hoe(this),l=um(e),d=qoe(o,RegExp),h=um(nM(o));return t=new d(d===RegExp?o.source:o,h),n=!!~bT(h,"g"),i=!!~bT(h,"u"),t.lastIndex=tM(o.lastIndex),new nce(t,l,n,i)};Voe({target:"String",proto:!0,forced:ST},{matchAll:function(e){var t,n,i,o,l=eM(this);if(Goe(e)){if(Woe(e)&&(t=um(eM(nM(e))),!~bT(t,"g")))throw new tce("`.matchAll` does not allow non-global regexes");if(ST)return iv(l,e);if((i=Yoe(e,$oe))===void 0&&Koe(e)==="RegExp"&&(i=aM),i)return $2(i,e,l)}else if(ST)return iv(l,e);return n=um(l),o=new RegExp(e,"g"),$2(aM,o,n)}});var rce=oa("String","matchAll"),sce=B,ice=rce,CT=String.prototype,ace=function(e){var t=e.matchAll;return typeof e=="string"||e===CT||sce(CT,e)&&t===CT.matchAll?ice:t},oce=A(ace);function oM(e){function t(n,i,o,l){let d=n[l++];if(d==="__proto__")return!0;const h=Number.isFinite(+d),f=l>=n.length;return d=!d&&Te.isArray(o)?o.length:d,f?(Te.hasOwnProp(o,d)?o[d]=[o[d],i]:o[d]=i,!h):(o[d]&&Te.isObject(o[d])||(o[d]=[]),t(n,i,o[d],l)&&Te.isArray(o[d])&&(o[d]=function(g){const _={},v=Object.keys(g);let y;const b=v.length;let D;for(y=0;y<b;y++)D=v[y],_[D]=g[D];return _}(o[d])),!h)}if(Te.isFormData(e)&&Te.isFunction(e.entries)){const n={};return Te.forEachEntry(e,(i,o)=>{t(function(l){return oce(Te).call(Te,/\w+|\[(\w*)]/g,l).map(d=>d[0]==="[]"?"":d[1]||d[0])}(i),o,n,0)}),n}return null}const TT={transitional:LP,adapter:["xhr","http","fetch"],transformRequest:[function(e,t){const n=t.getContentType()||"",i=n.indexOf("application/json")>-1,o=Te.isObject(e);if(o&&Te.isHTMLForm(e)&&(e=new FormData(e)),Te.isFormData(e))return i?JSON.stringify(oM(e)):e;if(Te.isArrayBuffer(e)||Te.isBuffer(e)||Te.isStream(e)||Te.isFile(e)||Te.isBlob(e)||Te.isReadableStream(e))return e;if(Te.isArrayBufferView(e))return e.buffer;if(Te.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let l;if(o){if(n.indexOf("application/x-www-form-urlencoded")>-1)return koe(e,this.formSerializer).toString();if((l=Te.isFileList(e))||n.indexOf("multipart/form-data")>-1){const d=this.env&&this.env.FormData;return qE(l?{"files[]":e}:e,d&&new d,this.formSerializer)}}return o||i?(t.setContentType("application/json",!1),function(d,h,f){if(Te.isString(d))try{return(h||JSON.parse)(d),ks(Te).call(Te,d)}catch(g){if(g.name!=="SyntaxError")throw g}return(f||JSON.stringify)(d)}(e)):e}],transformResponse:[function(e){const t=this.transitional||TT.transitional,n=t&&t.forcedJSONParsing,i=this.responseType==="json";if(Te.isResponse(e)||Te.isReadableStream(e))return e;if(e&&Te.isString(e)&&(n&&!this.responseType||i)){const o=!(t&&t.silentJSONParsing)&&i;try{return JSON.parse(e,this.parseReviver)}catch(l){if(o)throw l.name==="SyntaxError"?rn.from(l,rn.ERR_BAD_RESPONSE,this,null,this.response):l}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:ui.classes.FormData,Blob:ui.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};Te.forEach(["delete","get","head","post","put","patch"],e=>{TT.headers[e]={}});var RT=TT;const cce=Te.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),cM=Symbol("internals");function hm(e){var t;return e&&ks(t=String(e)).call(t).toLowerCase()}function av(e){return e===!1||e==null?e:Te.isArray(e)?e.map(av):String(e)}function IT(e,t,n,i,o){return Te.isFunction(i)?i.call(this,t,n):(o&&(t=n),Te.isString(t)?Te.isString(i)?t.indexOf(i)!==-1:Te.isRegExp(i)?i.test(t):void 0:void 0)}class ov{constructor(t){t&&this.set(t)}set(t,n,i){const o=this;function l(f,g,_){const v=hm(g);if(!v)throw new Error("header name must be a non-empty string");const y=Te.findKey(o,v);(!y||o[y]===void 0||_===!0||_===void 0&&o[y]!==!1)&&(o[y||g]=av(f))}const d=(f,g)=>Te.forEach(f,(_,v)=>l(_,v,g));if(Te.isPlainObject(t)||t instanceof this.constructor)d(t,n);else if(Te.isString(t)&&(t=ks(t).call(t))&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(ks(h=t).call(h)))d((f=>{const g={};let _,v,y;return f&&f.split(`
`).forEach(function(b){var D,I;y=b.indexOf(":"),_=ks(D=b.substring(0,y)).call(D).toLowerCase(),v=ks(I=b.substring(y+1)).call(I),!_||g[_]&&cce[_]||(_==="set-cookie"?g[_]?g[_].push(v):g[_]=[v]:g[_]=g[_]?g[_]+", "+v:v)}),g})(t),n);else if(Te.isObject(t)&&Te.isIterable(t)){let f,g,_={};for(const v of t){if(!Te.isArray(v))throw TypeError("Object iterator must return a key-value pair");_[g=v[0]]=(f=_[g])?Te.isArray(f)?[...f,v[1]]:[f,v[1]]:v[1]}d(_,n)}else t!=null&&l(n,t,i);var h;return this}get(t,n){if(t=hm(t)){const i=Te.findKey(this,t);if(i){const o=this[i];if(!n)return o;if(n===!0)return function(l){const d=Object.create(null),h=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let f;for(;f=h.exec(l);)d[f[1]]=f[2];return d}(o);if(Te.isFunction(n))return n.call(this,o,i);if(Te.isRegExp(n))return n.exec(o);throw new TypeError("parser must be boolean|regexp|function")}}}has(t,n){if(t=hm(t)){const i=Te.findKey(this,t);return!(!i||this[i]===void 0||n&&!IT(0,this[i],i,n))}return!1}delete(t,n){const i=this;let o=!1;function l(d){if(d=hm(d)){const h=Te.findKey(i,d);!h||n&&!IT(0,i[h],h,n)||(delete i[h],o=!0)}}return Te.isArray(t)?t.forEach(l):l(t),o}clear(t){const n=Object.keys(this);let i=n.length,o=!1;for(;i--;){const l=n[i];t&&!IT(0,this[l],l,t,!0)||(delete this[l],o=!0)}return o}normalize(t){const n=this,i={};return Te.forEach(this,(o,l)=>{var d;const h=Te.findKey(i,l);if(h)return n[h]=av(o),void delete n[l];const f=t?function(g){return ks(g).call(g).toLowerCase().replace(/([a-z\d])(\w*)/g,(_,v,y)=>v.toUpperCase()+y)}(l):ks(d=String(l)).call(d);f!==l&&delete n[l],n[f]=av(o),i[f]=!0}),this}concat(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return this.constructor.concat(this,...n)}toJSON(t){const n=Object.create(null);return Te.forEach(this,(i,o)=>{i!=null&&i!==!1&&(n[o]=t&&Te.isArray(i)?i.join(", "):i)}),n}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(t=>{let[n,i]=t;return n+": "+i}).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(t){return t instanceof this?t:new this(t)}static concat(t){const n=new this(t);for(var i=arguments.length,o=new Array(i>1?i-1:0),l=1;l<i;l++)o[l-1]=arguments[l];return o.forEach(d=>n.set(d)),n}static accessor(t){const n=(this[cM]=this[cM]={accessors:{}}).accessors,i=this.prototype;function o(l){const d=hm(l);n[d]||(function(h,f){const g=Te.toCamelCase(" "+f);["get","set","has"].forEach(_=>{Object.defineProperty(h,_+g,{value:function(v,y,b){return this[_].call(this,f,v,y,b)},configurable:!0})})}(i,l),n[d]=!0)}return Te.isArray(t)?t.forEach(o):o(t),this}}ov.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),Te.reduceDescriptors(ov.prototype,(e,t)=>{let{value:n}=e,i=t[0].toUpperCase()+t.slice(1);return{get:()=>n,set(o){this[i]=o}}}),Te.freezeMethods(ov);var Oo=ov;function NT(e,t){const n=this||RT,i=t||n,o=Oo.from(i.headers);let l=i.data;return Te.forEach(e,function(d){l=d.call(n,l,o.normalize(),t?t.status:void 0)}),o.normalize(),l}function lM(e){return!(!e||!e.__CANCEL__)}function wh(e,t,n){rn.call(this,e??"canceled",rn.ERR_CANCELED,t,n),this.name="CanceledError"}function AM(e,t,n){const i=n.config.validateStatus;n.status&&i&&!i(n.status)?t(new rn("Request failed with status code "+n.status,[rn.ERR_BAD_REQUEST,rn.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n)):e(n)}Te.inherits(wh,rn,{__CANCEL__:!0});const cv=function(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,i=0;const o=function(l,d){l=l||10;const h=new Array(l),f=new Array(l);let g,_=0,v=0;return d=d!==void 0?d:1e3,function(y){const b=Date.now(),D=f[v];g||(g=b),h[_]=y,f[_]=b;let I=v,O=0;for(;I!==_;)O+=h[I++],I%=l;if(_=(_+1)%l,_===v&&(v=(v+1)%l),b-g<d)return;const U=D&&b-D;return U?Math.round(1e3*O/U):void 0}}(50,250);return function(l,d){let h,f,g=0,_=1e3/d;const v=function(y){g=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Date.now(),h=null,f&&(clearTimeout(f),f=null),l(...y)};return[function(){const y=Date.now(),b=y-g;for(var D=arguments.length,I=new Array(D),O=0;O<D;O++)I[O]=arguments[O];b>=_?v(I,y):(h=I,f||(f=setTimeout(()=>{f=null,v(h)},_-b)))},()=>h&&v(h)]}(l=>{const d=l.loaded,h=l.lengthComputable?l.total:void 0,f=d-i,g=o(f);i=d,e({loaded:d,total:h,progress:h?d/h:void 0,bytes:f,rate:g||void 0,estimated:g&&h&&d<=h?(h-d)/g:void 0,event:l,lengthComputable:h!=null,[t?"download":"upload"]:!0})},n)},dM=(e,t)=>{const n=e!=null;return[i=>t[0]({lengthComputable:n,total:e,loaded:i}),t[1]]},uM=e=>function(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return Te.asap(()=>e(...n))};var lce=ui.hasStandardBrowserEnv?((e,t)=>n=>(n=new PE(n,ui.origin),e.protocol===n.protocol&&e.host===n.host&&(t||e.port===n.port)))(new PE(ui.origin),ui.navigator&&/(msie|trident)/i.test(ui.navigator.userAgent)):()=>!0,Ace=ui.hasStandardBrowserEnv?{write(e,t,n,i,o,l,d){if(typeof document>"u")return;const h=["".concat(e,"=").concat(encodeURIComponent(t))];Te.isNumber(n)&&h.push("expires=".concat(new Date(n).toUTCString())),Te.isString(i)&&h.push("path=".concat(i)),Te.isString(o)&&h.push("domain=".concat(o)),l===!0&&h.push("secure"),Te.isString(d)&&h.push("SameSite=".concat(d)),document.cookie=h.join("; ")},read(e){if(typeof document>"u")return null;const t=document.cookie.match(new RegExp("(?:^|; )"+e+"=([^;]*)"));return t?decodeURIComponent(t[1]):null},remove(e){this.write(e,"",Date.now()-864e5,"/")}}:{write(){},read:()=>null,remove(){}};function hM(e,t,n){let i=!function(o){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(o)}(t);return e&&(i||n==0)?function(o,l){return l?o.replace(/\/?\/$/,"")+"/"+l.replace(/^\/+/,""):o}(e,t):t}function pM(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}function OT(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?pM(Object(n),!0).forEach(function(i){x(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):pM(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}const fM=e=>e instanceof Oo?OT({},e):e;function _d(e,t){t=t||{};const n={};function i(g,_,v,y){return Te.isPlainObject(g)&&Te.isPlainObject(_)?Te.merge.call({caseless:y},g,_):Te.isPlainObject(_)?Te.merge({},_):Te.isArray(_)?_.slice():_}function o(g,_,v,y){return Te.isUndefined(_)?Te.isUndefined(g)?void 0:i(void 0,g,0,y):i(g,_,0,y)}function l(g,_){if(!Te.isUndefined(_))return i(void 0,_)}function d(g,_){return Te.isUndefined(_)?Te.isUndefined(g)?void 0:i(void 0,g):i(void 0,_)}function h(g,_,v){return v in t?i(g,_):v in e?i(void 0,g):void 0}const f={url:l,method:l,data:l,baseURL:d,transformRequest:d,transformResponse:d,paramsSerializer:d,timeout:d,timeoutMessage:d,withCredentials:d,withXSRFToken:d,adapter:d,responseType:d,xsrfCookieName:d,xsrfHeaderName:d,onUploadProgress:d,onDownloadProgress:d,decompress:d,maxContentLength:d,maxBodyLength:d,beforeRedirect:d,transport:d,httpAgent:d,httpsAgent:d,cancelToken:d,socketPath:d,responseEncoding:d,validateStatus:h,headers:(g,_,v)=>o(fM(g),fM(_),0,!0)};return Te.forEach(Object.keys(OT(OT({},e),t)),function(g){const _=f[g]||o,v=_(e[g],t[g],g);Te.isUndefined(v)&&_!==h||(n[g]=v)}),n}var mM=e=>{const t=_d({},e);let{data:n,withXSRFToken:i,xsrfHeaderName:o,xsrfCookieName:l,headers:d,auth:h}=t;if(t.headers=d=Oo.from(d),t.url=BP(hM(t.baseURL,t.url,t.allowAbsoluteUrls),e.params,e.paramsSerializer),h&&d.set("Authorization","Basic "+btoa((h.username||"")+":"+(h.password?unescape(encodeURIComponent(h.password)):""))),Te.isFormData(n)){if(ui.hasStandardBrowserEnv||ui.hasStandardBrowserWebWorkerEnv)d.setContentType(void 0);else if(Te.isFunction(n.getHeaders)){const f=n.getHeaders(),g=["content-type","content-length"];Object.entries(f).forEach(_=>{let[v,y]=_;me(g).call(g,v.toLowerCase())&&d.set(v,y)})}}if(ui.hasStandardBrowserEnv&&(i&&Te.isFunction(i)&&(i=i(t)),i||i!==!1&&lce(t.url))){const f=o&&l&&Ace.read(l);f&&d.set(o,f)}return t},dce=typeof XMLHttpRequest<"u"&&function(e){return new be(function(t,n){const i=mM(e);let o=i.data;const l=Oo.from(i.headers).normalize();let d,h,f,g,_,{responseType:v,onUploadProgress:y,onDownloadProgress:b}=i;function D(){g&&g(),_&&_(),i.cancelToken&&i.cancelToken.unsubscribe(d),i.signal&&i.signal.removeEventListener("abort",d)}let I=new XMLHttpRequest;function O(){if(!I)return;const j=Oo.from("getAllResponseHeaders"in I&&I.getAllResponseHeaders());AM(function(G){t(G),D()},function(G){n(G),D()},{data:v&&v!=="text"&&v!=="json"?I.response:I.responseText,status:I.status,statusText:I.statusText,headers:j,config:e,request:I}),I=null}I.open(i.method.toUpperCase(),i.url,!0),I.timeout=i.timeout,"onloadend"in I?I.onloadend=O:I.onreadystatechange=function(){I&&I.readyState===4&&(I.status!==0||I.responseURL&&I.responseURL.indexOf("file:")===0)&&setTimeout(O)},I.onabort=function(){I&&(n(new rn("Request aborted",rn.ECONNABORTED,e,I)),I=null)},I.onerror=function(j){const G=new rn(j&&j.message?j.message:"Network Error",rn.ERR_NETWORK,e,I);G.event=j||null,n(G),I=null},I.ontimeout=function(){let j=i.timeout?"timeout of "+i.timeout+"ms exceeded":"timeout exceeded";const G=i.transitional||LP;i.timeoutErrorMessage&&(j=i.timeoutErrorMessage),n(new rn(j,G.clarifyTimeoutError?rn.ETIMEDOUT:rn.ECONNABORTED,e,I)),I=null},o===void 0&&l.setContentType(null),"setRequestHeader"in I&&Te.forEach(l.toJSON(),function(j,G){I.setRequestHeader(G,j)}),Te.isUndefined(i.withCredentials)||(I.withCredentials=!!i.withCredentials),v&&v!=="json"&&(I.responseType=i.responseType),b&&([f,_]=cv(b,!0),I.addEventListener("progress",f)),y&&I.upload&&([h,g]=cv(y),I.upload.addEventListener("progress",h),I.upload.addEventListener("loadend",g)),(i.cancelToken||i.signal)&&(d=j=>{I&&(n(!j||j.type?new wh(null,e,I):j),I.abort(),I=null)},i.cancelToken&&i.cancelToken.subscribe(d),i.signal&&(i.signal.aborted?d():i.signal.addEventListener("abort",d)));const U=function(j){const G=/^([-+\w]{1,25})(:?\/\/|:)/.exec(j);return G&&G[1]||""}(i.url);U&&ui.protocols.indexOf(U)===-1?n(new rn("Unsupported protocol "+U+":",rn.ERR_BAD_REQUEST,e)):I.send(o||null)})},uce=(e,t)=>{const{length:n}=e=e?e.filter(Boolean):[];if(t||n){let i,o=new AbortController;const l=function(g){if(!i){i=!0,h();const _=g instanceof Error?g:this.reason;o.abort(_ instanceof rn?_:new wh(_ instanceof Error?_.message:_))}};let d=t&&setTimeout(()=>{d=null,l(new rn("timeout ".concat(t," of ms exceeded"),rn.ETIMEDOUT))},t);const h=()=>{e&&(d&&clearTimeout(d),d=null,e.forEach(g=>{g.unsubscribe?g.unsubscribe(l):g.removeEventListener("abort",l)}),e=null)};e.forEach(g=>g.addEventListener("abort",l));const{signal:f}=o;return f.unsubscribe=()=>Te.asap(h),f}},xT=A(eL),gM=gh.f("asyncIterator"),hce=A(gM);function DT(e,t){this.v=e,this.k=t}function qs(e){return function(){return new pm(e.apply(this,arguments))}}function pm(e){var t,n;function i(l,d){try{var h=e[l](d),f=h.value,g=f instanceof DT;xT.resolve(g?f.v:f).then(function(_){if(g){var v=l==="return"?"return":"next";if(!f.k||_.done)return i(v,_);_=e[v](_).value}o(h.done?"return":"normal",_)},function(_){i("throw",_)})}catch(_){o("throw",_)}}function o(l,d){switch(l){case"return":t.resolve({value:d,done:!0});break;case"throw":t.reject(d);break;default:t.resolve({value:d,done:!1})}(t=t.next)?i(t.key,t.arg):n=null}this._invoke=function(l,d){return new xT(function(h,f){var g={key:l,arg:d,resolve:h,reject:f,next:null};n?n=n.next=g:(t=n=g,i(l,d))})},typeof e.return!="function"&&(this.return=void 0)}function ft(e){return new DT(e,0)}function bh(e){var t={},n=!1;function i(o,l){return n=!0,l=new xT(function(d){d(e[o](l))}),{done:!1,value:new DT(l,1)}}return t[yh!==void 0&&W2||"@@iterator"]=function(){return this},t.next=function(o){return n?(n=!1,o):i("next",o)},typeof e.throw=="function"&&(t.throw=function(o){if(n)throw n=!1,o;return i("throw",o)}),typeof e.return=="function"&&(t.return=function(o){return n?(n=!1,o):i("return",o)}),t}pm.prototype[typeof yh=="function"&&hce||"@@asyncIterator"]=function(){return this},pm.prototype.next=function(e){return this._invoke("next",e)},pm.prototype.throw=function(e){return this._invoke("throw",e)},pm.prototype.return=function(e){return this._invoke("return",e)};var lv=A(gM);function BT(e){var t,n,i,o=2;for(typeof Symbol<"u"&&(n=lv,i=Symbol.iterator);o--;){if(n&&(t=e[n])!=null)return t.call(e);if(i&&(t=e[i])!=null)return new Av(t.call(e));n="@@asyncIterator",i="@@iterator"}throw new TypeError("Object is not async iterable")}function Av(e){function t(n){if(Object(n)!==n)return be.reject(new TypeError(n+" is not an object."));var i=n.done;return be.resolve(n.value).then(function(o){return{value:o,done:i}})}return Av=function(n){this.s=n,this.n=n.next},Av.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(n){var i=this.s.return;return i===void 0?be.resolve({value:n,done:!0}):t(i.apply(this.s,arguments))},throw:function(n){var i=this.s.return;return i===void 0?be.reject(n):t(i.apply(this.s,arguments))}},new Av(e)}const pce=function*(e,t){let n=e.byteLength;if(!t||n<t)return void(yield e);let i,o=0;for(;o<n;)i=o+t,yield e.slice(o,i),o=i},fce=function(){var e=qs(function*(t,n){var i,o=!1,l=!1;try{for(var d,h=BT(mce(t));o=!(d=yield ft(h.next())).done;o=!1){const f=d.value;yield*bh(BT(pce(f,n)))}}catch(f){l=!0,i=f}finally{try{o&&h.return!=null&&(yield ft(h.return()))}finally{if(l)throw i}}});return function(t,n){return e.apply(this,arguments)}}(),mce=function(){var e=qs(function*(t){if(t[lv])return void(yield*bh(BT(t)));const n=t.getReader();try{for(;;){const{done:i,value:o}=yield ft(n.read());if(i)break;yield o}}finally{yield ft(n.cancel())}});return function(t){return e.apply(this,arguments)}}(),_M=(e,t,n,i)=>{const o=fce(e,t);let l,d=0,h=f=>{l||(l=!0,i&&i(f))};return new ReadableStream({async pull(f){try{const{done:g,value:_}=await o.next();if(g)return h(),void f.close();let v=_.byteLength;if(n){let y=d+=v;n(y)}f.enqueue(new Uint8Array(_))}catch(g){throw h(g),g}},cancel:f=>(h(f),o.return())},{highWaterMark:2})};function EM(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}function vM(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?EM(Object(n),!0).forEach(function(i){x(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):EM(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}const{isFunction:dv}=Te,gce=(e=>{let{Request:t,Response:n}=e;return{Request:t,Response:n}})(Te.global),{ReadableStream:yM,TextEncoder:wM}=Te.global,bM=function(e){try{for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return!!e(...n)}catch{return!1}},_ce=e=>{e=Te.merge.call({skipUndefined:!0},gce,e);const{fetch:t,Request:n,Response:i}=e,o=t?dv(t):typeof fetch=="function",l=dv(n),d=dv(i);if(!o)return!1;const h=o&&dv(yM),f=o&&(typeof wM=="function"?(g=new wM,D=>g.encode(D)):async D=>new Uint8Array(await new n(D).arrayBuffer()));var g;const _=l&&h&&bM(()=>{let D=!1;const I=new n(ui.origin,{body:new yM,method:"POST",get duplex(){return D=!0,"half"}}).headers.has("Content-Type");return D&&!I}),v=d&&h&&bM(()=>Te.isReadableStream(new i("").body)),y={stream:v&&(D=>D.body)};o&&["text","arrayBuffer","blob","formData","stream"].forEach(D=>{!y[D]&&(y[D]=(I,O)=>{let U=I&&I[D];if(U)return U.call(I);throw new rn("Response type '".concat(D,"' is not supported"),rn.ERR_NOT_SUPPORT,O)})});const b=async(D,I)=>{const O=Te.toFiniteNumber(D.getContentLength());return O??(async U=>U==null?0:Te.isBlob(U)?U.size:Te.isSpecCompliantForm(U)?(await new n(ui.origin,{method:"POST",body:U}).arrayBuffer()).byteLength:Te.isArrayBufferView(U)||Te.isArrayBuffer(U)?U.byteLength:(Te.isURLSearchParams(U)&&(U+=""),Te.isString(U)?(await f(U)).byteLength:void 0))(I)};return async D=>{let{url:I,method:O,data:U,signal:j,cancelToken:G,timeout:$,onDownloadProgress:Z,onUploadProgress:X,responseType:ee,headers:le,withCredentials:fe="same-origin",fetchOptions:Ie}=mM(D),et=t||fetch;ee=ee?(ee+"").toLowerCase():"text";let Je=uce([j,G&&G.toAbortSignal()],$),pt=null;const ct=Je&&Je.unsubscribe&&(()=>{Je.unsubscribe()});let jt;try{if(X&&_&&O!=="get"&&O!=="head"&&(jt=await b(le,U))!==0){let R,H=new n(I,{method:"POST",body:U,duplex:"half"});if(Te.isFormData(U)&&(R=H.headers.get("content-type"))&&le.setContentType(R),H.body){const[J,_e]=dM(jt,cv(uM(X)));U=_M(H.body,65536,J,_e)}}Te.isString(fe)||(fe=fe?"include":"omit");const bn=l&&"credentials"in n.prototype,he=vM(vM({},Ie),{},{signal:Je,method:O.toUpperCase(),headers:le.normalize().toJSON(),body:U,duplex:"half",credentials:bn?fe:void 0});pt=l&&new n(I,he);let ve=await(l?et(pt,Ie):et(I,he));const Be=v&&(ee==="stream"||ee==="response");if(v&&(Z||Be&&ct)){const R={};["status","statusText","headers"].forEach(it=>{R[it]=ve[it]});const H=Te.toFiniteNumber(ve.headers.get("content-length")),[J,_e]=Z&&dM(H,cv(uM(Z),!0))||[];ve=new i(_M(ve.body,65536,J,()=>{_e&&_e(),ct&&ct()}),R)}ee=ee||"text";let pe=await y[Te.findKey(y,ee)||"text"](ve,D);return!Be&&ct&&ct(),await new be((R,H)=>{AM(R,H,{data:pe,headers:Oo.from(ve.headers),status:ve.status,statusText:ve.statusText,config:D,request:pt})})}catch(bn){throw ct&&ct(),bn&&bn.name==="TypeError"&&/Load failed|fetch/i.test(bn.message)?Object.assign(new rn("Network Error",rn.ERR_NETWORK,D,pt),{cause:bn.cause||bn}):rn.from(bn,bn&&bn.code,D,pt)}}},Ece=new Map,SM=e=>{let t=e&&e.env||{};const{fetch:n,Request:i,Response:o}=t,l=[i,o,n];let d,h,f=l.length,g=Ece;for(;f--;)d=l[f],h=g.get(d),h===void 0&&g.set(d,h=f?new Map:_ce(t)),g=h;return h};SM();const kT={http:null,xhr:dce,fetch:{get:SM}};Te.forEach(kT,(e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch{}Object.defineProperty(e,"adapterName",{value:t})}});const CM=e=>"- ".concat(e),vce=e=>Te.isFunction(e)||e===null||e===!1;var TM={getAdapter:function(e,t){e=Te.isArray(e)?e:[e];const{length:n}=e;let i,o;const l={};for(let d=0;d<n;d++){let h;if(i=e[d],o=i,!vce(i)&&(o=kT[(h=String(i)).toLowerCase()],o===void 0))throw new rn("Unknown adapter '".concat(h,"'"));if(o&&(Te.isFunction(o)||(o=o.get(t))))break;l[h||"#"+d]=o}if(!o){const d=Object.entries(l).map(h=>{let[f,g]=h;return"adapter ".concat(f," ")+(g===!1?"is not supported by the environment":"is not available in the build")});throw new rn("There is no suitable adapter to dispatch the request "+(n?d.length>1?`since :
`+d.map(CM).join(`
`):" "+CM(d[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return o},adapters:kT};function LT(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new wh(null,e)}function RM(e){return LT(e),e.headers=Oo.from(e.headers),e.data=NT.call(e,e.transformRequest),["post","put","patch"].indexOf(e.method)!==-1&&e.headers.setContentType("application/x-www-form-urlencoded",!1),TM.getAdapter(e.adapter||RT.adapter,e)(e).then(function(t){return LT(e),t.data=NT.call(e,e.transformResponse,t),t.headers=Oo.from(t.headers),t},function(t){return lM(t)||(LT(e),t&&t.response&&(t.response.data=NT.call(e,e.transformResponse,t.response),t.response.headers=Oo.from(t.response.headers))),be.reject(t)})}const IM="1.13.2",uv={};["object","boolean","number","function","string","symbol"].forEach((e,t)=>{uv[e]=function(n){return typeof n===e||"a"+(t<1?"n ":" ")+e}});const NM={};uv.transitional=function(e,t,n){function i(o,l){return"[Axios v"+IM+"] Transitional option '"+o+"'"+l+(n?". "+n:"")}return(o,l,d)=>{if(e===!1)throw new rn(i(l," has been removed"+(t?" in "+t:"")),rn.ERR_DEPRECATED);return t&&!NM[l]&&(NM[l]=!0,console.warn(i(l," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(o,l,d)}},uv.spelling=function(e){return(t,n)=>(console.warn("".concat(n," is likely a misspelling of ").concat(e)),!0)};var hv={assertOptions:function(e,t,n){if(typeof e!="object")throw new rn("options must be an object",rn.ERR_BAD_OPTION_VALUE);const i=Object.keys(e);let o=i.length;for(;o-- >0;){const l=i[o],d=t[l];if(d){const h=e[l],f=h===void 0||d(h,l,e);if(f!==!0)throw new rn("option "+l+" must be "+f,rn.ERR_BAD_OPTION_VALUE)}else if(n!==!0)throw new rn("Unknown option "+l,rn.ERR_BAD_OPTION)}},validators:uv};const lc=hv.validators;let pv=class{constructor(e){this.defaults=e||{},this.interceptors={request:new kP,response:new kP}}async request(e,t){try{return await this._request(e,t)}catch(n){if(n instanceof Error){let i={};Error.captureStackTrace?Error.captureStackTrace(i):i=new Error;const o=i.stack?i.stack.replace(/^.+\n/,""):"";try{n.stack?o&&!String(n.stack).endsWith(o.replace(/^.+\n.+\n/,""))&&(n.stack+=`
`+o):n.stack=o}catch{}}throw n}}_request(e,t){typeof e=="string"?(t=t||{}).url=e:t=e||{},t=_d(this.defaults,t);const{transitional:n,paramsSerializer:i,headers:o}=t;n!==void 0&&hv.assertOptions(n,{silentJSONParsing:lc.transitional(lc.boolean),forcedJSONParsing:lc.transitional(lc.boolean),clarifyTimeoutError:lc.transitional(lc.boolean)},!1),i!=null&&(Te.isFunction(i)?t.paramsSerializer={serialize:i}:hv.assertOptions(i,{encode:lc.function,serialize:lc.function},!0)),t.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?t.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:t.allowAbsoluteUrls=!0),hv.assertOptions(t,{baseUrl:lc.spelling("baseURL"),withXsrfToken:lc.spelling("withXSRFToken")},!0),t.method=(t.method||this.defaults.method||"get").toLowerCase();let l=o&&Te.merge(o.common,o[t.method]);o&&Te.forEach(["delete","get","head","post","put","patch","common"],b=>{delete o[b]}),t.headers=Oo.concat(l,o);const d=[];let h=!0;this.interceptors.request.forEach(function(b){typeof b.runWhen=="function"&&b.runWhen(t)===!1||(h=h&&b.synchronous,d.unshift(b.fulfilled,b.rejected))});const f=[];let g;this.interceptors.response.forEach(function(b){f.push(b.fulfilled,b.rejected)});let _,v=0;if(!h){const b=[RM.bind(this),void 0];for(b.unshift(...d),b.push(...f),_=b.length,g=be.resolve(t);v<_;)g=g.then(b[v++],b[v++]);return g}_=d.length;let y=t;for(;v<_;){const b=d[v++],D=d[v++];try{y=b(y)}catch(I){D.call(this,I);break}}try{g=RM.call(this,y)}catch(b){return be.reject(b)}for(v=0,_=f.length;v<_;)g=g.then(f[v++],f[v++]);return g}getUri(e){return BP(hM((e=_d(this.defaults,e)).baseURL,e.url,e.allowAbsoluteUrls),e.params,e.paramsSerializer)}};Te.forEach(["delete","get","head","options"],function(e){pv.prototype[e]=function(t,n){return this.request(_d(n||{},{method:e,url:t,data:(n||{}).data}))}}),Te.forEach(["post","put","patch"],function(e){function t(n){return function(i,o,l){return this.request(_d(l||{},{method:e,headers:n?{"Content-Type":"multipart/form-data"}:{},url:i,data:o}))}}pv.prototype[e]=t(),pv.prototype[e+"Form"]=t(!0)});var fv=pv;class UT{constructor(t){if(typeof t!="function")throw new TypeError("executor must be a function.");let n;this.promise=new be(function(o){n=o});const i=this;this.promise.then(o=>{if(!i._listeners)return;let l=i._listeners.length;for(;l-- >0;)i._listeners[l](o);i._listeners=null}),this.promise.then=o=>{let l;const d=new be(h=>{i.subscribe(h),l=h}).then(o);return d.cancel=function(){i.unsubscribe(l)},d},t(function(o,l,d){i.reason||(i.reason=new wh(o,l,d),n(i.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(t){this.reason?t(this.reason):this._listeners?this._listeners.push(t):this._listeners=[t]}unsubscribe(t){if(!this._listeners)return;const n=this._listeners.indexOf(t);n!==-1&&this._listeners.splice(n,1)}toAbortSignal(){const t=new AbortController,n=i=>{t.abort(i)};return this.subscribe(n),t.signal.unsubscribe=()=>this.unsubscribe(n),t.signal}static source(){let t;return{token:new UT(function(i){t=i}),cancel:t}}}var yce=UT;const PT={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511,WebServerIsDown:521,ConnectionTimedOut:522,OriginIsUnreachable:523,TimeoutOccurred:524,SslHandshakeFailed:525,InvalidSslCertificate:526};Object.entries(PT).forEach(e=>{let[t,n]=e;PT[n]=t});var wce=PT;const ps=function e(t){const n=new fv(t),i=mP(fv.prototype.request,n);return Te.extend(i,fv.prototype,n,{allOwnKeys:!0}),Te.extend(i,n,null,{allOwnKeys:!0}),i.create=function(o){return e(_d(t,o))},i}(RT);ps.Axios=fv,ps.CanceledError=wh,ps.CancelToken=yce,ps.isCancel=lM,ps.VERSION=IM,ps.toFormData=qE,ps.AxiosError=rn,ps.Cancel=ps.CanceledError,ps.all=function(e){return be.all(e)},ps.spread=function(e){return function(t){return e.apply(null,t)}},ps.isAxiosError=function(e){return Te.isObject(e)&&e.isAxiosError===!0},ps.mergeConfig=_d,ps.AxiosHeaders=Oo,ps.formToJSON=e=>oM(Te.isHTMLForm(e)?new FormData(e):e),ps.getAdapter=TM.getAdapter,ps.HttpStatusCode=wce,ps.default=ps;var Xs=ps;const bce=()=>{};function fm(){const e={promise:void 0,isResolved:!1,isRejected:!1,isFinished:!1,resolve:void 0,reject:void 0,cancel:bce};return e.promise=new be((t,n)=>{e.resolve=i=>{e.isFinished||(e.isResolved=!0,e.isFinished=!0,t(i),e.value=i)},e.reject=i=>{e.isFinished||(e.isRejected=!0,e.isFinished=!0,n(i))}}),e}const mv=new Map,gv=new Map,Ac=new Map;let br=function(e){return e.WIN_10="Windows 10",e.WIN_81="Windows 8.1",e.WIN_8="Windows 8",e.WIN_7="Windows 7",e.WIN_VISTA="Windows Vista",e.WIN_SERVER_2003="Windows Server 2003",e.WIN_XP="Windows XP",e.WIN_2000="Windows 2000",e.ANDROID="Android",e.HARMONY_OS="HarmonyOS",e.OPEN_BSD="Open BSD",e.SUN_OS="Sun OS",e.LINUX="Linux",e.IOS="iOS",e.MAC_OS="Mac OS",e.CHROMIUM_OS="Chromium OS",e.QNX="QNX",e.UNIX="UNIX",e.BEOS="BeOS",e.OS_2="OS/2",e.SEARCH_BOT="Search Bot",e}({}),Mt=function(e){return e.CHROME="Chrome",e.SAFARI="Safari",e.EDGE="Edge",e.FIREFOX="Firefox",e.OPERA="OPR",e.QQ="QQBrowser",e.WECHAT="MicroMessenger",e}({});const OM=new sie;let xo=OM.getResult(),MT=null;function Lt(e){if(!MT){xo=OM.getResult();const t=function(h){if(h.engine.name==="Blink"&&h.browser.name!=="WeChat")return Mt.CHROME;switch(h.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return Mt.CHROME;case"Safari":case"Mobile Safari":return Mt.SAFARI;case"Edge":return Mt.EDGE;case"Firefox":return Mt.FIREFOX;case"QQ":case"QQBrowser":return Mt.QQ;case"Opera":return Mt.OPERA;case"WeChat":return Mt.WECHAT;default:return h.browser.name||""}}(xo),n=xM(xo),i=function(h){return h.os.name==="Windows"?h.os.version?h.os.name+" "+h.os.version:h.os.name:h.os.name||""}(xo),o=xo.os.version,l=xM(xo,!1),d=xo.device.type;if(!(t&&n&&i&&o))return{name:t,version:n,os:i,osVersion:o,browserVersion:l,deviceType:d};MT={name:t,version:n,os:i,osVersion:o,browserVersion:l,deviceType:d}}return MT}function xM(e){let t,n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];return t=e.engine.name==="Blink"?e.engine.version||"":e.browser.version||"",n?t.split(".")[0]:t}function _v(){return Lt().os}function DM(){const e=Lt();return"".concat(e.os," ").concat(e.osVersion)}function Ev(){const e=Lt();return!!(xo.engine.name==="WebKit"&&e.os===br.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&e.name!==Mt.SAFARI||fs()&&e.name!==Mt.SAFARI)}function Kc(){return Lt().name===Mt.CHROME}function kr(){return Lt().name===Mt.SAFARI}function BM(){const e=Lt();if(e.name!==Mt.SAFARI||!e.browserVersion)return!1;const t=e.browserVersion.split(".");return Number(t[0])>15||Number(t[0])===15&&Number(t[1])>=4}function kM(){return Lt().name===Mt.EDGE}function gn(){return Lt().name===Mt.FIREFOX}function fs(){return Lt().os===br.IOS}function dc(e){const t=Lt();return!(t.name!==Mt.CHROME||!t.osVersion)&&Number(t.version)>=e}function LM(e){const t=Lt();return!(t.name!==Mt.CHROME||!t.osVersion)&&Number(t.version)<e}function FT(e,t,n){const i=Lt();return!(i.name!==e||!i.osVersion)&&(n?Number(i.version)>=t&&Number(i.version)<=n:Number(i.version)===t)}function Ed(e){const t=Lt();return!(t.name!==Mt.EDGE||!t.osVersion)&&Number(t.version)>=e}function jT(e){const t=Lt();return!(t.name!==Mt.FIREFOX||!t.osVersion)&&Number(t.version)>=e}function UM(e){const t=Lt();return!(t.name!==Mt.SAFARI||!t.osVersion)&&Number(t.version)>=e}function PM(e,t,n){const i=Lt();if(i.os!==br.IOS||!i.osVersion)return!1;const o=i.osVersion.split(".");return n?t&&Number(o[0])===e&&Number(o[1])>t||Number(o[0])>e:t?Number(o[0])===e&&Number(o[1])>=t||Number(o[0])>e:Number(o[0])>=e}function MM(e,t,n){const i=Lt();if(i.os!==br.IOS||!i.osVersion)return!1;const o=i.osVersion.split(".");return n?t&&Number(o[0])===e&&Number(o[1])<t||Number(o[0])<e:t?Number(o[0])===e&&Number(o[1])<=t||Number(o[0])<e:Number(o[0])<=e}function VT(e,t,n){const i=Lt();if(i.name!==Mt.SAFARI||!i.osVersion||!i.browserVersion)return!1;const o=i.browserVersion.split(".");return n?t&&Number(o[0])===e&&Number(o[1])<t||Number(o[0])<e:t?Number(o[0])===e&&Number(o[1])<=t||Number(o[0])<e:Number(o[0])<=e}function vd(e){const t=Lt();return!(t.name!==Mt.OPERA||!t.osVersion)&&Number(t.version)>=e}function FM(){const e=Lt();if(e.os!==br.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])<14||Number(t[0])===14&&Number(t[1])<=6}function Sh(){const e=Lt();if(e.os!==br.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])===15}function QT(){const e=Lt();if(e.os!==br.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])===16}function jM(){const e=Lt();if(e.os!==br.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])===15&&Number(t[1])>=1}function Ya(){return kr()&&navigator.maxTouchPoints>0}function VM(){return Lt().name===Mt.WECHAT}function QM(){return window.navigator.appVersion&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)!==null&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function HM(){const e=_v();return function(){const{deviceType:t}=Lt();return t==="mobile"||t==="tablet"}()||e===br.ANDROID||e===br.IOS||e===br.HARMONY_OS}function uc(){const e=Lt();return e.name!==Mt.EDGE&&e.name!==Mt.SAFARI&&!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function mm(){return _v()===br.ANDROID}function gm(){const e=Lt();return mm()&&(e.name===Mt.CHROME||e.name===Mt.WECHAT||/chrome|chromium/i.test(navigator.userAgent))}function at(e,t,n){return(t=function(i){var o=function(l,d){if(typeof l!="object"||!l)return l;var h=l[Symbol.toPrimitive];if(h!==void 0){var f=h.call(l,"string");if(typeof f!="object")return f;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(l)}(i);return typeof o=="symbol"?o:o+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function GM(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}function Ee(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?GM(Object(n),!0).forEach(function(i){at(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):GM(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}let P=function(e){return e.UNEXPECTED_ERROR="UNEXPECTED_ERROR",e.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",e.TIMEOUT="TIMEOUT",e.INVALID_PARAMS="INVALID_PARAMS",e.NOT_READABLE="NOT_READABLE",e.NOT_SUPPORTED="NOT_SUPPORTED",e.INVALID_OPERATION="INVALID_OPERATION",e.OPERATION_ABORTED="OPERATION_ABORTED",e.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",e.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",e.ADD_CANDIDATE_FAILED="ADD_CANDIDATE_FAILED",e.DATACHANNEL_FAILED="DATACHANNEL_FAILED",e.NETWORK_ERROR="NETWORK_ERROR",e.NETWORK_TIMEOUT="NETWORK_TIMEOUT",e.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",e.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",e.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",e.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",e.ELECTRON_IS_NULL="ELECTRON_IS_NULL",e.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",e.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",e.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",e.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",e.PERMISSION_DENIED="PERMISSION_DENIED",e.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",e.TRACK_IS_DISABLED="TRACK_IS_DISABLED",e.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",e.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",e.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",e.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",e.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",e.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",e.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",e.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",e.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",e.UID_CONFLICT="UID_CONFLICT",e.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",e.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",e.TOKEN_EXPIRE="TOKEN_EXPIRE",e.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",e.INVALID_TRACK="INVALID_TRACK",e.SENDER_NOT_FOUND="SENDER_NOT_FOUND",e.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",e.SET_ANSWER_FAILED="SET_ANSWER_FAILED",e.ICE_FAILED="ICE_FAILED",e.PC_CLOSED="PC_CLOSED",e.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",e.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",e.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",e.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",e.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",e.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",e.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",e.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",e.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",e.INVALID_REMOTE_USER="INVALID_REMOTE_USER",e.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",e.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",e.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",e.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",e.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",e.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",e.WS_ABORT="WS_ABORT",e.WS_DISCONNECT="WS_DISCONNECT",e.WS_ERR="WS_ERR",e.EXTERNAL_SIGNAL_ABORT="EXTERNAL_SIGNAL_ABORT",e.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",e.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",e.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",e.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",e.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",e.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",e.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",e.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",e.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",e.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",e.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",e.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",e.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",e.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",e.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",e.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",e.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",e.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",e.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",e.INVALID_PLUGIN="INVALID_PLUGIN",e.DISCONNECT_P2P="DISCONNECT_P2P",e.CONVERTING_IMAGEDATA_TO_BLOB_FAILED="CONVERTING_IMAGEDATA_TO_BLOB_FAILED",e.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED="CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED",e.INIT_DATACHANNEL_TIMEOUT="INIT_DATACHANNEL_TIMEOUT",e.CREATE_DATACHANNEL_ERROR="CREATE_DATACHANNEL_ERROR",e.DATACHANNEL_CONNECTION_TIMEOUT="DATACHANNEL_CONNECTION_TIMEOUT",e.PROHIBITED_OPERATION="PROHIBITED_OPERATION",e.IMAGE_MODERATION_UPLOAD_FAILED="IMAGE_MODERATION_UPLOAD_FAILED",e.P2P_MESSAGE_FAILED="P2P_MESSAGE_FAILED",e}({}),ae=class extends Error{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",n=arguments.length>2?arguments[2]:void 0;super(t),at(this,"code",void 0),at(this,"message",void 0),at(this,"data",void 0),at(this,"name","AgoraRTCException"),this.code=e,this.message="AgoraRTCError ".concat(this.code,": ").concat(t),this.data=n}toString(){return this.data?"".concat(this.message,`
data: `).concat(JSON.stringify(this.data)):this.message}print(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error",t=arguments.length>1?arguments[1]:void 0;return e==="error"&&(t||console).error(this.toString()),e==="warning"&&(t||console).warn(this.toString()),this}throw(e){throw this.print("error",e),this}};function za(e,t){if(typeof e!="boolean")throw new ae(P.INVALID_PARAMS,"Invalid ".concat(t,": The value is of the boolean type."))}function zn(e,t,n){if(!me(n).call(n,e))throw new ae(P.INVALID_PARAMS,"".concat(t," can only be set as ").concat(JSON.stringify(n)))}function sn(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1e4;if(e<n||e>i||(!(arguments.length>4&&arguments[4]!==void 0)||arguments[4])&&!function(o){return typeof o=="number"&&o%1==0}(e))throw new ae(P.INVALID_PARAMS,"invalid ".concat(t,": the value range is [").concat(n,", ").concat(i,"]. integer only"))}function HT(e,t){if(typeof e!="number"){if(!(e.min||e.max||e.ideal||e.exact))throw new ae(P.INVALID_PARAMS,"".concat(t," is not a valid ConstrainLong"));e.min!==void 0&&sn(e.min,"".concat(t,".min"),0,1/0),e.max!==void 0&&sn(e.max,"".concat(t,".max"),1,1/0),e.exact!==void 0&&sn(e.exact,"".concat(t,".exact"),1,1/0),e.ideal!==void 0&&sn(e.ideal,"".concat(t,".ideal"),1,1/0)}else sn(e,t,1,1/0)}function Kr(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:255,o=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4];if(e==null)throw new ae(P.INVALID_PARAMS,"".concat(t||"param"," cannot be empty"));if(!KM(e,n,i,o))throw new ae(P.INVALID_PARAMS,"Invalid ".concat(t||"string param",": Length of the string: [").concat(n,",").concat(i,"].").concat(o?" ASCII characters only.":""))}function Wc(e,t){if(!Array.isArray(e))throw new ae(P.INVALID_PARAMS,"".concat(t," should be an array"))}function kn(e){return e==null}function KM(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:255,i=!(arguments.length>3&&arguments[3]!==void 0)||arguments[3];return typeof e=="string"&&e.length<=n&&e.length>=t&&(!i||function(o){if(typeof o!="string")return!1;for(let l=0;l<o.length;l+=1){const d=o.charCodeAt(l);if(d<0||d>255)return!1}return!0}(e))}function WM(e,t,n){if("getBigUint64"in DataView.prototype)return e.getBigUint64(t,n);const i=e.getUint32(t,n),o=e.getUint32(t+4,n),l=0,d=+!n;return BigInt(i*d+o*l)<<BigInt(32)|BigInt(i*l+o*d)}function YM(e,t,n,i){if("setBigUint64"in DataView.prototype)return e.setBigUint64(t,n,i);const o=Number(n>>BigInt(32)),l=Number(n&BigInt(4294967295));e.setUint32(t,o,i),e.setUint32(t+4,l,i)}var _m=function(e){return e.COVERED="COVERED",e.POSITION="POSITION",e.SIZE="SIZE",e.STYLE="STYLE",e}(_m||{}),GT=function(e){return e.UNMOUNTED="UNMOUNTED",e.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT",e}(GT||{});const zM=new class{constructor(){at(this,"_clientSize",null),at(this,"getClientWidth",()=>document.documentElement?document.documentElement.clientWidth:document.body.clientWidth),at(this,"getClientHeight",()=>document.documentElement?document.documentElement.clientHeight:document.body.clientHeight),at(this,"getStyle",e=>window.getComputedStyle(e,null)),at(this,"checkCssVisibleProperty",e=>{var t;let n=!0;const i=this.getStyle(e),{display:o,visibility:l,opacity:d,filter:h}=i;return(o==="none"||me(t=["hidden","collapse"]).call(t,l)||Number(d)<.1)&&(n=!1),!!n&&(h&&h.split(" ").filter(f=>{var g;const _=f.split("(")[0];return me(g=["brightness","blur","opacity"]).call(g,_)}).map(f=>{const[g,_]=f.split(/\(|\)/);return[g,Number(_.match(/^[0-9\.]+/))]}).forEach(f=>{const[g,_]=f;switch(g){case"brightness":(_<.1||_>3)&&(n=!1);break;case"blur":_>3&&(n=!1);break;case"opacity":_<.1&&(n=!1)}}),n)}),at(this,"checkPropertyUpToAllParentNodes",(e,t)=>{let n=!0,i=!0;const o=d=>t(d);let l=e;for(;l&&i;)o(l)||(n=!1,i=!1),l=l.parentElement,l||(i=!1);return n}),at(this,"checkActualCssVisibleIncludeInherit",e=>this.checkPropertyUpToAllParentNodes(e,this.checkCssVisibleProperty)),at(this,"getSizeAboutClient",e=>{const{width:t,height:n,left:i,right:o,top:l,bottom:d}=e.getBoundingClientRect(),h=this.getClientWidth(),f=this.getClientHeight();return{width:t,height:n,left:i,right:o,top:l,bottom:d,clientWidth:h,clientHeight:f,clientMin:Math.min(h,f)}}),at(this,"checkActualSize",()=>{const{width:e,height:t,clientMin:n}=this._clientSize;return this.checkSizeIsVisible(e,t,n)}),at(this,"elementFromPoint",(e,t)=>document.elementFromPoint?document.elementFromPoint(e,t):null),at(this,"checkCoverForAPoint",(e,t,n)=>{const i=this.elementFromPoint(e,t);return i!==null&&i!==n}),at(this,"getPointPositionList",()=>{const{width:e,height:t,left:n,top:i}=this._clientSize,o=e/6,l=t/6,d=[],h=10**6;for(let f=0;f<5;f++)for(let g=0;g<5;g++){const _=(n*h+(f===0?.1:f===4?(o*f*h-1e5)/h:o*f)*h)/h,v=(i*h+(g===0?.1:g===4?(l*g*h-1e5)/h:l*g)*h)/h;d.push({x:_,y:v})}return[...d]}),at(this,"checkElementCover",e=>this.getPointPositionList().map(t=>this.checkCoverForAPoint(t.x,t.y,e)).filter(t=>!!t).length>6),at(this,"checkSizeIsVisible",(e,t,n)=>(e>50||n/e<=10)&&(t>50||n/t<=10)),at(this,"checkSizeOfPartInClient",()=>{const{left:e,right:t,top:n,bottom:i,clientHeight:o,clientWidth:l,clientMin:d}=this._clientSize;let h,f,g,_;if(e<0)h=0;else{if(!(e<l))return!1;h=e}if(t<0)return!1;if(f=t<l?t:l,n<0)g=0;else{if(!(n<o))return!1;g=n}if(i<0)return!1;_=i<o?i:o;const v=f-h,y=_-g;return this.checkSizeIsVisible(v,y,d)}),at(this,"returnHiddenResult",e=>(this._clientSize=null,{visible:!1,reason:e})),at(this,"checkOneElementVisible",e=>{if(e instanceof HTMLElement){if(this.checkElementIsMountedOnDom(e)){if(this.checkActualCssVisibleIncludeInherit(e)){if(this._clientSize=this.getSizeAboutClient(e),this.checkElementCover(e))return this.returnHiddenResult(_m.COVERED);{const t=this.checkActualSize(),n=this.checkSizeOfPartInClient();return t&&!n?this.returnHiddenResult(_m.POSITION):t?(this._clientSize=null,{visible:!0}):this.returnHiddenResult(_m.SIZE)}}return this.returnHiddenResult(_m.STYLE)}return this.returnHiddenResult(GT.UNMOUNTED)}return this.returnHiddenResult(GT.INVALID_HTML_ELEMENT)}),at(this,"checkElementIsMountedOnDom",e=>this.checkPropertyUpToAllParentNodes(e,t=>t.nodeName.toUpperCase()!=="HTML"?t.parentElement!==null:!!document.documentElement))}};function KT(e){return new TextEncoder().encode(e)}const qM=function(e,t){const n=new Uint8Array(e.byteLength+t.byteLength);return n.set(new Uint8Array(e),0),n.set(new Uint8Array(t),e.byteLength),n},WT=async e=>function(t,n){let i="";return new Uint8Array(t).forEach(o=>{i+=o.toString(n).padStart(2,"0")}),i}(await crypto.subtle.digest("SHA-256",KT(e)),16);let Tn=class{constructor(){at(this,"_events",{}),at(this,"addListener",this.on)}getListeners(e){return this._events[e]?this._events[e].map(t=>t.listener):[]}on(e,t){this._events[e]||(this._events[e]=[]);const n=this._events[e];this._indexOfListener(n,t)===-1&&n.push({listener:t,once:!1})}once(e,t){this._events[e]||(this._events[e]=[]);const n=this._events[e];this._indexOfListener(n,t)===-1&&n.push({listener:t,once:!0})}off(e,t){if(!this._events[e])return;const n=this._events[e],i=this._indexOfListener(n,t);i!==-1&&n.splice(i,1),this._events[e].length===0&&delete this._events[e]}removeAllListeners(e){e?delete this._events[e]:this._events={}}emit(e){this._events[e]||(this._events[e]=[]);const t=this._events[e].map(l=>l);for(var n=arguments.length,i=new Array(n>1?n-1:0),o=1;o<n;o++)i[o-1]=arguments[o];for(let l=0;l<t.length;l+=1){const d=t[l];d.once&&this.off(e,d.listener),d.listener.apply(this,i||[])}}safeEmit(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];[...this._events[e]||[]].forEach(o=>{o.once&&this.off(e,o.listener);try{o.listener.apply(this,n)}catch(l){console.error("safeEmit event:".concat(e," error ").concat(l==null?void 0:l.toString()))}})}_indexOfListener(e,t){let n=e.length;for(;n--;)if(e[n].listener===t)return n;return-1}},Em=null;function XM(){if(Em)return Em;if(window.electron)return Em=window.electron;if(!window.require)return null;try{return Em=window.require("electron"),Em}catch{return null}}let yn=function(e){return e.CREATE_CLIENT="createClient",e.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",e.SET_AREA="setArea",e.PRELOAD="PRELOAD",e.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",e.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",e.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",e.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",e.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",e.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",e.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",e.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",e.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",e.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",e.START_PROXY_SERVER="Client.startProxyServer",e.STOP_PROXY_SERVER="Client.stopProxyServer",e.SET_PROXY_SERVER="Client.setProxyServer",e.SET_TURN_SERVER="Client.setTurnServer",e.SET_CLIENT_ROLE="Client.setClientRole",e.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",e.ENABLE_DUAL_STREAM="Client.enableDualStream",e.DISABLE_DUAL_STREAM="Client.disableDualStream",e.JOIN="Client.join",e.LEAVE="Client.leave",e.PUBLISH="Client.publish",e.UNPUBLISH="Client.unpublish",e.SUBSCRIBE="Client.subscribe",e.MASS_SUBSCRIBE="Client.massSubscribe",e.MASS_UNSUBSCRIBE="Client.massUnsubscribe",e.UNSUBSCRIBE="Client.unsubscribe",e.RENEW_TOKEN="Client.renewToken",e.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",e.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",e.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",e.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",e.INSPECT_VIDEO_CONTENT="Client.inspectVideoContent",e.STOP_INSPECT_VIDEO_CONTENT="Client.stopInspectVideoContent",e.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",e.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",e.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",e.START_LIVE_STREAMING="Client.startLiveStreaming",e.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",e.STOP_LIVE_STREAMING="Client.stopLiveStreaming",e.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",e.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",e.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",e.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",e.SET_CONFIG_DISTRIBUTE="_configDistribute",e.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",e.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",e.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",e.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",e.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",e.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",e.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",e.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",e.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",e.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",e.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",e.LOCAL_VIDEO_SEND_SEI_DATA="LocalVideoTrack.sendSeiData",e.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",e.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",e.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",e.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",e.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",e.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",e.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",e.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",e.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",e.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",e.STREAM_TYPE_CHANGE="streamTypeChange",e.CONNECTION_STATE_CHANGE="connectionStateChange",e.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage",e.IMAGE_MODERATION_UPLOAD="imageModerationUpload",e.REPUB_AFTER_PC_CONNECTED="repubAfterPCConnected",e.PRELOAD_MEDIA_FAILED="preloadMediaFailed",e.MISMATCH_DTLS_PARAMETERS="mismatchDtlsParameters",e.VOS_FALLBACK_CN="vosFallbackCN",e.DATACHANNEL_FAILBACK="datachannelFailback",e}({}),an=function(e){return e.TRACER="tracer",e}({});function JM(e){return sn(e.timeout,"config.timeout",0,1e5),sn(e.timeoutFactor,"config.timeoutFactor",0,100,!1),sn(e.maxRetryCount,"config.maxRetryConfig",0,1/0),sn(e.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}let Sce=function(e){return e[e.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",e[e.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",e[e.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY",e}({}),Ct=function(e){return e.LEAVE="LEAVE",e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.UID_BANNED="UID_BANNED",e.FALLBACK="FALLBACK",e.IP_BANNED="IP_BANNED",e.CHANNEL_BANNED="CHANNEL_BANNED",e.LICENSE_MISSING="LICENSE_MISSING",e.LICENSE_EXPIRED="LICENSE_EXPIRED",e.LICENSE_MINUTES_EXCEEDED="LICENSE_MINUTES_EXCEEDED",e.LICENSE_PERIOD_INVALID="LICENSE_PERIOD_INVALID",e.LICENSE_MULTIPLE_SDK_SERVICE="LICENSE_MULTIPLE_SDK_SERVICE",e.LICENSE_ILLEGAL="LICENSE_ILLEGAL",e.TOKEN_EXPIRE="TOKEN_EXPIRE",e.FALLBACK_TO_HLS="FALLBACK_TO_HLS",e.UID_CONFLICT="UID_CONFLICT",e}({});function yd(e){if(!Array.isArray(e)||e.length<1)return!1;try{e.forEach(t=>{if(!t.urls)throw Error()})}catch{return!1}return!0}function $M(e){return Kr(e.turnServerURL,"turnServerURL"),Kr(e.username,"username"),Kr(e.password,"password"),e.udpport&&sn(e.udpport,"udpport",1,99999,!0),e.forceturn&&za(e.forceturn,"forceturn"),e.security&&za(e.security,"security"),e.tcpport&&sn(e.tcpport,"tcpport",1,99999,!0),!0}let Ch=function(e){return e[e.AUTO_SIMULCAST_STREAM=-1]="AUTO_SIMULCAST_STREAM",e[e.DISABLE_SIMULCAST_STREM=0]="DISABLE_SIMULCAST_STREM",e[e.ENABLE_SIMULCAST_STREAM=1]="ENABLE_SIMULCAST_STREAM",e}({});function YT(e){return e.level!==void 0&&zn(e.level,"level",[1,2,3]),e.delay!==void 0&&sn(e.delay,"delay",0,3e3,!0),!0}let _t=function(e){return e.PEERCONNECTION_STATE_CHANGE="peerconnection-state-change",e.AUDIO_METADATA="audio-metadata",e.AUDIO_PTS="audio-pts",e.CONNECTION_STATE_CHANGE="connection-state-change",e.MEDIA_RECONNECT_START="media-reconnect-start",e.MEDIA_RECONNECT_END="media-reconnect-end",e.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",e.USER_JOINED="user-joined",e.USER_LEAVED="user-left",e.USER_PUBLISHED="user-published",e.USER_UNPUBLISHED="user-unpublished",e.USER_INFO_UPDATED="user-info-updated",e.CLIENT_BANNED="client-banned",e.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",e.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",e.VOLUME_INDICATOR="volume-indicator",e.CRYPT_ERROR="crypt-error",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGED="stream-type-changed",e.STREAM_FALLBACK="stream-fallback",e.RECEIVE_METADATA="receive-metadata",e.STREAM_MESSAGE="stream-message",e.LIVE_STREAMING_ERROR="live-streaming-error",e.LIVE_STREAMING_WARNING="live-streaming-warning",e.EXCEPTION="exception",e.ERROR="error",e.P2P_LOST="p2p_lost",e.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy",e.CHANNEL_FALLBACK_TO_WEBSOCKET="channel-fallback-to-websocket",e.MEDIA_CONNECTION_TYPE_CHANGE="media-connection-type-change",e.PUBLISHED_USER_LIST="published-user-list",e.CONTENT_INSPECT_CONNECTION_STATE_CHANGE="content-inspect-connection-state-change",e.CONTENT_INSPECT_ERROR="content-inspect-error",e.CONTENT_INSPECT_RESULT="content-inspect-result",e.IMAGE_MODERATION_CONNECTION_STATE_CHANGE="image-moderation-connection-state-change",e.FALLBACK_TO_HLS="fallback-to-hls",e.FIRST_VIDEO_BUFFER_READY="first-video-buffer-ready",e.FIRST_VIDEO_PRE_RENDER="first-video-pre-render",e.AV1_DECODABLE_RESULT="av1-decodable-result",e}({}),zT=function(e){return e.CONFIG="config",e.VOSERROR="vos_error",e.AP_ERROR="ap_error",e}({}),Jr=function(e){return e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.MULTI_IP="MULTI_IP",e.TIMEOUT="TIMEOUT",e.OFFLINE="OFFLINE",e.LEAVE="LEAVE",e.P2P_FAILED="P2P_FAILED",e.FALLBACK="FALLBACK",e.REGIONAL_DISTRIBUTION="REGIONAL_DISTRIBUTION",e}({}),Us=function(e){return e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e}({}),wd=function(e){return e.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e}({});function ir(e,t){for(var n=arguments.length,i=new Array(n>2?n-2:0),o=2;o<n;o++)i[o-2]=arguments[o];return e.getListeners(t).length===0?be.reject(new ae(P.UNEXPECTED_ERROR,"can not emit promise")):new be((l,d)=>{e.emit(t,...i,l,d)})}function ln(e,t){if(e.getListeners(t).length===0)return be.resolve();for(var n=arguments.length,i=new Array(n>2?n-2:0),o=2;o<n;o++)i[o-2]=arguments[o];return ir(e,t,...i)}function Ni(e,t){if(e.getListeners(t).length===0)return null;for(var n=arguments.length,i=new Array(n>2?n-2:0),o=2;o<n;o++)i[o-2]=arguments[o];return bd(e,t,...i)}function bd(e,t){let n=null,i=null;for(var o=arguments.length,l=new Array(o>2?o-2:0),d=2;d<o;d++)l[d-2]=arguments[d];if(e.emit(t,...l,h=>{n=h},h=>{i=h}),i!==null)throw i;if(n===null)throw new ae(P.UNEXPECTED_ERROR,"handler is not sync");return n}const Ln=new class extends Tn{set networkState(e){this.emit(wd.NETWORK_STATE_CHANGE,e,this._networkState),e===Us.ONLINE?this.emit(wd.ONLINE):e===Us.OFFLINE&&(this.onlineWaiter=new be(t=>{this.once(wd.ONLINE,()=>{this.onlineWaiter=void 0,t(Us.ONLINE)})}),this.emit(wd.OFFLINE)),this._networkState=e}get networkState(){return this._networkState}get isOnline(){return this._networkState===Us.ONLINE}constructor(){super(),at(this,"_moduleName","network-indicator"),at(this,"_networkState",Us.ONLINE),at(this,"onlineWaiter",void 0),window.addEventListener("online",()=>{this.networkState=Us.ONLINE}),window.addEventListener("offline",()=>{this.networkState=Us.OFFLINE})}},Js=[];for(let e=0;e<256;++e)Js.push((e+256).toString(16).slice(1));const ZM=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);let qT;const Cce=new Uint8Array(16);function Tce(){return ZM?ZM():function(n,i,o){var l,d,h,f;const g=(l=(d=(n=n||{}).random)!==null&&d!==void 0?d:(h=(f=n).rng)===null||h===void 0?void 0:h.call(f))!==null&&l!==void 0?l:function(){if(!qT){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");qT=crypto.getRandomValues.bind(crypto)}return qT(Cce)}();if(g.length<16)throw new Error("Random bytes length must be >= 16");if(g[6]=15&g[6]|64,g[8]=63&g[8]|128,i){if((o=o||0)<0||o+16>i.length)throw new RangeError("UUID byte range ".concat(o,":").concat(o+15," is out of buffer bounds"));for(let _=0;_<16;++_)i[o+_]=g[_];return i}return function(_){let v=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return(Js[_[v+0]]+Js[_[v+1]]+Js[_[v+2]]+Js[_[v+3]]+"-"+Js[_[v+4]]+Js[_[v+5]]+"-"+Js[_[v+6]]+Js[_[v+7]]+"-"+Js[_[v+8]]+Js[_[v+9]]+"-"+Js[_[v+10]]+Js[_[v+11]]+Js[_[v+12]]+Js[_[v+13]]+Js[_[v+14]]+Js[_[v+15]]).toLowerCase()}(g)}(e,t,void 0);var e,t}function vv(e,t){const n=e.indexOf(t);n!==-1&&e.splice(n,1)}function Th(e){const t=[];return e.forEach(n=>{t.indexOf(n)===-1&&t.push(n)}),t}function yv(e){be!==void 0?be.resolve().then(e):setTimeout(e,0)}function _n(e){return JSON.parse(JSON.stringify(e))}function Sd(e){try{return _n(e)}catch{return e}}const eF={};function Gl(e,t){eF[t]||(eF[t]=!0,e())}function Cd(e){const t=window.atob(e),n=new Uint8Array(new ArrayBuffer(t.length));for(let i=0;i<t.length;i+=1)n[i]=t.charCodeAt(i);return n}function Kl(e){let t="";for(let n=0;n<e.length;n+=1)t+=String.fromCharCode(e[n]);return window.btoa(t)}function tF(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,n=new TextEncoder().encode(e);if(n.length>t)n=n.slice(0,t);else if(n.length<t){const i=new Uint8Array(t);i.set(n),n=i}return n}function nF(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const i=ca(t).call(t,(d,h)=>d+h.length,0),o=new Uint8Array(new ArrayBuffer(i));let l=0;return t.forEach(d=>{o.set(d,l),l+=d.length}),o}function hc(e){return window.TextEncoder?new TextEncoder().encode(e).length:e.length}function rF(e){let t=0;return(/DingTalk/i.test(navigator.userAgent)||/AliApp/i.test(navigator.userAgent))&&e.realFormData&&(e=e.realFormData),e.forEach(n=>{t+=typeof n=="string"?hc(n):n.size}),t+138}function Rce(e){const t=new ae(P.TIMEOUT,"timeout");return new be((n,i)=>{window.setTimeout(()=>i(t),e)})}function Sr(e){return new be(t=>{window.setTimeout(t,e)})}function zt(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:7,t=arguments.length>1?arguments[1]:void 0;const n=Math.random().toString(16).substr(2,e).toLowerCase();return n.length===e?"".concat(t).concat(n):"".concat(t).concat(n)+zt(e-n.length,"")}function Td(){let e,t=!1;try{var n;e=rie(n=Tce()).call(n,"-","")}catch{t=!0}return!t&&e&&e.length===32||(e=zt(32,"")),e.toUpperCase()}const vm=()=>{},sF=new class{constructor(){at(this,"fnMap",new Map)}throttleByKey(e,t,n,i){for(var o=arguments.length,l=new Array(o>4?o-4:0),d=4;d<o;d++)l[d-4]=arguments[d];if(this.fnMap.has(t)){const h=this.fnMap.get(t);if(h.threshold!==n){h.fn(...h.args),clearTimeout(h.timer);const f=window.setTimeout(()=>{const g=this.fnMap.get(t);g&&g.fn(...g.args),this.fnMap.delete(t)},n);this.fnMap.set(t,{fn:e,threshold:n,timer:f,args:l,skipFn:i})}else h.skipFn&&h.skipFn(...h.args),this.fnMap.set(t,Ee(Ee({},h),{},{fn:e,args:l,skipFn:i}))}else{const h=window.setTimeout(()=>{const f=this.fnMap.get(t);f&&f.fn(...f.args),this.fnMap.delete(t)},n);this.fnMap.set(t,{fn:e,threshold:n,timer:h,args:l,skipFn:i})}}},iF=sF.throttleByKey.bind(sF);function aF(e){return typeof e=="object"&&e!==null&&!(e instanceof RegExp)}function XT(e,t){if(!aF(e)||!aF(t)||Array.isArray(e)&&!Array.isArray(t)||!Array.isArray(e)&&Array.isArray(t))return t;if(Array.isArray(t)&&Array.isArray(e)){const n=[...e];for(let i=0;i<t.length;i++)n[i]=XT(e[i],t[i]);return n}{const n=Ee({},e);for(const i in t)Object.prototype.hasOwnProperty.call(t,i)&&(Object.prototype.hasOwnProperty.call(e,i)?n[i]=XT(e[i],t[i]):n[i]=t[i]);return n}}function oF(e,t){let n=[0];if(n=new Array(t).fill(0),e===0)return n;let i=0;for(;e>0&&(n[i]=255&e,e>>=8,i++,i!==t););return n}function Rh(e){return typeof e=="number"?e:e.exact||e.ideal||e.max||e.min||0}function JT(e,t){try{return typeof e=="object"&&typeof t=="object"&&JSON.stringify(e)===JSON.stringify(t)}catch{return!1}}function $T(e){return ca(e).call(e,(t,n)=>t+n,0)}function cF(e){const t="0123456789abcdef";function n(G){let $,Z="";for($=0;$<=3;$++)Z+=t.charAt(G>>8*$+4&15)+t.charAt(G>>8*$&15);return Z}function i(G,$){const Z=(65535&G)+(65535&$);return(G>>16)+($>>16)+(Z>>16)<<16|65535&Z}function o(G,$,Z,X,ee,le){return i(function(fe,Ie){return fe<<Ie|fe>>>32-Ie}(i(i($,G),i(X,le)),ee),Z)}function l(G,$,Z,X,ee,le,fe){return o($&Z|~$&X,G,$,ee,le,fe)}function d(G,$,Z,X,ee,le,fe){return o($&X|Z&~X,G,$,ee,le,fe)}function h(G,$,Z,X,ee,le,fe){return o($^Z^X,G,$,ee,le,fe)}function f(G,$,Z,X,ee,le,fe){return o(Z^($|~X),G,$,ee,le,fe)}const g=function(G){let $;const Z=1+(G.length+8>>6),X=new Array(16*Z);for($=0;$<16*Z;$++)X[$]=0;for($=0;$<G.length;$++)X[$>>2]|=G.charCodeAt($)<<$%4*8;return X[$>>2]|=128<<$%4*8,X[16*Z-2]=8*G.length,X}(e);let _,v,y,b,D,I=1732584193,O=-271733879,U=-1732584194,j=271733878;for(_=0;_<g.length;_+=16)v=I,y=O,b=U,D=j,I=l(I,O,U,j,g[_+0],7,-680876936),j=l(j,I,O,U,g[_+1],12,-389564586),U=l(U,j,I,O,g[_+2],17,606105819),O=l(O,U,j,I,g[_+3],22,-1044525330),I=l(I,O,U,j,g[_+4],7,-176418897),j=l(j,I,O,U,g[_+5],12,1200080426),U=l(U,j,I,O,g[_+6],17,-1473231341),O=l(O,U,j,I,g[_+7],22,-45705983),I=l(I,O,U,j,g[_+8],7,1770035416),j=l(j,I,O,U,g[_+9],12,-1958414417),U=l(U,j,I,O,g[_+10],17,-42063),O=l(O,U,j,I,g[_+11],22,-1990404162),I=l(I,O,U,j,g[_+12],7,1804603682),j=l(j,I,O,U,g[_+13],12,-40341101),U=l(U,j,I,O,g[_+14],17,-1502002290),O=l(O,U,j,I,g[_+15],22,1236535329),I=d(I,O,U,j,g[_+1],5,-165796510),j=d(j,I,O,U,g[_+6],9,-1069501632),U=d(U,j,I,O,g[_+11],14,643717713),O=d(O,U,j,I,g[_+0],20,-373897302),I=d(I,O,U,j,g[_+5],5,-701558691),j=d(j,I,O,U,g[_+10],9,38016083),U=d(U,j,I,O,g[_+15],14,-660478335),O=d(O,U,j,I,g[_+4],20,-405537848),I=d(I,O,U,j,g[_+9],5,568446438),j=d(j,I,O,U,g[_+14],9,-1019803690),U=d(U,j,I,O,g[_+3],14,-187363961),O=d(O,U,j,I,g[_+8],20,1163531501),I=d(I,O,U,j,g[_+13],5,-1444681467),j=d(j,I,O,U,g[_+2],9,-51403784),U=d(U,j,I,O,g[_+7],14,1735328473),O=d(O,U,j,I,g[_+12],20,-1926607734),I=h(I,O,U,j,g[_+5],4,-378558),j=h(j,I,O,U,g[_+8],11,-2022574463),U=h(U,j,I,O,g[_+11],16,1839030562),O=h(O,U,j,I,g[_+14],23,-35309556),I=h(I,O,U,j,g[_+1],4,-1530992060),j=h(j,I,O,U,g[_+4],11,1272893353),U=h(U,j,I,O,g[_+7],16,-155497632),O=h(O,U,j,I,g[_+10],23,-1094730640),I=h(I,O,U,j,g[_+13],4,681279174),j=h(j,I,O,U,g[_+0],11,-358537222),U=h(U,j,I,O,g[_+3],16,-722521979),O=h(O,U,j,I,g[_+6],23,76029189),I=h(I,O,U,j,g[_+9],4,-640364487),j=h(j,I,O,U,g[_+12],11,-421815835),U=h(U,j,I,O,g[_+15],16,530742520),O=h(O,U,j,I,g[_+2],23,-995338651),I=f(I,O,U,j,g[_+0],6,-198630844),j=f(j,I,O,U,g[_+7],10,1126891415),U=f(U,j,I,O,g[_+14],15,-1416354905),O=f(O,U,j,I,g[_+5],21,-57434055),I=f(I,O,U,j,g[_+12],6,1700485571),j=f(j,I,O,U,g[_+3],10,-1894986606),U=f(U,j,I,O,g[_+10],15,-1051523),O=f(O,U,j,I,g[_+1],21,-2054922799),I=f(I,O,U,j,g[_+8],6,1873313359),j=f(j,I,O,U,g[_+15],10,-30611744),U=f(U,j,I,O,g[_+6],15,-1560198380),O=f(O,U,j,I,g[_+13],21,1309151649),I=f(I,O,U,j,g[_+4],6,-145523070),j=f(j,I,O,U,g[_+11],10,-1120210379),U=f(U,j,I,O,g[_+2],15,718787259),O=f(O,U,j,I,g[_+9],21,-343485551),I=i(I,v),O=i(O,y),U=i(U,b),j=i(j,D);return n(I)+n(O)+n(U)+n(j)}let Ice=1,lF=console,Lr=class{static setLogger(e){lF=e}constructor(e,t){at(this,"id",void 0),at(this,"lockingPromise",be.resolve()),at(this,"locks",0),at(this,"name",""),at(this,"lockId",void 0),this.lockId=Ice++,e&&(this.name=e),t&&(this.id=t),this.logger("created")}logger(e,t){const n=(this.id?"[".concat(this.id,"]"):"")+"[lock-".concat(this.name,"-").concat(this.lockId,"]"),i=e==="created"?"is ".concat(e,"."):"is ".concat(e,", current queue ").concat(this.locks,". ").concat(t??"");lF.debug("".concat(n," ").concat(i))}setId(e){this.id=e}get isLocked(){return this.locks>0}lock(e){let t;this.locks+=1,this.logger("locked",e);const n=new be(o=>{t=()=>{this.locks-=1,this.logger("unlocked",e),o()}}),i=this.lockingPromise.then(()=>t);return this.lockingPromise=this.lockingPromise.then(()=>n),i}};function Ih(e,t){return function(n,i,o){const l=o.value;if(typeof l!="function")throw new Error("Cannot use mutex on object property.");return o.value=async function(){const d=this[t];if(!d)throw new Error("mutex property key ".concat(t," doesn't exist on ").concat(e));const h=await d.lock("From ".concat(e,".").concat(i));try{for(var f=arguments.length,g=new Array(f),_=0;_<f;_++)g[_]=arguments[_];return await l.apply(this,g)}finally{h()}},o}}const qn={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function wv(e,t){const n=Math.floor(t.timeout*Math.pow(t.timeoutFactor,e));return Math.min(t.maxRetryTimeout,n)}function Do(e,t,n,i){const o=Object.assign({},qn,i);let l=o.timeout;const d=async()=>{await function(g){return new be(_=>{window.setTimeout(_,g)})}(l),l*=o.timeoutFactor,l=Math.min(o.maxRetryTimeout,l)};let h=!1;const f=new be(async(g,_)=>{t=t||(()=>!1),n=n||(()=>!0);for(let v=0;v<o.maxRetryCount;v+=1){if(h)return _(new ae(P.OPERATION_ABORTED));try{const y=await e();if(!t(y,v)||v+1===o.maxRetryCount)return g(y);await d()}catch(y){if(!n(y,v)||v+1===o.maxRetryCount)return _(y);await d()}}});return f.cancel=()=>h=!0,f}let bv,ZT=class{constructor(e){at(this,"input",[]),at(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}mean(){var e;return this.input.length===0?0:ca(e=this.input).call(e,(t,n)=>t+n)/this.input.length}},Sv=0,eR=0;function tR(e,t,n,i){return new be((o,l)=>{t.responseType=t.responseType||"json",t.data&&!n?(t.data=JSON.stringify(t.data),Sv+=hc(t.data)):n&&(t.data.size?Sv+=t.data.size:t.data instanceof FormData?Sv+=rF(t.data):Sv+=hc(JSON.stringify(t.data))),t.headers=t.headers||{},t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json",t.method="POST",t.url=e,Xs.request(t).then(d=>{typeof d.data=="string"?eR+=hc(d.data):d.data instanceof ArrayBuffer||d.data instanceof Uint8Array?eR+=d.data.byteLength:eR+=hc(JSON.stringify(d.data)),o(d.data)}).catch(d=>{Xs.isCancel(d)?l(new ae(P.OPERATION_ABORTED,"cancel token canceled")):d.code==="ECONNABORTED"?l(new ae(P.NETWORK_TIMEOUT,d.message)):d.response?l(new ae(P.NETWORK_RESPONSE_ERROR,d.response.status)):l(new ae(P.NETWORK_ERROR,d.message))})})}async function Nce(e,t){const n=new Blob([t.data],{type:"buffer"});return await tR(e,Ee(Ee({},t),{},{data:n,headers:{"Content-Type":"application/octet-stream"}}),!0)}const AF=()=>window.isSecureContext!==void 0;function qa(e){if(Array.isArray(e))return e.map(n=>n);if(!dF(e))return e;const t={};for(const n in e){const i=e[n];dF(i)||Array.isArray(i)?t[n]=qa(i):t[n]=i}return t}function dF(e){return!(typeof e!="object"||Array.isArray(e)||!e)}let nR=class{constructor(e){at(this,"input",[]),at(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}diffMean(){return this.input.length===0?0:(this.input[this.input.length-1]-this.input[0])/this.input.length}};const Xa={address:"unknown",candidateType:"unknown",id:"unknown",port:0,priority:0,protocol:"unknown",type:"unknown"},ym={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[],transport:{bytesSent:0,bytesReceived:0,packetsSent:0,packetsReceived:0},selectedCandidatePair:{id:"unknown",localCandidate:Xa,remoteCandidate:Xa},updateInterval:0},uF={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,qpSumPerFrame:0,framesDroppedCount:0,outputFrameRate:0,packetsDiscarded:0,framesAssembledFromMultiplePackets:0,totalProcessingDelay:0,avgDecodeMs:0,avgFramesAssembledFromMultiplePacketsMs:0,avgProcessingDelayMs:0,avgInterFrameDelayMs:0,totalAssemblyTime:0},hF={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0,qpSumPerFrame:0},pF={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0},fF={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packetsDiscarded:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0,concealedSamples:0,totalSamplesReceived:0,silentConcealedSamples:0,concealmentEvents:0,freezeMs80:0,freezeMs200:0,freezeSamples80:0,freezeSamples200:0};let rR=class{constructor(e,t){at(this,"onFirstVideoReceived",void 0),at(this,"onFirstVideoDecoded",void 0),at(this,"onFirstAudioReceived",void 0),at(this,"onFirstVideoDecodedTimeout",void 0),at(this,"onFirstAudioDecoded",void 0),at(this,"onSelectedLocalCandidateChanged",void 0),at(this,"onSelectedRemoteCandidateChanged",void 0),at(this,"videoIsReady",!1),at(this,"videoIsReady2",{}),at(this,"pc",void 0),at(this,"options",void 0),at(this,"intervalTimer",void 0),at(this,"stats",qa(ym)),at(this,"isFirstVideoReceived",{}),at(this,"isFirstVideoDecoded",{}),at(this,"isFirstAudioReceived",{}),at(this,"isFirstAudioDecoded",{}),at(this,"isFirstVideoDecodedTimeout",{}),at(this,"lossRateWindowStats",[]),this.pc=e,this.options=t,this.intervalTimer=window.setInterval(async()=>{this.updateStats()},this.options.updateInterval)}getStats(){return this.stats}getSelectedCandidatePair(){return new be(e=>{e({local:Ee({},Xa),remote:Ee({},Xa)})})}setVideoIsReady(e){this.videoIsReady=e}setVideoIsReady2(e,t){this.videoIsReady2[e]=t}getVideoIsReady(e){return this.videoIsReady2[e]||!1}setIsFirstAudioDecoded(e){}destroy(){window.clearInterval(this.intervalTimer),this.pc=void 0}calcLossRate(e){this.lossRateWindowStats.push(e),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);const t=this.lossRateWindowStats.length,n=["videoSend","audioSend","videoRecv","audioRecv"];let i=0,o=0,l=0,d=0;for(const h of n)e[h].forEach((f,g)=>{if(!this.lossRateWindowStats[t-1][h][g]||!this.lossRateWindowStats[0][h][g])return;const _=this.lossRateWindowStats[t-1][h][g].packets-this.lossRateWindowStats[0][h][g].packets,v=this.lossRateWindowStats[t-1][h][g].packetsLost-this.lossRateWindowStats[0][h][g].packetsLost;h==="videoSend"||h==="audioSend"?(i+=_,l+=v):(o+=_,d+=v),Number.isNaN(_)||Number.isNaN(_)?f.packetLostRate=0:f.packetLostRate=_<=0||v<=0?0:v/(_+v)});e.sendPacketLossRate=i<=0||l<=0?0:l/(i+l),e.recvPacketLossRate=o<=0||d<=0?0:d/(o+d)}},Oce=class extends rR{constructor(){super(...arguments),at(this,"_stats",ym),at(this,"lastDecodeVideoReceiverStats",new Map)}async updateStats(){const e=await this._getStats(),t=this.statsResponsesToObjects(e);this._stats=qa(ym);const n=t.filter(o=>o.type==="ssrc");this.processSSRCStats(n);const i=t.find(o=>o.type==="VideoBwe");i&&this.processBandwidthStats(i),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}processBandwidthStats(e){this._stats.bitrate={actualEncoded:Number(e.googActualEncBitrate),targetEncoded:Number(e.googTargetEncBitrate),retransmit:Number(e.googRetransmitBitrate),transmit:Number(e.googTransmitBitrate)},this._stats.sendBandwidth=Number(e.googAvailableSendBandwidth)}processSSRCStats(e){e.forEach(t=>{var n;const i=me(n=t.id).call(n,"send");switch("".concat(t.mediaType,"_").concat(i?"send":"recv")){case"video_send":{const o=qa(hF);o.codec=t.googCodecName,o.adaptionChangeReason="none",t.googCpuLimitedResolution&&(o.adaptionChangeReason="cpu"),t.googBandwidthLimitedResolution&&(o.adaptionChangeReason="bandwidth"),o.avgEncodeMs=Number(t.googAvgEncodeMs),o.inputFrame={width:Number(t.googFrameWidthInput)||Number(t.googFrameWidthSent),height:Number(t.googFrameHeightInput)||Number(t.googFrameHeightSent),frameRate:Number(t.googFrameRateInput)},o.sentFrame={width:Number(t.googFrameWidthSent),height:Number(t.googFrameHeightSent),frameRate:Number(t.googFrameRateInput)},o.firsCount=Number(t.googFirReceived),o.nacksCount=Number(t.googNacksReceived),o.plisCount=Number(t.googPlisReceived),o.frameCount=Number(t.framesEncoded),o.bytes=Number(t.bytesSent),o.packets=Number(t.packetsSent),o.packetsLost=Number(t.packetsLost),o.ssrc=Number(t.ssrc),o.rttMs=Number(t.googRtt||0),this._stats.videoSend.push(o),this._stats.rtt=o.rttMs;break}case"video_recv":{const o=qa(uF),l=this.lastDecodeVideoReceiverStats.get(Number(t.ssrc));if(o.codec=t.googCodecName,o.targetDelayMs=Number(t.googTargetDelayMs),o.renderDelayMs=Number(t.googRenderDelayMs),o.currentDelayMs=Number(t.googCurrentDelayMs),o.minPlayoutDelayMs=Number(t.googMinPlayoutDelayMs),o.decodeMs=Number(t.googDecodeMs),o.maxDecodeMs=Number(t.googMaxDecodeMs),o.receivedFrame={width:Number(t.googFrameWidthReceived),height:Number(t.googFrameHeightReceived),frameRate:Number(t.googFrameRateReceived)},o.decodedFrame={width:Number(t.googFrameWidthReceived),height:Number(t.googFrameHeightReceived),frameRate:Number(t.googFrameRateDecoded)},o.decodeFrameRate=Number(t.googFrameRateDecoded),o.outputFrame={width:Number(t.googFrameWidthReceived),height:Number(t.googFrameHeightReceived),frameRate:Number(t.googFrameRateOutput)},o.jitterBufferMs=Number(t.googJitterBufferMs),o.firsCount=Number(t.googFirsSent),o.nacksCount=Number(t.googNacksSent),o.plisCount=Number(t.googPlisSent),o.framesDecodeCount=Number(t.framesDecoded),o.bytes=Number(t.bytesReceived),o.packets=Number(t.packetsReceived),o.packetsLost=Number(t.packetsLost),o.ssrc=Number(t.ssrc),o.packets>0&&!this.isFirstVideoReceived[o.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(o.ssrc),this.isFirstVideoReceived[o.ssrc]=!0),o.framesDecodeCount>0&&!this.isFirstVideoDecoded[o.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(o.ssrc,o.decodedFrame.width,o.decodedFrame.height),this.isFirstVideoDecoded[o.ssrc]=!0),l){const d=l.stats,h=Date.now()-l.lts;o.framesDecodeFreezeTime=d.framesDecodeFreezeTime,o.framesDecodeInterval=d.framesDecodeInterval,o.framesDecodeCount>d.framesDecodeCount&&this.isFirstVideoDecoded[o.ssrc]?(l.lts=Date.now(),o.framesDecodeInterval=h,o.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(t.ssrc,10))?o.framesDecodeFreezeTime+=o.framesDecodeInterval:this.setVideoIsReady2(parseInt(t.ssrc,10),!0))):o.framesDecodeCount<l.stats.framesDecodeCount&&(o.framesDecodeInterval=0)}this.lastDecodeVideoReceiverStats.set(o.ssrc,{stats:Ee({},o),lts:Date.now()}),this._stats.videoRecv.push(o);break}case"audio_recv":{const o=qa(fF);o.codec=t.googCodecName,o.outputLevel=Math.abs(Number(t.audioOutputLevel))/32767,o.decodingCNG=Number(t.googDecodingCNG),o.decodingCTN=Number(t.googDecodingCTN),o.decodingCTSG=Number(t.googDecodingCTSG),o.decodingNormal=Number(t.googDecodingNormal),o.decodingPLC=Number(t.googDecodingPLC),o.decodingPLCCNG=Number(t.googDecodingPLCCNG),o.expandRate=Number(t.googExpandRate),o.accelerateRate=Number(t.googAccelerateRate),o.preemptiveExpandRate=Number(t.googPreemptiveExpandRate),o.secondaryDecodedRate=Number(t.googSecondaryDecodedRate),o.speechExpandRate=Number(t.googSpeechExpandRate),o.preferredJitterBufferMs=Number(t.googPreferredJitterBufferMs),o.jitterBufferMs=Number(t.googJitterBufferMs),o.jitterMs=Number(t.googJitterReceived),o.bytes=Number(t.bytesReceived),o.packets=Number(t.packetsReceived),o.packetsLost=Number(t.packetsLost),o.ssrc=Number(t.ssrc),o.receivedFrames=Number(t.googDecodingCTN)||Number(t.packetsReceived),o.droppedFrames=Number(t.googDecodingPLC)+Number(t.googDecodingPLCCNG)||Number(t.packetsLost),o.receivedFrames>0&&!this.isFirstAudioReceived[o.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(o.ssrc),this.isFirstAudioReceived[o.ssrc]=!0),o.decodingNormal>0&&!this.isFirstAudioDecoded[o.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(o.ssrc),this.isFirstAudioDecoded[o.ssrc]=!0),this._stats.audioRecv.push(o);break}case"audio_send":{const o=qa(pF);o.codec=t.googCodecName,o.inputLevel=Math.abs(Number(t.audioInputLevel))/32767,o.aecReturnLoss=Number(t.googEchoCancellationReturnLoss||0),o.aecReturnLossEnhancement=Number(t.googEchoCancellationReturnLossEnhancement||0),o.residualEchoLikelihood=Number(t.googResidualEchoLikelihood||0),o.residualEchoLikelihoodRecentMax=Number(t.googResidualEchoLikelihoodRecentMax||0),o.bytes=Number(t.bytesSent),o.packets=Number(t.packetsSent),o.packetsLost=Number(t.packetsLost),o.ssrc=Number(t.ssrc),o.rttMs=Number(t.googRtt||0),this._stats.rtt=o.rttMs,this._stats.audioSend.push(o);break}}})}_getStats(){return new be((e,t)=>{this.pc.getStats(e,t)})}statsResponsesToObjects(e){const t=[];return e.result().forEach(n=>{const i={id:n.id,timestamp:n.timestamp.valueOf().toString(),type:n.type};n.names().forEach(o=>{i[o]=n.stat(o)}),t.push(i)}),t}},Nh=function(e){return e.BANDWIDTH="bandwidth",e.CPU="cpu",e.NONE="none",e.OTHER="other",e}({}),Cv=function(e){return e.L1T1="L1T1",e.L1T2="L1T2",e.L1T3="L1T3",e.L1T3_KEY="L1T3_KEY",e.L2T1_KEY="L2T1_KEY",e.L2T2_KEY="L2T2_KEY",e.L2T3_KEY="L2T3_KEY",e.L3T1_KEY="L3T1_KEY",e.L3T2_KEY="L3T2_KEY",e.L3T3_KEY="L3T3_KEY",e}({}),sR=function(e){return e[e.new=0]="new",e[e.connecting=1]="connecting",e[e.connected=2]="connected",e[e.disconnected=3]="disconnected",e[e.failed=4]="failed",e[e.closed=5]="closed",e}({}),ji=function(e){return e.CERTIFICATE="certificate",e.CODEC="codec",e.CANDIDATE_PAIR="candidate-pair",e.LOCAL_CANDIDATE="local-candidate",e.REMOTE_CANDIDATE="remote-candidate",e.INBOUND="inbound-rtp",e.TRACK="track",e.OUTBOUND="outbound-rtp",e.PC="peer-connection",e.REMOTE_INBOUND="remote-inbound-rtp",e.REMOTE_OUTBOUND="remote-outbound-rtp",e.TRANSPORT="transport",e.CSRC="csrc",e.DATA_CHANNEL="data-channel",e.STREAM="stream",e.SENDER="sender",e.RECEIVER="receiver",e}({});var Oh=function(e){return e[e.kNone=1]="kNone",e[e.kMillisecondsFromSeconds=1e3]="kMillisecondsFromSeconds",e[e.kBytesToBits=8]="kBytesToBits",e}(Oh||{});function wm(e,t,n,i){let o=arguments.length>4&&arguments[4]!==void 0?arguments[4]:Oh.kNone;if(!t)return;const l=Number(t[n]);if(typeof l!="number")return;const d=Number(t[i]);if(typeof d!="number")return;if(!e)return d?l/d*o:void 0;const h=Number(e[n]);if(typeof h!="number")return;const f=Number(e[i]);if(typeof f!="number")return;const g=d-f;return g?(l-h)/g*o:void 0}let mF=class extends rR{constructor(){super(...arguments),at(this,"_stats",ym),at(this,"report",void 0),at(this,"lastDecodeVideoReceiverStats",new Map),at(this,"lastVideoFramesRecv",new Map),at(this,"lastVideoFramesSent",new Map),at(this,"lastVideoFramesDecode",new Map),at(this,"lastVideoFramesOutput",new Map),at(this,"lastVideoJBDelay",new Map),at(this,"lastAudioJBDelay",new Map),at(this,"mediaBytesSent",new Map),at(this,"mediaBytesRetransmit",new Map),at(this,"mediaBytesTargetEncode",new Map),at(this,"lastDecodeAudioReceiverStats",new Map),at(this,"lastAudioConcealment",new Map),at(this,"lastEncoderMs",new Map)}async updateStats(){this.report=await this.pc.getStats(),this._stats=qa(ym),this.report.forEach(e=>{switch(e.type){case ji.OUTBOUND:case ji.INBOUND:{const t=e.mediaType||e.kind,n=!t&&"frameWidth"in e,i=!t&&!("frameWidth"in e);e.type===ji.OUTBOUND?t==="audio"||i?this.processAudioOutboundStats(e):(t==="video"||n)&&this.processVideoOutboundStats(e):e.type===ji.INBOUND&&(t==="audio"||i?this.processAudioInboundStats(e):(t==="video"||n)&&this.processVideoInboundStats(e));break}case ji.TRANSPORT:{this.processTransportStats(e);const t=this.report.get(e.selectedCandidatePairId);t&&this.processCandidatePairStats(t);break}case ji.CANDIDATE_PAIR:e.selected&&this.processCandidatePairStats(e)}}),this.updateSendBitrate(),this._stats.updateInterval=Date.now()-this.stats.timestamp,this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}async getSelectedCandidatePair(){const e=await this.pc.getStats(),t={local:Ee({},Xa),remote:Ee({},Xa)};return e.forEach(n=>{let i;if(n.type===ji.TRANSPORT&&(i=e.get(n.selectedCandidatePairId)),n.type===ji.CANDIDATE_PAIR&&n.selected&&(i=n),i){const o=(l,d)=>{l.type=d.type,l.id=d.id,d.address&&(l.address=d.address),d.candidateType&&(l.candidateType=d.candidateType),d.port&&(l.port=d.port),d.priority&&(l.priority=d.priority),d.protocol&&(l.protocol=d.protocol),d.relayProtocol&&(l.relayProtocol=d.relayProtocol)};if(i.localCandidateId){const l=e.get(i.localCandidateId);l&&o(t.local,l)}if(i.remoteCandidateId){const l=e.get(i.remoteCandidateId);l&&o(t.remote,l)}}}),t}processCandidatePairStats(e){if(this._stats.sendBandwidth=e.availableOutgoingBitrate||0,e.currentRoundTripTime&&(this._stats.rtt=1e3*e.currentRoundTripTime),this._stats.videoSend.forEach(t=>{e.currentRoundTripTime&&(t.rttMs=1e3*e.currentRoundTripTime)}),this._stats.audioSend.forEach(t=>{e.currentRoundTripTime&&(t.rttMs=1e3*e.currentRoundTripTime)}),this._stats.selectedCandidatePair.id=e.id,e.localCandidateId){const t=this.report.get(e.localCandidateId);t&&this.processCandidateStats(t)}if(e.remoteCandidateId){const t=this.report.get(e.remoteCandidateId);t&&this.processCandidateStats(t)}}processCandidateStats(e){let t;e.type===ji.LOCAL_CANDIDATE&&(t=this._stats.selectedCandidatePair.localCandidate),e.type===ji.REMOTE_CANDIDATE&&(t=this._stats.selectedCandidatePair.remoteCandidate),t&&(t.type=e.type,t.id=e.id,e.address&&(t.address=e.address),e.candidateType&&(t.candidateType=e.candidateType),e.port&&(t.port=e.port),e.priority&&(t.priority=e.priority),e.protocol&&(t.protocol=e.protocol),e.relayProtocol&&(t.relayProtocol=e.relayProtocol),e.type===ji.LOCAL_CANDIDATE&&this.stats.selectedCandidatePair.localCandidate.id!==t.id&&this.onSelectedLocalCandidateChanged&&this.onSelectedLocalCandidateChanged(Ee({},t),Ee({},this.stats.selectedCandidatePair.localCandidate)),e.type===ji.REMOTE_CANDIDATE&&this.stats.selectedCandidatePair.remoteCandidate.id!==t.id&&this.onSelectedRemoteCandidateChanged&&this.onSelectedRemoteCandidateChanged(Ee({},t),Ee({},this.stats.selectedCandidatePair.remoteCandidate)))}processAudioInboundStats(e){let t=this._stats.audioRecv.find(i=>i.ssrc===e.ssrc);t||(t=qa(fF),this._stats.audioRecv.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsReceived,t.packetsLost=e.packetsLost,t.packetsDiscarded=e.packetsDiscarded,t.bytes=e.bytesReceived,t.jitterMs=1e3*e.jitter,t.retransmittedBytesReceived=e.retransmittedBytesReceived,t.retransmittedPacketsReceived=e.retransmittedPacketsReceived,t.totalProcessingDelay=e.totalProcessingDelay,t.jitterBufferEmittedCount=e.jitterBufferEmittedCount,t.estimatedPlayoutTimestamp=e.estimatedPlayoutTimestamp;const n=this.lastDecodeAudioReceiverStats.get(t.ssrc);t.avgProcessingDelayMs=wm(n,t,"totalProcessingDelay","jitterBufferEmittedCount",Oh.kMillisecondsFromSeconds),this.processAudioTrackReceiverStats(e,e.trackId,t),this.calculateAudioFreeze(t,n,e),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),t.receivedFrames||(t.receivedFrames=e.packetsReceived),t.droppedFrames||(t.droppedFrames=e.packetsLost),t.receivedFrames>0&&!this.isFirstAudioReceived[t.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(t.ssrc),this.isFirstAudioReceived[t.ssrc]=!0),t.outputLevel&&t.outputLevel>0&&!this.isFirstAudioDecoded[t.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(t.ssrc),this.isFirstAudioDecoded[t.ssrc]=!0),typeof e.concealedSamples=="number"&&(t.concealedSamples=e.concealedSamples),this.lastDecodeAudioReceiverStats.set(t.ssrc,Ee({},t))}calculateAudioFreeze(e,t,n){const i=this.lastAudioConcealment.get(e.ssrc);if(t!=null&&i!=null){const o=i.lts,l=n.timestamp,d=l-o;if(d<=0)return;const h=e.concealedSamples-t.concealedSamples-0,f=i.nonSilent+h,g=e.totalSamplesReceived-t.totalSamplesReceived;if(g<=0)return;const _=80*g/d,v=200*g/d,y=d/g;let b=0;e.freezeSamples80=t.freezeSamples80,e.freezeMs80=t.freezeMs80,f>_&&(i.plc80>0?(e.freezeSamples80+=h,e.freezeMs80+=Math.round(h*y)):(e.freezeSamples80+=f,e.freezeMs80+=Math.round(f*y)),b=i.plc80+1);let D=0;e.freezeSamples200=t.freezeSamples200,e.freezeMs200=t.freezeMs200,f>v&&(i.plc200>0?(e.freezeSamples200+=h,e.freezeMs200+=Math.round(h*y)):(e.freezeSamples200+=f,e.freezeMs200+=Math.round(f*y)),D=i.plc200+1),this.lastAudioConcealment.set(e.ssrc,{nonSilent:h,lts:l,plc80:b,plc200:D})}else e.freezeSamples80=0,e.freezeSamples200=0,e.freezeMs80=0,e.freezeMs200=0,this.lastAudioConcealment.set(e.ssrc,{nonSilent:0,lts:n.timestamp,plc80:0,plc200:0})}processVideoInboundStats(e){let t=this._stats.videoRecv.find(d=>d.ssrc===e.ssrc);t||(t=qa(uF),this._stats.videoRecv.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsReceived,t.packetsLost=e.packetsLost,t.bytes=e.bytesReceived,t.firsCount=e.firCount,t.nacksCount=e.nackCount,t.plisCount=e.pliCount,t.framesDecodeCount=e.framesDecoded,t.framesDroppedCount=e.framesDropped,t.totalInterFrameDelay=e.totalInterFrameDelay,t.totalSquaredInterFrameDelay=e.totalSquaredInterFrameDelay,t.totalFreezesDuration=e.totalFreezesDuration,t.totalProcessingDelay=e.totalProcessingDelay,t.packetsDiscarded=e.packetsDiscarded,t.framesAssembledFromMultiplePackets=e.framesAssembledFromMultiplePackets,t.totalAssemblyTime=e.totalAssemblyTime,t.keyFramesDecoded=e.keyFramesDecoded,t.retransmittedBytesReceived=e.retransmittedBytesReceived,t.retransmittedPacketsReceived=e.retransmittedPacketsReceived,t.estimatedPlayoutTimestamp=e.estimatedPlayoutTimestamp;const n=this.lastDecodeVideoReceiverStats.get(t.ssrc),i=this.lastVideoFramesDecode.get(t.ssrc),o=this.lastVideoFramesOutput.get(t.ssrc),l=Date.now();if(t.framesDecodeCount>0&&!this.isFirstVideoDecoded[t.ssrc]){const d=t.decodedFrame?t.decodedFrame.width:0,h=t.decodedFrame?t.decodedFrame.height:0;this.onFirstVideoDecoded&&this.onFirstVideoDecoded(t.ssrc,d,h),this.isFirstVideoDecoded[t.ssrc]=!0}if(n){const d=n.stats,h=l-n.lts;t.framesDecodeFreezeTime=d.framesDecodeFreezeTime,t.framesDecodeInterval=d.framesDecodeInterval,!this.isFirstVideoDecoded[t.ssrc]&&h>this.options.firstVideoDecodedTimeout&&!this.isFirstVideoDecodedTimeout[t.ssrc]&&(this.onFirstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout(t.ssrc),this.isFirstVideoDecodedTimeout[t.ssrc]=!0),t.framesDecodeCount>d.framesDecodeCount&&this.isFirstVideoDecoded[t.ssrc]?(n.lts=Date.now(),t.framesDecodeInterval=h,t.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(e.ssrc))?t.framesDecodeFreezeTime+=t.framesDecodeInterval:this.setVideoIsReady2(parseInt(e.ssrc,10),!0))):t.framesDecodeCount<d.framesDecodeCount&&(t.framesDecodeInterval=0),e.framesDecoded&&e.qpSum&&(n.stats.framesDecodeCount>e.framesDecoded?t.qpSumPerFrame=e.qpSum/e.framesDecoded:t.qpSumPerFrame=(e.qpSum-n.qpSum)/(e.framesDecoded-n.stats.framesDecodeCount))}e.totalDecodeTime&&(t.decodeMs=1e3*e.totalDecodeTime,t.avgDecodeMs=wm(n==null?void 0:n.stats,t,"decodeMs","framesDecodeCount")),t.avgProcessingDelayMs=wm(n==null?void 0:n.stats,t,"totalProcessingDelay","framesDecodeCount",Oh.kMillisecondsFromSeconds),t.avgFramesAssembledFromMultiplePacketsMs=wm(n==null?void 0:n.stats,t,"totalAssemblyTime","framesAssembledFromMultiplePackets",Oh.kMillisecondsFromSeconds),t.avgInterFrameDelayMs=wm(n==null?void 0:n.stats,t,"totalInterFrameDelay","framesDecodeCount",Oh.kMillisecondsFromSeconds),i&&l-i.lts>=800?(t.decodeFrameRate=Math.round((t.framesDecodeCount-i.count)/((l-i.lts)/1e3)),this.lastVideoFramesDecode.set(t.ssrc,{count:t.framesDecodeCount,lts:l,rate:t.decodeFrameRate})):i?t.decodeFrameRate=i.rate:this.lastVideoFramesDecode.set(t.ssrc,{count:t.framesDecodeCount,lts:l,rate:0}),t.framesDroppedCount&&e.framesReceived&&(o&&l-o.lts>=800?(t.outputFrameRate=Math.round((e.framesReceived-t.framesDroppedCount-o.count)/((l-o.lts)/1e3)),this.lastVideoFramesOutput.set(t.ssrc,{count:e.framesReceived-t.framesDroppedCount,lts:l,rate:Math.max(t.outputFrameRate,0)})):o?t.outputFrameRate=o.rate:this.lastVideoFramesOutput.set(t.ssrc,{count:e.framesReceived-t.framesDroppedCount,lts:l,rate:0})),this.processVideoTrackReceiverStats(e,e.trackId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),e.framerateMean&&(t.framesRateFirefox=e.framerateMean),t.packets>0&&!this.isFirstVideoReceived[t.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(t.ssrc),this.isFirstVideoReceived[t.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(t.ssrc,{stats:Ee({},t),lts:n?n.lts:Date.now(),qpSum:e.qpSum})}processVideoOutboundStats(e){let t=this._stats.videoSend.find(i=>i.ssrc===e.ssrc);t||(t=qa(hF),this._stats.videoSend.push(t));const n=this.mediaBytesSent.get(e.ssrc);if(n)n.add(e.bytesSent);else{const i=new nR(10);i.add(e.bytesSent),this.mediaBytesSent.set(e.ssrc,i)}if(e.retransmittedBytesSent!==void 0){const i=this.mediaBytesRetransmit.get(e.ssrc);if(i)i.add(e.retransmittedBytesSent);else{const o=new nR(10);o.add(e.retransmittedBytesSent),this.mediaBytesRetransmit.set(e.ssrc,o)}}if(e.totalEncodedBytesTarget){const i=this.mediaBytesTargetEncode.get(e.ssrc);if(i)i.add(e.totalEncodedBytesTarget);else{const o=new nR(10);o.add(e.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(e.ssrc,o)}}if(t.ssrc=e.ssrc,t.bytes=e.bytesSent,t.packets=e.packetsSent,t.firsCount=e.firCount,t.nacksCount=e.nackCount,t.plisCount=e.pliCount,t.frameCount=e.framesEncoded,t.adaptionChangeReason=e.qualityLimitationReason,t.scalabilityMode=e.scalabilityMode,t.retransmittedBytesSent=e.retransmittedBytesSent,t.retransmittedPacketsSent=e.retransmittedPacketsSent,t.hugeFramesSent=e.hugeFramesSent,t.keyFramesEncoded=e.keyFramesEncoded,t.targetBitrate=e.targetBitrate,e.totalEncodeTime&&e.framesEncoded){const i=this.lastEncoderMs.get(e.ssrc);if(!i||i.lastFrameCount>e.framesEncoded)t.avgEncodeMs=1e3*e.totalEncodeTime/e.framesEncoded;else{const o=e.framesEncoded-i.lastFrameCount,l=e.totalEncodeTime-i.lastEncoderTime;t.avgEncodeMs=1e3*l/o}}if(e.framesEncoded&&e.qpSum){const i=this.lastEncoderMs.get(e.ssrc);!i||i.lastFrameCount>e.framesEncoded?t.qpSumPerFrame=e.qpSum/e.framesEncoded:t.qpSumPerFrame=(e.qpSum-i.lastQpSum)/(e.framesEncoded-i.lastFrameCount)}if(this.lastEncoderMs.set(e.ssrc,{lastFrameCount:e.framesEncoded,lastEncoderTime:e.totalEncodeTime,lastQpSum:e.qpSum,lts:Date.now()}),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),e.mediaSourceId&&this.processVideoMediaSource(e.mediaSourceId,t),this.processVideoTrackSenderStats(e,e.trackId,t),e.remoteId)this.processRemoteInboundStats(e.remoteId,t);else{const i=this.findRemoteStatsId(e.ssrc,ji.REMOTE_INBOUND);i&&this.processRemoteInboundStats(i,t)}}processAudioOutboundStats(e){let t=this._stats.audioSend.find(n=>n.ssrc===e.ssrc);if(t||(t=qa(pF),this._stats.audioSend.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsSent,t.bytes=e.bytesSent,t.retransmittedBytesSent=e.retransmittedBytesSent,t.retransmittedPacketsSent=e.retransmittedPacketsSent,e.mediaSourceId&&this.processAudioMediaSource(e.mediaSourceId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),this.processAudioTrackSenderStats(e,e.trackId,t),e.remoteId)this.processRemoteInboundStats(e.remoteId,t);else{const n=this.findRemoteStatsId(e.ssrc,ji.REMOTE_INBOUND);n&&this.processRemoteInboundStats(n,t)}}processTransportStats(e){this._stats.transport.bytesReceived=e.bytesReceived||this._stats.transport.bytesReceived,this._stats.transport.bytesSent=e.bytesSent||this._stats.transport.bytesSent,this._stats.transport.packetsReceived=e.packetsReceived||this._stats.transport.packetsReceived,this._stats.transport.packetsSent=e.packetsSent||this._stats.transport.packetsSent}findRemoteStatsId(e,t){var n;const i=Array.from(Ti(n=this.report).call(n)).find(o=>o.type===t&&o.ssrc===e);return i?i.id:null}processVideoMediaSource(e,t){const n=this.report.get(e);n&&n.width&&n.height&&n.framesPerSecond&&(t.inputFrame={width:n.width,height:n.height,frameRate:n.framesPerSecond})}processAudioMediaSource(e,t){const n=this.report.get(e);n&&(t.inputLevel=n.audioLevel)}processVideoTrackSenderStats(e,t,n){var i,o,l,d;const h=t?this.report.get(t):void 0,f=(i=h==null?void 0:h.framesSent)!==null&&i!==void 0?i:e.framesSent;if(typeof f!="number")return;let g=(o=h==null?void 0:h.frameWidth)!==null&&o!==void 0?o:e.frameWidth,_=(l=h==null?void 0:h.frameHeight)!==null&&l!==void 0?l:e.frameHeight,v=(d=h==null?void 0:h.framesPerSecond)!==null&&d!==void 0?d:e.framesPerSecond;if(typeof g=="number"&&typeof _=="number"||(g=0,_=0),v==null){const y=Date.now(),b=this.lastVideoFramesSent.get(n.ssrc);b&&y-b.lts>=800?(v=Math.round((f-b.count)/((y-b.lts)/1e3)),this.lastVideoFramesSent.set(n.ssrc,{count:f,lts:y,rate:v})):b?v=b.rate:this.lastVideoFramesSent.set(n.ssrc,{count:f,lts:y,rate:0})}n.sentFrame={width:g,height:_,frameRate:Math.max(0,v)}}processVideoTrackReceiverStats(e,t,n){var i,o,l,d,h;const f=t?this.report.get(t):void 0,g=(i=f==null?void 0:f.framesReceived)!==null&&i!==void 0?i:e.framesReceived,_=(o=f==null?void 0:f.frameWidth)!==null&&o!==void 0?o:e.frameWidth,v=(l=f==null?void 0:f.frameHeight)!==null&&l!==void 0?l:e.frameHeight,y=(d=f==null?void 0:f.jitterBufferDelay)!==null&&d!==void 0?d:e.jitterBufferDelay,b=(h=f==null?void 0:f.jitterBufferEmittedCount)!==null&&h!==void 0?h:e.jitterBufferEmittedCount;if(typeof g=="number"){const D=this.lastVideoFramesRecv.get(n.ssrc),I=Date.now();n.framesReceivedCount=g;let O=0;D&&I-D.lts>=800?(O=Math.round((g-D.count)/((I-D.lts)/1e3)),this.lastVideoFramesRecv.set(n.ssrc,{count:g,lts:I,rate:O})):D?O=D.rate:this.lastVideoFramesRecv.set(n.ssrc,{count:g,lts:I,rate:0}),n.receivedFrame={width:_||0,height:v||0,frameRate:O||0},n.decodedFrame={width:_||0,height:v||0,frameRate:n.decodeFrameRate||0},n.outputFrame={width:_||0,height:v||0,frameRate:n.outputFrameRate||n.decodeFrameRate||0}}if(y&&b){const D=this.lastVideoJBDelay.get(n.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let I=D.jitterBufferMs;const O=b-D.jitterBufferEmittedCount;O>0&&(I=1e3*(y-D.jitterBufferDelay)/O),n.jitterBufferMs=I,n.currentDelayMs=Math.round(I),this.lastVideoJBDelay.set(n.ssrc,{jitterBufferDelay:y,jitterBufferEmittedCount:b,jitterBufferMs:n.currentDelayMs})}}processAudioTrackSenderStats(e,t,n){var i,o,l,d;const h=t?this.report.get(t):void 0,f=(i=(o=h==null?void 0:h.echoReturnLoss)!==null&&o!==void 0?o:e.echoReturnLoss)!==null&&i!==void 0?i:0,g=(l=(d=h==null?void 0:h.echoReturnLossEnhancement)!==null&&d!==void 0?d:e.echoReturnLossEnhancement)!==null&&l!==void 0?l:0;n.aecReturnLoss=f,n.aecReturnLossEnhancement=g}processAudioTrackReceiverStats(e,t,n){var i,o,l,d,h,f,g,_,v;const y=t?this.report.get(t):void 0,b=(i=y==null?void 0:y.removedSamplesForAcceleration)!==null&&i!==void 0?i:e.removedSamplesForAcceleration,D=(o=y==null?void 0:y.totalSamplesReceived)!==null&&o!==void 0?o:e.totalSamplesReceived,I=(l=y==null?void 0:y.jitterBufferDelay)!==null&&l!==void 0?l:e.jitterBufferDelay,O=(d=y==null?void 0:y.jitterBufferEmittedCount)!==null&&d!==void 0?d:e.jitterBufferEmittedCount,U=(h=y==null?void 0:y.audioLevel)!==null&&h!==void 0?h:e==null?void 0:e.audioLevel,j=(f=y==null?void 0:y.totalSamplesDuration)!==null&&f!==void 0?f:e==null?void 0:e.totalSamplesDuration,G=(g=y==null?void 0:y.concealedSamples)!==null&&g!==void 0?g:e.concealedSamples,$=(_=y==null?void 0:y.silentConcealedSamples)!==null&&_!==void 0?_:e.silentConcealedSamples,Z=(v=y==null?void 0:y.concealmentEvents)!==null&&v!==void 0?v:e.concealmentEvents;if(typeof D=="number"&&(n.totalSamplesReceived=D),typeof $=="number"&&(n.silentConcealedSamples=$),typeof Z=="number"&&(n.concealmentEvents=Z),typeof G=="number"&&(n.concealedSamples=G),b&&D&&(n.accelerateRate=b/D),I&&O){const ee=this.lastAudioJBDelay.get(n.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let le=ee.jitterBufferMs;const fe=O-ee.jitterBufferEmittedCount;fe>0&&(le=1e3*(I-ee.jitterBufferDelay)/fe),n.jitterBufferMs=Math.round(le),this.lastAudioJBDelay.set(n.ssrc,{jitterBufferDelay:I,jitterBufferEmittedCount:O,jitterBufferMs:n.jitterBufferMs})}n.outputLevel=U;let X=1920;j&&D&&(X=D/j/50,n.receivedFrames=Math.round(D/X)),G&&(n.droppedFrames=Math.round(G/X))}processRemoteInboundStats(e,t){const n=this.report.get(e);n&&(t.packetsLost=n.packetsLost,n.roundTripTime&&(t.rttMs=1e3*n.roundTripTime),n.jitter&&(t.jitterMs=1e3*n.jitter),n.timestamp&&(t.timestamp=n.timestamp))}getCodecFromCodecStats(e){const t=this.report.get(e);if(!t)return"";const n=t.mimeType.match(/\/(.*)$/);return n&&n[1]?n[1]:""}updateSendBitrate(){let e=0,t=null,n=null;this.mediaBytesSent.forEach(o=>{e+=o.diffMean()}),this.mediaBytesRetransmit.forEach(o=>{t=t===null?o.diffMean():t+o.diffMean()}),this.mediaBytesTargetEncode.forEach(o=>{n=n===null?o.diffMean():n+o.diffMean()});const i=t!==null?e-t:e;this._stats.bitrate={actualEncoded:8*i/(this.options.updateInterval/1e3),transmit:8*e/(this.options.updateInterval/1e3)},t!==null&&(this._stats.bitrate.retransmit=8*t/(this.options.updateInterval/1e3)),n!==null&&(this._stats.bitrate.targetEncoded=8*n/(this.options.updateInterval/1e3))}},xce=class extends rR{updateStats(){return be.resolve()}};function Tv(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:250,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:8,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:500,o=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1e4;const l=function(){const d=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i);return d&&d[0]?Number(d[0].split("/")[1]):null}();return l?l<76?new Oce(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:i,firstVideoDecodedTimeout:o}):new mF(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:i,firstVideoDecodedTimeout:o}):function(d){if(!window.RTCStatsReport)return!1;const h=d.getStats();return!!(h instanceof be||function(f){return!!f&&(typeof f=="object"||typeof f=="function")&&typeof f.then=="function"}(h))}(e)?new mF(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:i,firstVideoDecodedTimeout:o}):new xce(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:i,firstVideoDecodedTimeout:o})}const gF="websdk_ng_install_id";function iR(){try{if(L("INSTALL_ID"))return L("INSTALL_ID");let e=window.localStorage.getItem(gF);return e||(e=Td(),window.localStorage.setItem(gF,e)),en("INSTALL_ID",e),e}catch{return}}const Aa=function(e){if(e.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return e;const t=e.match(/([0-9]+\.[0-9]+\.[0-9]+)\-([0-9]+)/);if(t&&t[1]&&t[2]){const n=t[1],i=t[2];return"".concat(n,".").concat(i)}return"4.0.0.999"}("4.24.1"),aR=function(){try{return JSON.parse("true")===!0}catch{return!0}}();let Rd=function(e){return e.Default="default",e.Auto="auto",e.Relay="relay",e.SdRtn="sd-rtn",e}({});const $r=function(){const e="us".concat("erna","me"),t="pa".concat("sswo","rd"),n=["t","s","t"];n.splice(1,0,"e");const i=n.join(""),o=[];for(let h=0;h<6;h++)o.push("1");const l=o.join(""),d={};return d[e]=i,d[t]=l,Object.assign(d,{turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1})}();window.DEFAULT_TURN_CONFIG=$r;const Rv={ENABLE_PUBLISHED_USER_LIST:!0,MAX_SUBSCRIPTION:50,SUBSCRIBE_AUDIO_FILTER_TOPN:void 0,ENABLE_PUBLISH_AUDIO_FILTER:void 0,ENABLE_USER_LICENSE_CHECK:!0,DISABLE_FEC:void 0,ENABLE_NTP_REPORT:!1,ENABLE_INSTANT_VIDEO:!1,ENABLE_USER_AUTO_REBALANCE_CHECK:!0,ENABLE_LOSSBASED_BWE:!0,ENABLE_AUT_CC:!0,FORCE_ENABLE_AUT_CC:!1,ENABLE_CC_FALLBACK:void 0,SUBSCRIBE_TWCC:!0,PUBLISH_TWCC:!1,ENABLE_SVC_DEFAULT_CODECS:["H264","VP8","VP9","AV1"],SVC:[],ENABLE_FULL_LINK_AV_SYNC:!1,SVC_MODE:null,PRE_SUB_NUM:1,ENABLE_AUT_FEEDBACK:!0,SVC_EXTENDED:["VP9"]},oR={MIN_FRAME_RATE:1,MAX_FRAME_RATE:30,MAX_THRESHOLD_FRAMERATE:30,BITRATE_MIN_THRESHOLD:100,BITRATE_MAX_THRESHOLD:100,MAX_SCALE:5,BWE_SCALE_UP_THRESHOLD:.6,BWE_SCALE_DOWN_THRESHOLD:.6,PERF_SCALE_UP_THRESHOLD:.7,PERF_SCALE_DOWN_THRESHOLD:.6,MOTION_RESOLUTION_FACTOR:.8,MOTION_BITRATE_FACTOR:.6,DETAIL_FRAMERATE_FACTOR:.8,DETAIL_BITRATE_FACTOR:.6,BALANCE_RESOLUTION_FACTOR:.9,BALANCE_FRAMERATE_FACTOR:.9,BALANCE_BITRATE_FACTOR:.6,OVERUSE_TIMES_THRESHOLD:10,UNDERUSE_TIMES_THRESHOLD:40},cR="v4.24.1-0-g2cff7c6c-dirty(11/18/2025, 5:40:47 PM)",lR={ENABLE_EVENT_REPORT:!0,UPLOAD_LOG:!1,ENABLE_AG_ADAPTATION:!0,FORCE_AG_HIGH_FRAMERATE:!1,FORCE_SUPPORT_AG_ADAPTATION:!1,ENCODER_CONFIG_LIMIT:{},CAMERA_CAPTURE_CONFIG:void 0,ENABLE_PRELOAD:!0,NEW_ICE_RESTART:!0,ICE_RESTART_INTERVAL:1e4,RESTART_SEQUENCE:["udp_tcp_relay","relay"],FIRST_TCP_CANDIDATE:!1,FIRST_TCP_CANDIDATE_INTERVAL:1e3,TURN_DOMAIN:"edge.agora.io",TURN_DOMAINS:["edge.agora.io"],USE_TURN_IP:!0,NEW_TURN_MODE:4,NEW_FORCE_TURN:!1,USE_NEW_RENDER_FREEZE_TIME:!1,FLS_FALLBACK_TIMEOUT:3e4,RTE_DETAIL_REPORT_INTERVAL:6e4,ENCODE_EXCEPTION_TIMES:5,ENABLE_ENCODE_EXCEPTION:!0,ENCODE_EXCEPTION_VALIDATE_CODEC:["h264"],VIDEO_ENCODER_CONFIG_LIST:[{width:240,height:180},{width:320,height:240},{width:400,height:300},{width:480,height:360},{width:560,height:420},{width:640,height:480}],DELETE_NEQ_AFTER_USER_LEAVE:!0,UPDATE_RTP_CAP_IN_HOST:!1,IOS_BG_TAG:!0,IOS_AUTO_RESTART_BG_TAG:!0,IGNORE_UID_CHECK:!1,ENABLE_UP_SPS_PPS:!1,ENABLE_DOWN_SPS_PPS:!1,NO_EDGES_RETRY:!0,BUFFER_READY_FRAMES:3,FLS_SYNC_AV_PLAY_LIMIT:0,FLS_BUFFER_WAIT_TIME:1500,VOS_CONFIGURE:void 0,ENABLE_QUALITY_FALLBACK:!1,QUALITY_FALLBACK_REHEARSAL:!0,ENABLE_FLS_AV1_FIRST:!1,ENABLE_AP_MULTI_IP:!0,FLS_ENABLE_AV1_DETECT:!0,FLS_ENABLE_AV1_DECODE_DETECT:!0},qt=Ee(Ee(Ee(Ee({},lR),{},{PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:["CHINA","GLOBAL"],WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,NOT_REPORT_EVENT:[],PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,ENABLE_CONFIG_DISTRIBUTE:!0,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,SHOW_REPORT_USER_INVOKER_LOG:!0,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],CONNECT_GATEWAY_WITHOUT_DOMAIN:!1,WORKER_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,GET_VOLUME_OF_MUTED_AUDIO_TRACK:!1,STATS_UPDATE_INTERVAL:250,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,CHECK_LOCAL_STATS_INTERVAL:250,PROFILE_SWITCH_INTERVAL:2e3,UNSUPPORTED_VIDEO_CODEC:[],ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!1,CLOSE_AFB_FOR_LOCAL_AP:!0,JOIN_MAX_CONCURRENCY:6,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_GATEWAY_TRY_443PORT_DURATION:2e3,JOIN_GATEWAY_USE_443PORT_ONLY:!1,JOIN_GATEWAY_USE_DUAL_DOMAIN:!0,JOIN_GATEWAY_FALLBACK_PORT:443,USE_TURN_SERVER_OF_GATEWAY:!1,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,CSP_DETECTED_HOSTNAME_LIST:["agora.io","sd-rtn.com"],REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!1,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{excludedLinks:[]},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,FILTER_SEND_H264_BASELINE:!1,FIRST_H264_PROFILE_LEVEL_ID:"42001f",FIRST_PACKETIZATION_MODE:"",X_GOOGLE_START_BITRATE:void 0,NEW_REPORT_SERVER:!1,NEW_REPORT_SERVER_DOMAINS:["data-reporting.agora.io","data-reporting.agora.io"],VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT:3e5,VIDEO_INSPECT_INTERVAL_MINIMUM:1e3,VIDEO_INSPECT_QUALITY_RATIO:.9,VIDEO_INSPECT_WORKER_MANAGER_HOST:"edge.agora.io",VIDEO_INSPECT_WORKER_MANAGER_PORT:"",VIDEO_INSPECT_WORKER_MANAGER_WSS:"",VIDEO_INSPECT_WORKER_PORT:"",SHOW_VIDEO_INSPECT_WORKER_MESSAGE:!1,STATS_COLLECTOR_PORT:443,FORCE_TURN_TCP:!1,WEBAUDIO_INIT_OPTIONS:void 0,FILTER_VIDEO_FEC:!0,FILTER_AUDIO_FEC:!1,CHROME_DUAL_STREAM_USE_ENCODING:!0,DISABLE_DUAL_STREAM_USE_ENCODING:!1,EXTENSION_USAGE_UPLOAD_INTERVAL:1e4,ICE_RESTART:!0,FINGERPRINT:null,ENABLE_VIDEO_FRAME_CALLBACK:!0,VIDEO_FREEZE_DURATION:500,SPATIALIZER_PARAMETERS:{},UPLOAD_LOG_INTERVAL:3e3,UPLOAD_LOG_REQUEST_RETRY_INTERVAL:2e3,UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL:2e4,UPLOAD_LOG_TRY_INTERVAL_WHILE_OFF:5e3,UPLOAD_LOG_RETRY_INTERVAL_V1:1e4,UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1:200,UPLOAD_LOG_LENGTH_EACH_TIME:10,APP_TYPE:0,DISABLE_WEBAUDIO:!1,CHANNEL_MEDIA_RELAY_SERVERS:void 0,KEEP_LAST_FRAME:!0,FORWARD_P2P_CREATION:!0,SYNC_GROUP:!0,BLOCK_LOCAL_CLIENT:!1,ENABLE_AUDIO_TOPN:!1,ENABLE_AUDIO_METADATA:!1,ENABLE_AUDIO_PTS:!1,TOPN_SMOOTH_LEVEL:void 0,TOPN_NEW_SPEAKER_DELAY:void 0,TOPN_SWITCH_HOLD_MS:void 0,TOPN_AUDIO_GAIN:void 0,TOPN_SILENCE_THRESHOLD:250,AP_AREA:!0,ENABLE_ENCODED_TRANSFORM:!1,ENABLE_VIDEO_SEI:!1,IMAGE_MODERATION_WORKER_HOST:"edge.agora.io",IMAGE_MODERATION_WORKER_WSS:"",IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT:3e5,IMAGE_MODERATION_INTERVAL_MINIMUM:1e3,SHOW_IMAGE_MODERATION_WORKER_MESSAGE:!1,IMAGE_MODERATION_QUALITY_RATIO:.9,IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL:5e3,SHOW_GLOBAL_CLIENT_LIST:!1,DATASTREAM_MAX_RETRANSMITS:10,TCP_CANDIDATE_ONLY:!1,EXTERNAL_SIGNAL_REQUEST_TIMEOUT:3e3,SHOW_P2P_LOG:!1,MAX_P2P_TIMEOUT:3e4,P2P_TOKEN_INTERVAL:1e3,SHOW_DATASTREAM2_LOG:!1,RESTRICTION_SET_PLAYBACK_DEVICE:!0,USE_PURE_ENCRYPTION_MASTER_KEY:!1,ENABLE_AUDIO_RED:!1,OPUS_PTIME:void 0,AUDIO_DUPLICATE_NUM:void 0,ENABLE_ABSSENDTIME_AS_SENTTS:!0,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0},FILTER_VIDEO_CODEC:[],SIGNAL_CHANNEL:0,TRANSMITTER_INITIAL_RTT:30,TRANSMITTER_INITIAL_RTO:30,TRANSMITTER_MAX_BATCH_ACK_COUNT:2,TRANSMITTER_MAX_RTO:500,DATACHANNEL_COMPRESS:!1,DC_JOIN_WITH_FAILBACK:4e3,DC_CONNECTION_TIMEOUT:2e3,DC_PINGPONG_INTERVAL:2e3,DC_DEBUG_LOG:!1,UNSUPPORTED_VIDEO_UPLINK_CODEC:[],UNSUPPORTED_VIDEO_DOWNLINK_CODEC:[],USE_NEW_NETWORK_CONFIG:!1,AUTO_RESET_AUDIO_ROUTE:!1,PLUGIN_INFO:[],OVERUSE_DETECTOR_PARAMS:oR,CUSTOM_ADAPTATION_DEFAULT_MODE:"",HIDE_NO_POSTER:!1,AP_CACHE_NUM:10,AP_UPDATE_INTERVAL:12e4,AP_CACHE_LIFETIME:12e4,MAX_PRELOAD_ASYNC_LENGTH:3,DISABLE_SCREEN_SHARE_REMB:!1},Rv),{},{USE_CANDIDATE_FROM_AP_DETAIL:!1,AP_REQUEST_DETAIL:void 0,ENABLE_ROLE_SELECT_EDGE:!1,CLIENT_ROLE_OPTIONS:void 0,REMOTE_VIDEO_STREAM_TYPE:void 0,COMPATIBLE_SDP_EXTENSION:["gdpr_forbidden"],LIMIT_BITRATE:void 0,EXPERIMENTS:{},USE_PUB_RTX:!0,USE_SUB_RTX:!0,ENABLE_DATASTREAM_2:!1,USE_XR:!0,ENABLE_PREALLOC_PC:!1,ENABLE_PRE_SUB:!1,ENABLE_SVC:!1,ENABLE_FORCE_HLS:!1,MAX_WEBAUDIO_VOLUME:300,ENABLE_VOS_FALLBACK:!1,ENABLE_FALLBACK_TO_HLS:!1,ENABLE_PRE_RENDER:!1,FORCE_DISABLE_AUTO_SUB:!1,ENABLE_PRE_SUB_WITH_PRE_PC:!0,PRE_USE_LOCAL_CODECS:!0},{INSTALL_ID:""}),{},{K_MIN_RENDER_DELAY:66,USE_STANDARD_BITRATE_DEFAULT:!1,VIDEO_NEW_BITRATE_RATIO:void 0,VIDEO_STANDARD_BITRATE_VERSION:2,BASELINE_MORE_H264_BITRATE_RATIO:1.1,IGNORE_RTC_DEVICE_CHECK:!1,FLS_AUTOPLAY_EMITS:!1,ENABLE_DUAL_STREAM_FLAG:!1});function en(e,t,n){var i,o,l;me(i=Object.keys(qt)).call(i,e)&&(!n&&me(o=Object.keys(Vi)).call(o,e)||(qt[e]=t,e!=="ENABLE_VIDEO_SEI"&&e!=="ENABLE_AUDIO_TOPN"&&e!=="ENABLE_AUDIO_METADATA"&&e!=="ENABLE_AUDIO_PTS"||t!==!0||(qt.ENABLE_ENCODED_TRANSFORM=!0),e==="USE_NEW_NETWORK_CONFIG"&&t&&(l=!!t,qt.USE_NEW_NETWORK_CONFIG=l,l&&(qt.WEBCS_DOMAIN=["webrtc2-2.ap.sd-rtn.com"],qt.WEBCS_DOMAIN_BACKUP_LIST=["webrtc2-4.ap.sd-rtn.com"],qt.CDS_AP=["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],qt.ACCOUNT_REGISTER=["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],qt.EVENT_REPORT_DOMAIN="web-2.statscollector.sd-rtn.com",qt.EVENT_REPORT_BACKUP_DOMAIN="statscollector-1.agora.io",qt.GATEWAY_DOMAINS=["edge.sd-rtn.com"])),e==="ENABLE_PRE_SUB"&&t&&(qt.ENABLE_INSTANT_VIDEO=!0,qt.ENABLE_PREALLOC_PC=!0),e==="ENABLE_SVC"&&t&&(qt.ENABLE_AUT_CC=!0),e==="NEW_FORCE_TURN"&&t&&(qt.NEW_TURN_MODE||(qt.NEW_TURN_MODE=4))))}function L(e){if(e==="TURN_DOMAINS"){const t=qt.TURN_DOMAINS;return me(t).call(t,L("TURN_DOMAIN"))?t:[L("TURN_DOMAIN")].concat(t)}return qt[e]}aR||(qt.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],qt.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],qt.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],qt.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],qt.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],qt.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],qt.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",qt.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",qt.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",qt.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",qt.AREAS=["NORTH_AMERICA","OVERSEA"]);let _F=function(e){return e[e.REALTIME=1]="REALTIME",e}({});const Vi={};var tt=function(e){return e.SET_SESSION_ID="SET_SESSION_ID",e.SET_RTE_URL="SET_RTE_URL",e.SET_RTE_SID="SET_RTE_SID",e.SET_P2P_ID="SET_P2P_id",e.SET_DC_ID="SET_DC_id",e.SET_UID="SET_UID",e.SET_INT_UID="SET_INT_UID",e.SET_PUB_ID="SET_PUB_ID",e.SET_CLOUD_PROXY_SERVER_MODE="SET_CLOUD_PROXY_SERVER_MODE",e.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",e.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",e.KEY_METRIC_PRELOAD_START="KEY_METRIC_PRELOAD_START",e.KEY_METRIC_PRELOAD_END="KEY_METRIC_PRELOAD_END",e.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",e.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",e.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",e.KEY_METRIC_REQUEST_SUA_END="KEY_METRIC_REQUEST_SUA_END",e.KEY_METRIC_BEFORE_CONNECT="KEY_METRIC_BEFORE_CONNECT",e.KEY_METRIC_PEER_RECEIVER="KEY_METRIC_PEER_RECEIVER",e.KEY_METRIC_SIGNAL_CONNECTED="KEY_METRIC_SIGNAL_CONNECTED",e.KEY_METRIC_JOIN_REQ="KEY_METRIC_JOIN_REQ",e.KEY_METRIC_JOIN_REP="KEY_METRIC_JOIN_REP",e.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",e.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",e.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",e.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",e.KEY_METRIC_FIRST_VIDEO_FRAME_DECODED="KEY_METRIC_FIRST_VIDEO_FRAME_DECODED",e.KEY_METRIC_DESCRIPTION_START="KEY_METRIC_DESCRIPTION_START",e.KEY_METRIC_ICE_CONNECTION_END="KEY_METRIC_ICE_CONNECTION_END",e.KEY_METRIC_SIGNAL_CHANNEL_OPEN="KEY_METRIC_SIGNAL_CHANNEL_OPEN",e.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",e.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE",e.RECORD_JOIN_CHANNEL_SERVICE="RECORD_JOIN_CHANNEL_SERVICE",e.RESET_JOIN_CHANNEL_SERVICE_RECORDS="RESET_JOIN_CHANNEL_SERVICE_RECORDS",e.RESET_KEY_METRICS="RESET_KEY_METRICS",e.RESET_FIRST_VIDEO_FRAME_DECODED="RESET_FIRST_VIDEO_FRAME_DECODED",e.SET_USE_P2P="SET_USE_P2P",e.SET_TRANSPORT_TYPE="SET_TRANSPORT_TYPE",e}(tt||{});let Id=function(e){return e.h264="h264",e.h265="h265",e.vp8="vp8",e.vp9="vp9",e.av1="av1",e}({});(function(e){e.opus="opus",e.pcma="pcma",e.pcmu="pcmu",e.g722="g722"})({});const EF=128,Dce=96,vF=1e3,xh=10;let Bce=0;var yF=(()=>{var e={8:(i,o,l)=>{l.r(o),l.d(o,{Parser:()=>fe,Printer:()=>ct,parse:()=>ve,print:()=>Be});const d=`
`,h="".concat("\r").concat(d),f=" ";let g;function _(pe){return pe>="0"&&pe<="9"}function v(pe){return pe>="!"&&pe<="~"}function y(pe){return v(pe)||pe>=""&&pe<=""}function b(pe){return pe==="!"||pe>="#"&&pe<="'"||pe>="*"&&pe<="+"||pe>="-"&&pe<="."||pe>="0"&&pe<="9"||pe>="A"&&pe<="Z"||pe>="^"&&pe<="~"}function D(pe){return pe>="1"&&pe<="9"}function I(pe){return pe>="A"&&pe<="Z"||pe>="a"&&pe<="z"}function O(pe){return pe==="d"||pe==="h"||pe==="m"||pe==="s"}function U(pe){return pe>""&&pe<"	"||pe>"\v"&&pe<"\f"||pe>""&&pe<""}function j(pe){return I(pe)||_(pe)||pe==="+"||pe==="/"}function G(pe){return _(pe)||I(pe)||pe==="+"||pe==="/"||pe==="-"||pe==="_"}function $(pe){return I(pe)||_(pe)||pe==="+"||pe==="/"}function Z(pe,R){var H=Object.keys(pe);if(Object.getOwnPropertySymbols){var J=Object.getOwnPropertySymbols(pe);R&&(J=J.filter(function(_e){return Object.getOwnPropertyDescriptor(pe,_e).enumerable})),H.push.apply(H,J)}return H}function X(pe){for(var R=1;R<arguments.length;R++){var H=arguments[R]!=null?arguments[R]:{};R%2?Z(Object(H),!0).forEach(function(J){ee(pe,J,H[J])}):Object.getOwnPropertyDescriptors?Object.defineProperties(pe,Object.getOwnPropertyDescriptors(H)):Z(Object(H)).forEach(function(J){Object.defineProperty(pe,J,Object.getOwnPropertyDescriptor(H,J))})}return pe}function ee(pe,R,H){return R in pe?Object.defineProperty(pe,R,{value:H,enumerable:!0,configurable:!0,writable:!0}):pe[R]=H,pe}(function(pe){pe.VERSION="v",pe.ORIGIN="o",pe.SESSION_NAME="s",pe.INFORMATION="i",pe.URI="u",pe.EMAIL="e",pe.PHONE="p",pe.CONNECTION="c",pe.BANDWIDTH="b",pe.TIME="t",pe.REPEAT="r",pe.ZONE_ADJUSTMENTS="z",pe.KEY="k",pe.ATTRIBUTE="a",pe.MEDIA="m"})(g||(g={}));class le{consumeText(R,H){let J=H;for(;J<R.length;){const _e=R[J];if(_e==="\0"||_e==="\r"||_e===d)break;J+=1}if(J-H==0)throw new Error("Invalid text, at ".concat(R));return J}consumeUnicastAddress(R,H,J){return this.consumeTill(R,H,f)}consumeOneOrMore(R,H,J){let _e=H;for(;J(R[_e]);)_e++;if(_e-H==0)throw new Error("Invalid rule at ".concat(H,"."));return _e}consumeSpace(R,H){if(R[H]===f)return H+1;throw new Error("Invalid space at ".concat(H,"."))}consumeIP4Address(R,H){let J=H;for(let _e=0;_e<4;_e++)if(J=this.consumeDecimalUChar(R,J),_e!==3){if(R[J]!==".")throw new Error("Invalid IP4 address.");J++}return J}consumeDecimalUChar(R,H){let J=H;for(let it=0;it<3&&_(R[J]);it++,J++);if(J-H==0)throw new Error("Invalid decimal uchar.");const _e=parseInt(R.slice(H,J));if(_e>=0&&_e<=255)return J;throw new Error("Invalid decimal uchar")}consumeIP6Address(R,H){let J=this.consumeHexpart(R,H);return R[J]===":"&&(J+=1,J=this.consumeIP4Address(R,J)),J}consumeHexpart(R,H){let J=H;if(R[J]===":"&&R[J+1]===":"){J+=2;try{J=this.consumeHexseq(R,J)}catch{}return J}if(J=this.consumeHexseq(R,J),R[J]===":"&&R[J+1]===":"){J+=2;try{J=this.consumeHexseq(R,J)}catch{}return J}return J}consumeHexseq(R,H){let J=H;for(;J=this.consumeHex4(R,J),R[J]===":"&&R[J+1]!==":";)J+=1;return J}consumeHex4(R,H){let J=0;for(;J<4;J++)if(!((_e=R[H+J])>="0"&&_e<="9"||_e>="a"&&_e<="f"||_e>="A"&&_e<="F")){if(J===0)throw new Error("Invalid hex 4");break}var _e;return H+J}consumeFQDN(R,H){let J=H;for(;_(R[J])||I(R[J])||R[J]==="-"||R[J]===".";)J+=1;if(J-H<4)throw new Error("Invalid FQDN");return J}consumeExtnAddr(R,H){return this.consumeOneOrMore(R,H,y)}consumeMulticastAddress(R,H,J){switch(J){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(R,H);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(R,H);default:try{return this.consumeFQDN(R,H)}catch{return this.consumeExtnAddr(R,H)}}}consumeIP6MulticastAddress(R,H){const J=this.consumeHexpart(R,H);return R[J]==="/"?this.consumeInteger(R,J+1):J}consumeIP4MulticastAddress(R,H){let J=H+3;const _e=R.slice(H,J),it=parseInt(_e);if(it<224||it>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let dn=0;dn<3;dn++){if(R[J]!==".")throw new Error("Invalid IP4 multicast address.");J+=1,J=this.consumeDecimalUChar(R,J)}return R[J]==="/"&&(J+=1),J=this.consumeTTL(R,J),R[J]==="/"&&(J=this.consumeInteger(R,J)),J}consumeInteger(R,H){if(!D(R[H]))throw new Error("Invalid integer.");for(H+=1;_(R[H]);)H+=1;return H}consumeTTL(R,H){if(R[H]==="0")return H+1;if(!D(R[H]))throw new Error("Invalid TTL.");H+=1;for(let J=0;J<2&&_(R[H]);J++)H+=1;return H}consumeToken(R,H){return this.consumeOneOrMore(R,H,b)}consumeTime(R,H){let J=H;if(R[J]==="0")return J+1;for(D(R[J])&&(J+=1);_(R[J]);)J++;if(J-H<10)throw new Error("Invalid time");return J}consumeAddress(R,H){return this.consumeTill(R,H,f)}consumeTypedTime(R,H){let J=H;return J=this.consumeOneOrMore(R,J,_),O(R[J])?J+1:J}consumeRepeatInterval(R,H){if(!D(R[H]))throw new Error("Invalid repeat interval");for(H+=1;_(R[H]);)H+=1;return O(R[H])&&(H+=1),H}consumePort(R,H){return this.consumeOneOrMore(R,H,_)}consume(R,H,J){for(let _e=0;_e<J.length;_e++){if(H+_e>=R.length)throw new Error("consume exceeding value length");if(R[H+_e]!==J[_e])throw new Error("consume ".concat(J," failed at ").concat(_e))}return H+J.length}consumeTill(R,H,J){let _e=H;for(;_e<R.length&&(typeof J!="string"||R[_e]!==J)&&(typeof J!="function"||!J(R[_e]));)_e++;return _e}}class fe extends le{constructor(){super(),ee(this,"records",[]),ee(this,"currentLine",0)}parse(R){const H=this.probeEOL(R);this.records=R.split(H).filter(lA=>!!ks(lA).call(lA)).map(this.parseLine),this.currentLine=0;const J=this.parseVersion(),_e=this.parseOrigin(),it=this.parseSessionName(),dn=this.parseInformation(),Ir=this.parseUri(),Ea=this.parseEmail(),cA=this.parsePhone(),H0=this.parseConnection(),lp=this.parseBandWidth(),G0=this.parseTimeFields(),$d=this.parseKey(),ag=this.parseSessionAttribute(),Zd=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:J,origin:_e,sessionName:it,information:dn,uri:Ir,emails:Ea,phones:cA,connection:H0,bandwidths:lp,timeFields:G0,key:$d,attributes:ag,mediaDescriptions:Zd}}getCurrentRecord(){const R=this.records[this.currentLine];if(!R)throw new Error("Record doesn't exit.");return R}probeEOL(R){for(let H=0;H<R.length;H++)if(R[H]===d)return R[H-1]==="\r"?h:d;throw new Error("Invalid newline character.")}parseLine(R,H){if(R.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");const J=R[0];if(R[1]!=="=")throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:J,value:R.slice(2),line:H,cur:0}}parseSessionAttribute(){const R=new et;for(;this.currentLine<this.records.length;){const H=this.getCurrentRecord();if(H.type!==g.ATTRIBUTE)break;const J={attField:this.extractOneOrMore(H,_e=>b(_e)&&_e!==":"),_cur:0};H.value[H.cur]===":"&&(H.cur+=1,J.attValue=this.extractOneOrMore(H,U)),R.parse(J),this.currentLine++}return R.digest()}parseMediaAttributes(R){const H=new Je(R);for(;this.currentLine<this.records.length;){const J=this.getCurrentRecord();if(J.type!==g.ATTRIBUTE)break;const _e={attField:this.extractOneOrMore(J,it=>b(it)&&it!==":"),_cur:0};J.value[J.cur]===":"&&(J.cur+=1,_e.attValue=this.extractOneOrMore(J,U)),H.parse(_e),this.currentLine++}return H.digest()}parseKey(){const R=this.getCurrentRecord();if(R.type===g.KEY){if(R.value==="prompt"||R.value==="clear:"||R.value==="base64:"||R.value==="uri:")return R.value;throw this.currentLine++,new Error("Invalid key.")}}parseZone(){const R=this.getCurrentRecord();if(R.type===g.ZONE_ADJUSTMENTS){const H=[];for(;;)try{const J=this.extract(R,this.consumeTime);this.consumeSpaceForRecord(R);let _e=!1;R.value[R.cur]==="-"&&(_e=!0,R.cur+=1);const it=this.extract(R,this.consumeTypedTime);H.push({time:J,typedTime:it,back:_e})}catch{break}if(H.length===0)throw new Error("Invalid zone adjustments");return this.currentLine++,H}return[]}parseRepeat(){const R=[];for(;;){const H=this.getCurrentRecord();if(H.type!==g.REPEAT)break;{const J=this.extract(H,this.consumeRepeatInterval),_e=this.parseTypedTime(H);R.push({repeatInterval:J,typedTimes:_e}),this.currentLine++}}return R}parseTypedTime(R){const H=[];for(;;)try{this.consumeSpaceForRecord(R),H.push(this.extract(R,this.consumeTypedTime))}catch{break}if(H.length===0)throw new Error("Invalid typed time.");return H}parseTime(){const R=this.getCurrentRecord(),H=this.extract(R,this.consumeTime);this.consumeSpaceForRecord(R);const J=this.extract(R,this.consumeTime);return this.currentLine++,{startTime:H,stopTime:J}}parseBandWidth(){const R=[];for(;this.currentLine<this.records.length;){const H=this.getCurrentRecord();if(H.type!==g.BANDWIDTH)break;{const J=this.extractOneOrMore(H,b);if(H.value[H.cur]!==":")throw new Error("Invalid bandwidth field.");H.cur++;const _e=this.extractOneOrMore(H,_);R.push({bwtype:J,bandwidth:_e}),this.currentLine++}}return R}parseVersion(){const R=this.getCurrentRecord();if(R.type!==g.VERSION)throw new Error("first sdp record must be version");const H=R.value.slice(0,this.consumeOneOrMore(R.value,0,_));if(H.length!==R.value.length)throw new Error('invalid proto version, "v='.concat(R.value,'"'));return this.currentLine++,H}parseOrigin(){const R=this.getCurrentRecord();if(R.type!==g.ORIGIN)throw new Error("second line of sdp must be origin");const H=this.extractOneOrMore(R,y);this.consumeSpaceForRecord(R);const J=this.extractOneOrMore(R,_);this.consumeSpaceForRecord(R);const _e=this.extractOneOrMore(R,_);this.consumeSpaceForRecord(R);const it=this.extractOneOrMore(R,b);this.consumeSpaceForRecord(R);const dn=this.extractOneOrMore(R,b);this.consumeSpaceForRecord(R);const Ir=this.extract(R,this.consumeUnicastAddress);return this.currentLine++,{username:H,sessId:J,sessVersion:_e,nettype:it,addrtype:dn,unicastAddress:Ir}}parseSessionName(){const R=this.getCurrentRecord();if(R.type===g.SESSION_NAME){const H=this.extract(R,this.consumeText);return this.currentLine++,H}}parseInformation(){const R=this.getCurrentRecord();if(R.type!==g.INFORMATION)return;const H=this.extract(R,this.consumeText);return this.currentLine++,H}parseUri(){const R=this.getCurrentRecord();if(R.type===g.URI)return this.currentLine++,R.value}parseEmail(){const R=[];for(;;){const H=this.getCurrentRecord();if(H.type!==g.EMAIL)break;R.push(H.value),this.currentLine++}return R}parsePhone(){const R=[];for(;;){const H=this.getCurrentRecord();if(H.type!==g.PHONE)break;R.push(H.value),this.currentLine++}return R}parseConnection(){const R=this.getCurrentRecord();if(R.type===g.CONNECTION){const H=this.extractOneOrMore(R,b);this.consumeSpaceForRecord(R);const J=this.extractOneOrMore(R,b);this.consumeSpaceForRecord(R);const _e=this.extract(R,this.consumeAddress);return this.currentLine++,{nettype:H,addrtype:J,address:_e}}}parseMedia(){const R=this.getCurrentRecord(),H=this.extract(R,this.consumeToken);this.consumeSpaceForRecord(R);let J=this.extract(R,this.consumePort);R.value[R.cur]==="/"&&(R.cur+=1,J+=this.extract(R,this.consumeInteger)),this.consumeSpaceForRecord(R);const _e=[];for(_e.push(this.extract(R,this.consumeToken));R.value[R.cur]==="/";)R.cur+=1,_e.push(this.extract(R,this.consumeToken));if(_e.length===0)throw new Error("Invalid proto");const it=this.parseFmt(R);return this.currentLine++,{mediaType:H,port:J,protos:_e,fmts:it}}parseTimeFields(){const R=[];for(;this.getCurrentRecord().type===g.TIME;){const H=this.parseTime(),J=this.parseRepeat(),_e=this.parseZone();R.push({time:H,repeats:J,zones:_e})}return R}parseMediaDescription(){const R=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===g.MEDIA;){const H=this.parseMedia(),J=this.parseInformation(),_e=this.parseConnections(),it=this.parseBandWidth(),dn=this.parseKey(),Ir=this.parseMediaAttributes(H);R.push({media:H,information:J,connections:_e,bandwidths:it,key:dn,attributes:Ir})}return R}parseConnections(){const R=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===g.CONNECTION;)R.push(this.parseConnection());return R}parseFmt(R){const H=[];for(;;)try{this.consumeSpaceForRecord(R),H.push(this.extract(R,this.consumeToken))}catch{break}if(H.length===0)throw new Error("Invalid fmts");return H}extract(R,H){for(var J=arguments.length,_e=new Array(J>2?J-2:0),it=2;it<J;it++)_e[it-2]=arguments[it];const dn=H.call(this,R.value,R.cur,..._e),Ir=R.value.slice(R.cur,dn);return R.cur=dn,Ir}extractOneOrMore(R,H){const J=this.consumeOneOrMore(R.value,R.cur,H),_e=R.value.slice(R.cur,J);return R.cur=J,_e}consumeSpaceForRecord(R){if(R.value[R.cur]!==f)throw new Error("Invalid space at ".concat(R.cur,"."));R.cur+=1}}class Ie extends le{constructor(){super(...arguments),ee(this,"attributes",void 0),ee(this,"digested",!1)}extractOneOrMore(R,H,J){const _e=this.consumeOneOrMore(R.attValue,R._cur,H),it=R.attValue.slice(R._cur,_e),[dn,Ir]=J||[];if(typeof dn=="number"&&it.length<dn)throw new Error("error in length, should be more or equal than ".concat(dn," characters."));if(typeof Ir=="number"&&it.length>Ir)throw new Error("error in length, should be less or equal than ".concat(Ir," characters."));return R._cur=_e,it}consumeAttributeSpace(R){if(R.attValue[R._cur]!==f)throw new Error("Invalid space at ".concat(R._cur,"."));R._cur+=1}extract(R,H){if(!R.attValue)throw new Error("Nothing to extract from attValue.");for(var J=arguments.length,_e=new Array(J>2?J-2:0),it=2;it<J;it++)_e[it-2]=arguments[it];const dn=H.call(this,R.attValue,R._cur,..._e),Ir=R.attValue.slice(R._cur,dn);return R._cur=dn,Ir}atEnd(R){if(!R.attValue)throw new Error;return R._cur>=R.attValue.length}peekChar(R){if(!R.attValue)throw new Error;return R.attValue[R._cur]}peek(R,H){if(!R.attValue)throw new Error;for(let J=0;J<H.length;J++)if(H[J]!==R.attValue[R._cur+J])return!1;return!0}parseIceUfrag(R){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(R,j,[4,256])}parseIcePwd(R){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(R,j,[22,256])}parseIceOptions(R){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");const H=[];for(;!this.atEnd(R);){H.push(this.extractOneOrMore(R,j));try{this.consumeAttributeSpace(R)}catch(J){if(this.atEnd(R))break;throw J}}this.attributes.iceOptions=H}parseFingerprint(R){const H=this.extract(R,this.consumeToken);this.consumeAttributeSpace(R);const J=this.extract(R,this.consumeTill);this.attributes.fingerprints.push({hashFunction:H,fingerprint:J})}parseExtmap(R){const H=this.extractOneOrMore(R,_);let J;this.peekChar(R)==="/"&&(this.extract(R,this.consume,"/"),J=this.extract(R,this.consumeToken)),this.consumeAttributeSpace(R);const _e=this.extract(R,this.consumeTill,f),it=X(X({entry:parseInt(H,10)},J&&{direction:J}),{},{extensionName:_e});this.peekChar(R)===f&&(this.consumeAttributeSpace(R),it.extensionAttributes=this.extract(R,this.consumeTill)),this.attributes.extmaps.push(it)}parseSetup(R){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");const H=this.extract(R,this.consumeTill);if(H!=="active"&&H!=="passive"&&H!=="actpass"&&H!=="holdconn")throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=H}}class et extends Ie{constructor(){super(...arguments),ee(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(R){if(this.digested)throw new Error("already digested");try{switch(R.attField){case"group":this.parseGroup(R);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(R);break;case"ice-pwd":this.parseIcePwd(R);break;case"ice-options":this.parseIceOptions(R);break;case"fingerprint":this.parseFingerprint(R);break;case"setup":this.parseSetup(R);break;case"tls-id":this.parseTlsId(R);break;case"identity":this.parseIdentity(R);break;case"extmap":this.parseExtmap(R);break;case"msid-semantic":this.parseMsidSemantic(R);break;default:R.ignored=!0,this.attributes.unrecognized.push(R)}}catch(H){throw console.error("parsing session attribute ".concat(R.attField,' error, "a=').concat(R.attField,":").concat(R.attValue,'"')),H}if(!R.ignored&&R.attValue&&!this.atEnd(R))throw new Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(R){const H=this.extract(R,this.consumeToken),J=[];for(;!this.atEnd(R)&&this.peekChar(R)===f;)this.consumeAttributeSpace(R),J.push(this.extract(R,this.consumeToken));this.attributes.groups.push({semantic:H,identificationTag:J})}parseIceLite(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(R){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(R,G)}parseIdentity(R){const H=this.extractOneOrMore(R,$),J=[];for(;!this.atEnd(R)&&this.peekChar(R)===f;){this.consumeAttributeSpace(R);const _e=this.extract(R,this.consumeToken);this.extract(R,this.consume,"=");const it=this.extractOneOrMore(R,dn=>dn!==f&&U(dn));J.push({name:_e,value:it})}this.attributes.identities.push({assertionValue:H,extensions:J})}parseMsidSemantic(R){this.peekChar(R)===f&&this.consumeAttributeSpace(R);const H={semantic:this.extract(R,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(R)}catch{break}if(this.peekChar(R)==="*"){this.extract(R,this.consume,"*"),H.applyForAll=!0;break}{const J=this.extract(R,this.consumeTill,f);H.identifierList.push(J)}}this.attributes.msidSemantic=H}}class Je extends Ie{constructor(R){super(),ee(this,"attributes",void 0),R.protos.indexOf("RTP")!==-1||R.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(R){if(this.digested)throw new Error("already digested");try{switch(R.attField){case"extmap":this.parseExtmap(R);break;case"setup":this.parseSetup(R);break;case"ice-ufrag":this.parseIceUfrag(R);break;case"ice-pwd":this.parseIcePwd(R);break;case"ice-options":this.parseIceOptions(R);break;case"candidate":this.parseCandidate(R);break;case"remote-candidate":this.parseRemoteCandidate(R);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(R);break;case"rtpmap":this.parseRtpmap(R);break;case"ptime":this.parsePtime(R);break;case"maxptime":this.parseMaxPtime(R);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(R);break;case"ssrc":this.parseSSRC(R);break;case"fmtp":this.parseFmtp(R);break;case"rtcp-fb":this.parseRtcpFb(R);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(R);break;case"mid":this.parseMid(R);break;case"msid":this.parseMsid(R);break;case"imageattr":this.parseImageAttr(R);break;case"rid":this.parseRid(R);break;case"simulcast":this.parseSimulcast(R);break;case"sctp-port":this.parseSctpPort(R);break;case"max-message-size":this.parseMaxMessageSize(R);break;case"ssrc-group":this.parseSSRCGroup(R);break;default:R.ignored=!0,this.attributes.unrecognized.push(R)}}catch(H){throw console.error("parsing media attribute ".concat(R.attField,' error, "a=').concat(R.attField,":").concat(R.attValue,'"')),H}if(!R.ignored&&R.attValue&&!this.atEnd(R))throw new Error("attribute parsing error")}parseCandidate(R){const H=this.extractOneOrMore(R,j,[1,32]);this.consumeAttributeSpace(R);const J=this.extractOneOrMore(R,_,[1,5]);this.consumeAttributeSpace(R);const _e=this.extract(R,this.consumeToken);this.consumeAttributeSpace(R);const it=this.extractOneOrMore(R,_,[1,10]);this.consumeAttributeSpace(R);const dn=this.extract(R,this.consumeAddress);this.consumeAttributeSpace(R);const Ir=this.extract(R,this.consumePort);this.consumeAttributeSpace(R),this.extract(R,this.consume,"typ"),this.consumeAttributeSpace(R);const Ea={foundation:H,componentId:J,transport:_e,priority:it,connectionAddress:dn,port:Ir,type:this.extract(R,this.consumeToken),extension:{}};for(this.peek(R," raddr")&&(this.extract(R,this.consume," raddr"),this.consumeAttributeSpace(R),Ea.relAddr=this.extract(R,this.consumeAddress)),this.peek(R," rport")&&(this.extract(R,this.consume," rport"),this.consumeAttributeSpace(R),Ea.relPort=this.extract(R,this.consumePort));this.peekChar(R)===f;){this.consumeAttributeSpace(R);const cA=this.extract(R,this.consumeToken);this.consumeAttributeSpace(R),Ea.extension[cA]=this.extractOneOrMore(R,v)}this.attributes.candidates.push(Ea)}parseRemoteCandidate(R){const H=[];for(;;){const J=this.extractOneOrMore(R,_,[1,5]);this.consumeAttributeSpace(R);const _e=this.extract(R,this.consumeAddress);this.consumeAttributeSpace(R);const it=this.extract(R,this.consumePort);H.push({componentId:J,connectionAddress:_e,port:it});try{this.consumeAttributeSpace(R)}catch{break}}this.attributes.remoteCandidatesList.push(H)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(R){const H=this.extract(R,this.consumeToken);this.consumeAttributeSpace(R);const J=this.extract(R,this.consumeTill,"/");this.extract(R,this.consume,"/");const _e={encodingName:J,clockRate:this.extractOneOrMore(R,_)};this.atEnd(R)||this.peekChar(R)!=="/"||(this.extract(R,this.consume,"/"),_e.encodingParameters=parseInt(this.extract(R,this.consumeTill),10));const it=this.attributes.payloads.find(dn=>dn.payloadType===parseInt(H,10));it?it.rtpMap=_e:this.attributes.payloads.push({payloadType:parseInt(H,10),rtpMap:_e,rtcpFeedbacks:[]})}parsePtime(R){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(R,this.consumeTill)}parseMaxPtime(R){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(R,this.consumeTill)}parseDirection(R){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=R.attField}parseSSRC(R){const H=this.extractOneOrMore(R,_);this.consumeAttributeSpace(R);const J=this.extract(R,this.consumeTill,":");let _e;this.peekChar(R)===":"&&(this.extract(R,this.consume,":"),_e=this.extract(R,this.consumeTill));const it=this.attributes.ssrcs.find(dn=>dn.ssrcId===parseInt(H,10));it?it.attributes[J]=_e:this.attributes.ssrcs.push({ssrcId:parseInt(H,10),attributes:{[J]:_e}})}parseFmtp(R){const H=this.extract(R,this.consumeTill,f);this.consumeAttributeSpace(R);const J=this.extract(R,this.consumeTill),_e={};J.split(";").forEach(dn=>{let[Ir,Ea]=dn.split("=");Ir=ks(Ir).call(Ir);const cA=typeof Ea=="string"?ks(Ea).call(Ea):null;typeof Ir=="string"&&Ir.length>0&&(_e[Ir]=cA)});const it=this.attributes.payloads.find(dn=>dn.payloadType===parseInt(H,10));it?it.fmtp={parameters:_e}:this.attributes.payloads.push({payloadType:parseInt(H,10),rtcpFeedbacks:[],fmtp:{parameters:_e}})}parseFmtParameters(R){const H={},J=this.extract(R,this.consumeTill,"=");R._cur++;const _e=this.extract(R,this.consumeTill,";");for(H[J]=_e;R.attValue[R._cur]===";";){const it=this.extract(R,this.consumeTill,"=");R._cur++;const dn=this.extract(R,this.consumeTill,";");H[it]=dn}return H}parseRtcpFb(R){let H="";H=this.peekChar(R)==="*"?this.extract(R,this.consume,"*"):this.extract(R,this.consumeTill,f),this.consumeAttributeSpace(R);const J=this.extract(R,this.consumeTill,f);let _e;if(J==="trr-int")_e={type:J,interval:this.extract(R,this.consumeTill)};else{const it={type:J};this.peekChar(R)===f&&(this.consumeAttributeSpace(R),it.parameter=this.extract(R,this.consumeToken),this.peekChar(R)===f&&(it.additional=this.extract(R,this.consumeTill))),_e=it}if(H==="*")this.attributes.rtcpFeedbackWildcards.push(_e);else{const it=this.attributes.payloads.find(dn=>dn.payloadType===parseInt(H,10));it?it.rtcpFeedbacks.push(_e):this.attributes.payloads.push({payloadType:parseInt(H,10),rtcpFeedbacks:[_e]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(R){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");const H={port:this.extract(R,this.consumePort)};this.peekChar(R)===f&&(this.consumeAttributeSpace(R),H.netType=this.extractOneOrMore(R,b),this.consumeAttributeSpace(R),H.addressType=this.extractOneOrMore(R,b),this.consumeAttributeSpace(R),H.address=this.extract(R,this.consumeAddress)),this.attributes.rtcp=H}parseMsid(R){const H={id:this.extractOneOrMore(R,b,[1,64])};this.peekChar(R)===f&&(this.consumeAttributeSpace(R),H.appdata=this.extractOneOrMore(R,b,[1,64])),this.attributes.msids.push(H)}parseImageAttr(R){this.attributes.imageattr.push(R.attValue)}parseRid(R){const H=this.extractOneOrMore(R,_e=>I(_e)||_(_e)||_e==="_"||_e==="-");this.consumeAttributeSpace(R);const J={id:H,direction:this.extract(R,this.consumeToken),params:[]};if(this.peekChar(R)===f){if(this.consumeAttributeSpace(R),this.peek(R,"pt=")){this.extract(R,this.consume,"pt=");const _e=[];for(;;){const it=this.extract(R,this.consumeToken);_e.push(it);try{this.extract(R,this.consume,",")}catch{break}}J.payloads=_e,this.peekChar(R)===f&&this.extract(R,this.consume,f)}for(;;){const _e=this.extract(R,this.consumeToken);switch(_e){case"depend":{const it={type:_e,rids:this.extract(R,this.consume,"=").split(",")};J.params.push(it);break}default:{const it={type:_e};this.peekChar(R)==="="&&(this.extract(R,this.consume,"="),it.val=this.extract(R,this.consumeTill,";")),J.params.push(it)}}try{this.extract(R,this.consume,";")}catch{break}}}this.attributes.rids.push(J)}parseSimulcast(R){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=R.attValue,this.extract(R,this.consumeTill)}parseSctpPort(R){this.attributes.sctpPort=this.extractOneOrMore(R,_,[1,5])}parseMaxMessageSize(R){this.attributes.maxMessageSize=this.extractOneOrMore(R,_,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(R){this.attributes.mid=this.extract(R,this.consumeToken)}parseSSRCGroup(R){const H=this.extract(R,this.consumeToken),J=[];for(;;)try{this.consumeAttributeSpace(R);const _e=this.extract(R,this.consumeInteger);J.push(parseInt(_e,10))}catch{break}this.attributes.ssrcGroups.push({semantic:H,ssrcIds:J})}}function pt(pe,R,H){return R in pe?Object.defineProperty(pe,R,{value:H,enumerable:!0,configurable:!0,writable:!0}):pe[R]=H,pe}class ct{constructor(){pt(this,"eol",h)}print(R,H){let J="";return H&&(this.eol=H),J+=this.printVersion(R.version),J+=this.printOrigin(R.origin),J+=this.printSessionName(R.sessionName),J+=this.printInformation(R.information),J+=this.printUri(R.uri),J+=this.printEmail(R.emails),J+=this.printPhone(R.phones),J+=this.printConnection(R.connection),J+=this.printBandwidth(R.bandwidths),J+=this.printTimeFields(R.timeFields),J+=this.printKey(R.key),J+=this.printSessionAttributes(R.attributes),J+=this.printMediaDescription(R.mediaDescriptions),J}printVersion(R){return"v=".concat(R).concat(this.eol)}printOrigin(R){return"o=".concat(R.username," ").concat(R.sessId," ").concat(R.sessVersion," ").concat(R.nettype," ").concat(R.addrtype," ").concat(R.unicastAddress).concat(this.eol)}printSessionName(R){return R?"s=".concat(R).concat(this.eol):""}printInformation(R){return R?"i=".concat(R).concat(this.eol):""}printUri(R){return R?"u=".concat(R).concat(this.eol):""}printEmail(R){let H="";for(const J of R)H+="e=".concat(J).concat(this.eol);return H}printPhone(R){let H="";for(const J of R)H+="e=".concat(J).concat(this.eol);return H}printConnection(R){return R?"c=".concat(R.nettype," ").concat(R.addrtype," ").concat(R.address).concat(this.eol):""}printBandwidth(R){let H="";for(const J of R)H+="b=".concat(J.bwtype,":").concat(J.bandwidth).concat(this.eol);return H}printTimeFields(R){let H="";for(const J of R){H+="t=".concat(J.time.startTime," ").concat(J.time.startTime).concat(this.eol);for(const _e of J.repeats)H+="r=".concat(_e.repeatInterval," ").concat(_e.typedTimes.join(" ")).concat(this.eol);J.zoneAdjustments&&(H+="z=",H+="z=".concat(J.zoneAdjustments.map(_e=>"".concat(_e.time," ").concat(_e.back?"-":""," ").concat(_e.typedTime)).join(" ")).concat(this.eol),H+=this.eol)}return H}printKey(R){return R?"k=".concat(R).concat(this.eol):""}printAttributes(R){let H="";for(const J of R)H+="a=".concat(J.attField).concat(J.attValue?":".concat(J.attValue):"").concat(this.eol);return H}printMediaDescription(R){let H="";for(const J of R)H+=this.printMedia(J.media),H+=this.printInformation(J.information),H+=this.printConnections(J.connections),H+=this.printBandwidth(J.bandwidths),H+=this.printKey(J.key),H+=this.printMediaAttributes(J);return H}printConnections(R){let H="";for(const J of R)H+=this.printConnection(J);return H}printMedia(R){return"m=".concat(R.mediaType," ").concat(R.port," ").concat(R.protos.join("/")," ").concat(R.fmts.join(" ")).concat(this.eol)}printSessionAttributes(R){return new bn(this.eol).print(R)}printMediaAttributes(R){return new he(this.eol).print(R)}}class jt{constructor(R){pt(this,"eol",void 0),this.eol=R}printIceUfrag(R){return R===void 0?"":"a=ice-ufrag:".concat(R).concat(this.eol)}printIcePwd(R){return R===void 0?"":"a=ice-pwd:".concat(R).concat(this.eol)}printIceOptions(R){return R===void 0?"":"a=ice-options:".concat(R.join(f)).concat(this.eol)}printFingerprints(R){return R.length>0?R.map(H=>"a=fingerprint:".concat(H.hashFunction).concat(f).concat(H.fingerprint)).join(this.eol)+this.eol:""}printExtmap(R){return R.map(H=>"a=extmap:".concat(H.entry).concat(H.direction?"/".concat(H.direction):"").concat(f).concat(H.extensionName).concat(H.extensionAttributes?"".concat(f).concat(H.extensionAttributes):"").concat(this.eol)).join("")}printSetup(R){return R===void 0?"":"a=setup:".concat(R).concat(this.eol)}printUnrecognized(R){return R.map(H=>"a=".concat(H.attField).concat(H.attValue?":".concat(H.attValue):"").concat(this.eol)).join("")}}class bn extends jt{print(R){let H="";return H+=this.printGroups(R.groups),H+=this.printMsidSemantic(R.msidSemantic),H+=this.printIceLite(R.iceLite),H+=this.printIceUfrag(R.iceUfrag),H+=this.printIcePwd(R.icePwd),H+=this.printIceOptions(R.iceOptions),H+=this.printFingerprints(R.fingerprints),H+=this.printSetup(R.setup),H+=this.printTlsId(R.tlsId),H+=this.printIdentity(R.identities),H+=this.printExtmap(R.extmaps),H+=this.printUnrecognized(R.unrecognized),H}printGroups(R){let H="";return R.length>0&&(H+=R.map(J=>"a=group:".concat(J.semantic).concat(J.identificationTag.map(_e=>"".concat(f).concat(_e)).join("")).concat(this.eol)).join("")),H}printIceLite(R){return R===void 0?"":"a=ice-lite"+this.eol}printTlsId(R){return R?"a=tls-id:".concat(R).concat(this.eol):""}printIdentity(R){return R.length===0?"":R.map(H=>"a=identity:".concat(H.assertionValue).concat(H.extensions.map(J=>"".concat(f).concat(J.name).concat(J.value?"=".concat(J.value):"")))).join(this.eol)+this.eol}printMsidSemantic(R){if(!R)return"";let H="a=msid-semantic:".concat(R.semantic);return R.applyForAll?H+="".concat(f,"*"):R.identifierList.length>0&&(H+=R.identifierList.map(J=>"".concat(f).concat(J))),H+this.eol}}class he extends jt{print(R){const H=R.attributes;let J="";return J+=this.printRTCP(H.rtcp),J+=this.printIceUfrag(H.iceUfrag),J+=this.printIcePwd(H.icePwd),J+=this.printIceOptions(H.iceOptions),J+=this.printCandidates(H.candidates),J+=this.printRemoteCandidatesList(H.remoteCandidatesList),J+=this.printEndOfCandidates(H.endOfCandidates),J+=this.printFingerprints(H.fingerprints),J+=this.printSetup(H.setup),J+=this.printMid(H.mid),J+=this.printExtmap(H.extmaps),J+=this.printRTPRelated(H),J+=this.printPtime(H.ptime),J+=this.printMaxPtime(H.maxPtime),J+=this.printDirection(H.direction),J+=this.printSSRCGroups(H.ssrcGroups),J+=this.printSSRC(H.ssrcs),J+=this.printRTCPMux(H.rtcpMux),J+=this.printRTCPMuxOnly(H.rtcpMuxOnly),J+=this.printRTCPRsize(H.rtcpRsize),J+=this.printMSId(H.msids),J+=this.printImageattr(H.imageattr),J+=this.printRid(H.rids),J+=this.printSimulcast(H.simulcast),J+=this.printSCTPPort(H.sctpPort),J+=this.printMaxMessageSize(H.maxMessageSize),J+=this.printUnrecognized(H.unrecognized),J}printCandidates(R){return R.map(H=>"a=candidate:".concat(H.foundation).concat(f).concat(H.componentId).concat(f).concat(H.transport).concat(f).concat(H.priority).concat(f).concat(H.connectionAddress).concat(f).concat(H.port).concat(f,"typ").concat(f).concat(H.type).concat(H.relAddr?"".concat(f,"raddr").concat(f).concat(H.relAddr):"").concat(H.relPort?"".concat(f,"rport").concat(f).concat(H.relPort):"").concat(Object.keys(H.extension).map(J=>"".concat(f).concat(J).concat(f).concat(H.extension[J])).join("")).concat(this.eol)).join("")}printRemoteCandidatesList(R){return R.map(H=>"a=remote-candidates:".concat(H.join(f)).concat(this.eol)).join("")}printEndOfCandidates(R){return R===void 0?"":"a=end-of-candidates"+this.eol}printRTPRelated(R){if(!R.payloads)return"";const H=R.payloads;let J="";J+=R.rtcpFeedbackWildcards.map(_e=>this.printRTCPFeedback("*",_e)).join("");for(const _e of H)J+=this.printRtpMap(_e.payloadType,_e.rtpMap),J+=this.printFmtp(_e.payloadType,_e.fmtp),J+=_e.rtcpFeedbacks.map(it=>this.printRTCPFeedback(_e.payloadType,it)).join("");return J}printFmtp(R,H){if(!H)return"";const J=Object.keys(H.parameters);return J.length===1&&H.parameters[J[0]]===null?"a=fmtp:".concat(R).concat(f).concat(J[0]).concat(this.eol):"a=fmtp:".concat(R).concat(f).concat(Object.keys(H.parameters).map(_e=>"".concat(_e,"=").concat(H.parameters[_e])).join(";")).concat(this.eol)}printRtpMap(R,H){return H?"a=rtpmap:".concat(R).concat(f).concat(H.encodingName,"/").concat(H.clockRate).concat(H.encodingParameters?"/".concat(H.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(R,H){let J="a=rtcp-fb:".concat(R).concat(f),_e=H;return _e.type==="trr-int"?J+="ttr-int".concat(f).concat(_e.interval):(J+="".concat(_e.type),_e.parameter&&(J+="".concat(f).concat(_e.parameter),_e.additional&&(J+="".concat(f).concat(_e.additional)))),J+this.eol}printPtime(R){return R===void 0?"":"a=ptime:".concat(R).concat(this.eol)}printMaxPtime(R){return R===void 0?"":"a=maxptime:".concat(R).concat(this.eol)}printDirection(R){return R===void 0?"":"a=".concat(R).concat(this.eol)}printSSRC(R){return R.map(H=>Object.keys(H.attributes).map(J=>"a=ssrc:".concat(H.ssrcId.toString(10)).concat(f).concat(J).concat(H.attributes[J]?":".concat(H.attributes[J]):"").concat(this.eol)).join("")).join("")}printRTCPMux(R){return R===void 0?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(R){return R===void 0?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(R){return R===void 0?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(R){if(R===void 0)return"";let H="a=rtcp:".concat(R.port);return R.netType&&(H+="".concat(f).concat(R.netType)),R.addressType&&(H+="".concat(f).concat(R.addressType)),R.address&&(H+="".concat(f).concat(R.address)),H+this.eol}printMSId(R){return R.map(H=>"a=msid:".concat(H.id).concat(H.appdata?"".concat(f).concat(H.appdata):"").concat(this.eol)).join("")}printImageattr(R){return R.map(H=>"a=imageattr:".concat(H).concat(this.eol)).join("")}printRid(R){return R.map(H=>{let J="a=rid:".concat(H.id).concat(f).concat(H.direction);return H.payloads&&(J+="".concat(f,"pt=").concat(H.payloads.join(","))),H.params.length>0&&(J+="".concat(f).concat(H.params.map(_e=>_e.type==="depend"?"depend=".concat(_e.rids.join(",")):"".concat(_e.type,"=").concat(_e.val)).join(";"))),J+this.eol}).join("")}printSimulcast(R){return R===void 0?"":"a=simulcast:".concat(R).concat(this.eol)}printSCTPPort(R){return R===void 0?"":"a=sctp-port:".concat(R).concat(this.eol)}printMaxMessageSize(R){return R===void 0?"":"a=max-message-size:".concat(R).concat(this.eol)}printMid(R){return R===void 0?"":"a=mid:".concat(R).concat(this.eol)}printSSRCGroups(R){return R.map(H=>"a=ssrc-group:".concat(H.semantic).concat(H.ssrcIds.map(J=>"".concat(f).concat(J.toString(10))).join("")).concat(this.eol)).join("")}}function ve(pe){return new fe().parse(pe)}function Be(pe,R){return new ct().print(pe,R)}}},t={};function n(i){if(t[i])return t[i].exports;var o=t[i]={exports:{}};return e[i](o,o.exports,n),o.exports}return n.d=(i,o)=>{for(var l in o)n.o(o,l)&&!n.o(i,l)&&Object.defineProperty(i,l,{enumerable:!0,get:o[l]})},n.o=(i,o)=>Object.prototype.hasOwnProperty.call(i,o),n.r=i=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(i,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(i,"__esModule",{value:!0})},n(8)})();function Ps(e){return yF.parse(e)}function Yc(e,t){return yF.print(e,t)}var kce=oa("Array","keys"),Lce=Ll,Uce=hs,Pce=B,Mce=kce,AR=Array.prototype,Fce={DOMTokenList:!0,NodeList:!0},jce=function(e){var t=e.keys;return e===AR||Pce(AR,e)&&t===AR.keys||Uce(Fce,Lce(e))?Mce:t},ms=A(jce);function Un(e,t,n){return(t=function(i){var o=function(l,d){if(typeof l!="object"||!l)return l;var h=l[Symbol.toPrimitive];if(h!==void 0){var f=h.call(l,"string");if(typeof f!="object")return f;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(l)}(i);return typeof o=="symbol"?o:o+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function wF(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}function ht(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?wF(Object(n),!0).forEach(function(i){Un(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):wF(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}function Iv(e,t){return Iv=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,i){return n.__proto__=i,n},Iv(e,t)}function dR(){dR=function(o,l){return new n(o,void 0,l)};var e=RegExp.prototype,t=new WeakMap;function n(o,l,d){var h=RegExp(o,l);return t.set(h,d||t.get(o)),Iv(h,n.prototype)}function i(o,l){var d,h=t.get(l);return ca(d=Object.keys(h)).call(d,function(f,g){var _=h[g];if(typeof _=="number")f[g]=o[_];else{for(var v=0;o[_[v]]===void 0&&v+1<_.length;)v++;f[g]=o[_[v]]}return f},Object.create(null))}return function(o,l){if(typeof l!="function"&&l!==null)throw new TypeError("Super expression must either be null or a function");o.prototype=Object.create(l&&l.prototype,{constructor:{value:o,writable:!0,configurable:!0}}),Object.defineProperty(o,"prototype",{writable:!1}),l&&Iv(o,l)}(n,RegExp),n.prototype.exec=function(o){var l=e.exec.call(this,o);if(l){l.groups=i(l,this);var d=l.indices;d&&(d.groups=i(d,this))}return l},n.prototype[Symbol.replace]=function(o,l){if(typeof l=="string"){var d=t.get(this);return e[Symbol.replace].call(this,o,l.replace(/\$<([^>]+)(>|$)/g,function(f,g,_){if(_==="")return f;var v=d[g];return Array.isArray(v)?"$"+v.join("$"):typeof v=="number"?"$"+v:""}))}if(typeof l=="function"){var h=this;return e[Symbol.replace].call(this,o,function(){var f=arguments;return typeof f[f.length-1]!="object"&&(f=[].slice.call(f)).push(i(f,h)),l.apply(this,f)})}return e[Symbol.replace].call(this,o,l)},dR.apply(this,arguments)}const bF=new class extends Tn{constructor(){super(...arguments),Un(this,"currentUploadLogID",0)}reportLogUploadError(e){const{errorRange:t}=e;t[t.length-1]&&t[t.length-1]>this.currentUploadLogID&&(this.currentUploadLogID=t[t.length-1],this.emit("REPORT_LOG_UPLOAD",e))}};class Vce{constructor(t){Un(this,"logger",void 0),Un(this,"prefixLists",[]),this.logger=t}debug(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];this.logger.debug(...this.prefixLists,...n)}info(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];this.logger.info(...this.prefixLists,...n)}warning(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];this.logger.warning(...this.prefixLists,...n)}error(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];this.logger.error(...this.prefixLists,...n)}prefix(t){return this.prefixLists.push(t),this}popPrefix(){return this.prefixLists.pop(),this}}function uR(){const e=new Date;return e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}function SF(){const e=new Date,t=/((\d+:){2}\d+)/.exec(new Date().toUTCString());return t?(t==null?void 0:t[0])+":"+e.getUTCMilliseconds():e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}const da={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},Nv=Date.now(),bm=e=>{for(const t in da)if(Object.prototype.hasOwnProperty.call(da,t)&&da[t]===e)return t;return"DEFAULT"},S=new class{constructor(){Un(this,"proxyServerURL",void 0),Un(this,"logLevel",da.DEBUG),Un(this,"uploadState","collecting"),Un(this,"uploadLogWaitingList",[]),Un(this,"uploadLogUploadingList",[]),Un(this,"uploadErrorCount",0),Un(this,"currentLogID",0),Un(this,"url",void 0),Un(this,"extLog",(e,t)=>{this.appendLogToWaitingList(e,...t)})}debug(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const i=[da.DEBUG].concat(t);this.log.apply(this,i)}info(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const i=[da.INFO].concat(t);this.log.apply(this,i)}warning(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const i=[da.WARNING].concat(t);this.log.apply(this,i)}warn(){this.warning(...arguments)}error(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const i=[da.ERROR].concat(t);this.log.apply(this,i)}upload(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const i=[da.DEBUG].concat(t);this.uploadLog.apply(this,i)}setLogLevel(e){e=Math.min(Math.max(0,e),4),this.logLevel=e}enableLogUpload(){en("UPLOAD_LOG",!0)}disableLogUpload(){en("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(e){this.proxyServerURL=e}prefix(e){return new Vce(this).prefix(e)}log(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(Date.now()-Nv<100)return void setTimeout(()=>{this.log(...t)},Date.now()-Nv);const i=Math.max(0,Math.min(4,t[0]));if(t[0]=uR()+" Agora-SDK [".concat(bm(i),"]:"),this.appendLogToWaitingList(i,...t),i<this.logLevel)return;const o=uR()+" %cAgora-SDK [".concat(bm(i),"]:");let l=[];if(!L("USE_NEW_LOG"))switch(i){case da.DEBUG:l=[o,"color: #64B5F6;"].concat(t.slice(1)),console.log.apply(console,l);break;case da.INFO:l=[o,"color: #1E88E5; font-weight: bold;"].concat(t.slice(1)),console.log.apply(console,l);break;case da.WARNING:l=[o,"color: #FB8C00; font-weight: bold;"].concat(t.slice(1)),console.warn.apply(console,l);break;case da.ERROR:l=[o,"color: #B00020; font-weight: bold;"].concat(t.slice(1)),console.error.apply(console,l)}}uploadLog(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(Date.now()-Nv<100)return void setTimeout(()=>{this.uploadLog(...t)},Date.now()-Nv);const i=Math.max(0,Math.min(4,t[0]));t[0]=uR()+" Agora-SDK [".concat(bm(i),"]:"),this.appendLogToWaitingList(i,...t)}appendLogToWaitingList(e){if(!L("UPLOAD_LOG"))return;for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];Array.isArray(n[0])?n[0][0]=SF()+" Agora-SDK [".concat(bm(e),"]:"):n[0]=SF()+" Agora-SDK [".concat(bm(e),"]:");let o="";n.forEach(l=>{typeof l=="object"&&(l=JSON.stringify(l)),o+="".concat(l," ")}),this.uploadLogWaitingList.push({payload_str:o,log_level:e,log_item_id:this.currentLogID++}),this.uploadState==="uploading"&&this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}startUpload(){this.uploadState="uploading",this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}async uploadLogs(){const e=this.uploadLogUploadingList,t={sdk_version:Aa,process_id:L("PROCESS_ID"),payload:JSON.stringify(e)};return Do(async()=>{const n=await Xs.post(this.url||(this.proxyServerURL?"https://".concat(this.proxyServerURL,"/ls/?h=").concat(L("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat(L("LOG_UPLOAD_SERVER"),"/upload/v1")),t,{responseType:"text"});if(n.data!=="OK"){const i=new Error("unexpected upload log response");throw i.response=n,i}},()=>(this.uploadLogUploadingList=[],!1),n=>{const i={status:-1,message:n.message,errorRange:e.map(o=>o.log_item_id)};return n.response?(i.status=n.response.status,i.data=n.response.data,i.headers=n.response.headers):n.request&&(i.status=n.request.status),bF.reportLogUploadError(i),!0},{timeout:L("UPLOAD_LOG_REQUEST_RETRY_INTERVAL"),maxRetryTimeout:L("UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL")})}uploadLogInterval(){this.uploadLogUploadingList.length===0&&this.uploadLogWaitingList.length===0||(this.uploadLogUploadingList.length===0&&(this.uploadLogUploadingList=this.uploadLogWaitingList.splice(0,L("UPLOAD_LOG_LENGTH_EACH_TIME"))),this.uploadLogs().then(()=>{this.uploadErrorCount=0,this.uploadLogWaitingList.length>0&&window.setTimeout(()=>this.uploadLogInterval(),L("UPLOAD_LOG_INTERVAL"))}).catch(e=>{this.uploadErrorCount+=1,this.uploadErrorCount<2?window.setTimeout(()=>this.uploadLogInterval(),L("UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1")):window.setTimeout(()=>this.uploadLogInterval(),L("UPLOAD_LOG_RETRY_INTERVAL_V1"))}))}};var CF;function Qce(e){return Kr(e.reportId,"params.reportId",0,100,!1),Kr(e.category,"params.category",0,100,!1),Kr(e.event,"params.event",0,100,!1),Kr(e.label,"params.label",0,100,!1),sn(e.value,"params.value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,!1),!0}(CF={}).FREE="free",CF.UPLOADING="uploading",function(e){e[e.MISC=0]="MISC",e[e.INTERNAL_EVENT=1]="INTERNAL_EVENT",e[e.PUBLIC_EVENT=2]="PUBLIC_EVENT",e[e.WEB_EVENT=3]="WEB_EVENT",e[e.INTERNAL_API=4]="INTERNAL_API",e[e.WEB_API=5]="WEB_API",e[e.PUBLIC_API=6]="PUBLIC_API"}({});const Hce={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0};let Ar=function(e){return e.PUBLISH="publish",e.SUBSCRIBE="subscribe",e.WS_COMPRESSOR_INIT="ws_compressor_init",e.SESSION_INIT="session_init",e.JOIN_CHOOSE_SERVER="join_choose_server",e.RTE_DETAIL="rte_detail_stats",e.REQ_USER_ACCOUNT="req_user_account",e.JOIN_GATEWAY="join_gateway",e.REJOIN_GATEWAY="rejoin_gateway",e.STREAM_SWITCH="stream_switch",e.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",e.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",e.FIRST_VIDEO_RECEIVED="first_video_received",e.FIRST_AUDIO_RECEIVED="first_audio_received",e.FIRST_VIDEO_DECODE="first_video_decode",e.FIRST_AUDIO_DECODE="first_audio_decode",e.XLA_PEER_FIRST_VIDEO_FRAME="xla_peer_first_video_frame",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_UPDATE_STREAM="on_update_stream",e.ON_REMOVE_STREAM="on_remove_stream",e.USER_ANALYTICS="req_user_analytics",e.PC_STATS="pc_stats",e.UPDATE_REMOTE_RTPCAPABILITIES="update_remote_rtpCapabilities",e.AB_TEST="ab_test",e}({}),wn=function(e){return e.SESSION="io.agora.pb.Wrtc.Session",e.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",e.RTE_DETAIL="io.agora.pb.Wrtc.RteDetailStats",e.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",e.JOIN_GATEWAY="io.agora.pb.Wrtc.JoinGateway",e.RE_JOIN_GATEWAY="io.agora.pb.Wrtc.ReJoinGateway",e.PUBLISH="io.agora.pb.Wrtc.Publish",e.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",e.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",e.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",e.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",e.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",e.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",e.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",e.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",e.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",e.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",e.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",e.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",e.XLA_PEER_FIRST_VIDEO_FRAME="io.agora.pb.Wrtc.XLAPeerFirstVideoFrame",e.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",e.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",e.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",e.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",e.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",e.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",e.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",e.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",e.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",e.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",e.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",e.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed",e.PC_STATS="io.agora.pb.Wrtc.PCStats",e.UPDATE_REMOTE_RTPCAPABILITIES="io.agora.pb.Wrtc.UpdateRemoteRTPCapabilities",e.AB_TEST="io.agora.pb.Wrtc.ABTest",e}({});(function(e){e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"})({});let Gce=function(e){return e[e.SESSION=26]="SESSION",e[e.JOIN_CHOOSE_SERVER=27]="JOIN_CHOOSE_SERVER",e[e.REQ_USER_ACCOUNT=196]="REQ_USER_ACCOUNT",e[e.JOIN_GATEWAY=28]="JOIN_GATEWAY",e[e.PUBLISH=30]="PUBLISH",e[e.SUBSCRIBE=29]="SUBSCRIBE",e[e.WS_COMPRESSOR_INIT=9430]="WS_COMPRESSOR_INIT",e[e.STREAM_SWITCH=32]="STREAM_SWITCH",e[e.AUDIO_SENDING_STOPPED=33]="AUDIO_SENDING_STOPPED",e[e.VIDEO_SENDING_STOPPED=34]="VIDEO_SENDING_STOPPED",e[e.REQUEST_PROXY_APPCENTER=35]="REQUEST_PROXY_APPCENTER",e[e.REQUEST_PROXY_WORKER_MANAGER=36]="REQUEST_PROXY_WORKER_MANAGER",e[e.API_INVOKE=41]="API_INVOKE",e[e.FIRST_VIDEO_RECEIVED=348]="FIRST_VIDEO_RECEIVED",e[e.FIRST_AUDIO_RECEIVED=349]="FIRST_AUDIO_RECEIVED",e[e.FIRST_VIDEO_DECODE=350]="FIRST_VIDEO_DECODE",e[e.FIRST_AUDIO_DECODE=351]="FIRST_AUDIO_DECODE",e[e.ON_ADD_AUDIO_STREAM=352]="ON_ADD_AUDIO_STREAM",e[e.ON_ADD_VIDEO_STREAM=353]="ON_ADD_VIDEO_STREAM",e[e.ON_UPDATE_STREAM=356]="ON_UPDATE_STREAM",e[e.ON_REMOVE_STREAM=355]="ON_REMOVE_STREAM",e[e.JOIN_CHANNEL_TIMEOUT=407]="JOIN_CHANNEL_TIMEOUT",e[e.PEER_PUBLISH_STATUS=408]="PEER_PUBLISH_STATUS",e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT",e[e.JOIN_WEB_PROXY_AP=700]="JOIN_WEB_PROXY_AP",e[e.WEBSOCKET_QUIT=671]="WEBSOCKET_QUIT",e[e.USER_ANALYTICS=1e4]="USER_ANALYTICS",e[e.AUTOPLAY_FAILED=9178]="AUTOPLAY_FAILED",e}({});function We(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return function(t,n,i){const o=i.value;if(typeof o=="function"){const l=e.className||t.__className__||(t.constructor.name==="AgoraRTCClient"?"Client":t.constructor.name);i.value=function(){for(var d,h=arguments.length,f=new Array(h),g=0;g<h;g++)f[g]=arguments[g];let _=f;if(e.argsMap)try{_=e.argsMap(this,...f)}catch(y){S.warning(y),_=[]}try{JSON.stringify(_)}catch{S.warning("arguments for method ".concat(l,".").concat(String(n)," not serializable for apiInvoke.")),_=[]}const v=(e.report||ke).reportApiInvoke(this._sessionId||null,{id:this._clientId||((d=this.store)===null||d===void 0?void 0:d.clientId)||this._ID,name:"".concat(l,".").concat(String(n)),options:_,tag:an.TRACER,reportResult:e.reportResult},e.throttleTime);try{const y=o.apply(this,f);return y instanceof be?y.then(b=>(v.onSuccess(e.reportResult&&b),b)).catch(b=>{throw v.onError(b),b}):(v.onSuccess(e.reportResult&&y),y)}catch(y){throw v.onError(y),y}}}return i}}const ke=new class{constructor(){Un(this,"baseInfoMap",new Map),Un(this,"proxyServer",void 0),Un(this,"eventUploadTimer",void 0),Un(this,"setSessionIdTimer",void 0),Un(this,"url",void 0),Un(this,"sids",new Set),Un(this,"backupUrl",void 0),Un(this,"_appId",void 0),Un(this,"_aid",0),Un(this,"keyEventUploadPendingItems",[]),Un(this,"normalEventUploadPendingItems",[]),Un(this,"apiInvokeUploadPendingItems",[]),Un(this,"apiInvokeCount",0),Un(this,"apiInvokeLoggedCount",0),Un(this,"ltsList",[]),Un(this,"lastSendNormalEventTime",Date.now()),Un(this,"customReportCounterTimer",void 0),Un(this,"customReportCount",0),Un(this,"extApiInvoke",async e=>{for(const t of e){const n=ht(ht({},t),{},{sid:null,invokeId:++this.apiInvokeCount,tag:an.TRACER});this.sendApiInvoke(n)}}),this.eventUploadTimer=window.setInterval(this.doSend.bind(this),L("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(this.appendSessionId.bind(this),L("EVENT_REPORT_SEND_INTERVAL"))}getBaseInfoBySessionId(e){return this.baseInfoMap.get(e)}setAppId(e){this._appId=e,this._aid=parseInt(e.replace(/[a-fA-F0-9]{8}/g,t=>{let[n,i]=t;return n+i}),16)||0}reportApiInvoke(e,t,n){t.timeout=t.timeout||6e4,t.reportResult=t.reportResult===void 0||t.reportResult;const i=Date.now();this.apiInvokeCount+=1;const o=this.apiInvokeCount,l=!!L("SHOW_REPORT_INVOKER_LOG"),d=!!L("SHOW_REPORT_USER_INVOKER_LOG"),h=l||d&&t.id;h&&(this.apiInvokeLoggedCount+=1);const f=this.apiInvokeLoggedCount;function g(b,D){if(h){let I="[apiInvoke-".concat(f,"]");if(t.id&&(I+="[".concat(t.id,"]")),t.name&&(I+="[".concat(t.name,"]"),t.name===yn.JOIN))return S.info("".concat(I," ").concat(b));S.info("".concat(I," ").concat(b),b==="start"?t.options:D||"")}}const _=()=>({tag:t.tag,invokeId:o,sid:e,name:t.name,apiInvokeTime:i,options:t.options,states:t.states||null});g("start");let v=!1;Sr(t.timeout).then(()=>{v||(this.sendApiInvoke(ht(ht({},_()),{},{error:P.API_INVOKE_TIMEOUT,success:!1})),g("timeout"))});const y=new ae(P.UNEXPECTED_ERROR,"".concat(t.name,": this api invoke is end"));return{onSuccess:b=>{const D=()=>{if(v)throw y;return v=!0,this.sendApiInvoke(ht(ht({},_()),{},{success:!0},t.reportResult&&{result:b})),g("onSuccess"),b};return n?iF(D,t.name+"Success",n,()=>v=!0):D()},onError:b=>{const D=()=>{if(v)throw b;v=!0,this.sendApiInvoke(ht(ht({},_()),{},{success:!1,error:b})),g("onFailure",b.toString())};return n?iF(D,t.name+"Error",n,()=>v=!0):D()}}}_send(e,t,n){this.send({type:e,data:t},n)}_sendApiInvoke(e){return this.sendApiInvoke(e)}sessionInit(e,t){if(this.baseInfoMap.has(e))return;const n=Date.now(),i=this.createBaseInfo(e,n);i.cname=t.cname,i.rteUrl=t.rteUrl;const o=Object.assign({},{willUploadConsoleLog:L("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:aR?"global":"oversea",areas:L("AREAS")&&L("AREAS").join(",")},t.extend),{stringUid:l,channelProfile:d,channelMode:h,isABTestSuccess:f,lsid:g,clientRole:_}=t,v=Date.now(),y=ht(ht({},i),{},{eventType:Ar.SESSION_INIT,appid:t.appid,browser:navigator.userAgent,buildFormat:t.buildFormat,build:cR,lts:v,elapse:v-n,extend:JSON.stringify(o),mode:t.mode,process:L("PROCESS_ID"),appType:L("APP_TYPE"),success:!0,version:Aa,stringUid:l,channelProfile:d,channelMode:h,isABTestSuccess:f,lsid:g,clientType:me(b=window.navigator.userAgent).call(b,"AgoraWebView")?42:20,clientRole:_,serviceId:L("PROCESS_ID"),extensionID:L("PLUGIN_INFO").join(",")||"",rteUrl:t.rteUrl,rteSid:t.rteSid});var b;this.send({type:wn.SESSION,data:y},!0)}reportRteDetail(e){const t=this.baseInfoMap.get(e);if(!t)return;const n=t.info,i=Date.now(),o=ht(ht({},n),{},{eventType:Ar.RTE_DETAIL,lts:i,success:!0,elapse:i-t.startTime,vid:n.vid===void 0?0:Number(n.vid),ua:navigator.userAgent});this.send({type:wn.RTE_DETAIL,data:o},!0)}joinChooseServer(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info;t.vid&&(i.vid=t.vid);const o=Date.now(),l=ht(ht({},i),{},{role:t.role,eventType:Ar.JOIN_CHOOSE_SERVER,lts:o,eventElapse:t.elapse||o-t.lts,chooseServerAddr:t.csAddr,errorCode:t.ec,elapse:o-n.startTime,success:t.succ,chooseServerAddrList:JSON.stringify(t.serverList),uid:t.uid?parseInt(t.uid):null,cid:t.cid?parseInt(t.cid):null,chooseServerIp:t.csIp||"",opid:t.opid,unilbsServerIds:t.unilbsServerIds,extend:t.extend||void 0,isHttp3:t.isHttp3,corssRegionTagReq:t.corssRegionTagReq||void 0,corssRegionTagRes:t.corssRegionTagRes||void 0,ua:navigator.userAgent,resourceTimingInfo:t.resourceTimingInfo||void 0});this.send({type:wn.JOIN_CHOOSE_SERVER,data:l},!0)}reqUserAccount(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,o=Date.now(),l=ht(ht({},i),{},{eventType:Ar.REQ_USER_ACCOUNT,lts:o,success:t.success,serverAddress:t.serverAddr,stringUid:t.stringUid,uid:t.uid,errorCode:t.errorCode,elapse:t.elapse||o-n.startTime,eventElapse:o-t.lts,extend:JSON.stringify(t.extend)});this.send({type:wn.REQ_USER_ACCOUNT,data:l},!0)}joinGateway(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info;t.vid&&(i.vid=t.vid),i.uid=t.uid,i.cid=t.cid;const o=Date.now(),{firstSuccess:l,addr:d,isProxy:h}=t,f=o-n.startTime,g=ht(ht({},i),{},{eventType:Ar.JOIN_GATEWAY,lts:o,gatewayAddr:t.addr,success:t.succ,errorCode:t.ec,errorMsg:t.errorMsg||"",elapse:f,eventElapse:o-t.lts,firstSuccess:l,signalChannel:t.signalChannel,preload:t.preload?1:0,installId:iR(),isABTestSuccess:t.isABTestSuccess?1:0,gatewayIp:null,gatewayPort:null,isProxy:h?1:0}),_=g.success?1:0;if(t.succ&&(n.lastJoinSuccessTime=o),d)if(g.signalChannel==="1"){const v=dR(/(\d+\.\d+\.\d+\.\d+):(\d+)/,{ip:1,port:2}),y=d.match(v);g.gatewayIp=y&&y.groups?y.groups.ip:"",g.gatewayPort=y&&y.groups?y.groups.port:""}else if(h){const v=d.match(/h=(\d{1,3}-){3}\d{1,3}/g),y=d.match(/p=[0-9]{1,6}/g);g.gatewayIp=v&&v.length?v[0].split("=")[1].replace(/-/g,"."):"",g.gatewayPort=y&&y.length?y[0].split("=")[1]:""}else{const v=d.match(/wss:\/\/(\d{1,3}-){3}\d{1,3}/g),y=d.match(/(:|p=)[0-9]{1,6}/g);g.gatewayIp=v&&v.length?v[0].split("//")[1].replace(/-/g,"."):"",g.gatewayPort=y&&y.length?y[0].split(/:|p=/g)[1]:""}if(l)this.send({type:wn.JOIN_GATEWAY,data:g},!0);else{let v={isSuccess:_,port:g.gatewayPort};delete g.success,delete g.eventType,delete g.firstSuccess,delete g.gatewayPort,g.vid=Number(g.vid);const y=Object.assign({},g,v,{eventType:Ar.REJOIN_GATEWAY});this.send({type:wn.RE_JOIN_GATEWAY,data:y},!0)}}joinChannelTimeout(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=Date.now(),o=ht(ht({},n.info),{},{lts:i,timeout:t,elapse:i-n.startTime});this.send({type:wn.JOIN_CHANNEL_TIMEOUT,data:o},!0)}publish(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,o=Date.now(),l=ht(ht({},i),{},{eventType:Ar.PUBLISH,lts:o,eventElapse:t.eventElapse,elapse:o-n.startTime,success:t.succ,errorCode:t.ec,videoName:t.videoName,audioName:t.audioName,screenName:t.screenName,screenshare:t.screenshare,audio:t.audio,video:t.video,p2pid:t.p2pid,publishRequestid:t.publishRequestid});this.send({type:wn.PUBLISH,data:l},!0)}subscribe(e,t,n){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,l=Date.now(),d=ht(ht({},o),{},{eventType:Ar.SUBSCRIBE,lts:l,eventElapse:t.eventElapse,elapse:l-i.startTime,success:t.succ,errorCode:t.ec,video:t.video,audio:t.audio,subscribeRequestid:t.subscribeRequestid,p2pid:t.p2pid,preSsrc:t.preSsrc?1:0},n&&{extend:JSON.stringify({isMassSubscribe:!0})});typeof t.peerid=="string"?d.peerSuid=t.peerid:d.peer=t.peerid,this.send({type:wn.SUBSCRIBE,data:d},!0)}wsCompressorInit(e){var t;const n=[...ms(t=this.baseInfoMap).call(t)],i=n.length?n[0]:"UnableToGetSid",o=this.baseInfoMap.get(i);if(!o)return;const l=o.info,d=Date.now(),h=ht(ht({},l),{},{eventType:Ar.WS_COMPRESSOR_INIT,lts:d,eventElapse:e.eventElapse,elapse:d-o.startTime,status:e.status?1:2});this.send({type:wn.WS_COMPRESSOR_INIT,data:h},!0)}firstXLAPeerFirstVideoFrame(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,o=Date.now(),l=t.peerPubStatusMs-(n.lastJoinSuccessTime||o),d=ht(ht({},i),{},{elapse:o-n.startTime,eventType:Ar.XLA_PEER_FIRST_VIDEO_FRAME,lts:o,peer:t.peer,width:t.width,height:t.height,ssrc:t.ssrc,p2pid:t.p2pid,peerPublishDuration:t.peerPublishDuration,joinChannelSuccessElapse:l,peerPubStatusMs:t.peerPubStatusMs-t.joinChannelStart,availablePublish:t.peerPublishDuration>l?1:0,preloadStart:Math.max(t.preloadStart-t.joinChannelStart,0),preloadEnd:Math.max(t.preloadEnd-t.joinChannelStart,0),encrypt:Math.max(t.apStart-t.joinChannelStart,0),ap:Math.max(t.apEnd-t.joinChannelStart,0),sua:Math.max(t.suaEnd-t.joinChannelStart,0),beforeConnect:Math.max(t.beforeConnect-t.joinChannelStart,0),peerRecevier:Math.max(t.peerReceiver-t.joinChannelStart,0),ice:Math.max(t.ice-t.joinChannelStart,0),pc:Math.max(t.pc-t.joinChannelStart,0),signalConnected:Math.max(t.signalConnected-t.joinChannelStart,0),joinReq:Math.max(t.joinReq-t.joinChannelStart,0),joinRes:Math.max(t.joinRes-t.joinChannelStart,0),userJoinNotify:Math.max(t.userJoinNotify-t.joinChannelStart,0),videoSsrcNotify:Math.max(t.videoAddNotify-t.joinChannelStart,0),subscribeDelayMs:Math.max(t.subscribeStart-t.videoAddNotify,0),subscribeStart:Math.max(t.subscribeStart-t.joinChannelStart,0),subscribeEnd:Math.max(t.subscribeEnd-t.joinChannelStart,0),firstReceived:Math.max(t.firstReceived-t.joinChannelStart,0),firstDecoded:Math.max(t.firstDecoded-t.joinChannelStart,0),firstPreRender:Math.max(t.firstPreRender-t.joinChannelStart,0),firstRender:Math.max(t.firstRender-t.joinChannelStart,0),playDelayMs:Math.max(t.playStart-t.subscribeEnd,0),playStart:Math.max(t.playStart-t.joinChannelStart,0),playEnd:Math.max(t.playEnd-t.joinChannelStart,0),isPreSub:t.isPreSub?1:0,isPrePc:t.isPrePc?1:0,isPreInstantVideo:t.isPreInstantVideo?1:0,firstReceivedEncodedFrame:t.firstReceivedEncodedFrame?Math.max(t.firstReceivedEncodedFrame-t.joinChannelStart,0):void 0,frameType:t.frameType||"",rtpTimestamp:t.rtpTimestamp||0,framePayloadType:t.framePayloadType||0,frameDataLength:t.frameDataLength||0,mimeType:t.mimeType||""});this.send({type:wn.XLA_PEER_FIRST_VIDEO_FRAME,data:d},!0)}firstRemoteVideoDecode(e,t,n,i){const o=this.baseInfoMap.get(e);if(!o)return;const l=o.info,d=Date.now(),h=ht(ht(ht({},l),i),{},{elapse:d-o.startTime,eventType:t,lts:d,firstDecodeFrame:Math.max((i.firstFrame||d)-o.startTime,0),apEnd:Math.max(i.apEnd-o.startTime,0),apStart:Math.max(i.apStart-o.startTime,0),joinGwEnd:Math.max(i.joinGwEnd-o.startTime,0),joinGwStart:Math.max(i.joinGwStart-o.startTime,0),pcEnd:Math.max(i.pcEnd-o.startTime,0),pcStart:Math.max(i.pcStart-o.startTime,0),subscriberEnd:Math.max(i.subscriberEnd-o.startTime,0),subscriberStart:Math.max(i.subscriberStart-o.startTime,0),videoAddNotify:Math.max(i.videoAddNotify-o.startTime,0)});this.send({type:n,data:h},!0)}firstRemoteFrame(e,t,n,i){const o=this.baseInfoMap.get(e);if(!o)return;const l=o.info,d=Date.now(),h=ht(ht(ht({},l),i),{},{elapse:d-o.startTime,eventType:t,lts:d});this.send({type:n,data:h},!0)}abTest(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,o=Date.now(),l=ht(ht(ht({},i),t),{},{vid:i.vid===void 0?0:Number(i.vid),elapse:o-n.startTime,eventType:Ar.AB_TEST,lts:o});this.send({type:wn.AB_TEST,data:l},!0)}pcStats(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,o=Date.now(),l=ht(ht(ht({},i),t),{},{vid:i.vid===void 0?0:Number(i.vid),elapse:o-n.startTime,eventType:Ar.PC_STATS,lts:o,preallocation:t.preallocation?1:0});this.send({type:wn.PC_STATS,data:l},!0)}updateRemoteRTPCapabilities(e,t){if(e){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,o=Date.now(),l=ht(ht(ht({},i),t),{},{vid:i.vid===void 0?0:Number(i.vid),eventType:Ar.UPDATE_REMOTE_RTPCAPABILITIES,lts:o});this.send({type:wn.UPDATE_REMOTE_RTPCAPABILITIES,data:l},!0)}}onGatewayStream(e,t,n,i){const o=this.baseInfoMap.get(e);if(!o)return;const l=o.info,d=Date.now(),h=ht(ht(ht({},l),i),{},{eventType:t,lts:d});this.send({type:n,data:h},!0)}streamSwitch(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,o=Date.now(),l=ht(ht({},i),{},{eventType:Ar.STREAM_SWITCH,lts:o,isDual:t.isdual,elapse:o-n.startTime,success:t.succ});this.send({type:wn.STREAM_SWITCH,data:l},!0)}requestProxyAppCenter(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,o=Date.now(),l=ht(ht({},i),{},{eventType:Ar.REQUEST_PROXY_APPCENTER,lts:o,eventElapse:o-t.lts,elapse:o-n.startTime,APAddr:t.APAddr,workerManagerList:t.workerManagerList,response:t.response,errorCode:t.ec,success:t.succ});this.send({type:wn.REQUEST_PROXY_APPCENTER,data:l},!0)}requestProxyWorkerManager(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,o=Date.now(),l=ht(ht({},i),{},{eventType:Ar.REQUEST_PROXY_WORKER_MANAGER,lts:o,eventElapse:o-t.lts,elapse:o-n.startTime,workerManagerAddr:t.workerManagerAddr,response:t.response,errorCode:t.ec,success:t.succ});this.send({type:wn.REQUEST_PROXY_WORKER_MANAGER,data:l},!0)}setProxyServer(e){this.proxyServer=e,e?S.debug("reportProxyServerurl: ".concat(e)):S.debug("disable reportProxyServerurl: ".concat(e))}peerPublishStatus(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,o=Date.now(),l=ht(ht({},i),{},{subscribeElapse:t.subscribeElapse,peer:t.peer,peerPublishDuration:Math.max(t.audioPublishDuration,t.videoPublishDuration),audiotag:t.audioPublishDuration>0?1:-1,videotag:t.videoPublishDuration>0?1:-1,lts:o,elapse:o-n.startTime,joinChannelSuccessElapse:o-(n.lastJoinSuccessTime||o),peerPublishDurationVideo:t.videoPublishDuration,peerPublishDurationAudio:t.audioPublishDuration});this.send({type:wn.PEER_PUBLISH_STATUS,data:l},!0)}workerEvent(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,o=Date.now();(function(l,d,h){const f=l[d];if(!f||typeof f!="string")return[l];l[d]="";const g=hc(JSON.stringify(l));let _=0;const v=[];let y=0;for(let b=0;b<f.length;b++)y+=f.charCodeAt(b)<=127?1:3,y<=h-g||(v[v.length]=Ee(Ee({},l),{},{[d]:f.substring(_,b)}),_=b,y=f.charCodeAt(b)<=127?1:3);return _!==f.length-1&&(v[v.length]=Ee(Ee({},l),{},{[d]:f.substring(_)})),v})(ht(ht(ht({},i),t),{},{elapse:o-n.startTime,lts:o,productType:"WebRTC"}),"payload",1300).forEach(l=>this.send({type:wn.WORKER_EVENT,data:l},!0))}apworkerEvent(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,o=Date.now(),l=ht(ht(ht({},i),t),{},{elapse:o-n.startTime,lts:o});this.send({type:wn.AP_WORKER_EVENT,data:l},!0)}joinWebProxyAP(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,o=Date.now(),l=ht(ht(ht({},i),t),{},{elapse:o-n.startTime,lts:o,extend:t.extend||void 0});this.send({type:wn.JOIN_WEB_PROXY_AP,data:l},!0)}WebSocketQuit(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,o=Date.now(),l=ht(ht(ht({},i),t),{},{elapse:o-n.startTime,lts:o});this.send({type:wn.WEBSOCKET_QUIT,data:l},!0)}async sendCustomReportMessage(e,t){if(this.customReportCount+=t.length,this.customReportCount>L("CUSTOM_REPORT_LIMIT"))throw new ae(P.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);this.customReportCounterTimer||(this.customReportCounterTimer=window.setInterval(()=>{this.customReportCount=0},5e3));const n=Date.now(),i=t.map(o=>({type:wn.USER_ANALYTICS,data:ht(ht({sid:e},o),{},{lts:n})}));try{L("NEW_REPORT_SERVER")?await this.postDataToStatsCollector2(i):await this.postDataToStatsCollector(i)}catch(o){throw S.error("send custom report message failed",o.toString()),new ae(P.CUSTOM_REPORT_SEND_FAILED,o.message)}}sendApiInvoke(e){const t=L("NOT_REPORT_EVENT");if(e.tag&&me(t)&&me(t).call(t,e.tag))return!1;if(e.sid===null)return this.apiInvokeUploadPendingItems.push(e),!1;const n=this.baseInfoMap.get(e.sid);if(!n)return this.apiInvokeUploadPendingItems.push(e),!1;const{cname:i,uid:o,cid:l}=n.info;let d;if(e.lts=e.lts||Date.now(),e.error)if(e.error instanceof ae){const{code:f,message:g}=e.error;d=f||g||e.error.toString()}else d=e.error.toString();const h={invokeId:e.invokeId,sid:e.sid,cname:i,cid:l,uid:o,lts:e.lts,success:e.success,elapse:e.lts-n.startTime,execElapse:e.lts-e.apiInvokeTime,apiName:e.name,options:e.options?JSON.stringify(e.options):void 0,execStates:e.states?JSON.stringify(e.states):void 0,execResult:e.result?JSON.stringify(e.result):void 0,errorCode:e.error?d:void 0,errorMsg:e.error?JSON.stringify(e.error):void 0};return this.send({type:wn.API_INVOKE,data:h},!1),!0}addSid(e){this.sids.add(e)}removeSid(e){this.sids.delete(e)}appendSessionId(){const e=this.apiInvokeUploadPendingItems;if(e.length===0)return;const t=Array.from(this.sids).find(n=>n!==null);t&&e.forEach(n=>{n&&(n.sid=t,this.sendApiInvoke(Object.assign({},n)))}),e.length=0}send(e,t){if(t)return this.keyEventUploadPendingItems.push(e),void this.sendItems(this.keyEventUploadPendingItems,!0);this.normalEventUploadPendingItems.push(e),this.normalEventUploadPendingItems.length>L("NORMAL_EVENT_QUEUE_CAPACITY")&&this.normalEventUploadPendingItems.splice(0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&Date.now()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(e,t){const n=[],i=[];for(;e.length;){const l=e.shift();n.length<20?n.push(l):i.push(l)}e.push(...i);for(const l of[...n]){var o;this.ltsList.indexOf(l.data.lts)!==-1?(l.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(l.data.lts)):(this.ltsList.push(l.data.lts),Ad(o=this.ltsList).call(o,(d,h)=>d-h))}return t||(this.lastSendNormalEventTime=Date.now()),L("ENABLE_EVENT_REPORT")&&n.length&&(L("NEW_REPORT_SERVER")?this.postDataToStatsCollector2(n):this.postDataToStatsCollector(n)).catch((l=>d=>{L("EVENT_REPORT_RETRY")&&(t?this.keyEventUploadPendingItems=this.keyEventUploadPendingItems.concat(l):(this.normalEventUploadPendingItems=this.normalEventUploadPendingItems.concat(l),this.normalEventUploadPendingItems.length>L("NORMAL_EVENT_QUEUE_CAPACITY")&&(this.normalEventUploadPendingItems.splice(0,this.normalEventUploadPendingItems.length-L("NORMAL_EVENT_QUEUE_CAPACITY")),S.warning("report: drop normal events"))))})(n)),e}async postDataToStatsCollector2(e){Ln.networkState===Us.OFFLINE&&await be.race([Ln.onlineWaiter,Sr(2*qn.maxRetryTimeout)]);const t=o=>{let l=new Uint8Array;return o.forEach(d=>{const h=KT(JSON.stringify(d.data)),f=new ArrayBuffer(5),g=(v=>{let y=0;return Object.entries(wn).forEach(b=>{let[D,I]=b;I===v.type&&(y=Gce[D])}),y})(d),_=new DataView(f);_.setUint16(0,h.byteLength,!0),_.setUint8(2,255&g),_.setUint8(3,g>>>8&255),_.setUint8(4,g>>>16&255),l=qM(l,new Uint8Array(f)),l=qM(l,h)}),l},n="event";let i=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(L("NEW_REPORT_SERVER_DOMAINS")[0],"&p=443&d=").concat(n):"https://".concat(L("NEW_REPORT_SERVER_DOMAINS")[0],"/").concat(n);for(let o=0;o<2;o+=1){o===1&&(i=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(L("NEW_REPORT_SERVER_DOMAINS")[1],"&p=443&d=").concat(n):"https://".concat(L("NEW_REPORT_SERVER_DOMAINS")[1],"/").concat(n));try{await tR(i,{timeout:1e4,data:t(e),headers:ht(ht({biz:"webrtc",sendts:Math.round(Date.now()/1e3),debug:"false"},this._appId&&{appid:this._appId}),{},{"Content-Type":"application/octet-stream"})},!0)}catch(l){if(o===1)throw l;continue}return}}async postDataToStatsCollector(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const n=(h=>{const f=h&&h.data.sid&&this.baseInfoMap.get(h.data.sid);return f&&f.info.vid&&+f.info.vid||0})(e[0]),i=n?void 0:this._aid,o={msgType:"EventMessages",sentTs:Math.round(Date.now()/1e3),payloads:e.map(h=>JSON.stringify(h)),vid:n,aid:i};Ln.networkState===Us.OFFLINE&&await be.race([Ln.onlineWaiter,Sr(2*qn.maxRetryTimeout)]);const l=t?"/events/proto-raws":"/events/messages";let d=this.url||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(L("EVENT_REPORT_DOMAIN"),"&p=").concat(L("STATS_COLLECTOR_PORT"),"&d=").concat(l):"https://".concat(L("EVENT_REPORT_DOMAIN"),":").concat(L("STATS_COLLECTOR_PORT")).concat(l));for(let h=0;h<2;h+=1){h===1&&(d=this.backupUrl||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(L("EVENT_REPORT_BACKUP_DOMAIN"),"&p=").concat(L("STATS_COLLECTOR_PORT"),"&d=").concat(l):"https://".concat(L("EVENT_REPORT_BACKUP_DOMAIN"),":").concat(L("STATS_COLLECTOR_PORT")).concat(l)));try{t?await Nce(d,{timeout:1e4,data:o}):await tR(d,{timeout:1e4,data:o})}catch(f){if(h===1)throw f;continue}return}}createBaseInfo(e,t){const n=Object.assign({},Hce);return n.sid=e,this.baseInfoMap.set(e,{info:n,startTime:t}),n}reportResourceTiming(e,t){const n=performance.getEntriesByName(e),i=n[n.length-1];i&&this.reportApiInvoke(t,{name:"Client.resourceTiming",options:i,tag:an.TRACER}).onSuccess()}};bF.on("REPORT_LOG_UPLOAD",e=>{e.networkState=Ln.networkState,ke.reportApiInvoke(null,{name:"logUploadError",options:e,tag:an.TRACER}).onSuccess("logUploadError")});let se=class extends ae{constructor(e){super(e,arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",arguments.length>2?arguments[2]:void 0),Un(this,"name","AgoraRTCException")}print(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error";return super.print(e,S)}throw(){super.throw(S)}};const Cr={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1,supportDataChannel:!1,supportPCSetConfiguration:!1,supportWebRTCEncodedTransform:!1,supportWebRTCInsertableStream:!1,supportRequestVideoFrameCallback:!1,supportWebCrypto:!1,supportSuppressLocalAudioPlayback:!1,supportRestrictOwnAudio:!1};function wt(){return Cr}function TF(){return"setSinkId"in HTMLAudioElement.prototype&&(!L("RESTRICTION_SET_PLAYBACK_DEVICE")||(Kc()||kM())&&!HM())}function Ov(){return!Cr.supportUnifiedPlan||L("CHROME_FORCE_PLAN_B")&&uc()}function Sm(e){return!(gn()||LM(87)||Ov()||!L("ENABLE_PRE_SUB")&&(e==null||!e.autoSubscribe||L("FORCE_DISABLE_AUTO_SUB")))}function RF(e){return L("ENABLE_INSTANT_VIDEO")?L("ENABLE_INSTANT_VIDEO"):!(e==null||!e.autoSubscribe||L("FORCE_DISABLE_AUTO_SUB"))}function IF(){return navigator.mediaDevices&&"getSupportedConstraints"in navigator.mediaDevices}function NF(){if(IF()){const e=navigator.mediaDevices.getSupportedConstraints();return!(!("suppressLocalAudioPlayback"in e)||!e.suppressLocalAudioPlayback)}return dc(141)||Ed(141)||vd(141)}function OF(){if(IF()){const e=navigator.mediaDevices.getSupportedConstraints();return!(!("restrictOwnAudio"in e)||!e.restrictOwnAudio)}return dc(141)||Ed(141)||vd(125)}let Wr=function(e){return e.IOS_15_16_INTERRUPTION_START="ios15_16-interruption-start",e.IOS_15_16_INTERRUPTION_END="ios15_16-interruption-end",e.IOS_INTERRUPTION_START="ios-interruption-start",e.IOS_INTERRUPTION_END="ios-interruption-end",e.STATE_CHANGE="state-change",e}({});function Dh(e,t,n){return{sampleRate:e,stereo:t,bitrate:n}}function Ut(e,t,n,i,o){return{width:e,height:t,frameRate:n,bitrateMin:i,bitrateMax:o}}function Ja(e,t,n,i,o){return{width:{max:e},height:{max:t},frameRate:n,bitrateMin:i,bitrateMax:o}}function hR(e,t){return{numSpatialLayers:e,numTemporalLayers:t}}const Kce={"90p":Ut(160,90),"90p_1":Ut(160,90),"120p":Ut(160,120,15,30,65),"120p_1":Ut(160,120,15,30,65),"120p_3":Ut(120,120,15,30,50),"120p_4":Ut(212,120),"180p":Ut(320,180,15,30,140),"180p_1":Ut(320,180,15,30,140),"180p_3":Ut(180,180,15,30,100),"180p_4":Ut(240,180,15,30,120),"240p":Ut(320,240,15,40,200),"240p_1":Ut(320,240,15,40,200),"240p_3":Ut(240,240,15,40,140),"240p_4":Ut(424,240,15,40,220),"360p":Ut(640,360,15,80,400),"360p_1":Ut(640,360,15,80,400),"360p_3":Ut(360,360,15,80,260),"360p_4":Ut(640,360,30,80,600),"360p_6":Ut(360,360,30,80,400),"360p_7":Ut(480,360,15,80,320),"360p_8":Ut(480,360,30,80,490),"360p_9":Ut(640,360,15,80,800),"360p_10":Ut(640,360,24,80,800),"360p_11":Ut(640,360,24,80,1e3),"480p":Ut(640,480,15,100,500),"480p_1":Ut(640,480,15,100,500),"480p_2":Ut(640,480,30,100,1e3),"480p_3":Ut(480,480,15,100,400),"480p_4":Ut(640,480,30,100,750),"480p_6":Ut(480,480,30,100,600),"480p_8":Ut(848,480,15,100,610),"480p_9":Ut(848,480,30,100,930),"480p_10":Ut(640,480,10,100,400),"720p":Ut(1280,720,15,120,1130),"720p_auto":Ut(1280,720,30,900,3e3),"720p_1":Ut(1280,720,15,120,1130),"720p_2":Ut(1280,720,30,120,2e3),"720p_3":Ut(1280,720,30,120,1710),"720p_5":Ut(960,720,15,120,910),"720p_6":Ut(960,720,30,120,1380),"1080p":Ut(1920,1080,15,120,2080),"1080p_1":Ut(1920,1080,15,120,2080),"1080p_2":Ut(1920,1080,30,120,3e3),"1080p_3":Ut(1920,1080,30,120,3150),"1080p_5":Ut(1920,1080,60,120,4780),"1440p":Ut(2560,1440,30,120,4850),"1440p_1":Ut(2560,1440,30,120,4850),"1440p_2":Ut(2560,1440,60,120,7350),"4k":Ut(3840,2160,30,120,8910),"4k_1":Ut(3840,2160,30,120,8910),"4k_3":Ut(3840,2160,60,120,13500)},Wce={"480p":Ja(640,480,5),"480p_1":Ja(640,480,5),"480p_2":Ja(640,480,30),"480p_3":Ja(640,480,15),"720p":Ja(1280,720,5),"720p_auto":Ut(1280,720,30,900,3e3),"720p_1":Ja(1280,720,5),"720p_2":Ja(1280,720,30),"720p_3":Ja(1280,720,15),"1080p":Ja(1920,1080,5),"1080p_1":Ja(1920,1080,5),"1080p_2":Ja(1920,1080,30),"1080p_3":Ja(1920,1080,15)},Yce={"1SL1TL":hR(1,1),"3SL3TL":hR(3,3),"2SL3TL":hR(2,3)};function $a(e){return e||(e="480p_1"),typeof e=="string"?Object.assign({},Kce[e]):e}function pR(e){return typeof e=="string"?Object.assign({},Wce[e]):e}function xv(e){return typeof e=="string"?Object.assign({},Yce[e]):e}const zce={speech_low_quality:Dh(16e3,!1),speech_standard:Dh(32e3,!1,18),music_standard:Dh(48e3,!1),standard_stereo:Dh(48e3,!0,56),high_quality:Dh(48e3,!1,128),high_quality_stereo:Dh(48e3,!0,192)};function Dv(e){return typeof e=="string"?Object.assign({},zce[e]):e}const Nd=[];function xF(e){return zn(e,"mediaSource",["screen","window","application"]),!0}let Le=function(e){return e.NEED_RENEGOTIATE="@need_renegotiate",e.NEED_REPLACE_TRACK="@need_replace_track",e.NEED_REPLACE_MIXING_TRACK="@need_replace_mixing_track",e.NEED_CLOSE="@need_close",e.NEED_ENABLE_TRACK="@need_enable_track",e.NEED_DISABLE_TRACK="@need_disable_track",e.NEED_SESSION_ID="@need_sid",e.SET_OPTIMIZATION_MODE="@set_optimization_mode",e.GET_STATS="@get_stats",e.GET_RTC_STATS="@get_rtc_stats",e.GET_LOW_VIDEO_TRACK="@get_low_video_track",e.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",e.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",e.NEED_UPDATE_VIDEO_SEND_PARAMETERS="@need_update_video_send_parameters",e.NEED_MUTE_TRACK="@need_mute_track",e.NEED_UNMUTE_TRACK="@need_unmute_track",e}({}),Wt=function(e){return e.SCREEN_TRACK="screen_track",e.CUSTOM_TRACK="custome_track",e.LOW_STREAM="low_stream",e.SCREEN_LOW_TRACK="screen_low_track",e}({}),Bh=function(e){return e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM",e}({}),qce=function(e){return e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM",e[e.HIGH_STREAM_LAYER1=4]="HIGH_STREAM_LAYER1",e[e.HIGH_STREAM_LAYER2=5]="HIGH_STREAM_LAYER2",e[e.HIGH_STREAM_LAYER3=6]="HIGH_STREAM_LAYER3",e[e.HIGH_STREAM_LAYER4=7]="HIGH_STREAM_LAYER4",e[e.HIGH_STREAM_LAYER5=8]="HIGH_STREAM_LAYER5",e[e.HIGH_STREAM_LAYER6=9]="HIGH_STREAM_LAYER6",e}({}),Xce=function(e){return e[e.DISABLE=0]="DISABLE",e[e.LOW_STREAM=1]="LOW_STREAM",e[e.AUDIO_ONLY=2]="AUDIO_ONLY",e[e.HIGH_STREAM_LAYER1=3]="HIGH_STREAM_LAYER1",e[e.HIGH_STREAM_LAYER2=4]="HIGH_STREAM_LAYER2",e[e.HIGH_STREAM_LAYER3=5]="HIGH_STREAM_LAYER3",e[e.HIGH_STREAM_LAYER4=6]="HIGH_STREAM_LAYER4",e[e.HIGH_STREAM_LAYER5=7]="HIGH_STREAM_LAYER5",e[e.HIGH_STREAM_LAYER6=8]="HIGH_STREAM_LAYER6",e}({}),Od=function(e){return e.TRANSCEIVER_UPDATED="transceiver-updated",e.SEI_TO_SEND="sei-to-send",e.SEI_RECEIVED="sei-received",e.TRACK_UPDATED="track-updated",e}({}),kh=function(e){return e.SOURCE_STATE_CHANGE="source-state-change",e.TRACK_ENDED="track-ended",e.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.CLOSED="closed",e}({}),ua=function(e){return e.FIRST_FRAME_DECODED="first-frame-decoded",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.VIDEO_STATE_CHANGED="video-state-changed",e.PLAY_START="play-start",e.PLAY_END="play-end",e.FIRST_FRAME_RENDER="first-frame-render",e}({}),Lh=function(e){return e.AUDIO="audio",e.VIDEO="video",e.DATA="data",e}({}),Qi=function(e){return e.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",e.RECEIVE_TRACK_BUFFER="receive_track_buffer",e.ON_AUDIO_BUFFER="on_audio_buffer",e.UPDATE_SOURCE="update_source",e}({});(function(e){e.UPDATE_TRACK_SOURCE="update-track-source"})({});const fR={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,currentPacketLossRate:0},mR={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},DF={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receivePacketsDiscarded:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},Jce={uplinkNetworkQuality:0,downlinkNetworkQuality:0},BF={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1};let Ms=function(e){return e.ON_TRACK="on_track",e.ON_NODE="on_node",e}({}),Hi=function(e){return e.REQUEST_UPDATE_CONSTRAINTS="request_update_constraints",e.REQUEST_CONSTRAINTS="request_constraints",e}({}),Cm=function(e){return e.IDLE="IDLE",e.INITING="INITING",e.INITEND="INITEND",e}({}),xd=function(e){return e.STATE_CHANGE="state_change",e.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",e.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",e.CAMERA_DEVICE_CHANGED="cameraDeviceChanged",e}({}),is=function(e){return e.NONE="none",e.INIT="init",e.CANPLAY="canplay",e.PLAYING="playing",e.PAUSED="paused",e.SUSPEND="suspend",e.STALLED="stalled",e.WAITING="waiting",e.ERROR="error",e.DESTROYED="destroyed",e.ABORT="abort",e.ENDED="ended",e.EMPTIED="emptied",e.LOADEDDATA="loadeddata",e}({}),pc=function(e){return e[e.VideoStateStopped=0]="VideoStateStopped",e[e.VideoStateStarting=1]="VideoStateStarting",e[e.VideoStateDecoding=2]="VideoStateDecoding",e[e.VideoStateFrozen=3]="VideoStateFrozen",e}({});const gR={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370};let Bv=function(e){return e.OPEN="open",e.MESSAGE="message",e.CLOSE="close",e.CLOSING="closing",e.ERROR="error",e}({});function xt(e,t,n,i,o){var l,d,h={};return Object.keys(i).forEach(function(f){h[f]=i[f]}),h.enumerable=!!h.enumerable,h.configurable=!!h.configurable,("value"in h||h.initializer)&&(h.writable=!0),h=ca(l=o1(d=n.slice()).call(d)).call(l,function(f,g){return g(e,t,f)||f},h),o&&h.initializer!==void 0&&(h.value=h.initializer?h.initializer.call(o):void 0,h.initializer=void 0),h.initializer===void 0?(Object.defineProperty(e,t,h),null):h}function ie(e,t,n){return(t=function(i){var o=function(l,d){if(typeof l!="object"||!l)return l;var h=l[Symbol.toPrimitive];if(h!==void 0){var f=h.call(l,"string");if(typeof f!="object")return f;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(l)}(i);return typeof o=="symbol"?o:o+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function kF(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}function fn(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?kF(Object(n),!0).forEach(function(i){ie(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):kF(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}class LF extends Tn{set _mediaStreamTrack(t){t!==this.mediaStreamTrack&&(this.safeEmit(Od.TRACK_UPDATED,t),this.mediaStreamTrack=t)}get _mediaStreamTrack(){return this.mediaStreamTrack}constructor(t,n){super(),ie(this,"trackMediaType",void 0),ie(this,"_ID",void 0),ie(this,"_rtpTransceiver",void 0),ie(this,"_lowRtpTransceiver",void 0),ie(this,"_hints",[]),ie(this,"_isClosed",!1),ie(this,"_originMediaStreamTrack",void 0),ie(this,"mediaStreamTrack",void 0),ie(this,"_external",{}),this._ID=n||zt(8,"track-"),this._originMediaStreamTrack=t,this.mediaStreamTrack=t,function(i){me(Nd).call(Nd,i)||Nd.push(i)}(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(t){return t||Gl(()=>{var n;ke.reportApiInvoke(null,{name:yn.GET_MEDIA_STREAM_TRACK,options:[],tag:an.TRACER}).onSuccess(((n=this._mediaStreamTrack)===null||n===void 0?void 0:n.label)||"")},this.mediaStreamTrack.id||this.getTrackId()),this._mediaStreamTrack}getRTCRtpTransceiver(t){return t===Bh.LOW_STREAM?this._lowRtpTransceiver:this._rtpTransceiver}getMediaStreamTrackSettings(){return this.getMediaStreamTrack(!0).getSettings()}close(){this._isClosed=!0,this._lowRtpTransceiver=void 0,this._rtpTransceiver=void 0,function(t){const n=Nd.indexOf(t);n!==-1&&Nd.splice(n,1)}(this),this.emit(kh.CLOSED),this.removeAllListeners(Od.SEI_RECEIVED)}_updateRtpTransceiver(t,n){if(n===Bh.LOW_STREAM){if(this._lowRtpTransceiver===t)return;this._lowRtpTransceiver=t}else{if(this._rtpTransceiver===t)return;this._rtpTransceiver=t}this.emit(Od.TRANSCEIVER_UPDATED,t,n)}}class Uh extends LF{get isExternalTrack(){return this._isExternalTrack}get muted(){return this._muted}get enabled(){return this._enabled}get processorContext(){return this._processorContext}constructor(t,n){super(t,n),ie(this,"_enabled",!0),ie(this,"_muted",!1),ie(this,"_isExternalTrack",!1),ie(this,"_isClosed",!1),ie(this,"_enabledMutex",void 0),ie(this,"processor",void 0),ie(this,"_processorContext",void 0),ie(this,"_handleTrackEnded",()=>{this.onTrackEnded()}),this._enabledMutex=new Lr("".concat(this.getTrackId())),t.addEventListener("ended",this._handleTrackEnded)}getTrackLabel(){var t,n;return(t=(n=this._originMediaStreamTrack)===null||n===void 0?void 0:n.label)!==null&&t!==void 0?t:""}close(){this._isClosed||(this.stop(),this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,S.debug("[".concat(this.getTrackId(),"] close")),this.emit(Le.NEED_CLOSE),super.close())}async _updateOriginMediaStreamTrack(t,n){let i=arguments.length>2&&arguments[2]!==void 0&&arguments[2];this._isExternalTrack=i,t!==this._originMediaStreamTrack&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),n&&this._originMediaStreamTrack.stop()),t.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=t,this._muted&&(this._originMediaStreamTrack.enabled=!1),this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await ln(this,Le.NEED_REPLACE_TRACK,this),this.processor&&this._processorContext&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this._processorContext}))}_getDefaultPlayerConfig(){return{}}onTrackEnded(){S.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(kh.TRACK_ENDED)}stateCheck(t,n){if(S.debug("check track state, [muted: ".concat(this._muted,", enabled: ").concat(this._enabled,"] to [").concat(t,": ").concat(n,"]")),za(n,t),this._enabled&&this._muted&&t==="enabled"&&n===!1)throw new ae(P.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print("error",S);if(!this._enabled&&!this._muted&&t==="muted"&&n===!0)throw new ae(P.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print("error",S)}getProcessorStats(){return this._processorContext&&this._processorContext.gatherStats()||[]}getProcessorUsage(){return this._processorContext?this._processorContext.gatherUsage():be.resolve([])}}const UF=window.AudioContext||window.webkitAudioContext;let _R,Gi=null;const tn=new class extends Tn{constructor(){super(...arguments),ie(this,"prevState",void 0),ie(this,"curState",void 0),ie(this,"currentTime",void 0),ie(this,"currentTimeStuckAt",void 0),ie(this,"interruptDetectorTrack",void 0),ie(this,"onLocalAudioTrackMute",()=>{S.info("ios15-interruption-start"),this.emit(Wr.IOS_15_16_INTERRUPTION_START)}),ie(this,"onLocalAudioTrackUnmute",async()=>{S.info("ios15-interruption-end"),this.curState!=="running"||this.duringInterruption?S.info("ios15-interruption-end-canceled"):(Gi&&await Gi.suspend(),this.emit(Wr.IOS_15_16_INTERRUPTION_END))})}get duringInterruption(){return this.prevState==="running"&&this.curState==="interrupted"}bindInterruptDetectorTrack(e){S.debug("webaudio bindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=e,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(e){S.debug("webaudio unbindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===e&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}};function Ph(){if(!Gi){if(function(){if(!UF)return void S.error("your browser is not support web audio");S.info("create audio context");const e=fn({},L("WEBAUDIO_INIT_OPTIONS"));S.debug("audio context init option:",JSON.stringify(e)),Gi=new UF(e),tn.curState=Gi.state,Gi.onstatechange=()=>{tn.prevState=tn.curState,tn.curState=Gi?Gi.state:void 0;const{prevState:t,curState:n}=tn,i=n==="running",o=n==="interrupted",l=t==="running",d=t==="suspended",h=t==="interrupted",f=Lt().osVersion;(fs()||Ya())&&l&&o&&(S.info("ios".concat(f,"-interruption-start")),tn.emit(Wr.IOS_INTERRUPTION_START)),(fs()||Ya())&&(d||h)&&i&&(S.info("ios".concat(f,"-interruption-end")),tn.emit(Wr.IOS_INTERRUPTION_END)),t!==n&&tn.emit(Wr.STATE_CHANGE,n,t)},setInterval(()=>{var t;const n=(t=Gi)===null||t===void 0?void 0:t.currentTime;tn.currentTime!==n?(tn.currentTimeStuckAt&&(S.debug("AudioContext current time resume at ".concat(n)),tn.currentTimeStuckAt=void 0),tn.currentTime=n):(n!==tn.currentTimeStuckAt&&(ke.reportApiInvoke(null,{name:"WEB_AUDIO_CURRENT_TIME_STUCK",options:{currentTime:n},tag:an.TRACER}).onSuccess(),S.warning("AudioContext current time stuck at ".concat(n))),tn.currentTimeStuckAt=n)},5e3),async function(t){const n=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"];let i,o,l=!1,d=!1,h=!1;function f(U){t.state==="running"?g(!1):fs()||Ya()?t.state==="suspended"&&(g(!0),U&&t.resume().then(_,_)):t.state!=="closed"&&(g(!0),U&&t.resume().then(_,_))}function g(U){if(l!==U){l=U;for(let j=0,G=n;j<G.length;j+=1){const $=G[j];U?window.addEventListener($,v,{capture:!0,passive:!0}):window.removeEventListener($,v,{capture:!0,passive:!0})}}}function _(){f(!1)}function v(){f(!0)}function y(){let U;try{U=i.play(),U?U.then(I,I):(i.addEventListener("playing",I),i.addEventListener("abort",I),i.addEventListener("error",I))}catch{I()}}function b(U){h||(i.paused?U?(D(!1),h=!0,y()):D(!0):D(!1))}function D(U){if(d!==U){d=U;for(let j=0,G=n;j<G.length;j++){const $=G[j];U?window.addEventListener($,O,{capture:!0,passive:!0}):window.removeEventListener($,O,{capture:!0,passive:!0})}}}function I(){i.removeEventListener("playing",I),i.removeEventListener("abort",I),i.removeEventListener("error",I),h=!1,b(!1)}function O(){b(!0)}if(fs()&&L("IOS_BG_TAG")){const U=t.createMediaStreamDestination(),j=document.createElement("div");j.innerHTML="<audio x-webkit-airplay='deny'></audio>",i=j.children.item(0),i.controls=!1,i.disableRemotePlayback=!0,i.preload="auto",i.srcObject=U.stream,o=()=>{if(L("IOS_AUTO_RESTART_BG_TAG")&&i&&i.srcObject&&!h&&(!i.paused||d!==!0)){i.paused||i.pause();try{h=!0,y()}catch{h=!1}return!0}},b(!0)}return tn.on(Wr.STATE_CHANGE,function(){f(!0)}),f(!1),o}(Gi).then(t=>{_R=t})}(),!Gi)throw new ae(P.NOT_SUPPORTED,"can not create audio context");return Gi}return Gi}function Dd(e){if(function(){if(ER!==null)return ER;const i=Ph(),o=i.createBufferSource(),l=i.createGain(),d=i.createGain();o.connect(l),o.connect(d),o.disconnect(l);let h=!1;try{o.disconnect(l)}catch{h=!0}return o.disconnect(),ER=h,h}())return;const t=e.connect,n=e.disconnect;e.connect=(i,o,l)=>{var d;return e._inputNodes||(e._inputNodes=[]),me(d=e._inputNodes).call(d,i)||(i instanceof AudioNode?(e._inputNodes.push(i),t.call(e,i,o,l)):t.call(e,i,o)),e},e.disconnect=(i,o,l)=>{n.call(e),i?vv(e._inputNodes,i):e._inputNodes=[];for(const d of e._inputNodes)t.call(e,d)}}let ER=null;function vR(e,t){let n=!1;const i=1/t;if(L("DISABLE_WEBAUDIO")){const o=window.setInterval(()=>{n?window.clearInterval(o):e(performance.now()/1e3)},1e3*i)}else{const o=Ph();let l=o.createGain();l.gain.value=0,l.connect(o.destination);const d=()=>{if(n)return void(l=null);const h=o.createOscillator();h.onended=d,h.connect(l),h.start(0),h.stop(o.currentTime+i),e(o.currentTime)};d()}return()=>{n=!0}}class PF{constructor(){ie(this,"context",void 0),ie(this,"analyserNode",void 0),ie(this,"sourceNode",void 0),this.context=Ph(),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4}updateSource(t){if(t!==this.sourceNode){if(this.sourceNode)try{this.sourceNode.disconnect(this.analyserNode)}catch{}this.sourceNode=t,t==null||t.connect(this.analyserNode)}}getVolumeLevel(){if(!this.sourceNode||(!this.context||fs()||Ya()||this.context.state!=="running"&&this.context.resume(),!this.analyserNode))return 0;const t=new Float32Array(this.analyserNode.fftSize);if(this.analyserNode.getFloatTimeDomainData)this.analyserNode.getFloatTimeDomainData(t);else{const i=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(i);for(let o=0;o<t.length;++o)t[o]=i[o]/128-1}const n=ca(t).call(t,(i,o)=>i+o*o,0)/t.length;return Math.max(10*Math.log10(n)+100,0)/100}getAnalyserNode(){return this.analyserNode}rebuildAnalyser(){try{var t,n;(t=this.sourceNode)===null||t===void 0||t.disconnect(this.analyserNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4,(n=this.sourceNode)===null||n===void 0||n.connect(this.analyserNode)}catch{S.warning("rebuild analyser node failed.")}}destroy(){this.updateSource(void 0)}}class MF extends Tn{get processSourceNode(){return this.sourceNode}set processedNode(t){var n;if(!this.isDestroyed&&this._processedNode!==t){try{var i;(i=this.sourceNode)===null||i===void 0||i.disconnect(this.outputNode)}catch{}(n=this._processedNode)===null||n===void 0||n.disconnect(),this._processedNode=t,this.connect()}}get processedNode(){return this._processedNode}constructor(){super(),ie(this,"outputNode",void 0),ie(this,"outputTrack",void 0),ie(this,"isPlayed",!1),ie(this,"sourceNode",void 0),ie(this,"context",void 0),ie(this,"audioBufferNode",void 0),ie(this,"destNode",void 0),ie(this,"audioOutputLevel",0),ie(this,"volumeLevelAnalyser",void 0),ie(this,"_processedNode",void 0),ie(this,"playNode",void 0),ie(this,"isDestroyed",!1),ie(this,"onNoAudioInput",void 0),ie(this,"isNoAudioInput",!1),ie(this,"_noAudioInputCount",0),this.context=Ph(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),Dd(this.outputNode),this.volumeLevelAnalyser=new PF}startGetAudioBuffer(t){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(t),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=n=>{this.emit(Qi.ON_AUDIO_BUFFER,function(i){for(let o=0;o<i.outputBuffer.numberOfChannels;o+=1){const l=i.outputBuffer.getChannelData(o);for(let d=0;d<l.length;d+=1)l[d]=0}return i.inputBuffer}(n))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!wt().webAudioMediaStreamDest)throw new ae(P.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(t){this.context.state!=="running"&&yv(()=>{tn.emit("autoplay-failed")}),this.isPlayed=!0,this.playNode=t||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch{}this.isPlayed=!1}getAccurateVolumeLevel(){return this.volumeLevelAnalyser.getVolumeLevel()}async checkHasAudioInput(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;if(t>5)return this.isNoAudioInput=!0,this.onNoAudioInput&&this.onNoAudioInput(),!1;fs()||Ya()?this.context.state==="suspended"&&this.context.resume():this.context.state!=="running"&&this.context.resume();const n=this.volumeLevelAnalyser.getAnalyserNode();let i;n.getFloatTimeDomainData?(i=new Float32Array(n.fftSize),n.getFloatTimeDomainData(i)):(i=new Uint8Array(n.fftSize),n.getByteTimeDomainData(i));let o=!1;for(let l=0;l<i.length;l++)i[l]!==0&&(o=!0);return o?(this.isNoAudioInput=!1,!0):(await Sr(200),await this.checkHasAudioInput(t?t+1:1)&&o)}getAudioVolume(){return this.outputNode.gain.value}setVolume(t){this.outputNode.gain.setValueAtTime(t,this.context.currentTime)}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){var t,n;(t=this.processedNode)===null||t===void 0||t.disconnect(),(n=this.sourceNode)===null||n===void 0||n.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){var t;this.processedNode?(t=this.processedNode)===null||t===void 0||t.connect(this.outputNode):this.sourceNode&&this.sourceNode.connect(this.outputNode),this.volumeLevelAnalyser.updateSource(this.outputNode)}}class yR extends MF{get isFreeze(){return!1}constructor(t,n,i){var o;if(super(),ie(this,"sourceNode",void 0),ie(this,"track",void 0),ie(this,"clonedTrack",void 0),ie(this,"audioElement",void 0),ie(this,"isCurrentTrackCloned",!1),ie(this,"isRemoteTrack",!1),ie(this,"originVolumeLevelAnalyser",void 0),ie(this,"rebuildWebAudio",async()=>{if(S.debug("ready to rebuild web audio, state:",this.context.state),this.isNoAudioInput&&await this.checkHasAudioInput(),!this.isNoAudioInput||this.isDestroyed)return document.body.removeEventListener("click",this.rebuildWebAudio,!0),void S.debug("rebuild web audio success, current volume status",this.getAccurateVolumeLevel());this.context.resume().then(()=>S.info("resume success")),S.debug("rebuild web audio because of ios 12 bugs"),this.disconnect();const h=this.track;this.track=this.track.clone(),this.isCurrentTrackCloned?h.stop():this.isCurrentTrackCloned=!0;const f=new MediaStream([this.track]);this.sourceNode=this.context.createMediaStreamSource(f),Dd(this.sourceNode),this.volumeLevelAnalyser.rebuildAnalyser();const g=this.outputNode.gain.value;this.outputNode=this.context.createGain(),this.outputNode.gain.setValueAtTime(g,this.context.currentTime),Dd(this.outputNode),this.emit(Qi.UPDATE_SOURCE),this.connect(),this.audioElement.srcObject=f,this.isPlayed&&this.play(this.playNode),this.checkHasAudioInput()}),t.kind!=="audio")throw new ae(P.UNEXPECTED_ERROR);this.track=t;const l=new MediaStream([this.track]);if(this.isRemoteTrack=!!n,this.sourceNode=this.context.createMediaStreamSource(l),Dd(this.sourceNode),i){const h=i.clone();h.enabled=!0,this.clonedTrack=h,S.debug("create an unmuted track ".concat(h.id," from the original track ").concat(i.id," to get the volume"));const f=this.context.createMediaStreamSource(new MediaStream([h]));Dd(f),this.originVolumeLevelAnalyser=new PF,this.originVolumeLevelAnalyser.updateSource(f)}this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=l;const d=Lt();n&&d.os===br.IOS&&Number((o=d.osVersion)===null||o===void 0?void 0:o.split(".")[0])<15&&(tn.on(Wr.STATE_CHANGE,()=>{this.context.state==="suspended"?document.body.addEventListener("click",this.rebuildWebAudio,!0):this.context.state==="running"&&this.rebuildWebAudio()}),this.checkHasAudioInput().then(h=>{h||document.body.addEventListener("click",this.rebuildWebAudio,!0)}))}updateTrack(t){this.sourceNode.disconnect(),this.track=t,this.isCurrentTrackCloned=!1;const n=new MediaStream([t]);this.sourceNode=this.context.createMediaStreamSource(n),Dd(this.sourceNode),this.processedNode||this.sourceNode.connect(this.outputNode),this.emit(Qi.UPDATE_SOURCE),this.audioElement.srcObject=n}destroy(){var t;this.audioElement.srcObject=null,this.audioElement.remove(),tn.off("state-change",this.rebuildWebAudio),(t=this.originVolumeLevelAnalyser)===null||t===void 0||t.destroy(),this.clonedTrack=void 0,super.destroy()}createMediaStreamSourceNode(t){return this.context.createMediaStreamSource(new MediaStream([t]))}updateOriginTrack(t){const n=t.clone();n.enabled=!0,this.clonedTrack&&(this.clonedTrack.stop(),this.clonedTrack=n),S.debug("create an unmuted track ".concat(n.id," from the original track ").concat(t.id," to get the volume"));const i=this.context.createMediaStreamSource(new MediaStream([n]));Dd(i),this.originVolumeLevelAnalyser&&this.originVolumeLevelAnalyser.updateSource(i)}getOriginVolumeLevel(){return this.originVolumeLevelAnalyser?this.originVolumeLevelAnalyser.getVolumeLevel():this.getAccurateVolumeLevel()}}async function FF(e,t,n){const i=(l,d)=>l?typeof l!="number"?l.max||l.exact||l.ideal||l.min||d:l:d,o={audio:!!n&&{mandatory:{chromeMediaSource:"desktop"}},video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e,maxHeight:i(t.height,1080),maxWidth:i(t.width,1920)}}};return t.frameRate&&typeof t.frameRate!="number"?(o.video.mandatory.maxFrameRate=t.frameRate.max,o.video.mandatory.minFrameRate=t.frameRate.min):typeof t.frameRate=="number"&&(o.video.mandatory.maxFrameRate=t.frameRate),await navigator.mediaDevices.getUserMedia(o)}async function $ce(e,t){const n=await jF(e.mediaSource),{sourceId:i,audio:o}=await function(l){let d=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return new be((h,f)=>{const g=document.createElement("div");g.innerText="share screen",g.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");const _=document.createElement("div");_.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");const v=document.createElement("div");v.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",v.setAttribute("style","height: 12%;");const y=document.createElement("div");y.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");const b=document.createElement("div");b.setAttribute("style","display: flex; justify-content: space-between; padding: 16px 0;");const D=document.createElement("button");D.innerHTML="cancel",D.setAttribute("style","width: 85px;"),D.onclick=()=>{document.body.removeChild(U);const j=new Error("NotAllowedError");j.name="NotAllowedError",f(j)};let I=d;const O=document.createElement("div");if(d){const j=document.createElement("input");j.setAttribute("type","checkbox");const G=document.createElement("span");j.setAttribute("style","margin-right: 6px;"),G.innerText="Share audio",j.checked=I,j.onchange=()=>{I=j.checked},O.appendChild(j),O.appendChild(G)}b.appendChild(O),b.appendChild(D),_.appendChild(v),_.appendChild(y),_.appendChild(b);const U=document.createElement("div");U.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),U.appendChild(g),U.appendChild(_),document.body.appendChild(U),l.map(j=>{if(j.id){const G=document.createElement("div");G.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let $=j.thumbnail;try{const{width:Z}=$.getSize();Z>1920&&($=$.resize({width:1920}))}catch(Z){throw Z&&Z.message.startsWith("Illegal invocation")&&console.error("Operate thumbnail error, please try to set contextIsolation: false. (https://github.com/electron/electron/issues/34953)"),Z}G.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+$.toDataURL()+' /></div><span style="	height: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+j.name.replace(/[\u00A0-\u9999<>\&]/g,function(Z){return"&#"+Z.charCodeAt(0)+";"})+"</span>",G.onclick=()=>{document.body.removeChild(U),h({sourceId:j.id,audio:I})},y.appendChild(G)}})})}(n,t);return await FF(i,e,o)}async function jF(e){let t=["window","screen"];e!=="application"&&e!=="window"||(t=["window"]),e==="screen"&&(t=["screen"]);const n=XM();if(!n)throw console.error("failed to fetch electron, please mount it to window"),new ae(P.ELECTRON_IS_NULL);let i=null;try{var o;i=((o=n.desktopCapturer)===null||o===void 0?void 0:o.getSources({types:t}))||n.ipcRenderer.invoke("DESKTOP_CAPTURER_GET_SOURCES",{types:t})}catch{i=null}i&&i.then||(i=new be((l,d)=>{n.desktopCapturer.getSources({types:t},(h,f)=>{h?d(h):l(f)})}));try{return await i}catch(l){throw new ae(P.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,l.toString())}}const wR=new Lr("safari");let VF=!1,QF=!1;async function Ki(e,t){let n=0,i=null;for(;n<2;)try{i=await Zce(e,t,n>0);break}catch(o){if(o instanceof ae)throw S.error("[".concat(t,"] ").concat(o.toString())),o;const l=kv(o.name||o.code||o,o.message);if(l.code===P.MEDIA_OPTION_INVALID){S.debug("[".concat(t,"] detect media option invalid, retry")),n+=1,await Sr(500);continue}throw S.error("[".concat(t,"] ").concat(l.toString())),l}if(!i)throw new ae(P.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return i}async function Zce(e,t,n){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new ae(P.NOT_SUPPORTED,"can not find getUserMedia");n&&(e.video&&(delete e.video.width,delete e.video.height),e.screen&&(delete e.screen.width,delete e.screen.height));const i=wt(),o=new MediaStream;if(e.audioSource&&o.addTrack(e.audioSource),e.videoSource&&o.addTrack(e.videoSource),!e.audio&&!e.video&&!e.screen)return S.debug("Using Video Source/ Audio Source"),o;if(e.screen)if(XM())e.screen.sourceId?Mh(o,await FF(e.screen.sourceId,e.screen,!!e.screenAudio)):Mh(o,await $ce(e.screen,!!e.screenAudio));else if(Kc()&&e.screen.extensionId&&e.screen.mandatory){if(!i.getStreamFromExtension)throw new ae(P.NOT_SUPPORTED,"This browser does not support screen sharing");S.debug("[".concat(t,'] Screen access on chrome stable, looking for extension"'));const y=await(d=e.screen.extensionId,h=t,new be((b,D)=>{try{chrome.runtime.sendMessage(d,{getStream:!0},I=>{if(!I||!I.streamId)return S.error("[".concat(h,"] No response from Chrome Plugin. Plugin not installed properly"),I),void D(new ae(P.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));b(I.streamId)})}catch(I){S.error("[".concat(h,"] AgoraRTC screensharing plugin is not accessible(").concat(d,")"),I.toString()),D(new ae(P.CHROME_PLUGIN_NOT_INSTALL))}}));e.screen.mandatory.chromeMediaSourceId=y,Mh(o,await navigator.mediaDevices.getUserMedia({video:{mandatory:e.screen.mandatory}}))}else if(i.getDisplayMedia){var l;e.screen.mediaSource&&xF(e.screen.mediaSource);const y={width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate,displaySurface:(l=e.screen.displaySurface)!==null&&l!==void 0?l:e.screen.mediaSource==="screen"?"monitor":e.screen.mediaSource},{selfBrowserSurface:b,surfaceSwitching:D,systemAudio:I,preferCurrentTab:O,windowAudio:U,monitorTypeSurfaces:j}=e.screen,G={selfBrowserSurface:b,surfaceSwitching:D,systemAudio:I,preferCurrentTab:O,windowAudio:U,monitorTypeSurfaces:j};!b&&delete G.selfBrowserSurface,!D&&delete G.surfaceSwitching,!I&&delete G.systemAudio,!O&&delete G.preferCurrentTab,!U&&delete G.windowAudio,!j&&delete G.monitorTypeSurfaces,S.debug("[".concat(t,"] getDisplayMedia:"),JSON.stringify({video:y,audio:e.screenAudio,controls:G})),Mh(o,await navigator.mediaDevices.getDisplayMedia(fn({video:y,audio:e.screenAudio},G)))}else{if(!gn())throw S.error("[".concat(t,"] This browser does not support screenSharing")),new ae(P.NOT_SUPPORTED,"This browser does not support screen sharing");{e.screen.mediaSource&&xF(e.screen.mediaSource);const y={video:{mediaSource:e.screen.mediaSource,width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate}};S.debug("[".concat(t,"] getUserMedia: ").concat(JSON.stringify(y))),Mh(o,await navigator.mediaDevices.getUserMedia(y))}}var d,h;if(!e.video&&!e.audio)return o;let f={video:e.video,audio:e.audio},g=L("MEDIA_DEVICE_CONSTRAINTS");if(g)try{typeof g=="string"&&(g=JSON.parse(g)),f=XT(f,g)}catch{}S.debug("[".concat(t,"] GetUserMedia"),JSON.stringify(f)),Lt();let _,v=null;(kr()||fs()||Ev())&&(v=await wR.lock());try{_=await navigator.mediaDevices.getUserMedia(f)}catch(y){throw v&&v(),y}return f.audio&&(VF=!0),f.video&&(QF=!0),Mh(o,_),v&&v(),o}function kv(e,t){switch(e){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":return new ae(P.MEDIA_OPTION_INVALID,"".concat(e,": ").concat(t));case"NotFoundError":case"DevicesNotFoundError":return new ae(P.DEVICE_NOT_FOUND,"".concat(e,": ").concat(t));case"NotSupportedError":return new ae(P.NOT_SUPPORTED,"".concat(e,": ").concat(t));case"NotReadableError":return new ae(P.NOT_READABLE,"".concat(e,": ").concat(t));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":return new ae(P.PERMISSION_DENIED,"".concat(e,": ").concat(t));case"ConstraintNotSatisfiedError":return new ae(P.CONSTRAINT_NOT_SATISFIED,"".concat(e,": ").concat(t));default:return S.error("getUserMedia unexpected error",e),new ae(P.UNEXPECTED_ERROR,"".concat(e,": ").concat(t))}}function Mh(e,t){const n=e.getVideoTracks()[0],i=e.getAudioTracks()[0],o=t.getVideoTracks()[0],l=t.getAudioTracks()[0];l&&(i&&e.removeTrack(i),e.addTrack(l)),o&&(n&&e.removeTrack(n),e.addTrack(o))}const Wi=new class extends Tn{get state(){return this._state}set state(e){e!==this._state&&(this.emit(xd.STATE_CHANGE,e),this._state=e)}constructor(){super(),ie(this,"_state",Cm.IDLE),ie(this,"isAccessMicrophonePermission",!1),ie(this,"isAccessCameraPermission",!1),ie(this,"lastAccessMicrophonePermission",!1),ie(this,"lastAccessCameraPermission",!1),ie(this,"checkdeviceMatched",!1),ie(this,"deviceInfoMap",new Map),this.init().then(()=>{navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",this.updateDevicesInfo.bind(this)),window.setInterval(()=>{(L("ENUMERATE_DEVICES_INTERVAL")||(mm()||_v()===br.HARMONY_OS)&&uc())&&this.updateDevicesInfo()},L("ENUMERATE_DEVICES_INTERVAL_TIME"))}).catch(e=>S.error(e.toString()))}async enumerateDevices(e,t){let n=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)throw new ae(P.NOT_SUPPORTED,"enumerateDevices() not supported.");const i=await navigator.mediaDevices.enumerateDevices(),o=this.checkMediaDeviceInfoIsOk(i);let l=!this.isAccessMicrophonePermission&&e,d=!this.isAccessCameraPermission&&t;o.audio&&(l=!1),o.video&&(d=!1);let h=null,f=null,g=null;if(!n&&(l||d)){if(wR.isLocked&&(S.debug("[device manager] wait GUM lock"),(await wR.lock())(),S.debug("[device manager] GUM unlock")),VF&&(l=!1,this.isAccessMicrophonePermission=!0),QF&&(d=!1,this.isAccessCameraPermission=!0),S.debug("[device manager] check media device permissions",e,t,l,d),l&&d){try{g=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(_){const v=kv(_.name||_.code||_,_.message);if(v.code===P.PERMISSION_DENIED)throw v;S.warning("getUserMedia failed in getDevices",v)}this.isAccessCameraPermission=!0,this.isAccessMicrophonePermission=!0}else if(l){try{h=await navigator.mediaDevices.getUserMedia({audio:e})}catch(_){const v=kv(_.name||_.code||_,_.message);if(v.code===P.PERMISSION_DENIED)throw v;S.warning("getUserMedia failed in getDevices",v)}this.isAccessMicrophonePermission=!0}else if(d){try{f=await navigator.mediaDevices.getUserMedia({video:t})}catch(_){const v=kv(_.name||_.code||_,_.message);if(v.code===P.PERMISSION_DENIED)throw v;S.warning("getUserMedia failed in getDevices",v)}this.isAccessCameraPermission=!0}S.debug("[device manager] mic permission",e,"cam permission",t)}try{const _=await navigator.mediaDevices.enumerateDevices();return h&&h.getTracks().forEach(v=>v.stop()),f&&f.getTracks().forEach(v=>v.stop()),g&&g.getTracks().forEach(v=>v.stop()),h=null,f=null,g=null,_}catch(_){return h&&h.getTracks().forEach(v=>v.stop()),f&&f.getTracks().forEach(v=>v.stop()),g&&g.getTracks().forEach(v=>v.stop()),h=null,f=null,g=null,new ae(P.ENUMERATE_DEVICES_FAILED,_.toString()).throw()}}async getRecordingDevices(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter(t=>t.kind==="audioinput")}async getCamerasDevices(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!1,!0,e)).filter(t=>t.kind==="videoinput")}async getSpeakers(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter(t=>t.kind==="audiooutput")}searchDeviceIdByName(e){let t=null;return this.deviceInfoMap.forEach(n=>{n.device.label===e&&(t=n.device.deviceId)}),t}async getDeviceById(e){const t=(await this.enumerateDevices(!0,!0,!0)).find(n=>n.deviceId===e);if(!t)throw new ae(P.DEVICE_NOT_FOUND,"deviceId: ".concat(e));return t}async init(){this.state=Cm.INITING;try{await this.updateDevicesInfo(),this.state=Cm.INITEND}catch(e){throw this.state=Cm.IDLE,(typeof isSecureContext=="boolean"?isSecureContext:location.protocol==="https:"||location.protocol==="file:"||location.hostname==="localhost"||location.hostname==="127.0.0.1"||location.hostname==="::1")?(S.warning("Device Detection functionality cannot start properly.",e.toString()),e):new ae(P.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.")}}async updateDevicesInfo(){const e=await this.enumerateDevices(!0,!0,!0),t=Date.now(),n=[];if(e[0]&&e[0].label&&this.checkdeviceMatched===!1){this.checkdeviceMatched=!0;const o=e.find(d=>d.kind==="audioinput"&&d.deviceId==="default"),l=e.find(d=>d.kind==="audiooutput"&&d.deviceId==="default");o&&l?l.groupId===o.groupId?S.debug("[device-check] default input ".concat(o.label," and output ").concat(l.label," is the same group")):S.debug("[device-check] default input ".concat(o.label," and output ").concat(l.label," is not the same group")):S.debug("[device-check] default input or output not found")}const i=this.checkMediaDeviceInfoIsOk(e);if(e.forEach(o=>{if(!o.deviceId)return;const l=this.deviceInfoMap.get("".concat(o.kind,"_").concat(o.deviceId));if((l?l.state:"INACTIVE")!=="ACTIVE"){const d={initAt:t,updateAt:t,device:o,state:"ACTIVE"};this.deviceInfoMap.set("".concat(o.kind,"_").concat(o.deviceId),d),n.push(d)}l&&(l.updateAt=t)}),this.deviceInfoMap.forEach((o,l)=>{o.state==="ACTIVE"&&o.updateAt!==t&&(o.state="INACTIVE",n.push(o))}),this.state!==Cm.INITEND)return i.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),void(i.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0));n.forEach(o=>{switch(o.device.kind){case"audioinput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(xd.RECORDING_DEVICE_CHANGED,o);break;case"videoinput":this.lastAccessCameraPermission&&this.isAccessCameraPermission&&this.emit(xd.CAMERA_DEVICE_CHANGED,o);break;case"audiooutput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(xd.PLAYOUT_DEVICE_CHANGED,o)}}),i.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),i.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0)}checkMediaDeviceInfoIsOk(e){const t=e.filter(o=>o.kind==="audioinput"),n=e.filter(o=>o.kind==="videoinput"),i={audio:!1,video:!1};for(const o of t)if(o.label&&o.deviceId){i.audio=!0;break}for(const o of n)if(o.label&&o.deviceId){i.video=!0;break}return i}};let bR=!1;const $s=new class extends Tn{constructor(){super(...arguments),ie(this,"onAutoplayFailed",void 0),ie(this,"onAudioAutoplayFailed",void 0)}};function HF(){if(bR)return L("FLS_AUTOPLAY_EMITS")?($s.onAutoplayFailed&&$s.onAutoplayFailed(),$s.emit("autoplay-failed")):void 0;{const e=t=>{t.preventDefault(),bR=!1,gm()?document.body.removeEventListener("click",e,!0):(document.body.removeEventListener("touchstart",e,!0),document.body.removeEventListener("mousedown",e,!0))};bR=!0,gm()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0)),S.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),$s.onAutoplayFailed?$s.onAutoplayFailed():$s.onAudioAutoplayFailed?S.warning(`AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.

  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`):S.warning(`We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.

  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.

  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`),$s.emit("autoplay-failed")}}function GF(e,t,n,i){if(!e)return;const o=ke.getBaseInfoBySessionId(e);if(!o)return;const l=o.info,d=Date.now(),h=fn(fn({},l),{},{vid:l.vid===void 0?0:Number(l.vid),lts:d,elapse:d-o.startTime,cbRegistered:$s.onAutoplayFailed||$s.onAudioAutoplayFailed?1:-1,errorMsg:n,mediaType:t,trackId:i,extend:void 0});ke.send({type:wn.AUTOPLAY_FAILED,data:h},!0)}const ele=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","error"],Ts=new class{constructor(){ie(this,"onAutoplayFailed",void 0),ie(this,"elementMap",new Map),ie(this,"elementStateMap",new Map),ie(this,"elementsNeedToResume",[]),ie(this,"sinkIdMap",new Map),ie(this,"autoResumeAfterInterruption",e=>be.all(Array.from(this.elementMap.entries()).map(async t=>{let[n,i]=t;const o=this.elementStateMap.get(n),l=i.srcObject.getAudioTracks()[0],d=l&&l.readyState;if(S.debug("resume after interrupted, ele: ".concat(o," audio: ").concat(d," ").concat(e)),d==="live"){if(e)return i.pause(),i.play();if(tn.curState==="running")return Sh()?(i.pause(),i.play()):o&&o==="paused"?i.play():void 0}}))),ie(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{Array.from(this.elementMap.entries()).forEach(e=>{let[t,n]=e;const i=n.srcObject.getAudioTracks()[0];i&&i.readyState==="live"&&(S.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),n.pause(),n.play())})}),this.autoResumeAudioElement(),tn.on(Wr.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),tn.on(Wr.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),tn.on(Wr.STATE_CHANGE,()=>{fs()&&tn.prevState==="suspended"&&tn.curState==="running"&&this.autoResumeAfterInterruption()})}async setSinkID(e,t){const n=this.elementMap.get(e);if(this.sinkIdMap.set(e,t),n)try{await n.setSinkId(t)}catch(i){throw new ae(P.PERMISSION_DENIED,"can not set sink id: "+i.toString())}}play(e,t,n,i){if(this.elementMap.has(t))return;const o=document.createElement("audio");o.autoplay=!0,o.srcObject=new MediaStream([e]),this.bindAudioElementEvents(t,o),this.elementMap.set(t,o),this.elementStateMap.set(t,is.INIT),this.setVolume(t,n);const l=this.sinkIdMap.get(t);if(l)try{o.setSinkId(l).catch(h=>{S.warning("[".concat(t,"] set sink id failed"),h.toString())})}catch(h){S.warning("[".concat(t,"] set sink id failed"),h.toString())}const d=o.play();d&&d.then&&d.catch(h=>{i&&GF(i,"audio",h.message,t),S.warning("audio element play warning",h.toString()),this.elementMap.has(t)&&h.name==="NotAllowedError"&&(S.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(o),yv(()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),HF()}))})}updateTrack(e,t){const n=this.elementMap.get(e);n&&(n.srcObject=new MediaStream([t]))}isPlaying(e){return this.elementMap.has(e)&&this.elementStateMap.get(e)==="playing"}setVolume(e,t){const n=this.elementMap.get(e);n&&(t=Math.max(0,Math.min(100,t)),n.volume=t/100)}getVolume(e){const t=this.elementMap.get(e);return t?t.volume:0}stop(e){const t=this.elementMap.get(e);if(this.sinkIdMap.delete(e),!t)return;const n=this.elementsNeedToResume.indexOf(t);this.elementsNeedToResume.splice(n,1),t.srcObject=null,t.remove(),this.elementMap.delete(e),this.elementStateMap.delete(e)}bindAudioElementEvents(e,t){ele.forEach(n=>{t.addEventListener(n,i=>{const o=this.elementStateMap.get(e),l=i.type==="pause"?"paused":i.type;if(S.debug("[".concat(e,"] audio-element-status change ").concat(o," => ").concat(l)),i.type==="error"){const d=t==null?void 0:t.error;d&&S.error("[".concat(e,"] media error, code: ").concat(d.code,", message: ").concat(d.message))}this.elementStateMap.set(e,l)})})}getPlayerState(e){return this.elementStateMap.get(e)||"uninit"}autoResumeAudioElement(){const e=()=>{this.elementsNeedToResume.forEach(t=>{t.play().then(n=>{S.debug("Auto resume audio element success")}).catch(n=>{S.warning("Auto resume audio element failed!",n)})}),this.elementsNeedToResume=[]};new be(t=>{document.body?t():window.addEventListener("load",()=>t())}).then(()=>{gm()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0))})}};function Pn(){return function(e,t,n){const i=n.value;return typeof i=="function"&&(n.value=function(){this._isClosed&&new ae(P.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning",S);for(var o=arguments.length,l=new Array(o),d=0;d<o;d++)l[d]=arguments[d];const h=i.apply(this,l);return h instanceof be?new be((f,g)=>{h.then(f).catch(g)}):h}),n}}class KF extends Tn{constructor(t){super(),ie(this,"name","VideoProcessorDestination"),ie(this,"ID","0"),ie(this,"_source",void 0),ie(this,"videoContext",void 0),ie(this,"inputTrack",void 0),this.videoContext=t}get kind(){return"video"}get enabled(){return!0}pipe(){throw new ae(P.NOT_SUPPORTED,"VideoProcessor cannot pipe to any other Processor")}unpipe(){throw new ae(P.NOT_SUPPORTED,"VideoProcessor cannot unpipe to any other Processor")}enable(){}disable(){}updateInput(t){if(t.context!==this.videoContext)throw new Error(`ProcessorContext passed to VideoTrack.processorDestination doesn't match it's belonging VideoTrack's context.
Probably you are making pipeline like this:
videoTrack1.pipe(processor).pipe(videoTrack2.processorDestination).`);t.track&&t.track!==this.inputTrack&&(this.videoContext.chained=!0,this.inputTrack=t.track,this.emit(Ms.ON_TRACK,t.track))}reset(){this.inputTrack=void 0,this.videoContext.chained=!1,this.emit(Ms.ON_TRACK,void 0)}}class WF extends Tn{set chained(t){this._chained=t}get chained(){return this._chained}constructor(t,n){super(),ie(this,"constraintsMap",new Map),ie(this,"statsRegistry",[]),ie(this,"usageRegistry",[]),ie(this,"trackId",void 0),ie(this,"direction",void 0),ie(this,"_chained",!1),this.trackId=t,this.direction=n}async getConstraints(){return await ir(this,Hi.REQUEST_CONSTRAINTS)}async requestApplyConstraints(t,n){var i;return S.info("processor ".concat(n.name," requestApplyConstraints for ").concat(this.trackId)),t&&this.constraintsMap.set(n,t),ln(this,Hi.REQUEST_UPDATE_CONSTRAINTS,Array.from(Ti(i=this.constraintsMap).call(i)))}async requestRevertConstraints(t){var n;if(this.constraintsMap.has(t))return S.info("processor ".concat(t.name," requestRevertConstraints for ").concat(this.trackId)),this.constraintsMap.delete(t),ln(this,Hi.REQUEST_UPDATE_CONSTRAINTS,Array.from(Ti(n=this.constraintsMap).call(n)))}registerStats(t,n,i){this.statsRegistry.find(o=>o.processorID===t.ID&&o.processorName===t.name&&o.type===n)||this.statsRegistry.push({processorName:t.name,processorID:t.ID,type:n,cb:i})}unregisterStats(t,n){const i=this.statsRegistry.findIndex(o=>o.processorID===t.ID&&o.processorName===t.name&&o.type===n);i!==-1&&this.statsRegistry.splice(i,1)}gatherStats(){const t=[];for(const{processorID:n,processorName:i,type:o,cb:l}of this.statsRegistry)try{const d=l();t.push({processorID:n,processorName:i,type:o,stats:d})}catch(d){S.error(new ae(P.UNEXPECTED_ERROR,d.message))}return t}registerUsage(t,n){this.usageRegistry.find(i=>i.processorID===t.ID&&i.processorName===t.name)||this.usageRegistry.push({processorID:t.ID,processorName:t.name,cb:n})}unregisterUsage(t){const n=this.usageRegistry.findIndex(i=>i.processorID===t.ID&&i.processorName===t.name);n!==-1&&this.usageRegistry.splice(n,1)}async gatherUsage(){const t=[];if(!this.chained)return[];for(const{cb:n}of this.usageRegistry)try{let i=n();i instanceof be&&(i=await i),t.push(fn(fn({},i),{},{direction:this.direction}))}catch(i){S.error("gather extension usage error",i)}return t}getDirection(){return this.direction}}class YF extends Tn{constructor(t){super(),ie(this,"name","AudioProcessorDestination"),ie(this,"ID","0"),ie(this,"inputTrack",void 0),ie(this,"inputNode",void 0),ie(this,"audioProcessorContext",void 0),ie(this,"_source",void 0),this.audioProcessorContext=t}get kind(){return"audio"}get enabled(){return!0}pipe(){throw new ae(P.NOT_SUPPORTED,"AudioProcessorDestination cannot pipe to any other Processor")}unpipe(){throw new ae(P.NOT_SUPPORTED,"AudioProcessor cannot unpipe to any other Processor")}enable(){}disable(){}reset(){this.inputTrack=void 0,this.inputNode=void 0,this.audioProcessorContext.chained=!1,this.emit(Ms.ON_TRACK,void 0),this.emit(Ms.ON_NODE,void 0)}updateInput(t){if(t.context!==this.audioProcessorContext)throw new Error(`ProcessorContext passed to AudioTrack.processorDestination doesn't match it's belonging AudioTrack's context.
        Probably you are making pipeline like this: audioTrack1.pipe(processor).pipe(audioTrack2.processorDestination).`);t.track&&this.inputTrack!==t.track&&(this.audioProcessorContext.chained=!0,this.inputTrack=t.track,this.emit(Ms.ON_TRACK,this.inputTrack)),t.node&&this.inputNode!==t.node&&(this.audioProcessorContext.chained=!0,this.inputNode=t.node,this.emit(Ms.ON_NODE,this.inputNode))}}class zF extends Tn{set chained(t){this._chained=t}get chained(){return this._chained}constructor(t,n,i){super(),ie(this,"constraintsMap",new Map),ie(this,"statsRegistry",[]),ie(this,"audioContext",void 0),ie(this,"trackId",void 0),ie(this,"direction",void 0),ie(this,"usageRegistry",[]),ie(this,"_chained",!1),this.audioContext=t,this.trackId=n,this.direction=i}async getConstraints(){return ir(this,Hi.REQUEST_CONSTRAINTS)}getAudioContext(){return this.audioContext}async requestApplyConstraints(t,n){var i;return S.info("processor ".concat(n.name," requestApplyConstraints for ").concat(this.trackId)),t&&this.constraintsMap.set(n,t),ln(this,Hi.REQUEST_UPDATE_CONSTRAINTS,Array.from(Ti(i=this.constraintsMap).call(i)))}async requestRevertConstraints(t){var n;if(this.constraintsMap.has(t))return this.constraintsMap.delete(t),ln(this,Hi.REQUEST_UPDATE_CONSTRAINTS,Array.from(Ti(n=this.constraintsMap).call(n)))}registerStats(t,n,i){this.statsRegistry.find(o=>o.processorID===t.ID&&o.processorName===t.name&&o.type===n)||this.statsRegistry.push({processorName:t.name,processorID:t.ID,type:n,cb:i})}unregisterStats(t,n){const i=this.statsRegistry.findIndex(o=>o.processorID===t.ID&&o.processorName===t.name&&o.type===n);i!==-1&&this.statsRegistry.splice(i,1)}gatherStats(){const t=[];for(const{processorID:n,processorName:i,type:o,cb:l}of this.statsRegistry)try{const d=l();t.push({processorID:n,processorName:i,type:o,stats:d})}catch(d){S.error(new ae(P.UNEXPECTED_ERROR,d.message))}return t}registerUsage(t,n){this.usageRegistry.find(i=>i.processorID===t.ID&&i.processorName===t.name)||this.usageRegistry.push({processorID:t.ID,processorName:t.name,cb:n})}unregisterUsage(t){const n=this.usageRegistry.findIndex(i=>i.processorID===t.ID&&i.processorName===t.name);n!==-1&&this.usageRegistry.splice(n,1)}async gatherUsage(){const t=[];if(!this.chained)return[];for(const{cb:n}of this.usageRegistry)try{let i=n();i instanceof be&&(i=await i),t.push(fn(fn({},i),{},{direction:this.direction}))}catch(i){S.error("gather extension usage error",i)}return t}getDirection(){return this.direction}}class SR extends Tn{get isPlayed(){return!0}get isFreeze(){return!1}constructor(){super(),ie(this,"context",void 0),ie(this,"processSourceNode",void 0),ie(this,"outputTrack",void 0),ie(this,"processedNode",void 0),ie(this,"clonedTrack",void 0),ie(this,"outputNode",void 0),this.outputNode=new tle}setVolume(){}createOutputTrack(){throw new ae(P.NOT_SUPPORTED,"can not create output MediaStreamTrack when WebAudio disabled")}getOriginVolumeLevel(){return 0}getAccurateVolumeLevel(){return 0}stopGetAudioBuffer(){}startGetAudioBuffer(){}play(){}stop(){}destroy(){}updateTrack(){}updateOriginTrack(){}createMediaStreamSourceNode(){}}class tle{disconnect(){}connect(){}}function qF(e){return new be((t,n)=>{let i=!1;const o=document.createElement("video");o.setAttribute("autoplay",""),o.setAttribute("muted",""),o.muted=!0,o.autoplay=!0,o.setAttribute("playsinline",""),o.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(o);const l=fs()?"canplay":"playing";o.addEventListener(l,()=>{const d=o.videoWidth,h=o.videoHeight;!d&&gn()||(i=!0,o.srcObject=null,o.remove(),t([d,h]))}),o.srcObject=new MediaStream([e]),o.play().catch(vm),setTimeout(()=>{i||(o.srcObject=null,o.remove(),t([o.videoWidth,o.videoHeight]))},4e3)})}function Lv(e){const t={};e.facingMode&&(t.facingMode=e.facingMode),e.cameraId&&(t.deviceId={exact:e.cameraId});const n=$a(e.encoderConfig);return n.width!=null&&(t.width=n.width),n.height!=null&&(t.height=n.height),!QM()&&n.frameRate&&(t.frameRate=n.frameRate),kM()&&typeof t.frameRate=="object"&&(t.frameRate.max=60),gn()&&(t.frameRate={ideal:30,max:30}),t}function XF(e){const t={};return QM()||(e.AGC!==void 0&&(t.autoGainControl=e.AGC),e.AEC!==void 0&&(t.echoCancellation=e.AEC),e.ANS!==void 0&&(t.noiseSuppression=e.ANS,Kc()&&e.ANS&&(t.googHighpassFilter=e.ANS))),t}function JF(e){const t=XF(e);if(e.encoderConfig){const n=Dv(e.encoderConfig);t.channelCount=n.stereo?2:1,t.sampleRate=n.sampleRate,t.sampleSize=n.sampleSize}return e.microphoneId&&(t.deviceId={exact:e.microphoneId}),mm()&&(t.sampleRate=void 0),t}const $F=e=>{const t=e._encoderConfig;if(!t)return;const{frameRate:n,width:i,height:o}=e.getMediaStreamTrackSettings();let{frameRate:l=n,width:d=i,height:h=o}=t;if(!l||!d||!h)return;d=Rh(d),h=Rh(h),l=Rh(l);const{max:f,min:g}=function(b,D,I){const O=200*Math.pow(I/15,.6)*Math.pow(b*D/640/360,.75);return{min:Math.floor(O),max:Math.floor(4*O)}}(d,h,l),{bitrateMax:_,bitrateMin:v}=t||{};_||S.debug("calculate bitrate: [w: ".concat(d,", h: ").concat(h,", fps: ").concat(l,"] => [brMax: ").concat(_,", brMin: ").concat(v,"]"));const{maxFramerate:y}=L("ENCODER_CONFIG_LIMIT");return y&&typeof y=="number"&&(l=Math.min(l,y)),{frameRate:l,bitrateMax:_||f,bitrateMin:v||g,scaleResolutionDownBy:1,scale:0}},ZF=async(e,t,n)=>await(async(i,o,l)=>{const d=function(g){const _=[];for(let v=0;v<g.length;v+=2)_.push(parseInt(g.slice(v,v+2),16));return Uint8Array.from(_)}(cF(""+o+l)).slice(0,16),h=d.slice(0,12),f=await window.crypto.subtle.importKey("raw",d,"AES-GCM",!0,["encrypt"]);return new Uint8Array(await window.crypto.subtle.encrypt({name:"AES-GCM",iv:h},f,i))})(e.buffer,t,n),CR=e=>{const t=document.createElement("canvas");return t.width=2,t.height=2,new be((n,i)=>{t.toBlob(async o=>{if(t.remove(),o){const l=await ej(o);n({buffer:l,width:t.width,height:t.height})}else i(new ae(P.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},e,1)})},ej=async e=>{const t=await e.arrayBuffer();return new Uint8Array(t)};var tj,nj,rj,sj,ij,aj,oj,cj,lj,Aj,dj,uj,hj,pj,fj,mj,gj,_j,Bn,Ej,vj,yj,wj,bj,Sj,fc,Cj,Tj,Rj,Ij,Nj,Oj,xj,Dj,Bj,kj,Lj,Uj,Pj,Zr;let Mn=(tj=We({argsMap:(e,t)=>[e.getTrackId(),t],throttleTime:300}),nj=We({argsMap:(e,t)=>[e.getTrackId(),t]}),rj=Pn(),sj=Ih("LocalAudioTrack","_enabledMutex"),ij=We({argsMap:(e,t)=>[e.getTrackId(),t]}),aj=Pn(),oj=Ih("LocalAudioTrack","_enabledMutex"),cj=We({argsMap:(e,t)=>[e.getTrackId(),t]}),lj=Pn(),Aj=Pn(),dj=Pn(),uj=We({argsMap:e=>[e.getTrackId()]}),hj=Pn(),pj=We({argsMap:e=>[e.getTrackId()]}),fj=Pn(),mj=We({argsMap:e=>[e.getTrackId()]}),gj=We({argsMap:(e,t)=>[e.getTrackId(),t.name]}),_j=We({argsMap:e=>[e.getTrackId()]}),xt((Bn=class extends Uh{get _source(){return this.initWebAudio()}set _source(e){this._trackSource=e}get processorContext(){return this._processorContext||(this._processorContext=this.initProcessor().processorContext),this._processorContext}get processorDestination(){return this._processorDestination||(this._processorDestination=this.initProcessor().processorDestination),this._processorDestination}get isPlaying(){return this._useAudioElement?Ts.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"LocalAudioTrack"}constructor(e,t,n,i){super(e,n),ie(this,"trackMediaType",Lh.AUDIO),ie(this,"_encoderConfig",void 0),ie(this,"_trackSource",void 0),ie(this,"metadata",[]),ie(this,"_enabled",!0),ie(this,"_volume",100),ie(this,"_useAudioElement",!0),ie(this,"_bypassWebAudio",!1),ie(this,"processor",void 0),ie(this,"_processorContext",void 0),ie(this,"_processorDestination",void 0),ie(this,"_getOriginVolumeLevel",void 0),this._encoderConfig=t,this._getOriginVolumeLevel=!!i,this._trackSource=new SR,L("DISABLE_WEBAUDIO")&&(this._bypassWebAudio=!0),L("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1),kr()&&!Gi?setTimeout(()=>this.initWebAudio()):this.initWebAudio()}setVolume(e){sn(e,"volume",0,1e3),this._volume=e,this._source.setVolume(e/100),this._useAudioElement&&Ts.setVolume(this.getTrackId(),e);try{if(this._bypassWebAudio)return void S.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));const t=this._source.createOutputTrack();this._mediaStreamTrack!==t&&(this._mediaStreamTrack=t,ln(this,Le.NEED_REPLACE_TRACK,this).then(()=>{S.debug("[".concat(this.getTrackId(),"] replace web audio track success"))}).catch(n=>{S.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),n)}))}catch{}}getVolumeLevel(){return this._muted&&this.enabled&&this._getOriginVolumeLevel?this._source.getOriginVolumeLevel():this._source.getAccurateVolumeLevel()}async setPlaybackDevice(e){if(!this._useAudioElement||!TF())throw new ae(P.NOT_SUPPORTED,"your browser does not support setting the audio output device");await Ts.setSinkID(this.getTrackId(),e)}async setEnabled(e,t,n){return this._setEnabled(e,t,n)}async _setEnabled(e,t,n){if(!n){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(S.info("[".concat(this.getTrackId(),"] start setEnabled"),e),e){this._originMediaStreamTrack.enabled=!0;try{n||(this._enabled=!0),await ln(this,Le.NEED_ENABLE_TRACK,this),S.info("[".concat(this.getTrackId(),"] setEnabled to ").concat(e," success"))}catch(i){throw n||(this._enabled=!1),S.error("[".concat(this.getTrackId(),"] setEnabled to true error"),i.toString()),i}}else{this._originMediaStreamTrack.enabled=!1,n||(this._enabled=!1);try{await ln(this,Le.NEED_DISABLE_TRACK,this)}catch(i){throw n||(this._enabled=!0),S.error("[".concat(this.getTrackId(),"] setEnabled to false error"),i.toString()),i}}}async setMuted(e){e!==this._muted&&(this.stateCheck("muted",e),this._muted=e,this._originMediaStreamTrack.enabled=!e,S.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(e)),e?await ln(this,Le.NEED_MUTE_TRACK,this):await ln(this,Le.NEED_UNMUTE_TRACK,this))}getStats(){return Gl(()=>{S.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")},"localAudioTrackGetStatsWarning"),Ni(this,Le.GET_STATS)||fn({},fR)}setAudioFrameCallback(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!e)return this._source.removeAllListeners(Qi.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t),this._source.removeAllListeners(Qi.ON_AUDIO_BUFFER),this._source.on(Qi.ON_AUDIO_BUFFER,n=>e(n))}play(){S.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(S.debug("[".concat(this.getTrackId(),"] start audio playback in element")),Ts.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play()}stop(){S.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?Ts.stop(this.getTrackId()):this._source.stop()}close(){super.close(),this._processorDestination&&this.unbindProcessorDestinationEvents(this._processorDestination),this._processorContext&&this.unbindProcessorContextEvents(this._processorContext),this.unpipe(),this._processorDestination&&this._processorDestination._source&&this._processorDestination._source.unpipe(),this._source.destroy()}_updatePlayerSource(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];S.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&Ts.updateTrack(this.getTrackId(),this._mediaStreamTrack)}async _updateOriginMediaStreamTrack(e,t){this._originMediaStreamTrack!==e&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),t&&this._originMediaStreamTrack.stop()),e.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=e,this._muted&&(this._originMediaStreamTrack.enabled=!1),this.processor&&this._processorContext&&this.processor.updateInput({track:e,context:this._processorContext}),this._mediaStreamTrack!==this._source.outputTrack?(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await ln(this,Le.NEED_REPLACE_TRACK,this)):this._source.updateTrack(this._originMediaStreamTrack),this._getOriginVolumeLevel&&this._source.updateOriginTrack(e))}renewMediaStreamTrack(e){return be.resolve(void 0)}pipe(e){if(this._bypassWebAudio)throw new ae(P.INVALID_OPERATION,"Can not process AudioTrack when bypassWebAudio set to true.");if(this.processor===e)return e;if(e._source)throw new ae(P.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(!this.processor)return;const t=this.processor;(e=this._source.processSourceNode)===null||e===void 0||e.disconnect(),this.processor._source=!1,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(e){e.on(Ms.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(t),await ln(this,Le.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await ln(this,Le.NEED_REPLACE_TRACK,this))}),e.on(Ms.ON_NODE,t=>{this._source.processedNode=t})}unbindProcessorDestinationEvents(e){e.removeAllListeners(Ms.ON_TRACK),e.removeAllListeners(Ms.ON_NODE)}bindProcessorContextEvents(e){e.on(Hi.REQUEST_CONSTRAINTS,async t=>{t(this._originMediaStreamTrack.getSettings())})}unbindProcessorContextEvents(e){e.removeAllListeners(Hi.REQUEST_CONSTRAINTS)}initWebAudio(){return this._trackSource instanceof SR&&(this._trackSource=new yR(this._mediaStreamTrack,!1,this._getOriginVolumeLevel?this._mediaStreamTrack:void 0)),this._trackSource}initProcessor(){const e=new zF(this._source.context,this.getTrackId(),"local"),t=new YF(e);return this._processorContext=e,this._processorDestination=t,this.bindProcessorContextEvents(e),this.bindProcessorDestinationEvents(t),this._source.on(Qi.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:e})}),this._useAudioElement&&(this._useAudioElement=!1,this.isPlaying&&(Ts.stop(this.getTrackId()),this._source.play()),ln(this,Le.NEED_REPLACE_MIXING_TRACK,this).then(()=>{S.debug("[".concat(this.getTrackId(),"] replace from origin track to web audio track success"))}).catch(n=>{S.warning("[".concat(this.getTrackId(),"] replace from origin track to web audio track failed"),n)})),{processorContext:e,processorDestination:t}}}).prototype,"setVolume",[tj],Object.getOwnPropertyDescriptor(Bn.prototype,"setVolume"),Bn.prototype),xt(Bn.prototype,"setPlaybackDevice",[nj,rj],Object.getOwnPropertyDescriptor(Bn.prototype,"setPlaybackDevice"),Bn.prototype),xt(Bn.prototype,"setEnabled",[sj,ij,aj],Object.getOwnPropertyDescriptor(Bn.prototype,"setEnabled"),Bn.prototype),xt(Bn.prototype,"setMuted",[oj,cj,lj],Object.getOwnPropertyDescriptor(Bn.prototype,"setMuted"),Bn.prototype),xt(Bn.prototype,"getStats",[Aj],Object.getOwnPropertyDescriptor(Bn.prototype,"getStats"),Bn.prototype),xt(Bn.prototype,"setAudioFrameCallback",[dj],Object.getOwnPropertyDescriptor(Bn.prototype,"setAudioFrameCallback"),Bn.prototype),xt(Bn.prototype,"play",[uj,hj],Object.getOwnPropertyDescriptor(Bn.prototype,"play"),Bn.prototype),xt(Bn.prototype,"stop",[pj,fj],Object.getOwnPropertyDescriptor(Bn.prototype,"stop"),Bn.prototype),xt(Bn.prototype,"close",[mj],Object.getOwnPropertyDescriptor(Bn.prototype,"close"),Bn.prototype),xt(Bn.prototype,"pipe",[gj],Object.getOwnPropertyDescriptor(Bn.prototype,"pipe"),Bn.prototype),xt(Bn.prototype,"unpipe",[_j],Object.getOwnPropertyDescriptor(Bn.prototype,"unpipe"),Bn.prototype),Bn),Tm=(Ej=We({argsMap:(e,t)=>[e.getTrackId(),t]}),vj=Pn(),yj=Ih("MicrophoneAudioTrack","_enabledMutex"),wj=We({argsMap:(e,t,n)=>[e.getTrackId(),t,n]}),bj=Pn(),Sj=We({argsMap:e=>[e.getTrackId()]}),xt((fc=class extends Mn{get __className__(){return"MicrophoneAudioTrack"}constructor(e,t,n,i){super(e,t.encoderConfig?Dv(t.encoderConfig):{},i,L("GET_VOLUME_OF_MUTED_AUDIO_TRACK")),ie(this,"_config",void 0),ie(this,"_deviceName","default"),ie(this,"_constraints",void 0),ie(this,"_originalConstraints",void 0),ie(this,"_enabled",!0),this._config=t,this._constraints=n,this._originalConstraints=n,this._deviceName=e.label,typeof t.bypassWebAudio=="boolean"&&(this._bypassWebAudio=t.bypassWebAudio),(Sh()||QT())&&tn.bindInterruptDetectorTrack(this)}async setDevice(e){if(S.info("[".concat(this.getTrackId(),"] start set device to ").concat(e)),this._enabled)try{const t=await Wi.getDeviceById(e),n={};n.audio=fn({},this._constraints),n.audio.deviceId={exact:e},this._originMediaStreamTrack.stop();let i=null;try{i=await Ki(n,this.getTrackId())}catch(o){throw S.error("[".concat(this.getTrackId(),"] setDevice failed"),o.toString()),i=await Ki({audio:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(i.getAudioTracks()[0],!1),o}await this._updateOriginMediaStreamTrack(i.getAudioTracks()[0],!1),this._deviceName=t.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(t){throw S.error("[".concat(this.getTrackId(),"] setDevice error"),t.toString()),t}else try{const t=await Wi.getDeviceById(e);this._deviceName=t.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(t){throw S.error("[".concat(this.getTrackId(),"] setDevice error"),t.toString()),t}S.info("[".concat(this.getTrackId(),"] set device to ").concat(e," success"))}async setEnabled(e,t,n){if(t)return S.debug("[".concat(this.getTrackId(),"] setEnabled false (do not close microphone)")),await super._setEnabled(e);if(!n){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(S.info("[".concat(this.getTrackId(),"] start setEnabled"),e),L("AUTO_RESET_AUDIO_ROUTE")&&(fs()||Ya())){const d=navigator.audioSession;d&&(e||(d.type="playback"),d.type="auto")}if(!e){var i;this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),(i=this._source.clonedTrack)===null||i===void 0||i.stop(),n||(this._enabled=!1);try{await ln(this,Le.NEED_DISABLE_TRACK,this)}catch(d){throw S.error("[".concat(this.getTrackId(),"] setEnabled false failed"),d.toString()),d}return}const o=fn({},this._constraints),l=Wi.searchDeviceIdByName(this._deviceName);l&&!o.deviceId&&(o.deviceId=l);try{n||(this._enabled=!0);const d=await Ki({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(d.getAudioTracks()[0],!1),await ln(this,Le.NEED_ENABLE_TRACK,this)}catch(d){throw n||(this._enabled=!1),S.error("[".concat(this.getTrackId(),"] setEnabled true failed"),d.toString()),d}S.info("[".concat(this.getTrackId(),"] setEnabled success"))}close(){super.close(),(Sh()||QT())&&tn.unbindInterruptDetectorTrack(this),Nd.some(e=>function(t){return"__className__"in t&&t.__className__==="MicrophoneAudioTrack"}(e))||_R&&_R()&&(ke.reportApiInvoke(null,{name:"BG_AUDIO_TAG_RESTART",options:{},tag:an.TRACER}).onSuccess(),S.debug("restart background audio tag success"))}onTrackEnded(){if((fs()||Ya())&&this._enabled&&!this._isClosed&&tn.duringInterruption){const e=async()=>{tn.off(Wr.IOS_INTERRUPTION_END,e),this._enabled&&!this._isClosed&&(S.debug("[".concat(this.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};tn.on(Wr.IOS_INTERRUPTION_END,e)}else S.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(kh.TRACK_ENDED)}async renewMediaStreamTrack(e){const t=e||this._constraints,n=Wi.searchDeviceIdByName(this._deviceName);if(n&&!t.deviceId&&(t.deviceId=n),this._constraints=t,this._enabled){this._originMediaStreamTrack.stop();const i=await Ki({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(i.getAudioTracks()[0],!0)}}bindProcessorContextEvents(e){super.bindProcessorContextEvents(e),e.on(Hi.REQUEST_UPDATE_CONSTRAINTS,async(t,n,i)=>{try{const o=Object.assign({},this._originalConstraints,...t);await this.renewMediaStreamTrack(o),n()}catch(o){i(o)}})}unbindProcessorContextEvents(e){super.unbindProcessorContextEvents(e),e.removeAllListeners(Hi.REQUEST_UPDATE_CONSTRAINTS)}}).prototype,"setDevice",[Ej,vj],Object.getOwnPropertyDescriptor(fc.prototype,"setDevice"),fc.prototype),xt(fc.prototype,"setEnabled",[yj,wj,bj],Object.getOwnPropertyDescriptor(fc.prototype,"setEnabled"),fc.prototype),xt(fc.prototype,"close",[Sj],Object.getOwnPropertyDescriptor(fc.prototype,"close"),fc.prototype),fc),nle=(Cj=We({argsMap:(e,t)=>[e.getTrackId(),t,e.duration]}),Tj=Pn(),Rj=We({argsMap:e=>[e.getTrackId()]}),Ij=Pn(),Nj=We({argsMap:e=>[e.getTrackId()]}),Oj=Pn(),xj=We({argsMap:e=>[e.getTrackId()]}),Dj=Pn(),Bj=We({argsMap:e=>[e.getTrackId()]}),kj=Pn(),Lj=We({argsMap:e=>[e.getTrackId()]}),Uj=We({argsMap:e=>[e.getTrackId()]}),Pj=Pn(),xt((Zr=class extends Mn{get __className__(){return"BufferSourceAudioTrack"}constructor(e,t,n,i){super(t.createOutputTrack(),n,i),ie(this,"source",void 0),ie(this,"_bufferSource",void 0),this._useAudioElement=!1,this.source=e,this._bufferSource=t,this._bufferSource.on(Qi.AUDIO_SOURCE_STATE_CHANGE,o=>{this.safeEmit(kh.SOURCE_STATE_CHANGE,o)});try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}get playbackSpeed(){return this._bufferSource.playbackSpeed}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(e){e&&this._bufferSource.updateOptions(e),this._bufferSource.startProcessAudioBuffer()}pauseProcessAudioBuffer(){this._bufferSource.pauseProcessAudioBuffer()}seekAudioBuffer(e){this._bufferSource.seekAudioBuffer(e)}resumeProcessAudioBuffer(){this._bufferSource.resumeProcessAudioBuffer()}stopProcessAudioBuffer(){this._bufferSource.stopProcessAudioBuffer()}close(){this.source=null,this._bufferSource.destroy(),super.close()}setAudioBufferPlaybackSpeed(e){sn(e,"speed",0),this._bufferSource.setAudioBufferPlaybackSpeed(e)}}).prototype,"startProcessAudioBuffer",[Cj,Tj],Object.getOwnPropertyDescriptor(Zr.prototype,"startProcessAudioBuffer"),Zr.prototype),xt(Zr.prototype,"pauseProcessAudioBuffer",[Rj,Ij],Object.getOwnPropertyDescriptor(Zr.prototype,"pauseProcessAudioBuffer"),Zr.prototype),xt(Zr.prototype,"seekAudioBuffer",[Nj,Oj],Object.getOwnPropertyDescriptor(Zr.prototype,"seekAudioBuffer"),Zr.prototype),xt(Zr.prototype,"resumeProcessAudioBuffer",[xj,Dj],Object.getOwnPropertyDescriptor(Zr.prototype,"resumeProcessAudioBuffer"),Zr.prototype),xt(Zr.prototype,"stopProcessAudioBuffer",[Bj,kj],Object.getOwnPropertyDescriptor(Zr.prototype,"stopProcessAudioBuffer"),Zr.prototype),xt(Zr.prototype,"close",[Lj],Object.getOwnPropertyDescriptor(Zr.prototype,"close"),Zr.prototype),xt(Zr.prototype,"setAudioBufferPlaybackSpeed",[Uj,Pj],Object.getOwnPropertyDescriptor(Zr.prototype,"setAudioBufferPlaybackSpeed"),Zr.prototype),Zr);class dr extends Mn{get __className__(){return"MixingAudioTrack"}get isActive(){for(const t of this.trackList)if(t._enabled&&!t._isClosed&&!t.muted)return!0;return!1}constructor(){const t=Ph().createMediaStreamDestination();super(t.stream.getAudioTracks()[0],void 0,zt(8,"track-mix-")),ie(this,"trackList",void 0),ie(this,"destNode",void 0),this._useAudioElement=!1;try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}this.destNode=t,this.trackList=[]}hasAudioTrack(t){return this.trackList.indexOf(t)!==-1}addAudioTrack(t){this.trackList.indexOf(t)===-1?(S.debug("add ".concat(t.getTrackId()," to mixing track")),t._source.outputNode.connect(this.destNode),this.trackList.push(t),this.updateEncoderConfig()):S.debug("track ".concat(t.getTrackId()," is already added"))}removeAudioTrack(t){if(this.trackList.indexOf(t)!==-1){S.debug("remove ".concat(t.getTrackId()," from mixing track"));try{t._source.outputNode.disconnect(this.destNode)}catch{}vv(this.trackList,t),this.updateEncoderConfig()}}updateEncoderConfig(){const t={};this.trackList.forEach(n=>{n._encoderConfig&&((n._encoderConfig.bitrate||0)>(t.bitrate||0)&&(t.bitrate=n._encoderConfig.bitrate),(n._encoderConfig.sampleRate||0)>(t.sampleRate||0)&&(t.sampleRate=n._encoderConfig.sampleRate),(n._encoderConfig.sampleSize||0)>(t.sampleSize||0)&&(t.sampleSize=n._encoderConfig.sampleSize),n._encoderConfig.stereo&&(t.stereo=!0))}),this._encoderConfig=t}_updateRtpTransceiver(t){this._rtpTransceiver!==t&&(this._rtpTransceiver=t,this.trackList.forEach(n=>{n instanceof dr?n.emit(Od.TRANSCEIVER_UPDATED,t):n._updateRtpTransceiver(t)}))}}class rle extends MF{set currentState(t){t!==this._currentState&&(this._currentState=t,this.safeEmit(Qi.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}constructor(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),ie(this,"audioBuffer",void 0),ie(this,"sourceNode",void 0),ie(this,"startPlayTime",0),ie(this,"startPlayOffset",0),ie(this,"pausePlayTime",0),ie(this,"options",void 0),ie(this,"currentLoopCount",0),ie(this,"currentPlaybackSpeed",100),ie(this,"_currentState","stopped"),this.audioBuffer=t,this.options=n,this.startPlayOffset=this.options.startPlayTime||0}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer?this.audioBuffer.duration:0}get playbackSpeed(){return this.currentPlaybackSpeed}get currentTime(){return this.audioBuffer?this.currentState==="stopped"?0:this.currentState==="paused"?this.pausePlayTime:((this.context.currentTime-this.startPlayTime)*(this.playbackSpeed/100)+this.startPlayOffset)%this.audioBuffer.duration:0}updateOptions(t){this.currentState==="stopped"?(this.options=t,this.startPlayOffset=this.options.startPlayTime||0):S.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&this.currentState==="playing"&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(t){this.sourceNode&&(this.sourceNode.onended=null,this.currentState==="playing"&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),this.currentState==="playing"?(this.startPlayOffset=t,this.startSourceNode()):this.currentState==="paused"&&(this.pausePlayTime=t))}resumeProcessAudioBuffer(){this.currentState==="paused"&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch{}this.reset()}}destroy(){this.audioBuffer=null,super.destroy()}setAudioBufferPlaybackSpeed(t){this.sourceNode&&(this.currentState==="playing"&&(this.startPlayOffset=this.currentTime,this.startPlayTime=this.context.currentTime),this.sourceNode.playbackRate.value=t/100),this.currentPlaybackSpeed=t}startSourceNode(){this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=this.handleSourceNodeEnded.bind(this))}createSourceNode(){const t=this.context.createBufferSource();return t.buffer=this.audioBuffer,t.loop=!!this.options.loop,t.connect(this.outputNode),t.playbackRate.value=this.currentPlaybackSpeed/100,t}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}}const Mj=new Map;function Fj(e,t){if(e.length===0||t.length===0)return 1/0;const n=$T(e),i=$T(t);return Math.floor(i/n)}class TR{get rendFrameRate(){const t=Math.max(1,Fj(this._render_interframe_delays_sizes,this._render_interframe_delays));return Math.floor(1e3/t)}get videoElementStatus(){return this._isInPage?this._videoElementStatus:is.DESTROYED}set videoElementStatus(t){t!==this._videoElementStatus&&(S.debug("[".concat(this.trackId,"] video-element-status change ").concat(this._videoElementStatus," => ").concat(t)),this._videoElementStatus=t)}get videoState(){return this._videoState}set videoState(t){var n;t!==this._videoState&&(this._videoState=t,(n=this.onVideoStateChanged)===null||n===void 0||n.call(this,this.videoState))}constructor(t){ie(this,"trackId",void 0),ie(this,"config",void 0),ie(this,"onFirstVideoFrameDecoded",void 0),ie(this,"onFirstVideoFrameRender",void 0),ie(this,"onVideoBufferReady",void 0),ie(this,"onVideoStateChanged",void 0),ie(this,"freezeTimeCounterList",[]),ie(this,"renderFreezeAccTime",0),ie(this,"renderFreezeAccTime2",0),ie(this,"isKeepLastFrame",!1),ie(this,"isDestroyed",!1),ie(this,"timeUpdatedCount",0),ie(this,"freezeTime",0),ie(this,"playbackTime",0),ie(this,"lastTimeUpdatedTime",0),ie(this,"autoplayFailed",!1),ie(this,"videoTrack",void 0),ie(this,"videoElement",void 0),ie(this,"cacheVideoElement",void 0),ie(this,"cancelRVFId",void 0),ie(this,"internal",!1),ie(this,"_render_interframe_delays",[]),ie(this,"_render_interframe_delays_sizes",[]),ie(this,"_videoState",pc.VideoStateStopped),ie(this,"videoElementCheckInterval",void 0),ie(this,"videoElementFreezeTimeout",void 0),ie(this,"_videoElementStatus",is.NONE),ie(this,"_isInPage",!0),ie(this,"isGettingVideoDimensions",!1),ie(this,"startGetVideoDimensions",()=>{const n=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement.videoWidth*this.videoElement.videoHeight>4)return S.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);setTimeout(n,500)};!this.isGettingVideoDimensions&&n()}),ie(this,"autoResumeAfterInterruption",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&tn.curState==="running"&&(S.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(DM())),jM()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),ie(this,"handleVideoEvents",n=>{switch(n.type){case"play":case"playing":n.type==="play"&&S.debug("[".concat(this.trackId,"] video element status: play")),this.startGetVideoDimensions(),this.videoElementStatus=is.PLAYING;break;case"loadeddata":if(this.videoState=pc.VideoStateStarting,this.onFirstVideoFrameRender&&this.onFirstVideoFrameRender(),this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded(),this.cacheVideoElement){try{this.cacheVideoElement.srcObject=null,this.cacheVideoElement.remove()}catch{}this.cacheVideoElement=void 0}break;case"canplay":this.videoElementStatus=is.CANPLAY;break;case"stalled":this.videoElementStatus=is.STALLED;break;case"suspend":this.videoElementStatus=is.SUSPEND;break;case"pause":this.videoElementStatus=is.PAUSED,fs()||Ya()||kr()&&this.autoplayFailed||!this.videoTrack||this.videoTrack.readyState!=="live"||(S.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=is.WAITING;break;case"abort":this.videoElementStatus=is.ABORT;break;case"ended":this.videoElementStatus=is.ENDED;break;case"emptied":this.videoElementStatus=is.EMPTIED;break;case"error":{const i=this.videoElement.error;i&&(this.videoElementStatus=is.ERROR,S.error("[".concat(this.trackId,"] media error: ").concat(i.message," (").concat(i.code,")")));break}case"timeupdate":{const i=performance.now();if(this.timeUpdatedCount+=1,this.onVideoBufferReady&&this.timeUpdatedCount>L("BUFFER_READY_FRAMES")&&this.onVideoBufferReady(),this.timeUpdatedCount<10)return void(this.lastTimeUpdatedTime=i);const o=i-this.lastTimeUpdatedTime,l=this.lastTimeUpdatedTime;if(this.lastTimeUpdatedTime=i,Oi.lastVisibleTime<Oi.lastHiddenTime||l<Oi.lastHiddenTime||l<Oi.lastVisibleTime||this.isSkipCalcRenderFreezeTime())return;for(o>L("VIDEO_FREEZE_DURATION")&&(this.freezeTime+=o),this.playbackTime+=o;this.playbackTime>=6e3;){this.playbackTime-=6e3;const d=Math.min(6e3,this.freezeTime);this.freezeTimeCounterList.push(d),this.freezeTime=Math.max(0,this.freezeTime-6e3)}break}}}),ie(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&(S.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(DM())),jM()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),this.trackId=t.trackId,this.config=t,t.element instanceof HTMLVideoElement?this.videoElement=t.element:this.videoElement=document.createElement("video"),tn.on(Wr.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),tn.on(Wr.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16)}getVideoElement(){return this.videoElement}getContainerElement(){var t;return(t=this.videoElement.parentElement)!==null&&t!==void 0?t:void 0}updateConfig(t){this.config=t,this.trackId=t.trackId,t.element!==this.videoElement&&(this.destroy(),this.videoElement=t.element),this.videoTrack&&this.initVideoElement()}updateVideoTrack(t){this.videoTrack!==t&&(this.videoTrack=t,this.initVideoElement())}play(t){const n=this.videoElement.play();n&&n.catch&&n.catch(o=>{t&&GF(t,"video",o.message,this.trackId),o.name==="NotAllowedError"?(S.warning("detected video element autoplay failed",o),this.autoplayFailed=!0,this.handleAutoPlayFailed()):S.warning("[".concat(this.trackId,"] play warning: "),o)});const i=Lt();if((i.name==="Safari"&&Number(i.version)===15||Sh())&&n&&n.then){const o=()=>{this.config.mirror&&!this.config.noStyle&&(this.videoElement.style.transform="rotateY(180deg)")};n.then(o).catch(o)}}getCurrentFrame(){const t=document.createElement("canvas");t.width=this.videoElement.videoWidth,t.height=this.videoElement.videoHeight;const n=t.getContext("2d");if(!n)return S.error("create canvas context failed!"),new ImageData(2,2);n.drawImage(this.videoElement,0,0,t.width,t.height);const i=n.getImageData(0,0,t.width,t.height);return t.remove(),i}async getCurrentFrameToUint8Array(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const i=document.createElement("canvas");i.width=this.videoElement.videoWidth,i.height=this.videoElement.videoHeight;const o=i.getContext("2d");return o?(o.drawImage(this.videoElement,0,0,i.width,i.height),new be((l,d)=>{i.toBlob(async h=>{if(i.remove(),h){const f=await ej(h);l({buffer:f,width:i.width,height:i.height})}else d(new ae(P.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},t,n<0?.1:n>1?1:n)})):await CR(t)}destroy(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0];this.isDestroyed=!0,tn.off(Wr.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),tn.off(Wr.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),t?this.videoElement.pause():this.videoElement.srcObject=null,this.resetVideoElement(),this.freezeTimeCounterList=[],this.videoState=pc.VideoStateStopped}initVideoElement(){if(this.videoElementStatus=is.INIT,!this.videoElementCheckInterval&&(jj.forEach(l=>{this.videoElement.addEventListener(l,this.handleVideoEvents)}),this.videoElementCheckInterval=window.setInterval(()=>{this._isInPage=function(l){return l!==document.body&&document.body.contains(l)}(this.videoElement)},1e3),L("ENABLE_VIDEO_FRAME_CALLBACK"))){var t,n;let l;const d=()=>{document.visibilityState==="visible"&&(document.removeEventListener("visibilitychange",d),this.videoElementFreezeTimeout=window.setTimeout(h,L("VIDEO_FREEZE_DURATION")))},h=()=>{this.videoElementFreezeTimeout=void 0,this.videoState===pc.VideoStateDecoding&&(document.visibilityState==="visible"?this.videoState=pc.VideoStateFrozen:document.addEventListener("visibilitychange",d))},f=(g,_)=>{if(this.videoElementStatus===is.PLAYING){if(l){const b=_.presentationTime-l.presentationTime,D=_.presentedFrames-l.presentedFrames;this._render_interframe_delays_sizes.push(D),this._render_interframe_delays.push(b);const I=$T(this._render_interframe_delays_sizes),O=I-this._render_interframe_delays_sizes[0];if(I>30&&O>5&&(this._render_interframe_delays_sizes.shift(),this._render_interframe_delays.shift()),this.videoState===pc.VideoStateStarting&&(this.videoState=pc.VideoStateDecoding),this.videoState===pc.VideoStateDecoding&&this.onVideoStateChanged&&(this.videoElementFreezeTimeout&&window.clearTimeout(this.videoElementFreezeTimeout),this.videoElementFreezeTimeout=window.setTimeout(h,L("VIDEO_FREEZE_DURATION"))),b<L("VIDEO_FREEZE_DURATION")&&this.videoState===pc.VideoStateFrozen&&(this.videoState=pc.VideoStateDecoding),b>L("VIDEO_FREEZE_DURATION")&&Oi.lastVisibleTime>=Oi.lastHiddenTime&&l.timestamp>Oi.lastVisibleTime&&l.timestamp>Oi.lastHiddenTime){const U=Math.min(66,Fj(this._render_interframe_delays_sizes,this._render_interframe_delays)),j=Math.max(0,b-(D-1)*U);this.renderFreezeAccTime2+=j>U?j:0,this.renderFreezeAccTime+=b}}l=fn(fn({},_),{},{timestamp:g})}else this.isSkipCalcRenderFreezeTime()&&(l=fn(fn({},_),{},{timestamp:g}));var v,y;L("ENABLE_VIDEO_FRAME_CALLBACK")&&(this.cancelRVFId=(v=(y=this.videoElement).requestVideoFrameCallback)===null||v===void 0?void 0:v.call(y,f))};this.cancelRVFId=(t=(n=this.videoElement).requestVideoFrameCallback)===null||t===void 0?void 0:t.call(n,f)}this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),mm()&&!L("HIDE_NO_POSTER")&&(this.videoElement.poster="noposter");const i=Lt();this.config.noStyle||(i.name==="Safari"&&Number(i.version)===15||Sh()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover"),this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,gn()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,gn()&&this.videoElement.load());const o=this.videoElement.play();o!==void 0&&o.catch(l=>{S.debug("[".concat(this.trackId,"] playback interrupted"),l.toString())})}resetVideoElement(){var t,n;jj.forEach(i=>{this.videoElement&&this.videoElement.removeEventListener(i,this.handleVideoEvents)}),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0),this.cancelRVFId&&this.videoElement&&((t=(n=this.videoElement).cancelVideoFrameCallback)===null||t===void 0||t.call(n,this.cancelRVFId),this.cancelRVFId=void 0),this.videoElementStatus=is.NONE}isSkipCalcRenderFreezeTime(){return this.videoElementStatus===is.DESTROYED||this.internal}handleAutoPlayFailed(){const t=n=>{n.preventDefault(),this.videoElement.play().then(()=>{S.debug("[".concat(this.trackId,"] Video element for trackId:").concat(this.trackId," autoplay resumed."))}).catch(i=>{S.error(i)}),this.autoplayFailed=!1,gm()?document.body.removeEventListener("click",t,!0):(document.body.removeEventListener("touchstart",t,!0),document.body.removeEventListener("mousedown",t,!0))};gm()?document.body.addEventListener("click",t,!0):(document.body.addEventListener("touchstart",t,!0),document.body.addEventListener("mousedown",t,!0)),HF()}}const jj=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate","error"];class Uv extends TR{constructor(t){let n=arguments.length>1&&arguments[1]!==void 0&&arguments[1];super(t),ie(this,"container",void 0),ie(this,"slot",void 0),this.slot=t.element,this.internal=n,this.updateConfig(t)}updateConfig(t){this.config=t,this.trackId=t.trackId;const n=t.element;var i;!this.internal||this.slot?(n!==this.slot&&(this.destroy(),this.slot=n),this.createElements()):(this.slot=n,n&&this.container?(this.internal=!1,this.container.id="agora-video-player-".concat(this.trackId),this.videoElement.id="video_".concat(this.trackId),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",(i=this.slot)===null||i===void 0||i.appendChild(this.container)):this.createElements())}updateVideoTrack(t){this.videoTrack!==t&&(this.videoTrack=t,this.createElements())}play(t){var n;(n=this.container)!==null&&n!==void 0&&n.contains(this.videoElement)&&super.play(t)}getCurrentFrame(){var t;return(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)?super.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameToUint8Array(t){var n;let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return(n=this.container)!==null&&n!==void 0&&n.contains(this.videoElement)?await super.getCurrentFrameToUint8Array(t,i):await CR(t)}destroy(){if(super.destroy(),this.videoElement.remove(),this.videoElement=document.createElement("video"),this.container){try{var t;this.container.remove(),(t=this.slot)===null||t===void 0||t.removeChild(this.container)}catch{}this.container=void 0}}createElements(){var t;this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",L("KEEP_LAST_FRAME")&&this.isKeepLastFrame&&this.videoElement.paused&&this.resetVideoElement(),this.mountedVideoElement()):this.unmountedVideoElement(),(t=this.slot)===null||t===void 0||t.appendChild(this.container)}mountedVideoElement(){var t;!this.container||(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)||this.container.appendChild(this.videoElement),super.initVideoElement(),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.style.left="0",this.videoElement.style.top="0"}unmountedVideoElement(){var t;if((t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)){super.resetVideoElement();try{this.container&&this.container.removeChild(this.videoElement)}catch{}this.videoElement=document.createElement("video")}}resetVideoElement(){var t;(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)&&(super.resetVideoElement(),this.cacheVideoElement=this.videoElement,this.videoElement=document.createElement("video"))}getContainerElement(){return this.container}}var Vj,Qj,Hj,Gj,Kj,Wj,Yj,zj,qj,Xj,Jj,$j,Zj,e4,t4,n4,r4,s4,i4,a4,o4,c4,l4,A4,d4,u4,h4,p4,bt,f4,m4,g4,_4,E4,v4,y4,w4,Yi;let on=(Vj=We({argsMap:(e,t,n)=>[e.getTrackId(),typeof t=="string"?t:t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",n]}),Qj=Pn(),Hj=We({argsMap:e=>[e.getTrackId()]}),Gj=Ih("LocalVideoTrack","_enabledMutex"),Kj=We({argsMap:(e,t)=>[e.getTrackId(),t]}),Wj=Pn(),Yj=Ih("LocalVideoTrack","_enabledMutex"),zj=We({argsMap:(e,t)=>[e.getTrackId(),t]}),qj=Pn(),Xj=We({argsMap:(e,t)=>[e.getTrackId(),t,e._saveEncodeBitrateRatio]}),Jj=Pn(),$j=We({argsMap:(e,t)=>[e.getTrackId(),t]}),Zj=Pn(),e4=Pn(),t4=We({argsMap:(e,t,n)=>[e.getTrackId(),t,n]}),n4=Pn(),r4=Pn(),s4=Pn(),i4=We({argsMap:e=>[e.getTrackId()]}),a4=Pn(),o4=Pn(),c4=Pn(),l4=Pn(),A4=Pn(),d4=We({argsMap:(e,t)=>[e.getTrackId(),t.name]}),u4=We({argsMap:e=>[e.getTrackId()]}),h4=We({argsMap:e=>[e.getTrackId()]}),p4=We({argsMap:(e,t,n)=>[e.getTrackId(),t.label,n]}),bt=class Oq extends Uh{get videoHeight(){if(kr()){const{height:t}=this._mediaStreamTrack.getSettings();return this._videoHeight=t,this._videoHeight}return this._videoHeight}get videoWidth(){if(kr()){const{width:t}=this._mediaStreamTrack.getSettings();return this._videoWidth=t,this._videoWidth}return this._videoWidth}get isPlaying(){return!(!this._player||this._player.videoElementStatus!==is.PLAYING)}get processorDestination(){return this._processorDestination}get processorContext(){return this._processorContext}set processorContext(t){this._processorContext=t}get __className__(){return"LocalVideoTrack"}constructor(t,n,i,o,l,d){if(super(t,l),ie(this,"trackMediaType",Lh.VIDEO),ie(this,"_player",void 0),ie(this,"isUseScaleResolutionDownBy",!1),ie(this,"_videoVisibleTimer",null),ie(this,"_previousVideoVisibleStatus",void 0),ie(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),ie(this,"_encoderConfig",void 0),ie(this,"_scalabilityMode",{numSpatialLayers:1,numTemporalLayers:1}),ie(this,"_optimizationMode",void 0),ie(this,"_saveEncodeBitrateRatio",1),ie(this,"_videoHeight",void 0),ie(this,"_videoWidth",void 0),ie(this,"_forceBitrateLimit",void 0),ie(this,"_enabled",!0),ie(this,"_processorDestination",void 0),ie(this,"_processorContext",void 0),kr()){const{width:h,height:f}=t.getSettings();this._videoWidth=h,this._videoHeight=f}else this.updateMediaStreamTrackResolution();if(this._scalabilityMode=i,this._optimizationMode=o,this._hints=d||[],n&&this._hints.indexOf(Wt.CUSTOM_TRACK)!==-1?this._encoderConfig=_n(n):this._encoderConfig=n,this._hints.indexOf(Wt.SCREEN_TRACK)===-1)this.updateBitrateFromProfile();else if(FT(Mt.CHROME,115)&&_v().indexOf("Windows")!==-1){const h=function(f,g){if("VideoFrame"in window&&"TransformStream"in window&&wt().supportWebRTCInsertableStream){const _=new MediaStreamTrackProcessor(f),v=new MediaStreamTrackGenerator({kind:"video"});let y,b,D=Date.now();const I=()=>{O&&(clearInterval(O),O=void 0),y&&(y.close(),y=void 0),f.stop(),b=void 0,v.removeEventListener("ended",I)};let O=window.setInterval(()=>{if(b&&y&&Date.now()-D>1e3)try{v.readyState==="live"?b.enqueue(y.clone()):I()}catch{I()}},1e3);const U=new TransformStream({transform:(j,G)=>{v.readyState==="live"?(b=G,D=Date.now(),y===void 0?(y=j,G.enqueue(j.clone())):(G.enqueue(y),y=j)):j.close()}});return v.addEventListener("ended",I),_.readable.pipeThrough(U).pipeTo(v.writable),v}}(t);h&&(S.info("local screen video track begin to inject frame"),this._mediaStreamTrack=h)}n&&this._hints.indexOf(Wt.CUSTOM_TRACK)!==-1&&this.setEncoderConfiguration(n),this._processorContext=new WF(this.getTrackId(),"local"),this._processorDestination=new KF(this.processorContext),this.bindProcessorDestinationEvents()}play(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof t=="string"){const o=document.getElementById(t);o?t=o:(S.warning("[".concat(this.getTrackId(),'] can not find "#').concat(t,'" element, use document.body')),t=document.body)}S.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(n));const i=fn(fn(fn({},this._getDefaultPlayerConfig()),n),{},{trackId:this.getTrackId(),element:t});this._player?this._player.updateConfig(i):(t instanceof HTMLVideoElement?this._player=new TR(i):this._player=new Uv(i),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const o=this.getVideoElementVisibleStatus();this.safeEmit(kh.VIDEO_ELEMENT_VISIBLE_STATUS,o)}catch{}},L("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,S.debug("[".concat(this.getTrackId(),"] stop video playback")))}async setEnabled(t,n){if(!n){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(S.info("[".concat(this.getTrackId(),"] start setEnabled"),t),!t){this._originMediaStreamTrack.enabled=!1;try{await ln(this,Le.NEED_DISABLE_TRACK,this)}catch(i){throw S.error("[".concat(this.getTrackId(),"] setEnabled to false error"),i.toString()),i}return n||(this._enabled=!1),void S.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}this._originMediaStreamTrack.enabled=!0;try{await ln(this,Le.NEED_ENABLE_TRACK,this)}catch(i){throw S.error("[".concat(this.getTrackId(),"] setEnabled to true error"),i.toString()),i}S.info("[".concat(this.getTrackId(),"] setEnabled to true success")),n||(this._enabled=!0)}async setMuted(t){t!==this._muted&&(this.stateCheck("muted",t),this._muted=t,this._originMediaStreamTrack.enabled=!t,S.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(t)),t?await ln(this,Le.NEED_MUTE_TRACK,this):await ln(this,Le.NEED_UNMUTE_TRACK,this))}async setSaveEncodeBitrateRatio(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this._saveEncodeBitrateRatio;if(this._saveEncodeBitrateRatio!==1&&this._encoderConfig&&this._encoderConfig.bitrateMax&&this._encoderConfig.bitrateMin){this._encoderConfig.bitrateMin=Math.floor(this._encoderConfig.bitrateMin*t),this._encoderConfig.bitrateMax=Math.floor(this._encoderConfig.bitrateMax*t),S.debug("[".concat(this.getTrackId(),"] set save encode bitrate ratio, ").concat(t)),this._saveEncodeBitrateRatio=1;try{await ln(this,Le.NEED_UPDATE_VIDEO_ENCODER,this)}catch(n){return n.throw(S)}}}async setEncoderConfiguration(t,n){if(!this._enabled)throw new ae(P.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");if(t=$a(t),L("USE_STANDARD_BITRATE_DEFAULT")&&(delete t.bitrateMax,delete t.bitrateMin),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:t.bitrateMin),t.width||t.height||t.frameRate){const i=Lv({encoderConfig:t});(kr()||fs()||Ya())&&(i.deviceId=void 0),S.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(t),JSON.stringify(i));try{await this._originMediaStreamTrack.applyConstraints(i),this.updateMediaStreamTrackResolution()}catch(o){const l=new ae(P.UNEXPECTED_ERROR,o.toString());throw S.error("[".concat(this.getTrackId(),"] applyConstraints error"),l.toString()),l}}this._encoderConfig=t,this._hints.indexOf(Wt.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await ln(this,Le.NEED_UPDATE_VIDEO_ENCODER,this)}catch(i){return i.throw(S)}}getStats(){return Gl(()=>{S.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")},"localVideoTrackGetStatsWarning"),Ni(this,Le.GET_STATS)||fn({},mR)}async setBeautyEffect(t){S.error("LocalVideoTrack.setBeautyEffect was deprecated, please migrate to agora-extension-beauty-effect")}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameImage(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return this._player?this._player.getCurrentFrameToUint8Array(t,n):await CR(t)}async findClosestProfile(){const{width:t,height:n,frameRate:i}=this.getMediaStreamTrackSettings(),{width:o,height:l,frameRate:d}=this._encoderConfig||{},h=Rh(this._videoWidth||t||o||0),f=Rh(this._videoHeight||n||l||0),g=function(_,v,y){if(!Array.isArray(L("VIDEO_ENCODER_CONFIG_LIST"))||L("VIDEO_ENCODER_CONFIG_LIST").length===0)return!1;const b=Math.min(_,v);return!(b>=480)&&fn(fn({},L("VIDEO_ENCODER_CONFIG_LIST").find(D=>D.height>b)),{},{frameRate:y})}(h,f,Rh(i||d||15));if(g)return S.debug("[".concat(this.getTrackId(),"] find closest profile, ").concat(h,"x").concat(f," => ").concat(JSON.stringify(g))),this.setEncoderConfiguration(g)}async setBitrateLimit(t){S.debug("[".concat(this.getTrackId(),"] set bitrate limit, ").concat(JSON.stringify(t))),t&&(this._forceBitrateLimit=t,this._encoderConfig&&(this._encoderConfig.bitrateMax?this._encoderConfig.bitrateMax=this._encoderConfig.bitrateMax<t.max_bitrate?this._encoderConfig.bitrateMax:t.max_bitrate:this._encoderConfig.bitrateMax=t.max_bitrate,this._encoderConfig.bitrateMin,this._encoderConfig.bitrateMin=t.min_bitrate))}async setOptimizationMode(t){if(t!=="motion"&&t!=="detail"&&t!=="balanced")return void S.error(P.INVALID_PARAMS,"optimization mode must be motion, detail or balanced");const n=this._optimizationMode;try{this._optimizationMode=t,await ln(this,Le.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this)}catch(i){throw this._optimizationMode=n,S.error("[".concat(this.getTrackId(),"] set optimization mode failed"),i.toString()),i}S.info("[".concat(this.getTrackId(),"] set optimization mode success (").concat(t,")"))}setScalabiltyMode(t){if(t.numSpatialLayers===1&&t.numTemporalLayers!==1)return S.error(P.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabilityMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabilityMode=t,S.info("[".concat(this.getTrackId(),"] set scalability mode success (").concat(t,")"))}updateMediaStreamTrackResolution(){qF(this._originMediaStreamTrack).then(t=>{let[n,i]=t;this._videoHeight=i,this._videoWidth=n}).catch(vm)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}async setSenderConfiguration(t){if(!this._enabled)throw new ae(P.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");S.debug("[".concat(this.getTrackId(),"] setSenderConfiguration applyConstraints"),JSON.stringify(t)),t=$a(t),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:t.bitrateMin),this._encoderConfig=t,this._hints.indexOf(Wt.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await ln(this,Le.NEED_UPDATE_VIDEO_ENCODER,this)}catch(n){return n.throw(S)}}updateBitrateFromProfile(){if(!this._encoderConfig)return;const{width:t,height:n,frameRate:i}=this.getMediaStreamTrackSettings();if(!t||!n||!i)return;const{bitrateMax:o,bitrateMin:l}=this._encoderConfig;if(l==null||o==null){const{max:d,min:h}=function(f,g,_,v,y){const b=L("BITRATE_ADAPTER_TYPE");if(b==="DEFAULT_BITRATE")return{min:v,max:y};if(y===void 0){const D=Math.floor(200*Math.pow(_/15,.6)*Math.pow(f*g/640/360,.75));y=b==="STANDARD_BITRATE"?4*D:2*D,v=v??D}else v=v??Math.floor(y/10);return{min:v,max:y}}(t,n,i,l,o);if(this._encoderConfig.bitrateMin=h,this._encoderConfig.bitrateMax=d,L("VIDEO_STANDARD_BITRATE_VERSION")&&l==null&&o==null){const[f,g]=function(_,v,y){const b=4*Math.floor(2e5*Math.pow(y/15,.6)*Math.pow(_*v/230400,.75)),D=_*v,I=new Map([[19200,.9],[230400,.85],[518400,.75],[921600,.7],[2073600,.6],[3686400,.5]]),O=new Map([[230400,.95],[518400,.9],[921600,.85],[2073600,.8]]);let U=Ti(I).call(I).next().value,j=1;if(I.has(D))U=I.get(D);else{var G;const Ie=Ad(G=Array.from(I.entries())).call(G,(Je,pt)=>{let[ct]=Je,[jt]=pt;return ct-jt}),et=Ie.find(Je=>{let[pt]=Je;return pt>D});if(et){const Je=Ie.indexOf(et);if(Je>0){const pt=Ie[Je-1],ct=(D-pt[0])/(et[0]-pt[0]);U=pt[1]+ct*(et[1]-pt[1])}else U=et[1]}else U=Ie[Ie.length-1][1]}if(O.has(D))j=O.get(D);else{var $;const Ie=Ad($=Array.from(O.entries())).call($,(Je,pt)=>{let[ct]=Je,[jt]=pt;return ct-jt}),et=Ie.find(Je=>{let[pt]=Je;return pt>D});if(et){const Je=Ie.indexOf(et);if(Je>0){const pt=Ie[Je-1],ct=(D-pt[0])/(et[0]-pt[0]);j=pt[1]+ct*(et[1]-pt[1])}else j=et[1]}else j=Ie[Ie.length-1][1]}const Z=L("VIDEO_NEW_BITRATE_RATIO");Z&&Z>0&&(U=Z/100);const X=Math.floor(b*U),ee=Math.floor(65e4*Math.pow(_*v/230400,.5)*Math.pow(y/15,.69));let le=X;const fe=L("VIDEO_STANDARD_BITRATE_VERSION");return fe&&fe>0&&(fe===1?le=b:fe===2?le=X:fe===3&&(le=ee)),[Math.floor(le/1e3),j]}(t,n,i);this._encoderConfig.bitrateMax=f,this._encoderConfig.bitrateMin=h?Math.min(h,f):f,this._saveEncodeBitrateRatio=g,S.debug("[".concat(this.getTrackId(),"] update new bitrate from profile, [w: ").concat(t,", h: ").concat(n,", fps: ").concat(i,"] => [brMax: ").concat(this._encoderConfig.bitrateMax,", brMin: ").concat(this._encoderConfig.bitrateMin,", save_bitrate_ratio: ").concat(this._saveEncodeBitrateRatio,"]"))}else S.debug("[".concat(this.getTrackId(),"] update bitrate from profile, [w: ").concat(t,", h: ").concat(n,", fps: ").concat(i,"] => [brMax: ").concat(d,", brMin: ").concat(h,"]")),this._saveEncodeBitrateRatio=1}}getVideoElementVisibleStatus(){try{var t,n;const i=this==null||(t=this._player)===null||t===void 0?void 0:t.getContainerElement(),o={track:this,element:this==null||(n=this._player)===null||n===void 0?void 0:n.getVideoElement(),slot:i==null?void 0:i.parentElement},{element:l,slot:d}=o;if(this.isPlaying&&l instanceof HTMLVideoElement&&d instanceof HTMLElement){const h=zM.checkOneElementVisible(l),f=Object.assign({},h);if(f.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=f.visible;const g=ke.reportApiInvoke(null,{tag:an.TRACER,name:yn.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});f.visible?g.onSuccess("Video is visible"):g.onSuccess("Invisible because of ".concat(f.reason))}return f}return}catch(i){throw new ae(P.GET_VIDEO_ELEMENT_VISIBLE_ERROR,i.message)}}async renewMediaStreamTrack(t){}pipe(t){if(this.processor===t)return t;if(t._source)throw new ae(P.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),t}unpipe(){if(!this.processor)return;const t=this.processor;this.processor._source=void 0,this.processor=void 0,t.reset()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe()}clone(t){let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],i=this._encoderConfig;t&&(i=fn(fn({},i),$a(t))),i=Sd(i);const o=zt(8,"track-video-cloned-"),l=new Oq(n?this._mediaStreamTrack.clone():this._mediaStreamTrack,i,Sd(this._scalabilityMode),this._optimizationMode,o,Sd(this._hints));return t&&i&&l.setEncoderConfiguration(i),S.debug("clone video track from ".concat(this.getTrackId()," to ").concat(o,", clone ").concat(n)),l}async replaceTrack(t,n){if(!(t instanceof MediaStreamTrack))throw new ae(P.INVALID_PARAMS,"track should be an instance of MediaStreamTrack");if(t.kind!=="video")throw new ae(P.INVALID_PARAMS,"track should be a video MediaStreamTrack");await this._updateOriginMediaStreamTrack(t,n,!0),this.updateMediaStreamTrackResolution()}sendSeiData(t){if(Gl(()=>{ke.reportApiInvoke(null,{name:yn.LOCAL_VIDEO_SEND_SEI_DATA,options:[],tag:an.TRACER}).onSuccess("")},this._mediaStreamTrack.id||this.getTrackId()),!L("ENABLE_VIDEO_SEI")||!L("ENABLE_ENCODED_TRANSFORM"))return void S.warning('To send/receive SEI, please call AgoraRTC.setParameter("ENABLE_VIDEO_SEI", true) before instantiate IAgoraRtcClient');if(t instanceof Uint8Array==0)return new ae(P.INVALID_PARAMS,"Invalid argument type, ILocalVideoTrack.sendSeiData() only accept Uint8Array argument.").throw();const n=this.getRTCRtpTransceiver();if(!n)return void S.warning("Video track is not published, SEI can not be send");const i=n.sender.getParameters();if(i.codecs.length===0)return;const o=i.codecs[0].mimeType.toLocaleLowerCase();o==="video/h264"||o==="video/h265"?this.safeEmit("sei-to-send",t):S.warning("SEI is not supported by ".concat(o))}bindProcessorDestinationEvents(){this.processorDestination.on(Ms.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource(),await ln(this,Le.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await ln(this,Le.NEED_REPLACE_TRACK,this))})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Ms.ON_TRACK)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(Hi.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(Hi.REQUEST_CONSTRAINTS)}},xt(bt.prototype,"play",[Vj,Qj],Object.getOwnPropertyDescriptor(bt.prototype,"play"),bt.prototype),xt(bt.prototype,"stop",[Hj],Object.getOwnPropertyDescriptor(bt.prototype,"stop"),bt.prototype),xt(bt.prototype,"setEnabled",[Gj,Kj,Wj],Object.getOwnPropertyDescriptor(bt.prototype,"setEnabled"),bt.prototype),xt(bt.prototype,"setMuted",[Yj,zj,qj],Object.getOwnPropertyDescriptor(bt.prototype,"setMuted"),bt.prototype),xt(bt.prototype,"setSaveEncodeBitrateRatio",[Xj,Jj],Object.getOwnPropertyDescriptor(bt.prototype,"setSaveEncodeBitrateRatio"),bt.prototype),xt(bt.prototype,"setEncoderConfiguration",[$j,Zj],Object.getOwnPropertyDescriptor(bt.prototype,"setEncoderConfiguration"),bt.prototype),xt(bt.prototype,"getStats",[e4],Object.getOwnPropertyDescriptor(bt.prototype,"getStats"),bt.prototype),xt(bt.prototype,"setBeautyEffect",[t4,n4],Object.getOwnPropertyDescriptor(bt.prototype,"setBeautyEffect"),bt.prototype),xt(bt.prototype,"getCurrentFrameData",[r4],Object.getOwnPropertyDescriptor(bt.prototype,"getCurrentFrameData"),bt.prototype),xt(bt.prototype,"getCurrentFrameImage",[s4],Object.getOwnPropertyDescriptor(bt.prototype,"getCurrentFrameImage"),bt.prototype),xt(bt.prototype,"findClosestProfile",[i4,a4],Object.getOwnPropertyDescriptor(bt.prototype,"findClosestProfile"),bt.prototype),xt(bt.prototype,"setBitrateLimit",[o4],Object.getOwnPropertyDescriptor(bt.prototype,"setBitrateLimit"),bt.prototype),xt(bt.prototype,"setOptimizationMode",[c4],Object.getOwnPropertyDescriptor(bt.prototype,"setOptimizationMode"),bt.prototype),xt(bt.prototype,"setScalabiltyMode",[l4],Object.getOwnPropertyDescriptor(bt.prototype,"setScalabiltyMode"),bt.prototype),xt(bt.prototype,"updateMediaStreamTrackResolution",[A4],Object.getOwnPropertyDescriptor(bt.prototype,"updateMediaStreamTrackResolution"),bt.prototype),xt(bt.prototype,"pipe",[d4],Object.getOwnPropertyDescriptor(bt.prototype,"pipe"),bt.prototype),xt(bt.prototype,"unpipe",[u4],Object.getOwnPropertyDescriptor(bt.prototype,"unpipe"),bt.prototype),xt(bt.prototype,"close",[h4],Object.getOwnPropertyDescriptor(bt.prototype,"close"),bt.prototype),xt(bt.prototype,"replaceTrack",[p4],Object.getOwnPropertyDescriptor(bt.prototype,"replaceTrack"),bt.prototype),bt),Pv=(f4=We({argsMap:(e,t)=>[e.getTrackId(),t]}),m4=Pn(),g4=Ih("CameraVideoTrack","_enabledMutex"),_4=We({argsMap:(e,t)=>[e.getTrackId(),t]}),E4=Pn(),v4=We({argsMap:(e,t)=>[e.getTrackId(),t]}),y4=Pn(),w4=We({argsMap:e=>[e.getTrackId()]}),Yi=class xq extends on{get __className__(){return"CameraVideoTrack"}constructor(t,n,i,o,l,d){super(t,$a(n.encoderConfig),o,l,d),ie(this,"_config",void 0),ie(this,"_originalConstraints",void 0),ie(this,"_constraints",void 0),ie(this,"_enabled",!0),ie(this,"_deviceName","default"),ie(this,"tryResumeVideoForIOS15_16WeChat",async()=>{(Sh()||QT())&&!function(){const h=Lt();if(h.os!==br.IOS||!h.osVersion)return!1;const f=h.osVersion.split(".");return Number(f[0])===15&&Number(f[1])>=2}()&&VM()&&this._enabled&&!this._isClosed&&(S.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),await this.renewMediaStreamTrack())}),this._config=n,this._originalConstraints=i,this._constraints=i,this._deviceName=t.label,this._encoderConfig=$a(this._config.encoderConfig),tn.on(Wr.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),tn.on(Wr.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),this.bindProcessorContextEvents()}async setDevice(t){return typeof t=="string"?this._setDeviceById(t):t.deviceId?this._setDeviceById(t.deviceId):t.facingMode?this._setDeviceByFacingModel(t.facingMode):void 0}async _setDeviceById(t){if(S.info("[".concat(this.getTrackId(),"] set device to ").concat(t)),this._enabled)try{const n=await Wi.getDeviceById(t),i={};i.video=fn({},this._constraints),i.video.deviceId={exact:t},i.video.facingMode=void 0,this._originMediaStreamTrack.stop();let o=null;try{o=await Ki(i,this.getTrackId())}catch(l){throw S.error("[".concat(this.getTrackId(),"] setDevice failed"),l.toString()),o=await Ki({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(o.getVideoTracks()[0],!1),l}await this._updateOriginMediaStreamTrack(o.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution(),this._deviceName=n.label,this._config.cameraId=t,this._constraints.deviceId={exact:t}}catch(n){throw S.error("[".concat(this.getTrackId(),"] setDevice error"),n.toString()),n}else try{const n=await Wi.getDeviceById(t);this._deviceName=n.label,this._config.cameraId=t,this._constraints.deviceId={exact:t}}catch(n){throw S.error("[".concat(this.getTrackId(),"] setDevice error"),n.toString()),n}S.info("[".concat(this.getTrackId(),"] setDevice success"))}async _setDeviceByFacingModel(t){S.info("[".concat(this.getTrackId(),"] set facingMode ").concat(t));const n={video:fn(fn({},this._constraints),{},{deviceId:void 0,facingMode:{exact:t}})};if(this._enabled){this._originMediaStreamTrack.stop();let i=null;try{i=await Ki(n,this.getTrackId())}catch(o){throw S.error("[".concat(this.getTrackId(),"] setDeviceByFacingModel failed"),o.toString()),i=await Ki({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!1),o}await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution()}this._deviceName="",this._config.facingMode=t,this._config.cameraId=void 0,this._constraints=fn({},n.video),S.info("[".concat(this.getTrackId(),"] setDeviceByFacingModel success"))}async setEnabled(t,n){if(!n){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(S.info("[".concat(this.getTrackId(),"] start setEnabled"),t),t){try{if(this.isExternalTrack)this._originMediaStreamTrack.enabled=!0;else{const i=await Ki({video:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!1)}await ln(this,Le.NEED_ENABLE_TRACK,this)}catch(i){throw S.error("[".concat(this.getTrackId(),"] setEnabled true error"),i.toString()),i}this.updateMediaStreamTrackResolution(),S.info("[".concat(this.getTrackId(),"] setEnabled to true success")),n||(this._enabled=!0)}else{this.isExternalTrack?this._originMediaStreamTrack.enabled=!1:(this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop()),n||(this._enabled=!1);try{await ln(this,Le.NEED_DISABLE_TRACK,this)}catch(i){throw S.error("[".concat(this.getTrackId(),"] setEnabled to false error"),i.toString()),i}S.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}}async setEncoderConfiguration(t,n){if(!this._enabled)throw new ae(P.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");t=$a(t),L("USE_STANDARD_BITRATE_DEFAULT")&&(delete t.bitrateMax,delete t.bitrateMin),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate||t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate||t.bitrateMin);const i=_n(this._config);i.encoderConfig=t;const o=Lv(i);(kr()||fs()||Ya())&&(o.deviceId=void 0),S.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(t),JSON.stringify(o));try{await this._originMediaStreamTrack.applyConstraints(o),this.updateMediaStreamTrackResolution()}catch(l){const d=new ae(P.UNEXPECTED_ERROR,l.toString());throw S.error("[".concat(this.getTrackId(),"] applyConstraints error"),d.toString()),d}this._config=i,this._constraints=o,this._originalConstraints=o,this._encoderConfig=t,this._hints.indexOf(Wt.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await ln(this,Le.NEED_UPDATE_VIDEO_ENCODER,this)}catch(l){return l.throw(S)}}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){if((fs()||Ya())&&this._enabled&&!this._isClosed&&tn.duringInterruption){const t=async()=>{tn.off(Wr.IOS_INTERRUPTION_END,t),this._enabled&&!this._isClosed&&(S.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};tn.on(Wr.IOS_INTERRUPTION_END,t)}else S.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(kh.TRACK_ENDED)}async renewMediaStreamTrack(t){const n=t||this._constraints,i=Wi.searchDeviceIdByName(this._deviceName);if(i&&!n.deviceId&&(n.deviceId={exact:i}),this._enabled){const o=await Ki({video:n},this.getTrackId());this._constraints=n,await this._updateOriginMediaStreamTrack(o.getVideoTracks()[0],!0),this.updateMediaStreamTrackResolution()}}close(){super.close(),tn.off(Wr.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),tn.off(Wr.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat)}clone(t){let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],i=this._encoderConfig;t&&(i=fn(fn({},i),$a(t))),i=Sd(i);const o=zt(8,"track-cam-cloned-"),l=new xq(n?this._mediaStreamTrack.clone():this._mediaStreamTrack,Sd(fn(fn({},this._config),{},{encoderConfig:i})),Sd(this._constraints),Sd(this._scalabilityMode),this._optimizationMode,o);return t&&i&&l.setEncoderConfiguration(i),S.debug("clone track from ".concat(this.getTrackId()," to ").concat(o,", clone ").concat(n)),l}bindProcessorContextEvents(){this.processorContext.on(Hi.REQUEST_UPDATE_CONSTRAINTS,async(t,n,i)=>{try{const o=Object.assign({},this._originalConstraints,...t);await this.renewMediaStreamTrack(o),n()}catch(o){i(o)}}),this.processorContext.on(Hi.REQUEST_CONSTRAINTS,async t=>{t(this._originMediaStreamTrack.getSettings())})}},xt(Yi.prototype,"setDevice",[f4,m4],Object.getOwnPropertyDescriptor(Yi.prototype,"setDevice"),Yi.prototype),xt(Yi.prototype,"setEnabled",[g4,_4,E4],Object.getOwnPropertyDescriptor(Yi.prototype,"setEnabled"),Yi.prototype),xt(Yi.prototype,"setEncoderConfiguration",[v4,y4],Object.getOwnPropertyDescriptor(Yi.prototype,"setEncoderConfiguration"),Yi.prototype),xt(Yi.prototype,"close",[w4],Object.getOwnPropertyDescriptor(Yi.prototype,"close"),Yi.prototype),Yi);function b4(e){const t=zt(8,"track-cus-"),n=ke.reportApiInvoke(null,{id:t,tag:an.TRACER,name:yn.CREATE_CUSTOM_AUDIO_TRACK,options:[e]}),i=new Mn(e.mediaStreamTrack,e.encoderConfig?Dv(e.encoderConfig):{},t,!1);return S.info("create custom audio track success with config",e,"trackId",i.getTrackId()),n.onSuccess(i.getTrackId()),i}function RR(e,t,n,i){n.optimizationMode&&(i&&i.width&&i.height?(n.encoderConfig=fn(fn({},i),{},{bitrateMin:i.bitrateMin,bitrateMax:i.bitrateMax}),n.optimizationMode!=="motion"&&n.optimizationMode!=="detail"||(t.contentHint=n.optimizationMode,t.contentHint===n.optimizationMode?S.debug("[".concat(e,"] set content hint to"),n.optimizationMode):S.debug("[".concat(e,"] set content hint failed")))):S.warning("[".concat(e,"] can not apply optimization mode bitrate config, no encoderConfig")))}var S4,C4,T4,R4,ha,I4,N4,O4,x4,D4,B4,k4,es;class L4 extends LF{getUserId(){return this._userId}constructor(t,n,i,o){super(t,"track-".concat(t.kind,"-").concat(n,"-").concat(o.clientId,"_").concat(zt(5,""))),ie(this,"_userId",void 0),ie(this,"_uintId",void 0),ie(this,"_isDestroyed",!1),ie(this,"store",void 0),ie(this,"processor",void 0),ie(this,"processorContext",void 0),this._userId=n,this._uintId=i,this.store=o}_updateOriginMediaStreamTrack(t){this._originMediaStreamTrack=t,this._mediaStreamTrack=t,this._updatePlayerSource(),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext})}_destroy(){this._isDestroyed=!0,S.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}let Fh=(S4=We({argsMap:(e,t,n)=>[e.getTrackId(),typeof t=="string"?t:t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",n]}),C4=We({argsMap:e=>[e.getTrackId()]}),T4=We({argsMap:(e,t)=>[e.getTrackId(),t.name]}),R4=We({argsMap:e=>[e.getTrackId()]}),xt((ha=class extends L4{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==is.PLAYING)}get __className__(){return"RemoteVideoTrack"}constructor(e,t,n,i,o){super(e,t,n,i),ie(this,"_videoVisibleTimer",null),ie(this,"_previousVideoVisibleStatus",void 0),ie(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),ie(this,"trackMediaType",Lh.VIDEO),ie(this,"_videoWidth",void 0),ie(this,"_videoHeight",void 0),ie(this,"_player",void 0),ie(this,"_prePlayer",void 0),ie(this,"processorDestination",void 0),ie(this,"processorContext",void 0),this._prePlayer=o,this.updateMediaStreamTrackResolution(),this.processorContext=new WF(this.getTrackId(),"remote"),this.processorDestination=new KF(this.processorContext),this.bindProcessorDestinationEvents()}getStats(){return Gl(()=>{S.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")},"remoteVideoTrackGetStatsWarning"),Ni(this,Le.GET_STATS)||fn({},BF)}play(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(this.safeEmit(ua.PLAY_START),typeof e=="string"){const i=document.getElementById(e);i?e=i:(S.warning("[".concat(this.getTrackId(),'] can not find "#').concat(e,'" element, use document.body')),e=document.body)}S.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(t));const n=fn(fn({fit:"cover"},t),{},{trackId:this.getTrackId(),element:e});if(this._player)this._player.updateConfig(n);else{let i=!1,o=!1;e instanceof HTMLVideoElement?(this._player=new TR(n),this._prePlayer&&(this._prePlayer.destroy(),this._prePlayer=void 0,o=!0)):this._prePlayer&&!this._prePlayer.isDestroyed?(this._player=this._prePlayer,this._prePlayer=void 0,i=this._player.videoState>0,this._player.updateConfig(n)):this._player=new Uv(n),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.store.subscribe(this.getUserId(),"video",void 0,void 0,Date.now()),this.safeEmit(ua.FIRST_FRAME_DECODED),o&&this.safeEmit(ua.FIRST_FRAME_RENDER)},this._player.onVideoStateChanged=l=>{this.safeEmit(ua.VIDEO_STATE_CHANGED,l)},i&&(this._player.onFirstVideoFrameDecoded(),this._player.onVideoStateChanged(this._player.videoState))}this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const i=this.getVideoElementVisibleStatus();this.safeEmit(ua.VIDEO_ELEMENT_VISIBLE_STATUS,i)}catch{}},L("CHECK_VIDEO_VISIBLE_INTERVAL")),this.safeEmit(ua.PLAY_END)}stop(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(e),this._player=void 0,S.debug("[".concat(this.getTrackId(),"] stop video playback")))}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){qF(this._originMediaStreamTrack).then(e=>{let[t,n]=e;this._videoHeight=n,this._videoWidth=t}).catch(vm)}_updatePlayerSource(){S.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var e,t;const n=this==null||(e=this._player)===null||e===void 0?void 0:e.getContainerElement(),i={track:this,element:this==null||(t=this._player)===null||t===void 0?void 0:t.getVideoElement(),slot:n==null?void 0:n.parentElement},{element:o,slot:l}=i;if(this.isPlaying&&o instanceof HTMLVideoElement&&l instanceof HTMLElement){const d=zM.checkOneElementVisible(o),h=Object.assign({},d);if(h.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=h.visible;const f=ke.reportApiInvoke(null,{tag:an.TRACER,name:yn.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});h.visible?f.onSuccess("Video is visible"):f.onSuccess("Invisible because of ".concat(h.reason))}return h}return}catch(n){throw new ae(P.GET_VIDEO_ELEMENT_VISIBLE_ERROR,n.message)}}pipe(e){if(this.processor===e)return e;if(e._source)throw new ae(P.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),e}unpipe(){if(!this.processor)return;const e=this.processor;this.processor._source=void 0,this.processor=void 0,e.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(Ms.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource()):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Ms.ON_TRACK)}_destroy(){this._prePlayer&&(this._prePlayer.destroy(),this._prePlayer=void 0),super._destroy(),this.unbindProcessorDestinationEvents()}_onSei(e){this.emit(Od.SEI_RECEIVED,e)}}).prototype,"play",[S4],Object.getOwnPropertyDescriptor(ha.prototype,"play"),ha.prototype),xt(ha.prototype,"stop",[C4],Object.getOwnPropertyDescriptor(ha.prototype,"stop"),ha.prototype),xt(ha.prototype,"pipe",[T4],Object.getOwnPropertyDescriptor(ha.prototype,"pipe"),ha.prototype),xt(ha.prototype,"unpipe",[R4],Object.getOwnPropertyDescriptor(ha.prototype,"unpipe"),ha.prototype),ha),jh=(I4=We({argsMap:(e,t)=>[e.getTrackId(),t],throttleTime:300}),N4=We({argsMap:(e,t)=>[e.getTrackId(),t],throttleTime:300}),O4=We({argsMap:(e,t)=>[e.getTrackId(),t]}),x4=We({argsMap:e=>[e.getTrackId()]}),D4=We({argsMap:e=>[e.getTrackId()]}),B4=We({argsMap:(e,t)=>[e.getTrackId(),t.name]}),k4=We({argsMap:e=>[e.getTrackId()]}),xt((es=class extends L4{get isPlaying(){return this._useAudioElement?Ts.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"RemoteAudioTrack"}constructor(e,t,n,i){super(e,t,n,i),ie(this,"trackMediaType",Lh.AUDIO),ie(this,"_source",void 0),ie(this,"_useAudioElement",!0),ie(this,"_volume",100),ie(this,"processorContext",void 0),ie(this,"processorDestination",void 0),ie(this,"_played",!1),ie(this,"_bypassWebAudio",!1),L("DISABLE_WEBAUDIO")?(this._source=new SR,this._bypassWebAudio=!0,this._useAudioElement=!0):(this._source=new yR(e,!0),L("REMOTE_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1)),this._source.once(Qi.RECEIVE_TRACK_BUFFER,()=>{this.safeEmit(ua.FIRST_FRAME_DECODED)}),this.processorContext=new zF(this._source.context,this.getTrackId(),"remote"),this.processorDestination=new YF(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(Qi.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})}setAudioFrameCallback(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!e)return this._source.removeAllListeners(Qi.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t),this._source.removeAllListeners(Qi.ON_AUDIO_BUFFER),this._source.on(Qi.ON_AUDIO_BUFFER,n=>e(n))}setVolume(e){this._volume=e,this._useAudioElement?Ts.setVolume(this.getTrackId(),e):this._source.setVolume(e/100)}setAmplifiedVolume(e){this._useAudioElement&&this._played&&(Ts.stop(this.getTrackId()),this._source.play()),this._useAudioElement=!1,e=Math.min(e,L("MAX_WEBAUDIO_VOLUME")),this._volume=e,this._source.setVolume(e/100)}async setPlaybackDevice(e){if(!this._useAudioElement||!TF())throw new ae(P.NOT_SUPPORTED,"your browser does not support setting the audio output device");await Ts.setSinkID(this.getTrackId(),e)}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getVolume(){return this._useAudioElement?Ts.getVolume(this.getTrackId()):this._source instanceof yR?this._source.getAudioVolume():0}getStats(){return Gl(()=>{S.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")},"remoteAudioTrackGetStatsWarning"),Ni(this,Le.GET_STATS)||fn({},DF)}play(){S.debug("[".concat(this.getTrackId(),"] start audio playback")),this._played=!0,this._useAudioElement?(S.debug("[".concat(this.getTrackId(),"] use audio element to play")),Ts.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):(S.debug("[".concat(this.getTrackId(),"] use audio context to play")),this._source.play())}stop(){S.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._played=!1,this._useAudioElement?Ts.stop(this.getTrackId()):this._source.stop()}_destroy(){super._destroy(),this._played=!1,this.unbindProcessorDestinationEvents(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];S.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&Ts.updateTrack(this.getTrackId(),this._mediaStreamTrack)}pipe(e){if(this._bypassWebAudio)throw new ae(P.NOT_SUPPORTED,"can not pipe extension when WebAudio disabled");if(this.processor===e)return e;if(e._source)throw new ae(P.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(this._bypassWebAudio)throw new ae(P.NOT_SUPPORTED,"can not unpipe extension when WebAudio disabled");if(!this.processor)return;const t=this.processor;(e=this._source.processSourceNode)===null||e===void 0||e.disconnect(),this.processor._source=!1,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(Ms.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(e)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())}),this.processorDestination.on(Ms.ON_NODE,e=>{this._source.processedNode=e;const t=!e;this._useAudioElement!==t&&(this._played?(this.stop(),this._useAudioElement=t,this.play()):this._useAudioElement=t)})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Ms.ON_TRACK),this.processorDestination.removeAllListeners(Ms.ON_NODE)}}).prototype,"setVolume",[I4],Object.getOwnPropertyDescriptor(es.prototype,"setVolume"),es.prototype),xt(es.prototype,"setAmplifiedVolume",[N4],Object.getOwnPropertyDescriptor(es.prototype,"setAmplifiedVolume"),es.prototype),xt(es.prototype,"setPlaybackDevice",[O4],Object.getOwnPropertyDescriptor(es.prototype,"setPlaybackDevice"),es.prototype),xt(es.prototype,"play",[x4],Object.getOwnPropertyDescriptor(es.prototype,"play"),es.prototype),xt(es.prototype,"stop",[D4],Object.getOwnPropertyDescriptor(es.prototype,"stop"),es.prototype),xt(es.prototype,"pipe",[B4],Object.getOwnPropertyDescriptor(es.prototype,"pipe"),es.prototype),xt(es.prototype,"unpipe",[k4],Object.getOwnPropertyDescriptor(es.prototype,"unpipe"),es.prototype),es);const Oi=new class extends Tn{get visibility(){return document.visibilityState}get lastHiddenTime(){return this._lastHiddenTime}get lastVisibleTime(){return this._lastVisibleTime}constructor(){super(),ie(this,"_lastHiddenTime",0),ie(this,"_lastVisibleTime",0),ie(this,"needUploadStats",[]),ie(this,"isCollectingStats",!1),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"?this._lastHiddenTime=performance.now():this._lastVisibleTime=performance.now(),this.isCollectingStats&&this.needUploadStats.push(document.visibilityState==="visible"?1:0),S.debug("current web page is ".concat(document.visibilityState)),this.emit("VISIBILITY_CHANGE",document.visibilityState)})}startCollectStats(){this.isCollectingStats=!0,this.needUploadStats.push(this.visibility==="visible"?1:0)}stopCollectStats(){this.isCollectingStats=!1,this.needUploadStats.length=0}};class U4 extends Tn{constructor(t,n){super(),ie(this,"trackMediaType",Lh.DATA),ie(this,"_version",1),ie(this,"_type",3),ie(this,"_config",void 0),ie(this,"_originDataChannel",void 0),ie(this,"_dataStreamPacketHeader",new ArrayBuffer(4)),ie(this,"_dataStreamPacketHandler",{serialize:i=>i,deserialize:i=>i}),ie(this,"_datachannelEventMap",new Map),this._config=t,n&&(this._originDataChannel=n,this._bandDataChannelEvents(n)),this._initPacketHeader()}useDataStream(t){this._dataStreamPacketHandler=t}get id(){return this._config.id}get ordered(){return this._config.ordered}get maxRetransmits(){return L("DATASTREAM_MAX_RETRANSMITS")}get metadata(){return this._config.metadata}get readyState(){var t,n;return(t=(n=this._originDataChannel)===null||n===void 0?void 0:n.readyState)!==null&&t!==void 0?t:"connecting"}get _originDataChannelId(){var t,n;return(t=(n=this._originDataChannel)===null||n===void 0?void 0:n.id)!==null&&t!==void 0?t:null}getChannelId(){return this.id}getConfig(){return this._config}_close(){this._originDataChannel&&(this._unbindDataChannelEvents(this._originDataChannel),this._originDataChannel=void 0)}async _waitTillOpen(){return new be((t,n)=>{if(this._originDataChannel){this._originDataChannel.readyState==="open"&&t();const i=setTimeout(()=>{var o;n(new ae(P.DATACHANNEL_CONNECTION_TIMEOUT,"Cannot create datachannel, id: ".concat((o=this._originDataChannel)===null||o===void 0?void 0:o.id)))},1e4);this._originDataChannel.onopen=()=>{clearTimeout(i),this._originDataChannel&&this._bandDataChannelEvents(this._originDataChannel),t()},this._originDataChannel.onerror=()=>{throw clearTimeout(i),new ae(P.DATACHANNEL_CONNECTION_TIMEOUT)}}else n(new ae(P.DATACHANNEL_CONNECTION_TIMEOUT,"cannot find dataChannel"))})}_updateOriginDataChannel(t){this._originDataChannel=t,this._bandDataChannelEvents(t)}_initPacketHeader(){const t=new DataView(this._dataStreamPacketHeader);t.setUint16(0,this._version),t.setUint8(2,this._type),t.setUint8(3,this._config.id)}_bandDataChannelEvents(t){this._unbindDataChannelEvents(t),[Bv.OPEN,Bv.CLOSE,Bv.ERROR].forEach(n=>{const i=()=>{this.emit(n)};this._datachannelEventMap.set(n,i),t.addEventListener(n,i)})}_unbindDataChannelEvents(t){Array.from(this._datachannelEventMap.entries()).forEach(n=>{let[i,o]=n;t.removeEventListener(i,o)}),this._datachannelEventMap.clear()}}class sle extends U4{constructor(t){super(t),ie(this,"_messageListener",void 0),this._messageListener=n=>{if(n.data.byteLength<this._dataStreamPacketHeader.byteLength)throw Error("invalid byteLength: the byte length must exceed "+this._dataStreamPacketHeader.byteLength);const i=n.data.slice(0,this._dataStreamPacketHeader.byteLength),o=new DataView(i).getUint8(3);if(o!==this.id)return void(L("SHOW_DATASTREAM2_LOG")&&S.debug("invalid datachannel id: ".concat(o," !== ").concat(this.id)));let l=n.data.slice(this._dataStreamPacketHeader.byteLength);l=this._dataStreamPacketHandler.deserialize(l),this.emit(Bv.MESSAGE,l)}}_updateOriginDataChannel(t){super._updateOriginDataChannel(t),this._bandRemoteDataChannelEvents()}_close(){this._originDataChannel&&(this._originDataChannel.removeEventListener("message",this._messageListener),super._close())}_bandRemoteDataChannelEvents(){this._originDataChannel&&this._originDataChannel.addEventListener("message",this._messageListener)}}class ile extends U4{send(t){if(this._originDataChannel){let n=t;n=this._dataStreamPacketHandler.serialize(t);const i=new Uint8Array(this._dataStreamPacketHeader.byteLength+n.byteLength);i.set(new Uint8Array(this._dataStreamPacketHeader),0),i.set(new Uint8Array(n),this._dataStreamPacketHeader.byteLength),this._originDataChannel.send(i.buffer)}}}function Mv(){const e=new Blob([atob("Y29uc3QgdD0idmlkZW8vaDI2NCIsZT0idmlkZW8vaDI2NSI7ZnVuY3Rpb24gbih0LGUsbil7bGV0IGE9bmV3IFVpbnQ4QXJyYXkodCxlLG4pLHI9W10sbz0wO2Zvcig7ci5sZW5ndGg8bjspbyszPG4mJjA9PT1hW29dJiYwPT09YVtvKzFdJiYzPT09YVtvKzJdJiYoMD09PWFbbyszXXx8MT09PWFbbyszXXx8Mj09PWFbbyszXXx8Mz09PWFbbyszXSk/KHIucHVzaChhW29dLGFbbysxXSxhW28rM10pLG8rPTQpOihyLnB1c2goYVtvXSksbysrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkocil9ZnVuY3Rpb24gYShhLHIpe3N3aXRjaChyKXtjYXNlIHQ6cmV0dXJuIGZ1bmN0aW9uKHQpe2NvbnN0IGU9bmV3IERhdGFWaWV3KHQuZGF0YSk7bGV0IGE9MDtmb3IoO2ErNDx0LmRhdGEuYnl0ZUxlbmd0aDspe2lmKDA9PT1lLmdldFVpbnQ4KGErMCkmJjA9PT1lLmdldFVpbnQ4KGErMSkmJjA9PT1lLmdldFVpbnQ4KGErMikmJjE9PT1lLmdldFVpbnQ4KGErMykmJjY9PT1lLmdldFVpbnQ4KGErNCkpe2xldCByPWErNixvPTAsaT0wO2Zvcig7MjU1PT09KGk9ZS5nZXRVaW50OChyKyspKTspbys9MjU1O28rPWk7Y29uc3Qgcz1uKHQuZGF0YSxyLG8pO3JldHVybiBuZXcgVWludDhBcnJheShzKX1hKyt9cmV0dXJuIG51bGx9KGEpO2Nhc2UgZTpyZXR1cm4gZnVuY3Rpb24odCl7Y29uc3QgZT1uZXcgRGF0YVZpZXcodC5kYXRhKTtsZXQgYT0wO2Zvcig7YSs1PHQuZGF0YS5ieXRlTGVuZ3RoOyl7aWYoMD09PWUuZ2V0VWludDgoYSswKSYmMD09PWUuZ2V0VWludDgoYSsxKSYmMD09PWUuZ2V0VWludDgoYSsyKSYmMT09PWUuZ2V0VWludDgoYSszKSYmNzg9PT1lLmdldFVpbnQ4KGErNCkmJjE9PT1lLmdldFVpbnQ4KGErNSkmJjEwMT09PWUuZ2V0VWludDgoYSs2KSl7bGV0IHI9YSs3LG89MCxpPTA7Zm9yKDsyNTU9PT0oaT1lLmdldFVpbnQ4KHIrKykpOylvKz0yNTU7bys9aTtjb25zdCBzPW4odC5kYXRhLHIsbyk7cmV0dXJuIG5ldyBVaW50OEFycmF5KHMpfWErK31yZXR1cm4gbnVsbH0oYSk7ZGVmYXVsdDpyZXR1cm4gbnVsbH19ZnVuY3Rpb24gcih0KXtjb25zdCBlPXQubGVuZ3RoO2xldCBuPVtdLGE9MDtmb3IoO2E8ZTspYSsyPGUmJjA9PT10W2FdJiYwPT09dFthKzFdJiYoMD09PXRbYSsyXXx8MT09PXRbYSsyXXx8Mj09PXRbYSsyXXx8Mz09PXRbYSsyXSk/KG4ucHVzaCh0W2FdLHRbYSsxXSwzLHRbYSsyXSksYSs9Myk6KG4ucHVzaCh0W2FdKSxhKyspO3JldHVybiBuZXcgVWludDhBcnJheShuKX1mdW5jdGlvbiBvKG4sYSxvKXtzd2l0Y2gobyl7Y2FzZSB0OnJldHVybiBmdW5jdGlvbih0LGUpe2NvbnN0IG49cihlKSxhPW4ubGVuZ3RoLG89TWF0aC5mbG9vcihhLzI1NSksaT1hJTI1NSxzPW5ldyBVaW50OEFycmF5KDYrbysxK2ErdC5ieXRlTGVuZ3RoKTtzWzBdPTAsc1sxXT0wLHNbMl09MCxzWzNdPTEsc1s0XT02LHNbNV09MTAxO2xldCBmPTA7Zm9yKDtmPG87KXNbNitmXT0yNTUsZisrO3JldHVybiBzWzYrZl09aSxmKysscy5zZXQobiw2K2YpLHMuc2V0KG5ldyBVaW50OEFycmF5KHQpLDYrZithKSxzLmJ1ZmZlcn0obixhKTtjYXNlIGU6cmV0dXJuIGZ1bmN0aW9uKHQsZSl7Y29uc3Qgbj1yKGUpLGE9bi5sZW5ndGgsbz1NYXRoLmZsb29yKGEvMjU1KSxpPWElMjU1LHM9bmV3IFVpbnQ4QXJyYXkoNytvKzErYSsxK3QuYnl0ZUxlbmd0aCk7c1swXT0wLHNbMV09MCxzWzJdPTAsc1szXT0xLHNbNF09Nzgsc1s1XT0xLHNbNl09MTAxO2xldCBmPTA7Zm9yKDtmPG87KXNbNytmXT0yNTUsZisrO3JldHVybiBzWzcrZl09aSxmKysscy5zZXQobiw3K2YpLGYrPWEsc1s3K2ZdPTEyOCxmKysscy5zZXQobmV3IFVpbnQ4QXJyYXkodCksNytmKSxzLmJ1ZmZlcn0obixhKTtkZWZhdWx0OnJldHVybiBudWxsfX1mdW5jdGlvbiBpKG4pe2lmKG4ubGVuZ3RoPDUpcmV0dXJuIiI7bGV0IGE9LTE7Zm9yKGxldCB0PTA7dDxuLmxlbmd0aC0zO3QrKyl7aWYoMD09PW5bdF0mJjA9PT1uW3QrMV0mJjE9PT1uW3QrMl0pe2E9dDticmVha31pZih0PG4ubGVuZ3RoLTQmJjA9PT1uW3RdJiYwPT09blt0KzFdJiYwPT09blt0KzJdJiYxPT09blt0KzNdKXthPXQ7YnJlYWt9fWlmKC0xPT09YSlyZXR1cm4iIjtjb25zdCByPWErKDA9PT1uW2ErMl0/NDozKTtpZihyPj1uLmxlbmd0aClyZXR1cm4iIjtjb25zdCBvPW5bcl07aWYoMTI4Jm8pcmV0dXJuIiI7aWYoKG8+PjEmNjMpPj0zMilyZXR1cm4gZTtpZihyKzE8bi5sZW5ndGgpe2lmKDA9PSgyNDgmbltyKzFdKSlyZXR1cm4gZX1yZXR1cm4oMzEmbyk8PTMxP3Q6IiJ9Y29uc3Qgcz03MSxmPTEsbD0yLHU9MSxnPTI7dmFyIGM7ZnVuY3Rpb24gZCh0LGU9ITEpe2NvbnN0IG49dC5nZXRVaW50OCgwKTtpZihuIT09cylyZXR1cm47Y29uc3QgYT10LmdldFVpbnQxNigxKSxyPWYrbCthLG89bmV3IFVpbnQ4QXJyYXkodC5ieXRlTGVuZ3RoLXIpO28uc2V0KG5ldyBVaW50OEFycmF5KHQuYnVmZmVyLHIsdC5ieXRlTGVuZ3RoLXIpKTtjb25zdCBpPXttOm4sdGx2TGVuOmEsdGx2OltdLGZyYW1lOm99O2xldCBkPWYrbDtmb3IoO2Q8cjspe2NvbnN0IG49dC5nZXRVaW50OChkKSxhPXQuZ2V0VWludDE2KGQrdSkscj11K2c7aWYobj09PWMuQVVESU9fTEVWRUwpe2xldCBvPXQuZ2V0VWludDgoZCtyKTtmb3IobGV0IGU9MTtlPGE7ZSsrKW89bzw8OHx0LmdldFVpbnQ4KGQrcitlKTtpLnRsdi5wdXNoKHt0YWc6bixsZW5ndGg6YSx2YWx1ZTplPzEyN15vPj4xOjEyNyZvfSl9ZWxzZSBpZihuPT09Yy5NRVRBREFUQXx8bj09PWMuQVVESU9fNjRfQklUX1BUUyl7Y29uc3QgZT1uZXcgVWludDhBcnJheShhKTtmb3IobGV0IG49MDtuPGE7bisrKWVbbl09dC5nZXRVaW50OChkK3Irbik7aS50bHYucHVzaCh7dGFnOm4sbGVuZ3RoOmEsdmFsdWU6ZX0pfWQrPXIrYX1yZXR1cm4gaX0hZnVuY3Rpb24odCl7dFt0LkFVRElPX0xFVkVMPTFdPSJBVURJT19MRVZFTCIsdFt0Lk1FVEFEQVRBPTJdPSJNRVRBREFUQSIsdFt0LkFVRElPXzY0X0JJVF9QVFM9M109IkFVRElPXzY0X0JJVF9QVFMifShjfHwoYz17fSkpLHNlbGYub25ydGN0cmFuc2Zvcm09dD0+e2NvbnN0IGU9dC50cmFuc2Zvcm1lcixuPVtdLHI9W107bGV0IGg9bnVsbDtlLm9wdGlvbnMucG9ydC5vbm1lc3NhZ2U9dD0+e3QuZGF0YS5zZWkmJm4ucHVzaCh0LmRhdGEuc2VpKSx0LmRhdGEubWV0YWRhdGEmJnIucHVzaCh0LmRhdGEubWV0YWRhdGEpfSxzZWxmLnBvc3RNZXNzYWdlKCJzdGFydGVkIik7Y29uc3QgcD1lLnJlYWRhYmxlLmdldFJlYWRlcigpLFU9ZS53cml0YWJsZS5nZXRXcml0ZXIoKTsic2VpLXJ4Ij09PWUub3B0aW9ucy5uYW1lP2Z1bmN0aW9uIHQoZSl7cC5yZWFkKCkudGhlbigobj0+e2lmKCFuLmRvbmUpe2lmKG4udmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkVmlkZW9GcmFtZSl7Y29uc3QgdD1pKG5ldyBVaW50OEFycmF5KG4udmFsdWUuZGF0YSkpLHI9YShuLnZhbHVlLHQpO2lmKHImJmUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHtzZWk6cn0pLCFoKXtjb25zdCB0PW4udmFsdWUuZ2V0TWV0YWRhdGEoKXx8e307aD17dHlwZTpuLnZhbHVlLnR5cGUscnRwVGltZXN0YW1wOm4udmFsdWUudGltZXN0YW1wLHBheWxvYWRUeXBlOnQucGF5bG9hZFR5cGV8fDAsc3NyYzp0LnN5bmNocm9uaXphdGlvblNvdXJjZXx8MCxsZW5ndGg6bi52YWx1ZS5kYXRhLmJ5dGVMZW5ndGgsLi4uIm1pbWVUeXBlImluIHQ/e21pbWVUeXBlOnQubWltZVR5cGV9Ont9fSxlLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7Zmlyc3RGcmFtZUluZm86aH0pfX1VLndyaXRlKG4udmFsdWUpLGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQoZSl9fSkpfShlKToic2VpLXR4Ij09PWUub3B0aW9ucy5uYW1lP2Z1bmN0aW9uIHQoZSl7cC5yZWFkKCkudGhlbigoYT0+e2lmKCFhLmRvbmUpe2lmKGEudmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkVmlkZW9GcmFtZSl7Y29uc3QgdD1pKG5ldyBVaW50OEFycmF5KGEudmFsdWUuZGF0YSkpLGU9bi5zaGlmdCgpO2lmKGUpe2NvbnN0IG49byhhLnZhbHVlLmRhdGEsZSx0KTtuJiYoYS52YWx1ZS5kYXRhPW4pfX1VLndyaXRlKGEudmFsdWUpLGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQoZSl9fSkpfShlKToiYXVkaW8tbWV0YWRhdGEtcngiPT09ZS5vcHRpb25zLm5hbWU/ZnVuY3Rpb24gdChlKXtwLnJlYWQoKS50aGVuKChuPT57aWYoIW4uZG9uZSl7aWYobi52YWx1ZSBpbnN0YW5jZW9mIFJUQ0VuY29kZWRBdWRpb0ZyYW1lKXtjb25zdCB0PW5ldyBEYXRhVmlldyhuLnZhbHVlLmRhdGEpLGE9dC5nZXRVaW50OCgwKTtsZXQgcjtpZigwIT0oMTI4JmEpJiY3MSE9PWEpe2NvbnN0IGU9ZnVuY3Rpb24odCl7aWYodC5ieXRlTGVuZ3RoPD0wKXJldHVybltdO2NvbnN0IGU9W107bGV0IG49MDtmb3IoO248dC5ieXRlTGVuZ3RoOyl7Y29uc3QgYT0oMTI4JnQuZ2V0VWludDgobikpPj43LHI9MTI3JnQuZ2V0VWludDgobik7aWYoIShhJiZuKzQ8PXQuYnl0ZUxlbmd0aCkpe24rKzticmVha317Y29uc3QgYT10LmdldFVpbnQzMihuLCExKSxvPSgxNjc3NjE5MiZhKT4+MTAsaT0xMDIzJmE7ZS5wdXNoKHtwdDpyLHRzX29mZnNldDpvLGxlbmd0aDppLGRhdGE6bmV3IFVpbnQ4QXJyYXl9KSxuKz00fX1sZXQgYT10LmJ5dGVMZW5ndGgtbjtmb3IoY29uc3QgciBvZiBlKXtpZihyLmxlbmd0aD5hKXJldHVybiBjb25zb2xlLndhcm4oIkJyb2tlbiByZWQgcGF5bG9hZCIpLFtdO3IubGVuZ3RoPjAmJihyLmRhdGE9bmV3IFVpbnQ4QXJyYXkodC5idWZmZXIsdC5ieXRlT2Zmc2V0K24sci5sZW5ndGgpLG4rPXIubGVuZ3RoLGEtPXIubGVuZ3RoKX1pZihhPjApe2NvbnN0IHI9e3B0OmUubGVuZ3RoPjA/ZVtlLmxlbmd0aC0xXS5wdDowLHRzX29mZnNldDowLGxlbmd0aDphLGRhdGE6bmV3IFVpbnQ4QXJyYXkodC5idWZmZXIsdC5ieXRlT2Zmc2V0K24sYSl9O2UucHVzaChyKX1yZXR1cm4gZX0odCk7aWYoZS5sZW5ndGg+MCl7Y29uc3QgdD1mdW5jdGlvbih0KXtsZXQgZT0wO2ZvcihsZXQgbj0wO248dC5sZW5ndGg7bisrKWUrPW48dC5sZW5ndGgtMT80OjEsZSs9dFtuXS5sZW5ndGg7Y29uc3Qgbj1uZXcgVWludDhBcnJheShlKTtsZXQgYT0wO2ZvcihsZXQgZT0wO2U8dC5sZW5ndGg7ZSsrKWlmKGU8dC5sZW5ndGgtMSl7Y29uc3Qgcj0oMjE0NzQ4MzY0OHwoMTI3JnRbZV0ucHQpPDwyNHwoMjYyMTQzJnRbZV0udHNfb2Zmc2V0KTw8MTB8MTAyMyZ0W2VdLmxlbmd0aCk+Pj4wO25bYSsrXT1yPj4yNCYyNTUsblthKytdPXI+PjE2JjI1NSxuW2ErK109cj4+OCYyNTUsblthKytdPTI1NSZyfWVsc2UgblthKytdPTEyNyZ0W2VdLnB0O2Zvcihjb25zdCBlIG9mIHQpbi5zZXQoZS5kYXRhLGEpLGErPWUubGVuZ3RoO3JldHVybiBufShlLm1hcCgodD0+e2NvbnN0IGU9bmV3IFVpbnQ4QXJyYXkodC5sZW5ndGgpO2Uuc2V0KHQuZGF0YSk7Y29uc3Qgbj1kKG5ldyBEYXRhVmlldyhlLmJ1ZmZlcikpO3JldHVybiBuPy5mcmFtZSYmKHQuZGF0YT1uPy5mcmFtZSkscj1uLHR9KSkpO24udmFsdWUuZGF0YT10LmJ1ZmZlcn19ZWxzZSByPWQodCksciYmKG4udmFsdWUuZGF0YT1yLmZyYW1lLmJ1ZmZlcik7aWYocil7bGV0IHQ9ci50bHYuZmluZCgodD0+dC50YWc9PT1jLk1FVEFEQVRBKSk7aWYodCYmdC52YWx1ZSBpbnN0YW5jZW9mIFVpbnQ4QXJyYXkmJmUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHttZXRhZGF0YTp0LnZhbHVlfSksdD1yLnRsdi5maW5kKCh0PT50LnRhZz09PWMuQVVESU9fNjRfQklUX1BUUykpLHQmJnQudmFsdWUgaW5zdGFuY2VvZiBVaW50OEFycmF5JiY4PT10LnZhbHVlLmxlbmd0aCl7Y29uc3Qgbj1uZXcgRGF0YVZpZXcodC52YWx1ZS5idWZmZXIpLmdldEJpZ1VpbnQ2NCgwLCEwKTt0JiZ0LnZhbHVlIGluc3RhbmNlb2YgVWludDhBcnJheSYmZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3B0czpufSl9fX1VLndyaXRlKG4udmFsdWUpLGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQoZSl9fSkpfShlKToiYXVkaW8tbWV0YWRhdGEtdHgiPT09ZS5vcHRpb25zLm5hbWUmJmZ1bmN0aW9uIHQoZSl7cC5yZWFkKCkudGhlbigobj0+e2lmKCFuLmRvbmUpe2lmKGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHtnZXRNZXRhZGF0YTohMH0pLG4udmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkQXVkaW9GcmFtZSl7Y29uc3QgdD1yLnNoaWZ0KCk7dCYmKG4udmFsdWUuZGF0YT1mdW5jdGlvbih0LGUsbil7Y29uc3QgYT1uLmJ5dGVMZW5ndGgscj1hK3UrZyxvPWYrbCtyLGk9bmV3IEFycmF5QnVmZmVyKHQuYnl0ZUxlbmd0aCtvKSxjPW5ldyBEYXRhVmlldyhpKTtjLnNldFVpbnQ4KDAscyksYy5zZXRVaW50MTYoMSxyKSxjLnNldFVpbnQ4KDMsZSksYy5zZXRVaW50MTYoNCxhKTtmb3IobGV0IHQ9MDt0PGE7dCsrKWMuc2V0VWludDgoNit0LG5bdF0pO2NvbnN0IGQ9bmV3IFVpbnQ4QXJyYXkoYy5idWZmZXIpO3JldHVybiBkLnNldChuZXcgVWludDhBcnJheSh0KSxvKSxkLmJ1ZmZlcn0obi52YWx1ZS5kYXRhLGMuQVVESU9fNjRfQklUX1BUUyx0KSl9VS53cml0ZShuLnZhbHVlKSxlLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSx0KGUpfX0pKX0oZSl9LHNlbGYucG9zdE1lc3NhZ2UoInJlZ2lzdGVyZWQiKTsK")],{type:"text/javascript"});return setTimeout(()=>PE.revokeObjectURL(e),0),new Worker(PE.createObjectURL(e))}const P4=71,IR=1,NR=2,OR=1,M4=2;var Wl=function(e){return e[e.AUDIO_LEVEL=1]="AUDIO_LEVEL",e[e.METADATA=2]="METADATA",e[e.AUDIO_64_BIT_PTS=3]="AUDIO_64_BIT_PTS",e}(Wl||{});function xR(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const n=e.getUint8(0);if(n!==P4)return;const i=e.getUint16(1),o=IR+NR+i,l=new Uint8Array(e.byteLength-o);l.set(new Uint8Array(e.buffer,o,e.byteLength-o));const d={m:n,tlvLen:i,tlv:[],frame:l};let h=IR+NR;for(;h<o;){const f=e.getUint8(h),g=e.getUint16(h+OR),_=OR+M4;if(f===Wl.AUDIO_LEVEL){let v=e.getUint8(h+_);for(let y=1;y<g;y++)v=v<<8|e.getUint8(h+_+y);d.tlv.push({tag:f,length:g,value:t?127^v>>1:127&v})}else if(f===Wl.METADATA||f===Wl.AUDIO_64_BIT_PTS){const v=new Uint8Array(g);for(let y=0;y<g;y++)v[y]=e.getUint8(h+_+y);d.tlv.push({tag:f,length:g,value:v})}h+=_+g}return d}const Fv=new Map,jv=127,Bd=1e-10,DR=139/13,Vv=new Map;function BR(e,t,n){const i="".concat(e,"-").concat(t,"-").concat(n);let o=0;return Vv.has(i)?o=Vv.get(i):(o=Math.log(function(d,h){const f=d-h;h<f&&(h=f);let g=1;for(let _=d,v=1;_>h;_--,v++)g=g*_/v;return g}(t,e))+e*Math.log(.5)+(t-e)*Math.log(1-.5)-Math.log(n)+n*e,Vv.set(i,o)),o<Bd&&(o=Bd),o}function F4(e,t,n){const i=t.length,o=e.length/i;let l=!1;for(let d=0,h=0;d<i;d++){let f=0;for(let g=h+o;h<g;h++)e[h]>n&&f++;t[d]!==f&&(t[d]=f,l=!0)}return l}window.cache=Vv;let ale=0;class j4{constructor(t){ie(this,"id",void 0),ie(this,"immediates",[]),ie(this,"lastNonSilence",-1),ie(this,"immediateSpeechActivityScore",Bd),ie(this,"lastLevelChangedTime",Date.now()),ie(this,"levels",[]),ie(this,"longs",[]),ie(this,"longSpeechActivityScore",Bd),ie(this,"mediums",[]),ie(this,"mediumSpeechActivityScore",Bd),ie(this,"minLevel",0),ie(this,"nextMinLevel",0),ie(this,"nextMinLevelWindowLength",0),ie(this,"energyScore",0),this.id=t||"".concat(ale++),this.immediates.length=50,this.mediums.length=10,this.longs.length=1,this.levels.length=this.immediates.length}computeImmediates(){const t=this.immediates,n=this.levels,i=this.minLevel+DR;let o=!1;for(let l=0;l<t.length;++l){let d=n[l];d<i&&(d=0);const h=Math.floor(d/DR);t[l]!==h&&(t[l]=h,o=!0)}return o}computeLongs(){return F4(this.mediums,this.longs,4)}computeMediums(){return F4(this.immediates,this.mediums,7)}evaluateImmediateSpeechActivityScore(){this.immediateSpeechActivityScore=BR(this.immediates[0],13,.78)}evaluateLongSpeechActivityScore(t){this.longSpeechActivityScore=BR(this.longs[0],10,47),this.longSpeechActivityScore>Bd&&(this.lastNonSilence=t)}evaluateMediumSpeechActivityScore(){this.mediumSpeechActivityScore=BR(this.mediums[0],5,24)}evaluateSpeechActivityScores(t){this.computeImmediates()&&(this.evaluateImmediateSpeechActivityScore(),this.computeMediums()&&(this.evaluateMediumSpeechActivityScore(),this.computeLongs()&&this.evaluateLongSpeechActivityScore(t)))}getLastLevelChangedTime(){return this.lastLevelChangedTime}getLevels(){var t;return"[".concat(o1(t=[...this.levels]).call(t).join(),"]")}getSpeechActivityScore(t){switch(t){case 0:return this.immediateSpeechActivityScore;case 1:return this.mediumSpeechActivityScore;case 2:return this.longSpeechActivityScore;default:throw new Error("interval "+t)}}levelChanged(t,n){if(this.lastLevelChangedTime<=n){this.lastLevelChangedTime=n;let i=t;return t<0&&(i=0),t>jv&&(i=jv),this.levels.unshift(i),this.levels.length>this.immediates.length&&this.levels.pop(),this.updateMinLevel(i),i>=this.minLevel+DR?i:i/2}return-1}levelTimedOut(){this.levelChanged(0,this.lastLevelChangedTime)}updateMinLevel(t){if(t!==0){if(this.minLevel===0||this.minLevel>t)return this.minLevel=t,this.nextMinLevel=0,void(this.nextMinLevelWindowLength=0);if(this.nextMinLevel===0)return this.nextMinLevel=t,void(this.nextMinLevelWindowLength=1);if(this.nextMinLevel>t&&(this.nextMinLevel=t),this.nextMinLevelWindowLength++,this.nextMinLevelWindowLength>=750){let n=Math.sqrt(this.minLevel*this.nextMinLevel);n<0?n=0:n>jv&&(n=jv),this.minLevel=n,this.nextMinLevel=0,this.nextMinLevelWindowLength=0}}}}class ole{constructor(t){ie(this,"algorithm",void 0),this.algorithm=t}execute(){let t=!this.algorithm;if(!t)try{const n=this.algorithm.runInDecisionMaker(this);n<=0?t=!0:setTimeout(this.execute.bind(this),n)}catch{t=!0}t&&this.algorithm&&this.algorithm.decisionMakerExited(this)}}class kR{constructor(t,n,i){ie(this,"isDominant",void 0),ie(this,"energyRanking",void 0),ie(this,"energyScore",void 0),this.isDominant=t,this.energyRanking=n,this.energyScore=i}}class cle extends Tn{constructor(t){super(),ie(this,"dominantId",null),ie(this,"lastDecisionTime",0),ie(this,"lastLevelChangedTime",0),ie(this,"lastLevelIdleTime",0),ie(this,"relativeSpeechActivities",[]),ie(this,"speakers",new Map),ie(this,"enableSilence",!1),ie(this,"timeoutToSilenceInterval",0),ie(this,"decisionMaker",null),ie(this,"loudest",[]),ie(this,"numLoudestToTrack",3),ie(this,"energyExpireTimeMs",250),ie(this,"energyAlphaPct",50),this.timeoutToSilenceInterval=t,this.enableSilence=t>0,this.relativeSpeechActivities.length=3}setLoudestConfig(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:3,n=arguments.length>1?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0;this.numLoudestToTrack=t,n!=null&&(this.energyExpireTimeMs=n),i!=null&&(this.energyAlphaPct=i),this.loudest.length>t&&this.loudest.splice(t)}getDominantSpeaker(){return this.dominantId}isAmongLoudest(t){return this.loudest.some(n=>n.id===t)}levelChanged(t,n){const i=Date.now(),o=this.getOrCreateSpeaker(t);this.lastLevelChangedTime<i&&(this.lastLevelChangedTime=i,this.maybeStartDecisionMaker());const l=o.levelChanged(n,i);return this.updateLoudestList(o,l,i)}runInDecisionMaker(t){return this.decisionMaker!==t||this.lastDecisionTime>0&&this.lastDecisionTime-this.lastLevelChangedTime>=15e3?-1:this._runInDecisionMaker()}decisionMakerExited(t){this.decisionMaker===t&&(this.decisionMaker=null)}destroy(){this.decisionMaker=null,this.loudest.length=0,this.speakers.clear(),this.removeAllListeners()}addSpeakers(t){t.forEach(n=>{this.speakers.has(n.id)||this.speakers.set(n.id,n)})}removeSpeakers(t){t.forEach(n=>{this.speakers.delete(n.id)})}getOrCreateSpeaker(t){let n=this.speakers.get(t);return n||(n=new j4(t),this.speakers.set(t,n),this.maybeStartDecisionMaker()),n}updateLoudestList(t,n,i){const o=t.id===this.dominantId;if(n<0){let f=0;for(;f<this.loudest.length&&this.loudest[f]!==t;)++f;return new kR(o,f,t.energyScore)}if(t.energyScore=Math.floor((this.energyAlphaPct*n+(100-this.energyAlphaPct)*t.energyScore+50)/100),this.numLoudestToTrack===0)return new kR(o,0,t.energyScore);const l=i-this.energyExpireTimeMs;let d=0;for(;d<this.loudest.length;){const f=this.loudest[d];if(f.getLastLevelChangedTime()<l&&this.loudest.length>=this.numLoudestToTrack)this.loudest.splice(d,1);else if(f.id!==t.id)++d;else if(this.loudest.splice(d,1),this.loudest.length<this.numLoudestToTrack)break}let h=0;for(;h<this.loudest.length&&!(this.loudest[h].energyScore<t.energyScore);)++h;return h<this.numLoudestToTrack&&(this.loudest.splice(h,0,t),this.loudest.length>this.numLoudestToTrack&&this.loudest.splice(this.numLoudestToTrack,1)),new kR(o,h,t.energyScore)}maybeStartDecisionMaker(){!this.decisionMaker&&this.speakers.size>0&&(this.decisionMaker=new ole(this),this.decisionMaker.execute())}makeDecision(t){let n=null,i=null;const o=this.speakers.size;let l=null;if(o===0)l=null;else if(o===1){var d;const h=Ti(d=this.speakers).call(d).next().value;this.enableSilence&&h&&(l=h.id,h.evaluateSpeechActivityScores(t),t-h.lastNonSilence>this.timeoutToSilenceInterval&&(l=null))}else{let h=this.dominantId==null?null:this.speakers.get(this.dominantId);if(h==null){const _=this.speakers.entries().next();_.value&&(l=_.value[0],h=_.value[1])}else l=h.id;h!=null&&h.evaluateSpeechActivityScores(t);const f=this.relativeSpeechActivities;let g=2;for(const _ of this.speakers.entries()){const[v,y]=_;if(y===h)continue;y.evaluateSpeechActivityScores(t);for(let O=0;O<f.length;++O){const U=h==null?Bd:h.getSpeechActivityScore(O);f[O]=Math.log(y.getSpeechActivityScore(O)/U)}const b=f[0],D=f[1],I=f[2];b>3&&D>2&&I>0&&D>g&&(g=D,l=v)}this.enableSilence&&h!=null&&l===h.id&&t-h.lastNonSilence>this.timeoutToSilenceInterval&&(l=null)}l==null&&!this.enableSilence||l===this.dominantId||(n=this.dominantId,this.dominantId=l,i=this.dominantId),i==null&&!this.enableSilence||i===n||this.emit("ActiveSpeakerChanged",i)}_runInDecisionMaker(){const t=Date.now(),n=300-(t-this.lastLevelIdleTime);let i=0;n<=0?(this.lastLevelIdleTime!==0&&this.timeoutIdleLevels(t),this.lastLevelIdleTime=t):i=n;let o=300-(t-this.lastDecisionTime);return o<=0&&(this.lastDecisionTime=t,this.makeDecision(t),o=300-(Date.now()-t)),o>0&&i>o&&(i=o),i}timeoutIdleLevels(t){const n=[];for(const o of Ti(i=this.speakers).call(i)){var i;const l=t-o.getLastLevelChangedTime();36e5<l&&(this.dominantId==null||o.id!==this.dominantId)?n.push(o.id):300<l&&o.levelTimedOut()}n.forEach(o=>this.speakers.delete(o))}}const Vh=new Map;let Bo=null,Qv=null;const V4=3;let kd=[];const ko=new Map,Hv=new Map;class lle{get samples(){return this.actives+this.inactives}get activeRate(){return this.actives/this.samples}constructor(t,n){ie(this,"id",void 0),ie(this,"track",void 0),ie(this,"score",0),ie(this,"active",!0),ie(this,"muted",!1),ie(this,"timer",0),ie(this,"actives",0),ie(this,"inactives",0),this.id=t,this.track=n,this.setActive(ko.size<3)}autoCheckActive(){this.autoSetActive(),this.autoAdjustActive(),this.resetTimer(),this.actives=0,this.inactives=0}autoSetActive(){const t=this.active;this.active=this.activeRate>=.8;const{actives:n,inactives:i}=function(){const o=[],l=[];return Array.from(Ti(ko).call(ko)).forEach(d=>{d.active?o.push(d):l.push(d)}),{actives:o,inactives:l}}();if(n.length>3){let o;n.forEach(l=>{(!o||o.score>l.score)&&(o=l)}),o&&o.setActive(!1)}if(n.length<3&&i.length>0){let o;i.forEach(l=>{(!o||o.score<l.score)&&l.id!==this.id&&(o=l)}),o&&t&&!this.active&&(o.samples>40&&o.activeRate-this.activeRate>.4?o.setActive(!0):this.active=!0)}this.setMuted(!this.active)}setActive(t){this.active=t,this.resetTimer(),this.setMuted(!t)}autoAdjustActive(){this.active?this.autoSwitchToInactive():this.autoSwitchToActive()}autoSwitchToActive(){const t=function(n){let i;return Array.from(Ti(ko).call(ko)).forEach(o=>{!o.active||o.id===n||o.samples<40||(!i||o.score<i.score)&&(i=o)}),i}(this.id);t&&this.activeRate-t.activeRate>.4&&(t.setActive(!1),this.setActive(!0))}autoSwitchToInactive(){const t=function(n){let i;return Array.from(Ti(ko).call(ko)).forEach(o=>{o.active||o.id===n||o.samples<40||(!i||o.score>i.score)&&(i=o)}),i}(this.id);t&&t.activeRate-this.activeRate>.4&&(t.setActive(!0),this.setActive(!1))}addSample(t){t?this.actives+=1:this.inactives+=1,this.samples>66.66666666666667&&this.autoCheckActive()}setMuted(t){this.track&&(this.track.enabled=!t,this.muted=t)}resetTimer(){this.clearTimer(),this.timer=window.setTimeout(()=>{if(this.samples!==0)return this.samples<50?this.resetTimer():void this.autoCheckActive()},1e3)}clearTimer(){this.timer&&(clearTimeout(this.timer),this.timer=0)}}let Gv;function Q4(e){const t=ko.get(e);t&&(ko.delete(e),t.clearTimer())}const Kv=new Map,Ale=new Map,LR="video/h264",UR="video/h265";function H4(e,t,n){let i=new Uint8Array(e,t,n),o=[],l=0;for(;o.length<n;)l+3<n&&i[l]===0&&i[l+1]===0&&i[l+2]===3&&(i[l+3]===0||i[l+3]===1||i[l+3]===2||i[l+3]===3)?(o.push(i[l],i[l+1],i[l+3]),l+=4):(o.push(i[l]),l++);return new Uint8Array(o)}function G4(e){const t=e.length;let n=[],i=0;for(;i<t;)i+2<t&&e[i]===0&&e[i+1]===0&&(e[i+2]===0||e[i+2]===1||e[i+2]===2||e[i+2]===3)?(n.push(e[i],e[i+1],3,e[i+2]),i+=3):(n.push(e[i]),i++);return new Uint8Array(n)}function K4(e){if(e.length<5)return"";let t=-1;for(let o=0;o<e.length-3;o++){if(e[o]===0&&e[o+1]===0&&e[o+2]===1){t=o;break}if(o<e.length-4&&e[o]===0&&e[o+1]===0&&e[o+2]===0&&e[o+3]===1){t=o;break}}if(t===-1)return"";const n=t+(e[t+2]===0?4:3);if(n>=e.length)return"";const i=e[n];return 128&i?"":(i>>1&63)>=32||n+1<e.length&&!(248&e[n+1])?UR:(31&i)<=31?LR:""}const Wv=new Map,Rm=new Map;(function(){const e=Lt();Cr.getDisplayMedia=!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia),Cr.getStreamFromExtension=e.name===Mt.CHROME&&Number(e.version)>34,Cr.supportUnifiedPlan=function(){if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;const t=new RTCPeerConnection;let n=!1;try{t.addTransceiver("audio"),n=!0}catch{}return t.close(),n}(),Cr.supportMinBitrate=e.name===Mt.CHROME||e.name===Mt.EDGE,Cr.supportSetRtpSenderParameters=function(){const t=Lt();return!!(window.RTCRtpSender&&window.RTCRtpSender.prototype.setParameters&&window.RTCRtpSender.prototype.getParameters)&&(!!uc()||!(!kr()&&!Ev())||t.name===Mt.FIREFOX&&Number(t.version)>=64)}(),e.name===Mt.SAFARI&&(Number(e.version)>=14?Cr.supportDualStream=!0:Cr.supportDualStream=!1),Cr.webAudioMediaStreamDest=function(){const t=Lt();return!(t.name===Mt.SAFARI&&Number(t.version)<12)}(),Cr.supportReplaceTrack=!!window.RTCRtpSender&&typeof RTCRtpSender.prototype.replaceTrack=="function",Cr.supportWebGL=typeof WebGLRenderingContext<"u",Cr.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,uc()||(Cr.webAudioWithAEC=!0),Cr.supportShareAudio=function(){const t=Lt();return(t.os===br.WIN_10||t.os===br.WIN_81||t.os===br.WIN_7||t.os===br.LINUX||t.os===br.MAC_OS||t.os===br.CHROMIUM_OS)&&t.name===Mt.CHROME&&Number(t.version)>=74}(),Cr.supportDataChannel=!!(dc(76)||jT(68)||UM(14)),Cr.supportPCSetConfiguration=function(){const t=window.RTCPeerConnection;return!gn()&&!!t&&t.prototype.setConfiguration instanceof Function}(),Cr.supportWebRTCEncodedTransform=dc(87)||BM()||jT(117),Cr.supportWebRTCInsertableStream=function(){const t=Lt();return(t.name===Mt.CHROME||t.name===Mt.EDGE)&&Number(t.version)>=94&&"MediaStreamTrackGenerator"in window&&"MediaStreamTrackProcessor"in window}(),Cr.supportRequestVideoFrameCallback="requestVideoFrameCallback"in HTMLVideoElement.prototype,Cr.supportWebCrypto=typeof window<"u"&&window.crypto!==void 0&&window.crypto.subtle!==void 0,Cr.supportSuppressLocalAudioPlayback=NF(),Cr.supportRestrictOwnAudio=OF(),yv(()=>{Cr.supportDualStreamEncoding=function(){const t=Lt();return!!L("DISABLE_WEBAUDIO")||t.name==="Safari"&&Number(t.version)>=14||!!(t.name==="Chrome"&&/Windows/i.test(t.os||"")&&Number(t.version)>=100&&L("CHROME_DUAL_STREAM_USE_ENCODING"))}(),S.debug("browser ua: ",navigator.userAgent),S.info("browser info: ",e),S.info("browser compatibility: ",Cr)})})();const dle=["CHINA","GLOBAL"],W4=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],Ld=[],Qh=[];function Ud(e,t){return!!t&&Ld.some(n=>n.uid===e&&n.channelName===t)}function PR(){return Qh.length>0}var ule=ZP.forEach,Y4=q_("forEach")?[].forEach:function(e){return ule(this,e,arguments.length>1?arguments[1]:void 0)};Yt({target:"Array",proto:!0,forced:[].forEach!==Y4},{forEach:Y4});var hle=oa("Array","forEach"),ple=Ll,fle=hs,mle=B,gle=hle,MR=Array.prototype,_le={DOMTokenList:!0,NodeList:!0},Ele=function(e){var t=e.forEach;return e===MR||mle(MR,e)&&t===MR.forEach||fle(_le,ple(e))?gle:t},vle=A(Ele),yle=ic,z4=tE;Yt({target:"Object",stat:!0,forced:u(function(){z4(1)})},{keys:function(e){return z4(yle(e))}});var wle=A(Ot.Object.keys),ble=A(s1),Sle=A(a1),Cle=Yt,q4=Ff,Tle=fE,Rle=ut,X4=Jb,Ile=kl,Nle=Et,Ole=mC,xle=sr,Dle=Pl,Ble=HP("slice"),kle=xle("species"),FR=Array,Lle=Math.max;Cle({target:"Array",proto:!0,forced:!Ble},{slice:function(e,t){var n,i,o,l=Nle(this),d=Ile(l),h=X4(e,d),f=X4(t===void 0?d:t,d);if(q4(l)&&(n=l.constructor,(Tle(n)&&(n===FR||q4(n.prototype))||Rle(n)&&(n=n[kle])===null)&&(n=void 0),n===FR||n===void 0))return Dle(l,h,f);for(i=new(n===void 0?FR:n)(Lle(f-h,0)),o=0;h<f;h++,o++)h in l&&Ole(i,o,l[h]);return i.length=o,i}});var Ule=oa("Array","slice"),Ple=B,Mle=Ule,jR=Array.prototype,Fle=function(e){var t=e.slice;return e===jR||Ple(jR,e)&&t===jR.slice?Mle:t},jle=A(Fle);function Ce(e,t,n,i,o){var l,d,h,f={};return vle(l=wle(i)).call(l,function(g){f[g]=i[g]}),f.enumerable=!!f.enumerable,f.configurable=!!f.configurable,("value"in f||f.initializer)&&(f.writable=!0),f=ble(d=Sle(h=jle(n).call(n)).call(h)).call(d,function(g,_){return _(e,t,g)||g},f),o&&f.initializer!==void 0&&(f.value=f.initializer?f.initializer.call(o):void 0,f.initializer=void 0),f.initializer===void 0?(FP(e,t,f),null):f}let Yv=function(e){return e[e.ACCESS_POINT=101]="ACCESS_POINT",e[e.UNILBS=201]="UNILBS",e[e.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR",e}({}),VR=function(e){return e[e.IIIEGAL_APPID=1]="IIIEGAL_APPID",e[e.IIIEGAL_UID=2]="IIIEGAL_UID",e[e.INTERNAL_ERROR=3]="INTERNAL_ERROR",e}({}),pa=function(e){return e[e.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",e[e.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",e[e.INTERNAL_ERROR=8]="INTERNAL_ERROR",e[e.NO_AUTHORIZED=9]="NO_AUTHORIZED",e[e.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",e[e.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",e[e.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",e[e.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",e[e.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",e[e.USER_OVERLOAD=16]="USER_OVERLOAD",e[e.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",e[e.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND",e[e.REQ_DOWNGRADE_FALLBACK=27]="REQ_DOWNGRADE_FALLBACK",e}({}),Fs=function(e){return e[e.NO_FLAG_SET=100]="NO_FLAG_SET",e[e.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",e[e.INVALID_FALG_SET=102]="INVALID_FALG_SET",e[e.FLAG_SET_BUT_NO_RE=103]="FLAG_SET_BUT_NO_RE",e[e.INVALID_SERVICE_ID=104]="INVALID_SERVICE_ID",e[e.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",e[e.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",e[e.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",e[e.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",e[e.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",e[e.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",e[e.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",e[e.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",e[e.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",e[e.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",e[e.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",e[e.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",e[e.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",e[e.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV",e}({}),Ke=function(e){return e[e.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",e[e.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",e[e.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",e[e.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",e[e.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",e[e.K_TICKET_INVALID=7]="K_TICKET_INVALID",e[e.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",e[e.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",e[e.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",e[e.K_UID_BANNED=14]="K_UID_BANNED",e[e.K_IP_BANNED=15]="K_IP_BANNED",e[e.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",e[e.DATASTREAM2_NOT_AVAILABLE=27]="DATASTREAM2_NOT_AVAILABLE",e[e.K_AUTO_REBALANCE=28]="K_AUTO_REBALANCE",e[e.K_VOS_FALLBACK=30]="K_VOS_FALLBACK",e[e.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",e[e.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",e[e.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",e[e.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",e[e.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",e[e.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",e[e.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",e[e.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",e[e.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",e[e.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",e[e.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",e[e.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",e[e.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",e[e.ERR_INVALID_UID=117]="ERR_INVALID_UID",e[e.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",e[e.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",e[e.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",e[e.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",e[e.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",e[e.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",e[e.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",e[e.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",e[e.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",e[e.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",e[e.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",e[e.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",e[e.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",e[e.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",e[e.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",e[e.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",e[e.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",e[e.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",e[e.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",e[e.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",e[e.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",e[e.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",e[e.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",e[e.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",e[e.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",e[e.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",e[e.ERR_TOO_MANY_BROADCASTERS=2031]="ERR_TOO_MANY_BROADCASTERS",e[e.ERR_TOO_MANY_SUBSCRIBERS=2032]="ERR_TOO_MANY_SUBSCRIBERS",e[e.ERR_LICENSE_MISSING=32769]="ERR_LICENSE_MISSING",e[e.ERR_LICENSE_EXPIRED=32771]="ERR_LICENSE_EXPIRED",e[e.ERR_LICENSE_MINUTES_EXCEEDED=32773]="ERR_LICENSE_MINUTES_EXCEEDED",e[e.ERR_LICENSE_PERIOD_INVALID=32774]="ERR_LICENSE_PERIOD_INVALID",e[e.ERR_LICENSE_MULTIPLE_SDK_SERVICE=32778]="ERR_LICENSE_MULTIPLE_SDK_SERVICE",e[e.ERR_LICENSE_ILLEGAL=32783]="ERR_LICENSE_ILLEGAL",e[e.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",e[e.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",e[e.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY",e}({}),Tt=function(e){return e.CONNECTING="connecting",e.CONNECTED="connected",e.RECONNECTING="reconnecting",e.CLOSED="closed",e}({}),Ue=function(e){return e.WS_CONNECTED="ws_connected",e.WS_RECONNECTING="ws_reconnecting",e.WS_CLOSED="ws_closed",e.WS_RECONNECT_CREATE_CONNECTION="ws_reconnect_create_connection",e.ON_BINARY_DATA="on_binary_data",e.REQUEST_RECOVER="request_recover",e.REQUEST_JOIN_INFO="request_join_info",e.REQUEST_REJOIN_INFO="req_rejoin_info",e.IS_P2P_DISCONNECTED="is_p2p_dis",e.DISCONNECT_P2P="dis_p2p",e.ABORT_P2P_EXECUTION="abort_p2p_execution",e.NEED_RENEW_SESSION="need-sid",e.REPORT_JOIN_GATEWAY="report_join_gateway",e.REQUEST_TIMEOUT="request_timeout",e.REQUEST_SUCCESS="request_success",e.JOIN_RESPONSE="join_response",e.PRE_CONNECT_PC="pre_connect_pc",e.DATACHANNEL_PRECONNECT="datachannel_preconnect",e.DATACHANNEL_CONNECTING="datachannel_connecting",e.DATACHANNEL_FAILBACK="datachannel_failback",e.P2P_CONNECTION="p2p_connection",e.P2P_REMOTE_CANDIDATE_UPDATE="p2p_remote_candidate_update",e.P2P_SUBSCRIBE="p2p_subscribe",e.P2P_UNSUBSCRIBE="p2p_unsubscribe",e.P2P_EXCHANGE_SDP="p2p_exchange_sdp",e.P2P_ON_ADD_VIDEO_STREAM="p2p_on_add_video_stream",e.P2P_ON_ADD_AUDIO_STREAM="p2p_on_add_audio_stream",e.RECOVER_NOTIFICATION="recover_notification",e.VOS_FALLBACK="vos_fallback",e.VOS_FALLBACK_PROMISE="vos_fallback_promise",e}({}),je=function(e){return e.PING="ping",e.PING_BACK="ping_back",e.JOIN="join_v3",e.REJOIN="rejoin_v3",e.LEAVE="leave",e.SET_CLIENT_ROLE="set_client_role",e.PUBLISH="publish",e.PUBLISH_DATASTREAM="publish_datastream",e.UNPUBLISH="unpublish",e.UNPUBLISH_DATASTREAM="unpublish_datastream",e.SUBSCRIBE="subscribe",e.PRE_SUBSCRIBE="pre_subscribe",e.SUBSCRIBE_DATASTREAM="subscribe_datastream",e.SUBSCRIBE_STREAMS="subscribe_streams",e.UNSUBSCRIBE="unsubscribe",e.UNSUBSCRIBE_DATASTREAM="unsubscribe_datastream",e.UNSUBSCRIBE_STREAMS="unsubscribe_streams",e.SUBSCRIBE_CHANGE="subscribe_change",e.TRAFFIC_STATS="traffic_stats",e.RENEW_TOKEN="renew_token",e.SET_DUAL_STREAM_MODE="set_dual_stream_mode",e.SWITCH_VIDEO_STREAM="switch_video_stream",e.DEFAULT_VIDEO_STREAM="default_video_stream",e.SET_FALLBACK_OPTION="set_fallback_option",e.CONFIGURE="configure",e.GATEWAY_INFO="gateway_info",e.CONTROL="control",e.SEND_METADATA="send_metadata",e.DATA_STREAM="data_stream",e.PICK_SVC_LAYER="pick_svc_layer",e.RESTART_ICE="restart_ice",e.CONNECT_PC="connect_pc",e.SET_VIDEO_PROFILE="set_video_profile",e.SET_PARAMETER="set_parameter",e.SET_RTM2_FLAG="set_rtm2_flag",e.DOWNGRADE_CODEC="downgrade_codec",e}({}),Pd=function(e){return e.WRTC_STATS="wrtc_stats",e.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length",e.DENOISER_STATS="denoiser_stats",e.EXTENSION_USAGE_STATS="extension_usage_stats",e}({}),nt=function(e){return e.ON_USER_ONLINE="on_user_online",e.ON_USER_OFFLINE="on_user_offline",e.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",e.ON_PUBLISH_STREAM="on_publish_stream",e.ON_UPLINK_STATS="on_uplink_stats",e.ON_P2P_LOST="on_p2p_lost",e.ON_REMOVE_STREAM="on_remove_stream",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",e.ON_USER_BANNED="on_user_banned",e.ON_USER_LICENSE_BANNED="on_user_license_banned",e.ON_NOTIFICATION="on_notification",e.ON_CRYPT_ERROR="on_crypt_error",e.MUTE_AUDIO="mute_audio",e.MUTE_VIDEO="mute_video",e.UNMUTE_AUDIO="unmute_audio",e.UNMUTE_VIDEO="unmute_video",e.ON_P2P_OK="on_p2p_ok",e.RECEIVE_METADATA="receive_metadata",e.ON_DATA_STREAM="on_data_stream",e.ON_RTP_CAPABILITY_CHANGE="on_rtp_capability_change",e.ON_REMOTE_DATASTREAM_UPDATE="on_remote_datastream_update",e.ON_REMOTE_FULL_DATASTREAM_INFO="on_remote_full_datastream_info",e.ENABLE_LOCAL_VIDEO="enable_local_video",e.DISABLE_LOCAL_VIDEO="disable_local_video",e.ENABLE_LOCAL_AUDIO="enable_local_audio",e.DISABLE_LOCAL_AUDIO="disable_local_audio",e.ON_PUBLISHED_USER_LIST="on_published_user_list",e.ENABLE_MULTI_STREAM="enable_multi_stream",e}({}),js=function(e){return e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY",e}({}),lt=function(e){return e.CONNECTED="websocket:connected",e.RECONNECTING="websocket:reconnecting",e.WILL_RECONNECT="websocket:will_reconnect",e.CLOSED="websocket:closed",e.FAILED="websocket:failed",e.ON_MESSAGE="websocket:on_message",e.REQUEST_NEW_URLS="websocket:request_new_urls",e.RECONNECT_CREATE_CONNECTION="websocket:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="websocket:on_token_privilege_did_expire",e.ON_FALLBACK="websocket:on_fallback",e}({});function zv(e){if(typeof e!="string"||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(e))throw S.error("Invalid Channel Name ".concat(e)),new se(P.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function qv(e){if(t=e,!(typeof t=="number"&&Math.floor(t)===t&&0<=t&&t<=4294967295||KM(e,1,255)))throw new se(P.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");var t;typeof e=="string"&&S.warn("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}let zc=function(e){return e.TRANSCODE="mix_streaming",e.RAW="raw_streaming",e}({});const Vle={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},QR={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function HR(e,t){Kr(e.url,"".concat(t,".url"),1,1e3,!1),kn(e.x)||sn(e.x,"".concat(t,".x"),0,1e4),kn(e.y)||sn(e.y,"".concat(t,".y"),0,1e4),kn(e.width)||sn(e.width,"".concat(t,".width"),0,1e4),kn(e.height)||sn(e.height,"".concat(t,".height"),0,1e4),kn(e.zOrder)||sn(e.zOrder,"".concat(t,".zOrder"),0,255),kn(e.alpha)||sn(e.alpha,"".concat(t,".alpha"),0,1,!1)}const Qle={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""};let Yl=function(e){return e.WARNING="@live_uap-warning",e.ERROR="@line_uap-error",e.PUBLISH_STREAM_STATUS="@live_uap-publish-status",e.WORKER_STATUS="@live_uap-worker-status",e.REQUEST_NEW_ADDRESS="@live_uap-request-address",e}({}),GR=function(e){return e.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager",e}({}),ur=function(e){return e[e.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",e[e.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",e[e.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",e[e.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",e[e.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",e[e.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",e[e.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",e[e.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",e[e.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",e[e.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",e[e.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",e[e.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",e[e.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",e[e.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",e[e.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",e[e.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN",e}({});function J4(e){if(!e.channelName)throw new se(P.INVALID_PARAMS,"invalid channelName in info");if(typeof e.uid!="number")throw new se(P.INVALID_PARAMS,"invalid uid in info, uid must be a number");return e.token&&Kr(e.token,"info.token",1,2047),qv(e.uid),zv(e.channelName),!0}let Zs=function(e){return e[e.SetSdkProfile=0]="SetSdkProfile",e[e.SetSourceChannel=1]="SetSourceChannel",e[e.SetSourceUserId=2]="SetSourceUserId",e[e.SetDestChannel=3]="SetDestChannel",e[e.StartPacketTransfer=4]="StartPacketTransfer",e[e.StopPacketTransfer=5]="StopPacketTransfer",e[e.UpdateDestChannel=6]="UpdateDestChannel",e[e.Reconnect=7]="Reconnect",e[e.SetVideoProfile=8]="SetVideoProfile",e}({}),qc=function(e){return e.NETWORK_DISCONNECTED="NETWORK_DISCONNECTED",e.NETWORK_CONNECTED="NETWORK_CONNECTED",e.PACKET_JOINED_SRC_CHANNEL="PACKET_JOINED_SRC_CHANNEL",e.PACKET_JOINED_DEST_CHANNEL="PACKET_JOINED_DEST_CHANNEL",e.PACKET_SENT_TO_DEST_CHANNEL="PACKET_SENT_TO_DEST_CHANNEL",e.PACKET_RECEIVED_VIDEO_FROM_SRC="PACKET_RECEIVED_VIDEO_FROM_SRC",e.PACKET_RECEIVED_AUDIO_FROM_SRC="PACKET_RECEIVED_AUDIO_FROM_SRC",e.PACKET_UPDATE_DEST_CHANNEL="PACKET_UPDATE_DEST_CHANNEL",e.PACKET_UPDATE_DEST_CHANNEL_REFUSED="PACKET_UPDATE_DEST_CHANNEL_REFUSED",e.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE",e}({}),hi=function(e){return e.RELAY_STATE_IDLE="RELAY_STATE_IDLE",e.RELAY_STATE_CONNECTING="RELAY_STATE_CONNECTING",e.RELAY_STATE_RUNNING="RELAY_STATE_RUNNING",e.RELAY_STATE_FAILURE="RELAY_STATE_FAILURE",e}({}),Hh=function(e){return e.RELAY_OK="RELAY_OK",e.SERVER_CONNECTION_LOST="SERVER_CONNECTION_LOST",e.SRC_TOKEN_EXPIRED="SRC_TOKEN_EXPIRED",e.DEST_TOKEN_EXPIRED="DEST_TOKEN_EXPIRED",e}({}),Xt=function(e){return e.High="high",e.Low="low",e.Audio="audio",e.Screen="screen",e.ScreenLow="screen_low",e}({}),Gn=function(e){return e.DISCONNECT="disconnect",e.CONNECTION_STATE_CHANGE="connection-state-change",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGE="stream-type-change",e.IS_P2P_DISCONNECTED="is-p2p-dis",e.DISCONNECT_P2P="dis-p2p",e.REQUEST_NEW_GATEWAY_LIST="req-gate-url",e.NEED_RENEW_SESSION="need-sid",e.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",e.JOIN_RESPONSE="join-response",e.RESET_CONNECTION_EVENTS="reset-connection-events",e.PRE_CONNECT_PC="pre-connect_pc",e.UPDATE_GATEWAY_CONFIG="update-gateway-config",e.VOS_FALLBACK="vos-fallback",e.VOS_FALLBACK_PROMISE="vos-fallback-promise",e.RESET_SIGNAL="reset-signal",e.DATACHANNEL_FAILBACK="datachannel-failback",e}({}),Xv=function(e){return e.P2P_DISCONNECTED="P2P_DISCONNECTED",e.A_ROUND_WS_FAILED="A_ROUND_WS_FAILED",e.TIMEOUT="TIMEOUT",e.UNKNOWN_REASON="UNKNOWN_REASON",e}({}),Tr=function(e){return e[e.Nothing=0]="Nothing",e[e.Audio=1]="Audio",e[e.LwoVideo=2]="LwoVideo",e[e.Video=4]="Video",e[e.Data=8]="Data",e[e.DataStream0=256]="DataStream0",e[e.DataStream1=512]="DataStream1",e[e.DataStream2=1024]="DataStream2",e[e.DataStream3=2048]="DataStream3",e[e.DataStream4=4096]="DataStream4",e[e.DataStream5=8192]="DataStream5",e[e.DataStream6=16384]="DataStream6",e[e.DataStream7=32768]="DataStream7",e}({}),Ht=function(e){return e.CHINA="CHINA",e.ASIA="ASIA",e.NORTH_AMERICA="NORTH_AMERICA",e.EUROPE="EUROPE",e.JAPAN="JAPAN",e.INDIA="INDIA",e.KOREA="KOREA",e.HKMC="HKMC",e.US="US",e.OCEANIA="OCEANIA",e.SOUTH_AMERICA="SOUTH_AMERICA",e.AFRICA="AFRICA",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="EXTENSIONS",e}({});const $4=[Ht.AFRICA,Ht.ASIA,Ht.CHINA,Ht.EUROPE,Ht.GLOBAL,Ht.INDIA,Ht.JAPAN,Ht.NORTH_AMERICA,Ht.OCEANIA,Ht.OVERSEA,Ht.SOUTH_AMERICA];let as=function(e){return e.CHINA="CN",e.ASIA="AS",e.NORTH_AMERICA="NA",e.EUROPE="EU",e.JAPAN="JP",e.INDIA="IN",e.KOREA="KR",e.HKMC="HK",e.US="US",e.OCEANIA="OC",e.SOUTH_AMERICA="SA",e.AFRICA="AF",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="GLOBAL",e}({});const Jv={CHINA:{},ASIA:{CODE:as.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:as.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:as.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:as.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","uap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:as.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:as.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},HKMC:{CODE:as.HKMC,WEBCS_DOMAIN:["ap-web-1-hkmc.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-hkmc.agora.io"],PROXY_CS:["proxy-ap-web-hkmc.agora.io"],CDS_AP:["cds-ap-web-hkmc.agora.io","cds-ap-web-hkmc2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-hkmc.agora.io","sua-ap-web-hkmc2.agora.io"],UAP_AP:["uap-ap-web-hkmc.agora.io","uap-ap-web-hkmc2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-hkmc.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-hkmc.agora.io"],LOG_UPLOAD_SERVER:["logservice-hkmc.agora.io"],PROXY_SERVER_TYPE3:["hkmc.webrtc-cloud-proxy.sd-rtn.com"]},US:{CODE:as.US,WEBCS_DOMAIN:["ap-web-1-us.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-us.agora.io"],PROXY_CS:["proxy-ap-web-us.agora.io"],CDS_AP:["cds-ap-web-us.agora.io","cds-ap-web-us2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-us.agora.io","sua-ap-web-us2.agora.io"],UAP_AP:["uap-ap-web-us.agora.io","uap-ap-web-us2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-us.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-us.agora.io"],LOG_UPLOAD_SERVER:["logservice-us.agora.io"],PROXY_SERVER_TYPE3:["us.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:as.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:as.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:as.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:as.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:as.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]},EXTENSIONS:{}};aR&&(Jv.CHINA={CODE:as.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]});let Lo=function(e){return e.UPDATE_BITRATE_LIMIT="update_bitrate_limit",e.UPDATE_CLIENT_ROLE_OPTIONS="update_client_role_options",e.UPDATE_REMOTE_VIDEO_STREAM_TYPE="update_remote_video_stream_type",e.FALLBACK_TO_HLS="fallback_to_hls",e.UPDATE_VOS_CONFIGURE="update_vos_configure",e}({});function Z4(e){return!!e&&!(!e.uplink||!e.id)&&e.uplink.max_bitrate!==void 0&&e.uplink.min_bitrate!==void 0}class eV extends Tn{constructor(t,n){super(),x(this,"onICEConnectionStateChange",void 0),x(this,"onConnectionStateChange",void 0),x(this,"onDTLSTransportStateChange",void 0),x(this,"onDTLSTransportError",void 0),x(this,"onICETransportStateChange",void 0),x(this,"onFirstAudioReceived",void 0),x(this,"onFirstVideoReceived",void 0),x(this,"onFirstAudioDecoded",void 0),x(this,"onFirstVideoDecoded",void 0),x(this,"onFirstVideoRender",void 0),x(this,"onFirstVideoBufferReady",void 0),x(this,"onFirstVideoDecodedTimeout",void 0),x(this,"onSelectedLocalCandidateChanged",void 0),x(this,"onSelectedRemoteCandidateChanged",void 0),x(this,"onICECandidateError",void 0),x(this,"getLocalVideoStats",void 0)}}class $v extends eV{constructor(t,n){super(t,n),x(this,"establishPromise",void 0)}}let xe=function(e){return e.VIDEO="video",e.AUDIO="audio",e}({}),Ur=function(e){return e.UDP_RELAY="udp_relay",e.UDP_TCP_RELAY="udp_tcp_relay",e.TCP_RELAY="tcp_relay",e.RELAY="relay",e}({}),Xc=function(e){return e[e.FIRST_CONNECTION=0]="FIRST_CONNECTION",e[e.UDP_TCP_RESTART=1]="UDP_TCP_RESTART",e[e.RELAY_RESTART=2]="RELAY_RESTART",e[e.TCP_RESTART=3]="TCP_RESTART",e[e.OLD_FIRST_CONNECTION=10]="OLD_FIRST_CONNECTION",e[e.OLD_RESTART=11]="OLD_RESTART",e[e.DISCONNECTED_OR_FAILED=20]="DISCONNECTED_OR_FAILED",e}({});const tV=["disconnected","failed"];let ge=function(e){return e.LocalVideoTrack="videoTrack",e.LocalAudioTrack="audioTrack",e.LocalVideoLowTrack="videoLowTrack",e}({}),Kt=function(e){return e.New="new",e.Connected="connected",e.Reconnecting="reconnecting",e.Disconnected="disconnected",e}({}),Ve=function(e){return e.AudioMetadata="audioMetadata",e.AudioPts="audioPts",e.StateChange="stateChange",e.IceConnectionStateChange="iceConnectionStateChange",e.RequestMuteLocal="requestMuteLocal",e.RequestUnmuteLocal="requestUnmuteLocal",e.RequestRePublish="requestRePublish",e.RequestRePublishDataChannel="requestRePublishDataChannel",e.RequestReSubscribe="requestReSubscribe",e.RequestUploadStats="requestUploadStats",e.RequestUpload="requestUpload",e.MediaReconnectStart="MediaReconnectStart",e.MediaReconnectEnd="MediaReconnectEnd",e.NeedSignalRTT="NeedSignalRTT",e.RequestRestartICE="RequestRestartIce",e.PeerConnectionStateChange="PeerConnectionStateChange",e.RequestReconnect="RequestReconnect",e.RequestReconnectPC="RequestReconnectPC",e.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",e.P2PLost="P2PLost",e.UpdateVideoEncoder="UpdateVideoEncoder",e.ConnectionTypeChange="ConnectionTypeChange",e.RequestLowStreamParameter="RequestLowStreamParameter",e.QueryClientConnectionState="QueryClientConnectionState",e.LocalCandidate="LocalCandidate",e.RequestP2PMuteLocal="requestP2PMuteLocal",e.RequestP2PUnPublish="RequestP2PUnPublish",e.RequestP2PUnmuteRemote="RequestP2PUnmuteRemote",e.RequestP2PMuteRemote="RequestP2PMuteRemote",e.RequestP2PRestartICE="RequestP2PRestartICE",e.FirstVideoPreRender="FirstVideoPreRender",e.FirstVideoBufferReady="FirstVideoBufferReady",e}({}),Za=function(e){return e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED",e}({}),eo=function(e){return e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED",e}({}),Pr=function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url",e}({}),zl=function(e){return e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.MULTI_IP="MULTI_IP",e.TIMEOUT="TIMEOUT",e.OFFLINE="OFFLINE",e.LEAVE="LEAVE",e.P2P_FAILED="P2P_FAILED",e.FALLBACK="FALLBACK",e}({}),hr=function(e){return e.CONNECTED="transmitter:connected",e.RECONNECTING="transmitter:reconnecting",e.WILL_RECONNECT="transmitter:will_reconnect",e.CLOSED="transmitter:closed",e.FAILED="transmitter:failed",e.ON_MESSAGE="transmitter:on_message",e.REQUEST_NEW_URLS="transmitter:request_new_urls",e.RECONNECT_CREATE_CONNECTION="transmitter:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="transmitter:on_token_privilege_did_expire",e.TO_CONNECT_DATACHANNEL="transmitter:to_connect_datachannel",e.FAILBACK="transmitter:failback",e.PRE_CONNECT_PC="transmitter:pre_connect_pc",e}({}),mc=function(e){return e.CAMERA_CHANGED="camera-changed",e.MICROPHONE_CHANGED="microphone-changed",e.PLAYBACK_DEVICE_CHANGED="playback-device-changed",e.AUDIO_AUTOPLAY_FAILED="audio-autoplay-failed",e.AUTOPLAY_FAILED="autoplay-failed",e.AUDIO_CONTEXT_STATE_CHANGED="audio-context-state-changed",e.SECURITY_POLICY_VIOLATION="security-policy-violation",e}({}),fa=function(e){return e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED",e}({}),Uo=function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url",e}({}),Gh=function(e){return e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED",e}({}),Kn=function(e){return e.CALL="call",e.CANDIDATE="candidate",e.PUBLISH="publish",e.UNPUBLISH="unpublish",e.CONTROL="control",e.RESTART_ICE="restart_ice",e.ACK="ack",e.RESPONSE="response",e.JOIN="join",e.CHECK="check",e}({}),Kh=function(e){return e.ABORT="abort",e}({}),ql=function(e){return e.MUTE_LOCAL_AUDIO="mute_local_audio",e.MUTE_LOCAL_VIDEO="mute_local_video",e.UNMUTE_LOCAL_AUDIO="unmute_local_audio",e.UNMUTE_LOCAL_VIDEO="unmute_local_video",e}({}),Hle=function(e){return e.P2P_TOKEN_TIMEOUT="p2p_token_timeout",e.P2P_TOKEN_CHANGED="p2p_token_changed",e}({});const Gle={[Yv.ACCESS_POINT]:{[Fs.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[Fs.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[Fs.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[Fs.FLAG_SET_BUT_NO_RE]:{desc:"flag set unilbs but no request",retry:!1},[Fs.INVALID_SERVICE_ID]:{desc:"invalid service id",retry:!1},[Fs.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[Fs.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[Fs.NO_SERVICE_AVAILABLE_VOICE]:{desc:"no unilbs voice service available",retry:!0},[Fs.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[Fs.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[Fs.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[Fs.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[Fs.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[Fs.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[Fs.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[Fs.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[Fs.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[Fs.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[Yv.UNILBS]:{[pa.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[pa.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[pa.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[pa.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[pa.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[pa.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[pa.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[pa.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[pa.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[pa.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[pa.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[pa.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1},[pa.REQ_DOWNGRADE_FALLBACK]:{desc:"request downgrade fallback",retry:!1}},[Yv.STRING_UID_ALLOCATOR]:{[VR.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[VR.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[VR.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}};function Wh(e){const t=Gle[Math.floor(e/1e4)];if(!t)return{desc:"unknown error",retry:!1};const n=t[e%1e4];if(!n){if(Math.floor(e/1e4)===Yv.ACCESS_POINT){const i=e%1e4;if(i.toString()[0]==="1")return{desc:e.toString(),retry:!1};if(i.toString()[0]==="2")return{desc:e.toString(),retry:!0}}return{desc:"unknown error",retry:!1}}return n}const Kle={[Ke.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[Ke.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[Ke.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[Ke.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[Ke.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[Ke.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[Ke.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[Ke.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[Ke.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[Ke.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[Ke.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[Ke.DATASTREAM2_NOT_AVAILABLE]:{desc:"DATASTREAM2_NOT_AVAILABLE",action:"quit"},[Ke.K_AUTO_REBALANCE]:{desc:"k_AUTO_REBALANCE",action:"recover"},[Ke.K_VOS_FALLBACK]:{desc:"K_VOS_FALLBACK",action:"tryNext"},[Ke.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[Ke.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[Ke.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[Ke.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[Ke.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[Ke.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[Ke.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[Ke.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[Ke.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[Ke.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[Ke.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[Ke.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[Ke.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[Ke.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[Ke.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[Ke.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[Ke.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[Ke.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[Ke.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[Ke.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[Ke.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[Ke.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[Ke.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[Ke.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[Ke.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[Ke.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[Ke.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[Ke.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[Ke.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[Ke.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[Ke.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[Ke.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[Ke.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[Ke.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[Ke.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[Ke.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[Ke.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[Ke.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[Ke.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[Ke.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[Ke.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[Ke.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[Ke.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"},[Ke.ERR_TOO_MANY_BROADCASTERS]:{desc:"ERR_TOO_MANY_BROADCASTERS",action:"failed"},[Ke.ERR_TOO_MANY_SUBSCRIBERS]:{desc:"ERR_TOO_MANY_SUBSCRIBERS",action:"failed"},[Ke.ERR_LICENSE_ILLEGAL]:{desc:"ERR_LICENSE_ILLEGAL",action:"quit"},[Ke.ERR_LICENSE_MISSING]:{desc:"ERR_LICENSE_MISSING",action:"quit"},[Ke.ERR_LICENSE_EXPIRED]:{desc:"ERR_LICENSE_EXPIRED",action:"quit"},[Ke.ERR_LICENSE_MINUTES_EXCEEDED]:{desc:"ERR_LICENSE_MINUTES_EXCEEDED",action:"quit"},[Ke.ERR_LICENSE_PERIOD_INVALID]:{desc:"ERR_LICENSE_PERIOD_INVALID",action:"quit"},[Ke.ERR_LICENSE_MULTIPLE_SDK_SERVICE]:{desc:"ERR_LICENSE_MULTIPLE_SDK_SERVICE",action:"quit"}};function Md(e){return Kle[e]||{desc:"UNKNOWN_ERROR_".concat(e),action:"failed"}}function nV(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}function KR(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?nV(Object(n),!0).forEach(function(i){x(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):nV(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}function WR(e,t){if(typeof e=="string")return e;const{proxy:n,host:i,port:o}=e;if(t){const l=L("JOIN_GATEWAY_FALLBACK_PORT")||443;return l===443?"wss://".concat(i,"/ws/?p=").concat(Number(o)+150):"wss://".concat(i,":").concat(l,"/ws/?p=").concat(Number(o)+150)}return n?"wss://".concat(n,"/ws/?h=").concat(i,"&p=").concat(o):"wss://".concat(i,":").concat(o)}const Wle=/wss:\/\/(.+)\/ws\/\?h=(.+)&p=([0-9]+)\/?/,Yle=/wss:\/\/(.+)\/ws\/\?p=([0-9]+)\/?/,zle=/wss:\/\/(.+):([0-9]+)\/?/,qle=/wss:\/\/(.[^\/]+)\/?/;let Xle=0;class Jle{constructor(t,n){x(this,"id",0),x(this,"store",void 0),x(this,"recordIndex",void 0),x(this,"websockets",[]),x(this,"try443PortDuration",2e3),x(this,"forceCloseWSDuration",5e3),x(this,"try443PortTimeout",null),x(this,"forceCloseTimeout",null),x(this,"isTry443PortFailed",!1),x(this,"isNormalPortFailed",!1),x(this,"useDoubleDomain",!1),x(this,"useProxy",!1),x(this,"startTime",Date.now()),this.id=++Xle,this.try443PortDuration=L("JOIN_GATEWAY_TRY_443PORT_DURATION")||2e3,this.forceCloseWSDuration=t||5e3,this.store=n}closeAllWebsockets(){this.websockets.forEach(t=>{t.onopen=null,t.onclose=null,t.onmessage=null,t.close()}),this.websockets.length=0}clearTimeout(){this.forceCloseTimeout&&clearTimeout(this.forceCloseTimeout),this.try443PortTimeout&&clearTimeout(this.try443PortTimeout),this.forceCloseTimeout=null,this.try443PortTimeout=null}logger(){var t;const n=Date.now()-this.startTime;for(var i=arguments.length,o=new Array(i),l=0;l<i;l++)o[l]=arguments[l];S.debug("[choose-best-ws ".concat((t=this.store)===null||t===void 0?void 0:t.clientId," ").concat(this.id,"] ").concat(n,"ms:"),...o)}createWebSocket(t,n,i){this.logger("createWebSocket:",t,{isTry443Port:n,hasTimeoutDetection:i});const o=L("GATEWAY_DOMAINS"),l=Date.now(),d=[],h=o.find(y=>{var b;return me(b=t.host).call(b,y)});h||(this.useDoubleDomain=!1);const f=[];if(this.useDoubleDomain)o.forEach(y=>{f.push(WR(KR(KR({},t),{},{host:t.host.replace(h,y)}),n))});else{const y=KR({},t);if(n&&h){const b=o.find(D=>D!==h);b&&(y.host=y.host.replace(h,b))}f.push(WR(y,n))}try{f.forEach(y=>{const b=new WebSocket(y);b.binaryType="arraybuffer",d.push(b),this.logger("ws is connecting:",b.url)})}catch(y){if(this.logger("ws create failed"),d.forEach(b=>b.close()),d.length=0,this.useDoubleDomain)return this.useDoubleDomain=!1,this.createWebSocket(t,n,i);if(!n&&Number(t.port)!==443)return this.createWebSocket(t,!0,i);throw new se(P.WS_ERR,"init websocket failed! Error: ".concat(y.toString()))}const g=fm();this.store&&this.store.recordJoinChannelService({urls:d.map(y=>y.url),service:"gateway"},this.recordIndex),d.forEach(y=>{y.onopen=()=>{this.logger("onopen: ws ".concat(y.url," open cost ").concat(Date.now()-l,"ms")),this.websockets.forEach(b=>{b!==y&&(b.onopen=null,b.onclose=null,b.onmessage=null,b.close(),this.logger("close backup websocket: ".concat(b.url)))}),this.websockets.length=0,g.resolve(y)},y.onclose=b=>{this.logger("onclose: ws ".concat(y.url," closed cost ").concat(Date.now()-l,"ms state: ").concat(y.readyState));const D=d.every(I=>I.readyState===WebSocket.CLOSED||I.readyState===WebSocket.CLOSING);this.logger("".concat(n?"443":"47xx"," websocket closed, all failed: ").concat(D)),D&&(n||this.isTry443PortFailed||this.useProxy)?(this.logger("onclose: all websocket is closed, ".concat(b.reason)),g.reject({code:b.code,reason:Xv.A_ROUND_WS_FAILED})):!n&&D&&!this.isNormalPortFailed&&this.try443PortTimeout&&(this.logger("all 47xx websocket is closed, try 443 port"),this.clearTimeout(),v()),n?this.isTry443PortFailed=D:this.isNormalPortFailed=D},y.onmessage=b=>this.logger("".concat(y.url," onmessage: ").concat(b.data))}),this.websockets.push(...d);const _=()=>{this.websockets.forEach(y=>y.readyState!==WebSocket.OPEN&&y.close())},v=()=>{if(g.isResolved)return _();Lt().os===br.MAC_OS&&gn()&&_(),this.createWebSocket(t,!0,!0).then(y=>{g.resolve(y)}).catch(y=>{this.isNormalPortFailed&&g.reject(y),this.logger("try 443 port to create ws failed")}),this.forceCloseTimeout=window.setTimeout(()=>{this.logger("5s timeout close un-opens, isWebsocket created: ",g.isResolved),this.forceCloseTimeout=null,_()},this.forceCloseWSDuration)};return i||(()=>{if(n||this.useProxy)return this.logger("add 5s timeout at ".concat(n?"try-443":"proxy"," condition")),this.forceCloseTimeout=window.setTimeout(()=>{this.forceCloseTimeout=null,_()},this.forceCloseWSDuration);this.try443PortTimeout=window.setTimeout(()=>{this.logger("2s timeout, isWebsocket created: ",g.isResolved),this.try443PortTimeout=null,v()},this.try443PortDuration)})(),g.promise}chooseBestWebsocket(t,n,i,o){return this.useDoubleDomain=!!n,typeof t=="string"&&(t=function(l){let d,h,f;return[,d,h,f]=l.match(Wle)||[],d||([,h,f]=l.match(Yle)||[]),h&&f||([,h,f]=l.match(zle)||[]),h&&f||([,h]=l.match(qle)||[]),h||S.warning("un-destructible url: ",l),{proxy:d,host:h,port:f||"443"}}(t)),this.recordIndex=o,this.useProxy=!!t.proxy,i&&this.useProxy&&(S.warn("cannot use 443 only when use proxy"),i=!1),this.createWebSocket(t,!!i,!1).finally(()=>this.clearTimeout())}}function rV(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}class sV extends Tn{get url(){return this.websocket&&this.websocket.url||this._websocketUrl}get reconnectMode(){return this._reconnectMode}set reconnectMode(t){var n;me(n=["tryNext","recover"]).call(n,t)&&this.resetReconnectCount(t),this._reconnectMode=t}get state(){return this._state}set state(t){t!==this._state&&(this._state=t,this._state==="reconnecting"?this.emit(lt.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(lt.CONNECTED):this._state==="closed"?this.emit(lt.CLOSED):this._state==="failed"&&this.emit(lt.FAILED))}resetReconnectCount(t){S.debug("websocket reset reconnect count, reason: "+t),this.reconnectCount=0}constructor(t,n){let i=arguments.length>2&&arguments[2]!==void 0&&arguments[2],o=arguments.length>3&&arguments[3]!==void 0&&arguments[3],l=arguments.length>4&&arguments[4]!==void 0&&arguments[4],d=arguments.length>5?arguments[5]:void 0;super(),x(this,"_websocketUrl",null),x(this,"connectionID",0),x(this,"currentURLIndex",0),x(this,"urls",[]),x(this,"_reconnectMode","tryNext"),x(this,"reconnectReason",void 0),x(this,"_initMutex",void 0),x(this,"name",void 0),x(this,"_state","closed"),x(this,"reconnectInterrupter",void 0),x(this,"websocket",void 0),x(this,"retryConfig",void 0),x(this,"reconnectCount",0),x(this,"forceCloseTimeout",5e3),x(this,"onlineReconnectListener",void 0),x(this,"useCompress",void 0),x(this,"tryDoubleDomain",!1),x(this,"use443PortOnly",!1),x(this,"wsInflateLength",0),x(this,"wsDeflateLength",0),x(this,"closeEstablishingWs",()=>{}),x(this,"store",void 0),x(this,"joinGatewayRecordIndex",void 0),this.store=d,this.name=t,this.retryConfig=function(v){for(var y=1;y<arguments.length;y++){var b=arguments[y]!=null?arguments[y]:{};y%2?rV(Object(b),!0).forEach(function(D){x(v,D,b[D])}):Object.getOwnPropertyDescriptors?Object.defineProperties(v,Object.getOwnPropertyDescriptors(b)):rV(Object(b)).forEach(function(D){Object.defineProperty(v,D,Object.getOwnPropertyDescriptor(b,D))})}return v}({},n),this.useCompress=i,this.tryDoubleDomain=o,this.use443PortOnly=l,this._initMutex=new Lr("websocket",d?d.clientId:void 0);const{timeout:h,timeoutFactor:f}=n,g=Math.max(300,Math.floor(3*h/5)),_=Math.max(1.2,Math.floor(8*f)/10);Us.ONLINE&&(this.retryConfig.timeout=g,this.retryConfig.timeoutFactor=_),Ln.on(wd.NETWORK_STATE_CHANGE,(v,y)=>{v!==y&&(this.resetReconnectCount("network state change: ".concat(y," -> ").concat(v)),v===Us.ONLINE?(this.retryConfig.timeout=g,this.retryConfig.timeoutFactor=_):(this.retryConfig.timeout=h,this.retryConfig.timeoutFactor=f))})}getConnection(){return this.websocket||void 0}async init(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const i=await this._initMutex.lock();this._reconnectMode="tryNext",this.forceCloseTimeout=n,this.urls=t,this.state="connecting";try{var o;const l=fm(),d=this.urls[this.currentURLIndex];(o=this.store)===null||o===void 0||o.beforeConnect(),function(h){return!(Ov()||L("USE_NEW_TOKEN")||!L("ENABLE_PREALLOC_PC")&&(h==null||!h.autoSubscribe||L("FORCE_DISABLE_AUTO_SUB")))}(this.store)&&this.emit(hr.PRE_CONNECT_PC),this.createWebSocketConnection(d).then(l.resolve).catch(l.reject),this.once(lt.CLOSED,()=>{l.reject(new ae(P.WS_DISCONNECT))}),this.once(lt.CONNECTED,l.resolve),await l.promise}catch{}finally{i()}}close(t,n){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this.reconnectInterrupter&&this.reconnectInterrupter(),this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;const i=this.websocket;n?setTimeout(()=>i.close(),500):i.close(),this.websocket=void 0,this._websocketUrl=null}this.state=t?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}reconnect(t,n){if(!this.websocket)return void S.warning("[".concat(this.name,"] can not reconnect, no websocket"));t!==void 0&&(this.reconnectMode=t),S.debug("[".concat(this.name,"] reconnect is triggered initiative")),typeof this.joinGatewayRecordIndex=="number"&&this.store&&this.store.recordJoinChannelService({status:"error",errors:[new Error(n)]},this.joinGatewayRecordIndex);const i=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),i&&i.bind(this.websocket)({code:9999,reason:n})}sendMessage(t){let n=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new ae(P.WS_ABORT,"websocket is not ready");try{n||(t=JSON.stringify(t)),this.websocket.send(t)}catch(i){throw new ae(P.WS_ERR,"send websocket message error"+i.toString())}}setWsInflateData(t){this.wsDeflateLength=this.wsDeflateLength+t.originLength,this.wsInflateLength=this.wsInflateLength+t.compressedLength}getWsInflateData(){const t=this.wsInflateLength,n=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:t,wsDeflateLength:n}}clearWsInflateData(){this.wsInflateLength=0,this.wsDeflateLength=0}async createWebSocketConnection(t){var n;const i=fm();this.connectionID+=1,this.joinGatewayRecordIndex=void 0;const o=_=>{var v;(v=this.store)===null||v===void 0||v.signalChannelOpen(),S.debug("[".concat(this.name,"] websocket opened:"),_),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),i.resolve()},l=async _=>{var v;if(S.debug("[".concat(this.name,"] websocket close ").concat((v=this.websocket)===null||v===void 0?void 0:v.url,", code: ").concat(_.code,", reason: ").concat(_.reason,", current mode: ").concat(this.reconnectMode)),this.reconnectCount>=this.retryConfig.maxRetryCount)i.reject(new ae(P.WS_DISCONNECT,"websocket close: ".concat(_.code))),this.close();else{this.state==="connected"&&(this.reconnectReason=_.reason,this.state="reconnecting");const y=Ni(this,lt.WILL_RECONNECT,this.reconnectMode,_.reason)||this.reconnectMode,b=await this.reconnectWithAction(y);if(this.state==="closed")return void S.debug("[".concat(this.connectionID,"] ws is closed, no need to reconnect"));if(!b)return i.reject(new ae(P.WS_DISCONNECT,"websocket reconnect failed: ".concat(_.code))),this.close(!0);i.resolve()}},d=_=>{this.emit(lt.ON_MESSAGE,_)},h=_=>{S.warn("[".concat(this.connectionID,"] ws open error ").concat(_))};this.websocket&&(this.websocket.onclose=null,this.websocket.close()),L("GATEWAY_WSS_ADDRESS")&&this.name.startsWith("gateway")&&(t=L("GATEWAY_WSS_ADDRESS")),S.debug("[".concat(this.name,"] start connect, url:"),t);const f=(n=this.store)===null||n===void 0?void 0:n.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"});try{var g;this._websocketUrl=WR(t);const _=await this.chooseBestWebsocketConnection(t);this.websocket=_,o&&o(this.websocket.url),this.websocket.onclose=l,this.websocket.onmessage=d,this.websocket.onerror=h,(g=this.store)===null||g===void 0||g.recordJoinChannelService({endTs:Date.now(),status:"success"},f),this.joinGatewayRecordIndex=f}catch(_){const v=this.state==="closed",y=_ instanceof ae,b=y&&_.code===P.WS_ABORT,D=y&&_.code===P.WS_ERR,I=y?_.message:_&&(_.reason||_.toString());S.warning("[choose-best-ws] chooseBestWebsocket error: ".concat(I)),this.store&&this.store.recordJoinChannelService({endTs:Date.now(),status:b?"aborted":"error",errors:[_]},f),v||D?(i.reject(v?new ae(P.WS_DISCONNECT,"websocket is closed: ".concat(I)):new ae(P.WS_ERR,"init websocket failed: ".concat(I))),D&&S.error("[".concat(this.name,"] init websocket failed: ").concat(I))):l&&l(_)}return i.promise}async reconnectWithAction(t){let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this.reconnectCount>=this.retryConfig.maxRetryCount||this.urls.length===0||this.state==="closed")return!1;S.warning("[choose-best-ws] action: =>",t),this.onlineReconnectListener||Ln.isOnline||!Ln.onlineWaiter||(this.onlineReconnectListener=Ln.onlineWaiter.then(()=>{this.onlineReconnectListener=void 0}));let i=!0;if(this.reconnectInterrupter=()=>i=!1,n){const d=wv(this.reconnectCount,this.retryConfig);S.debug("[".concat(this.name,"] wait ").concat(d,"ms to reconnect websocket, mode: ").concat(t)),await be.race([Sr(d),this.onlineReconnectListener||new be(()=>{})])}if(this._state==="closed"||!i)return!1;this.reconnectCount+=1;const o=async(d,h)=>{this.emit(lt.RECONNECT_CREATE_CONNECTION,h),await this.createWebSocketConnection(d)};try{if(t==="retry")await o(this.urls[this.currentURLIndex],t);else if(t==="tryNext"){if(this.currentURLIndex+=1,this.currentURLIndex>=this.urls.length)return this.reconnectWithAction("recover",!1);S.debug("[".concat(this.name,"] websocket url length: ").concat(this.urls.length," current index: ").concat(this.currentURLIndex)),await o(this.urls[this.currentURLIndex],t)}else t==="recover"&&(S.debug("[".concat(this.name,"] request new urls")),this.resetReconnectCount("recover mode"),this.urls=await ir(this,lt.REQUEST_NEW_URLS),this.currentURLIndex=0,await o(this.urls[this.currentURLIndex],t))}catch(d){var l;S.error("[".concat(this.name,"] reconnect failed ").concat(d&&d.toString()));const h=d==null||(l=d.data)===null||l===void 0?void 0:l.desc;if(Array.isArray(h)){if(me(h).call(h,"dynamic key expired"))return this.emit(lt.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1;if(me(h).call(h,"request downgrade fallback"))return this.emit(lt.ON_FALLBACK),!1}return this.reconnectWithAction(t,n)}return!0}}class YR extends sV{constructor(t,n){super(t,n,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(t,n){const i=fm(),o=function(d,h){return new Jle(d,h)}(this.forceCloseTimeout,this.store);this.closeEstablishingWs=()=>{S.debug("[choose-best-ws] close establishing websockets"),o.closeAllWebsockets(),i.reject(new ae(P.WS_ABORT,"choose best websocket aborted"))};const l=L("GATEWAY_DOMAINS");return S.debug("[choose-best-ws] currentDomain: ",t,", domains: ",l,"total: ".concat(this.urls.length),"current: ".concat(this.currentURLIndex+1)),o.chooseBestWebsocket(t,this.tryDoubleDomain,this.use443PortOnly,n).then(i.resolve).catch(i.reject),i.promise.finally(()=>{this.closeEstablishingWs=void 0})}}class Im extends sV{constructor(t,n){super(t,n,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(t,n){return new be((i,o)=>{let l=!1;const d=[];this.closeEstablishingWs=()=>{S.debug("[choose-best-ws] close establishing websockets"),d.forEach(D=>{D.onclose=null,D.onopen=null,D.onmessage=null,D.close()}),o(new ae(P.WS_ABORT,"choose best websocket aborted"))};const h=L("GATEWAY_DOMAINS");let f;const g=t.indexOf("?h="),_=h.find(D=>g!==-1?me(t).call(t,D,g):me(t).call(t,D));S.debug("[choose-best-ws] currentDomain: ",_,", domains: ",h);let v=!this.tryDoubleDomain||!_;if(!v&&_){var y;const D=Date.now();try{h.forEach(I=>{const O=g===-1?t.replace(_,I):t.substr(0,g)+t.substr(g).replace(_,I),U=new WebSocket(O);U.binaryType="arraybuffer",d.push(U),S.debug("[choose-best-ws] ws is connecting:",U.url)})}catch{for(S.debug("[choose-best-ws] ws create failed, fallback to single url"),d.forEach(O=>O.close());d.length;)d.pop();v=!0}(y=this.store)===null||y===void 0||y.recordJoinChannelService({urls:d.map(I=>I.url),service:"gateway"},n),d.forEach(I=>{I.onopen=()=>{if(l)return;const O=Date.now()-D;S.debug("[choose-best-ws] ws open cost ".concat(O,"ms")),d.filter(U=>U!==I).forEach(U=>{S.debug("[choose-best-ws]close backup websocket: ".concat(U.url)),U.close()}),l=!0,i(I)},I.onclose=O=>{f=O,!l&&(d.find(U=>!(U.readyState===WebSocket.CLOSED||U.readyState===WebSocket.CLOSING))||(S.debug("[choose-best-ws] all websocket is closed"),l=!0,o(f)))},I.onmessage=O=>{S.debug("[choose-best-ws]".concat(I.url," onmessage: ").concat(O.data))}}),Sr(this.forceCloseTimeout).then(()=>{d.forEach(I=>{I.readyState!==WebSocket.OPEN&&I.close()})})}if(v){var b;let D;S.debug("[choose-best-ws] use single url: ",t),(b=this.store)===null||b===void 0||b.recordJoinChannelService({urls:[t],service:"gateway"},n);try{D=new WebSocket(t),d.push(D),D.binaryType="arraybuffer"}catch(I){const O=new ae(P.WS_ERR,"init websocket failed! Error: ".concat(I.toString()));return S.error("[".concat(this.name,"]").concat(O)),void o(O)}D.onopen=()=>{i(D)},D.onclose=I=>{o(I)},D.onmessage=I=>{S.debug("[choose-best-ws]".concat(D.url," onmessage: ").concat(I.data))},Sr(this.forceCloseTimeout).then(()=>{D&&D.readyState!==WebSocket.OPEN&&D.close()})}}).then(i=>(this.closeEstablishingWs=void 0,i)).catch(i=>{throw this.closeEstablishingWs=void 0,i})}}class iV extends Tn{get connectionState(){return this._connectionState}set connectionState(t){t!==this._connectionState&&(this._connectionState=t,t===Tt.CONNECTED?this.emit(Ue.WS_CONNECTED):t===Tt.RECONNECTING?this.emit(Ue.WS_RECONNECTING,this._websocketReconnectReason):t===Tt.CLOSED&&this.emit(Ue.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(t,n){super(),x(this,"__name__","AgoraRTCSignal"),x(this,"_disconnectedReason",void 0),x(this,"_websocketReconnectReason",void 0),x(this,"_connectionState",Tt.CLOSED),x(this,"reconnectToken",void 0),x(this,"websocket",void 0),x(this,"openConnectionTime",void 0),x(this,"clientId",void 0),x(this,"lastMsgTime",Date.now()),x(this,"uploadCache",[]),x(this,"uploadCacheInterval",void 0),x(this,"rttRolling",new ZT(5)),x(this,"pingpongTimer",void 0),x(this,"wsInflateDataTimer",void 0),x(this,"pingpongTimeoutCount",0),x(this,"ortc",void 0),x(this,"joinResponse",void 0),x(this,"multiIpOption",void 0),x(this,"initError",void 0),x(this,"spec",void 0),x(this,"store",void 0),x(this,"onWebsocketMessage",i=>{if(i.data instanceof ArrayBuffer)return void this.emit(Ue.ON_BINARY_DATA,i.data);const o=JSON.parse(i.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(o,"_id")){const l="res-@".concat(o._id);this.emit(l,o._result,o._message)}else if(Object.prototype.hasOwnProperty.call(o,"_type")){if(this.emit(o._type,o._message),o._type===nt.ON_NOTIFICATION&&this.handleNotification(o._message),o._type===nt.ON_USER_BANNED)switch(o._message.error_code){case 14:this.close(Ct.UID_BANNED);break;case 15:this.close(Ct.IP_BANNED);break;case 16:this.close(Ct.CHANNEL_BANNED)}if(o._type===nt.ON_USER_LICENSE_BANNED)switch(o._message.error_code){case Ke.ERR_LICENSE_MISSING:this.close(Ct.LICENSE_MISSING);break;case Ke.ERR_LICENSE_EXPIRED:this.close(Ct.LICENSE_EXPIRED);break;case Ke.ERR_LICENSE_MINUTES_EXCEEDED:this.close(Ct.LICENSE_MINUTES_EXCEEDED);break;case Ke.ERR_LICENSE_PERIOD_INVALID:this.close(Ct.LICENSE_PERIOD_INVALID);break;case Ke.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(Ct.LICENSE_MULTIPLE_SDK_SERVICE);break;case Ke.ERR_LICENSE_ILLEGAL:this.close(Ct.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=t.clientId,this.spec=t,this.store=n,this.websocket=new YR("gateway-".concat(this.clientId),this.spec.retryConfig,!0,L("JOIN_GATEWAY_USE_DUAL_DOMAIN"),L("JOIN_GATEWAY_USE_443PORT_ONLY"),n),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===Tt.CONNECTED&&this.reconnect("retry",Jr.OFFLINE)})}async request(t,n,i,o){const l=zt(6,""),d={_id:l,_type:t,_message:n},h=this.websocket.connectionID,f=()=>new be((D,I)=>{if(this.connectionState===Tt.CONNECTED)return D();const O=()=>{this.off(Ue.WS_CLOSED,U),D()},U=()=>{this.off(Ue.WS_CONNECTED,O),I(new se(P.WS_ABORT))};this.once(Ue.WS_CONNECTED,O),this.once(Ue.WS_CLOSED,U),t!==je.PUBLISH&&t!==je.PUBLISH_DATASTREAM&&t!==je.SUBSCRIBE&&t!==je.SUBSCRIBE_DATASTREAM&&t!==je.UNSUBSCRIBE&&t!==je.UNSUBSCRIBE_DATASTREAM&&t!==je.UNPUBLISH&&t!==je.UNPUBLISH_DATASTREAM&&t!==je.CONTROL&&t!==je.RESTART_ICE||this.once(Ue.DISCONNECT_P2P,()=>{I(new se(P.DISCONNECT_P2P))}),t!==je.PUBLISH&&t!==je.RESTART_ICE||this.once(Ue.ABORT_P2P_EXECUTION,()=>{I(new se(P.DISCONNECT_P2P))})});if(this.connectionState!==Tt.CONNECTING&&this.connectionState!==Tt.RECONNECTING||t===je.JOIN||t===je.REJOIN||await f(),this.websocket.sendMessage(d,!0),o)return;const g=new be((D,I)=>{let O=!1;const U=(G,$)=>{O=!0,D({isSuccess:G==="success",message:$||{}}),this.off(Ue.WS_CLOSED,j),this.off(Ue.WS_RECONNECTING,j),this.emit(Ue.REQUEST_SUCCESS,t,n)};this.once("res-@".concat(l),U);const j=()=>{I(new se(P.WS_ABORT,"type: ".concat(t))),this.off(Ue.WS_CLOSED,j),this.off(Ue.WS_RECONNECTING,j),this.off("res-@".concat(l),U)};this.once(Ue.WS_CLOSED,j),this.once(Ue.WS_RECONNECTING,j),Sr(L("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==h||O||(S.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(t)),this.emit(Ue.REQUEST_TIMEOUT,t,n))})});let _=null;try{_=await g}catch(D){if(this.connectionState===Tt.CLOSED||t===je.LEAVE)throw new se(P.WS_ABORT);return!this.spec.forceWaitGatewayResponse||i?D.throw():t===je.JOIN||t===je.REJOIN?null:(await f(),await this.request(t,n))}if(_.isSuccess)return _.message;const v=Number(_.message.error_code||_.message.code),y=Md(v),b=new se(P.UNEXPECTED_RESPONSE,"".concat(y.desc,": ").concat(_.message.error_str),{code:v,data:_.message,desc:y.desc});return y.action==="success"?_.message:(S.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(t,", error_code: ").concat(v,", message: ").concat(y.desc,", action: ").concat(y.action)),v===Ke.ERR_TOO_MANY_BROADCASTERS?((t===je.JOIN||t===je.REJOIN)&&(this.initError=b,this.close()),b.throw()):y.action==="failed"?b.throw():y.action==="quit"?(this.initError=b,this.close(),b.throw()):(v===Ke.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=_.message.option,S.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",Jr.MULTI_IP)):this.reconnect(y.action,Jr.SERVER_ERROR),t===je.JOIN||t===je.REJOIN?null:await this.request(t,n)))}waitMessage(t,n){return new be(i=>{const o=l=>{(!n||n(l))&&(this.off(t,o),i(l))};this.on(t,o)})}uploadWRTCStats(t){if(!this.store.sessionId)return void S.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const n={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:t};this.upload(Pd.WRTC_STATS,n)}upload(t,n){const i={_type:t,_message:n};try{this.websocket.sendMessage(i)}catch{const l=L("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(i),this.uploadCache.length>l&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==Tt.CONNECTED)return;const d=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(d._type,d._message)},L("UPLOAD_CACHE_INTERVAL")||2e3))}}send(t,n){const i={_type:t,_message:n};this.websocket.sendMessage(i)}init(t){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new be((n,i)=>{this.once(Ue.WS_CONNECTED,()=>n(this.joinResponse)),this.once(Ue.WS_CLOSED,o=>i(this.initError||new se(P.WS_ABORT,o))),this.connectionState=Tt.CONNECTING,this.websocket.init(t).catch(i),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval(()=>{this.handleWsInflateData()},2e4)})}close(t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=t||Ct.LEAVE,this.connectionState=Tt.CLOSED,S.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close()}async join(){if(!this.joinResponse){this.emit(Ue.ABORT_P2P_EXECUTION),this.store.signalConnected();const t=await ir(this,Ue.REQUEST_JOIN_INFO);this.store.joinReq();const n=await this.request(je.JOIN,t);if(this.ortc=t==null?void 0:t.ortc,this.store.joinRep(),!n)return this.emit(Ue.REPORT_JOIN_GATEWAY,Xv.TIMEOUT,this.url||""),!1;this.joinResponse=n,this.emit(Ue.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=Tt.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new se(P.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const t=bd(this,Ue.REQUEST_REJOIN_INFO);t.token=this.reconnectToken;const n=await this.request(je.REJOIN,t);return!!n&&(this.connectionState=Tt.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),n.peers&&n.peers.forEach(i=>{this.emit(nt.ON_USER_ONLINE,{uid:i.uid}),i.audio&&this.emit(nt.ON_ADD_AUDIO_STREAM,{uid:i.uid,uint_id:i.uint_id,audio:!0,ssrcId:i.audio_ssrc}),i.video&&this.emit(nt.ON_ADD_VIDEO_STREAM,{uid:i.uid,uint_id:i.uint_id,video:!0,ssrcId:i.video_ssrc}),i.audio_mute?this.emit(nt.MUTE_AUDIO,{uid:i.uid}):this.emit(nt.UNMUTE_AUDIO,{uid:i.uid}),i.video_mute?this.emit(nt.MUTE_VIDEO,{uid:i.uid}):this.emit(nt.UNMUTE_VIDEO,{uid:i.uid}),i.audio_enable_local?this.emit(nt.ENABLE_LOCAL_AUDIO,{uid:i.uid}):this.emit(nt.DISABLE_LOCAL_AUDIO,{uid:i.uid}),i.video_enable_local?this.emit(nt.ENABLE_LOCAL_VIDEO,{uid:i.uid}):this.emit(nt.DISABLE_LOCAL_VIDEO,{uid:i.uid}),i.audio||i.video||this.emit(nt.ON_REMOVE_STREAM,{uid:i.uid,uint_id:i.uint_id})}),!0)}reconnect(t,n){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(t,n)}async downgradeCodec(t){if(!this.ortc)return!1;const n={downgrade_codec:t,ortc:this.ortc};return!!await this.request(je.DOWNGRADE_CODEC,n)}handleNotification(t){S.debug("[".concat(this.clientId,"] receive notification: "),t);const n=Md(t.code);if(t.code===28&&"detail"in t&&(S.info("[".concat(this.clientId,"] receive recover notification: "),t.detail),this.emit(Ue.RECOVER_NOTIFICATION,t.detail)),n.action!=="success"){if(n.action!=="failed")return n.action==="quit"?t.code===Ke.ERR_REPEAT_JOIN_CHANNEL&&L("IGNORE_UID_CHECK")?void this.close(Ct.UID_CONFLICT):(n.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(Ct.UID_BANNED),void this.close()):t.code===Ke.K_VOS_FALLBACK&&"detail"in t?(S.info("[".concat(this.clientId,"] receive vos fallback notification: "),t.detail),t.detail==="FALLBACKCN"&&L("ENABLE_QUALITY_FALLBACK")?void ir(this,Ue.VOS_FALLBACK_PROMISE,t.detail).then(()=>{this.reconnect("recover",n.desc)}).catch(i=>{S.debug("[".concat(this.clientId,"] cancel vos fallback cn, error: "),i)}):t.detail==="fallback_hls"&&L("ENABLE_FALLBACK_TO_HLS")?(this.emit(Ue.VOS_FALLBACK,t.detail),void this.close(Ct.FALLBACK_TO_HLS)):this.reconnect(n.action,n.desc)):void this.reconnect(n.action,Jr.SERVER_ERROR);S.error("[".concat(this.clientId,"] ignore error: "),n.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const t=L("PING_PONG_TIME_OUT"),n=Date.now();this.pingpongTimeoutCount>=t&&(S.warning("[".concat(this.clientId,"] PING-PONG Timeout. Last Socket Message: ").concat(n-this.lastMsgTime,"ms")),n-this.lastMsgTime>L("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",Jr.TIMEOUT):this.request(je.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const i=Date.now()-n;this.rttRolling.add(i),L("REPORT_STATS")&&this.send(je.PING_BACK,{pingpongElapse:i})}).catch(i=>{})}handleWsInflateData(){const{wsInflateLength:t,wsDeflateLength:n}=this.websocket.getWsInflateData();t!==0&&n!==0&&this.upload(Pd.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:n,ws_inflate_length:t})}handleWebsocketEvents(){this.websocket.on(lt.RECONNECT_CREATE_CONNECTION,t=>{this.emit(Ue.WS_RECONNECT_CREATE_CONNECTION,t)}),this.websocket.on(lt.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(lt.CLOSED,()=>{this.connectionState=Tt.CLOSED}),this.websocket.on(lt.FAILED,()=>{this._disconnectedReason=Ct.NETWORK_ERROR,this.connectionState=Tt.CLOSED}),this.websocket.on(lt.RECONNECTING,t=>{this._websocketReconnectReason=t,this.joinResponse=void 0,this.connectionState===Tt.CONNECTED?this.connectionState=Tt.RECONNECTING:this.connectionState=Tt.CONNECTING}),this.websocket.on(lt.WILL_RECONNECT,(t,n,i)=>{const o=bd(this,Ue.IS_P2P_DISCONNECTED),l=o||t!=="retry";o&&t==="retry"&&(S.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),t="tryNext",n=Xv.P2P_DISCONNECTED),l&&(S.debug("".concat(this.clientId," will renewSession, reconnect mode: ").concat(t)),this.emit(Ue.REPORT_JOIN_GATEWAY,n||Xv.UNKNOWN_REASON,this.url||""),this.reconnectToken=void 0,this.emit(Ue.DISCONNECT_P2P)),i(t)}),this.websocket.on(lt.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(t=>{S.warning("[".concat(this.clientId,"] rejoin failed ").concat(t)),this.reconnect("tryNext",Jr.SERVER_ERROR)}):this.join().catch(t=>{if(this.emit(Ue.REPORT_JOIN_GATEWAY,t,this.url||""),t instanceof se){if(t.code===P.UNEXPECTED_RESPONSE&&t.data.code===Ke.ERR_NO_AUTHORIZED)return this.initError=new se(P.TOKEN_EXPIRE,"dynamic key expired"),void this.close(Ct.TOKEN_EXPIRE);S.error("[".concat(this.clientId,"] join gateway request failed"),t.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",Jr.SERVER_ERROR):(this.initError=t,this.close())}})}),this.websocket.on(lt.REQUEST_NEW_URLS,(t,n)=>{ir(this,Ue.REQUEST_RECOVER,this.multiIpOption).then(t).catch(n)}),this.websocket.on(lt.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(nt.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this.websocket.on(hr.PRE_CONNECT_PC,()=>{this.emit(Ue.PRE_CONNECT_PC)}),this.websocket.on(lt.ON_FALLBACK,()=>{L("ENABLE_FALLBACK_TO_HLS")&&this.emit(Ue.VOS_FALLBACK,"fallback_hls")})}}let $le=function(e){return e.NATIVE_RTC="native_rtc",e.NATIVE_RTM="native_rtm",e.WEB_RTC="web_rtc",e.WEB_RTM="web_rtm",e}({}),Xn=function(e){return e[e.CHOOSE_SERVER=11]="CHOOSE_SERVER",e[e.CLOUD_PROXY=18]="CLOUD_PROXY",e[e.CLOUD_PROXY_5=20]="CLOUD_PROXY_5",e[e.CLOUD_PROXY_FALLBACK=26]="CLOUD_PROXY_FALLBACK",e}({});function aV(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}function Zv(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?aV(Object(n),!0).forEach(function(i){x(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):aV(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}let zR=0;function to(e){const t=L("TURN_DOMAINS");zR=(zR+1)%t.length;const n=t[zR]||"edge.agora.io";return e.match(/^[\.\:\d]+$/)?"".concat(e.replace(/[^\d]/g,"-"),".").concat(n):(S.debug("Cannot recognized as ip address: ".concat(e,", use as host2")),e)}function e0(e){try{const t=L("TURN_DOMAINS"),n=L("GATEWAY_DOMAINS").concat(t).find(i=>me(e).call(e,i));return n?e.split(".".concat(n))[0].replace(/-/g,"."):e}catch{return S.debug("serverUrlToIp error, fallback to url",e),e}}function qR(e,t){e.addresses||(e.addresses=[]);const n=function(h,f){if(L("CONNECT_GATEWAY_WITHOUT_DOMAIN"))return h.map(v=>{let{ip:y,port:b}=v;return{address:"".concat(y,":").concat(b)}});const g=L("GATEWAY_DOMAINS");let _=g[1]&&me(f).call(f,g[1])?1:0;return h.map(v=>{let{domain_prefix:y,port:b,ip:D}=v;if(y)return{address:"".concat(y,".").concat(g[_++%g.length],":").concat(b)};const I=/^[\.\:\d]+$/.test(D),O=I?"".concat(D.replace(/[^\d]/g,"-"),".").concat(g[_++%g.length],":").concat(b):"".concat(D,":").concat(b);return I||S.debug("Cannot recognized as ip address: ".concat(D,", use as host3")),{ip:D,port:b,address:O}})}(e.addresses,t),i=Array.isArray(e.detail)&&e.detail[18];if(i&&typeof i=="string"){const h=i.split(";");for(let f=0;f<h.length;f++){var o;const g=ks(o=h[f]).call(o);n[f]&&g&&(n[f].ip6=g)}}const l=e.detail&&e.detail.candidate;let d;if(l){const[h,f]=l.split(":");h&&f&&(d={port:Number(f),ip:h,address:"".concat(h,":").concat(f)})}return{gatewayAddrs:n,apGatewayAddress:d,uid:e.uid,cid:e.cid,cert:e.cert,vid:e.detail&&e.detail[8],uni_lbs_ip:e.detail&&e.detail[1],res:e,csIp:e.detail&&e.detail[502]}}function ei(e){return typeof e=="number"?e:e.exact||e.ideal||e.max||e.min||0}function oV(e){const t=e._encoderConfig;if(!t)return{};const n={resolution:t.width&&t.height?"".concat(ei(t.width),"x").concat(ei(t.height)):void 0,maxVideoBW:t.bitrateMax,minVideoBW:t.bitrateMin};return typeof t.frameRate=="number"?(n.maxFrameRate=t.frameRate,n.minFrameRate=t.frameRate):t.frameRate&&(n.maxFrameRate=t.frameRate.max||t.frameRate.ideal||t.frameRate.exact||t.frameRate.min,n.minFrameRate=t.frameRate.min||t.frameRate.ideal||t.frameRate.exact||t.frameRate.max),n}function t0(e){return e>=0&&e<.17?1:e>=.17&&e<.36?2:e>=.36&&e<.59?3:e>=.59&&e<=1?4:e>1?5:0}function Nm(e,t){let n,i,o;switch(t){case Xn.CHOOSE_SERVER:i=4096,o="choose server";break;case Xn.CLOUD_PROXY:i=1048576,o="proxy";break;case Xn.CLOUD_PROXY_5:i=4194304,o="proxy5";break;case Xn.CLOUD_PROXY_FALLBACK:i=4194310,o="proxy fallback";break;default:throw new se(P.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:e.detail&&e.detail[502],retry:!1})}if(e.response_body.forEach(l=>{l.buffer&&l.buffer.flag===i&&(n={code:l.buffer.code,addresses:(l.buffer.edges_services||[]).map(d=>Zv(Zv({},d),{},{ticket:l.buffer.cert})),server_ts:e.enter_ts,uid:l.buffer.uid,cid:l.buffer.cid,cname:l.buffer.cname,detail:Zv(Zv({},l.buffer.detail),e.detail),flag:l.buffer.flag,opid:e.opid,cert:l.buffer.cert})}),!n)throw new se(P.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(o," from multi unilbs response"),{csIp:e.detail&&e.detail[502]});return n}async function cV(e,t){return await be.all(e.addresses.map(async n=>({address:to(n.ip),tcpport:n.port,udpport:n.port,username:t&&L("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?t.toString():$r.username,password:t&&L("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?await WT(t.toString()):$r.password})))}function XR(e,t){const n=t.getMediaStreamTrack(!0).getSettings(),i=t.videoHeight||n.height,o=t.videoWidth||n.width;return i&&o?Math.max(Math.min(i,o)/Math.min(ei(e.height),ei(e.width)),1):(S.warning("can't get ori-track's height, default scale down 4 times for low stream"),4)}function Xl(e){let{candidateType:t,relayProtocol:n,type:i,address:o,port:l,protocol:d}=e;const h={candidateType:t,relayProtocol:n,protocol:d};if(i!=="local-candidate"){const f=o.split(".");f.length>=4&&(f[1]="*",f[2]="*"),h.address=f.join("."),h.port=l}return h}function gc(e){const t=e.split(":"),n=e.split(/[-.]/),i=me(e).call(e,"-")?"-":".";let o=e;return t.length>1?n.length>1?(n[1]="**",o=n[0]+i+"**:"+t[t.length-1]):o=t.length>2?t[0]+i+"**:"+t[t.length-1]:"**:"+t[t.length-1]:n.length>1&&(o=n[0]+i+"**"),o}function lV(e,t){return e.getTransceivers().find(n=>n.sender.track===t||n.receiver.track===t)}function Om(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:L("SVC_MODE");if(L("ENABLE_SVC"))return function(t){return t in Cv}(e)?e:Cv.L1T3}const AV={[xe.VIDEO]:[{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"},{key:"video-orientation",extensionName:"urn:3gpp:video-orientation"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"playout-delay",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/playout-delay"},{key:"video-content-type",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-content-type"},{key:"color-space",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/color-space"},{key:"video-timing",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-timing"}],[xe.AUDIO]:[{key:"ssrc-audio-level",extensionName:"urn:ietf:params:rtp-hdrext:ssrc-audio-level"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"}]};function dV(e){e.send&&(Yh(xe.VIDEO,e.send.videoExtensions),Yh(xe.AUDIO,e.send.audioExtensions)),e.recv&&(Yh(xe.VIDEO,e.recv.videoExtensions),Yh(xe.AUDIO,e.recv.audioExtensions)),e.sendrecv&&(Yh(xe.VIDEO,e.sendrecv.videoExtensions),Yh(xe.AUDIO,e.sendrecv.audioExtensions))}function uV(e,t){e.send&&(n0(xe.VIDEO,e.send.videoExtensions,t.send.videoExtensions),n0(xe.AUDIO,e.send.audioExtensions,t.send.audioExtensions)),e.recv&&(n0(xe.VIDEO,e.recv.videoExtensions,t.recv.videoExtensions),n0(xe.AUDIO,e.recv.audioExtensions,t.recv.audioExtensions))}function n0(e,t,n){t.forEach(i=>{var o;const l=AV[e].find(h=>{var f;let{key:g}=h;return me(f=i.extensionName).call(f,g)});if(!l)return;const d=n.find(h=>{let{extensionName:f}=h;return me(f).call(f,l.key)});d&&me(o=d.extensionName).call(o,"gdpr_forbidden")&&(i.extensionName=d.extensionName)})}function Yh(e,t){t.forEach(n=>{var i;const o=AV[e].find(l=>{var d;let{key:h}=l;return me(d=n.extensionName).call(d,h)});me(i=n.extensionName).call(i,"gdpr_forbidden")&&o&&(n.extensionName=o.extensionName)})}function hV(e){return e==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"||me(e).call(e,"abs-send-time")}function r0(e){return e==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"||me(e).call(e,"draft-holmer-rmcat-transport-wide-cc-extensions-01")}function pV(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}function fV(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?pV(Object(n),!0).forEach(function(i){x(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):pV(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}function xm(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},i=arguments.length>3?arguments[3]:void 0;const{filterRTX:o,filterVideoFec:l,filterAudioFec:d,filterAudioCodec:h,filterVideoCodec:f,unsupportedVideoUplinkCodec:g,unsupportedVideoDownlinkCodec:_}=t,{useXR:v}=n;let y=[],b=[],D=[],I=[],O=!1,U=!1;if(Ps(e).mediaDescriptions.forEach(G=>{i&&i!==G.attributes.direction||(G.media.mediaType!=="video"||O||(b=G.attributes.payloads,I=G.attributes.extmaps,O=!0),G.media.mediaType!=="audio"||U||(y=G.attributes.payloads,D=G.attributes.extmaps,U=!0))}),!I||b.length===0)throw new Error("Cannot get video capabilities from SDP.");if(!D||y.length===0)throw new Error("Cannot get audio capabilities from SDP.");if(b.forEach(G=>{var $;($=G.rtpMap)!==null&&$!==void 0&&$.clockRate&&(G.rtpMap.clockRate=parseInt(G.rtpMap.clockRate)),v&&G.rtcpFeedbacks.push({type:"rrtr"})}),y.forEach(G=>{var $;($=G.rtpMap)!==null&&$!==void 0&&$.clockRate&&(G.rtpMap.clockRate=parseInt(G.rtpMap.clockRate)),v&&G.rtcpFeedbacks.push({type:"rrtr"})}),o&&(y=y.filter(G=>{var $;return(($=G.rtpMap)===null||$===void 0?void 0:$.encodingName.toLowerCase())!=="rtx"}),b=b.filter(G=>{var $;return(($=G.rtpMap)===null||$===void 0?void 0:$.encodingName.toLowerCase())!=="rtx"})),l){const G=b.filter(X=>{var ee;return/(red)|(ulpfec)|(flexfec)/i.test(((ee=X.rtpMap)===null||ee===void 0?void 0:ee.encodingName)||"")}),$=Jl(G,b).map(X=>X.payloadType),Z=[...G.map(X=>X.payloadType),...$];b=b.filter(X=>!me(Z).call(Z,X.payloadType))}if(d&&(y=y.filter(G=>{var $;return!/(red)|(ulpfec)|(flexfec)/i.test((($=G.rtpMap)===null||$===void 0?void 0:$.encodingName)||"")})),h&&(h==null?void 0:h.length)>0&&(y=y.filter(G=>{var $;return me(h).call(h,(($=G.rtpMap)===null||$===void 0?void 0:$.encodingName.toLowerCase())||"")})),f&&(f==null?void 0:f.length)>0){const G=b.filter($=>{var Z;return me(f).call(f,((Z=$.rtpMap)===null||Z===void 0?void 0:Z.encodingName.toLowerCase())||"")});b=G.concat(o?[]:Jl(G,b))}const j=L("UNSUPPORTED_VIDEO_CODEC");if(j&&j.length>0){const G=b.filter(X=>X.rtpMap&&me(j).call(j,X.rtpMap.encodingName.toLowerCase())),$=Jl(G,b),Z=G.concat($).map(X=>X.payloadType);b=b.filter(X=>!me(Z).call(Z,X.payloadType)),S.debug("unsupportedVideoCodec: ".concat(j,", toBeRemoved: ").concat(Z))}if(g&&g.length>0&&i==="sendonly"){const G=b.filter(X=>X.rtpMap&&me(g).call(g,X.rtpMap.encodingName.toLowerCase())),$=Jl(G,b),Z=G.concat($).map(X=>X.payloadType);b=b.filter(X=>!me(Z).call(Z,X.payloadType)),S.debug("unsupportedVideoUplinkCodec: ".concat(g,", toBeRemoved: ").concat(Z))}if(_&&_.length>0&&i==="recvonly"){const G=b.filter(X=>X.rtpMap&&me(_).call(_,X.rtpMap.encodingName.toLowerCase())),$=Jl(G,b),Z=G.concat($).map(X=>X.payloadType);b=b.filter(X=>!me(Z).call(Z,X.payloadType)),S.debug("unsupportedVideoDownlinkCodec: ".concat(_,", toBeRemoved: ").concat(Z))}return{audioCodecs:y,videoCodecs:b,audioExtensions:D,videoExtensions:I}}function _c(e){const t=Ps(e);let n,i;for(const o of t.mediaDescriptions){if(!n){const l=o.attributes.iceUfrag,d=o.attributes.icePwd;if(!l||!d)throw new Error("Cannot get iceUfrag or icePwd from SDP.");n={iceUfrag:l,icePwd:d}}if(!i){const l=o.attributes.fingerprints;l.length>0&&(i={fingerprints:l})}}if(!i&&t.attributes.fingerprints.length>0&&(i={fingerprints:t.attributes.fingerprints}),!i||!n)throw new Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:n,dtlsParameters:i}}function JR(e,t){const n=[],i=e.attributes.ssrcGroups.filter(d=>d.semantic==="FID"),o=e.attributes.ssrcGroups.find(d=>d.semantic==="SIM"),l=e.attributes.ssrcs;if(o)o.ssrcIds.forEach(d=>{var h;const f=(h=i.find(g=>g.ssrcIds[0]===d))===null||h===void 0?void 0:h.ssrcIds[1];n.push({ssrcId:d,rtx:t?f:void 0})});else if(i.length>0){const d=i[0].ssrcIds[0],h=i[0].ssrcIds[1];n.push({ssrcId:d,rtx:t?h:void 0})}else{if(l.length===0)throw new Error("No ssrcs found on local media description.");n.push({ssrcId:l[0].ssrcId})}return n}function mV(e,t,n){const{cname:i}=e;let o=[];t&&(o=gV(t)),o.length===0&&(o=e.iceParameters.candidates.map(_=>({foundation:_.foundation,componentId:"1",transport:_.protocol,priority:_.priority.toString(),connectionAddress:_.ip,port:_.port.toString(),type:_.type,extension:{}})),S.debug("Using candidates from gateway."));const l={fingerprints:e.dtlsParameters.fingerprints.map(_=>({hashFunction:_.algorithm,fingerprint:_.fingerprint}))},d={iceUfrag:e.iceParameters.iceUfrag,icePwd:e.iceParameters.icePwd};let h;switch(e.dtlsParameters.role){case"server":h="passive";break;case"client":h="active";break;case"auto":h="actpass"}const f=Bm(e.rtpCapabilities),g=[];return Array.isArray(n)&&n.length>0&&n.forEach(_=>{g.push({kind:xe.VIDEO,ssrcMsg:[{ssrcId:_.v,rtx:_.v_rtx}],mslabel:"".concat(_.v,"_").concat(_.a)},{kind:xe.AUDIO,ssrcMsg:[{ssrcId:_.a}],mslabel:"".concat(_.v,"_").concat(_.a)})}),{dtlsParameters:l,iceParameters:d,candidates:o,rtpCapabilities:f,setup:h,cname:i,preSSRCs:g}}function gV(e){let t=[];return e.ip&&typeof e.port=="number"&&(t=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip,port:e.port.toString(),type:"host",extension:{}}],S.debug("Using remote candidate from AP ".concat(gc(e.ip),":").concat(e.port)),e.ip6&&(t.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip6,port:e.port.toString(),type:"host",extension:{}}),S.debug("Using IPV6 remote candidate from AP ".concat(gc(e.ip6),":").concat(e.port)))),t}function Dm(e,t,n){const i=[],o=[];return e.forEach(l=>{let{ssrcId:d,rtx:h}=l;const f=zt(8,"track-"),g={ssrcId:d,attributes:fV({label:f,mslabel:n=n||zt(10,""),msid:"".concat(n," ").concat(f)},t&&{cname:t})};if(i.push(g),h!==void 0){const _={ssrcId:h,attributes:fV({label:f,mslabel:n,msid:"".concat(n," ").concat(f)},t&&{cname:t})};i.push(_),o.push({semantic:"FID",ssrcIds:[d,h]})}}),e.length>1&&o.push({semantic:"SIM",ssrcIds:e.map(l=>{let{ssrcId:d}=l;return d})}),{ssrcs:i,ssrcGroups:o}}function Fd(e,t){t instanceof Mn&&e.attributes.payloads.forEach(n=>{var i;const o=(i=n.rtpMap)===null||i===void 0?void 0:i.encodingName.toLowerCase();if(!o||["opus","pcmu","pcma","g722"].indexOf(o)===-1)return;n.fmtp||(n.fmtp={parameters:{}}),o==="opus"&&typeof L("OPUS_PTIME")=="number"?n.fmtp.parameters.ptime=L("OPUS_PTIME"):n.fmtp.parameters.minptime="10",n.fmtp.parameters.useinbandfec="1";const l=t._encoderConfig;l&&(o!=="pcmu"&&o!=="pcma"&&o!=="g722"&&(l.bitrate&&!gn()&&(n.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*l.bitrate))),l.sampleRate&&(n.fmtp.parameters.maxplaybackrate="".concat(l.sampleRate),n.fmtp.parameters["sprop-maxcapturerate"]="".concat(l.sampleRate)),l.stereo&&(n.fmtp.parameters.stereo="1",n.fmtp.parameters["sprop-stereo"]="1")),t instanceof Tm&&o==="opus"&&t._config.DTX&&(n.fmtp.parameters.usedtx="1"))})}function $R(e){const t=e.attributes.unrecognized.findIndex(n=>n.attField==="x-google-flag"&&n.attValue==="conference");t!==-1&&e.attributes.unrecognized.splice(t,1)}function ZR(e,t){var n;if(e.attributes.payloads.forEach(o=>{var l;((l=o.rtpMap)===null||l===void 0?void 0:l.encodingName.toLowerCase())==="h264"&&o.fmtp&&o.fmtp.parameters&&L("ENABLE_UP_SPS_PPS")&&(o.fmtp.parameters["sps-pps-idr-in-keyframe"]="1")}),!(t instanceof on&&t._encoderConfig&&t._hints.indexOf(Wt.SCREEN_TRACK)===-1))return;const i=t._encoderConfig;wt().supportMinBitrate&&i.bitrateMin&&e.attributes.payloads.forEach(o=>{var l,d;me(l=["h264","h265","vp8","vp9","av1"]).call(l,((d=o.rtpMap)===null||d===void 0?void 0:d.encodingName.toLowerCase())||"")&&(o.fmtp||(o.fmtp={parameters:{}}),o.fmtp.parameters["x-google-min-bitrate"]="".concat(i.bitrateMin))}),wt().supportMinBitrate&&!me(n=t._hints).call(n,Wt.LOW_STREAM)&&i.bitrateMax&&e.attributes.payloads.forEach(o=>{var l,d;me(l=["h264","h265","vp8","vp9","av1"]).call(l,((d=o.rtpMap)===null||d===void 0?void 0:d.encodingName.toLowerCase())||"")&&(o.fmtp||(o.fmtp={parameters:{}}),o.fmtp.parameters["x-google-start-bitrate"]="".concat(L("X_GOOGLE_START_BITRATE")||Math.floor(i.bitrateMax)))})}function _V(e){if(e.media.mediaType!=="video")return;const t=Lt();if(t.name!==Mt.SAFARI&&t.os!==br.IOS)return;const n=e.attributes.extmaps.findIndex(i=>/video-orientation/g.test(i.extensionName));n!==-1&&e.attributes.extmaps.splice(n,1)}function s0(e,t,n){if(!t)return;let i,o;if(e.media.mediaType==="video"?(i=n.videoExtensions,o=n.videoCodecs):(i=n.audioExtensions,o=n.audioCodecs),t.twcc===!0){const l=i.find(d=>r0(d.extensionName));if(l){const d=l.extensionName;e.attributes.extmaps.find(f=>r0(f.extensionName))||e.attributes.extmaps.push({entry:l.entry,extensionName:d}),function(f,g){return g.filter(_=>!!f.find(v=>v.payloadType===_.payloadType&&!!v.rtcpFeedbacks.find(y=>y.type==="transport-cc")))}(o,e.attributes.payloads).forEach(f=>{f.rtcpFeedbacks.find(g=>g.type==="transport-cc")||f.rtcpFeedbacks.push({type:"transport-cc"})})}}else if(t.twcc===!1){const l=e.attributes.extmaps.findIndex(d=>r0(d.extensionName));l!==-1&&e.attributes.extmaps.splice(l,1),e.attributes.payloads.forEach(d=>{const h=d.rtcpFeedbacks.findIndex(f=>f.type==="transport-cc");h!==-1&&d.rtcpFeedbacks.splice(h,1)})}if(t.remb===!0){const l=i.find(d=>hV(d.extensionName));if(l){const d=l.extensionName;e.attributes.extmaps.find(f=>f.extensionName===d)||e.attributes.extmaps.push({entry:l.entry,extensionName:d}),function(f,g){return g.filter(_=>!!f.find(v=>v.payloadType===_.payloadType&&!!v.rtcpFeedbacks.find(y=>y.type==="goog-remb")))}(o,e.attributes.payloads).forEach(f=>{f.rtcpFeedbacks.find(g=>g.type==="goog-remb")||f.rtcpFeedbacks.push({type:"goog-remb"})})}}else if(t.remb===!1){const l=e.attributes.extmaps.findIndex(d=>hV(d.extensionName));l!==-1&&e.attributes.extmaps.splice(l,1),e.attributes.payloads.forEach(d=>{const h=d.rtcpFeedbacks.findIndex(f=>f.type==="goog-remb");h!==-1&&d.rtcpFeedbacks.splice(h,1)})}}function eI(e,t,n){if(gn()||e.media.mediaType!=="video"||!(t instanceof on)||n!=="vp9"&&n!=="vp8"||n==="vp8"&&!L("SIMULCAST")||n==="vp9"&&L("ENABLE_SVC")||t._scalabilityMode===void 0||t._scalabilityMode.numSpatialLayers<=1)return;const i=n==="vp8"?2:t._scalabilityMode.numSpatialLayers,o=e.attributes.ssrcs[0],l=e.attributes.ssrcGroups.find(h=>h.semantic==="FID"&&h.ssrcIds[0]===o.ssrcId),d={semantic:"SIM",ssrcIds:[o.ssrcId]};for(let h=1;h<i;h++)e.attributes.ssrcs.push({ssrcId:o.ssrcId+h,attributes:_n(o.attributes)}),d.ssrcIds.push(o.ssrcId+h),l&&(e.attributes.ssrcs.push({ssrcId:l.ssrcIds[1]+h,attributes:_n(o.attributes)}),e.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[o.ssrcId+h,l.ssrcIds[1]+h]}));e.attributes.ssrcGroups.unshift(d)}async function EV(){try{const e=new RTCPeerConnection;e.addTransceiver("video",{direction:"sendonly",sendEncodings:[{scalabilityMode:Cv.L1T3}]});const t=await e.createOffer();if(!t.sdp)return void e.close();const n=Ps(t.sdp).mediaDescriptions[0];if(!n)return;const i=n.attributes.extmaps.find(o=>o.extensionName==="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension");return e.close(),i}catch{return}}async function tI(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=new RTCPeerConnection;n.addTransceiver("video",{direction:"sendonly"}),n.addTransceiver("audio",{direction:"sendonly"}),n.addTransceiver("video",{direction:"recvonly"}),n.addTransceiver("audio",{direction:"recvonly"});const i=(await n.createOffer()).sdp,{send:o,recv:l,sendrecv:d}=function(){let h=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},g=arguments.length>2?arguments[2]:void 0;const _=xm(g,h,f,"sendonly"),v=xm(g,h,f,"recvonly"),y={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},b={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},D={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(no(_,v,"videoExtensions",y,b,D),no(_,v,"videoCodecs",y,b,D),no(_,v,"audioExtensions",y,b,D),no(_,v,"audioCodecs",y,b,D),L("RAISE_H264_BASELINE_PRIORITY")){const I=[],O=[];if(D.videoCodecs.forEach((U,j)=>{var G;if(((G=U.rtpMap)===null||G===void 0?void 0:G.encodingName.toLocaleLowerCase())==="h264"){var $,Z;const X=D.videoCodecs[j+1],ee=X&&bV(U,X),le=($=U.fmtp)===null||$===void 0?void 0:$.parameters["profile-level-id"],fe=(Z=U.fmtp)===null||Z===void 0?void 0:Z.parameters["packetization-mode"];!le||le!==L("FIRST_H264_PROFILE_LEVEL_ID")||L("FIRST_PACKETIZATION_MODE")&&fe!==L("FIRST_PACKETIZATION_MODE")?ee?O.push([U,X]):O.push([U]):ee?I.push([U,X]):I.push([U])}}),I.length>0&&O.length>0){S.debug("raising H264 baseline profile priority"),D.videoCodecs.forEach((j,G)=>{var $;if((($=j.rtpMap)===null||$===void 0?void 0:$.encodingName.toLocaleLowerCase())==="h264"){const Z=bV(j,D.videoCodecs[G+1]),X=I.shift()||O.shift()||[];X.length>0&&(Z?D.videoCodecs.splice(G,2,...X):D.videoCodecs.splice(G,1,...X))}});const U=b.videoCodecs.filter(j=>{var G,$;return((G=j.rtpMap)===null||G===void 0?void 0:G.encodingName.toLocaleLowerCase())==="h264"&&(($=j.fmtp)===null||$===void 0?void 0:$.parameters["profile-level-id"])!==L("FIRST_H264_PROFILE_LEVEL_ID")});if(U.length>0){const j=Jl(U,b.videoCodecs).map($=>$.payloadType),G=[...U.map($=>$.payloadType),...j];b.videoCodecs=b.videoCodecs.filter($=>!me(G).call(G,$.payloadType))}L("FILTER_SEND_H264_BASELINE")&&(y.videoCodecs=y.videoCodecs.filter(j=>{var G,$;return!(((G=j.rtpMap)===null||G===void 0?void 0:G.encodingName.toLocaleLowerCase())==="h264"&&(($=j.fmtp)===null||$===void 0?void 0:$.parameters["profile-level-id"])!==L("FIRST_H264_PROFILE_LEVEL_ID"))}))}return{send:y,recv:b,sendrecv:D}}return{send:y,recv:b,sendrecv:D}}(e,t,i);try{n.close()}catch{}return{send:o,recv:l,sendrecv:d}}function vV(){const e={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},t=xm(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"recvonly"),n={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},i={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},o={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(no(e,t,"videoExtensions",n,i,o),no(e,t,"videoCodecs",n,i,o),no(e,t,"audioExtensions",n,i,o),no(e,t,"audioCodecs",n,i,o),L("RAISE_H264_BASELINE_PRIORITY")){const l=o.videoCodecs.findIndex(d=>d.rtpMap&&d.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&d.fmtp&&d.fmtp.parameters["profile-level-id"]==="42001f");if(l!==-1){const d=o.videoCodecs.findIndex(h=>h.rtpMap&&h.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(d<l){S.debug("raising H264 baseline profile priority");const h=o.videoCodecs[l];o.videoCodecs.splice(l,1),o.videoCodecs.splice(d,0,h)}d!==-1&&(i.videoCodecs=i.videoCodecs.filter(h=>!(h.rtpMap&&h.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&h.fmtp&&h.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:n,recv:i,sendrecv:o}}function no(e,t,n,i,o,l){if(n==="videoExtensions"||n==="audioExtensions"){const d=[];return e[n].forEach(h=>{t[n].some((f,g)=>{if(h.entry===f.entry&&h.extensionName===f.extensionName)return d.push(g),!0})?l[n].push(h):i[n].push(h)}),void t[n].forEach((h,f)=>{d.indexOf(f)===-1&&o[n].push(h)})}if(n==="videoCodecs"||n==="audioCodecs"){const d=[];return e[n].forEach(h=>{t[n].some((f,g)=>{if(h.payloadType===f.payloadType&&JSON.stringify(h)===JSON.stringify(f))return d.push(g),!0})?l[n].push(h):i[n].push(h)}),void t[n].forEach((h,f)=>{d.indexOf(f)===-1&&o[n].push(h)})}}function Bm(e){const{send:t,recv:n,sendrecv:i}=e;if(!i){if(!t||!n)throw new Error("cannot merge rtp capabilities because one of send or recv is empty!");return{send:t,recv:n}}let o,l;return t?(o={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},o.audioCodecs=[...t.audioCodecs,...i.audioCodecs],o.videoCodecs=[...t.videoCodecs,...i.videoCodecs],o.audioExtensions=[...t.audioExtensions,...i.audioExtensions],o.videoExtensions=[...t.videoExtensions,...i.videoExtensions]):o=_n(i),n?(l={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},l.audioCodecs=[...n.audioCodecs,...i.audioCodecs],l.videoCodecs=[...n.videoCodecs,...i.videoCodecs],l.audioExtensions=[...n.audioExtensions,...i.audioExtensions],l.videoExtensions=[...n.videoExtensions,...i.videoExtensions]):l=_n(i),{send:o,recv:l}}function zh(e){e.media.mediaType==="audio"&&e.attributes.payloads.filter(t=>{var n;return((n=t.rtpMap)===null||n===void 0?void 0:n.encodingName.toLowerCase())==="opus"}).forEach(t=>{t.fmtp||(t.fmtp={parameters:{}}),t.fmtp.parameters.stereo="1",t.fmtp.parameters["sprop-stereo"]="1"})}function km(e,t,n,i){let o=[];if(e===xe.VIDEO){if(L("H264_PROFILE_LEVEL_ID")&&i==="h264"&&(o=t.videoCodecs.filter(l=>{var d;return me(d=l.rtpMap&&l.rtpMap.encodingName.toLowerCase()||"").call(d,i)&&l&&l.fmtp&&l.fmtp.parameters["profile-level-id"]===L("H264_PROFILE_LEVEL_ID")})),!Array.isArray(o)||o.length===0){let l=[];const d=[],h=[],f=[];if(n.videoCodecs.forEach(g=>{const _=g.rtpMap&&g.rtpMap.encodingName.toLowerCase()||"";me(_).call(_,i)?l.push(g):me(_).call(_,"vp9")?d.push(g):me(_).call(_,"vp8")?h.push(g):me(_).call(_,"h264")&&f.push(g)}),l.length===0){let g="";d.length!==0?(l=d,g="vp9"):h.length!==0?(l=h,g="vp8"):f.length!==0&&(l=f,g="h264"),S.warning("codec ".concat(i," not included in rtpCapabilities, fallback to default payloads: ").concat(g))}l.length!==0&&(o=t.videoCodecs.filter(g=>l.some(_=>_.payloadType===g.payloadType)))}if(o.length===0&&(S.warning("codec ".concat(i," not included in rtpCapabilities, fallback to default payloads: ").concat(t.videoCodecs[0].rtpMap&&t.videoCodecs[0].rtpMap.encodingName)),o=t.videoCodecs),L("USE_PUB_RTX")||L("USE_SUB_RTX")){const l=Jl(o,t.videoCodecs);o=[...o,...l]}}else{o=t.audioCodecs.filter(d=>{var h;return me(h=d.rtpMap&&d.rtpMap.encodingName.toLowerCase()||"").call(h,i)});const l=t.audioCodecs.filter(d=>{var h;return me(h=d.rtpMap&&d.rtpMap.encodingName.toLowerCase()||"").call(h,"red")});o.length===0&&(S.warning("codec ".concat(i," not included in rtpCapabilities, fallback to opus")),o=t.audioCodecs.filter(d=>{var h;return me(h=d.rtpMap&&d.rtpMap.encodingName.toLowerCase()||"").call(h,"opus")})),L("ENABLE_AUDIO_RED")&&l.length!==0&&(o=[...l,...o])}return o}function Jl(e,t){const n=e.map(i=>i.payloadType.toString());return t.filter(i=>i.rtpMap&&i.rtpMap.encodingName==="rtx"&&i.fmtp&&i.fmtp.parameters.apt&&me(n).call(n,i.fmtp&&i.fmtp.parameters.apt))}async function pi(e,t,n){const i=t.toString(),o=yV(i,"offer","remote","exchangeSDP");await e.setRemoteDescription({type:"offer",sdp:i});const l=await e.createAnswer();if(!l.sdp)throw new Error("cannot get answer sdp");let d=l.sdp;d=nI(d,n||{}),o==null||o(d||""),await e.setLocalDescription({type:"answer",sdp:d})}function nI(e,t,n){const i=Ps(e),{useXR:o}=t;return i.mediaDescriptions.forEach(l=>{var d;l.attributes.mid&&(Array.isArray(n)&&!me(n).call(n,l.attributes.mid)||(l.media.mediaType==="audio"&&zh(l),l.media.mediaType==="video"&&function(h){h.media.mediaType==="video"&&L("ENABLE_DOWN_SPS_PPS")&&h.attributes.payloads.filter(f=>{var g;return((g=f.rtpMap)===null||g===void 0?void 0:g.encodingName.toLowerCase())==="h264"}).forEach(f=>{f.fmtp||(f.fmtp={parameters:{}}),f.fmtp.parameters["sps-pps-idr-in-keyframe"]="1"})}(l),o&&me(d=["audio","video"]).call(d,l.media.mediaType)&&l.attributes.payloads.forEach(h=>{h.rtcpFeedbacks.findIndex(f=>f.type==="rrtr")===-1&&h.rtcpFeedbacks.push({type:"rrtr"})})))}),Yc(i)}function yV(e,t,n,i){if(L("SDP_LOGGING"))return S.upload("exchanging ".concat(n," ").concat(t," SDP during P2PConnection.").concat(i,`
`),e),t==="offer"?o=>{yV(o,"answer",n==="local"?"remote":"local",i)}:void 0}async function wV(e,t,n){try{var i;if(!wt().supportSetRtpSenderParameters||!function(f){return f==="vp9"||f==="av1"}(e)||!L("ENABLE_SVC"))return;const o={},l={},d=t.getParameters(),h=(i=d.encodings)===null||i===void 0?void 0:i[0];l.scalabilityMode=Om(n),h&&Object.assign(h,l),Object.assign(d,o),await t.setParameters(d),S.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode success: ".concat(JSON.stringify(d.encodings)))}catch(o){S.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode failed",o)}}function i0(e){const t=L("COMPATIBLE_SDP_EXTENSION");return!!(Array.isArray(t)&&t.length>0)&&t.some(n=>me(e).call(e,n))}function bV(e,t){try{var n;return((n=e.fmtp)===null||n===void 0?void 0:n.parameters.apt)===t.payloadType.toString()}catch{return!1}}function SV(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}function xi(e,t){return typeof L(e)===t?L(e):void 0}function Zle(){try{const e=L("EXPERIMENTS")||{};return typeof e=="string"||Array.isArray(e)?{}:function(t){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?SV(Object(i),!0).forEach(function(o){x(t,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):SV(Object(i)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(i,o))})}return t}({},e)}catch(e){return S.debug("handle gateway attributes failed: ",e),{}}}const CV={};function Ec(e){(!(arguments.length>1&&arguments[1]!==void 0)||arguments[1])&&S.debug("install service ".concat(e.name)),CV[e.name]=e}function Po(e){const t=CV[e];if(!t)throw new ae(P.INVALID_OPERATION,"".concat(e," not found, please use AgoraRTC.use(").concat(e,"Service) to load it first"));return t}function TV(e,t){return Po("DataStream").create(e,t)}function a0(){return Po("InterceptFrame").create()}function RV(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}function Mr(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?RV(Object(n),!0).forEach(function(i){x(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):RV(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}const rI=new Map;class eAe extends Tn{get state(){return this._state}set state(t){if(t===this._state)return;const n=this._state;this._state=t,t==="DISCONNECTED"&&this._disconnectedReason?this.emit(Gn.CONNECTION_STATE_CHANGE,t,n,this._disconnectedReason):this.emit(Gn.CONNECTION_STATE_CHANGE,t,n)}get joinGatewayStartTime(){return this._joinGatewayStartTime}set joinGatewayStartTime(t){S.debug("[".concat(this.store.clientId,"] set joinGatewayStartTime at ").concat(t)),this._joinGatewayStartTime=t}constructor(t,n){var i,o,l;super(),x(this,"store",void 0),x(this,"joinInfo",void 0),x(this,"key",void 0),x(this,"ntpOffset",0),x(this,"usingProxy",!1),x(this,"signal",void 0),x(this,"role",void 0),x(this,"isPreallocation",void 0),x(this,"isPreSub",void 0),x(this,"inChannelInfo",{joinAt:null,duration:0}),x(this,"spec",void 0),x(this,"_state","DISCONNECTED"),x(this,"_statsCollector",void 0),x(this,"_disconnectedReason",void 0),x(this,"isSignalRecover",!1),x(this,"hasChangeBGPAddress",!1),x(this,"trafficStatsInterval",void 0),x(this,"networkQualityInterval",void 0),x(this,"_joinGatewayStartTime",0),x(this,"_signalTimeout",!1),x(this,"_clientRoleOptions",void 0),x(this,"_isProactiveJoin",!1),this.store=t,this.spec=n,this.signal=this.store.useP2P?(i={spec:Mr(Mr({},n),{},{retryConfig:n.websocketRetryConfig}),store:t},(o=(l=Po("P2PChannel")).createSubmodule)===null||o===void 0?void 0:o.call(l,i)):this.store.useDcSignal?function(d){return Po("DataChannelSignal").create(d)}({spec:Mr(Mr({},n),{},{retryConfig:n.websocketRetryConfig}),store:t}):new iV(Mr(Mr({},n),{},{retryConfig:n.websocketRetryConfig}),t),this._statsCollector=n.statsCollector,this.role=n.role||"audience",this._clientRoleOptions=n.clientRoleOptions,this.handleSignalEvents()}setUsingProxy(t){this.usingProxy=t}async join(t,n,i){if(this.store.useDcSignal){let _=!1;t.cloudProxyServer!=="disabled"?(S.debug("[".concat(this.store.clientId,"] Dc is not supported, because cloudProxyServer are not supported (").concat(t.cloudProxyServer,")")),_=!0):"".concat(t.apResponse.cid,"_").concat(t.apResponse.cert).length>255||"".concat(t.apResponse.cid,"_").concat(t.apResponse.cert).length<22?(S.debug("[".concat(this.store.clientId,"] Dc is not supported, because ticket length is incorrect, it has to be between 22 and 255")),_=!0):t.apResponse.addresses.some(v=>v.fingerprint)||L("FINGERPRINT")||(S.debug("[".concat(this.store.clientId,"] Dc is not supported, because fingerprint does not exist")),_=!0),_&&this.resetSignal()}this.store.joinGatewayStart(),t.cloudProxyServer!=="disabled"&&(this.hasChangeBGPAddress=!0);const o=Date.now();let l=rI.get(t.cname);if(l||(l=new Map,rI.set(t.cname,l)),this._isProactiveJoin=!0,l.has(t.uid)){const _=new se(P.UID_CONFLICT);throw ke.joinGateway(t.sid,{lts:o,succ:!1,ec:_.code,addr:null,uid:t.uid,cid:t.cid,firstSuccess:this._isProactiveJoin,isProxy:!!t.proxyServer||this.usingProxy,signalChannel:this.store.useDcSignal?"1":"0",preload:t.preload}),_}l.set(t.uid,!0),this.joinInfo=t,this.key=n;let d=0;this.joinGatewayStartTime=o;const h=t.proxyServer,f=this.store.useDcSignal?"datachannel":"websocket";try{S.debug("[".concat(this.store.clientId,"] use ").concat(f," join uid ").concat(d));const _=t.gatewayAddrs.map(y=>{let{address:b}=y;const[D,I]=b.split(":"),O={host:D,port:I};return t.proxyServer&&(O.proxy=t.proxyServer),O});let v;v=this.store.useDcSignal?await this.signal.init(t.apResponse.addresses):await this.signal.init(_),d=v.uid,S.debug("[".concat(this.store.clientId,"] ").concat(f," join uid ").concat(d," cost ").concat(Date.now()-this.joinGatewayStartTime))}catch(_){var g;throw _.code===P.INIT_DATACHANNEL_TIMEOUT&&this.signal.__name__==="AgoraRTCSignal"||ke.joinGateway(t.sid,{lts:o,succ:!1,ec:((g=_.data)===null||g===void 0?void 0:g.desc)||_.code,errorMsg:_.message,addr:this.signal.url,uid:t.uid,cid:t.cid,firstSuccess:this._isProactiveJoin,isProxy:!!h||this.usingProxy,signalChannel:this.signal.__name__==="DataChannelSignal"?"1":"0",preload:t.preload}),_&&_.code===P.INIT_DATACHANNEL_TIMEOUT?(S.warning("[".concat(this.store.clientId,"] User join datachannel failed"),_.toString()),this.resetSignal(),_):(S.error("[".concat(this.store.clientId,"] User join failed"),_.toString()),l.delete(t.uid),this.signal.close(),_)}return this.state="CONNECTED",this.inChannelInfo.joinAt=Date.now(),S.debug("[".concat(this.store.clientId,"] Connected to gateway server")),this.trafficStatsInterval=window.setInterval(()=>{this.updateTrafficStats().catch(_=>{S.warning("[".concat(this.store.clientId,"] get traffic stats error"),_.toString())})},3e3),this.networkQualityInterval=window.setInterval(()=>{navigator&&navigator.onLine!==void 0&&!navigator.onLine?this.emit(Gn.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):this._signalTimeout?this.emit(Gn.NETWORK_QUALITY,{downlinkNetworkQuality:5,uplinkNetworkQuality:5}):this.state==="CONNECTED"&&this._statsCollector.trafficStats?this.emit(Gn.NETWORK_QUALITY,{uplinkNetworkQuality:t0(this._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:t0(this._statsCollector.trafficStats.B_dnq)}):this.emit(Gn.NETWORK_QUALITY,{uplinkNetworkQuality:0,downlinkNetworkQuality:0})},2e3),this.store.joinGatewayEnd(),d}async leave(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0],n=arguments.length>1?arguments[1]:void 0;if(this.state!=="DISCONNECTED"){n!==Ct.FALLBACK&&(this.state="DISCONNECTING");try{t||this.signal.connectionState!==Tt.CONNECTED||await function(i,o){return o===1/0?i:be.race([i,Rce(o)])}(this.signal.request(je.LEAVE,void 0,!0),3e3)}catch(i){S.warning("[".concat(this.store.clientId,"] leave request failed, ignore"),i)}this.signal.close(n),n!==Ct.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}}async publish(t,n,i){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new se(P.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const o={state:"offer",p2p_id:this.store.p2pId,ortc:n,mode:this.spec.mode,extend:L("PUB_EXTEND"),twcc:!!L("PUBLISH_TWCC"),rtx:!!L("USE_PUB_RTX")};try{return(await this.signal.request(je.PUBLISH,o,!0))._message}catch(l){if(i&&l.data&&l.data.code===Ke.ERR_PUBLISH_REQUEST_INVALID)return S.warning("[".concat(this.store.clientId,"] receive publish error code, retry"),l.toString()),await this.tryUnpubBeforeRepub(t,n),this.publish(t,n,!1);throw l}}async publishDataChannel(t,n,i){var o;if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new se(P.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const l={stream_id:n.streamId,ordered:n.ordered?1:0,max_retrans_times:(o=n.maxRetransmits)!==null&&o!==void 0?o:10,channel_id:n.channelId,metadata:n.metadata};try{await this.signal.request(je.PUBLISH_DATASTREAM,l,!0)}catch(d){if(i&&d.data&&d.data.code===Ke.ERR_PUBLISH_REQUEST_INVALID)return S.warning("[".concat(this.store.clientId,"] receive publish datachannels error code, retry"),d.toString()),await this.tryUnpubDataChannelBeforeRepub(t,n),this.publishDataChannel(t,n,!1);throw d}}async unpublish(t,n){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new se(P.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await this.signal.request(je.UNPUBLISH,{stream_id:n,ortc:t},!0)}catch(i){S.warning("[".concat(this.store.clientId,"] unpublish warning: "),i)}}async unpublishDataChannel(t){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new se(P.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await be.all(t.map(n=>this.signal.request(je.UNPUBLISH_DATASTREAM,{channel_id:n},!0)))}catch(n){S.warning("unpublish datachannels warning: ",n)}}async presubscribe(t,n,i){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new se(P.INVALID_OPERATION,"can not presubscribe when connection state is ".concat(this.state));const o={stream_id:t,stream_type:n,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!L("SUBSCRIBE_TWCC"),rtx:!!L("USE_SUB_RTX")||void 0,extend:L("SUB_EXTEND"),svc:Array.isArray(L("SVC"))&&L("SVC").length!==0?L("SVC"):void 0};try{return await this.signal.request(je.PRE_SUBSCRIBE,o,!0)}catch(l){if(i&&l.data&&l.data.code===Ke.ERR_SUBSCRIBE_REQUEST_INVALID)return S.warning("[".concat(this.store.clientId,"] pre-subscribe error, retry"),l.toString()),this.presubscribe(t,n,!1);throw l}}async subscribe(t,n,i){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new se(P.INVALID_OPERATION,"can not subscribe when connection state is ".concat(this.state));const o={stream_id:t,stream_type:n.stream_type,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!L("SUBSCRIBE_TWCC"),rtx:!!L("USE_SUB_RTX"),extend:L("SUB_EXTEND"),ssrcId:n.ssrcId,svc:Array.isArray(L("SVC"))&&L("SVC").length!==0?L("SVC"):void 0};try{return(await this.signal.request(je.SUBSCRIBE,o,!0))._message}catch(l){if(i&&l.data&&l.data.code===Ke.ERR_SUBSCRIBE_REQUEST_INVALID)return S.warning("[".concat(this.store.clientId,"] receiver subscribe error code, retry"),l.toString()),await this.tryUnsubBeforeResub(t,n),await this.subscribe(t,n,!1);throw l}}async subscribeDataChannel(t,n,i){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new se(P.INVALID_OPERATION,"can not subscribe datachannel when connection state is ".concat(this.state));const o={uid:t,stream_id:n.id,channel_id:n.datachannelId};try{return void await this.signal.request(je.SUBSCRIBE_DATASTREAM,o,!0)}catch(l){if(i&&l.data&&l.data.code===Ke.ERR_SUBSCRIBE_REQUEST_INVALID)return S.warning("[".concat(this.store.clientId,"] receiver subscribe datachannel error code, retry"),l.toString()),await this.tryUnsubDataChannelBeforeResub(t,n),await this.subscribeDataChannel(t,n,!1);throw l}}async subscribeAll(t,n){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new se(P.INVALID_OPERATION,"can not massSubscribe when connection state is ".concat(this.state));const i={p2p_id:this.store.p2pId,users:t,dtx:!1,rtx:!!L("USE_SUB_RTX"),twcc:!!L("SUBSCRIBE_TWCC"),svc:Array.isArray(L("SVC"))&&L("SVC").length!==0?L("SVC"):void 0};try{return await this.signal.request(je.SUBSCRIBE_STREAMS,i,!0)}catch(o){if(n&&o.data&&o.data.code===Ke.ERR_SUBSCRIBE_REQUEST_INVALID)return S.warning("[".concat(this.store.clientId,"] receiver massSubscribe error code, retry"),o.toString()),await this.tryMassUnsubBeforeResub(t),await this.subscribeAll(t,!1);throw o}}async setVideoProfile(t){const n=function(i){if(!(i.bitrateMax&&i.bitrateMin&&i.frameRate&&i.height&&i.width))return;let o=i.frameRate,l=i.width,d=i.height,h=!0;return typeof o!="number"&&(o=o.exact||o.ideal||o.max||o.min||0,o||(h=!1)),typeof l!="number"&&(l=l.exact||l.ideal||l.max||l.min||0,l||(h=!1)),typeof d!="number"&&(d=d.exact||d.ideal||d.max||d.min||0,o||(h=!1)),h?{stream_type:0,width:l,height:d,fps:o,start_bps:1e3*i.bitrateMax,min_bps:1e3*i.bitrateMin,target_bps:1e3*i.bitrateMax}:void 0}(t);if(n)return this.signal.request(je.SET_VIDEO_PROFILE,n);S.debug("[".concat(this.store.clientId,"] encoder config is not complete, do not report to gateway"))}async unsubscribe(t,n){try{await this.signal.request(je.UNSUBSCRIBE,{p2p_id:this.store.p2pId,ortc:t,stream_id:n},!0)}catch(i){S.warning("[".concat(this.store.clientId,"] unsubscribe warning: "),i)}}async unsubscribeDataChannel(t,n){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new se(P.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await be.all(t.map(i=>this.signal.request(je.UNSUBSCRIBE_DATASTREAM,{stream_id:i,uid:n},!0)))}catch(i){S.warning("unsubscribeDataChannel warning: ",i)}}async massUnsubscribe(t){try{await this.signal.request(je.UNSUBSCRIBE_STREAMS,t,!0)}catch(n){S.warning("[".concat(this.store.clientId,"] massUnsubscribeAll warning: "),n)}}async reconnectPC(t){const{iceParameters:n,dtlsParameters:i,rtpCapabilities:o}=t;return{gatewayEstablishParams:await this.signal.request(je.CONNECT_PC,{p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:{iceParameters:n,dtlsParameters:i,rtpCapabilities:o}},!0),gatewayAddress:this.getCurrentGatewayAddress()}}getGatewayInfo(){return this.signal.request(je.GATEWAY_INFO)}async renewToken(t){await this.signal.request(je.RENEW_TOKEN,t),this.key=t.token}updateClientRole(t,n){n&&(this._clientRoleOptions=Object.assign({},n)),L("CLIENT_ROLE_OPTIONS")&&(S.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(L("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," ")),this._clientRoleOptions=Object.assign({},L("CLIENT_ROLE_OPTIONS"))),this.role=t}async setClientRole(t,n){if(n&&(this._clientRoleOptions=Object.assign({},n)),L("CLIENT_ROLE_OPTIONS")&&(this._clientRoleOptions=Object.assign({},L("CLIENT_ROLE_OPTIONS")),S.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(L("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," "))),this.state!=="CONNECTED")return void(this.role=t);let i,o=0;t==="audience"?this._clientRoleOptions&&this._clientRoleOptions.delay?(i=this._clientRoleOptions.delay,o=1):o=this._clientRoleOptions&&this._clientRoleOptions.level?this._clientRoleOptions.level:2:o=0;const l=Object.assign({},n);delete l.delay,delete l.level,await this.signal.request(je.SET_CLIENT_ROLE,Mr(Mr({role:t,level:o,delay:i},l),{},{client_ts:Date.now()})),this.role=t}async setDualStreamMode(t,n,i){await this.signal.request(je.SET_DUAL_STREAM_MODE,{mode:t},i,n)}async setRemoteVideoStreamType(t,n){await this.signal.request(je.SWITCH_VIDEO_STREAM,{stream_id:t,stream_type:n})}async setDefaultRemoteVideoStreamType(t){await this.signal.request(je.DEFAULT_VIDEO_STREAM,{stream_type:t})}async setStreamFallbackOption(t,n){await this.signal.request(je.SET_FALLBACK_OPTION,{stream_id:t,fallback_type:n})}async pickSVCLayer(t,n){await this.signal.request(je.PICK_SVC_LAYER,{stream_id:t,spatial_layer:n.spatialLayer,temporal_layer:n.temporalLayer})}async setRTM2Flag(t){await this.signal.request(je.SET_RTM2_FLAG,{rtm2_flag:t})}async sendExtensionMessage(t,n,i){if(this.store.useP2P)return this.signal.sendExtensionMessage(t,n,i)}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt),Mr({},this.inChannelInfo)}async setConfigure(t){if(t&&Array.isArray(t)&&t.length!==0)return this.signal.request(je.CONFIGURE,t)}async getGatewayVersion(){return(await this.signal.request(je.GATEWAY_INFO)).version}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){const t=rI.get(this.joinInfo.cname);t&&t.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0),this.usingProxy=!1}updateTurnConfigFromSignal(){if(!this.joinInfo)return;const t=function(n){let i;return i=n.startsWith("dc")?n.match(/(dc\:\/\/)?([^:]+):(\d+)/):n.match(/(wss\:\/\/)?([^:]+):(\d+)/),i?{username:$r.username,password:$r.password,turnServerURL:i[2],tcpport:parseInt(i[3])+30,udpport:parseInt(i[3])+30,forceturn:!1}:null}((this.joinInfo.cloudProxyServer==="disabled"?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex].address)||"");this.joinInfo.turnServer.serversFromGateway=[],t&&this.joinInfo.turnServer.mode!=="off"&&this.joinInfo.cloudProxyServer==="disabled"&&this.joinInfo.turnServer.serversFromGateway.push(Mr(Mr({},$r),{},{turnServerURL:t.turnServerURL,tcpport:t.tcpport,udpport:t.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}async updateTrafficStats(){if(this.state!=="CONNECTED")return;const t=await this.signal.request(je.TRAFFIC_STATS,void 0,!0);t.timestamp=Date.now(),t.ntp_offset!=null&&(this.ntpOffset=t.ntp_offset),t.peer_delay.forEach(n=>{const i=this._statsCollector.trafficStats&&this._statsCollector.trafficStats.peer_delay.find(o=>o.peer_uid===n.peer_uid);i&&i.B_st!==n.B_st&&yv(()=>{this.emit(Gn.STREAM_TYPE_CHANGE,n.peer_uid,n.B_st)})}),this._statsCollector.updateTrafficStats(t)}getJoinMessage(t){var n,i,o,l;if(!this.joinInfo||!this.key)throw new se(P.UNEXPECTED_ERROR,"can not generate join message, no join info");const d=Object.assign({},this.joinInfo.apResponse);let h=L("REPORT_APP_SCENARIO");if(typeof h!="string")try{h=JSON.stringify(h)}catch{h=void 0}var f;h&&h.length>128&&(h=void 0),this.store.hasStartJoinChannel=!0,this.store.isABTestSuccess||this.emit(Gn.UPDATE_GATEWAY_CONFIG),f=this.store.clientId,me(Qh).call(Qh,f)||Qh.push(f);const g=Sm(this.store),_=!((n=this.isPreallocation)===null||n===void 0||!n.call(this)),v=RF(this.store),y=Zle(),b=dc(87)||BM()||jT(117),D=(function(){const j=Lt();if(j.name!==Mt.SAFARI||!j.browserVersion)return!1;const G=j.browserVersion.split(".");return Number(G[0])>18||Number(G[0])===18&&Number(G[1])>=4}()||PM(18,4,!1))&&VT(18,6,!0)&&this.spec.codec==="h264"&&L("ENABLE_ABSSENDTIME_AS_SENTTS"),I=!(((i=d.detail)===null||i===void 0?void 0:i[3])!=="CN"||!L("ENABLE_QUALITY_FALLBACK"))&&L("ENABLE_QUALITY_FALLBACK"),O=!!L("ENABLE_AP_MULTI_IP")&&((o=d.detail)===null||o===void 0?void 0:o[5])==="multi-ip",U=Mr({license:this.joinInfo.license,p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:Aa,browser:navigator.userAgent,process_id:L("PROCESS_ID"),mode:this.store.useP2P?"p2p":this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:O||this.hasChangeBGPAddress,ap_response:d,extend:L("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:this.joinInfo.cloudProxyServer==="proxy3"?"1":this.joinInfo.cloudProxyServer==="proxy5"?"2":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:h,attributes:{userAttributes:Mr(Mr({enableEncodedTransform:(!!L("ENABLE_AUDIO_METADATA")||!!L("ENABLE_AUDIO_PTS"))&&b||!!L("ENABLE_AUDIO_TOPN")&&FT(Mt.CHROME,87,116)||void 0,enableAudioMetadata:!!L("ENABLE_AUDIO_METADATA")&&b,enableAudioPts:!!L("ENABLE_AUDIO_PTS")&&b,topnSmoothLevel:L("TOPN_SMOOTH_LEVEL"),topnNewSpeakerDelay:L("TOPN_NEW_SPEAKER_DELAY"),topnSwitchHoldMs:L("TOPN_SWITCH_HOLD_MS"),topnAudioGain:L("TOPN_AUDIO_GAIN"),enableNetworkQualityProbe:this.store.networkQualityProbe,enablePublishedUserList:L("ENABLE_PUBLISHED_USER_LIST"),maxSubscription:L("MAX_SUBSCRIPTION"),subscribeAudioFilterTopN:xi("SUBSCRIBE_AUDIO_FILTER_TOPN","number"),enablePublishAudioFilter:xi("ENABLE_PUBLISH_AUDIO_FILTER","boolean"),enableUserLicenseCheck:xi("ENABLE_USER_LICENSE_CHECK","boolean"),enableRTX:L("USE_PUB_RTX")===!0||L("USE_SUB_RTX")===!0||void 0,disableFEC:L("DISABLE_FEC"),enableNTPReport:!!L("ENABLE_NTP_REPORT")||void 0,enableInstantVideo:v,enableFulllinkAvSync:!!L("ENABLE_FULL_LINK_AV_SYNC")||void 0,enableDataStream2:xi("ENABLE_DATASTREAM_2","boolean"),enableAutFeedback:!!L("FORCE_ENABLE_AUT_CC")||!Ov()&&(!!L("ENABLE_AUT_FEEDBACK")||void 0),rtm2Flag:typeof this.joinInfo.rtmFlag=="number"?this.joinInfo.rtmFlag:void 0,enableUserAutoRebalanceCheck:!!L("ENABLE_USER_AUTO_REBALANCE_CHECK"),enableXR:xi("USE_XR","boolean"),enableLossbasedBwe:xi("ENABLE_LOSSBASED_BWE","boolean"),enableAutCC:!!L("FORCE_ENABLE_AUT_CC")||!Ov()&&(!!L("ENABLE_AUT_CC")||void 0),enableCCFallback:xi("ENABLE_CC_FALLBACK","boolean"),enablePreallocPC:_,preSubNum:g?xi("PRE_SUB_NUM","number"):void 0,enablePubTWCC:xi("PUBLISH_TWCC","boolean"),enableSubTWCC:xi("SUBSCRIBE_TWCC","boolean"),enablePubRTX:xi("USE_PUB_RTX","boolean"),enableSubRTX:xi("USE_SUB_RTX","boolean"),enableSubSVC:L("ENABLE_SVC")?L("ENABLE_SVC_DEFAULT_CODECS"):Array.isArray(L("SVC"))&&L("SVC").length!==0?L("SVC"):void 0,enableSvcExtended:L("ENABLE_SVC")&&Array.isArray(L("SVC_EXTENDED"))&&L("SVC_EXTENDED").length!==0?L("SVC_EXTENDED"):void 0,enableVosFallback:L("ENABLE_VOS_FALLBACK"),enableQualityFallback:I},y),{},{audioDuplicate:xi("ENABLE_AUDIO_RED","boolean")?(l=xi("AUDIO_DUPLICATE_NUM","number"))!==null&&l!==void 0?l:2:void 0,senttsUsesAbsSendTime:!!D||void 0,enableDualStreamFlag:xi("ENABLE_DUAL_STREAM_FLAG","boolean")})},join_ts:this.joinGatewayStartTime},t);return this.joinInfo.stringUid&&(U.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(U.aes_mode=this.joinInfo.aesmode,L("ENCRYPT_AES")?(U.aes_secret=this.joinInfo.aespassword,U.aes_encrypt=!0):U.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(U.aes_salt=this.joinInfo.aessalt)),d.addresses[this.signal.websocket.currentURLIndex]&&(U.ap_response.ticket=d.addresses[this.signal.websocket.currentURLIndex].ticket,delete d.addresses),this.joinInfo.defaultVideoStream!==void 0&&(U.default_video_stream=this.joinInfo.defaultVideoStream),U}getRejoinMessage(){if(!this.joinInfo)throw new se(P.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){this.signal.on(Ue.WS_RECONNECT_CREATE_CONNECTION,t=>{this.joinGatewayStartTime=Date.now()}),this.signal.on(Ue.WS_RECONNECTING,t=>{this.joinInfo&&ke.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:t||Jr.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",ke.sessionInit(this.joinInfo.sid,{lts:new Date().getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode,stringUid:this.joinInfo.stringUid,channelProfile:this.spec.mode==="live"?1:0,channelMode:0,lsid:this.joinInfo.sid,clientRole:this.role==="audience"?2:1,buildFormat:1}),this.isSignalRecover=!1,this.joinGatewayStartTime=Date.now())}),this.signal.on(Ue.WS_CLOSED,t=>{let n;switch(t){case Ct.LEAVE:n=Jr.LEAVE;break;case Ct.UID_BANNED:case Ct.IP_BANNED:case Ct.CHANNEL_BANNED:case Ct.SERVER_ERROR:n=Jr.SERVER_ERROR;break;case Ct.FALLBACK:n=Jr.FALLBACK;break;case Ct.LICENSE_MISSING:case Ct.LICENSE_EXPIRED:case Ct.LICENSE_MINUTES_EXCEEDED:case Ct.LICENSE_PERIOD_INVALID:case Ct.LICENSE_MULTIPLE_SDK_SERVICE:case Ct.LICENSE_ILLEGAL:case Ct.TOKEN_EXPIRE:n=t;break;default:n=Jr.NETWORK_ERROR}S.debug("[".concat(this.store.clientId,"] [signal] websocket closed, reason: ").concat(n||"undefined -> "+Jr.NETWORK_ERROR)),this.joinInfo&&ke.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:t===Ct.LEAVE?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:n}),this._disconnectedReason=t,t!==Ct.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}),this.signal.on(Ue.WS_CONNECTED,()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo){if(this.role==="audience"){const t=L("CLIENT_ROLE_OPTIONS")||this._clientRoleOptions;t&&(t.level||t.delay)&&(S.debug("[".concat(this.store.clientId,"] patch to send set client role, role: ").concat(this.role,", mode: ").concat(this.spec.mode,", level: ").concat(t.level,", delay: ").concat(t.delay)),this.setClientRole(this.role,t))}if(ke.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,isProxy:!!this.joinInfo.proxyServer||this.usingProxy,signalChannel:this.signal.__name__==="DataChannelSignal"?"1":"0",preload:this.joinInfo.preload,isABTestSuccess:this.store.isABTestSuccess}),this._isProactiveJoin=!1,this.joinInfo.useLocalAccessPoint&&this.joinInfo.setLocalAPVersion===1){const t=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);if(!t)return void S.error("[".concat(this.store.clientId,"] set local access point after joined failed: ").concat(t));en("EVENT_REPORT_DOMAIN",t[1]),en("EVENT_REPORT_BACKUP_DOMAIN",t[1]),en("LOG_UPLOAD_SERVER","".concat(t[1],":6444"))}}}),this.signal.on(nt.ON_UPLINK_STATS,t=>{this._statsCollector.updateUplinkStats(t)}),this.signal.on(Ue.REQUEST_RECOVER,(t,n,i)=>{if(!this.joinInfo)return i(new se(P.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));t&&(this.joinInfo.multiIP=t,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,ir(this,Gn.REQUEST_NEW_GATEWAY_LIST).then(n).catch(i)}),this.signal.on(Ue.REQUEST_JOIN_INFO,async(t,n,i)=>{var o,l,d;if(this.updateTurnConfigFromSignal(),this.store.useP2P)return void t(this.getJoinMessage({ortc:{}}));const h=_n((o=this.joinInfo)===null||o===void 0?void 0:o.turnServer);if(L("NEW_TURN_MODE")&&h&&((l=this.joinInfo)===null||l===void 0?void 0:l.cloudProxyServer)==="disabled"){var f;let y=h.servers.map(I=>"turnServerURL"in I&&L("USE_TURN_IP")?Mr(Mr({},I),{},{turnServerURL:e0(I.turnServerURL)}):I),b=(f=h.serversFromGateway)===null||f===void 0?void 0:f.map(I=>L("USE_TURN_IP")?Mr(Mr({},I),{},{turnServerURL:e0(I.turnServerURL)}):I);const D=this.signal.currentURLIndex;y.length>0&&(y=[y[D%y.length]],h.servers=y),Array.isArray(b)&&b.length>0&&(b=[b[0]],h.serversFromGateway=b),S.debug("[".concat(this.store.clientId,"] use single turn, use turn server index: ").concat(D))}const{iceParameters:g,dtlsParameters:_,rtpCapabilities:v}=await ir(this,Gn.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:h,cloudProxyServer:(d=this.joinInfo)===null||d===void 0?void 0:d.cloudProxyServer});try{t(this.getJoinMessage({ortc:{iceParameters:g,dtlsParameters:_,rtpCapabilities:v,version:"2"}}))}catch(y){n(y)}}),this.signal.on(Ue.REQUEST_REJOIN_INFO,t=>{t(this.getRejoinMessage())}),this.signal.on(Ue.REPORT_JOIN_GATEWAY,(t,n)=>{if(!this.joinInfo)return;let i,o="";var l;t instanceof se?(i=((l=t.data)===null||l===void 0?void 0:l.desc)||t.code,o=t.message):i=t,ke.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:i,errorMsg:o,addr:n,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,isProxy:!!this.joinInfo.proxyServer||this.usingProxy,signalChannel:this.signal.__name__==="DataChannelSignal"?"1":"0",preload:this.joinInfo.preload})}),this.signal.on(Ue.IS_P2P_DISCONNECTED,t=>{t(bd(this,Gn.IS_P2P_DISCONNECTED))}),this.signal.on(Ue.DISCONNECT_P2P,()=>{this.emit(Gn.DISCONNECT_P2P)}),this.signal.on(Ue.REQUEST_SUCCESS,()=>{this._signalTimeout=!1}),this.signal.on(Ue.REQUEST_TIMEOUT,()=>{this._signalTimeout=!0}),this.signal.on(Ue.JOIN_RESPONSE,t=>{const n=this.getCurrentGatewayAddress();this.emit(Gn.JOIN_RESPONSE,t,n)}),this.signal.on(Ue.PRE_CONNECT_PC,async(t,n)=>{if(this.joinInfo){var i,o;this.updateTurnConfigFromSignal();const d=this.getCurrentGatewayAddress(),h=_n((i=this.joinInfo)===null||i===void 0?void 0:i.turnServer);if(L("NEW_TURN_MODE")&&h&&((o=this.joinInfo)===null||o===void 0?void 0:o.cloudProxyServer)==="disabled"){var l;let g=h.servers.map(y=>"turnServerURL"in y&&L("USE_TURN_IP")?Mr(Mr({},y),{},{turnServerURL:e0(y.turnServerURL)}):y),_=(l=h.serversFromGateway)===null||l===void 0?void 0:l.map(y=>L("USE_TURN_IP")?Mr(Mr({},y),{},{turnServerURL:e0(y.turnServerURL)}):y);const v=this.signal.currentURLIndex;g.length>0&&(g=[g[v%g.length]],h.servers=g),Array.isArray(_)&&_.length>0&&(_=[_[0]],h.serversFromGateway=_),S.debug("[".concat(this.store.clientId,"] use single turn, use turn server index: ").concat(v,",in pre pc"))}const f=L("FINGERPRINT")||this.joinInfo.apResponse.addresses[this.signal.currentURLIndex].fingerprint;if(d&&f){const g=gV(d);ir(this,Gn.PRE_CONNECT_PC,{candidates:g,fingerprint:f,turnServer:h}).then(_=>{t==null||t(_)}).catch(n||(()=>{}))}}}),this.signal.on(Ue.RECOVER_NOTIFICATION,t=>{this.joinInfo&&typeof L("AP_REQUEST_DETAIL")=="string"&&(this.joinInfo.apRequestDetail="".concat(L("AP_REQUEST_DETAIL"),";").concat(t))}),this.signal.on(Ue.VOS_FALLBACK,t=>{this.emit(Gn.VOS_FALLBACK,t)}),this.signal.on(Ue.DATACHANNEL_FAILBACK,t=>{S.warning("[".concat(this.store.clientId,"] User join datachannel failed")),this.reset(),this.resetSignal(),this.emit(Gn.DATACHANNEL_FAILBACK)})}async tryUnsubBeforeResub(t,n){try{await this.signal.request(je.UNSUBSCRIBE,{p2p_id:this.store.p2pId,stream_id:t,ortc:[n]},!0)}catch(i){throw S.warning("[".concat(this.store.clientId,"] tryUnsubBeforeResub warning"),i),i}}async tryUnsubDataChannelBeforeResub(t,n){try{await this.signal.request(je.UNSUBSCRIBE,{stream_id:n.id},!0)}catch(i){throw S.warning("unsubscribe datachannel warning",i),i}}async tryUnpubBeforeRepub(t,n){try{await this.signal.request(je.UNPUBLISH,{stream_id:t,ortc:n},!0)}catch(i){throw S.warning("[".concat(this.store.clientId,"] tryUnpubBeforeRepub warning: "),i),i}}async tryUnpubDataChannelBeforeRepub(t,n){try{await this.signal.request(je.UNPUBLISH_DATASTREAM,{channnel_id:n.channelId},!0)}catch(i){throw S.warning("unpublish datastream warning: ",i),i}}async tryMassUnsubBeforeResub(t){const n={users:t.map(i=>({stream_id:i.stream_id,stream_type:i.stream_type}))};try{await this.signal.request(je.UNSUBSCRIBE_STREAMS,n,!0)}catch(i){throw S.warning("[".concat(this.store.clientId,"] tryMassUnsubBeforeResub warning"),i),i}}async muteLocal(t,n){const i={action:t.find(o=>o.stream_type===Xt.Audio)?"mute_local_audio":"mute_local_video",p2p_id:this.store.p2pId,ortc:t,stream_id:n};try{await this.signal.request(je.CONTROL,i,!0,!0)}catch(o){throw S.warning("[".concat(this.store.clientId,"] gateway muteLocal warning: "),o),o}}async unmuteLocal(t,n){const i={action:t.find(o=>o.stream_type===Xt.Audio)?"unmute_local_audio":"unmute_local_video",p2p_id:this.store.p2pId,ortc:t,stream_id:n};try{await this.signal.request(je.CONTROL,i,!0,!0)}catch(o){throw S.warning("[".concat(this.store.clientId,"] gateway unmuteLocal warning: "),o),o}}async muteRemote(t,n){const i={action:t===xe.AUDIO?"mute_remote_audio":"mute_remote_video",p2p_id:this.store.p2pId,stream_id:n};try{await this.signal.request(je.CONTROL,i,!0,!0)}catch(o){throw S.warning("[".concat(this.store.clientId,"] gateway muteRemote warning: "),o),o}}async unmuteRemote(t,n){const i={action:t===xe.AUDIO?"unmute_remote_audio":"unmute_remote_video",p2p_id:this.store.p2pId,stream_id:n};try{await this.signal.request(je.CONTROL,i,!0,!0)}catch(o){throw S.warning("[".concat(this.store.clientId,"] gateway unmuteRemote warning: "),o),o}}uploadWRTCStats(t){this.signal.uploadWRTCStats(t)}upload(t,n){this.signal.upload(t,n)}getSignalRTT(){return this.signal.rtt}async restartICE(t){const n={p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:t};try{return await this.signal.request(je.RESTART_ICE,n,!0)}catch(i){throw S.warning("[".concat(this.store.clientId,"] P2PChannel.restartICE warning: "),i),i}}reconnect(t,n){this.state==="CONNECTED"&&this.signal.reconnect(t||void 0,n||Jr.P2P_FAILED)}getCurrentGatewayAddress(){var t,n;if(!L("GATEWAY_WSS_ADDRESS"))return L("USE_CANDIDATE_FROM_AP_DETAIL")&&(t=this.joinInfo)!==null&&t!==void 0&&t.apGatewayAddress?(S.debug("[".concat(this.store.clientId,"] use candidate from ap detail, ").concat(JSON.stringify(this.joinInfo.apGatewayAddress))),this.joinInfo.apGatewayAddress):(n=this.joinInfo)!==null&&n!==void 0&&n.gatewayAddrs?this.joinInfo.gatewayAddrs[this.signal.currentURLIndex]:void 0}async setPublishAudioFilterEnabled(t){await this.signal.request(je.SET_PARAMETER,{enablePublishAudioFilter:t})}downgradeCodec(t){this.signal.downgradeCodec(t)}resetSignal(){this.signal&&(this.signal.removeAllListeners(),this.signal.close(Ct.FALLBACK)),this.store.useDcSignal=!1,this.signal=new iV(Mr(Mr({},this.spec),{},{retryConfig:this.spec.websocketRetryConfig}),this.store),this.handleSignalEvents(),this.emit(Gn.RESET_SIGNAL)}}let o0=0,sI=0;function Mo(e,t,n,i){return new be((o,l)=>{t.timeout=t.timeout||L("HTTP_CONNECT_TIMEOUT"),t.responseType=t.responseType||"json",t.data&&!n?(t.data=JSON.stringify(t.data),o0+=hc(t.data)):n&&(t.data.size?o0+=t.data.size:t.data instanceof FormData?o0+=rF(t.data):o0+=hc(JSON.stringify(t.data))),t.headers=t.headers||{},t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json",t.method="POST",t.url=e,Xs.request(t).then(d=>{typeof d.data=="string"?sI+=hc(d.data):d.data instanceof ArrayBuffer||d.data instanceof Uint8Array?sI+=d.data.byteLength:sI+=hc(JSON.stringify(d.data)),i&&o({data:d.data,headers:d.headers}),o(d.data)}).catch(d=>{Xs.isCancel(d)?l(new se(P.OPERATION_ABORTED,"cancel token canceled")):d.code==="ECONNABORTED"?l(new se(P.NETWORK_TIMEOUT,d.message)):d.response?l(new se(P.NETWORK_RESPONSE_ERROR,d.response.status)):l(new se(P.NETWORK_ERROR,d.message))})})}/*! formdata-polyfill. MIT License. Jimmy W?rting <https://jimmy.warting.se/opensource> */(function(){var e;function t(he){var ve=0;return function(){return ve<he.length?{done:!1,value:he[ve++]}:{done:!0}}}var n=typeof Object.defineProperties=="function"?Object.defineProperty:function(he,ve,Be){return he==Array.prototype||he==Object.prototype||(he[ve]=Be.value),he},i,o=function(he){he=[typeof globalThis=="object"&&globalThis,he,typeof window=="object"&&window,typeof self=="object"&&self,typeof c=="object"&&c];for(var ve=0;ve<he.length;++ve){var Be=he[ve];if(Be&&Be.Math==Math)return Be}throw Error("Cannot find global object")}(this);function l(he,ve){if(ve)e:{var Be=o;he=he.split(".");for(var pe=0;pe<he.length-1;pe++){var R=he[pe];if(!(R in Be))break e;Be=Be[R]}(ve=ve(pe=Be[he=he[he.length-1]]))!=pe&&ve!=null&&n(Be,he,{configurable:!0,writable:!0,value:ve})}}function d(he){return(he={next:he})[Symbol.iterator]=function(){return this},he}function h(he){var ve=typeof Symbol<"u"&&Symbol.iterator&&he[Symbol.iterator];return ve?ve.call(he):{next:t(he)}}if(l("Symbol",function(he){function ve(R,H){this.A=R,n(this,"description",{configurable:!0,writable:!0,value:H})}if(he)return he;ve.prototype.toString=function(){return this.A};var Be="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",pe=0;return function R(H){if(this instanceof R)throw new TypeError("Symbol is not a constructor");return new ve(Be+(H||"")+"_"+pe++,H)}}),l("Symbol.iterator",function(he){if(he)return he;he=Symbol("Symbol.iterator");for(var ve="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),Be=0;Be<ve.length;Be++){var pe=o[ve[Be]];typeof pe=="function"&&typeof pe.prototype[he]!="function"&&n(pe.prototype,he,{configurable:!0,writable:!0,value:function(){return d(t(this))}})}return he}),typeof Object.setPrototypeOf=="function")i=Object.setPrototypeOf;else{var f;e:{var g={};try{g.__proto__={a:!0},f=g.a;break e}catch{}f=!1}i=f?function(he,ve){if(he.__proto__=ve,he.__proto__!==ve)throw new TypeError(he+" is not extensible");return he}:null}var _=i;function v(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function y(he){if(he.m)throw new TypeError("Generator is already running");he.m=!0}function b(he,ve){return he.h=3,{value:ve}}function D(he){this.g=new v,this.G=he}function I(he,ve,Be,pe){try{var R=ve.call(he.g.j,Be);if(!(R instanceof Object))throw new TypeError("Iterator result "+R+" is not an object");if(!R.done)return he.g.m=!1,R;var H=R.value}catch(J){return he.g.j=null,he.g.s(J),O(he)}return he.g.j=null,pe.call(he.g,H),O(he)}function O(he){for(;he.g.h;)try{var ve=he.G(he.g);if(ve)return he.g.m=!1,{value:ve.value,done:!1}}catch(Be){he.g.v=void 0,he.g.s(Be)}if(he.g.m=!1,he.g.l){if(ve=he.g.l,he.g.l=null,ve.F)throw ve.D;return{value:ve.return,done:!0}}return{value:void 0,done:!0}}function U(he){this.next=function(ve){return he.o(ve)},this.throw=function(ve){return he.s(ve)},this.return=function(ve){return function(Be,pe){y(Be.g);var R=Be.g.j;return R?I(Be,"return"in R?R.return:function(H){return{value:H,done:!0}},pe,Be.g.return):(Be.g.return(pe),O(Be))}(he,ve)},this[Symbol.iterator]=function(){return this}}function j(he,ve){return ve=new U(new D(ve)),_&&he.prototype&&_(ve,he.prototype),ve}if(v.prototype.o=function(he){this.v=he},v.prototype.s=function(he){this.l={D:he,F:!0},this.h=this.C||this.u},v.prototype.return=function(he){this.l={return:he},this.h=this.u},D.prototype.o=function(he){return y(this.g),this.g.j?I(this,this.g.j.next,he,this.g.o):(this.g.o(he),O(this))},D.prototype.s=function(he){return y(this.g),this.g.j?I(this,this.g.j.throw,he,this.g.o):(this.g.s(he),O(this))},l("Array.prototype.entries",function(he){return he||function(){return function(ve,Be){ve instanceof String&&(ve+="");var pe=0,R=!1,H={next:function(){if(!R&&pe<ve.length){var J=pe++;return{value:Be(J,ve[J]),done:!1}}return R=!0,{done:!0,value:void 0}}};return H[Symbol.iterator]=function(){return H},H}(this,function(ve,Be){return[ve,Be]})}}),typeof Blob<"u"&&(typeof FormData>"u"||!FormData.prototype.keys)){var G=function(he,ve){for(var Be=0;Be<he.length;Be++)ve(he[Be])},$=function(he){return he.replace(/\r?\n|\r/g,`\r
`)},Z=function(he,ve,Be){return ve instanceof Blob?(Be=Be!==void 0?Be+"":typeof ve.name=="string"?ve.name:"blob",ve.name===Be&&Object.prototype.toString.call(ve)!=="[object Blob]"||(ve=new File([ve],Be)),[String(he),ve]):[String(he),String(ve)]},X=function(he,ve){if(he.length<ve)throw new TypeError(ve+" argument required, but only "+he.length+" present.")},ee=typeof globalThis=="object"?globalThis:typeof window=="object"?window:typeof self=="object"?self:this,le=ee.FormData,fe=ee.XMLHttpRequest&&ee.XMLHttpRequest.prototype.send,Ie=ee.Request&&ee.fetch,et=ee.navigator&&ee.navigator.sendBeacon,Je=ee.Element&&ee.Element.prototype,pt=ee.Symbol&&Symbol.toStringTag;pt&&(Blob.prototype[pt]||(Blob.prototype[pt]="Blob"),"File"in ee&&!File.prototype[pt]&&(File.prototype[pt]="File"));try{new File([],"")}catch{ee.File=function(ve,Be,pe){return ve=new Blob(ve,pe||{}),Object.defineProperties(ve,{name:{value:Be},lastModified:{value:+(pe&&pe.lastModified!==void 0?new Date(pe.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),pt&&Object.defineProperty(ve,pt,{value:"File"}),ve}}var ct=function(he){return he.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},jt=function(he){this.i=[];var ve=this;he&&G(he.elements,function(Be){if(Be.name&&!Be.disabled&&Be.type!=="submit"&&Be.type!=="button"&&!Be.matches("form fieldset[disabled] *"))if(Be.type==="file"){var pe=Be.files&&Be.files.length?Be.files:[new File([],"",{type:"application/octet-stream"})];G(pe,function(R){ve.append(Be.name,R)})}else Be.type==="select-multiple"||Be.type==="select-one"?G(Be.options,function(R){!R.disabled&&R.selected&&ve.append(Be.name,R.value)}):Be.type==="checkbox"||Be.type==="radio"?Be.checked&&ve.append(Be.name,Be.value):(pe=Be.type==="textarea"?$(Be.value):Be.value,ve.append(Be.name,pe))})};if((e=jt.prototype).append=function(he,ve,Be){X(arguments,2),this.i.push(Z(he,ve,Be))},e.delete=function(he){X(arguments,1);var ve=[];he=String(he),G(this.i,function(Be){Be[0]!==he&&ve.push(Be)}),this.i=ve},e.entries=function he(){var ve,Be=this;return j(he,function(pe){if(pe.h==1&&(ve=0),pe.h!=3)return ve<Be.i.length?pe=b(pe,Be.i[ve]):(pe.h=0,pe=void 0),pe;ve++,pe.h=2})},e.forEach=function(he,ve){X(arguments,1);for(var Be=h(this),pe=Be.next();!pe.done;pe=Be.next()){var R=h(pe.value);pe=R.next().value,R=R.next().value,he.call(ve,R,pe,this)}},e.get=function(he){X(arguments,1);var ve=this.i;he=String(he);for(var Be=0;Be<ve.length;Be++)if(ve[Be][0]===he)return ve[Be][1];return null},e.getAll=function(he){X(arguments,1);var ve=[];return he=String(he),G(this.i,function(Be){Be[0]===he&&ve.push(Be[1])}),ve},e.has=function(he){X(arguments,1),he=String(he);for(var ve=0;ve<this.i.length;ve++)if(this.i[ve][0]===he)return!0;return!1},e.keys=function he(){var ve,Be,pe,R,H=this;return j(he,function(J){if(J.h==1&&(ve=h(H),Be=ve.next()),J.h!=3)return Be.done?void(J.h=0):(pe=Be.value,R=h(pe),b(J,R.next().value));Be=ve.next(),J.h=2})},e.set=function(he,ve,Be){X(arguments,2),he=String(he);var pe=[],R=Z(he,ve,Be),H=!0;G(this.i,function(J){J[0]===he?H&&(H=!pe.push(R)):pe.push(J)}),H&&pe.push(R),this.i=pe},e.values=function he(){var ve,Be,pe,R,H=this;return j(he,function(J){if(J.h==1&&(ve=h(H),Be=ve.next()),J.h!=3)return Be.done?void(J.h=0):(pe=Be.value,(R=h(pe)).next(),b(J,R.next().value));Be=ve.next(),J.h=2})},jt.prototype._asNative=function(){for(var he=new le,ve=h(this),Be=ve.next();!Be.done;Be=ve.next()){var pe=h(Be.value);Be=pe.next().value,pe=pe.next().value,he.append(Be,pe)}return he},jt.prototype._blob=function(){var he="----formdata-polyfill-"+Math.random(),ve=[],Be="--"+he+`\r
Content-Disposition: form-data; name="`;return this.forEach(function(pe,R){return typeof pe=="string"?ve.push(Be+ct($(R))+`"\r
\r
`+$(pe)+`\r
`):ve.push(Be+ct($(R))+'"; filename="'+ct(pe.name)+`"\r
Content-Type: `+(pe.type||"application/octet-stream")+`\r
\r
`,pe,`\r
`)}),ve.push("--"+he+"--"),new Blob(ve,{type:"multipart/form-data; boundary="+he})},jt.prototype[Symbol.iterator]=function(){return this.entries()},jt.prototype.toString=function(){return"[object FormData]"},Je&&!Je.matches&&(Je.matches=Je.matchesSelector||Je.mozMatchesSelector||Je.msMatchesSelector||Je.oMatchesSelector||Je.webkitMatchesSelector||function(he){for(var ve=(he=(this.document||this.ownerDocument).querySelectorAll(he)).length;0<=--ve&&he.item(ve)!==this;);return-1<ve}),pt&&(jt.prototype[pt]="FormData"),fe){var bn=ee.XMLHttpRequest.prototype.setRequestHeader;ee.XMLHttpRequest.prototype.setRequestHeader=function(he,ve){bn.call(this,he,ve),he.toLowerCase()==="content-type"&&(this.B=!0)},ee.XMLHttpRequest.prototype.send=function(he){he instanceof jt?(he=he._blob(),this.B||this.setRequestHeader("Content-Type",he.type),fe.call(this,he)):fe.call(this,he)}}Ie&&(ee.fetch=function(he,ve){return ve&&ve.body&&ve.body instanceof jt&&(ve.body=ve.body._blob()),Ie.call(this,he,ve)}),et&&(ee.navigator.sendBeacon=function(he,ve){return ve instanceof jt&&(ve=ve._asNative()),et.call(this,he,ve)}),ee.FormData=jt}})();const Lm=()=>{const e=L("AREAS");return e.length===0&&e.push(Ht.GLOBAL),ca(e).call(e,(t,n,i)=>{const o=IV(n);return o?i===0?o:"".concat(t,",").concat(o):t},"")},IV=e=>e===Ht.OVERSEA?"".concat(as.ASIA,",").concat(as.EUROPE,",").concat(as.AFRICA,",").concat(as.NORTH_AMERICA,",").concat(as.SOUTH_AMERICA,",").concat(as.OCEANIA):as[e],tAe=e=>{const t={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return e.map(n=>{const i=Jv[n],o=Object.keys(i);o&&o.map(l=>{l!=="CODE"&&(t[l]=t[l].concat(i[l]))})}),t},c0={GLOBAL:{ASIA:[Ht.CHINA,Ht.JAPAN,Ht.INDIA,Ht.KOREA,Ht.HKMC],EUROPE:[],NORTH_AMERICA:[Ht.US],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},l0=Object.keys(c0[Ht.GLOBAL]),iI=[Ht.CHINA,Ht.NORTH_AMERICA,Ht.EUROPE,Ht.ASIA,Ht.JAPAN,Ht.INDIA,Ht.OCEANIA,Ht.SOUTH_AMERICA,Ht.AFRICA,Ht.KOREA,Ht.HKMC,Ht.US],nAe=function(e,t){let n=[];if(me(e).call(e,Ht.GLOBAL)){const l=[Ht.GLOBAL,Ht.OVERSEA],d=Object.keys(Jv);if(t===Ht.GLOBAL)throw new se(P.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(t===Ht.CHINA)n=[Ht.OVERSEA];else if(o=t,me(l0).call(l0,o)){const h=(i=t,c0[Ht.GLOBAL][i]||[]),f=[...l,t,...h];n=d.filter(g=>!me(f).call(f,g))}else if(function(h){let f=!1;return l0.forEach(g=>{var _;me(_=c0[Ht.GLOBAL][g]).call(_,h)&&(f=!0)}),f}(t)){const h=function(g){let _;return l0.forEach(v=>{var y;me(y=c0[Ht.GLOBAL][v]).call(y,g)&&(_=v)}),_}(t),f=[...l,h,t];n=d.filter(g=>!me(f).call(f,g))}else n=e;n=function(h){const f=[];return iI.forEach(g=>{me(h).call(h,g)&&f.push(g)}),f.concat(h.filter(g=>!me(iI).call(iI,g)))}(n)}else n=e;var i,o;return n};function NV(e){var t,n;if(!e&&me(t=L("AREAS")).call(t,Ht.EXTENSIONS))return S.debug("update area from ap : reset"),void aI(dle,!0);if(!me(n=L("AREAS")).call(n,Ht.GLOBAL)||!e)return;let i=Jv.EXTENSIONS;i&&(i={CODE:IV(Ht.EXTENSIONS),WEBCS_DOMAIN:["ap-web-1-".concat(e,".agora.io")],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-".concat(e,".ap.sd-rtn.com")],PROXY_CS:["proxy-ap-web-".concat(e,".agora.io")],CDS_AP:["cds-ap-web-1-".concat(e,".agora.io"),"cds-ap-web-2-".concat(e,".ap.sd-rtn.com")],ACCOUNT_REGISTER:["sua-ap-web-1-".concat(e,".agora.io"),"sua-ap-web-2-".concat(e,".ap.sd-rtn.com")],UAP_AP:["uap-ap-web-1-".concat(e,".agora.io"),"uap-ap-web-2-".concat(e,".ap.sd-rtn.com")],EVENT_REPORT_DOMAIN:["statscollector-1-".concat(e,".agora.io")],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-".concat(e,".agora.io")],LOG_UPLOAD_SERVER:["logservice-".concat(e,".agora.io")],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy-".concat(e,".agora.io")]},S.debug("update area from ap success: ".concat(e,",config is "),i),en("AREAS",[Ht.EXTENSIONS],!0),Object.keys(i).map(o=>{o==="LOG_UPLOAD_SERVER"||o==="EVENT_REPORT_DOMAIN"||o==="EVENT_REPORT_BACKUP_DOMAIN"||o==="PROXY_SERVER_TYPE3"?en(o,i[o][0]):en(o,i[o])}))}function aI(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const n=ke.reportApiInvoke(null,{name:yn.SET_AREA,options:e,tag:an.TRACER});try{let i=[];if(typeof e=="string"&&(i=[e]),Array.isArray(e)&&(e.forEach(l=>{if(!me($4).call($4,l))throw new se(P.INVALID_PARAMS,"invalid area code")}),i=e),Object.prototype.toString.call(e)==="[object Object]"){const{areaCode:l,excludedArea:d}=e;if(!l)throw new se(P.INVALID_PARAMS,"area code is needed");let h=l;typeof l=="string"&&(h=[l]),i=d?nAe(h,d):h}if(!t){if(Vi.AREAS){const l=new se(P.PROHIBITED_OPERATION,"setArea is prohibited because of config-distribute");return n.onError(l),void S.warning("setArea is prohibited because of config-distribute")}if(me(i).call(i,Ht.GLOBAL)&&L("AREAS")===Ht.EXTENSIONS){const l=new se(P.PROHIBITED_OPERATION,"setArea is prohibited because of ap extensions");return n.onError(l),void S.warning("setArea is prohibited because of ap extensions")}}en("AREAS",i,t);const o=tAe(i);Object.keys(o).map(l=>{l==="LOG_UPLOAD_SERVER"||l==="EVENT_REPORT_DOMAIN"||l==="EVENT_REPORT_BACKUP_DOMAIN"||l==="PROXY_SERVER_TYPE3"?en(l,o[l][0]):en(l,o[l])}),S.debug("set area success:",i.join(","))}catch(i){throw n.onError(i),i}n.onSuccess()}function OV(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}function vc(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?OV(Object(n),!0).forEach(function(i){x(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):OV(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}let oI=1;function rAe(e,t,n,i,o){oI+=1;const l={sid:n.sid,command:"convergeAllocateEdge",uid:"666",appId:n.appId,ts:Math.floor(Date.now()/1e3),seq:oI,requestId:oI,version:Aa,cname:n.cname},d={service_name:t,json_body:JSON.stringify(l)};let h,f,g=e[0];return Do(async()=>{h=Date.now();const _=await Mo(g,{data:d,cancelToken:i,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(f=Date.now()-h,_.code!==0){const b=new se(P.UNEXPECTED_RESPONSE,"live streaming ap error, code"+_.code,{retry:!0,responseTime:f});throw S.error(b.toString()),b}const v=JSON.parse(_.json_body);if(v.code!==200){const b=new se(P.UNEXPECTED_RESPONSE,"live streaming app center error, code: ".concat(v.code,", reason: ").concat(v.reason),{code:v.code,responseTime:f});throw S.error(b.toString()),b}if(!v.servers||v.servers.length===0){const b=new se(P.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:v.code,responseTime:f});throw S.error(b.toString()),b}const y=function(b,D){return{addressList:b.servers.map(I=>"wss://".concat(I.address.replace(/\./g,"-"),".").concat(L("WORKER_DOMAIN"),":").concat(I.wss,"?serviceName=").concat(encodeURIComponent(D))),workerToken:b.workerToken,vid:b.vid}}(v,t);return L("LIVE_STREAMING_ADDRESS")&&(y.addressList=L("LIVE_STREAMING_ADDRESS")instanceof Array?L("LIVE_STREAMING_ADDRESS"):[L("LIVE_STREAMING_ADDRESS")]),vc(vc({},y),{},{responseTime:f})},(_,v)=>(ke.apworkerEvent(n.sid,{success:!0,sc:200,serviceName:t,responseDetail:JSON.stringify(_.addressList),firstSuccess:v===0,responseTime:f,serverIp:e[v%e.length]}),!1),(_,v)=>(ke.apworkerEvent(n.sid,{success:!1,sc:_.data&&_.data.code||200,serviceName:t,responseTime:f,serverIp:e[v%e.length]}),!!(_.code!==P.OPERATION_ABORTED&&_.code!==P.UNEXPECTED_RESPONSE||_.data&&_.data.retry)&&(g=e[(v+1)%e.length],!0)),o)}let cI=1;function xV(e,t,n,i){let{url:o,areaCode:l}=e;const{clientId:d,sid:h}=t,f=Date.now();let g;const _=t.role,[v,y]=AI(t,l,[Xn.CHOOSE_SERVER]);let b=Ln.networkState;return Do(async()=>{b&&Ln.networkState===Us.OFFLINE&&Ln.onlineWaiter&&await be.race([Ln.onlineWaiter,Sr(i&&i.maxRetryTimeout||qn.maxRetryTimeout)]),b=Ln.networkState;const{data:D,headers:I}=await Mo(o,{data:v,cancelToken:n,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);g=I.http3==="1"?1:-1,ke.reportResourceTiming(o,h),BV(D,o,t,f,[Xn.CHOOSE_SERVER],g);const O=Nm(D,Xn.CHOOSE_SERVER);return lI(O),qR(O,o)},D=>(D&&ke.joinChooseServer(h,{role:_,lts:f,succ:!0,csAddr:o,opid:y,serverList:D.gatewayAddrs.map(I=>I.address),ec:null,cid:D.cid.toString(),uid:D.uid.toString(),csIp:D.csIp,unilbsServerIds:[Xn.CHOOSE_SERVER].toString(),isHttp3:g,corssRegionTagReq:t.apRequestDetail,corssRegionTagRes:D.res.detail&&D.res.detail[38],vid:D.vid}),!1),D=>D.code!==P.OPERATION_ABORTED&&(D.code===P.CAN_NOT_GET_GATEWAY_SERVER?D.data.retry:(ke.joinChooseServer(h,{role:_,lts:f,succ:!1,csAddr:o,serverList:null,opid:y,ec:D.code,csIp:D.data&&D.data.csIp,unilbsServerIds:[Xn.CHOOSE_SERVER].toString(),extend:JSON.stringify({networkState:b}),isHttp3:g,corssRegionTagReq:t.apRequestDetail}),S.warning("[".concat(d||"sid-".concat(h.slice(0,6)),"] Choose server network error, retry"),D),!0)),i)}function DV(e,t,n,i){let o,{url:l,areaCode:d,serviceIds:h}=e;const f=Date.now(),g=t.role,[_,v]=AI(t,d,h);let y;return Do(async()=>{y&&Ln.networkState===Us.OFFLINE&&Ln.onlineWaiter&&await be.race([Ln.onlineWaiter,Sr(i&&i.maxRetryTimeout||qn.maxRetryTimeout)]),y=Ln.networkState;const{data:b,headers:D}=await Mo(l,{data:_,cancelToken:n,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);o=D.http3==="1"?1:-1,ke.reportResourceTiming(l,t.sid),BV(b,l,t,f,h,o);const I=Nm(b,Xn.CHOOSE_SERVER),O=Nm(b,t.cloudProxyServer==="proxy5"?Xn.CLOUD_PROXY_5:t.cloudProxyServer==="proxy3"||t.cloudProxyServer==="proxy4"?Xn.CLOUD_PROXY:Xn.CLOUD_PROXY_FALLBACK),U=performance.getEntriesByName(l),j=U[U.length-1];let G;return j&&(G={name:j.name,protocol:"nextHopProtocol"in j?j.nextHopProtocol:"",dnscost:"domainLookupEnd"in j&&"domainLookupStart"in j&&typeof j.domainLookupEnd=="number"&&typeof j.domainLookupStart=="number"?j.domainLookupEnd-j.domainLookupStart:-1,tcpTlsCost:"connectEnd"in j&&"connectStart"in j&&typeof j.connectEnd=="number"&&typeof j.connectStart=="number"?j.connectEnd-j.connectStart:-1,reqCost:"requestStart"in j&&typeof j.requestStart=="number"&&"responseEnd"in j&&typeof j.responseEnd=="number"?j.responseEnd-j.requestStart:-1,handleCost:"leave_ts"in b&&"enter_ts"in b&&typeof b.leave_ts=="number"&&typeof b.enter_ts=="number"?b.leave_ts-b.enter_ts:-1}),lI(I),{gatewayInfo:qR(I,l),proxyInfo:O,url:l,resourceTimingInfo:G}},b=>{var D;return b.gatewayInfo&&ke.joinChooseServer(t.sid,{role:g,lts:f,succ:!0,csAddr:l,serverList:b.gatewayInfo.gatewayAddrs.map(I=>I.address),ec:null,opid:v,cid:b.gatewayInfo.cid.toString(),uid:b.gatewayInfo.uid.toString(),csIp:b.gatewayInfo.csIp,unilbsServerIds:h.toString(),isHttp3:o,corssRegionTagReq:t.apRequestDetail,corssRegionTagRes:b.gatewayInfo.res.detail&&b.gatewayInfo.res.detail[38],vid:(D=b.gatewayInfo)===null||D===void 0?void 0:D.vid,resourceTimingInfo:b.resourceTimingInfo?JSON.stringify(b.resourceTimingInfo):void 0}),b.proxyInfo&&ke.joinWebProxyAP(t.sid,{lts:f,sucess:1,apServerAddr:l,turnServerAddrList:b.proxyInfo.addresses.map(I=>I.ip).join(","),errorCode:null,eventType:t.cloudProxyServer,unilbsServerIds:h.toString()}),!1},b=>b.code!==P.OPERATION_ABORTED&&(b.code===P.CAN_NOT_GET_GATEWAY_SERVER?b.data.retry:(ke.joinWebProxyAP(t.sid,{lts:f,sucess:0,apServerAddr:l,turnServerAddrList:null,errorCode:b.code,eventType:t.cloudProxyServer,unilbsServerIds:h.toString(),extend:JSON.stringify({networkState:y})}),S.warning("[".concat(t.clientId,"] multi unilbs network error, retry"),b),!0)),i)}const BV=(e,t,n,i,o,l)=>{const{sid:d,clientId:h,cloudProxyServer:f}=n,g=[],_=v=>{v.flag===4096?ke.joinChooseServer(d,{role:n.role,lts:i,succ:!1,csAddr:t,opid:e.opid,serverList:null,ec:v.error.message,csIp:v.error.data&&v.error.data.csIp,unilbsServerIds:o.toString(),isHttp3:l,corssRegionTagReq:n.apRequestDetail}):v.flag!==1048576&&v.flag!==4194304&&v.flag!==4194310||ke.joinWebProxyAP(d,{lts:i,sucess:0,apServerAddr:t,turnServerAddrList:null,errorCode:v.error.code,eventType:f,unilbsServerIds:o.toString()})};if(e.response_body.forEach(v=>{const y=v.buffer.code;if(v.uri===23&&y===0&&!v.buffer.edges_services)if(v.buffer.flag===4194310)S.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),v.buffer.edges_services=[];else{const b={error:new se(P.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:L("NO_EDGES_RETRY"),csIp:e.detail[502]}),flag:v.buffer.flag};g.push(b),_(b)}if(y!==0){const b=Wh(y),D={error:new se(P.CAN_NOT_GET_GATEWAY_SERVER,b.desc,{desc:b.desc,retry:b.retry,csIp:e.detail[502]}),flag:v.buffer.flag};v.buffer.flag===4194310?S.warning(D.error.toString()):g.push(D),_(D)}}),g.length)throw S.warning("[".concat(h||"sid-".concat(d.slice(0,6)),"] multi unilbs ").concat(t," failed, ").concat(g.map(v=>"flag: ".concat(v.flag,", message: ").concat(v.error.message,", retry: ").concat(v.error.data.retry)).join(" | "))),new se(P.CAN_NOT_GET_GATEWAY_SERVER,g.map(v=>"flag: ".concat(v.flag,", message: ").concat(v.error.message)).join(" | "),{retry:!!g.find(v=>v.error.data.retry),csIp:e.detail[502],desc:[...new Set(g.map(v=>{var y;return v==null||(y=v.error)===null||y===void 0||(y=y.data)===null||y===void 0?void 0:y.desc}).filter(v=>!!v))]})},lI=e=>{var t,n,i,o;if(e.addresses&&e.addresses.length===0&&e.code===0)throw new se(P.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:e.detail&&e.detail[502]});if(L("AP_AREA")&&((i=e.detail)!==null&&i!==void 0&&i[23]&&typeof((o=e.detail)===null||o===void 0?void 0:o[23])=="string"?NV(e.detail[23].toLowerCase()):NV()),(t=e.detail)!==null&&t!==void 0&&t[19]&&typeof((n=e.detail)===null||n===void 0?void 0:n[19])=="string"){const d=e.detail[19],h=d==null?void 0:d.split(";");for(let f=0;f<h.length;f++){var l;const g=ks(l=h[f]).call(l);e.addresses[f]&&h&&(e.addresses[f].fingerprint=g)}}if(L("GATEWAY_ADDRESS")&&L("GATEWAY_ADDRESS").length>0){S.debug("assign gateway address to",L("GATEWAY_ADDRESS"));const d=L("GATEWAY_ADDRESS").map(h=>{var f,g;const _=(f=(g=e.addresses.find(v=>v.ip===h.ip&&v.port===h.port))===null||g===void 0?void 0:g.fingerprint)!==null&&f!==void 0?f:"";return{ip:h.ip,port:h.port,ticket:e.addresses[0]&&e.addresses[0].ticket,fingerprint:h.fingerprint||_}});e.addresses=d}},sAe=(e,t)=>{if(e.response_body&&e.response_body.length){const n=e.response_body[0];if(n.buffer.code!==0){const i=Wh(n.buffer.code);throw new se(P.UPDATE_TICKET_FAILED,"[".concat(n.buffer.code,"]: ").concat(i.desc),{retry:i.retry})}return n.buffer.ticket}throw S.debug("update ticket request received ap response without response body:",t),new se(P.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})},AI=(e,t,n)=>{const i=Math.floor(Math.random()*1e12),o=e.role==="host"?"1":e.role==="audience"?"2":void 0,l={appid:e.appId,client_ts:Date.now(),opid:i,sid:e.sid,request_bodies:[{uri:22,buffer:{cname:e.cname,detail:vc(vc(vc({6:e.stringUid,11:t,12:L("USE_NEW_TOKEN")?"1":void 0},o?{17:o}:{}),{},{22:t},e.apRequestDetail?{33:e.apRequestDetail}:{}),e.apRTM?{26:"RTM2"}:{}),key:e.token,service_ids:n,uid:e.uid||0}}]};l.request_bodies.forEach(h=>{e.multiIP&&e.multiIP.gateway_ip&&(h.buffer.detail[5]=JSON.stringify({vocs_ip:[e.multiIP.uni_lbs_ip],vos_ip:[e.multiIP.gateway_ip]}))});const d=new FormData;return d.append("request",JSON.stringify(l)),[d,i]},iAe=(e,t)=>{const n=Math.floor(Math.random()*1e12),i={appid:e.appId,client_ts:Date.now(),opid:n,sid:e.sid,request_bodies:[{uri:28,buffer:{cname:e.cname,detail:{1:"",6:e.stringUid,12:"1"},token:e.token,service_ids:t,uid:e.uid||0,edges_services:e.apResponse.addresses.map(l=>({ip:l.ip,port:l.port}))}}]},o=new FormData;return o.append("request",JSON.stringify(i)),[o,n]};let qh=0;function Xh(e){return be.all(e.map(t=>t.then(n=>{throw n},n=>n))).then(t=>{throw t},t=>t)}const Um=async e=>{let{fragementLength:t,referenceList:n,asyncMapHandler:i,allFailedhandler:o,promisesCollector:l}=e,d=0;const h=t;let f,g=0;const _=async()=>{const v=(()=>{const y=d*h,b=y+h;return n.slice(y,b).map(i)})();l&&l.push(...v);try{f=await Xh(v)}catch(y){if(g+=h,d++,!(g>=n.length))return void await _();o(y)}v.forEach(y=>y.cancel())};return await _(),f},kV=async e=>{let{referenceList:t,asyncMapHandler:n,closeFn:i}=e;const o=t.length;let l=0;const d=async()=>{const h=n(t.shift());try{return await h}catch(f){if(l++,l>=o||i!=null&&i(f))throw f;return d()}};return d()};async function aAe(){if(typeof VideoDecoder>"u")return!0;let e;const t=[18,0,10,13,0,0,0,3,180,253,144,6,136,8,8,8,32,50,85,16,66,128,2,8,32,132,0,8,0,180,90,204,169,166,242,109,241,190,143,149,160,133,4,144,43,122,168,159,120,159,205,39,82,131,57,52,87,187,68,23,248,134,204,226,97,17,49,183,55,236,219,249,221,98,208,215,190,59,179,167,213,47,1,246,150,14,194,245,159,83,35,64,103,218,38,21,82,3,135,21,185,84,248,134],n=[18,0,10,13,0,0,0,3,180,253,144,6,136,8,8,8,32,50,87,16,66,128,2,8,32,132,0,8,0,180,90,204,169,166,242,109,241,190,143,148,62,134,140,92,172,141,77,35,94,181,164,65,169,65,156,154,43,221,162,11,252,67,102,113,48,136,137,219,62,43,113,239,23,126,250,186,252,10,138,218,25,193,244,74,68,194,209,107,23,52,206,199,78,72,98,103,151,71,96,62,51,210,158,72,231,158],i=[18,0,10,13,0,0,0,3,180,253,144,6,136,8,8,8,32,50,87,16,66,128,2,8,32,132,0,8,0,180,90,204,169,166,242,109,241,190,143,143,233,163,51,196,98,95,151,224,22,134,33,240,150,248,67,18,34,196,142,81,238,173,140,80,205,232,132,144,67,12,131,157,4,171,243,86,122,35,6,166,184,243,85,126,13,206,103,152,62,168,160,187,2,241,138,52,211,72,121,128,151,63,147,128,19,42],o=[18,0,50,138,1,48,192,64,253,248,65,17,67,192,32,0,16,0,0,0,0,0,0,0,195,12,48,144,64,32,0,209,75,61,9,204,25,115,79,226,115,63,63,208,70,210,220,153,126,241,237,37,107,195,153,1,99,112,230,189,209,169,130,10,11,22,167,215,159,205,197,7,183,162,26,48,254,141,134,103,32,16,235,45,1,15,18,119,169,110,206,251,51,115,202,60,148,1,46,39,109,25,28,86,168,15,77,211,239,2,58,43,146,26,230,184,81,48,140,226,226,250,222,146,171,133,164,13,188,180,64,122,142,146,32,208,238,170,193,35,53,44,225],l=[18,0,50,107,48,0,133,125,248,65,26,195,64,62,32,31,16,0,0,0,0,0,1,4,16,64,144,64,32,0,204,24,122,65,56,165,18,52,206,218,4,187,51,97,9,29,191,90,253,106,185,31,197,155,52,205,245,185,203,131,20,226,25,124,95,113,220,113,141,15,15,104,211,144,152,237,150,157,127,51,143,24,231,218,171,255,176,241,128,229,149,150,148,66,245,228,91,27,182,228,136,61,182,237,133,45,220,24,103,214,152],d=[18,0,50,122,48,1,9,253,248,65,26,67,64,62,32,31,16,0,0,0,0,0,1,4,16,64,144,64,32,0,198,182,231,242,220,235,163,140,12,36,36,166,46,132,210,4,71,23,218,132,27,30,17,45,244,79,31,243,195,136,100,169,76,88,142,85,204,217,121,168,29,163,198,17,251,223,73,12,212,244,139,123,151,179,75,216,96,208,136,40,229,42,59,149,10,116,228,85,99,93,221,108,255,140,248,20,30,167,122,109,206,164,108,197,110,251,23,243,133,160,63,13,207,177,12,128];return await new be((f,g)=>{let _;(async function(){e&&e.state!=="closed"||await async function(){e=new VideoDecoder({output:y=>{y.close(),clearTimeout(_),f(!0)},error:y=>{clearTimeout(_),f(!1)}}),await e.configure({codec:"av01.0.05M.08",width:160,height:90})}();const v=[t,n,i,o,l,d];for(let y=0;y<v.length;y++){const b=new EncodedVideoChunk({type:y==0?"key":"delta",timestamp:33333*y,duration:33333,data:new Uint8Array(v[y])});try{await e.decode(b)}catch{return void f(!1)}}})(),_=setTimeout(()=>{f(!1)},5e3)})}async function A0(e,t,n,i){return{gatewayInfo:await async function(l,d,h,f){let g=null;const _=[],v=async()=>{const b=L("WEBCS_DOMAIN").slice(0,L("AJAX_REQUEST_CONCURRENT")).map(O=>({url:l.proxyServer?"https://".concat(l.proxyServer,"/ap/?url=").concat(O+"/api/v2/transpond/webrtc?v=2"):"https://".concat(O,"/api/v2/transpond/webrtc?v=2"),areaCode:Lm()})),D=f.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:b.map(O=>O.url)}),I=await Um({fragementLength:L("FRAGEMENT_LENGTH"),referenceList:b,asyncMapHandler:O=>(S.debug("[".concat(l.clientId,"] Connect to choose_server:"),O.url),xV(O,l,d,h)),allFailedhandler:O=>{throw f.recordJoinChannelService({endTs:Date.now(),status:"error",errors:O},D),O[0]},promisesCollector:_});return f.recordJoinChannelService({endTs:Date.now(),status:"success"},D),I},y=async()=>{if(await Sr(1e3),g!==null)return g;const b=L("WEBCS_DOMAIN_BACKUP_LIST").map(O=>({url:l.proxyServer?"https://".concat(l.proxyServer,"/ap/?url=").concat(O+"/api/v2/transpond/webrtc?v=2"):"https://".concat(O,"/api/v2/transpond/webrtc?v=2"),areaCode:Lm()})),D=f.recordJoinChannelService({endTs:void 0,startTs:Date.now(),status:"pending",service:"chooseServer",urls:b.map(O=>O.url)}),I=await Um({fragementLength:L("FRAGEMENT_LENGTH"),referenceList:b,asyncMapHandler:O=>(S.debug("[".concat(l.clientId,"] Connect to backup choose_server:"),O.url),xV(O,l,d,h)),allFailedhandler:O=>{throw f.recordJoinChannelService({endTs:Date.now(),status:"error",errors:O},D),O[0]},promisesCollector:_});return f.recordJoinChannelService({endTs:Date.now(),status:"success"},D),I};try{return g=await Xh([v(),y()]),_.length&&_.forEach(b=>b.cancel&&typeof b.cancel=="function"&&b.cancel()),g}catch(b){throw b[0]}}(e,t,n,i)}}async function LV(e,t,n,i,o){const l=e.cloudProxyServer;if(l==="disabled"){if(e.useLocalAccessPoint)return await A0(e,t,n,o);if(L("JOIN_WITH_FALLBACK_MEDIA_PROXY")){const{gatewayInfo:y,proxyInfo:b}=await MV(e,t,n,o);if(e.turnServer&&e.turnServer.mode!=="auto")return{gatewayInfo:y};const D=b.map(I=>({turnServerURL:I.address,tcpport:I.tcpport||$r.tcpport,udpport:I.udpport||$r.udpport,username:I.username||$r.username,password:I.password||$r.password,forceturn:!1,security:!0}));if(o.useP2P){var d;const I=(d=e.uid)!==null&&d!==void 0?d:y.uid,O="glb:".concat(I.toString()),U=await WT(O),j=b.map(G=>({turnServerURL:G.address,tcpport:G.tcpport||$r.tcpport,udpport:G.udpport||$r.udpport,username:O,password:U,forceturn:!1,security:!0}));D.push(...j)}return e.turnServer={mode:"manual",servers:D},{gatewayInfo:y}}return await A0(e,t,n,o)}const{proxyInfo:h,gatewayInfo:f}=await MV(e,t,n,o),g={gatewayInfo:f},_=h.map(y=>({turnServerURL:y.address,tcpport:l==="proxy3"?void 0:y.tcpport?y.tcpport:$r.tcpport,udpport:l==="proxy4"?void 0:y.udpport?y.udpport:$r.udpport,username:y.username||$r.username,password:y.password||$r.password,forceturn:l!=="proxy4",security:l==="proxy5"}));if(o.useP2P){var v;const y=(v=e.uid)!==null&&v!==void 0?v:f.uid,b="glb:".concat(y.toString()),D=await WT(b),I=h.map(O=>({turnServerURL:O.address,tcpport:l==="proxy3"?void 0:O.tcpport||$r.tcpport,udpport:l==="proxy4"?void 0:O.udpport||$r.udpport,username:b,password:D,forceturn:l!=="proxy4",security:l==="proxy5"}));_.push(...I)}return e.turnServer={mode:"manual",servers:_},S.debug("[".concat(e.clientId,"] set proxy server: ").concat(e.proxyServer,", mode: ").concat(l)),g}async function UV(e,t,n,i,o){const l=L("ACCOUNT_REGISTER").slice(0,L("AJAX_REQUEST_CONCURRENT"));let d=[];d=t.proxyServer?l.map(f=>"https://".concat(t.proxyServer,"/ap/?url=").concat(f+"/api/v1")):l.map(f=>"https://".concat(f,"/api/v1"));const h=o==null?void 0:o.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"stringUID",urls:d});try{const f=await async function(g,_,v,y,b){const D=Date.now(),I={sid:v.sid,opid:10,appid:v.appId,string_uid:_};let O=g[0];const U=await Do(()=>Mo(O+"".concat(O.indexOf("?")===-1?"?":"&","action=stringuid"),{data:I,cancelToken:y,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}}),(j,G)=>{if(j.code===0){if(j.uid<=0||j.uid>=Math.pow(2,32))throw S.error("Invalid Uint Uid ".concat(_," => ").concat(j.uid),j),ke.reqUserAccount(I.sid,{lts:D,success:!1,serverAddr:O,stringUid:I.string_uid,uid:j.uid,errorCode:P.INVALID_UINT_UID_FROM_STRING_UID,extend:I}),new se(P.INVALID_UINT_UID_FROM_STRING_UID);return ke.reqUserAccount(I.sid,{lts:D,success:!0,serverAddr:O,stringUid:I.string_uid,uid:j.uid,errorCode:null,extend:I}),!1}const $=Wh(j.code);return $.retry&&(O=g[(G+1)%g.length]),ke.reqUserAccount(I.sid,{lts:D,success:!1,serverAddr:O,stringUid:I.string_uid,uid:j.uid,errorCode:$.desc,extend:I}),$.retry},(j,G)=>j.code!==P.OPERATION_ABORTED&&(ke.reqUserAccount(I.sid,{lts:D,success:!1,serverAddr:O,stringUid:I.string_uid,uid:null,errorCode:j.code,extend:I}),O=g[(G+1)%g.length],!0),b);if(U.code!==0){const j=Wh(U.code);throw new se(P.UNEXPECTED_RESPONSE,j.desc)}return U}(d,e,t,n,i);return o==null||o.recordJoinChannelService({status:"success",endTs:Date.now()},h),f.uid}catch(f){throw o==null||o.recordJoinChannelService({status:"error",endTs:Date.now(),errors:[f]},h),f}}async function oAe(e,t,n){const i=L("ACCOUNT_REGISTER");let o=[];o=t.proxyServer?i.map(l=>"https://".concat(t.proxyServer,"/ap/?url=").concat(l+"/api/v1")):i.map(l=>"https://".concat(l,"/api/v1"));try{return await kV({referenceList:o,asyncMapHandler:d=>async function(h,f,g,_){const v=Date.now(),y={sid:g.sid,opid:10,appid:g.appId,string_uid:f};try{const b=await Mo(h+"".concat(h.indexOf("?")===-1?"?":"&","action=stringuid"),{data:y,cancelToken:_,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}});if(b.code!==0){const D=Wh(b.code);throw new se(P.UNEXPECTED_RESPONSE,"preload sua error:".concat(D.desc),D)}if(b.uid<=0||b.uid>=Math.pow(2,32))throw new se(P.INVALID_UINT_UID_FROM_STRING_UID);return{requestTime:v,url:h,req:y,uid:b.uid,elapse:Date.now()-v}}catch(b){throw b}}(d,e,t,n),closeFn:d=>d.code===P.OPERATION_ABORTED||d.code===P.UNEXPECTED_RESPONSE&&!d.data.retry})}catch(l){throw l}}async function cAe(e,t,n){const i=L("CDS_AP").slice(0,L("AJAX_REQUEST_CONCURRENT")).map(f=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(f+"/api/v1"):"https://".concat(f,"/api/v1?action=config")),o=i.map(f=>function(g,_,v,y){const b=Lt(),D={flag:64,cipher_method:0,features:vc(vc(vc(vc(vc({install_id:iR(),device:b.name,system:b.os,system_general:navigator.userAgent,vendor:_.appId,version:Aa,cname:_.cname,session_id:_.sid,proxyServer:_.proxyServer,sdk_type:$le.WEB_RTC,browser_name:b.name,browser_version:b.version,user_agent:navigator.userAgent,channel_name:_.cname},_.stringUid&&{string_uid:_.stringUid}),_.uid&&{uid:_.uid+""}),b.os&&{os_name:b.os}),b.osVersion&&{os_version:b.osVersion}),{},{detail:""})};return Do(()=>Mo(g,{data:D,timeout:1e3,cancelToken:v,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}}),void 0,I=>I.code!==P.OPERATION_ABORTED,y)}(f,e,t,n));let l=null,d=null,h={};try{l=await Xh(o)}catch(f){if(f.code===P.OPERATION_ABORTED)throw f;d=f}if(o.forEach(f=>f.cancel()),ke.reportApiInvoke(e.sid,{name:yn.REQUEST_CONFIG_DISTRIBUTE,options:{error:d,res:l}}).onSuccess(),l&&l.test_tags)try{h=function(f){if(!f.test_tags)return{};const g=f.test_tags,_=Object.keys(g),v={};return _.forEach(y=>{var b;const D=ks(b=y.slice(4)).call(b),I=JSON.parse(g[y]),O=I[1];v[D]={tag:I[0]||"",value:O}}),v}(l)}catch{}return h}async function PV(e,t){const n=L("WEBCS_DOMAIN").concat(L("WEBCS_DOMAIN_BACKUP_LIST")).map(i=>({url:"https://".concat(i,"/api/v2/transpond/webrtc?v=2"),areaCode:Lm(),serviceIds:[Xn.CHOOSE_SERVER,Xn.CLOUD_PROXY_FALLBACK]}));try{return await kV({referenceList:n,asyncMapHandler:o=>async function(l,d,h){let f,{url:g,areaCode:_,serviceIds:v}=l;const y=Date.now(),[b,D]=AI(d,_,v);let I=Ln.networkState;try{I&&Ln.networkState===Us.OFFLINE&&Ln.onlineWaiter&&await be.race([Ln.onlineWaiter,Sr(qn.maxRetryTimeout)]),I=Ln.networkState;const{data:O,headers:U}=await Mo(g,{data:b,cancelToken:h,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);f=U.http3==="1"?1:-1,(Z=>{const X=[];if(Z.response_body.forEach(ee=>{const le=ee.buffer.code;if(ee.uri===23&&le===0&&!ee.buffer.edges_services)if(ee.buffer.flag===4194310)ee.buffer.edges_services=[];else{const fe={error:new se(P.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:L("NO_EDGES_RETRY"),csIp:Z.detail[502]}),flag:ee.buffer.flag};X.push(fe)}if(le!==0){const fe=Wh(le),Ie={error:new se(P.CAN_NOT_GET_GATEWAY_SERVER,fe.desc,{desc:fe.desc,retry:fe.retry,csIp:Z.detail[502]}),flag:ee.buffer.flag};ee.buffer.flag===4194310?S.warning(Ie.error.toString()):X.push(Ie)}}),X.length)throw new se(P.CAN_NOT_GET_GATEWAY_SERVER,X.map(ee=>"flag: ".concat(ee.flag,", message: ").concat(ee.error.message)).join(" | "),{retry:!!X.find(ee=>ee.error.data.retry),csIp:Z.detail[502],desc:[...new Set(X.map(ee=>{var le;return ee==null||(le=ee.error)===null||le===void 0||(le=le.data)===null||le===void 0?void 0:le.desc}).filter(ee=>!!ee))]})})(O);const G=Nm(O,Xn.CHOOSE_SERVER),$=Nm(O,Xn.CLOUD_PROXY_FALLBACK);return lI(G),{gatewayInfo:qR(G,g),proxyInfo:$,opid:D,requestTime:y,url:g,isHttp3:f,elapse:Date.now()-y}}catch(O){throw O}}(o,e,t),closeFn:o=>o.code===P.OPERATION_ABORTED||o.code===P.CAN_NOT_GET_GATEWAY_SERVER&&!o.data.retry})}catch(i){throw i}}async function MV(e,t,n,i){const o=L("PROXY_SERVER_TYPE3"),l=(b,D,I)=>{let O=I||o;return Array.isArray(O)&&(O=D%2==0&&o[1]||o[0]),"https://".concat(O,"/ap/?url=").concat(b)};let d=null;const h=[],f=async()=>{const b=L("WEBCS_DOMAIN").slice(0,L("AJAX_REQUEST_CONCURRENT")).map((O,U)=>{let j;return j=e.cloudProxyServer==="disabled"&&e.proxyServer?l("".concat(O,"/api/v2/transpond/webrtc?v=2"),U,e.proxyServer):e.cloudProxyServer==="disabled"||e.cloudProxyServer==="fallback"?"https://".concat(O,"/api/v2/transpond/webrtc?v=2"):l("".concat(O,"/api/v2/transpond/webrtc?v=2"),U),{url:j,areaCode:Lm(),serviceIds:[Xn.CHOOSE_SERVER,e.cloudProxyServer==="proxy5"?Xn.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?Xn.CLOUD_PROXY:Xn.CLOUD_PROXY_FALLBACK]}}),D=i.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:b.map(O=>O.url)}),I=await Um({fragementLength:L("FRAGEMENT_LENGTH"),referenceList:b,asyncMapHandler:O=>(S.debug("[".concat(e.clientId,"] Connect to choose_server:"),O.url),DV(O,e,t,n)),allFailedhandler:O=>{throw i.recordJoinChannelService({endTs:Date.now(),status:"error",errors:O},D),O[0]},promisesCollector:h});return i.recordJoinChannelService({endTs:Date.now(),status:"success"},D),I},g=async()=>{if(await Sr(1e3),d!==null)return d;const b=L("WEBCS_DOMAIN_BACKUP_LIST").map((O,U)=>{let j;return j=e.cloudProxyServer==="disabled"&&e.proxyServer?l("".concat(O,"/api/v2/transpond/webrtc?v=2"),U,e.proxyServer):e.cloudProxyServer==="disabled"||e.cloudProxyServer==="fallback"?"https://".concat(O,"/api/v2/transpond/webrtc?v=2"):l("".concat(O,"/api/v2/transpond/webrtc?v=2"),U),{url:j,areaCode:Lm(),serviceIds:[Xn.CHOOSE_SERVER,e.cloudProxyServer==="proxy5"?Xn.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?Xn.CLOUD_PROXY:Xn.CLOUD_PROXY_FALLBACK]}}),D=i.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:b.map(O=>O.url)}),I=await Um({fragementLength:L("FRAGEMENT_LENGTH"),referenceList:b,asyncMapHandler:O=>(S.debug("[".concat(e.clientId,"] Connect to backup choose_server:"),O.url),DV(O,e,t,n)),allFailedhandler:O=>{throw i.recordJoinChannelService({endTs:Date.now(),status:"error",errors:O},D),O[0]},promisesCollector:h});return i.recordJoinChannelService({endTs:Date.now(),status:"success"},D),I};let _,v,y;try{({gatewayInfo:_,proxyInfo:v,url:y}=await Xh([f(),g()]))}catch(b){throw b[0]}if(h.length&&h.forEach(b=>b.cancel&&typeof b.cancel=="function"&&b.cancel()),!_||!v)throw new se(P.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if(e.apUrl=y,e.cloudProxyServer!=="disabled"&&Array.isArray(o)&&y){const b=/^https?:\/\/(.+?)(\/.*)?$/.exec(y)[1];me(o).call(o,b)&&(e.proxyServer=b,S.setProxyServer(b),ke.setProxyServer(b))}return d={gatewayInfo:_,proxyInfo:await cV(v,_.uid)},d}async function lAe(e,t,n){const i=L("UAP_AP").slice(0,L("AJAX_REQUEST_CONCURRENT")).map(l=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(l+"/api/v1?action=uap"):"https://".concat(l,"/api/v1?action=uap")),o=i.map(l=>function(d,h,f,g){const _={command:"convergeAllocateEdge",sid:h.sid,appId:h.appId,token:h.token,ts:Date.now(),version:Aa,cname:h.cname,uid:h.uid.toString(),requestId:cI,seq:cI};cI+=1;const v={service_name:"tele_channel",json_body:JSON.stringify(_)};return Do(async()=>{const y=await Mo(d,{data:v,cancelToken:f,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(y.code!==0){const D=new se(P.UNEXPECTED_RESPONSE,"cross channel ap error, code"+y.code,{retry:!0});throw S.error(D.toString()),D}const b=JSON.parse(y.json_body);if(b.code!==200){const D=new se(P.UNEXPECTED_RESPONSE,"cross channel app center error, code: ".concat(b.code,", reason: ").concat(b.reason));throw S.error(D.toString()),D}if(!b.servers||b.servers.length===0){const D=new se(P.UNEXPECTED_RESPONSE,"cross channel app center empty server");throw S.error(D.toString()),D}return{vid:b.vid,workerToken:b.workerToken,addressList:(L("CHANNEL_MEDIA_RELAY_SERVERS")||b.servers).map(D=>"wss://".concat(D.address.replace(/\./g,"-"),".").concat(L("WORKER_DOMAIN"),":").concat(D.wss))}},void 0,y=>!!(y.code!==P.OPERATION_ABORTED&&y.code!==P.UNEXPECTED_RESPONSE||y.data&&y.data.retry),g)}(l,e,t,n));try{const l=await Xh(o);return o.forEach(d=>d.cancel()),l}catch(l){throw l[0]}}async function AAe(e,t,n){let i=null;const o=[],l=async d=>{const h=L(d?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN").map(f=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(f+"/api/v2/transpond/webrtc?v=2"):"https://".concat(f,"/api/v2/transpond/webrtc?v=2"));return d&&(await Sr(1e3),i!==null)?i:await Um({fragementLength:L("FRAGEMENT_LENGTH"),referenceList:h,asyncMapHandler:f=>(S.debug("[".concat(e.clientId,"] update ticket, Connect to ").concat(d?"backup":""," choose_server:"),f),function(g,_,v,y){const[b]=iAe(_,[Xn.CHOOSE_SERVER]);let D=Ln.networkState;return Do(async()=>{D&&Ln.networkState===Us.OFFLINE&&Ln.onlineWaiter&&await be.race([Ln.onlineWaiter,Sr(y&&y.maxRetryTimeout||qn.maxRetryTimeout)]),D=Ln.networkState;const I=await Mo(g,{data:b,cancelToken:v,headers:{"Content-Type":"multipart/form-data;"}},!0);return sAe(I,g)},()=>!1,I=>I.code!==P.OPERATION_ABORTED&&(I.code===P.UPDATE_TICKET_FAILED?I.data.retry:(S.warning("[".concat(_.clientId,"] update ticket network error, retry"),I),!0)),y)}(f,e,t,n)),allFailedhandler:f=>{throw f[0]},promisesCollector:o})};try{return i=await Xh([l(!1),l(!0)]),o.length&&o.forEach(d=>d.cancel&&typeof d.cancel=="function"&&d.cancel()),i}catch(d){throw d[0]}}function FV(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}function dI(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?FV(Object(n),!0).forEach(function(i){x(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):FV(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}class dAe extends Tn{get isSuccess(){return!!this.configs}constructor(t,n){super(),x(this,"configs",void 0),x(this,"store",void 0),x(this,"joinInfo",void 0),x(this,"cancelToken",void 0),x(this,"retryConfig",{timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4}),x(this,"interval",void 0),x(this,"mutex",void 0),x(this,"mutableParamsRead",!1),x(this,"configCache",{}),x(this,"limit_bitrate",void 0),this.mutex=new Lr("config-distribute",t),this.store=n}startGetConfigDistribute(t,n){this.joinInfo=t,this.cancelToken=n,this.interval&&this.stopGetConfigDistribute(),L("ENABLE_CONFIG_DISTRIBUTE")&&(this.updateConfigDistribute(),this.interval=window.setInterval(()=>{this.updateConfigDistribute()},L("CONFIG_DISTRIBUTE_INTERVAL")))}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0,this.configs=void 0,this.limit_bitrate=void 0}async awaitConfigDistributeComplete(){this.mutex.isLocked&&(await this.mutex.lock())()}async updateConfigDistribute(){if(this.mutableParamsRead||(this.mutableParamsRead=!0,ke.reportApiInvoke(null,{options:void 0,name:yn.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:an.TRACER}).onSuccess(JSON.stringify(Vi))),!this.joinInfo||!this.cancelToken||!this.retryConfig)return void S.debug("[config-distribute] get config distribute interrupted have no joininfo");let t;const n=await this.mutex.lock();try{t=await cAe(this.joinInfo,this.cancelToken,this.retryConfig),S.debug("[config-distribute] get config distribute",JSON.stringify(t));const i=function(o){var l;const d=Ad(l=Object.keys(o).filter(g=>/^webrtc_ng_global_parameter/.test(g))).call(l);for(let g=0;g<d.length;g++)for(let _=d.length-1;_>g;_--){const v=d[_],y=o[v].value;if(typeof y.__priority=="number"){const b=y.__priority,D=d[_-1],I=o[D].value;if(typeof I.__priority=="number"){if(!(b>I.__priority))continue;{const O=v;d[_]=d[_-1],d[_-1]=O}}else{const O=v;d[_]=d[_-1],d[_-1]=O}}}const h=Date.now(),f={};return d.forEach(g=>{const _=o[g].value.__expires;_&&_<=h||(f[g]=o[g])}),f}(t);this.cacheGlobalParameterConfig(i),this.store.hasStartJoinChannel||(this.store.isABTestSuccess=!0),this.configs=i}catch(i){const o=new se(P.NETWORK_RESPONSE_ERROR,i);S.warning("[config-distribute] ".concat(o.toString()))}finally{n()}}getBitrateLimit(){return this.limit_bitrate||void 0}handleBitrateLimit(t){Z4(t)&&(this.limit_bitrate?this.limit_bitrate&&this.limit_bitrate.id!==t.id&&this.emit(Lo.UPDATE_BITRATE_LIMIT,t):this.emit(Lo.UPDATE_BITRATE_LIMIT,t))}getLowStreamConfigDistribute(){return this.limit_bitrate&&dI({},this.limit_bitrate.low_stream_uplink)}handleABTestConfigDistribute(t){try{const n={},i=Object.keys(t),o=[];i.forEach(l=>{const d=t[l].value;n[l]=d;const h=d.__id;if(h&&this.configCache[l]&&this.configCache[l].__id===h)return;const f=d.__type,g=t[l].value,_=t[l].tag;let v=0;f?f===_F.REALTIME&&(v=1):Object.keys(g).some(y=>Object.prototype.hasOwnProperty.call(lR,y)||!PR()&&Object.prototype.hasOwnProperty.call(Rv,y)?(v=1,!0):void 0),o.push({tag:_,isApplied:v,feature:l,params:JSON.stringify(d)})}),o.forEach(l=>{let{tag:d,feature:h,params:f,isApplied:g}=l;this.store.sessionId&&ke.abTest(this.store.sessionId,{intSucc:1,isApplied:g,tag:d,feature:h,params:f,cid:this.store.cid,uid:this.store.intUid})}),this.configCache=n}catch(n){S.debug("handleABTestConfigDistribute error",n)}}cacheGlobalParameterConfig(t){const n=function(o){const l={};return Object.keys(o).forEach(d=>{const h=o[d].value,f=h.__expires,g=h.__type;Object.keys(h).forEach(_=>{_==="__id"||_==="__type"||_==="__priority"||_==="__expires"||Object.prototype.hasOwnProperty.call(l,_)||(l[_]=dI(dI({value:h[_]},f&&{expires:f}),g&&{type:g}))})}),l}(t);try{var i;const o=(i=n.LIMIT_BITRATE)===null||i===void 0?void 0:i.value;delete n.LIMIT_BITRATE,o&&Z4(o)&&this.handleBitrateLimit(o),this.limit_bitrate=o,this.handleGlobalParameterConfig(n),this.handleABTestConfigDistribute(t),function(h){try{const f=Date.now();Object.keys(h).forEach(g=>{const{value:_,type:v,expires:y}=h[g];y&&y<=f||((v===_F.REALTIME||Object.prototype.hasOwnProperty.call(lR,g))&&(Vi[g]=_,qt[g]=_,S.debug("Update realtime parameters from config distribute",g,_)),v||PR()||!Object.prototype.hasOwnProperty.call(Rv,g)||(Vi[g]=_,qt[g]=_,S.debug("Update gateway parameters from config distribute",g,_)))})}catch(f){S.error("Error update config immediately: ".concat(h),f.message)}}(n);const l=JSON.stringify(n),d=window.btoa(l);window.localStorage.setItem("websdk_ng_global_parameter",d),S.debug("Caching global parameters ".concat(l))}catch(o){S.error("Error caching global parameters:",o.message)}}handleGlobalParameterConfig(t){try{const n=Date.now();Object.keys(t).forEach(i=>{switch(i){case"CLIENT_ROLE_OPTIONS":if(Object.prototype.hasOwnProperty.call(qt,i)){const{value:l,expires:d}=t[i];if(d&&d<=n)return;JT(qt[i],l)||(Vi[i]=l,qt[i]=l,this.emit(Lo.UPDATE_CLIENT_ROLE_OPTIONS,l),S.debug("Updating client role options: ".concat(JSON.stringify(l))))}break;case"REMOTE_VIDEO_STREAM_TYPE":if(Object.prototype.hasOwnProperty.call(qt,i)){var o;const{value:l,expires:d}=t[i];if(d&&d<=n)return;typeof l=="number"&&me(o=[0,1,4,5,6,7,8,9]).call(o,l)&&(Vi[i]={value:l},qt[i]=l,this.emit(Lo.UPDATE_REMOTE_VIDEO_STREAM_TYPE,l),S.debug("Updating client remote stream type: ".concat(JSON.stringify(l))))}break;case"ENABLE_FORCE_HLS":if(Object.prototype.hasOwnProperty.call(qt,i)){const{value:l,expires:d}=t[i];if(d&&d<=n)return;JT(qt[i],l)||(Vi[i]=l,qt[i]=l,this.emit(Lo.FALLBACK_TO_HLS,l),S.debug("Updating enable force hls: ".concat(JSON.stringify(l))))}break;case"VOS_CONFIGURE":if(Object.prototype.hasOwnProperty.call(qt,i)){const{value:l,expires:d}=t[i];if(d&&d<=n)return;JT(qt[i],l)||(Vi[i]=l,qt[i]=l,this.emit(Lo.UPDATE_VOS_CONFIGURE,l),S.debug("Updating vos configure: ".concat(JSON.stringify(l))))}}})}catch(n){S.error("Error handling global parameter config:",n.message)}}}class uAe extends Tn{constructor(){super(...arguments),x(this,"resultStorage",new Map)}setLocalAudioStats(t,n,i){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",t,this.checkAudioInputLevel(i,n)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",t,this.checkSendAudioBitrate(i,n))}setLocalVideoStats(t,n,i){this.record("SEND_VIDEO_BITRATE_TOO_LOW",t,this.checkSendVideoBitrate(i,n)),this.record("FRAMERATE_INPUT_TOO_LOW",t,this.checkFramerateInput(i,n)),this.record("FRAMERATE_SENT_TOO_LOW",t,this.checkFramerateSent(i)),!n.muted&&this.record("VIDEO_ENCODE_FAILED",t,this.checResolutionSent(i))}setRemoteAudioStats(t,n){const i=t.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",i,this.checkAudioOutputLevel(n))}setRemoteVideoStats(t,n){const i=t.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",i,this.checkVideoDecode(n))}record(t,n,i){if(L("STATS_UPDATE_INTERVAL")>500)return;this.resultStorage.has(t)||this.resultStorage.set(t,{result:[],isPrevNormal:!0});const o=this.resultStorage.get(t);if(!o)return;o.result.push(i);const l=t==="VIDEO_ENCODE_FAILED"?L("ENCODE_EXCEPTION_TIMES"):5;if(o.result.length>=l){var d;const h=me(d=o.result).call(d,!0);o.isPrevNormal&&!h&&this.emit("exception",uI[t],t,n),!o.isPrevNormal&&h&&this.emit("exception",uI[t]+2e3,t+"_RECOVER",n),o.isPrevNormal=h,o.result=[]}}checkAudioOutputLevel(t){return!(t.receiveBitrate>0&&t.receiveLevel===0)}checkAudioInputLevel(t,n){return n instanceof dr&&!n.isActive||!!n.muted||t.sendVolumeLevel!==0}checkFramerateInput(t,n){let i=null;n._encoderConfig&&n._encoderConfig.frameRate&&(i=ei(n._encoderConfig.frameRate));const o=t.captureFrameRate;return!i||!o||!(i>10&&o<5||i<10&&i>=5&&o<=1)}checkFramerateSent(t){return!(t.captureFrameRate&&t.sendFrameRate&&t.captureFrameRate>5&&t.sendFrameRate<=1)}checResolutionSent(t){var n;return!(!t.codecType||me(n=L("ENCODE_EXCEPTION_VALIDATE_CODEC")).call(n,t.codecType.toLocaleLowerCase()))||!t.captureFrameRate||t.sendFrameRate!==0||t.sendResolutionWidth!==0||t.sendResolutionHeight!==0}checkSendVideoBitrate(t,n){return!!n.muted||t.sendBitrate!==0}checkSendAudioBitrate(t,n){return n instanceof dr&&!n.isActive||!!n.muted||t.sendBitrate!==0}checkVideoDecode(t){return t.receiveBitrate===0||t.decodeFrameRate!==0}}const uI={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003,VIDEO_ENCODE_FAILED:2004},os=new class{markSubscribeStart(e,t){performance.mark("agora-web-sdk/".concat(e,"/subscribe-").concat(t))}markPublishStart(e,t){performance.mark("agora-web-sdk/".concat(e,"/publish-").concat(t))}measureFromSubscribeStart(e,t){const n=performance.getEntriesByName("agora-web-sdk/".concat(e,"/subscribe-").concat(t));if(n.length>0){const i=n[n.length-1];return Math.round(performance.now()-i.startTime)}return 0}measureFromPublishStart(e,t){const n=performance.getEntriesByName("agora-web-sdk/".concat(e,"/publish-").concat(t));if(n.length>0){const i=n[n.length-1];return Math.round(performance.now()-i.startTime)}return 0}};function jV(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}function jd(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?jV(Object(n),!0).forEach(function(i){x(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):jV(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}class Pm{constructor(t){x(this,"store",void 0),x(this,"onStatsException",void 0),x(this,"onUploadPublishDuration",void 0),x(this,"onStatsChanged",void 0),x(this,"onVideoCodecChanged",void 0),x(this,"localStats",new Map),x(this,"remoteStats",new Map),x(this,"updateStatsInterval",void 0),x(this,"trafficStats",void 0),x(this,"trafficStatsPeerList",[]),x(this,"uplinkStats",void 0),x(this,"exceptionMonitor",void 0),x(this,"p2pChannel",void 0),x(this,"scalabilityMode",Cv.L1T1),x(this,"updateStats",()=>{this.p2pChannel&&(this.updateRemoteStats(this.p2pChannel),this.updateLocalStats(this.p2pChannel))}),this.store=t,this.exceptionMonitor=new uAe,this.exceptionMonitor.on("exception",(n,i,o)=>{this.onStatsException&&this.onStatsException(n,i,o)})}startUpdateStats(){this.updateStatsInterval||(this.updateStatsInterval=window.setInterval(this.updateStats,1e3))}stopUpdateStats(){this.updateStatsInterval&&(window.clearInterval(this.updateStatsInterval),this.updateStatsInterval=void 0)}reset(){this.localStats=new Map,this.remoteStats=new Map,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(){return this.localStats.get(ge.LocalAudioTrack)||jd({},fR)}getLocalVideoTrackStats(){return this.localStats.get(ge.LocalVideoTrack)||jd({},mR)}getRemoteAudioTrackStats(t){const n=(l,d)=>{if(!this.trafficStats)return d;const h=this.trafficStats.peer_delay.find(f=>f.peer_uid===l);return h&&(d.publishDuration=h.B_ppad+(Date.now()-this.trafficStats.timestamp)),d},i={};if(t){var o;const l=(o=this.remoteStats.get(t))===null||o===void 0?void 0:o.audioStats;l&&(i[t]=n(t,l))}else Array.from(this.remoteStats.entries()).forEach(l=>{let[d,{audioStats:h}]=l;h&&(i[d]=n(d,h))});return i}getRemoteNetworkQualityStats(t){const n={};if(t){var i;const o=(i=this.remoteStats.get(t))===null||i===void 0?void 0:i.networkStats;o&&(n[t]=o)}else Array.from(this.remoteStats.entries()).forEach(o=>{let[l,{networkStats:d}]=o;d&&(n[l]=d)});return n}getNetworkQuality(){let t=0,n=0;return this.trafficStats&&(t=t0(this.trafficStats.B_unq),n=t0(this.trafficStats.B_dnq)),{uplinkNetworkQuality:t,downlinkNetworkQuality:n}}getRemoteVideoTrackStats(t){const n=(l,d)=>{if(!this.trafficStats)return d;const h=this.trafficStats.peer_delay.find(f=>f.peer_uid===l);return h&&(d.publishDuration=h.B_ppvd+(Date.now()-this.trafficStats.timestamp)),d},i={};if(t){var o;const l=(o=this.remoteStats.get(t))===null||o===void 0?void 0:o.videoStats;l&&(i[t]=n(t,l))}else Array.from(this.remoteStats.entries()).forEach(l=>{let[d,{videoStats:h}]=l;h&&(i[d]=n(d,h))});return i}getRTCStats(){let t=0,n=0,i=0,o=0;const l=this.localStats.get(ge.LocalAudioTrack);l&&(t+=l.sendBytes,n+=l.sendBitrate);const d=this.localStats.get(ge.LocalVideoTrack);d&&(t+=d.sendBytes,n+=d.sendBitrate);const h=this.localStats.get(ge.LocalVideoLowTrack);h&&(t+=h.sendBytes,n+=h.sendBitrate),this.remoteStats.forEach(g=>{let{audioStats:_,videoStats:v}=g;_&&(i+=_.receiveBytes,o+=_.receiveBitrate),v&&(i+=v.receiveBytes,o+=v.receiveBitrate)});let f=1;return this.trafficStats&&(f+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:f,SendBitrate:n,SendBytes:t,RecvBytes:i,RecvBitrate:o,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}addLocalStats(t){this.localStats.set(t,void 0)}removeLocalStats(t){t?this.localStats.delete(t):this.localStats.clear()}addRemoteStats(t){this.remoteStats.set(t,{})}removeRemoteStats(t){t?this.remoteStats.delete(t):this.remoteStats.clear()}addP2PChannel(t){this.p2pChannel=t}updateTrafficStats(t){t.peer_delay=t.peer_delay.filter(n=>n.B_ppad!==void 0||n.B_ppvd!==void 0),t.peer_delay.filter(n=>this.trafficStatsPeerList.indexOf(n.peer_uid)===-1).forEach(n=>{var i;const o=(i=this.p2pChannel)===null||i===void 0?void 0:i.getRemoteMedia(n.peer_uid),l=o!=null&&o.videoSSRC?os.measureFromSubscribeStart(this.store.clientId,o.videoSSRC):0,d=o!=null&&o.audioSSRC?os.measureFromSubscribeStart(this.store.clientId,o.audioSSRC):0;n.B_ppad!==void 0&&n.B_ppvd!==void 0&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(n.peer_uid,n.B_ppad,n.B_ppvd,l>d?l:d),this.trafficStatsPeerList.push(n.peer_uid))}),this.trafficStats=t}updateUplinkStats(t){this.uplinkStats&&this.uplinkStats.B_fir!==t.B_fir&&S.debug("[".concat(this.store.clientId,"]: Period fir changes to ").concat(t.B_fir)),this.uplinkStats=t}static isRemoteVideoFreeze(t,n,i){if(!t)return!1;const o=!!i&&n.framesDecodeFreezeTime>i.framesDecodeFreezeTime,l=!i||n.framesDecodeCount>i.framesDecodeCount;return o||!l}static isRemoteAudioFreeze(t){return!!t&&t._isFreeze()}isLocalVideoFreeze(t){return!(!t.inputFrame||!t.sentFrame)&&t.inputFrame.frameRate>5&&t.sentFrame.frameRate<3}updateLocalStats(t){Array.from(this.localStats.entries()).forEach(n=>{let[i,o]=n;switch(i){case ge.LocalVideoTrack:case ge.LocalVideoLowTrack:{const h=o,f=jd({},mR),g=t.getStats(),_=t.getLocalMedia(i);if(g){const v=g.videoSend.find(y=>y.ssrc===(_==null?void 0:_.ssrcs[0].ssrcId));if(v){const y=t.getLocalVideoSize(),b=t.getEncoderConfig(ge.LocalVideoTrack);var l;(v.codec==="H264"||v.codec==="H265"||v.codec==="VP8"||v.codec==="VP9"||v.codec==="AV1X"||v.codec==="AV1")&&(f.codecType=v.codec,(h==null?void 0:h.codecType)!==v.codec&&((l=this.onVideoCodecChanged)===null||l===void 0||l.call(this,v.codec.toLocaleLowerCase()))),f.sendBytes=v.bytes,f.sendBitrate=h?8*Math.max(0,f.sendBytes-h.sendBytes):0,v.inputFrame?(f.captureFrameRate=v.inputFrame.frameRate,f.captureResolutionHeight=v.inputFrame.height,f.captureResolutionWidth=v.inputFrame.width):y&&(f.captureResolutionWidth=y.width,f.captureResolutionHeight=y.height),v.sentFrame?(f.sendFrameRate=v.sentFrame.frameRate,f.sendResolutionHeight=v.sentFrame.height,f.sendResolutionWidth=v.sentFrame.width):y&&(f.sendResolutionWidth=y.width,f.sendResolutionHeight=y.height),v.avgEncodeMs&&(f.encodeDelay=v.avgEncodeMs),b&&b.bitrateMax?f.targetSendBitrate=1e3*b.bitrateMax:v.targetBitrate&&(f.targetSendBitrate=v.targetBitrate),f.sendPackets=v.packets,f.sendPacketsLost=v.packetsLost,f.sendJitterMs=v.jitterMs,f.sendRttMs=v.rttMs,f.totalDuration=h?h.totalDuration+1:1,f.totalFreezeTime=h?h.totalFreezeTime:0,this.isLocalVideoFreeze(v)&&(f.totalFreezeTime+=1),v.scalabilityMode&&this.scalabilityMode!==v.scalabilityMode&&(S.debug("[".concat(this.store.clientId,"]: The scalabilityMode of the video sending stream is ").concat(v.scalabilityMode)),this.scalabilityMode=v.scalabilityMode)}this.trafficStats&&(f.currentPacketLossRate=(this.trafficStats.B_pvlr4||0)/100)}var d;this.localStats.set(i,f),((h==null?void 0:h.sendResolutionWidth)!==f.sendResolutionWidth||(h==null?void 0:h.sendResolutionHeight)!==f.sendResolutionHeight)&&((d=this.onStatsChanged)===null||d===void 0||d.call(this,"resolution",{width:f.sendResolutionWidth,height:f.sendResolutionHeight})),f&&_&&this.exceptionMonitor.setLocalVideoStats(this.store.uid,_.track,f);break}case ge.LocalAudioTrack:{const h=o,f=jd({},fR),g=t.getStats(),_=t.getLocalMedia(i);if(g){const v=g.audioSend.find(y=>y.ssrc===(_==null?void 0:_.ssrcs[0].ssrcId));if(v){if(v.codec!=="opus"&&v.codec!=="aac"&&v.codec!=="PCMU"&&v.codec!=="PCMA"&&v.codec!=="G722"||(f.codecType=v.codec),v.inputLevel)f.sendVolumeLevel=Math.round(32767*v.inputLevel);else{const y=t.getLocalAudioVolume();y&&(f.sendVolumeLevel=Math.round(32767*y))}f.sendBytes=v.bytes,f.sendPackets=v.packets,f.sendPacketsLost=v.packetsLost,f.sendJitterMs=v.jitterMs,f.sendRttMs=v.rttMs,f.sendBitrate=h?8*Math.max(0,f.sendBytes-h.sendBytes):0}}this.trafficStats&&(f.currentPacketLossRate=(this.trafficStats.B_palr4||0)/100),this.localStats.set(ge.LocalAudioTrack,f),f&&_&&this.exceptionMonitor.setLocalAudioStats(this.store.uid,_.track,f);break}}})}updateRemoteStats(t){Array.from(this.remoteStats.entries()).forEach(n=>{var i,o;let[l,{videoStats:d,audioStats:h,videoPcStats:f}]=n;const g=h,_=d,v=f,y=jd({},DF),b=jd({},BF),D=jd({},Jce),{audioTrack:I,videoTrack:O,audioSSRC:U,videoSSRC:j}=t.getRemoteMedia(l);let G;G=this.store.useP2P?t.getStats(!0):t.getStats();const $=(i=G)===null||i===void 0?void 0:i.audioRecv.find(le=>le.ssrc===U),Z=(o=G)===null||o===void 0?void 0:o.videoRecv.find(le=>le.ssrc===j),X=this.trafficStats&&this.trafficStats.peer_delay.find(le=>le.peer_uid===l);if($&&($.codec!=="opus"&&$.codec!=="aac"&&$.codec!=="PCMU"&&$.codec!=="PCMA"&&$.codec!=="G722"||(y.codecType=$.codec),$.outputLevel?y.receiveLevel=Math.round(32767*$.outputLevel):I&&(y.receiveLevel=Math.round(32767*I.getVolumeLevel())),y.receiveBytes=$.bytes,y.receivePackets=$.packets,y.receivePacketsLost=$.packetsLost,y.receivePacketsDiscarded=$.packetsDiscarded,y.packetLossRate=y.receivePacketsLost/(y.receivePackets+y.receivePacketsLost),y.receiveBitrate=g?8*Math.max(0,y.receiveBytes-g.receiveBytes):0,y.totalDuration=g?g.totalDuration+1:1,y.totalFreezeTime=g?g.totalFreezeTime:0,y.freezeRate=y.totalFreezeTime/y.totalDuration,y.receiveDelay=$.jitterBufferMs,y.totalDuration>10&&Pm.isRemoteAudioFreeze(I)&&(y.totalFreezeTime+=1)),Z){var ee;Z.codec!=="H264"&&Z.codec!=="H265"&&Z.codec!=="VP8"&&Z.codec!=="VP9"&&Z.codec!=="AV1X"&&Z.codec!=="AV1"||(b.codecType=Z.codec),b.receiveBytes=Z.bytes,b.receiveBitrate=_?8*Math.max(0,b.receiveBytes-_.receiveBytes):0,b.decodeFrameRate=Z.decodeFrameRate<0?0:Z.decodeFrameRate,b.renderFrameRate=Z.decodeFrameRate<0?0:Z.decodeFrameRate,Z.outputFrame&&(b.renderFrameRate=Z.outputFrame.frameRate),Z.receivedFrame?(b.receiveFrameRate=Z.receivedFrame.frameRate,b.receiveResolutionHeight=Z.receivedFrame.height,b.receiveResolutionWidth=Z.receivedFrame.width):O&&(b.receiveResolutionHeight=O._videoHeight||0,b.receiveResolutionWidth=O._videoWidth||0),Z.framesRateFirefox!==void 0&&(b.receiveFrameRate=Math.round(Z.framesRateFirefox)),b.receivePackets=Z.packets,b.receivePacketsLost=Z.packetsLost,b.packetLossRate=b.receivePacketsLost/(b.receivePackets+b.receivePacketsLost);const le=_?_.totalFreezeTime:0,fe=_?_.totalDuration:0;b.totalDuration=_?_.totalDuration+1:1,b.totalFreezeTime=(ee=Z.totalFreezesDuration)!==null&&ee!==void 0?ee:le||0,b.receiveDelay=Z.jitterBufferMs||0;const Ie=!!j&&t.getRemoteVideoIsReady(j);Z.totalFreezesDuration===void 0&&O&&Ie&&Pm.isRemoteVideoFreeze(O,Z,v)&&(b.totalFreezeTime+=1),b.freezeRate=Math.max(0,Math.min((b.totalFreezeTime-le)/(b.totalDuration-fe),1))}X&&(y.end2EndDelay=X.B_ad,b.end2EndDelay=X.B_vd,y.transportDelay=X.B_ed,b.transportDelay=X.B_ed,y.currentPacketLossRate=X.B_ealr4/100,b.currentPacketLossRate=X.B_evlr4/100,D.uplinkNetworkQuality=X.B_punq?X.B_punq:0,D.downlinkNetworkQuality=X.B_pdnq?X.B_pdnq:0),this.remoteStats.set(l,{audioStats:y,videoStats:b,videoPcStats:Z,networkStats:D}),I&&this.exceptionMonitor.setRemoteAudioStats(I,y),O&&this.exceptionMonitor.setRemoteVideoStats(O,b)})}}class VV{constructor(){x(this,"destChannelMediaInfos",new Map),x(this,"srcChannelMediaInfo",void 0)}setSrcChannelInfo(t){J4(t),this.srcChannelMediaInfo=t}addDestChannelInfo(t){J4(t),this.destChannelMediaInfos.set(t.channelName,t)}removeDestChannelInfo(t){zv(t),this.destChannelMediaInfos.delete(t)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}}function QV(e){if(!(e instanceof VV))return new se(P.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();const t=e.getSrcChannelMediaInfo(),n=e.getDestChannelMediaInfo();if(!t)return new se(P.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw();if(n.size===0)return new se(P.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw()}class $l{get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio||this._audio_pre_subscribed)return this._audioTrack}get videoTrack(){if(this.hasVideo||this._video_pre_subscribed)return this._videoTrack}get dataChannels(){return this._dataChannels}constructor(t,n){x(this,"uid",void 0),x(this,"_uintid",void 0),x(this,"_trust_in_room_",!0),x(this,"_trust_audio_enabled_state_",!0),x(this,"_trust_video_enabled_state_",!0),x(this,"_trust_audio_mute_state_",!0),x(this,"_trust_video_mute_state_",!0),x(this,"_audio_muted_",!1),x(this,"_video_muted_",!1),x(this,"_audio_enabled_",!0),x(this,"_video_enabled_",!0),x(this,"_audio_added_",!1),x(this,"_video_added_",!1),x(this,"_is_pre_created",!1),x(this,"_video_pre_subscribed",!1),x(this,"_audio_pre_subscribed",!1),x(this,"_trust_video_stream_added_state_",!0),x(this,"_trust_audio_stream_added_state_",!0),x(this,"_audioTrack",void 0),x(this,"_videoTrack",void 0),x(this,"_dataChannels",[]),x(this,"_audioSSRC",void 0),x(this,"_videoSSRC",void 0),x(this,"_audioOrtc",void 0),x(this,"_videoOrtc",void 0),x(this,"_cname",void 0),x(this,"_rtxSsrcId",void 0),x(this,"_videoMid",void 0),x(this,"_audioMid",void 0),this.uid=t,this._uintid=n}}function HV(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}function hI(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?HV(Object(n),!0).forEach(function(i){x(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):HV(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}const hAe=e=>`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1 2
a=msid-semantic: WMS
a=ice-lite`.concat(e?`
a=extmap-allow-mixed`:"",`
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
m=application 9 UDP/DTLS/SCTP webrtc-datachannel
c=IN IP4 127.0.0.1
a=mid:2
`),d0="9",pI=2e4,u0=4e4;let GV=class{get localCapabilities(){return _n(this._localCapabilities)}get rtpCapabilities(){return _n(this._rtpCapabilities)}get candidates(){return _n(this._candidates)}get iceParameters(){return _n(this._iceParameters)}get dtlsParameters(){return _n(this._dtlsParameters)}constructor(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1],n=arguments.length>2&&arguments[2]!==void 0&&arguments[2],i=arguments.length>3&&arguments[3]!==void 0&&arguments[3];x(this,"sessionDesc",void 0),x(this,"_localCapabilities",void 0),x(this,"_rtpCapabilities",void 0),x(this,"_candidates",void 0),x(this,"_originCandidates",void 0),x(this,"_iceParameters",void 0),x(this,"_isUseExtmapAllowMixed",void 0),x(this,"_isUseLocalCodecs",void 0),x(this,"_isUseDataChannel",void 0),x(this,"_dtlsParameters",void 0),x(this,"setup",void 0),x(this,"currentMidIndex",void 0),x(this,"cname",void 0),x(this,"useLocalCodecsMids",[]),x(this,"preloadSsrcs",[]),x(this,"firefoxSsrcMidMap",new Map),this._isUseExtmapAllowMixed=t,this._isUseLocalCodecs=n,this._isUseDataChannel=i,e=_n(e);const{iceParameters:o,dtlsParameters:l,candidates:d,rtpCapabilities:h,setup:f,localCapabilities:g,cname:_}=e;this._rtpCapabilities=h,this._candidates=d,this._originCandidates=_n(d),this._iceParameters=o,this._dtlsParameters=l,this._localCapabilities=g,this.setup=f,this.cname=_,[this.sessionDesc]=this.updateRemoteRTPCapabilities(h),this.currentMidIndex=this.sessionDesc.mediaDescriptions.length-1}checkPreloadSsrcs(e){return e.length===this.preloadSsrcs.length&&e.every(t=>{var n;return me(n=this.preloadSsrcs).call(n,t)})}preloadRemoteMedia(e){let t=0;const n=[],i=[];for(;e>0;){const o=[hI({ssrcId:u0+t},L("USE_SUB_RTX")?{rtx:u0+t+1}:{})],l="".concat(u0+t,"_").concat(pI+t),{ssrcs:d,ssrcGroups:h}=Dm(o,this.cname,L("SYNC_GROUP")?l:void 0),f=this.preCreateOrRecycleSendMedia("video",d,h,void 0),g=[{ssrcId:pI+t}],_="".concat(u0+t,"_").concat(pI+t),{ssrcs:v,ssrcGroups:y}=Dm(g,this.cname,L("SYNC_GROUP")?_:void 0),b=this.preCreateOrRecycleSendMedia("audio",v,y,void 0);e--,t+=2,n.push(f,b),i.push(d[0].ssrcId,v[0].ssrcId)}return this.useLocalCodecsMids.push(...n),this.preloadSsrcs=i,{mids:n,preSSRCs:i,isAvailable:!0}}preCreateOrRecycleSendMedia(e,t,n,i){const o=this.rtpCapabilities.send.videoCodecs,l=this._isUseLocalCodecs||o.length===0?this.localCapabilities.recv:this.rtpCapabilities.send;S.debug("create or recycle send media without remote rtp capabilities, ssrcs ",t[0].ssrcId);const d=e===xe.VIDEO?l.videoCodecs:l.audioCodecs,h=e===xe.VIDEO?l.videoExtensions:l.audioExtensions;this.currentMidIndex+=1;const f="".concat(this.currentMidIndex);let g={media:{mediaType:e,port:d0,protos:["UDP","TLS","RTP","SAVPF"],fmts:d.map(_=>_.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:h,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:n,rtcpFeedbackWildcards:[],payloads:d,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(f)}};return g=this.mungSendMediaDesc(g,i),this.sessionDesc.mediaDescriptions.push(g),this.updateBundleMids(),f}toString(){return Yc(this.sessionDesc)}send(e,t,n,i){const{ssrcs:o,ssrcGroups:l}=Dm(t,this.cname,L("SYNC_GROUP")?n:void 0),d=this.findPreloadMediaDesc(o);if(d){if(gn()&&this.firefoxSsrcMidMap.set(o[0].ssrcId,d.attributes.mid),i&&(i.twcc||i.remb)){const h=this.sessionDesc.mediaDescriptions.indexOf(d);return this.sessionDesc.mediaDescriptions[h]=this.mungSendMediaDesc(d,i),{mid:d.attributes.mid,needExchangeSDP:!0}}return{mid:d.attributes.mid,needExchangeSDP:!1}}{const h=this.findAvailableMediaIndex(e,o);let f;return h===-1||h===1&&(kr()||function(){const g=Lt();return!(g.name!==Mt.CHROME||!g.osVersion)&&Number(g.version)<=90}()||L("ENABLE_ENCODED_TRANSFORM")&&Kc())||h===0&&!function(g){const _=Lt();return!(_.name!==Mt.FIREFOX||!_.osVersion)&&Number(_.version)===g}(138)&&L("USE_SUB_RTX")||FM()?(f=this.createOrRecycleSendMedia(e,o,l,"sendonly",i),this.updateBundleMids()):(f=_n(this.sessionDesc.mediaDescriptions[h]),f.attributes.direction="sendonly",f.attributes.ssrcs=o,f.attributes.ssrcGroups=l,this.sessionDesc.mediaDescriptions[h]=this.mungSendMediaDesc(f,i)),gn()&&this.firefoxSsrcMidMap.set(o[0].ssrcId,f.attributes.mid),{mid:f.attributes.mid,needExchangeSDP:!0}}}sendDataChannel(){const{mediaDesc:e,needExchangeSDP:t}=this.createOrRecycleDataChannel();return this.updateBundleMids(),{mid:e.attributes.mid,needExchangeSDP:t}}batchSend(e){const t=e.map(o=>{let{kind:l,ssrcMsg:d,mslabel:h}=o;return this.send(l,d,h)}),n=[];let i=!1;return t.forEach(o=>{let{mid:l,needExchangeSDP:d}=o;d&&(i=!0),n.push(l)}),{mids:n,needExchangeSDP:i}}stopSending(e){const t=this.sessionDesc.mediaDescriptions.filter(n=>n.attributes.mid&&e.indexOf(n.attributes.mid)!==-1);if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");t.forEach(n=>{n.attributes.mid==="0"||gn()||FM()?n.attributes.ssrcs=[]:(n.attributes.ssrcs=[],n.attributes.direction="inactive",n.media.port="0")}),this.updateBundleMids()}mute(e){const t=this.sessionDesc.mediaDescriptions.find(n=>n.attributes.mid===e);if(!t)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.mute."));t.attributes.direction="inactive"}unmute(e){const t=this.sessionDesc.mediaDescriptions.find(n=>n.attributes.mid===e);if(!t)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.unmute."));t.attributes.direction="sendonly"}muteRemote(e){const t=this.sessionDesc.mediaDescriptions.filter(n=>me(e).call(e,n.attributes.mid||""));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach(n=>{n.attributes.direction="inactive"})}unmuteRemote(e){const t=this.sessionDesc.mediaDescriptions.filter(n=>me(e).call(e,n.attributes.mid||""));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach(n=>{n.attributes.direction="recvonly"})}receive(e,t,n,i){e.forEach((o,l)=>{this.createOrRecycleRecvMedia(o,[],"recvonly",t,n,i[l])}),this.updateBundleMids()}stopReceiving(e){const t=this.sessionDesc.mediaDescriptions.filter(n=>e.indexOf(n.attributes.mid)!==-1);if(t.length!==e.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");t.forEach(n=>{n.media.port="0",n.attributes.direction="inactive"}),this.updateBundleMids()}updateRemoteRTPCapabilities(e){const t=this.sessionDesc||Ps((n=this._isUseExtmapAllowMixed,this._isUseDataChannel?hAe(n):`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=ice-lite`.concat(n?`
a=extmap-allow-mixed`:"",`
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`)));var n;this._rtpCapabilities=e;let i=!1;const o=this.rtpCapabilities.send,l=this.localCapabilities.send,d=this.localCapabilities.recv,h=d.videoCodecs,f=d.audioCodecs,g=d.videoExtensions,_=d.audioExtensions;for(const D of t.mediaDescriptions){var v;if(D.attributes.direction!=="sendonly"||typeof D.attributes.mid!="string"||!me(v=this.useLocalCodecsMids).call(v,D.attributes.mid)){if(i=!0,D.attributes.iceUfrag=this._iceParameters.iceUfrag,D.attributes.icePwd=this._iceParameters.icePwd,D.attributes.fingerprints=this._dtlsParameters.fingerprints,D.attributes.candidates=this._candidates,D.attributes.setup=this.setup,D.media.mediaType==="application"&&(D.attributes.sctpPort="5000"),D.media.mediaType==="video")if(this._isUseLocalCodecs&&D.attributes.direction==="sendonly"){var y;D.media.fmts=h.map(O=>O.payloadType.toString(10)),D.attributes.payloads=h,D.attributes.extmaps=g;const I=D.attributes.mid;typeof I!="string"||me(y=this.useLocalCodecsMids).call(y,I)||this.useLocalCodecsMids.push(I)}else if(o.videoCodecs.length===0){const I=l.videoCodecs.filter(O=>{var U,j;return(U=O.rtpMap)===null||U===void 0?void 0:me(j=U.encodingName.toLowerCase()).call(j,"vp8")});I.length===0&&I.push(l.videoCodecs[0]),D.media.fmts=I.map(O=>O.payloadType.toString(10)),D.attributes.payloads=I,D.attributes.extmaps=[]}else D.media.fmts=o.videoCodecs.map(I=>I.payloadType.toString(10)),D.attributes.payloads=o.videoCodecs,D.attributes.extmaps=o.videoExtensions;if(D.media.mediaType==="audio")if(this._isUseLocalCodecs&&D.attributes.direction==="sendonly"){var b;D.media.fmts=f.map(O=>O.payloadType.toString(10)),D.attributes.payloads=f,D.attributes.extmaps=_;const I=D.attributes.mid;typeof I!="string"||me(b=this.useLocalCodecsMids).call(b,I)||this.useLocalCodecsMids.push(I)}else if(o.audioCodecs.length===0){const I=l.audioCodecs.filter(O=>{var U,j;return(U=O.rtpMap)===null||U===void 0?void 0:me(j=U.encodingName.toLowerCase()).call(j,"opus")})||[l.audioCodecs[0]];D.media.fmts=I.map(O=>O.payloadType.toString(10)),D.attributes.payloads=I,D.attributes.extmaps=[]}else D.media.fmts=o.audioCodecs.map(I=>I.payloadType.toString(10)),D.attributes.payloads=o.audioCodecs,D.attributes.extmaps=o.audioExtensions,zh(D)}}return this.sessionDesc=t,this.currentMidIndex=t.mediaDescriptions.length-1,[this.sessionDesc,i]}updateCandidates(e){const t=this._originCandidates.filter(i=>i.transport==="udp"),n=[];if(t.forEach(i=>{n.push(hI(hI({},i),{},{foundation:"tcpcandidate",priority:Number(i.priority)-1+"",transport:"tcp",port:Number(i.port)+90+""}))}),t.length!==0){switch(e){case Ur.TCP_RELAY:this._candidates=n;break;case Ur.UDP_TCP_RELAY:case Ur.RELAY:this._candidates=[...t,...n];break;default:this._candidates=t}for(const i of this.sessionDesc.mediaDescriptions)i.attributes.candidates=this.candidates}}restartICE(e){e=_n(e),this._iceParameters=e,this.sessionDesc.mediaDescriptions.forEach(t=>{t.attributes.iceUfrag=e.iceUfrag,t.attributes.icePwd=e.icePwd})}predictReceivingMids(e){const t=[];for(let n=0;n<e;n++)t.push((this.currentMidIndex+n+1).toString(10));return t}findAvailableMediaIndex(e,t){return this.sessionDesc.mediaDescriptions.findIndex(n=>{const i=n.media.mediaType===e&&n.media.port!=="0"&&(n.attributes.direction==="sendonly"||n.attributes.direction==="sendrecv")&&n.attributes.ssrcs.length===0;if(gn()){if(i){const o=this.firefoxSsrcMidMap.get(t[0].ssrcId);return!(o||n.attributes.mid!=="0"&&n.attributes.mid!=="1")||!(!o||o!==n.attributes.mid)}return!1}return i})}createOrRecycleDataChannel(){for(const n of this.sessionDesc.mediaDescriptions)if(n.media.mediaType==="application")return{mediaDesc:n,needExchangeSDP:!1};this.currentMidIndex+=1;const e="".concat(this.currentMidIndex),t={media:{mediaType:"application",port:d0,protos:["UDP","DTLS","SCTP"],fmts:["webrtc-datachannel"]},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:[],fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[],rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,mid:"".concat(e),sctpPort:"5000"}};return this.sessionDesc.mediaDescriptions.push(t),{mediaDesc:t,needExchangeSDP:!0}}createOrRecycleRecvMedia(e,t,n,i,o,l){const d=e._mediaStreamTrack.kind,h=this.rtpCapabilities.recv,f=km(d,h,this.localCapabilities.send,d===xe.VIDEO?i:o),g=d===xe.VIDEO?h.videoExtensions:h.audioExtensions;this.currentMidIndex+=1;const _="".concat(this.currentMidIndex);let v={media:{mediaType:d,port:d0,protos:["UDP","TLS","RTP","SAVPF"],fmts:f.map(b=>b.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:g,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:f,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:n,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(_)}};v=this.mungRecvMediaDsec(v,e,l);const y=this.findFirstClosedMedia(d);if(y){const b=this.sessionDesc.mediaDescriptions.indexOf(y);this.sessionDesc.mediaDescriptions[b]=v}else this.sessionDesc.mediaDescriptions.push(v);return v}updateRemoteDtlsParameters(e){const t=new Set(this._dtlsParameters.fingerprints.map(o=>o.fingerprint)),n=new Set(e.map(o=>o.fingerprint));let i=!1;t.size!==n.size&&(i=!0);for(const o of t)n.has(o)||(i=!0);return i}updateRemoteCodec(e,t,n){const i=[...new Set(this._rtpCapabilities.recv.videoCodecs.map(v=>v.rtpMap&&v.rtpMap.encodingName.toLowerCase()||"").filter(v=>{var y;return me(y=Object.keys(Id)).call(y,v)}))],o=new Set(t);if(i.every(v=>o.has(v)))return S.debug("codecs has not changed, no need to updateRemoteCodec, codecs: ".concat(t)),!1;const l=this._rtpCapabilities.recv.videoCodecs.filter(v=>t.some(y=>{var b;return me(b=v.rtpMap&&v.rtpMap.encodingName.toLowerCase()||"").call(b,y)}));if(l.length===0)return S.debug("updateRemoteCodec failed, because cannot find matched codec, remoteCapabilities codecs: ".concat(i," codecs: ").concat(t)),!1;const d=[...new Set(l.map(v=>v.rtpMap&&v.rtpMap.encodingName.toLowerCase()||""))];let h;if(S.debug("updateRemoteCodec, from ".concat(i," to ").concat(d)),e.length===0)h=this.sessionDesc.mediaDescriptions.filter(v=>v.media.mediaType==="video"&&v.attributes.direction==="recvonly");else if(h=this.sessionDesc.mediaDescriptions.filter(v=>v.attributes.mid&&v.media.mediaType==="video"&&me(e).call(e,v.attributes.mid)&&v.attributes.direction==="recvonly"),h.length!==e.length)return S.debug("updateRemoteCodec failed, because cannot find mids, mids: ".concat(e,", codecs: ").concat(t)),!1;if(L("USE_PUB_RTX")||L("USE_SUB_RTX")){const v=Jl(l,this.rtpCapabilities.recv.videoCodecs);l.push(...v)}this._rtpCapabilities.recv.videoCodecs=l;const f=this.localCapabilities.send,g=this.rtpCapabilities.recv,_=km(xe.VIDEO,g,f,n);return h.forEach(v=>{const y=_.map(b=>b.payloadType.toString(10));S.debug("updateRemoteCodec mid: ".concat(v.attributes.mid,", from"),v.attributes.payloads,"to",_),v.attributes.payloads=_,v.media.fmts=y}),S.debug("updateRemoteCodec success, mids: ".concat(e,", codecs: ").concat(t,", remote recv: ").concat(this._rtpCapabilities.recv.videoCodecs.length,", remote send: ").concat(this._rtpCapabilities.send.videoCodecs.length)),!0}createOrRecycleSendMedia(e,t,n,i,o){const l=this.rtpCapabilities.send.videoCodecs,d=this._isUseLocalCodecs||l.length===0?this.localCapabilities.recv:this.rtpCapabilities.send,h=e===xe.VIDEO?d.videoCodecs:d.audioCodecs,f=e===xe.VIDEO?d.videoExtensions:d.audioExtensions;this.currentMidIndex+=1;const g="".concat(this.currentMidIndex);let _={media:{mediaType:e,port:d0,protos:["UDP","TLS","RTP","SAVPF"],fmts:h.map(y=>y.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:f,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:n,rtcpFeedbackWildcards:[],payloads:h,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:i,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(g)}};_=this.mungSendMediaDesc(_,o);const v=this.findFirstClosedMedia(e);if(v){const y=this.sessionDesc.mediaDescriptions.indexOf(v);this.sessionDesc.mediaDescriptions[y]=_}else this.sessionDesc.mediaDescriptions.push(_);return _}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(e=>e.media.port!=="0").map(e=>e.attributes.mid)}mungRecvMediaDsec(e,t,n){const i=_n(e);return $R(i),Fd(i,t),ZR(i,t),_V(i),s0(i,n,this.localCapabilities.send),i}mungSendMediaDesc(e,t){const n=_n(e);return n.attributes&&n.attributes.payloads&&Array.isArray(n.attributes.payloads)&&n.attributes.payloads.length>0&&n.attributes.payloads.forEach(i=>{i.rtpMap&&i.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&L("ENABLE_DOWN_SPS_PPS")&&(i.fmtp&&i.fmtp.parameters||(i.fmtp={parameters:{}}),i.fmtp.parameters["sps-pps-idr-in-keyframe"]="1")}),s0(n,t,this.localCapabilities.recv),zh(n),n}updateRecvMedia(e,t){const n=this.sessionDesc.mediaDescriptions.findIndex(i=>i.attributes.mid===e);if(n!==-1){const i=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[n],t);this.sessionDesc.mediaDescriptions[n]=i}}bumpMid(e){this.currentMidIndex+=e}findFirstClosedMedia(e){return this.sessionDesc.mediaDescriptions.find(t=>gn()?t.media.port==="0"&&t.media.mediaType===e:t.media.port==="0")}findPreloadMediaDesc(e){return this.sessionDesc.mediaDescriptions.find(t=>{var n;return((n=t.attributes)===null||n===void 0||(n=n.ssrcs[0])===null||n===void 0?void 0:n.ssrcId)===e[0].ssrcId})}getSSRC(e){var t;return(t=this.sessionDesc.mediaDescriptions.find(n=>n.attributes.mid===e))===null||t===void 0?void 0:t.attributes.ssrcs}};function KV(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}function Jc(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?KV(Object(n),!0).forEach(function(i){x(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):KV(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}var Jh=function(e){return e[e.DOWN=0]="DOWN",e[e.UP=1]="UP",e}(Jh||{});const h0=new Map;function WV(e,t,n,i){let{scale:o}=e;if(o===0&&i===Jh.UP||o>=t.length-1&&i===Jh.DOWN)return e;let l=Jc(Jc({},e),{},{scale:i===Jh.DOWN?++o:--o});switch(n){case"maintain-framerate":l=Jc(Jc({},l),t[o].motion);break;case"maintain-resolution":l=Jc(Jc({},l),t[o].detail);break;case"balanced":l=Jc(Jc({},l),t[o].balanced)}return l}function YV(e,t){if(t){const n={overUse:0,underUse:0,adaptationList:zV(t)};h0.set(e,n)}else h0.delete(e)}function zV(e){const t=Jc({},e),{bitrateMax:n,frameRate:i,scaleResolutionDownBy:o,bitrateMin:l}=t,{MIN_FRAME_RATE:d,MAX_THRESHOLD_FRAMERATE:h,MAX_SCALE:f,BITRATE_MIN_THRESHOLD:g,BITRATE_MAX_THRESHOLD:_,BWE_SCALE_UP_THRESHOLD:v,BWE_SCALE_DOWN_THRESHOLD:y,PERF_SCALE_DOWN_THRESHOLD:b,PERF_SCALE_UP_THRESHOLD:D,BALANCE_BITRATE_FACTOR:I,BALANCE_FRAMERATE_FACTOR:O,BALANCE_RESOLUTION_FACTOR:U,MOTION_RESOLUTION_FACTOR:j,MOTION_BITRATE_FACTOR:G,DETAIL_FRAMERATE_FACTOR:$,DETAIL_BITRATE_FACTOR:Z}=oR,X=Math.min(t.frameRate,h),ee=[{scale:0,threshold:{bwe_down:Math.round(Math.pow(y,1)*n),bwe_up:n,fps_down:Math.round(Math.pow(b,1)*X),fps_up:i},balanced:{scaleResolutionDownBy:1,frameRate:i,bitrateMax:n,bitrateMin:l},motion:{scaleResolutionDownBy:1,frameRate:i,bitrateMax:n,bitrateMin:l},detail:{scaleResolutionDownBy:1,frameRate:i,bitrateMax:n,bitrateMin:l}}];for(let le=1;le<=f;le++){const fe={bwe_up:Math.round(Math.pow(v,le)*n),bwe_down:Math.round(Math.pow(y,le+1)*n),fps_up:Math.round(Math.pow(D,le)*X),fps_down:Math.round(Math.pow(b,le+1)*X)},Ie={scaleResolutionDownBy:o/Math.pow(U,le),frameRate:Math.max(Math.round(Math.pow(O,le)*i),d),bitrateMax:Math.max(Math.round(Math.pow(I,le)*n),_),bitrateMin:Math.max(Math.round(Math.pow(I,le)*l),g)},et={scaleResolutionDownBy:o/Math.pow(j,le),frameRate:i,bitrateMax:Math.max(Math.round(Math.pow(G,le)*n),_),bitrateMin:Math.max(Math.round(Math.pow(G,le)*l),g)},Je={scaleResolutionDownBy:1,frameRate:Math.max(Math.round(Math.pow($,le)*i),d),bitrateMax:Math.max(Math.round(Math.pow(Z,le)*n),_),bitrateMin:Math.max(Math.round(Math.pow(Z,le)*l),g)};ee.push({scale:le,threshold:fe,balanced:Ie,motion:et,detail:Je})}return ee}function pAe(e,t,n,i,o,l){const d=h0.get(e)||{overUse:0,underUse:0,adaptationList:zV(o)},{adaptationList:h}=d;h0.set(e,d);const{OVERUSE_TIMES_THRESHOLD:f,UNDERUSE_TIMES_THRESHOLD:g}=oR,{scale:_}=i;let v,y;return typeof t=="number"&&t>0&&function(b,D,I,O){if(D>=I.length)return!1;let{threshold:{fps_down:U}}=I[D];return L("FORCE_AG_HIGH_FRAMERATE")&&O==="maintain-framerate"&&(U=I[0].threshold.fps_down),b<U}(t,_,h,l)&&(d.overUse++,y=Nh.CPU,d.overUse>f)||typeof n=="number"&&n>0&&function(b,D,I){if(D>=I.length)return!1;const{threshold:{bwe_down:O}}=I[D];return b<O}(n,_,h)&&(d.overUse++,y=Nh.BANDWIDTH,d.overUse>f)?(d.overUse=0,d.underUse=0,v=WV(i,h,l,Jh.DOWN),[v,y]):(typeof t=="number"&&t>0&&typeof n=="number"&&n>0&&function(b,D,I,O){if(D===0)return;let{threshold:{fps_up:U}}=I[D];return L("FORCE_AG_HIGH_FRAMERATE")&&O==="maintain-framerate"&&(U=I[1].threshold.fps_up),b>U}(t,_,h,l)&&function(b,D,I){if(D===0)return;const{threshold:{bwe_up:O}}=I[D];return b>O}(n,_,h)&&(d.underUse++,d.underUse>g&&(d.overUse=0,d.underUse=0,v=WV(i,h,l,Jh.UP),v.scale===0&&(y=Nh.NONE))),[v,y])}function qV(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}function fI(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?qV(Object(n),!0).forEach(function(i){x(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):qV(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}function XV(e){var t;return!!L("ENABLE_AG_ADAPTATION")&&!!(e instanceof Pv||me(t=e._hints).call(t,Wt.CUSTOM_TRACK))&&(!!L("FORCE_SUPPORT_AG_ADAPTATION")||!!(PM(14,0,!1)&&MM(17,4,!0)||UM(14)&&VT(17,4,!0)))}const p0=new Map;function JV(e,t,n,i,o,l){if($h(e,n),o(t),i!=="balanced"&&i!=="maintain-framerate"&&i!=="maintain-resolution")return;let d=-1;YV(e,t);const h=window.setInterval(()=>{const g=p0.get(e);if(!L("ENABLE_AG_ADAPTATION")||!g)return $h(e,n),void o(t);const _=l();if(_.sendPackets>0&&_.OutgoingAvailableBandwidth>0){if(d===-1)return void(d=Date.now());if(Date.now()-d<1e3)return;const v=_.sendFrameRate,y=_.OutgoingAvailableBandwidth,[b,D]=pAe(e,v,y,g.adaptationConfig,t,i);D&&(n.qualityLimitationReason=D),b&&g.adaptationConfig.scale!==b.scale&&(S.debug("[".concat(e,"] applyAdaptation: ").concat(n.qualityLimitationReason,`
           sendFps `).concat(v,", bwe ").concat(y,", switch from ").concat(g.adaptationConfig.scale," to ").concat(b.scale," ")),g.adaptationConfig=fI(fI({},g.adaptationConfig),b),o(b))}},L("CHECK_LOCAL_STATS_INTERVAL")),f=fI({},t);p0.set(e,{timer:h,adaptationConfig:f,originConfig:t,adaptationFunc:o}),S.debug("[".concat(e,"] start adaptation, originConfig: ").concat(JSON.stringify(t),", degradationPreference: ").concat(i))}function $h(e,t){const n=p0.get(e);if(n){const{timer:i}=n;window.clearTimeout(i),p0.delete(e)}t.qualityLimitationReason=Nh.NONE,YV(e)}function fAe(e,t){var n;let i;switch(t){case ge.LocalAudioTrack:i=Xt.Audio;break;case ge.LocalVideoTrack:i=me(n=e._hints).call(n,Wt.SCREEN_TRACK)?Xt.Screen:Xt.High;break;case ge.LocalVideoLowTrack:i=Xt.Low}return i}function mI(e){const t=wt();if(e.some(n=>n._bypassWebAudio))throw new ae(P.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");if(!t.webAudioMediaStreamDest)throw new ae(P.NOT_SUPPORTED,"cannot publish multiple tracks because your browser does not support audio mixing")}function gI(e,t){mI(e);const n=new dr;return e.forEach(i=>n.addAudioTrack(i)),n}const mAe=!wt().supportUnifiedPlan||L("CHROME_FORCE_PLAN_B")&&uc();function Mm(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(e.useDcSignal)return n={spec:t,store:e},Po("DataChannelConnection").create(n);var n;return mAe?function(o){return Po("PlanBConnection").create(o)}({spec:t,store:e}):new zi(t,e)}function _I(e){return e&&(e.iceConnectionState==="disconnected"||e.iceConnectionState==="checking"||e.iceConnectionState==="failed")}function EI(e){try{if(e.iceServers)return!1;if(e.turnServer&&e.turnServer.mode!=="off"){if(yd(e.turnServer.servers))return!1;if(L("FORCE_TURN_TCP")||e.turnServer.servers.concat(e.turnServer.serversFromGateway||[]).some(t=>t.forceturn))return!0}return!1}catch{return!1}}var Dt;function $V(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}function Fo(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?$V(Object(n),!0).forEach(function(i){x(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):$V(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}let zi=(Dt=class fu extends $v{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var t,n;return(t=(n=this.peerConnection.getReceivers()[0])===null||n===void 0||(n=n.transport)===null||n===void 0?void 0:n.state)!==null&&t!==void 0?t:null}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.send.videoCodecs.map(t=>t.rtpMap&&t.rtpMap.encodingName.toLowerCase()||"").filter(t=>{var n;return me(n=Object.keys(Id)).call(n,t)}))]}constructor(t,n){super(t,n),x(this,"id",zt(5,"connection-")),x(this,"store",void 0),x(this,"peerConnection",void 0),x(this,"forceTurn",!1),x(this,"remoteSDP",void 0),x(this,"initialOffer",void 0),x(this,"transportEventReceiver",void 0),x(this,"statsFilter",void 0),x(this,"extension",{useXR:L("USE_XR")}),x(this,"localCapabilities",void 0),x(this,"remoteCodecs",void 0),x(this,"localCandidateCount",0),x(this,"allCandidatesReceived",!1),x(this,"isPreallocation",!1),x(this,"isPreRender",!1),x(this,"preMediaMap",new Map),x(this,"dataStreamChannelMap",new Map),x(this,"establishPromise",void 0),x(this,"recoveredDataChannelIds",[]),x(this,"currentDataChannelId",1),x(this,"supportAV1RtpSpec",!1),x(this,"mutex",void 0),x(this,"qualityLimitationReason",Nh.NONE),x(this,"isFirstConnected",!1),this.store=n,this.forceTurn=EI(t),this.mutex=new Lr("P2PConnection-mutex",n.clientId),this.peerConnection=new RTCPeerConnection(fu.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.isFirstConnected=!1,this.statsFilter=Tv(this.peerConnection,L("STATS_UPDATE_INTERVAL"),void 0,gn()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,t.isPreallocation&&(this.isPreallocation=!0),this.establishPromise=this.establish()}getPreMedia(t){return this.preMediaMap.get(t)}isPreSub(){return this.preMediaMap.size>0}async updateRemoteRTPCapabilities(t,n){if(this.remoteCodecs=n,!this.remoteSDP)return void S.debug("[P2PConnection] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(this.localCodecs,", codecs: ").concat(n));if(this.remoteSDP.updateRemoteCodec(t,n,this.store.codec)){const i=await this.peerConnection.createOffer(),o=this.logSDPExchange(i.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(i);const l=this.remoteSDP.toString();o==null||o(l),await this.peerConnection.setRemoteDescription({type:"answer",sdp:l})}else S.debug("[P2PConnection] updateRemoteRTPCapabilities no need to exchange SDP.")}async establish(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});const n=await this.peerConnection.createOffer();if(!n.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const i=_c(n.sdp),o=await tI({filterRTX:!L("USE_PUB_RTX")&&!L("USE_SUB_RTX"),filterVideoFec:L("FILTER_VIDEO_FEC"),filterAudioFec:L("FILTER_AUDIO_FEC"),filterVideoCodec:L("FILTER_VIDEO_CODEC"),unsupportedVideoUplinkCodec:L("UNSUPPORTED_VIDEO_UPLINK_CODEC"),unsupportedVideoDownlinkCodec:L("UNSUPPORTED_VIDEO_DOWNLINK_CODEC")},this.extension);if(this.localCapabilities=Bm(o),this.initialOffer=n,L("ENABLE_SVC")&&this.store.codec=="av1"){const d=await EV();var t;d&&(this.supportAV1RtpSpec=!0,(t=o.send)===null||t===void 0||t.videoExtensions.push(d))}let l;return n.sdp&&i0(n.sdp)&&(l=_n(o),dV(l)),Fo(Fo({},i),{},{rtpCapabilities:l||o,offerSDP:n.sdp})}catch(n){throw new ae(P.GET_LOCAL_CONNECTION_PARAMS_FAILED,n.toString())}}async connect(t){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.initialOffer.sdp&&i0(this.initialOffer.sdp)&&uV(t.rtpCapabilities,this.localCapabilities),this.remoteSDP=new GV(Fo(Fo({},t),{},{localCapabilities:this.localCapabilities}),this.supportAV1RtpSpec,!(!L("ENABLE_PRE_SUB_WITH_PRE_PC")||!L("PRE_USE_LOCAL_CODECS"))&&Sm(this.store)),t.preallocation&&(this.isPreallocation=!0),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const n=this.remoteSDP.toString(),i=nI(this.initialOffer.sdp,this.extension),o=this.logSDPExchange(i||"","offer","local","connect");this.store.descriptionStart(),await this.peerConnection.setLocalDescription({type:"offer",sdp:i}),o==null||o(n),await this.peerConnection.setRemoteDescription({type:"answer",sdp:n});const l=this.peerConnection.getTransceivers()[0];if(l!=null&&l.receiver&&this.tryBindTransportEvents(l.receiver),Sm(this.store))if(t.preallocation&&L("ENABLE_PRE_SUB_WITH_PRE_PC")){const d=L("PRE_SUB_NUM"),{mids:h,preSSRCs:f}=this.remoteSDP.preloadRemoteMedia(d);await pi(this.peerConnection,this.remoteSDP,this.extension),S.debug("[".concat(this.store.clientId,"] [P2PConnection] preload media, in pre pc,add preload ssrcs ").concat(f)),this.presetMedia(h,f)}else{const{preSSRCs:d=[]}=t,h=d.map(g=>g.ssrcMsg[0].ssrcId);if(d.length===0)return;const{mids:f}=this.remoteSDP.batchSend(d.map(g=>Object.assign({},g)));await pi(this.peerConnection,this.remoteSDP,this.extension),S.debug("[P2PConnection.connect] preload media, after join, add preload ssrcs ".concat(h)),this.presetMedia(f,h)}}catch(n){throw new ae(P.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(n.toString()))}}presetMedia(t,n){t.forEach((i,o)=>{this.peerConnection.getTransceivers().forEach(l=>{if(l.mid!=null&&i===l.mid&&l.receiver.track){const d=l.receiver.track;let h;d.kind==="video"&&L("ENABLE_PRE_RENDER")&&(h=new Uv({trackId:"track-".concat(d.kind,"-unknown-").concat(this.store.clientId,"_").concat(zt(5,""))},!0),h.updateVideoTrack(d),h.onFirstVideoFrameRender=()=>{var f;const g=this.preMediaMap.get(n[o]);g&&(g.firstVideoRender=Date.now()),(f=this.onFirstVideoRender)===null||f===void 0||f.call(this,n[o])},h.onVideoBufferReady=()=>{var f;(f=this.onFirstVideoBufferReady)===null||f===void 0||f.call(this,n[o])},h.play(this.store.sessionId||void 0),this.isPreRender=!0),this.preMediaMap.set(n[o],{mid:i,track:d,player:h,transceiver:l})}}),this.store.peerReceiver()})}checkDtlsParameters(t){return!!this.remoteSDP&&t.length>0&&this.remoteSDP.updateRemoteDtlsParameters(t)}async updateRemoteConnect(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateRemoteConnect before remote SDP created");let n=!1;const{rtpCapabilities:i}=t;if([,n]=this.remoteSDP.updateRemoteRTPCapabilities(i),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0){const d=this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);n=n||d}const{preSSRCs:o=[]}=t,l=o.map(d=>d.ssrcMsg[0].ssrcId);if(!this.remoteSDP.checkPreloadSsrcs(l)){const d=[],h=[];if(Array.from(this.preMediaMap.entries()).every(f=>{let[g,{mid:_,player:v,track:y}]=f;return d.push(_),h.push(g),this.preMediaMap.delete(g),v&&v.destroy(),!0}),d.length>0&&(this.remoteSDP.stopSending(d),await pi(this.peerConnection,this.remoteSDP,this.extension),S.warn("[P2PConnection.updateRemoteConnect] preload media, failed, del preload ssrcs ".concat(h)),ke.reportApiInvoke(this.store.sessionId,{name:yn.PRELOAD_MEDIA_FAILED,options:[o,h],tag:an.TRACER}).onSuccess()),o.length>0){const{mids:f}=this.remoteSDP.batchSend(o.map(g=>Object.assign({},g)));await pi(this.peerConnection,this.remoteSDP,this.extension),S.debug("[P2PConnection.updateRemoteConnect] preload media, after join, add preload ssrcs ".concat(l)),this.presetMedia(f,l)}}n?(await pi(this.peerConnection,this.remoteSDP,this.extension),S.debug("[P2PConnection] updateRemoteConnect by exchanging SDP.")):S.debug("[P2PConnection] updateRemoteConnect no need to exchange SDP, because no need to update remote codecs (use local codecs)")}catch(n){throw new ae(P.EXCHANGE_SDP_FAILED,"P2PConnection.updateRemoteConnect failed; ".concat(n.toString()))}}send(t,n,i){var o=this;return qs(function*(){const l=yield ft(o.mutex.lock("From P2PConnection.send"));try{if(!o.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const d=[],h=Om();t.forEach(O=>{const U=o.peerConnection.addTransceiver(O._mediaStreamTrack,Fo({direction:"sendonly"},O.trackMediaType==="video"&&o.supportAV1RtpSpec&&h?{sendEncodings:[{scalabilityMode:h}]}:{}));d.push(U),O._updateRtpTransceiver(U)}),gn()&&L("SIMULCAST")===!0&&(yield ft(o.applySimulcastForFirefox(d,t)));const f=yield ft(o.peerConnection.createOffer()),g=o.remoteSDP.predictReceivingMids(t.length),_=o.mungSendOfferSDP(f.sdp,t,g),v=Ps(_),y=g.map(O=>{const U=v.mediaDescriptions.find(j=>j.attributes.mid===O);if(!U)throw new Error("Cannot extract ssrc from mediaDescription.");return JR(U,L("USE_PUB_RTX"))});let b;try{b=yield y}catch(O){b=[],o.remoteSDP.receive(t,n,i,b);const U=o.remoteSDP.toString();throw yield ft(o.peerConnection.setLocalDescription({type:"offer",sdp:_})),yield ft(o.peerConnection.setRemoteDescription({type:"answer",sdp:U})),yield ft(o.stopSending(g,!0)),O}o.remoteSDP.receive(t,n,i,b);const D=o.remoteSDP.toString(),I=o.logSDPExchange(_,"offer","local","send");return yield ft(o.peerConnection.setLocalDescription({type:"offer",sdp:_})),yield ft(o.applySimulcastEncodings(d,t)),yield ft(o.applySendEncodings(d,t)),I==null||I(D),yield ft(o.peerConnection.setRemoteDescription({type:"answer",sdp:D})),d.map((O,U)=>{const j=g[U];return{localSSRC:y[U],id:j,transceiver:O}})}catch(d){throw d instanceof ae?d:new ae(P.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(d.toString()))}finally{l()}})()}async createDataChannels(t,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.createDataChannels before remote SDP created");let i=this.dataStreamChannelMap.get(t);if(i&&i.readyState==="open")S.debug("[P2PConnection] Channels are already available and can be reused directly.");else{const l=this.currentDataChannelId<1023?this.currentDataChannelId++:this.recoveredDataChannelIds.shift();if(typeof l!="number")throw new Error("create DataChannel error, because cannot get dc id");i=this.peerConnection.createDataChannel("datastream-channel",{id:l,negotiated:!0,ordered:!1,maxRetransmits:L("DATASTREAM_MAX_RETRANSMITS")}),i.binaryType="arraybuffer",this.dataStreamChannelMap.set(t,i)}n.forEach(l=>{l._updateOriginDataChannel(i)});const{needExchangeSDP:o}=this.remoteSDP.sendDataChannel();if(o){const l=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:l});const d=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(d),S.debug("[P2PConnection] createDataChannels by exchanging SDP.")}else S.debug("[P2PConnection] createDataChannels no need to exchange SDP.");return}catch(i){throw i instanceof ae?i:new ae(P.EXCHANGE_SDP_FAILED,"P2PConnection.createDataChannels failed; ".concat(i.toString()))}}async stopDataChannels(t){try{const n=this.dataStreamChannelMap.get(t);return n&&(n.id&&this.recoveredDataChannelIds.push(n.id),n.close()),void this.dataStreamChannelMap.delete(t)}catch(n){throw n instanceof ae?n:new ae(P.DATACHANNEL_FAILED,"P2PConnection.stopDataChannels failed; ".concat(n.toString()))}}async stopSending(t,n){const i=n?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const o=this.peerConnection.getTransceivers().filter(f=>t.indexOf(f.mid)!==-1);if(o.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");o.map(f=>{var g;$h(this.id+f.mid,this),f.direction="inactive",(g=f.stop)===null||g===void 0||g.call(f)});const l=await this.peerConnection.createOffer(),d=this.logSDPExchange(l.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(l),this.remoteSDP.stopReceiving(t);const h=this.remoteSDP.toString();d==null||d(h),await this.peerConnection.setRemoteDescription({type:"answer",sdp:h})}catch(o){throw new ae(P.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(o.toString()))}finally{i&&i()}}async receive(t,n,i,o){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));const{mid:l,needExchangeSDP:d}=this.remoteSDP.send(t,n,i,o);d&&(await pi(this.peerConnection,this.remoteSDP,this.extension),S.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP.")));const h=this.peerConnection.getTransceivers().find(f=>f.mid===l);if(!h)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:h.receiver.track,id:l,transceiver:h}}catch(l){throw new ae(P.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(l.toString()))}}async batchReceive(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const{mids:n,needExchangeSDP:i}=this.remoteSDP.batchSend(t);return i&&(await pi(this.peerConnection,this.remoteSDP,this.extension),S.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive by exchanging SDP."))),n.map(o=>{const l=this.peerConnection.getTransceivers().find(d=>d.mid===o);if(!l)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:l.receiver.track,id:o,transceiver:l}})}catch(n){throw new ae(P.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(n.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");t.forEach(l=>{Array.from(this.preMediaMap.entries()).some(d=>{let[h,{mid:f,player:g}]=d;if(f===l)return this.preMediaMap.delete(h),g&&g.destroy(),!0})}),this.remoteSDP.stopSending(t);const n=this.remoteSDP.toString(),i=this.logSDPExchange(n,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const o=await this.peerConnection.createAnswer();i==null||i(o.sdp||""),await this.peerConnection.setLocalDescription(o)}catch(n){throw new ae(P.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}async muteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.mute(t);const n=this.remoteSDP.toString(),i=this.logSDPExchange(n,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const o=await this.peerConnection.createAnswer();i==null||i(o.sdp||""),await this.peerConnection.setLocalDescription(o)}catch(n){throw new ae(P.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(n.toString()))}}async unmuteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.unmute(t);const n=this.remoteSDP.toString(),i=this.logSDPExchange(n,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const o=await this.peerConnection.createAnswer();i==null||i(o.sdp||""),await this.peerConnection.setLocalDescription(o)}catch(n){throw new ae(P.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(n.toString()))}}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(d=>d.mid&&t.indexOf(d.mid)!==-1);if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(d=>{d.direction="inactive"});const i=await this.peerConnection.createOffer(),o=this.logSDPExchange(i.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(i),this.remoteSDP.muteRemote(t);const l=this.remoteSDP.toString();o==null||o(l),await this.peerConnection.setRemoteDescription({type:"answer",sdp:l})}catch(n){throw new ae(P.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(n.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(d=>d.mid&&t.indexOf(d.mid)!==-1);if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(async(d,h)=>{d.direction="sendonly"});const i=await this.peerConnection.createOffer(),o=this.logSDPExchange(i.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(i),this.remoteSDP.unmuteRemote(t),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec(t,this.remoteCodecs,this.store.codec);const l=this.remoteSDP.toString();o==null||o(l),await this.peerConnection.setRemoteDescription({type:"answer",sdp:l})}catch(n){throw new ae(P.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(n.toString()))}}restartICE(t){var n=this;return qs(function*(){const i=yield ft(n.mutex.lock("From P2PConnection.restartICE"));try{if(!n.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const o=wt().supportPCSetConfiguration,l=L("FORCE_TURN_TCP")||n.forceTurn;if(t===Ur.RELAY&&!o)return;if(o&&!l){const v=t===Ur.RELAY?"relay":"all",y=n.peerConnection.getConfiguration();y.iceTransportPolicy!==v&&(S.debug("[".concat(n.store.clientId,"] restartICE change iceTransportPolicy from [").concat(y.iceTransportPolicy,"] to [").concat(v,"]")),y.iceTransportPolicy=v,n.peerConnection.setConfiguration(y))}n.remoteSDP.updateCandidates(t);const d=yield ft(n.peerConnection.createOffer({iceRestart:!0}));if(!d.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const h=_c(d.sdp),{remoteIceParameters:f}=yield h.iceParameters;n.remoteSDP.restartICE(f);const g=n.remoteSDP.toString(),_=n.logSDPExchange(d.sdp||"","offer","local","restartICE");n.store.descriptionStart(),yield ft(n.peerConnection.setLocalDescription(d)),_==null||_(g),yield ft(n.peerConnection.setRemoteDescription({type:"answer",sdp:g}))}catch(o){S.warning("[".concat(n.store.clientId,"] restart ICE failed, abort operation"),o)}finally{i()}})()}async extendCandidate(){if(!this.remoteSDP||this.isFirstConnected)return;const t=await this.mutex.lock("From P2PConnection.extendCandidate");try{this.remoteSDP.updateCandidates(Ur.TCP_RELAY),await pi(this.peerConnection,this.remoteSDP,this.extension)}catch(n){S.warning("[".concat(this.store.clientId,"] extend candidate failed, abort operation"),n)}finally{t()}}close(){var t;this.peerConnection.getTransceivers().forEach(n=>{$h(this.id+n.mid,this)}),this.preMediaMap.forEach(n=>{let{player:i}=n;i&&i.destroy()}),this.preMediaMap.clear(),this.peerConnection.close(),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear(),this.recoveredDataChannelIds=[],this.currentDataChannelId=1}getStats(){return Fo(Fo({},this.statsFilter.getStats()),{},{qualityLimitationReason:this.qualityLimitationReason})}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const i=await this.peerConnection.createOffer(),o=this.mungSendOfferSDP(i.sdp,[n],[t]);this.remoteSDP.updateRecvMedia(t,n);const l=this.remoteSDP.toString(),d=this.logSDPExchange(o,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:o}),d==null||d(l),await this.peerConnection.setRemoteDescription({type:"answer",sdp:l})}catch(i){throw new ae(P.EXCHANGE_SDP_FAILED,i.toString())}}async updateSendParameters(t,n){const i=this.peerConnection.getTransceivers().filter(o=>o.mid===t);i.length===1&&(this.isVP8Simulcast(n)?gn()||await this.applySimulcastEncodings(i,[n]):await this.applySendEncodings(i,[n]))}setStatsRemoteVideoIsReady(t,n){this.statsFilter.setVideoIsReady2(t,n)}async replaceTrack(t,n){const i=this.peerConnection.getTransceivers().find(o=>o.mid===n);i&&await i.sender.replaceTrack(t._mediaStreamTrack)}async getSelectedCandidatePair(){const t=this.peerConnection.getReceivers();if(t.length>0&&t[0].transport&&t[0].transport.iceTransport&&t[0].transport.iceTransport.getSelectedCandidatePair&&t[0].transport.iceTransport.getSelectedCandidatePair()){const n=t[0].transport.iceTransport,{local:i,remote:o}=n.getSelectedCandidatePair();return{local:Fo(Fo({},Xa),{},{candidateType:i.type,protocol:i.protocol,address:i.address,port:i.port}),remote:Fo(Fo({},Xa),{},{candidateType:o.type,protocol:o.protocol,address:o.address,port:o.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t;(t=this.onICEConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;this.peerConnection.connectionState==="connected"&&(this.isFirstConnected=!0),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidateerror=t=>{if(t&&(t.errorCode||t.errorText)){var n;const i="code: ".concat(t.errorCode,", message: ").concat(t.errorText),o=t.port?"local: ".concat(t.port):"",l=gc(t.url||"");S.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICECandidateError(").concat(i,"), url: ").concat(l||"",", host_candidate:").concat(o)),(n=this.onICECandidateError)===null||n===void 0||n.call(this,i)}},this.peerConnection.onicegatheringstatechange=t=>{t&&t.target&&"iceGatheringState"in t.target&&S.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] RTCPeerConnection.onicegatheringstatechange(").concat(t.target.iceGatheringState,")"))},this.peerConnection.onicecandidate=t=>{t.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,S.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,S.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},L("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){const n={iceServers:[]},i=t.cloudProxyServer||"disabled";return t.iceServers?n.iceServers=t.iceServers:t.turnServer&&(yd(t.turnServer.servers)?n.iceServers=t.turnServer.servers:L("NEW_TURN_MODE")&&n.iceServers&&i==="disabled"?(L("USE_TURN_SERVER_OF_GATEWAY")?t.turnServer.serversFromGateway&&n.iceServers.push(...fu.newTurnServerConfigToIceServers(t.turnServer.serversFromGateway)):n.iceServers.push(...fu.newTurnServerConfigToIceServers(t.turnServer.servers)),L("NEW_FORCE_TURN")&&(n.iceTransportPolicy="relay")):t.turnServer.mode!=="off"&&(n.iceServers&&n.iceServers.push(...fu.turnServerConfigToIceServers(t.turnServer.servers)),L("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&t.turnServer.serversFromGateway&&n.iceServers.push(...fu.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),L("FORCE_TURN_TCP")?n.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(o=>{o.forceturn&&(n.iceTransportPolicy="relay")}))),L("ENABLE_ENCODED_TRANSFORM")&&wt().supportWebRTCEncodedTransform&&(n.encodedInsertableStreams=!0),n}static turnServerConfigToIceServers(t){const n=[];return t.forEach(i=>{i.security?i.tcpport&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turns:".concat(to(i.turnServerURL),":").concat(i.tcpport,"?transport=tcp")}):(i.udpport&&!L("FORCE_TURN_TCP")&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.udpport,"?transport=udp")}),i.tcpport&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.tcpport,"?transport=tcp")}))}),n}static newTurnServerConfigToIceServers(t){const n=[];return t.forEach(i=>{const o=L("NEW_TURN_MODE");o===1?n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":3478?transport=udp")}):o===2?n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":3478?transport=tcp")}):o===3?n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turns:".concat(to(i.turnServerURL),":443?transport=tcp")}):o===4&&(n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":3478?transport=udp")}),n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":3478?transport=tcp")}),n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turns:".concat(to(i.turnServerURL),":443?transport=tcp")}))}),n}tryBindTransportEvents(t){const n=t.transport;if(n){this.transportEventReceiver=t,n.onstatechange=()=>{var o;n!=null&&n.state&&((o=this.onDTLSTransportStateChange)===null||o===void 0||o.call(this,n.state))},n.onerror=o=>{var l;(l=this.onDTLSTransportError)===null||l===void 0||l.call(this,"error"in o?o.error:o)};const i=n.iceTransport;i&&(i.onstatechange=()=>{const o=n==null?void 0:n.iceTransport.state;var l;o&&((l=this.onICETransportStateChange)===null||l===void 0||l.call(this,o))},i.getSelectedCandidatePair&&(i.onselectedcandidatepairchange=()=>{if(i.getSelectedCandidatePair()){const{local:o,remote:l}=i.getSelectedCandidatePair()||{};if(o&&l){const d=o.address+":"+o.port,h=l.address+":"+l.port;S.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify(gc(d)),", remote ").concat(JSON.stringify(gc(h))))}}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(t,n){var i,o;if(n||(n=this.peerConnection.getSenders().find(O=>O.track===t._mediaStreamTrack)),!n)return S.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(t))return S.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!wt().supportSetRtpSenderParameters)return S.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const l={},d={};switch(t._optimizationMode){case"motion":l.degradationPreference="maintain-framerate";break;case"detail":l.degradationPreference="maintain-resolution";break;case"balanced":l.degradationPreference="balanced"}const h=lV(this.peerConnection,t._mediaStreamTrack),f=$F(t);if(XV(t)&&h&&n&&f&&this.getLocalVideoStats&&me(i=["vp8","vp9"]).call(i,this.store.codec)){var g;const I=l.degradationPreference||(me(g=t._hints).call(g,Wt.CUSTOM_TRACK)?L("CUSTOM_ADAPTATION_DEFAULT_MODE"):"maintain-framerate");JV(this.id+h.mid,f,this,I,O=>{n&&this.updateAdaptation(n,O)},this.getLocalVideoStats.bind(this))}if(t._encoderConfig){var _;const{bitrateMax:I,frameRate:O,scaleResolutionDownBy:U}=t._encoderConfig;I&&(d.maxBitrate=1e3*I),(me(_=t._hints).call(_,Wt.LOW_STREAM)||t.isUseScaleResolutionDownBy)&&(O&&(d.maxFramerate=ei(O)),U&&U>=1&&(d.scaleResolutionDownBy=U))}const{maxFramerate:v}=L("ENCODER_CONFIG_LIMIT");if(v&&typeof v=="number"&&(d.maxFramerate=d.maxFramerate?Math.min(d.maxFramerate,v):v),L("DSCP_TYPE")&&uc()){var y;const I=L("DSCP_TYPE");me(y=["very-low","low","medium","high"]).call(y,I)&&(d.networkPriority=I)}const b=n.getParameters(),D=(o=b.encodings)===null||o===void 0?void 0:o[0];gn()&&!D&&(l.encodings=[d]),D&&Object.assign(D,d),Object.assign(b,l),S.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(b.encodings))),await n.setParameters(b),await wV(this.store.codec,n,L("SVC_MODE"))}async updateAdaptation(t,n){var i,o;if(!t)return S.debug("[updateAdaptation] no rtpSender found");if(!wt().supportSetRtpSenderParameters)return S.debug("[updateAdaptation] Browser not support set rtp-sender parameters");const l={},{bitrateMax:d,frameRate:h,scaleResolutionDownBy:f}=n;d&&(l.maxBitrate=1e3*d),h&&(l.maxFramerate=ei(h)),f&&f>=1&&me(i=["vp8","vp9"]).call(i,this.store.codec)&&(l.scaleResolutionDownBy=f);const g=t.getParameters(),_=(o=g.encodings)===null||o===void 0?void 0:o[0];_&&Object.assign(_,l),Object.assign(g,{});try{await t.setParameters(g),S.debug("[updateAdaptation] updateRtpSenderEncodings: ".concat(JSON.stringify(g.encodings)))}catch(v){!("transport"in t)||t.transport&&t.transport.state==="connected"?this.peerConnectionState!=="connected"?S.debug("[updateAdaptation] peerConnection not connected}"):S.debug("[updateAdaptation] updateRtpSenderEncodings failed",v):S.debug("[updateAdaptation] rtpSender transport not connected}")}}async applySendEncodings(t,n){try{if(!wt().supportSetRtpSenderParameters||t.length!==n.length)return;for(let i=0;i<t.length;i++){const o=t[i],l=n[i];l instanceof on&&!this.isVP8Simulcast(l)&&await this.updateRtpSenderEncodings(l,o.sender)}}catch{S.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,n,i){const o=Ps(t);return n.forEach((l,d)=>{const h=i[d],f=o.mediaDescriptions.find(g=>g.attributes.mid===h);f&&(Fd(f,l),eI(f,l,this.store.codec))}),Yc(o)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var n;(n=this.onFirstAudioReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var n;(n=this.onFirstVideoReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var n;(n=this.onFirstAudioDecoded)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,n,i)=>{var o;(o=this.onFirstVideoDecoded)===null||o===void 0||o.call(this,t,n,i)},this.statsFilter.onSelectedLocalCandidateChanged=(t,n)=>{var i;(i=this.onSelectedLocalCandidateChanged)===null||i===void 0||i.call(this,t,n)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,n)=>{var i;(i=this.onSelectedRemoteCandidateChanged)===null||i===void 0||i.call(this,t,n)},this.statsFilter.onFirstVideoDecodedTimeout=t=>{var n;(n=this.onFirstVideoDecodedTimeout)===null||n===void 0||n.call(this,t)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(t,n){if(t.length===n.length)for(let f=0;f<t.length;f++){var i,o,l,d,h;const g=t[f],_=n[f];if(_ instanceof on&&!me(i=_._hints).call(i,Wt.LOW_STREAM)&&(o=_._encoderConfig)!==null&&o!==void 0&&o.bitrateMax&&((l=_._encoderConfig)===null||l===void 0?void 0:l.bitrateMax)>200&&(d=_._scalabilityMode)!==null&&d!==void 0&&d.numSpatialLayers&&((h=_._scalabilityMode)===null||h===void 0?void 0:h.numSpatialLayers)>1&&this.store.codec==="vp8"){const v={},y={high:1e3*(_._encoderConfig.bitrateMax-50),medium:5e4};v.encodings=[{rid:"m",active:!0,maxBitrate:y.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:y.high}];const b=g.sender.getParameters();await g.sender.setParameters(Object.assign(b,v))}}}async applySimulcastEncodings(t,n){if(!gn()&&t.length===n.length)for(let i=0;i<t.length;i++){const o=n[i];if(o instanceof on&&this.isVP8Simulcast(o)){const l=t[i],d={},h={high:1e3*(o._encoderConfig.bitrateMax-50),medium:5e4};d.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:h.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:h.medium,scaleResolutionDownBy:4}];const f=l.sender.getParameters();await l.sender.setParameters(Object.assign(f,d))}}}isVP8Simulcast(t){var n,i,o,l,d;return!!(t instanceof on&&L("SIMULCAST")&&this.store.codec==="vp8"&&!me(n=t._hints).call(n,Wt.LOW_STREAM)&&(i=t._encoderConfig)!==null&&i!==void 0&&i.bitrateMax&&((o=t._encoderConfig)===null||o===void 0?void 0:o.bitrateMax)>200&&(l=t._scalabilityMode)!==null&&l!==void 0&&l.numSpatialLayers&&((d=t._scalabilityMode)===null||d===void 0?void 0:d.numSpatialLayers)>1)}logSDPExchange(t,n,i,o){if(L("SDP_LOGGING"))return S.upload("[".concat(this.store.clientId,"] exchanging ").concat(i," ").concat(n," SDP during P2PConnection.").concat(o,`
`),t),n==="offer"?l=>{this.logSDPExchange(l,"answer",i==="local"?"remote":"local",o)}:void 0}async getRemoteSSRC(t){if(!this.remoteSDP)return;const n=this.remoteSDP.getSSRC(t);return n&&n.length!==0?n[0].ssrcId:void 0}setConfiguration(t){if(wt().supportPCSetConfiguration){const n=fu.resolvePCConfiguration(t);this.peerConnection.setConfiguration(n)}t.isPreallocation&&(this.isPreallocation=!0)}},Ce(Dt.prototype,"updateRemoteRTPCapabilities",[ti],Object.getOwnPropertyDescriptor(Dt.prototype,"updateRemoteRTPCapabilities"),Dt.prototype),Ce(Dt.prototype,"connect",[ti],Object.getOwnPropertyDescriptor(Dt.prototype,"connect"),Dt.prototype),Ce(Dt.prototype,"updateRemoteConnect",[ti],Object.getOwnPropertyDescriptor(Dt.prototype,"updateRemoteConnect"),Dt.prototype),Ce(Dt.prototype,"createDataChannels",[ti],Object.getOwnPropertyDescriptor(Dt.prototype,"createDataChannels"),Dt.prototype),Ce(Dt.prototype,"receive",[ti],Object.getOwnPropertyDescriptor(Dt.prototype,"receive"),Dt.prototype),Ce(Dt.prototype,"batchReceive",[ti],Object.getOwnPropertyDescriptor(Dt.prototype,"batchReceive"),Dt.prototype),Ce(Dt.prototype,"stopReceiving",[ti],Object.getOwnPropertyDescriptor(Dt.prototype,"stopReceiving"),Dt.prototype),Ce(Dt.prototype,"muteRemote",[ti],Object.getOwnPropertyDescriptor(Dt.prototype,"muteRemote"),Dt.prototype),Ce(Dt.prototype,"unmuteRemote",[ti],Object.getOwnPropertyDescriptor(Dt.prototype,"unmuteRemote"),Dt.prototype),Ce(Dt.prototype,"muteLocal",[ti],Object.getOwnPropertyDescriptor(Dt.prototype,"muteLocal"),Dt.prototype),Ce(Dt.prototype,"unmuteLocal",[ti],Object.getOwnPropertyDescriptor(Dt.prototype,"unmuteLocal"),Dt.prototype),Ce(Dt.prototype,"close",[ti],Object.getOwnPropertyDescriptor(Dt.prototype,"close"),Dt.prototype),Ce(Dt.prototype,"updateEncoderConfig",[ti],Object.getOwnPropertyDescriptor(Dt.prototype,"updateEncoderConfig"),Dt.prototype),Ce(Dt.prototype,"updateSendParameters",[ti],Object.getOwnPropertyDescriptor(Dt.prototype,"updateSendParameters"),Dt.prototype),Ce(Dt.prototype,"replaceTrack",[ti],Object.getOwnPropertyDescriptor(Dt.prototype,"replaceTrack"),Dt.prototype),Ce(Dt.prototype,"updateAdaptation",[ti],Object.getOwnPropertyDescriptor(Dt.prototype,"updateAdaptation"),Dt.prototype),Ce(Dt.prototype,"getRemoteSSRC",[ti],Object.getOwnPropertyDescriptor(Dt.prototype,"getRemoteSSRC"),Dt.prototype),Dt);function ti(e,t,n){const i=e[t];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const o=this.mutex,l=await o.lock("From P2PConnection.".concat(t));try{for(var d=arguments.length,h=new Array(d),f=0;f<d;f++)h[f]=arguments[f];return await i.apply(this,h)}finally{l()}},n}function vI(e,t){let n=document.createElement("video"),i=document.createElement("canvas");n.setAttribute("style","display:none"),i.setAttribute("style","display:none"),n.setAttribute("muted",""),n.muted=!0,n.setAttribute("autoplay",""),n.autoplay=!0,n.setAttribute("playsinline",""),i.width=ei(t.width),i.height=ei(t.height);const o=ei(t.framerate||15);document.body.append(n),document.body.append(i);let l=e._mediaStreamTrack;n.srcObject=new MediaStream([l]),n.play().catch(vm);const d=i.getContext("2d");if(!d)throw new se(P.UNEXPECTED_ERROR,"can not get canvas context");const h=wt(),f=i.captureStream(h.supportRequestFrame?0:o).getVideoTracks()[0];f.canvas||(f.canvas=i),i.startCapture=()=>{if(!n)return i.stopCapture&&i.stopCapture();if(n.paused&&n.play(),n.videoHeight>2&&n.videoWidth>2){const _=n.videoWidth,v=n.videoHeight/_,y=i.width*v;Math.abs(y-i.height)>=2&&(S.debug("adjust low stream resolution","".concat(i.width,"x").concat(i.height," -> ").concat(i.width,"x").concat(y)),i.height=y)}d.drawImage(n,0,0,i.width,i.height),f.requestFrame&&f.requestFrame(),l!==e._mediaStreamTrack&&(l=e._mediaStreamTrack,n.srcObject=new MediaStream([l]))},i.stopCapture=vR(()=>i.startCapture&&i.startCapture(),o);const g=f.stop;return f.stop=()=>{g.call(f),n&&(n.remove(),n.srcObject=null,n=null),i&&(i.width=0,i.remove(),i.stopCapture&&i.stopCapture(),i.startCapture=void 0,i.stopCapture=void 0,i=null),S.debug("clean low stream renderer")},f}var ZV=function(e){return e[e.Video_Send_Type=190]="Video_Send_Type",e}(ZV||{}),jo=function(e){return e[e.Video_Send_Qp_Sum=2143]="Video_Send_Qp_Sum",e[e.Video_Send_Freeze=2082]="Video_Send_Freeze",e[e.Video_Recv_Qp_Sum=2144]="Video_Recv_Qp_Sum",e[e.Video_Recv_Freeze=2084]="Video_Recv_Freeze",e[e.Video_Render_Freeze_Time=2109]="Video_Render_Freeze_Time",e[e.Video_Render_Freeze_Time_Render=2147]="Video_Render_Freeze_Time_Render",e[e.Video_Render_Freeze_Time_Render2=2223]="Video_Render_Freeze_Time_Render2",e[e.Audio_Recv_Freeze=2083]="Audio_Recv_Freeze",e}(jo||{}),ot=function(e){return e[e.Video_Send_Retransmit=2062]="Video_Send_Retransmit",e[e.Video_Send_Target_Encoded=2064]="Video_Send_Target_Encoded",e[e.Video_Send_Actual_Encoded=2060]="Video_Send_Actual_Encoded",e[e.Video_Send_Transmit=2066]="Video_Send_Transmit",e[e.Video_Send_Bandwidth=2061]="Video_Send_Bandwidth",e[e.Video_Capture_Height=2033]="Video_Capture_Height",e[e.Video_Capture_Width=2035]="Video_Capture_Width",e[e.Video_Capture_Frame_Rate=2034]="Video_Capture_Frame_Rate",e[e.Video_Send_Low_Height=2073]="Video_Send_Low_Height",e[e.Video_Send_Low_Frame_Rate=2075]="Video_Send_Low_Frame_Rate",e[e.Video_Send_Low_Width=2077]="Video_Send_Low_Width",e[e.Video_Send_Low_Bitrate=2069]="Video_Send_Low_Bitrate",e[e.Video_Send_Low_Package_Lost=2070]="Video_Send_Low_Package_Lost",e[e.Video_Send_Low_Package_Rate=2071]="Video_Send_Low_Package_Rate",e[e.Video_Send_Frame_Rate=2002]="Video_Send_Frame_Rate",e[e.Video_Send_Width=2003]="Video_Send_Width",e[e.Video_Send_Height=2004]="Video_Send_Height",e[e.Video_Send_Disabled=2095]="Video_Send_Disabled",e[e.Video_Send_Adaptation=2032]="Video_Send_Adaptation",e[e.Video_Send_Player_Status=2128]="Video_Send_Player_Status",e[e.Video_Send_Nacks=2009]="Video_Send_Nacks",e[e.Video_Send_Plis=2010]="Video_Send_Plis",e[e.Video_Send_Firs=2011]="Video_Send_Firs",e[e.Video_Send_Avg_Encode=2007]="Video_Send_Avg_Encode",e[e.Video_Send_Huge_Frame_Sent=2174]="Video_Send_Huge_Frame_Sent",e[e.Video_Send_Bytes_Retransmit=2173]="Video_Send_Bytes_Retransmit",e[e.Video_Send_Packages_Retransmit=2172]="Video_Send_Packages_Retransmit",e[e.Video_Send_Key_Frames_Encoded=2207]="Video_Send_Key_Frames_Encoded",e[e.Video_Send_Bitrate=2012]="Video_Send_Bitrate",e[e.Video_Send_Package_Rate=2031]="Video_Send_Package_Rate",e[e.Video_Send_Package_Lost=2005]="Video_Send_Package_Lost",e[e.Audio_Capture_PCM_Level=2104]="Audio_Capture_PCM_Level",e[e.Audio_Send_Level=2038]="Audio_Send_Level",e[e.Audio_Send_Bitrate=2039]="Audio_Send_Bitrate",e[e.Audio_Send_Package_Rate=2040]="Audio_Send_Package_Rate",e[e.Audio_Send_AEC_Return_Loss=2041]="Audio_Send_AEC_Return_Loss",e[e.Audio_Send_AEC_Return_Loss_Enhancement=2042]="Audio_Send_AEC_Return_Loss_Enhancement",e[e.Audio_Send_Freeze=2081]="Audio_Send_Freeze",e[e.Audio_Send_Disabled=2096]="Audio_Send_Disabled",e[e.Audio_Send_Bytes_Retransmit=2179]="Audio_Send_Bytes_Retransmit",e[e.Audio_Send_Packages_Retransmit=2180]="Audio_Send_Packages_Retransmit",e[e.Video_Recv_Height=2019]="Video_Recv_Height",e[e.Video_Recv_Width=2018]="Video_Recv_Width",e[e.Video_Recv_Frame_Rate_Output=2155]="Video_Recv_Frame_Rate_Output",e[e.Video_Recv_Jitter_Buffer=2023]="Video_Recv_Jitter_Buffer",e[e.Video_Recv_Current_Delay=2024]="Video_Recv_Current_Delay",e[e.Video_Recv_Nacks=2026]="Video_Recv_Nacks",e[e.Video_Recv_Plis=2027]="Video_Recv_Plis",e[e.Video_Recv_Firs=2028]="Video_Recv_Firs",e[e.Video_Recv_Disabled=2101]="Video_Recv_Disabled",e[e.Video_Recv_Player_Status=2129]="Video_Recv_Player_Status",e[e.Video_Recv_I_Frame_Delay=2149]="Video_Recv_I_Frame_Delay",e[e.Video_Render_Frame_Rate_Render=2022]="Video_Render_Frame_Rate_Render",e[e.Video_Render_Freeze_Duration=2156]="Video_Render_Freeze_Duration",e[e.Audio_Render_Level=2043]="Audio_Render_Level",e[e.Audio_Render_Freeze_Time_80ms=2226]="Audio_Render_Freeze_Time_80ms",e[e.Audio_Render_Freeze_Time_200ms=2227]="Audio_Render_Freeze_Time_200ms",e[e.Audio_Render_Freeze_Samples_80ms=2228]="Audio_Render_Freeze_Samples_80ms",e[e.Audio_Render_Freeze_Samples_200ms=2229]="Audio_Render_Freeze_Samples_200ms",e[e.Audio_Recv_PCM_Level=2105]="Audio_Recv_PCM_Level",e[e.Audio_Recv_Disabled=2102]="Audio_Recv_Disabled",e[e.Audio_Recv_Jitter_Buffer=2054]="Audio_Recv_Jitter_Buffer",e[e.Audio_Recv_Current_Delay=2047]="Audio_Recv_Current_Delay",e[e.Audio_Recv_Player_Status=2130]="Audio_Recv_Player_Status",e[e.Audio_Recv_Bitrate=2044]="Audio_Recv_Bitrate",e[e.Audio_Recv_Concealed_Samples=2148]="Audio_Recv_Concealed_Samples",e[e.Audio_Recv_Total_Samples_Received=2224]="Audio_Recv_Total_Samples_Received",e}(ot||{}),Rr=function(e){return e[e.Video_Render_Frame_Rate_Decode=2021]="Video_Render_Frame_Rate_Decode",e[e.Video_Recv_Frame_Rate=2020]="Video_Recv_Frame_Rate",e[e.Video_Recv_Frame_Dropped=2181]="Video_Recv_Frame_Dropped",e[e.Video_Recv_Bytes_Retransmit=2175]="Video_Recv_Bytes_Retransmit",e[e.Video_Recv_Packages_Retransmit=2176]="Video_Recv_Packages_Retransmit",e[e.Video_Recv_Packages_Discarded=2198]="Video_Recv_Packages_Discarded",e[e.Video_Recv_Avg_Decode=2200]="Video_Recv_Avg_Decode",e[e.Video_Recv_Avg_Processing_Delay=2202]="Video_Recv_Avg_Processing_Delay",e[e.Video_Recv_Avg_Assembly_Time=2203]="Video_Recv_Avg_Assembly_Time",e[e.Video_Recv_Avg_Inter_Frame_Delay=2204]="Video_Recv_Avg_Inter_Frame_Delay",e[e.Video_Recv_Key_Frames_Decoded=2206]="Video_Recv_Key_Frames_Decoded",e[e.Video_Recv_Package_Lost=2014]="Video_Recv_Package_Lost",e[e.Video_Recv_Bitrate=2029]="Video_Recv_Bitrate",e[e.Video_Recv_Package_Rate=2078]="Video_Recv_Package_Rate",e[e.Audio_Recv_Jitter=2055]="Audio_Recv_Jitter",e[e.Audio_Recv_Bytes_Retransmit=2178]="Audio_Recv_Bytes_Retransmit",e[e.Audio_Recv_Packages_Retransmit=2177]="Audio_Recv_Packages_Retransmit",e[e.Audio_Recv_Packages_Discarded=2199]="Audio_Recv_Packages_Discarded",e[e.Audio_Recv_Avg_Processing_Delay=2201]="Audio_Recv_Avg_Processing_Delay",e[e.Audio_Recv_Package_Rate=2046]="Audio_Recv_Package_Rate",e[e.Audio_Recv_Package_Lost=2045]="Audio_Recv_Package_Lost",e[e.Audio_Recv_AV_Sync_TIME=2237]="Audio_Recv_AV_Sync_TIME",e}(Rr||{}),Yr=function(e){return e[e.RTT=2006]="RTT",e[e.CONN_TYPE=801]="CONN_TYPE",e[e.STATS_UPDATE_INTERVAL=2205]="STATS_UPDATE_INTERVAL",e}(Yr||{}),Zh=function(e){return e[e.RTC_PEER_CONNECTION_STATE=2219]="RTC_PEER_CONNECTION_STATE",e[e.PAGE_VISIBILITY=2233]="PAGE_VISIBILITY",e}(Zh||{}),yI=function(e){return e[e.Transport_Send_Bitrate=2234]="Transport_Send_Bitrate",e[e.Transport_Recv_Bitrate=2235]="Transport_Recv_Bitrate",e}(yI||{});const Vd=1e3,f0=6,Fm=3,gAe=Math.max(f0,Fm,60);function ze(e,t,n){n!=null&&Number.isFinite(n)&&(e[t]=Math.round(Math.max(0,n)))}function eQ(e){const t={[Yr.CONN_TYPE]:0,[Yr.RTT]:e.rtt,[Yr.STATS_UPDATE_INTERVAL]:e.updateInterval?Math.round(Math.max(0,e.updateInterval)):void 0};switch(e.selectedCandidatePair.localCandidate.candidateType){case"relay":{const n=e.selectedCandidatePair.localCandidate.relayProtocol;n==="udp"&&(t[Yr.CONN_TYPE]=1),n==="tcp"&&(t[Yr.CONN_TYPE]=3),n==="tls"&&(t[Yr.CONN_TYPE]=4);break}case"srflx":t[Yr.CONN_TYPE]=2;break;case"unknown":t[Yr.CONN_TYPE]=5;break;default:t[Yr.CONN_TYPE]=0}return t}function tQ(e){let t=0;switch(e){case"none":t=0;break;case"cpu":t=1;break;case"bandwidth":t=2;break;case"other":t=3}return t}class nQ extends Tn{constructor(t){super(),x(this,"store",void 0),x(this,"uploadWRTCStatsTimer",void 0),x(this,"uploadOutboundDenoiserStatsTimer",void 0),x(this,"uploadExtStatsTimer",void 0),x(this,"uploadExtUsageStatsTimer",void 0),x(this,"uploadInboundExtStatsTimer",void 0),x(this,"requestStats",void 0),x(this,"requestTransportStats",void 0),x(this,"requestLocalMedia",void 0),x(this,"requestRemoteMedia",void 0),x(this,"requestAllTracks",void 0),x(this,"requestVideoIsReady",void 0),x(this,"requestUploadStats",void 0),x(this,"requestUpload",void 0),x(this,"uploadOutboundStarted",!1),x(this,"uploadInboundStarted",!1),x(this,"uploadTransportStarted",!1),x(this,"uploadBaseStatsStarted",!1),x(this,"uploadExtensionUsageStarted",!1),x(this,"lastRecvStats",void 0),x(this,"lastSendStats",void 0),x(this,"lastRefRecvStats",void 0),x(this,"lastRefSendStats",void 0),x(this,"lastNormalRecvStats",void 0),x(this,"lastNormalSendStats",void 0),x(this,"lastExtendStats",{}),x(this,"needUploadStats",{}),x(this,"needUploadRenderFreezeTime",!0),x(this,"lastUploadCompensateTime",-1),x(this,"uploadCompensateDeltaTime",0),this.store=t}uploadWRTCStats(t){if(!this.requestStats||!this.requestUploadStats)return;const n=t%Fm==0,i=t%f0==0,o=t%60==0;let l,d;if(this.uploadTransportStarted&&(l=this.requestStats(),this.store.useP2P&&(d=this.requestStats(!0))),!l&&this.uploadOutboundStarted&&(l=this.requestStats()),!d&&this.uploadInboundStarted&&(d=this.requestStats(!0)),l||d){var h;const f={};if(this.uploadTransportStarted&&l){const _=this.getTransportStats(l,n?this.lastRefSendStats:void 0,d,n);_&&(f.misc=[_])}if(this.uploadOutboundStarted&&l){const _=this.getOutboundStats(l,i?this.lastNormalSendStats:void 0,n?this.lastRefSendStats:void 0,this.lastSendStats,o);_&&(f.outbound=[_])}if(this.uploadInboundStarted&&d){this.uploadCompensateStats(t);const _=this.getInboundStats(d,i?this.lastNormalRecvStats:void 0,n?this.lastRefRecvStats:void 0,this.lastRecvStats);_&&(f.inbound=_)}const g=(h=this.requestTransportStats)===null||h===void 0?void 0:h.call(this).connectState;if(g&&(Array.isArray(f.misc)?f.misc[0]&&f.misc[0].addition&&(f.misc[0].addition[Zh.RTC_PEER_CONNECTION_STATE]=sR[g]):f.misc=[{addition:{[Zh.RTC_PEER_CONNECTION_STATE]:sR[g]}}]),Oi.needUploadStats.length>0||i){const _=Oi.needUploadStats.shift()||(Oi.visibility==="visible"?1:0);Array.isArray(f.misc)?f.misc[0]&&f.misc[0].addition&&(f.misc[0].addition[Zh.PAGE_VISIBILITY]=_):f.misc=[{addition:{[Zh.PAGE_VISIBILITY]:_}}]}this.needUploadStats.sendType&&(Array.isArray(f.outbound)&&f.outbound[0]&&f.outbound[0].high&&(f.outbound[0].high[ZV.Video_Send_Type]=this.needUploadStats.sendType),this.needUploadStats.sendType=void 0),this.requestUploadStats(f)}this.lastRecvStats=d,this.lastSendStats=l,i&&(this.lastNormalRecvStats=d,this.lastNormalSendStats=l),n&&(this.lastRefRecvStats=d,this.lastRefSendStats=l)}startUploadWRTCStats(){if(this.uploadWRTCStatsTimer)return;this.uploadBaseStatsStarted=!0,Oi.startCollectStats();let t=1;this.uploadWRTCStatsTimer=window.setInterval(()=>{if(!this.uploadTransportStarted&&!this.uploadInboundStarted&&!this.uploadOutboundStarted){if(this.uploadBaseStatsStarted){var n,i;const o=(n=this.requestTransportStats)===null||n===void 0?void 0:n.call(this);return void(o&&((i=this.requestUploadStats)===null||i===void 0||i.call(this,{misc:[{addition:{[Zh.RTC_PEER_CONNECTION_STATE]:sR[o.connectState]}}]})))}return this.stopUploadWRTCStats()}this.uploadWRTCStats(t),++t===gAe+1&&(t=1)},Vd)}uploadCompensateStats(t){if(!this.requestStats||!this.requestUploadStats||!this.requestRemoteMedia)return;const n=t%Fm==0&&this.needUploadRenderFreezeTime;if(!this.uploadInboundStarted||!n)return;if(this.lastUploadCompensateTime===-1)return void(this.lastUploadCompensateTime=Date.now());const i=Math.max(-6e3,Date.now()-this.lastUploadCompensateTime-6e3);if(this.uploadCompensateDeltaTime+=i,this.lastUploadCompensateTime=Date.now(),this.uploadCompensateDeltaTime<6e3)return;const o=Math.min(Math.floor(this.uploadCompensateDeltaTime/6e3),10);this.uploadCompensateDeltaTime-=6e3*o;const l=this.requestStats(!0);new Array(o).fill(0).forEach(()=>{if(!this.requestStats||!this.requestUploadStats||!this.requestRemoteMedia)return;const d={};if(this.uploadInboundStarted&&l){const h=this.requestRemoteMedia()||[],f=[];h.forEach(g=>{let[_,v]=g;const y={peer:_.uid};if(_._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(_._videoSSRC)&&v.has(xe.VIDEO)&&_.videoTrack){const b=function(D,I,O){if(!I.videoRecv.find(j=>j.ssrc===D))return;const U={};if(O&&O._player){const j=O._player,{renderFreezeAccTime2:G,videoElementStatus:$}=j;if(Oi.visibility==="visible"&&$===is.PLAYING&&wt().supportRequestVideoFrameCallback){const Z=Math.min(6e3,G);j.renderFreezeAccTime2=Math.max(0,G-Z),ze(U,jo.Video_Render_Freeze_Time_Render2,Z),L("USE_NEW_RENDER_FREEZE_TIME")&&ze(U,jo.Video_Render_Freeze_Time_Render,Z)}}return U}(_._videoSSRC,l,_.videoTrack);b&&(y.video=b)}y.video&&f.push(y)}),f.length>0&&(d.inbound=f,this.requestUploadStats(d))}})}stopUploadWRTCStats(){window.clearInterval(this.uploadWRTCStatsTimer),this.uploadWRTCStatsTimer=void 0,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0),this.lastRefSendStats&&(this.lastRefSendStats.videoSend=[],this.lastRefSendStats.audioSend=[],this.lastRefSendStats=void 0),this.lastRefRecvStats&&(this.lastRefRecvStats.videoRecv=[],this.lastRefRecvStats.audioRecv=[],this.lastRefRecvStats=void 0),this.lastNormalSendStats&&(this.lastNormalSendStats.videoSend=[],this.lastNormalSendStats.audioSend=[],this.lastNormalSendStats=void 0),this.lastNormalRecvStats&&(this.lastNormalRecvStats.videoRecv=[],this.lastNormalRecvStats.audioRecv=[],this.lastNormalRecvStats=void 0),this.lastExtendStats={},this.needUploadStats={},this.lastUploadCompensateTime=-1,this.uploadCompensateDeltaTime=0,this.needUploadRenderFreezeTime=!0}getTransportStats(t,n,i,o){if(!this.requestStats)return;if(!o)return t.rtt==null?void 0:{addition:{[Yr.RTT]:t.rtt,[Yr.CONN_TYPE]:void 0,[Yr.STATS_UPDATE_INTERVAL]:t.updateInterval||void 0}};const l=eQ(t);if(this.store.useP2P){if(i){const d=eQ(i);l[Yr.CONN_TYPE]&&d[Yr.CONN_TYPE]&&(l[Yr.CONN_TYPE]+=d[Yr.CONN_TYPE]<<3)}l[Yr.CONN_TYPE]?l[Yr.CONN_TYPE]+=110:l[Yr.CONN_TYPE]=110}else{l[Yr.CONN_TYPE]?l[Yr.CONN_TYPE]+=100:l[Yr.CONN_TYPE]=100;const d=function(h,f){return f?[Math.ceil(8*(h.transport.bytesSent-f.transport.bytesSent)/(h.timestamp-f.timestamp)),Math.ceil(8*(h.transport.bytesReceived-f.transport.bytesReceived)/(h.timestamp-f.timestamp))]:[0,0]}(t,n);l[yI.Transport_Send_Bitrate]=d[0],l[yI.Transport_Recv_Bitrate]=d[1]}return{addition:l}}getOutboundStats(t,n,i,o,l){if(!this.requestUploadStats||!this.requestLocalMedia)return;const d=this.requestLocalMedia();if(!d||d.length===0)return;let h,f,g;return d.forEach(_=>{let[v,{track:y,ssrcs:b}]=_;switch(v){case ge.LocalVideoLowTrack:case ge.LocalVideoTrack:if(v===ge.LocalVideoTrack){var D;const I=function(G,$,Z,X,ee,le){const fe=$.videoSend.find(pt=>pt.ssrc===G);if(!fe)return;const Ie={},{sentFrame:et,inputFrame:Je}=fe;if(X&&(ze(Ie,jo.Video_Send_Qp_Sum,fe.qpSumPerFrame),Je&&et)){const pt=Je.frameRate,ct=et.frameRate;Ie[jo.Video_Send_Freeze]=function(jt,bn){let he=!0;return he=!(jt<=5)&&(jt<=10?bn<3:jt<=20?bn<4:bn<5),he}(pt,ct)?1:0}if(ee){switch(et&&(ze(Ie,ot.Video_Send_Height,et.height),ze(Ie,ot.Video_Send_Width,et.width),ze(Ie,ot.Video_Send_Frame_Rate,et.frameRate)),Ie[ot.Video_Send_Disabled]=Z._originMediaStreamTrack&&!Z._originMediaStreamTrack.enabled||Z._mediaStreamTrack&&!Z._mediaStreamTrack.enabled?1:0,fe.adaptionChangeReason){case"none":Ie[ot.Video_Send_Adaptation]=0;break;case"cpu":Ie[ot.Video_Send_Adaptation]=1;break;case"bandwidth":Ie[ot.Video_Send_Adaptation]=2;break;case"other":Ie[ot.Video_Send_Adaptation]=3}let pt=0;fe.adaptionChangeReason&&(pt+=tQ(fe.adaptionChangeReason)),$.qualityLimitationReason&&(pt+=tQ($.qualityLimitationReason)<<3),Ie[ot.Video_Send_Adaptation]=pt,Ie[ot.Video_Send_Player_Status]=gR[Z._player?Z._player.videoElementStatus:"uninit"],ze(Ie,ot.Video_Send_Nacks,fe.nacksCount),ze(Ie,ot.Video_Send_Plis,fe.plisCount),ze(Ie,ot.Video_Send_Firs,fe.firsCount),ze(Ie,ot.Video_Send_Avg_Encode,fe.avgEncodeMs),ze(Ie,ot.Video_Send_Huge_Frame_Sent,fe.hugeFramesSent),ze(Ie,ot.Video_Send_Bytes_Retransmit,fe.retransmittedBytesSent),ze(Ie,ot.Video_Send_Packages_Retransmit,fe.retransmittedPacketsSent),ze(Ie,ot.Video_Send_Key_Frames_Encoded,fe.keyFramesEncoded);const ct=ee.videoSend.find(jt=>jt.ssrc===G);if(ct){let jt=Vd*Fm;ct.timestamp&&fe.timestamp&&(jt=fe.timestamp-ct.timestamp),ct.packets!=null&&fe.packets!=null&&ze(Ie,ot.Video_Send_Package_Rate,1e3*(fe.packets-ct.packets)/jt),fe.packetsLost!=null&&ct.packetsLost!=null&&ze(Ie,ot.Video_Send_Package_Lost,fe.packetsLost-ct.packetsLost),ct.bytes!=null&&fe.bytes!=null&&ze(Ie,ot.Video_Send_Bitrate,8*(fe.bytes-ct.bytes)/jt)}}return Ie}(b[0].ssrcId,t,y,n,i),O=y.__className__==="CameraVideoTrack"?3:me(D=y._hints).call(D,Wt.SCREEN_TRACK)?7:10;(this.lastExtendStats.sendType!==O||l)&&(this.needUploadStats={sendType:O},this.lastExtendStats.sendType=O);const U=y&&function(G,$,Z,X){const ee=$.videoSend.find(fe=>fe.ssrc===G);if(!ee)return null;const le={};if(X){const fe=ee.inputFrame,Ie=fe&&fe.height||Z.videoHeight||0,et=fe&&fe.width||Z.videoWidth||0,Je=fe&&fe.frameRate||0;ze(le,ot.Video_Capture_Height,Ie),ze(le,ot.Video_Capture_Width,et),ze(le,ot.Video_Capture_Frame_Rate,Je)}return le}(b[0].ssrcId,t,y,!!i),j=function(G,$){const Z={};return $&&(ze(Z,ot.Video_Send_Retransmit,G.bitrate.retransmit),ze(Z,ot.Video_Send_Target_Encoded,G.bitrate.targetEncoded),ze(Z,ot.Video_Send_Actual_Encoded,G.bitrate.actualEncoded),ze(Z,ot.Video_Send_Transmit,G.bitrate.transmit),ze(Z,ot.Video_Send_Bandwidth,G.sendBandwidth)),Z}(t,!!i);f=Object.assign({},I,U,j)}else g=function(I,O,U,j,G){const $=O.videoSend.find(X=>X.ssrc===I);if(!$)return;const Z={};if(j){const X=$.sentFrame;X&&(ze(Z,ot.Video_Send_Low_Height,X.height),ze(Z,ot.Video_Send_Low_Width,X.width),ze(Z,ot.Video_Send_Low_Frame_Rate,X.frameRate));const ee=j.videoSend.find(le=>le.ssrc===I);if(ee){let le=Vd*f0;ee.timestamp&&$.timestamp&&(le=$.timestamp-ee.timestamp),ee.packets!=null&&$.packets!=null&&ze(Z,ot.Video_Send_Low_Package_Rate,1e3*($.packets-ee.packets)/le),$.packetsLost!=null&&ee.packetsLost!=null&&ze(Z,ot.Video_Send_Low_Package_Lost,$.packetsLost-ee.packetsLost),ee.bytes!=null&&$.bytes!=null&&ze(Z,ot.Video_Send_Low_Bitrate,8*($.bytes-ee.bytes)/le)}}return Z}(b[0].ssrcId,t,0,i);break;case ge.LocalAudioTrack:h=y&&function(I,O,U,j,G,$){const Z=O.audioSend.find(ee=>ee.ssrc===I);if(!Z)return;const X={};if(G){X[ot.Audio_Send_Disabled]=U._originMediaStreamTrack&&!U._originMediaStreamTrack.enabled||U._mediaStreamTrack&&!U._mediaStreamTrack.enabled?1:0;const ee=100*U._source.getAccurateVolumeLevel(),le=Z.inputLevel;if(le!=null){const Ie=Math.ceil(50*Math.log10(100*le+1));ze(X,ot.Audio_Send_Level,Ie)}ze(X,ot.Audio_Capture_PCM_Level,ee),ze(X,ot.Audio_Send_AEC_Return_Loss,Z.aecReturnLoss),ze(X,ot.Audio_Send_AEC_Return_Loss_Enhancement,Z.aecReturnLossEnhancement),ze(X,ot.Audio_Send_Bytes_Retransmit,Z.retransmittedBytesSent),ze(X,ot.Audio_Send_Packages_Retransmit,Z.retransmittedPacketsSent),X[ot.Audio_Send_Freeze]=0;const fe=G.audioSend.find(Ie=>Ie.ssrc===I);if(fe){let Ie=Vd*f0;fe.timestamp&&Z.timestamp&&(Ie=Z.timestamp-fe.timestamp),fe.bytes!=null&&Z.bytes!=null&&ze(X,ot.Audio_Send_Bitrate,8*(Z.bytes-fe.bytes)/Ie),fe.packets!=null&&Z.packets!=null&&ze(X,ot.Audio_Send_Package_Rate,1e3*(Z.packets-fe.packets)/Ie)}}return X}(b[0].ssrcId,t,y,0,i)}}),{high:f,low:g,audio:h}}getInboundStats(t,n,i,o){if(!this.requestRemoteMedia)return;const l=this.requestRemoteMedia()||[],d=[];return l.forEach(h=>{let[f,g]=h;const _={peer:f.uid};let v;if(g.has(xe.VIDEO)&&f.videoTrack){const y=f._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(f._videoSSRC)||!1,b=f.videoTrack?function(D,I,O,U,j,G,$,Z){const X=I.videoRecv.find(ct=>ct.ssrc===D);if(!X)return;const ee={},{receivedFrame:le,outputFrame:fe,decodeFrameRate:Ie}=X;ze(ee,Rr.Video_Render_Frame_Rate_Decode,Ie),X.framesRateFirefox&&ze(ee,Rr.Video_Recv_Frame_Rate,X.framesRateFirefox),le&&ze(ee,Rr.Video_Recv_Frame_Rate,le.frameRate),ze(ee,Rr.Video_Recv_Frame_Dropped,X.framesDroppedCount),ze(ee,Rr.Video_Recv_Bytes_Retransmit,X.retransmittedBytesReceived),ze(ee,Rr.Video_Recv_Packages_Retransmit,X.retransmittedPacketsReceived),ze(ee,Rr.Video_Recv_Packages_Discarded,X.packetsDiscarded),ze(ee,Rr.Video_Recv_Avg_Decode,X.avgDecodeMs),ze(ee,Rr.Video_Recv_Avg_Processing_Delay,X.avgProcessingDelayMs),ze(ee,Rr.Video_Recv_Avg_Assembly_Time,X.avgFramesAssembledFromMultiplePacketsMs),ze(ee,Rr.Video_Recv_Avg_Inter_Frame_Delay,X.avgInterFrameDelayMs),ze(ee,Rr.Video_Recv_Key_Frames_Decoded,X.keyFramesDecoded);const et=Z&&Z.videoRecv.find(ct=>ct.ssrc===D);if(et){const ct=I.timestamp-Z.timestamp||Vd;X.packetsLost!=null&&et.packetsLost!=null&&ze(ee,Rr.Video_Recv_Package_Lost,X.packetsLost-et.packetsLost),et.bytes!=null&&X.bytes!=null&&ze(ee,Rr.Video_Recv_Bitrate,8*(X.bytes-et.bytes)/ct),et.packets!=null&&X.packets!=null&&ze(ee,Rr.Video_Recv_Package_Rate,1e3*(X.packets-et.packets)/ct)}const Je=G&&G.videoRecv.find(ct=>ct.ssrc===D);if(Je&&(ze(ee,jo.Video_Recv_Qp_Sum,X.qpSumPerFrame),ee[jo.Video_Recv_Freeze]=U&&Pm.isRemoteVideoFreeze(O,X,Je)?1:0),$){var pt;const ct=$.videoRecv.find(bn=>bn.ssrc===D);le?(ze(ee,ot.Video_Recv_Height,le.height),ze(ee,ot.Video_Recv_Width,le.width)):O&&(ze(ee,ot.Video_Recv_Height,O._videoHeight||0),ze(ee,ot.Video_Recv_Width,O._videoWidth||0)),fe&&ze(ee,ot.Video_Recv_Frame_Rate_Output,fe.frameRate);const jt=(pt=O._player)===null||pt===void 0?void 0:pt.rendFrameRate.toFixed(0);if(jt&&ze(ee,ot.Video_Render_Frame_Rate_Render,+jt),ze(ee,ot.Video_Recv_Jitter_Buffer,X.jitterBufferMs),ze(ee,ot.Video_Recv_Current_Delay,X.currentDelayMs),ze(ee,ot.Video_Recv_Firs,X.firsCount),ze(ee,ot.Video_Recv_Nacks,X.nacksCount),ze(ee,ot.Video_Recv_Plis,X.plisCount),O){ee[ot.Video_Recv_Disabled]=O._originMediaStreamTrack.enabled&&O._mediaStreamTrack.enabled?0:1;const bn=O._player;if(bn){const{freezeTimeCounterList:he,renderFreezeAccTime:ve,renderFreezeAccTime2:Be,videoElementStatus:pe}=bn;if(he&&he.length>0&&ze(ee,jo.Video_Render_Freeze_Time,he.splice(0,1)[0]),j&&Oi.visibility==="visible"&&pe===is.PLAYING&&wt().supportRequestVideoFrameCallback){const R=Math.min(6e3,Be);bn.renderFreezeAccTime2=Math.max(0,Be-R),ze(ee,jo.Video_Render_Freeze_Time_Render2,R);const H=Math.min(6e3,ve);bn.renderFreezeAccTime=Math.max(0,ve-H),ze(ee,jo.Video_Render_Freeze_Time_Render,L("USE_NEW_RENDER_FREEZE_TIME")?R:H)}if(typeof X.totalFreezesDuration=="number"){const R=ct&&ct.totalFreezesDuration?X.totalFreezesDuration-ct.totalFreezesDuration:X.totalFreezesDuration;ze(ee,ot.Video_Render_Freeze_Duration,1e3*R)}}}if(ee[ot.Video_Recv_Player_Status]=gR[O._player?O._player.videoElementStatus:"uninit"],ct&&X.totalInterFrameDelay!==void 0&&X.totalSquaredInterFrameDelay!==void 0&&ct.totalInterFrameDelay!==void 0&&ct.totalSquaredInterFrameDelay!==void 0){const bn=X.totalInterFrameDelay-ct.totalInterFrameDelay,he=X.totalSquaredInterFrameDelay-ct.totalSquaredInterFrameDelay,ve=X.framesDecodeCount-ct.framesDecodeCount,Be=bn/ve*1e3,pe=Math.round(1e3*Math.sqrt((he-Math.pow(bn,2)/ve)/ve));!isNaN(pe)&&Be+pe>Math.max(3*Be,Be+150)&&(ee[ot.Video_Recv_I_Frame_Delay]=pe)}}return ee}(f._videoSSRC,t,f.videoTrack,y===!0,this.needUploadRenderFreezeTime,n,i,o):void 0;if(b&&(_.video=b),f.videoTrack){const D=t.videoRecv.find(I=>I.ssrc===f._videoSSRC);D&&D.estimatedPlayoutTimestamp&&(v=D.estimatedPlayoutTimestamp)}}if(g.has(xe.AUDIO)&&f.audioTrack){const y=f.audioTrack?function(b,D,I,O,U,j){const G=D.audioRecv.find(ee=>ee.ssrc===b);if(!G)return;const $={};ze($,Rr.Audio_Recv_Jitter,G.jitterMs),ze($,Rr.Audio_Recv_Bytes_Retransmit,G.retransmittedBytesReceived),ze($,Rr.Audio_Recv_Packages_Retransmit,G.retransmittedPacketsReceived),ze($,Rr.Audio_Recv_Packages_Discarded,G.packetsDiscarded),ze($,Rr.Audio_Recv_Avg_Processing_Delay,G.avgProcessingDelayMs);const Z=j&&j.audioRecv.find(ee=>ee.ssrc===b);if(Z){const ee=Vd;G.packets!=null&&Z.packets!=null&&ze($,Rr.Audio_Recv_Package_Rate,1e3*(G.packets-Z.packets)/ee),G.packetsLost!=null&&Z.packetsLost!=null&&ze($,Rr.Audio_Recv_Package_Lost,G.packetsLost-Z.packetsLost)}if(O){const{receivedFrames:ee,droppedFrames:le}=G;ee!=null&&le!=null&&($[jo.Audio_Recv_Freeze]=(X=ee)===0||100*le/X>20?1:0)}var X;if(U){const ee=100*I._source.getAccurateVolumeLevel(),le=G.outputLevel;if(le!=null){const Ie=Math.ceil(50*Math.log10(100*le+1));ze($,ot.Audio_Render_Level,Ie)}ze($,ot.Audio_Recv_PCM_Level,ee),I&&($[ot.Audio_Recv_Disabled]=I._originMediaStreamTrack.enabled&&I._mediaStreamTrack.enabled?0:1),ze($,ot.Audio_Recv_Jitter_Buffer,G.jitterBufferMs),ze($,ot.Audio_Recv_Current_Delay,G.jitterBufferMs),$[ot.Audio_Recv_Player_Status]=gR[Ts.getPlayerState(I.getTrackId())];const fe=U.audioRecv.find(Ie=>Ie.ssrc===b);if(fe){fe.bytes!=null&&G.bytes!=null&&ze($,ot.Audio_Recv_Bitrate,8*(G.bytes-fe.bytes)/(Vd*Fm));const Ie=G.concealedSamples-fe.concealedSamples;Ie>0&&ze($,ot.Audio_Recv_Concealed_Samples,Ie);const et=G.totalSamplesReceived-fe.totalSamplesReceived;et>0&&ze($,ot.Audio_Recv_Total_Samples_Received,et);const Je=G.freezeSamples80-fe.freezeSamples80;Je>0&&ze($,ot.Audio_Render_Freeze_Samples_80ms,Je);const pt=G.freezeSamples200-fe.freezeSamples200;pt>0&&ze($,ot.Audio_Render_Freeze_Samples_200ms,pt);const ct=G.freezeMs80-fe.freezeMs80;ze($,ot.Audio_Render_Freeze_Time_80ms,ct<0?0:ct);const jt=G.freezeMs200-fe.freezeMs200;ze($,ot.Audio_Render_Freeze_Time_200ms,jt<0?0:jt)}}return $}(f._audioSSRC,t,f.audioTrack,n,i,o):void 0;if(y&&(_.audio=y),f.audioTrack&&v){const b=t.audioRecv.find(D=>D.ssrc===f._audioSSRC);if(b&&b.estimatedPlayoutTimestamp){const D=b.estimatedPlayoutTimestamp-v;_.audio?_.audio[Rr.Audio_Recv_AV_Sync_TIME]=D:_.audio={[Rr.Audio_Recv_AV_Sync_TIME]:D}}}}(_.video||_.audio)&&d.push(_)}),this.needUploadRenderFreezeTime=!this.needUploadRenderFreezeTime,d}startUploadTransportStats(){this.uploadTransportStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats()}stopUploadTransportStats(){this.uploadTransportStarted=!1}startUploadOutboundStats(){this.uploadOutboundStarted||(this.uploadOutboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=window.setInterval(()=>{if(!this.requestAllTracks||!this.requestUpload)return;const t=(this.requestAllTracks()||[]).find(n=>n instanceof Tm);if(t&&t._external.getDenoiserStats){const n=t._external.getDenoiserStats();n&&this.requestUpload(Pd.DENOISER_STATS,n)}},2e3),this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=window.setInterval(()=>{!this.requestAllTracks||!this.requestUpload||this.requestAllTracks().forEach(t=>{t.getProcessorStats().forEach(n=>{this.requestUpload&&this.requestUpload(n.type,n.stats)})})},2e3))}stopUploadOutboundStats(){this.uploadOutboundStarted&&(this.uploadOutboundStarted=!1,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRefSendStats&&(this.lastRefSendStats.videoSend=[],this.lastRefSendStats.audioSend=[],this.lastRefSendStats=void 0),this.lastNormalSendStats&&(this.lastNormalSendStats.videoSend=[],this.lastNormalSendStats.audioSend=[],this.lastNormalSendStats=void 0),this.lastExtendStats={},this.needUploadStats={},this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=void 0,this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=void 0)}startUploadInboundStats(){this.uploadInboundStarted||(this.uploadInboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=window.setInterval(()=>{!this.requestUpload||!this.requestRemoteMedia||(this.requestRemoteMedia()||[]).forEach(t=>{let[n,i]=t;i.has(xe.VIDEO)&&n.videoTrack&&n.videoTrack.getProcessorStats().forEach(o=>{this.requestUpload&&this.requestUpload(o.type,o.stats)}),i.has(xe.AUDIO)&&n.audioTrack&&n.audioTrack.getProcessorStats().forEach(o=>{this.requestUpload&&this.requestUpload(o.type,o.stats)})})},2e3))}stopUploadInboundStats(){this.uploadInboundStarted&&(this.uploadInboundStarted=!1,this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0),this.lastRefRecvStats&&(this.lastRefRecvStats.videoRecv=[],this.lastRefRecvStats.audioRecv=[],this.lastRefRecvStats=void 0),this.lastNormalRecvStats&&(this.lastNormalRecvStats.videoRecv=[],this.lastNormalRecvStats.audioRecv=[],this.lastNormalRecvStats=void 0),this.lastUploadCompensateTime=-1,this.uploadCompensateDeltaTime=0,this.needUploadRenderFreezeTime=!0,this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=void 0)}startUploadExtensionUsageStats(){if(this.uploadExtensionUsageStarted)return;this.uploadExtensionUsageStarted=!0,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer);const t=new Map;this.uploadExtUsageStatsTimer=window.setInterval(async()=>{const n=Date.now(),i={connectionInterval:L("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3,details:[],lts:n};let o=[];const l=this.requestAllTracks&&this.requestAllTracks()||[];for(const g of l)!g.muted&&g.enabled&&(o=o.concat(await g.getProcessorUsage()));const d=this.requestRemoteMedia&&this.requestRemoteMedia()||[];for(const[g,_]of d)_.has(xe.VIDEO)&&g.videoTrack&&(o=o.concat(await g.videoTrack.getProcessorUsage())),_.has(xe.AUDIO)&&g.audioTrack&&(o=o.concat(await g.audioTrack.getProcessorUsage()));if(o.length===0)return;i.details=function(g,_){const v={};for(const{id:I,value:O,level:U,direction:j}of g){var y;const G=(y=_.get(I))!==null&&y!==void 0?y:0,$=O===2?G+L("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3:G;var b,D;_.set(I,$),v[I]?(O===2&&(v[I].value=O),U>v[I].level&&(v[I].level=U),j==="remote"&&(v[I].remoteUidCount+=1),v[I].totalTs=(b=_.get(I))!==null&&b!==void 0?b:0):v[I]={value:O,level:U,remoteUidCount:j==="local"?0:1,totalTs:(D=_.get(I))!==null&&D!==void 0?D:0}}return Object.keys(v).map(I=>{const{level:O,value:U,totalTs:j}=v[I];return{id:I,level:O,value:U,totalTs:j}})}(o,t);const h=Date.now(),f=h>n?h:n+1;this.requestUpload&&this.requestUpload(Pd.EXTENSION_USAGE_STATS,{usageStats:i,sendTs:f})},L("EXTENSION_USAGE_UPLOAD_INTERVAL"))}stopUploadExtensionUsageStats(){this.uploadExtensionUsageStarted&&(this.uploadExtensionUsageStarted=!1,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer),this.uploadExtUsageStatsTimer=void 0)}stopUploadBaseStats(){this.uploadBaseStatsStarted=!1,Oi.stopCollectStats()}}const _Ae=L("ICE_RESTART_INTERVAL");let m0=new Map,ep=new Map,Zl=[Ur.UDP_TCP_RELAY,Ur.TCP_RELAY,Ur.RELAY],wI=L("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&wt().supportPCSetConfiguration;function rQ(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const n=m0.get(e.id);n&&(window.clearTimeout(n),m0.delete(e.id));const i=ep.get(e.id);t&&i&&i.index===Zl.length-1&&(S.debug("[".concat(e.id,"] reset ICE restart policy")),ep.delete(e.id))}function sQ(e,t,n){if(m0.size===0&&ep.size===0&&(Array.isArray(L("RESTART_SEQUENCE"))&&L("RESTART_SEQUENCE").length>0&&!function(h,f){if(h.length!==f.length)return!1;for(let g=0;g<h.length;g+=1){const _=h[g];if(h.filter(v=>v===_).length!==f.filter(v=>v===_).length)return!1}return!0}(Zl,L("RESTART_SEQUENCE"))&&(Zl=L("RESTART_SEQUENCE").filter(h=>{var f;if(me(f=Object.values(Ur)).call(f,h))return!0}),S.debug("use reconnection policy from config distribution, queues: ".concat(Zl.join(" => ")))),wI=L("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&wt().supportPCSetConfiguration),Zl.length===0)return void n();let i,{index:o=0,type:l}=ep.get(e.id)||{};if(wI&&l===Ur.RELAY)return void n();let d=l&&o>=Zl.length-1;if(wI)l=Ur.RELAY;else{if(d)return void n();l?(o++,l=Zl[o]):(l=Zl[0],o=0)}S.debug("[".concat(e.id,"] choose ICE restart policy: ").concat(l,", index: ").concat(o)),t(l),ep.set(e.id,{index:o,type:l}),i=window.setTimeout(()=>sQ(e,t,n),_Ae),m0.set(e.id,i)}var St;function iQ(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}function yc(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?iQ(Object(n),!0).forEach(function(i){x(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):iQ(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}function aQ(e){var t,n,i,o=2;for(typeof Symbol<"u"&&(n=lv,i=Symbol.iterator);o--;){if(n&&(t=e[n])!=null)return t.call(e);if(i&&(t=e[i])!=null)return new g0(t.call(e));n="@@asyncIterator",i="@@iterator"}throw new TypeError("Object is not async iterable")}function g0(e){function t(n){if(Object(n)!==n)return be.reject(new TypeError(n+" is not an object."));var i=n.done;return be.resolve(n.value).then(function(o){return{value:o,done:i}})}return g0=function(n){this.s=n,this.n=n.next},g0.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(n){var i=this.s.return;return i===void 0?be.resolve({value:n,done:!0}):t(i.apply(this.s,arguments))},throw:function(n){var i=this.s.return;return i===void 0?be.reject(n):t(i.apply(this.s,arguments))}},new g0(e)}let Qd=(St=class extends Tn{get state(){return this._state}set state(e){const t=this._state;this._state=e,this.emit(Ve.StateChange,t,this._state)}constructor(e,t){super(),x(this,"isPlanB",void 0),x(this,"store",void 0),x(this,"statsUploader",void 0),x(this,"connection",void 0),x(this,"localTrackMap",new Map),x(this,"remoteUserMap",new Map),x(this,"localDataChannels",[]),x(this,"remoteDataChannelMap",new Map),x(this,"pendingLocalTracks",[]),x(this,"pendingRemoteTracks",[]),x(this,"pendingLocalDataChannels",[]),x(this,"pendingRemoteDataChannels",[]),x(this,"statsCollector",void 0),x(this,"shouldForwardP2PCreation",void 0),x(this,"iceFailedCount",0),x(this,"dtlsFailedCount",0),x(this,"mutex",void 0),x(this,"_state",Kt.Disconnected),x(this,"_pcStatsUploadType",L("NEW_ICE_RESTART")?Xc.FIRST_CONNECTION:Xc.OLD_FIRST_CONNECTION),x(this,"_isStartRestartIce",!1),x(this,"_restartTimer",void 0),x(this,"_isTryConnecting",!1),x(this,"_iceError",null),x(this,"_forceTurn",!1),x(this,"_isWaitPcToRePub",!1),x(this,"handleMuteLocalTrack",async(n,i,o)=>{const l=await this.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");try{if(!this.connection||this.state!==Kt.Connected)return void o(new ae(P.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established."));const d=this.filterTobeMutedTracks(n);if(d.length===0)return void i();const h=d.find(g=>g[0]==="videoLowTrack");if(h){const g=h[1];this.store.enableInstantMuteRestore?(g.track._originMediaStreamTrack.enabled=!1,S.info("[".concat(this.store.clientId,"] P2PChannel muteLocalLowTrack without close sender because enableInstantMuteRestore is true"))):g.track._originMediaStreamTrack.stop()}this.store.enableInstantMuteRestore?S.info("[".concat(this.store.clientId,"] P2PChannel muteLocalTrack without close sender because enableInstantMuteRestore is true")):await this.connection.muteLocal(d.map(g=>{let[,{id:_}]=g;return _}));const f=this.createMuteMessage(d);await ln(this,Ve.RequestMuteLocal,f),i()}catch(d){o(d)}finally{l()}}),x(this,"handleUnmuteLocalTrack",async(n,i,o)=>{const l=await this.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");try{if(!this.connection||this.state!==Kt.Connected)return void o(new ae(P.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established."));const d=this.filterTobeUnmutedTracks(n);if(d.length===0)return void i();const h=d.find(g=>g[0]==="videoLowTrack");if(h){const g=h[1];if(this.store.enableInstantMuteRestore)g.track._originMediaStreamTrack.enabled=!0,S.info("[".concat(this.store.clientId,"] P2PChannel unmuteLocalLowTrack without close sender because enableInstantMuteRestore is true"));else{if(g.track._originMediaStreamTrack.stop(),!L("DISABLE_DUAL_STREAM_USE_ENCODING")&&wt().supportDualStreamEncoding){const _=n._mediaStreamTrack.clone();g.track._mediaStreamTrack=_,g.track._originMediaStreamTrack=_}else{const _=vI(n,bd(this,Ve.RequestLowStreamParameter));g.track._mediaStreamTrack=_,g.track._originMediaStreamTrack=_}await new be((_,v)=>{this.handleReplaceTrack(g.track,_,v,!0)})}}this.store.enableInstantMuteRestore?S.info("[".concat(this.store.clientId,"] P2PChannel unmuteLocalTrack without close sender because enableInstantMuteRestore is true")):await this.connection.unmuteLocal(d.map(g=>{let[,{id:_}]=g;return _}));const f=this.createUnmuteMessage(d);await ln(this,Ve.RequestUnmuteLocal,f),i()}catch(d){o(d)}finally{l()}}),x(this,"handleUpdateVideoEncoder",async(n,i,o,l)=>{let d;l||(d=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoEncoder"));try{const f=this.localTrackMap.get(ge.LocalVideoTrack);if(!this.connection||!f||f.track!==n||this.state!==Kt.Connected)return void i();const{id:g,track:_}=f;await this.connection.updateSendParameters(g,_),await this.connection.updateEncoderConfig(g,_),this.emit(Ve.UpdateVideoEncoder,_),i()}catch(f){o(f)}finally{var h;(h=d)===null||h===void 0||h()}}),x(this,"handleUpdateVideoSendParameters",async(n,i,o)=>{const l=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoSendParameters");try{const d=this.localTrackMap.get(ge.LocalVideoTrack);if(!this.connection||!d||d.track!==n||this.state!==Kt.Connected)return void i();const{id:h,track:f}=d;await this.connection.updateSendParameters(h,f),i()}catch(d){o(d)}finally{l()}}),x(this,"handleReplaceMixingTrack",async(n,i,o,l)=>{if(!this.connection||this.state!==Kt.Connected)return void i();const d=gI([n]);let h;S.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(d.getTrackId(),"]")),typeof l=="boolean"&&l||(h=await this.mutex.lock("From P2PChannel.handleReplaceMixingTrack"));try{await this.replaceTrack(n,d),i()}catch(g){o(g)}finally{var f;(f=h)===null||f===void 0||f()}}),x(this,"handleReplaceTrack",async(n,i,o,l)=>{let d;S.debug("[".concat(this.store.clientId,"] P2PChannel handleReplaceTrack for [track-id-").concat(n.getTrackId(),"]")),typeof l=="boolean"&&l||(d=await this.mutex.lock("From P2PChannel.handleReplaceTrack"));try{var h;const g=Array.from(this.localTrackMap.entries()).find(_=>{let[,{track:v}]=_;return n===v});if(!this.connection||!g||this.state!==Kt.Connected)return void i();if(await((h=this.connection)===null||h===void 0?void 0:h.replaceTrack(n,g[1].id)),this.isPlanB){const _=g[1];_.id=n._mediaStreamTrack.id,this.localTrackMap.set(g[0],_)}if(g[0]===ge.LocalVideoTrack&&!L("DISABLE_DUAL_STREAM_USE_ENCODING")&&wt().supportDualStreamEncoding){const _=this.localTrackMap.get(ge.LocalVideoLowTrack);if(_){const v=n._mediaStreamTrack.clone();_.track._originMediaStreamTrack.stop(),_.track._mediaStreamTrack=v,_.track._originMediaStreamTrack=v,await new be((y,b)=>{this.handleReplaceTrack(_.track,y,b,!0)})}}i()}catch(g){o(g)}finally{var f;(f=d)===null||f===void 0||f()}}),x(this,"handleGetRTCStats",n=>{n(this.statsCollector.getRTCStats())}),x(this,"handleGetLocalVideoStats",n=>{n(this.statsCollector.getLocalVideoTrackStats())}),x(this,"handleGetLocalAudioStats",n=>{n(this.statsCollector.getLocalAudioTrackStats())}),x(this,"handleGetRemoteVideoStats",n=>this.statsCollector.getRemoteVideoTrackStats(n.uid)[n.uid]),x(this,"handleGetRemoteAudioStats",n=>this.statsCollector.getRemoteAudioTrackStats(n.uid)[n.uid]),this.store=e,this.statsCollector=t,this.statsCollector.addP2PChannel(this),this.statsUploader=new nQ(this.store),this.bindStatsUploaderEvents(),this.mutex=new Lr("P2PChannel-mutex",this.store.clientId),this.isPlanB=!wt().supportUnifiedPlan||L("CHROME_FORCE_PLAN_B")&&uc(),this.shouldForwardP2PCreation=L("FORWARD_P2P_CREATION")&&wt().supportPCSetConfiguration&&HM(),this.shouldForwardP2PCreation&&(this.connection=Mm(this.store),this.emit(Ve.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection))}async startP2PConnection(e,t){var n;this.state=Kt.New,this._forceTurn=EI(e),S.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] forceTurn: ").concat(this._forceTurn));const i=this.shouldForwardP2PCreation&&((n=this.connection)===null||n===void 0?void 0:n.peerConnectionState)==="closed";if((!this.shouldForwardP2PCreation||i||t)&&((i||t)&&this.connection&&(S.warning("[".concat(this.store.clientId,"] P2PChannel.startP2PConnection ForwardP2P closed.")),this.resetConnection(this.connection)),this.connection=Mm(this.store,e),this.emit(Ve.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),!this.connection)throw new ae(P.UNEXPECTED_ERROR,"Cannot P2PChannel.startConnection before P2PConnection initialization .");return this._pcStatsUploadType=L("NEW_ICE_RESTART")?Xc.FIRST_CONNECTION:Xc.OLD_FIRST_CONNECTION,this._isTryConnecting=!0,this._isStartRestartIce=!1,this._iceError=null,this.connection.setConfiguration(e),this.connection.establishPromise}async connect(e){if(!this.connection)throw new ae(P.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");if(!this.isPreallocation()||this.state!==Kt.Connected){this.store.peerConnectionStart();const t=await this.connection.connect(e);return this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=Kt.Connected,t}if(this.connection instanceof zi&&this.connection.checkDtlsParameters(e.dtlsParameters.fingerprints))return S.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] dtls parameters mismatch, try next.")),ke.reportApiInvoke(this.store.sessionId,{name:yn.MISMATCH_DTLS_PARAMETERS,options:[e.dtlsParameters.fingerprints],tag:an.TRACER}).onSuccess(),void setTimeout(()=>{this.emit(Ve.RequestReconnect)});await this.connection.updateRemoteConnect(e)}updateRemoteRTPCapabilities(e){const t=Array.from(this.localTrackMap.entries()).filter(o=>{var l;let[d]=o;return me(l=[ge.LocalVideoLowTrack,ge.LocalVideoTrack]).call(l,d)}),n=t.map(o=>{let[,{id:l}]=o;return l}),i=t.map(o=>{let[l]=o;return l});if(this.connection instanceof zi||this.connection&&"name"in this.connection&&this.connection.name==="DataChannelConnection"){if(ke.updateRemoteRTPCapabilities(this.store.sessionId,{trackTypes:JSON.stringify(i),localCodecs:JSON.stringify(this.connection.localCodecs),remoteCodecs:JSON.stringify(e)}),!me(e).call(e,this.store.codec)){const o=["vp9","vp8","h264"].find(l=>me(e).call(e,l));o&&(this.store.codec=o,S.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId," updateRemoteRTPCapabilities] default codec is not available, hence the fallback to ").concat(o,".")))}this.connection.updateRemoteRTPCapabilities(n,e)}}async getEstablishParams(){var e;return this.connection&&"name"in this.connection&&this.connection.name==="DataChannelConnection"&&this.connection.peerConnectionState!=="closed"||this.connection instanceof zi&&this.connection.peerConnectionState!=="closed"&&me(e=[Kt.New,Kt.Connected]).call(e,this.state)?this.connection.establishPromise:void 0}async publishDataChannel(e){if(!this.connection||this.state!==Kt.Connected){if(this.state===Kt.Disconnected)throw new ae(P.UNEXPECTED_ERROR,"PeerConnection already disconnected.");return e.forEach(n=>{var i;me(i=this.pendingLocalDataChannels).call(i,n)||this.pendingLocalDataChannels.push(n)}),[]}const t=this.filterTobePublishedDataChannels(e);return t.length===0?[]:(t.forEach(n=>{const i=Date.now();this.store.publish(n.id.toString(),"datachannel",i)}),await this.connection.createDataChannels(this.store.uid,t),t.forEach(n=>{this.localDataChannels.push(n);const i=Date.now();this.store.publish(n.id+"","datachannel",void 0,i)}),e.map(n=>({streamId:n.id,ordered:n.ordered,maxRetransmits:n.maxRetransmits,metadata:n.metadata,channelId:n._originDataChannelId})))}publish(e,t,n){var i=this;return qs(function*(){const o=yield ft(i.mutex.lock("From P2PChannel.publish"));try{var l;const d=i.connection&&me(l=["disconnected","failed"]).call(l,i.connection.peerConnectionState);if(!i.connection||i.state!==Kt.Connected||d){if(i.state===Kt.Disconnected)throw new ae(P.UNEXPECTED_ERROR,"PeerConnection already disconnected.");i.throwIfTrackTypeNotMatch(e);const f=e.filter(g=>i.pendingLocalTracks.indexOf(g)===-1);return i.pendingLocalTracks=i.pendingLocalTracks.concat(f),void(d&&(i._isWaitPcToRePub=!0))}i.store.pubId=i.store.pubId+1,os.markPublishStart(i.store.clientId,i.store.pubId);const h=i.filterTobePublishedTracks(e,t,n);if(h.length===0)return void(yield ft(i.tryToUnmuteAudio(e)));yield*bh(aQ(i.doPublish(i.connection,h)))}finally{o()}})()}doPublish(e,t){var n=this;return qs(function*(){t.forEach(y=>{let{track:b,type:D}=y;const I=Date.now();n.store.publish(b.getTrackId(),D===ge.LocalAudioTrack?"audio":"video",I)}),n.bindLocalTrackEvents(t);const i=t.map(y=>{let{track:b}=y;return b}),o=yield ft(e.send(i,n.store.codec,n.store.audioCodec)),l=(yield ft(o.next())).value,d=n.createGatewayPublishMessage(t,l);let h;try{h=yield d}catch(y){throw o.throw(y),(y==null?void 0:y.code)===P.WS_ABORT&&t.forEach(b=>{let{track:D}=b;n.pendingLocalTracks.indexOf(D)===-1&&n.pendingLocalTracks.push(D)}),n.unbindLocalTrackEvents(t),y}const f=n.mapPubResToRemoteConfig(d,h,i),g=(yield ft(o.next(f))).value;if(n.state===Kt.Disconnected)throw new ae(P.UNEXPECTED_ERROR,"PeerConnection already disconnected.");L("ENABLE_VIDEO_SEI");const _=L("ENABLE_ENCODED_TRANSFORM"),v=L("ENABLE_AUDIO_METADATA");i.forEach(async y=>{const b=y.getRTCRtpTransceiver();if(!b||!_)return;const{interceptLocalVideoFrame:D,interceptLocalAudioFrame:I}=a0();y.trackMediaType===xe.VIDEO?await D(b.sender,y):y.trackMediaType===xe.AUDIO&&await I(b.sender,{metadata:v?()=>{const O=y.metadata.shift();return O&&O.value}:void 0})}),t.forEach(y=>{let{type:b}=y;n.statsCollector.addLocalStats(b)}),n.assignLocalTracks(t,g),n.statsUploader.startUploadOutboundStats(),t.forEach(y=>{let{track:b,type:D}=y;const I=Date.now();n.store.publish(b.getTrackId(),D===ge.LocalAudioTrack?"audio":"video",void 0,I)})})()}async updateVideoStreamParameter(e,t){const n=this.localTrackMap.get(t);if(!n||!this.connection)return;if(!(n.track instanceof on))return S.warn("[updateVideoStreamParameter]: track is not an instance of LocalVideoTrack");const{track:i}=n,o=function(l,d){const h={};return l.height&&l.width&&(h.scaleResolutionDownBy=XR(l,d)),h.maxFramerate=l.framerate?ei(l.framerate):void 0,h.maxBitrate=l.bitrate?1e3*l.bitrate:void 0,h}(e,i);if(i._encoderConfig||(i._encoderConfig={}),t!==ge.LocalVideoLowTrack||!L("DISABLE_DUAL_STREAM_USE_ENCODING")&&wt().supportDualStreamEncoding)o.scaleResolutionDownBy!=null&&(i._encoderConfig.scaleResolutionDownBy=o.scaleResolutionDownBy);else{const l=i._originMediaStreamTrack;if(!l.canvas)return S.warn("[".concat(i.getTrackId(),"] no canvas on track"));(function(d,h){const f=d.canvas;h.width&&(f.width=ei(h.width)),h.height&&(f.height=ei(h.height)),h.framerate&&(f.stopCapture&&f.stopCapture(),f.stopCapture=vR(()=>{!f.startCapture&&f.stopCapture&&f.stopCapture(),f.startCapture&&f.startCapture()},ei(h.framerate)))})(l,e)}o.maxBitrate!=null&&(i._encoderConfig.bitrateMax=o.maxBitrate/1e3),o.maxFramerate!=null&&(i._encoderConfig.frameRate&&typeof i._encoderConfig.frameRate=="object"?i._encoderConfig.frameRate.max=o.maxFramerate:i._encoderConfig.frameRate={max:o.maxFramerate}),S.debug("[".concat(i.getTrackId(),"] LowStreamEncoderConfig: , ").concat(JSON.stringify(i._encoderConfig))),await this.connection.updateRtpSenderEncodings(i)}publishLowStream(e){var t=this;return qs(function*(){if(!t.connection||t.state!==Kt.Connected)return;const n=yield ft(t.mutex.lock("Locking from P2PChannel.publishLowStream"));try{const o=t.localTrackMap.get(ge.LocalVideoTrack);if(!o)throw new ae(P.UNEXPECTED_ERROR,"Could not find high stream");if(t.localTrackMap.has(ge.LocalVideoLowTrack))throw new ae(P.UNEXPECTED_ERROR,"[".concat(t.store.clientId,"] Can't publish low stream when stream already publish"));const l=[{track:t.getLowVideoTrack(o.track,e),type:ge.LocalVideoLowTrack}];if(yield*bh(aQ(t.doPublish(t.connection,l))),o.track.muted||!o.track.enabled){var i;const d=(i=t.localTrackMap.get(ge.LocalVideoLowTrack))===null||i===void 0?void 0:i.id;d!==void 0&&(yield ft(t.connection.muteLocal([d])))}}finally{n()}})()}async republish(){this.pendingLocalTracks.length>0&&(S.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await ir(this,Ve.RequestRePublish,this.pendingLocalTracks),this.emit(Ve.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[]),this.pendingLocalDataChannels.length>0&&(S.debug("Emit P2PChannelEvents.RequestRePublishDataChannel to republish datachannels."),await ir(this,Ve.RequestRePublishDataChannel,this.pendingLocalDataChannels),this.pendingLocalDataChannels=[]),this._isWaitPcToRePub=!1}async reSubscribe(e){for(let t=this.pendingRemoteTracks.length-1;t>=0;t--){const{user:n,kind:i}=this.pendingRemoteTracks[t];(i!==xe.AUDIO||n._audio_added_&&n._audioSSRC)&&(i!==xe.VIDEO||n._video_added_&&n._videoSSRC)||this.pendingRemoteTracks.splice(t,1)}if(e)await ir(this,Ve.RequestReSubscribe,this.pendingRemoteTracks);else for(const{user:t,kind:n}of this.pendingRemoteTracks)await this.subscribe(t,n,n===xe.VIDEO?t._videoSSRC:t._audioSSRC);this.pendingRemoteTracks.forEach(t=>{let{user:n}=t;this.emit(Ve.MediaReconnectEnd,n.uid)}),this.pendingRemoteTracks=[]}async unpublish(e){if(!this.connection||this.state!==Kt.Connected)return void e.forEach(i=>{const o=this.pendingLocalTracks.indexOf(i);o!==-1&&this.pendingLocalTracks.splice(o,1)});const t=this.filterTobeUnpublishedTracks(e);if(t.length===0)return;const n=t.find(i=>i[0]==="videoLowTrack");return n&&n[1].track.close(),this.doUnpublish(this.connection,t)}async unpublishDataChannel(e){if(!this.connection||this.state!==Kt.Connected)return void e.forEach(n=>{const i=this.pendingLocalDataChannels.indexOf(n);i!==-1&&this.pendingLocalDataChannels.splice(i,1)});const t=this.filterTobeUnpublishedDataChannels(e);return t.length!==0?(t.forEach(n=>{const i=this.localDataChannels.indexOf(n);i!==-1&&this.localDataChannels.splice(i,1)}),this.localDataChannels.length===0&&await this.connection.stopDataChannels(this.store.uid),t.map(n=>n.id)):void 0}async unpublishLowStream(){if(!this.connection||this.state!==Kt.Connected)return;const e=this.localTrackMap.get(ge.LocalVideoLowTrack);if(!e)return;e.track.close();const t=[[ge.LocalVideoLowTrack,e]];return this.doUnpublish(this.connection,t)}async doUnpublish(e,t){const n=this.createGatewayUnpublishMessage(t);return await e.stopSending(t.map(i=>{let[,{id:o}]=i;return o})),this.withdrawLocalTracks(t),this.unbindLocalTrackEvents(t.map(i=>{let[o,{track:l}]=i;return{type:o,track:l}})),t.forEach(i=>{let[o]=i;this.statsCollector.removeLocalStats(o)}),this.localTrackMap.size===0&&this.statsUploader.stopUploadOutboundStats(),n}async subscribeDataChannel(e,t){if(!this.connection||this.state!==Kt.Connected)throw new ae(P.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");const n=t.filter(i=>{var o;return!((o=this.remoteDataChannelMap.get(e))!==null&&o!==void 0&&o.get(i.id))});if(n.length!==0)return await this.connection.createDataChannels(e.uid,n),n.forEach(i=>{var o;this.remoteDataChannelMap.has(e)?(o=this.remoteDataChannelMap.get(e))===null||o===void 0||o.set(i.id,i):this.remoteDataChannelMap.set(e,new Map([[i.id,i]]));const l=this.pendingRemoteDataChannels.findIndex(d=>{let{user:h,id:f}=d;return h.uid===e.uid&&f===i.id});l!==-1&&this.pendingRemoteDataChannels.splice(l,1)}),n.map(i=>i.id)}async subscribe(e,t,n,i,o){var l;if(!this.connection||this.state!==Kt.Connected)throw new ae(P.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");if((l=this.remoteUserMap.get(e))!==null&&l!==void 0&&l.has(t))return;let d,h,f,g;const _=this.connection.getPreMedia(n);if(_)S.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] preSSRCMap has ssrcId: ").concat(n,", no need to send sub to gateway.")),f=_.transceiver,d=_.track,h=_.mid,g=_.player,_.firstVideoRender&&this.store.firstVideoFrameDecoded(e.uid,{firstPreRender:_.firstVideoRender});else if(o){const b=o.find(I=>{let{stream_type:O}=I;return O===t});if(!b)throw new ae(P.UNEXPECTED_ERROR,"Cannot subscribe to remote ".concat(t," for user: ").concat(e.uid," because subscribe answer from gateway does not contain stream_type: ").concat(t,"."));const D=await this.connection.receive(t,b.ssrcs,String(e._uintid),b.attributes);(this.connection instanceof zi||"name"in this.connection&&this.connection.name==="DataChannelConnection")&&(f=D.transceiver),d=D.track,h=D.id}else{const b=await this.connection.receive(t,[{ssrcId:n,rtx:i}],String(e._uintid),void 0);(this.connection instanceof zi||"name"in this.connection&&this.connection.name==="DataChannelConnection")&&(f=b.transceiver),d=b.track,h=b.id}if(t===xe.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(d):(e._audioTrack=new jh(d,e.uid,e._uintid,this.store),S.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),f&&e._audioTrack._updateRtpTransceiver(f),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(d):(e._videoTrack=new Fh(d,e.uid,e._uintid,this.store,g),S.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId())),e._videoTrack.once(ua.PLAY_START,()=>{this.store.firstVideoFrameDecoded(e.uid,{playStart:Date.now()})}),e._videoTrack.once(ua.PLAY_END,()=>{this.store.firstVideoFrameDecoded(e.uid,{playEnd:Date.now()}),this.reportVideoFirstFrameRender(e)}),g?e._videoTrack.once(ua.FIRST_FRAME_RENDER,()=>{this.store.firstVideoFrameDecoded(e.uid,{firstRender:Date.now()}),this.reportVideoFirstFrameRender(e)}):e._videoTrack.once(ua.FIRST_FRAME_DECODED,()=>{this.store.firstVideoFrameDecoded(e.uid,{firstRender:Date.now()}),this.reportVideoFirstFrameRender(e)})),f&&e._videoTrack._updateRtpTransceiver(f),this.bindRemoteTrackEvents(e,e._videoTrack)),f&&L("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:b,interceptRemoteAudioFrame:D}=a0();t==xe.VIDEO?await b(f.receiver,{onSei:L("ENABLE_VIDEO_SEI")&&(I=>{var O;return(O=e._videoTrack)===null||O===void 0?void 0:O._onSei(I)}),onFirstFrame:I=>{var O;const U=Array.from(ms(O=this.remoteUserMap).call(O)).find(j=>j._videoSSRC===I.ssrc);U&&this.store.firstVideoFrameDecoded(U.uid,{firstReceivedEncodedFrame:Date.now(),frameType:I.type,rtpTimestamp:I.rtpTimestamp,framePayloadType:I.payloadType,frameDataLength:I.length,mimeType:I.mimeType})}}):t==xe.AUDIO&&await D(f.receiver,{enableTopn:!!L("ENABLE_AUDIO_TOPN"),enableMetadata:!!L("ENABLE_AUDIO_METADATA"),enablePts:!!L("ENABLE_AUDIO_PTS"),onMetadata:I=>{this.safeEmit(Ve.AudioMetadata,I)},onPts:I=>{this.safeEmit(Ve.AudioPts,I)}})}const v=this.remoteUserMap.get(e);v?v.set(t,h):this.remoteUserMap.set(e,new Map([[t,h]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats();const y=this.pendingRemoteTracks.findIndex(b=>{let{user:D,kind:I}=b;return D.uid===e.uid&&t===I});y!==-1&&(this.pendingRemoteTracks.splice(y,1),this.emit(Ve.MediaReconnectEnd,e.uid))}async massSubscribe(e){return this.massSubscribeNoLock(e)}async massSubscribeNoLock(e){if(!this.connection||this.state!==Kt.Connected)throw new ae(P.INVALID_OPERATION,"Cannot subscribeAll remote users when peerConnection disconnected.");e=e.filter(o=>{var l;let{user:d,mediaType:h}=o;return!((l=this.remoteUserMap.get(d))!==null&&l!==void 0&&l.has(h))});const t=[],n=new Map;e.forEach(o=>{if(!this.connection)return;const l=this.connection.getPreMedia(o.ssrcId);if(l){const{track:d,mid:h,transceiver:f,player:g}=l;n.set(o.ssrcId,{track:d,id:h,transceiver:f,player:g})}else t.push(o)});const i=await this.connection.batchReceive(t.map(o=>{let{user:l,mediaType:d,ssrcId:h,rtxSsrcId:f}=o;return{kind:d,ssrcMsg:[{ssrcId:h,rtx:f}],mslabel:String(l._uintid)}}));t.forEach((o,l)=>{n.set(o.ssrcId,i[l])});for(const{user:o,mediaType:l,ssrcId:d}of e){const h=n.get(d);if(!h)return void S.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] cannot find ").concat(o.uid," subscribe data,").concat(l,", ").concat(d));const{track:f,id:g,transceiver:_,player:v}=h;if(_&&L("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:D,interceptRemoteAudioFrame:I}=a0();l==xe.VIDEO?await D(_.receiver,{onSei:L("ENABLE_VIDEO_SEI")&&(O=>{var U;return(U=o._videoTrack)===null||U===void 0?void 0:U._onSei(O)}),onFirstFrame:O=>{var U;const j=Array.from(ms(U=this.remoteUserMap).call(U)).find(G=>G._videoSSRC===O.ssrc);j&&this.store.firstVideoFrameDecoded(j.uid,{firstReceivedEncodedFrame:Date.now(),frameType:O.type,rtpTimestamp:O.rtpTimestamp,framePayloadType:O.payloadType,frameDataLength:O.length,mimeType:O.mimeType})}}):l==xe.AUDIO&&await I(_.receiver,{enableTopn:!!L("ENABLE_AUDIO_TOPN"),enableMetadata:!!L("ENABLE_AUDIO_METADATA"),enablePts:!!L("ENABLE_AUDIO_PTS"),onMetadata:O=>{this.safeEmit(Ve.AudioMetadata,O)},onPts:O=>{this.safeEmit(Ve.AudioPts,O)}})}if(l===xe.AUDIO?(o._audioTrack?o._audioTrack._updateOriginMediaStreamTrack(f):(o._audioTrack=new jh(f,o.uid,o._uintid,this.store),S.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(o._audioTrack.getTrackId()))),_&&o._audioTrack._updateRtpTransceiver(_),this.bindRemoteTrackEvents(o,o._audioTrack)):(o._videoTrack?o._videoTrack._updateOriginMediaStreamTrack(f):(o._videoTrack=new Fh(f,o.uid,o._uintid,this.store,v),S.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(o._videoTrack.getTrackId()))),_&&o._videoTrack._updateRtpTransceiver(_),this.bindRemoteTrackEvents(o,o._videoTrack)),L("ENABLE_VIDEO_SEI")&&_){const{interceptRemoteVideoFrame:D,interceptRemoteAudioFrame:I}=a0();l==xe.VIDEO?await D(_.receiver,{onSei:O=>{var U;(U=o._videoTrack)===null||U===void 0||U._onSei(O)},onFirstFrame:O=>{var U;const j=Array.from(ms(U=this.remoteUserMap).call(U)).find(G=>G._videoSSRC===O.ssrc);j&&this.store.firstVideoFrameDecoded(j.uid,{firstReceivedEncodedFrame:Date.now(),frameType:O.type,rtpTimestamp:O.rtpTimestamp,framePayloadType:O.payloadType,frameDataLength:O.length,mimeType:O.mimeType})}}):l==xe.AUDIO&&await I(_.receiver)}const y=this.remoteUserMap.get(o);y?y.set(l,g):this.remoteUserMap.set(o,new Map([[l,g]])),this.statsCollector.addRemoteStats(o.uid),this.statsUploader.startUploadInboundStats();const b=this.pendingRemoteTracks.findIndex(D=>{let{user:I,kind:O}=D;return I.uid===o.uid&&l===O});b!==-1&&(this.pendingRemoteTracks.splice(b,1),this.emit(Ve.MediaReconnectEnd,o.uid))}}async unsubscribe(e,t,n){const i=this.pendingRemoteTracks.filter(d=>{let{user:h,kind:f}=d;return t!==void 0?h.uid===e.uid&&t===f:h.uid===e.uid});if(i.forEach(d=>{const h=this.pendingRemoteTracks.indexOf(d);this.pendingRemoteTracks.splice(h,1)}),this.connection&&this.state===Kt.Connected||n||i.forEach(d=>{let{kind:h}=d;var f;if(h===xe.AUDIO)(f=e._audioTrack)===null||f===void 0||f._destroy(),e._audioTrack=void 0;else if(h===xe.VIDEO){var g;(g=e._videoTrack)===null||g===void 0||g._destroy(),e._videoTrack=void 0}}),!this.connection||this.state!==Kt.Connected)return;const o=this.filterTobeUnSubscribedTracks(e,t);if(o.length===0)return;await this.connection.stopReceiving(o.map(d=>{let[,{id:h}]=d;return h}));const l=this.createUnsubscribeMessage(o);return this.withdrawRemoteTracks(o),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),o.forEach(d=>{let[h,{kind:f}]=d;var g,_;if(f===xe.VIDEO&&h._videoSSRC&&((g=this.connection)===null||g===void 0||g.setStatsRemoteVideoIsReady(h._videoSSRC,!1)),f===xe.VIDEO)this.unbindRemoteTrackEvents(h._videoTrack),n||((_=h._videoTrack)===null||_===void 0||_._destroy(),h._videoTrack=void 0);else if(f===xe.AUDIO){var v;this.unbindRemoteTrackEvents(h._audioTrack),!n&&((v=h._audioTrack)===null||v===void 0||v._destroy(),h._audioTrack=void 0)}}),l}async unsubscribeDataChannel(e,t){if(t.forEach(o=>{const l=this.pendingRemoteDataChannels.findIndex(d=>d.id===o.id);l!==-1&&this.pendingRemoteDataChannels.splice(l,1)}),!this.connection)return;const n=this.filterTobeUnSubscribedDataChannels(e,t);if(n.length===0)return;t.forEach(o=>{o._close()});const i=this.remoteDataChannelMap.get(e);return n.forEach(o=>{i&&i.delete(o.id)}),i&&i.size===0&&(this.remoteDataChannelMap.delete(e),await this.connection.stopDataChannels(e.uid)),n.map(o=>o.id)}async massUnsubscribe(e){return this.massUnsubscribeNoLock(e)}async massUnsubscribeNoLock(e){let t=[];for(const{user:o,mediaType:l}of e){const d=this.pendingRemoteTracks.filter(h=>{let{user:f,kind:g}=h;return l!==void 0?f.uid===o.uid&&l===g:f.uid===o.uid});d.forEach(h=>{const f=this.pendingRemoteTracks.indexOf(h);this.pendingRemoteTracks.splice(f,1)}),t=t.concat(d)}if(!this.connection||this.state!==Kt.Connected)return void t.forEach(o=>{let{user:l,kind:d}=o;var h;if(d===xe.AUDIO)(h=l._audioTrack)===null||h===void 0||h._destroy(),l._audioTrack=void 0;else if(d===xe.VIDEO){var f;(f=l._videoTrack)===null||f===void 0||f._destroy(),l._videoTrack=void 0}});const n=ca(e).call(e,(o,l)=>{let{user:d,mediaType:h}=l;const f=this.filterTobeUnSubscribedTracks(d,h);return o.concat(f)},[]);if(n.length===0)return;await this.connection.stopReceiving(n.map(o=>{let[,{id:l}]=o;return l}));const i=this.createUnsubscribeAllMessage(n);return this.withdrawRemoteTracks(n),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),n.forEach(o=>{let[l,{kind:d}]=o;var h,f;if(d===xe.VIDEO&&l._videoSSRC&&((h=this.connection)===null||h===void 0||h.setStatsRemoteVideoIsReady(l._videoSSRC,!1)),d===xe.VIDEO)this.unbindRemoteTrackEvents(l._videoTrack),(f=l._videoTrack)===null||f===void 0||f._destroy(),l._videoTrack=void 0;else if(d===xe.AUDIO){var g;this.unbindRemoteTrackEvents(l._audioTrack),(g=l._audioTrack)===null||g===void 0||g._destroy(),l._audioTrack=void 0}}),i}isPreSubScribe(e){return!this.connection||this.state!==Kt.Connected?!1:!!this.connection.getPreMedia(e)}async muteRemote(e,t){if(!this.connection)return;const n=this.remoteUserMap.get(e);if(!n)return void S.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid,"."));if(!n.get(t))return void S.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."));const i=t===xe.VIDEO?e._videoSSRC:e._audioSSRC;i!==void 0&&this.connection.setStatsRemoteVideoIsReady(i,!1)}async unmuteRemote(e,t){return this.unmuteRemoteNoLock(e,t)}async unmuteRemoteNoLock(e,t){if(!this.connection)return;const n=this.remoteUserMap.get(e);if(!n)return void S.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid,"."));n.get(t)||S.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."))}addAudioMetadata(e){const t=this.localTrackMap.get(ge.LocalAudioTrack),n=t&&t.track;n&&n.metadata.push(e)}getAllTracks(e){const t=this.localTrackMap.get(ge.LocalAudioTrack);if((t==null?void 0:t.track)instanceof dr){const n=t.track;return Array.from(this.localTrackMap.entries()).filter(i=>{let[o]=i;return o!==ge.LocalAudioTrack}).filter(i=>{let[o]=i;return!(e&&o===ge.LocalVideoLowTrack)}).map(i=>{let[,{track:o}]=i;return o}).concat(n.trackList)}return Array.from(this.localTrackMap.entries()).filter(n=>{let[i]=n;return!(e&&i===ge.LocalVideoLowTrack)}).map(n=>{let[,{track:i}]=n;return i})}getAllDataChannels(){return this.localDataChannels}reportPublishEvent(e,t,n,i,o){if(e){const d=this.localTrackMap.get(ge.LocalAudioTrack),h=i?this.localTrackMap.get(ge.LocalVideoLowTrack):this.localTrackMap.get(ge.LocalVideoTrack);ke.publish(this.store.sessionId,{eventElapse:os.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:d==null?void 0:d.track.getTrackLabel(),videoName:h==null?void 0:h.track.getTrackLabel(),screenshare:(h==null?void 0:h.track._hints.indexOf(Wt.SCREEN_TRACK))!==-1,audio:!!d,video:!!h,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:o})}else{var l;n||(n=[]);const d=n.find(f=>f instanceof Mn),h=i?(l=this.localTrackMap.get(ge.LocalVideoTrack))===null||l===void 0?void 0:l.track:n.find(f=>f instanceof on);ke.publish(this.store.sessionId,{eventElapse:os.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:d==null?void 0:d.getTrackLabel(),videoName:h==null?void 0:h.getTrackLabel(),screenshare:(h==null?void 0:h._hints.indexOf(Wt.SCREEN_TRACK))!==-1,audio:!!d,video:!!h,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:o})}}reportSubscribeEvent(e,t,n,i){const o=i===xe.VIDEO?n._videoSSRC:n._audioSSRC;o&&ke.subscribe(this.store.sessionId,{succ:e,ec:t,video:i===xe.VIDEO,audio:i===xe.AUDIO,peerid:n.uid,subscribeRequestid:o,p2pid:this.store.p2pId,eventElapse:os.measureFromSubscribeStart(this.store.clientId,o),preSsrc:this.isPreSubScribe(o)})}reset(){S.debug("[".concat(this.store.clientId,"] P2PChannel.reset")),this.mutex=new Lr("P2PChannel-mutex",this.store.clientId),this.connection&&(this.resetConnection(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=Mm(this.store),this.emit(Ve.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.statsUploader.stopUploadBaseStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const e=this.localTrackMap.get(ge.LocalAudioTrack);if((e==null?void 0:e.track)instanceof dr){if(e.track.trackList.length>0){const t=e.track;e.track.trackList.forEach(n=>{t.removeAudioTrack(n)})}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.localDataChannels=[],this.remoteDataChannelMap.clear(),this.pendingLocalDataChannels=[],this.pendingRemoteDataChannels=[],this.state=Kt.Disconnected}getStats(){var e;return(e=this.connection)===null||e===void 0?void 0:e.getStats()}getRemoteVideoIsReady(e){var t;return((t=this.connection)===null||t===void 0?void 0:t.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){const e=this.localTrackMap.get(ge.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){const e=this.localTrackMap.get(ge.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}}getEncoderConfig(e){const t=this.localTrackMap.get(e);return t&&t.track instanceof on||t&&t.track instanceof Mn?t.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,t){if(!e)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}async hasRemoteMediaWithLock(e,t){if(!e)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}getRemoteMedia(e){var t;const n=Array.from(ms(t=this.remoteUserMap).call(t)).find(i=>i.uid===e);return n?{audioTrack:n.audioTrack,audioSSRC:n._audioSSRC,videoTrack:n.videoTrack,videoSSRC:n._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map(n=>{let[i]=n;return{uid:i.uid,level:i.audioTrack?100*i.audioTrack._source.getAccurateVolumeLevel():0}});const t=this.localTrackMap.get(ge.LocalAudioTrack);return t&&e.push({level:100*t.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=Ad(e).call(e,(n,i)=>n.level-i.level),e}async disconnectForReconnect(){this.connection&&(S.debug("[".concat(this.store.clientId,"] P2PChannel.disconnectForReconnect closing P2PConnection")),this.state=Kt.Reconnecting,L("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t]=e;var n;t._videoTrack&&t._videoTrack._player&&((n=t._videoTrack._player.getVideoElement())===null||n===void 0||n.pause(),t._videoTrack._player.isKeepLastFrame=!0,t._videoTrack._originMediaStreamTrack.stop())}),this.resetConnection(this.connection),this.connection=void 0,this.shouldForwardP2PCreation&&(this.connection=Mm(this.store),this.emit(Ve.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(e=>{var t;let[n,{track:i}]=e;switch(n){case ge.LocalVideoTrack:me(t=i._hints).call(t,Wt.LOW_STREAM)?i.close():this.pendingLocalTracks.push(i);break;case ge.LocalAudioTrack:i instanceof dr?this.pendingLocalTracks=this.pendingLocalTracks.concat(i.trackList):this.pendingLocalTracks.push(i);case ge.LocalVideoLowTrack:}}),this.emit(Ve.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,n]=e;Array.from(ms(n).call(n)).forEach(i=>{this.setPendingRemoteMedia(t,i)}),this.emit(Ve.MediaReconnectStart,t.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.localDataChannels.length!==0&&(this.localDataChannels.forEach(e=>{this.pendingLocalDataChannels.push(e)}),this.localDataChannels.length=0),this.remoteDataChannelMap.size!==0&&(Array.from(this.remoteDataChannelMap.entries()).forEach(e=>{let[t,n]=e;Array.from(ms(n).call(n)).forEach(i=>{this.setPendingRemoteDataChannel(t,i)})}),this.remoteDataChannelMap.clear()),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),S.debug("[".concat(this.store.clientId,"] P2PChannel disconnected, waiting to reconnect.")))}hasPendingRemoteDataChannel(e,t){for(const n of this.pendingRemoteDataChannels){const{user:i,id:o}=n;if((e instanceof $l?e.uid:e)===i.uid&&o===t)return!0}return!1}setPendingRemoteDataChannel(e,t){this.hasPendingRemoteDataChannel(e,t)||this.pendingRemoteDataChannels.push({user:e,id:t})}hasPendingRemoteMedia(e,t){for(const n of this.pendingRemoteTracks){const{user:i,kind:o}=n;if((e instanceof $l?e.uid:e)===i.uid&&t===o)return!0}return!1}setPendingRemoteMedia(e,t){this.hasPendingRemoteMedia(e,t)||this.pendingRemoteTracks.push({user:e,kind:t})}restartICE(e){var t=this;return qs(function*(){if(!t.connection||t.state!==Kt.Connected)return;const n=yield ft(t.mutex.lock("From P2PChannel.restartICE"));let i;try{i=yield ft(t.connection.restartICE(e));const l=yield ft(i.next());if(l.done)return;const d=l.value,h=yield d;switch(_I(t.connection)&&t.reportPCStats(Date.now(),!1,t._pcStatsUploadType),e){case Ur.UDP_TCP_RELAY:t._pcStatsUploadType=Xc.UDP_TCP_RESTART;break;case Ur.TCP_RELAY:t._pcStatsUploadType=Xc.TCP_RESTART;break;case Ur.RELAY:t._pcStatsUploadType=Xc.RELAY_RESTART;break;default:t._pcStatsUploadType=Xc.OLD_RESTART}t._isTryConnecting=!0,i.next(h)}catch(l){var o;(o=i)===null||o===void 0||o.throw(l)}finally{n()}})()}getUplinkNetworkQuality(){if(!this.connection)return 0;const e=this.connection.getStats(),t=this.localTrackMap.get(ge.LocalVideoTrack),n=this.localTrackMap.get(ge.LocalAudioTrack),i=e.videoSend.find(b=>b.ssrc===(t==null?void 0:t.ssrcs[0].ssrcId)),o=e.audioSend.find(b=>b.ssrc===(n==null?void 0:n.ssrcs[0].ssrcId));if(!i||!o)return 1;const l=Ni(this,Ve.NeedSignalRTT),d=i?i.rttMs:void 0,h=o?o.rttMs:void 0,f=d&&h?(d+h)/2:d||h,g=(f&&l?(f+l)/2:f||l)||0,_=100*e.sendPacketLossRate*.7/50+.3*g/1500,v=_<.17?1:_<.36?2:_<.59?3:_<.1?4:5,y=t==null?void 0:t.track;if(y&&y._encoderConfig&&y._hints.indexOf(Wt.SCREEN_TRACK)===-1){const b=y._encoderConfig.bitrateMax,D=e.bitrate.actualEncoded;if(b&&D){const I=(1e3*b-D)/(1e3*b);return W4[I<.15?0:I<.3?1:I<.45?2:I<.6?3:4][v]}}return v}getDownlinkNetworkQuality(){if(!this.connection)return 0;const e=this.connection.getStats();let t=0;return Array.from(this.remoteUserMap.entries()).forEach(n=>{let[i]=n;const o=i._audioSSRC,l=i._videoSSRC,d=e.audioRecv.find(D=>D.ssrc===o),h=e.videoRecv.find(D=>D.ssrc===l);if(!d&&!h)return void(t+=1);const f=Ni(this,Ve.NeedSignalRTT),g=e.rtt,_=(g&&f?(g+f)/2:g||f)||0,v=d?d.jitterMs:void 0,y=e.recvPacketLossRate;let b=.7*y*100/50+.3*_/1500;v&&(b=.6*y*100/50+.2*_/1500+.2*v/400),t+=b<.1?1:b<.17?2:b<.36?3:b<.59?4:5}),this.remoteUserMap.size>0?Math.round(t/this.remoteUserMap.size):t}async muteLocalTrack(e){return new be((t,n)=>{this.handleMuteLocalTrack(e,t,n)})}async replaceTrack(e,t){var n;if(S.debug("[".concat(this.store.clientId,"] P2PChannel replaceTrack from [").concat(e.getTrackId(),"] to [").concat(t.getTrackId(),"]")),!this.connection||this.state!==Kt.Connected)return;const i=Array.from(this.localTrackMap.entries()).find(l=>{let[,{track:d}]=l;return e===d});if(!i)return;const o=i[0];if(e!==t&&(this.unbindLocalTrackEvents([{track:e,type:o}]),this.bindLocalTrackEvents([{track:t,type:o}]),i[1].track=t),await((n=this.connection)===null||n===void 0?void 0:n.replaceTrack(t,i[1].id)),this.isPlanB){const l=i[1];l.id=t._mediaStreamTrack.id,this.localTrackMap.set(o,l)}if(o===ge.LocalVideoTrack&&!L("DISABLE_DUAL_STREAM_USE_ENCODING")&&wt().supportDualStreamEncoding){const l=this.localTrackMap.get(ge.LocalVideoLowTrack);if(l){const d=e._mediaStreamTrack.clone();l.track._originMediaStreamTrack.stop(),l.track._mediaStreamTrack=d,l.track._originMediaStreamTrack=d,await new be((h,f)=>{this.handleReplaceTrack(l.track,h,f,!0)})}}}filterTobePublishedTracks(e,t,n){const i=[],o=this.getAllTracks();e=Th(e=e.filter(f=>o.indexOf(f)===-1));let l,d=!1;const h=this.localTrackMap.get(ge.LocalAudioTrack);for(const f of e){if(f instanceof on&&(this.localTrackMap.has(ge.LocalVideoTrack)||d?new ae(P.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(i.push({track:f,type:ge.LocalVideoTrack}),d=!0),t)){const g=this.getLowVideoTrack(f,n);i.push({track:g,type:ge.LocalVideoLowTrack})}if(f instanceof Mn)if(h){const g=h.track;if(g instanceof dr)mI([f]),g.addAudioTrack(f),this.bindLocalAudioTrackEvents(f,!0);else{const _=gI([g,f]);S.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(_.getTrackId(),"]")),this.replaceTrack(g,_)}}else l instanceof dr?(mI([f]),l.addAudioTrack(f)):l||!f._useAudioElement&&wt().webAudioMediaStreamDest&&!f._bypassWebAudio?l=gI(l?[f,l]:[f]):l=f}return l&&(S.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will send audioTrack [").concat(l.getTrackId(),"]")),i.push({track:l,type:ge.LocalAudioTrack})),i}filterTobeUnpublishedTracks(e){const t=[],n=this.getAllTracks();e=Th(e=e.filter(i=>n.indexOf(i)!==-1));for(const i of e){if(i instanceof Mn){const o=this.localTrackMap.get(ge.LocalAudioTrack);if(!o)continue;o.track instanceof dr?(o.track.removeAudioTrack(i),this.unbindLocalAudioTrackEvents(i),o.track.trackList.length===0&&(t.push([ge.LocalAudioTrack,o]),o.track.close())):t.push([ge.LocalAudioTrack,o])}if(i instanceof on){const o=this.localTrackMap.get(ge.LocalVideoTrack);if(!o)continue;t.push([ge.LocalVideoTrack,o]);const l=this.localTrackMap.get(ge.LocalVideoLowTrack);l&&t.push([ge.LocalVideoLowTrack,l])}}return t}filterTobePublishedDataChannels(e){return e=(e=Th(e)).filter(t=>this.localDataChannels.findIndex(n=>n.id===t.id)===-1)}filterTobeUnpublishedDataChannels(e){return e=(e=(e=Th(e)).filter(t=>this.localDataChannels.indexOf(t)!==-1)).filter(t=>t._originDataChannel)}bindLocalTrackEvents(e){e.forEach(t=>{let{track:n,type:i}=t;switch(i){case ge.LocalVideoTrack:n.addListener(Le.GET_STATS,this.handleGetLocalVideoStats),n.addListener(Le.GET_RTC_STATS,this.handleGetRTCStats),n.addListener(Le.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(Le.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(Le.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.addListener(Le.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.addListener(Le.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.addListener(Le.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(Le.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case ge.LocalAudioTrack:this.bindLocalAudioTrackEvents(n);case ge.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(e,t){e instanceof dr?e.trackList.forEach(n=>{n.addListener(Le.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(Le.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(Le.GET_STATS,this.handleGetLocalAudioStats),n.addListener(Le.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(Le.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.addListener(Le.GET_STATS,this.handleGetLocalAudioStats),e.addListener(Le.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(Le.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(Le.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(Le.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),t||(e.addListener(Le.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.addListener(Le.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack)))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map(t=>{let[n,{track:i}]=t;return{track:i,type:n}})),e.forEach(t=>{let{track:n,type:i}=t;switch(i){case ge.LocalVideoTrack:n.off(Le.GET_STATS,this.handleGetLocalVideoStats),n.off(Le.GET_RTC_STATS,this.handleGetRTCStats),n.off(Le.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.off(Le.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.off(Le.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.off(Le.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.off(Le.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.off(Le.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.off(Le.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case ge.LocalAudioTrack:this.unbindLocalAudioTrackEvents(n);case ge.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(e){e instanceof dr?e.trackList.forEach(t=>{t.off(Le.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(Le.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(Le.GET_STATS,this.handleGetLocalAudioStats),t.off(Le.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(Le.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.off(Le.GET_STATS,this.handleGetLocalAudioStats),e.off(Le.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(Le.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(Le.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(Le.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack),e.off(Le.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(Le.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,t){t instanceof Fh&&t.addListener(Le.GET_STATS,n=>{n(this.handleGetRemoteVideoStats(e))}),t instanceof jh&&t.addListener(Le.GET_STATS,n=>{n(this.handleGetRemoteAudioStats(e))})}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(Le.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,n]=e;n.has(xe.AUDIO)&&this.unbindRemoteTrackEvents(t._audioTrack),n.has(xe.VIDEO)&&this.unbindRemoteTrackEvents(t._videoTrack)})}createGatewayPublishMessage(e,t){return e.map((n,i)=>{var o;let l,d,{track:h,type:f}=n;switch(f){case ge.LocalAudioTrack:l=Xt.Audio,d={dtx:h instanceof Tm&&h._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case ge.LocalVideoTrack:l=me(o=h._hints).call(o,Wt.SCREEN_TRACK)?Xt.Screen:Xt.High,d=yc(yc({},oV(h)),{},{codec:this.store.codec,svc_mode:Om()});break;case ge.LocalVideoLowTrack:l=Xt.Low,d=yc(yc({},oV(h)),{},{codec:this.store.codec,svc_mode:Om()})}return{stream_type:l,attributes:d,ssrcs:t[i]}})}createGatewayUnpublishMessage(e){return e.map(t=>{var n;let i,[o,{track:l,ssrcs:d,id:h}]=t;switch(o){case ge.LocalVideoTrack:i=me(n=l._hints).call(n,Wt.SCREEN_TRACK)?Xt.Screen:Xt.High;break;case ge.LocalAudioTrack:i=Xt.Audio;break;case ge.LocalVideoLowTrack:i=Xt.Low}return{stream_type:i,ssrcs:d,mid:h}})}assignLocalTracks(e,t){e.forEach((n,i)=>{let{track:o,type:l}=n;this.localTrackMap.set(l,{track:o,id:t[i].id,ssrcs:t[i].localSSRC})})}withdrawLocalTracks(e){e.forEach(t=>{let[n]=t;this.localTrackMap.delete(n)})}bindConnectionEvents(e){e.onConnectionStateChange=async t=>{if(S.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(t,")")),this.emit(Ve.PeerConnectionStateChange,t),t==="connecting"&&e instanceof zi&&!gn()&&L("FIRST_TCP_CANDIDATE")&&window.setTimeout(()=>{t==="connecting"&&e.extendCandidate()},L("FIRST_TCP_CANDIDATE_INTERVAL")),t!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),t==="connected"&&(this._restartTimer&&(window.clearTimeout(this._restartTimer),this._restartTimer=void 0),e instanceof zi&&rQ(e,!0),this._isTryConnecting&&this.reportPCStats(Date.now(),!0,this._pcStatsUploadType),this._isTryConnecting=!1,this._isStartRestartIce=!1,this._pcStatsUploadType=Xc.DISCONNECTED_OR_FAILED,Ni(this,Ve.QueryClientConnectionState)==="CONNECTED"&&this._isWaitPcToRePub)){const n=this.pendingLocalTracks.map(o=>o.getTrackId()),i=this.pendingLocalDataChannels.map(o=>"dc_".concat(o.id));ke.reportApiInvoke(this.store.sessionId,{name:yn.REPUB_AFTER_PC_CONNECTED,options:n.concat(i),tag:an.TRACER}).onSuccess(),this.republish()}if(L("NEW_ICE_RESTART")&&e instanceof zi&&!gn()&&!this._forceTurn&&!this.store.useDcSignal){if(me(tV).call(tV,t)){if(this._isStartRestartIce)return;this._isStartRestartIce=!0;const n=o=>{_I(e)&&(S.debug("[".concat(this.store.clientId,"] [P2PChannel] try to restartICE, type is ").concat(o)),Ni(this,Ve.QueryClientConnectionState)==="CONNECTED"&&this.emit(Ve.RequestRestartICE,o))},i=()=>{_I(e)&&(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),S.debug("[".concat(this.store.clientId,"] P2PConnection disconnected timeout, force reconnect")),setTimeout(()=>this.emit(Ve.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())};return void(this._restartTimer=window.setTimeout(()=>{sQ(e,n,i)},800))}}else{if(t==="disconnected"&&e.iceConnectionState==="disconnected")return setTimeout(()=>{e.iceConnectionState==="disconnected"&&L("ICE_RESTART")&&Ni(this,Ve.QueryClientConnectionState)==="CONNECTED"&&this.emit(Ve.RequestRestartICE)},800),void setTimeout(()=>{e.peerConnectionState==="disconnected"&&(S.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection disconnected timeout 4000ms, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isTryConnecting=!1,setTimeout(()=>this.emit(Ve.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())},4e3);t==="failed"&&(S.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection state failed, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),setTimeout(()=>this.emit(Ve.P2PLost),0),this.iceFailedCount+=1,await this.requestReconnect())}},e.onICEConnectionStateChange=t=>{t!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),S.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(t,")")),ke.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:t,tag:an.TRACER}).onSuccess(),this.emit(Ve.IceConnectionStateChange,t)},e.onICETransportStateChange=t=>{S.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(t,")"))},e.onDTLSTransportStateChange=t=>{S.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(t,")"))},e.onDTLSTransportError=t=>{S.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(t,")"))},e.onFirstAudioDecoded=t=>{var n;const i=Array.from(ms(n=this.remoteUserMap).call(n)).find(l=>l._audioSSRC===t);var o;i&&(this.store.subscribe(i.uid,"audio",void 0,void 0,void 0,Date.now()),(o=i.audioTrack)===null||o===void 0||o.emit(ua.FIRST_FRAME_DECODED),ke.firstRemoteFrame(this.store.sessionId,Ar.FIRST_AUDIO_DECODE,wn.FIRST_AUDIO_DECODE,{peer:i._uintid,subscribeElapse:os.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=t=>{var n;const i=Array.from(ms(n=this.remoteUserMap).call(n)).find(o=>o._audioSSRC===t);i&&ke.firstRemoteFrame(this.store.sessionId,Ar.FIRST_AUDIO_RECEIVED,wn.FIRST_AUDIO_RECEIVED,{peer:i._uintid,subscribeElapse:os.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(t,n,i)=>{var o;const l=Array.from(ms(o=this.remoteUserMap).call(o)).find(d=>d._videoSSRC===t);l&&this.store.firstVideoFrameDecoded(l.uid,{firstDecoded:Date.now()}),this.reportVideoFirstFrameDecoded(t,n,i)},e.onFirstVideoRender=t=>{var n;const i=Array.from(ms(n=this.remoteUserMap).call(n)).find(o=>o._videoSSRC===t);i&&(this.store.firstVideoFrameDecoded(i.uid,{firstPreRender:Date.now()}),this.reportVideoFirstFrameRender(i),this.emit(Ve.FirstVideoPreRender,i.uid,t))},e.onFirstVideoReceived=t=>{var n;const i=Array.from(ms(n=this.remoteUserMap).call(n)).find(o=>o._videoSSRC===t);i&&(this.store.firstVideoFrameDecoded(i.uid,{firstReceived:Date.now()}),ke.firstRemoteFrame(this.store.sessionId,Ar.FIRST_VIDEO_RECEIVED,wn.FIRST_VIDEO_RECEIVED,{peer:i._uintid,subscribeElapse:os.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId}))},e.onFirstVideoBufferReady=t=>{var n;const i=Array.from(ms(n=this.remoteUserMap).call(n)).find(o=>o._videoSSRC===t);i&&this.emit(Ve.FirstVideoBufferReady,i.uid,t)},e.onSelectedLocalCandidateChanged=(t,n)=>{const i=t.candidateType==="relay",o=n.candidateType==="relay";n.candidateType!=="unknown"&&i===o||this.emit(Ve.ConnectionTypeChange,i),S.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(Xl(n))," -> ").concat(JSON.stringify(Xl(t)),")"))},e.onSelectedRemoteCandidateChanged=(t,n)=>{S.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(Xl(n))," -> ").concat(JSON.stringify(Xl(t)),")"))},e.onFirstVideoDecodedTimeout=t=>{this.reportVideoFirstFrameDecoded(t,void 0,void 0,!0)},e.getLocalVideoStats=()=>{const t=this.statsCollector.getLocalVideoTrackStats(),n=this.statsCollector.getRTCStats();return yc(yc({},t),n)},e.onICECandidateError=t=>{this._iceError=t}}fallbackConnection(){S.debug("[".concat(this.store.clientId,"] [P2PChannel] try to fallback connection")),this.state===Kt.Connected?(S.debug("[".concat(this.store.clientId,"] [P2PChannel] fallback to websocket but P2PChannel state still connected, disconnect first")),this.disconnectForReconnect()):(this.connection&&this.resetConnection(this.connection),this.shouldForwardP2PCreation&&(this.connection=Mm(this.store),this.emit(Ve.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)))}resetConnection(e){e instanceof zi&&function(t){ep.delete(t.id),rQ(t)}(e),e.close(),this.emit(Ve.PeerConnectionStateChange,"closed"),function(t){t.onConnectionStateChange=void 0,t.onICEConnectionStateChange=void 0,t.onICETransportStateChange=void 0,t.onDTLSTransportStateChange=void 0,t.onDTLSTransportError=void 0,t.onFirstAudioDecoded=void 0,t.onFirstAudioReceived=void 0,t.onFirstVideoDecoded=void 0,t.onFirstVideoReceived=void 0,t.onSelectedLocalCandidateChanged=void 0,t.onSelectedRemoteCandidateChanged=void 0,t.onFirstVideoDecodedTimeout=void 0,t.getLocalVideoStats=void 0}(e),this._isWaitPcToRePub=!1}filterTobeMutedTracks(e){const t=[];if(this.getAllTracks().indexOf(e)===-1)return t;const n=this.localTrackMap.get(ge.LocalAudioTrack);if(e instanceof Mn&&(n==null?void 0:n.track)instanceof dr)return n.track.isActive||t.push([ge.LocalAudioTrack,n]),t;const i=Array.from(this.localTrackMap.entries()).find(o=>{let[,{track:l}]=o;return e===l});if(i&&(t.push(i),i[0]===ge.LocalVideoTrack)){const o=this.localTrackMap.get(ge.LocalVideoLowTrack);o&&t.push([ge.LocalVideoLowTrack,o])}return t}filterTobeUnmutedTracks(e){const t=[],n=this.localTrackMap.get(ge.LocalAudioTrack);if(e instanceof Mn&&(n==null?void 0:n.track)instanceof dr)return n.track.isActive&&t.push([ge.LocalAudioTrack,n]),t;const i=Array.from(this.localTrackMap.entries()).find(o=>{let[,{track:l}]=o;return e===l});if(i)if(i[0]===ge.LocalVideoTrack){t.push(i);const o=this.localTrackMap.get(ge.LocalVideoLowTrack);o&&t.push([ge.LocalVideoLowTrack,o])}else t.push(i);return t}createMuteMessage(e){return e.map(t=>{var n;let i,[o,{track:l,ssrcs:d,id:h}]=t;switch(o){case ge.LocalAudioTrack:i=Xt.Audio;break;case ge.LocalVideoTrack:i=me(n=l._hints).call(n,Wt.SCREEN_TRACK)?Xt.Screen:Xt.High;break;case ge.LocalVideoLowTrack:i=Xt.Low}return{stream_type:i,ssrcs:d,mid:h}})}createUnmuteMessage(e){return e.map(t=>{var n;let i,[o,{track:l,ssrcs:d,id:h}]=t;switch(o){case ge.LocalAudioTrack:i=Xt.Audio;break;case ge.LocalVideoTrack:i=me(n=l._hints).call(n,Wt.SCREEN_TRACK)?Xt.Screen:Xt.High;break;case ge.LocalVideoLowTrack:i=Xt.Low}return{stream_type:i,ssrcs:d,mid:h}})}filterTobeUnSubscribedTracks(e,t){const n=[],i=this.remoteUserMap.get(e);if(!i)return n;if(t){const o=i.get(t);if(!o)return n;n.push([e,{kind:t,id:o}])}else Array.from(i.entries()).forEach(o=>{let[l,d]=o;n.push([e,{kind:l,id:d}])});return n}filterTobeUnSubscribedDataChannels(e,t){const n=[];return t.forEach(i=>{var o;(o=this.remoteDataChannelMap.get(e))!==null&&o!==void 0&&o.has(i.id)&&n.push(i)}),n}createUnsubscribeMessage(e){const t=[];return e.forEach(n=>{let[i,{kind:o,id:l}]=n;switch(o){case xe.VIDEO:return void(i._videoSSRC&&t.push({stream_type:xe.VIDEO,ssrcId:i._videoSSRC}));case xe.AUDIO:return void(i._audioSSRC&&t.push({stream_type:xe.AUDIO,ssrcId:i._audioSSRC}))}}),t}createUnsubscribeAllMessage(e){const t=new Map;return e.forEach(n=>{let[i,{kind:o}]=n;if(t.has(i)){let l=t.get(i);o===xe.VIDEO?l|=Tr.Video:l|=Tr.Audio,t.set(i,l)}else o===xe.VIDEO?t.set(i,Tr.Video):t.set(i,Tr.Audio)}),{users:Array.from(t.entries()).map(n=>{let[i,o]=n;return{stream_id:i.uid,stream_type:o}})}}withdrawRemoteTracks(e){e.forEach(t=>{let[n,{kind:i}]=t;const o=this.remoteUserMap.get(n);o&&(o.delete(i),Array.from(o.entries()).length===0&&this.remoteUserMap.delete(n))})}async updateBitrateLimit(e){const t=this.localTrackMap.get(ge.LocalVideoTrack),n=this.localTrackMap.get(ge.LocalVideoLowTrack);t&&(await t.track.setBitrateLimit(e.uplink),await new be((i,o)=>{this.handleUpdateVideoEncoder(t.track,i,o,!0)})),n&&e.low_stream_uplink&&(await n.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0}),await new be((i,o)=>{this.handleUpdateVideoEncoder(n.track,i,o,!0)}))}isP2PDisconnected(){return this.connection?this.connection.peerConnectionState!=="connected":!0}isPreallocation(){return!(!this.connection||!("name"in this.connection)||this.connection.name!=="DataChannelConnection"||this.connection.peerConnectionState==="closed")||this.connection instanceof zi&&this.connection.isPreallocation}isPreSub(){return(this.connection&&"name"in this.connection&&this.connection.name==="DataChannelConnection"&&this.connection.peerConnectionState!=="closed"||this.connection instanceof zi)&&this.connection.isPreSub()}isPreRender(){return this.connection instanceof zi&&this.connection.isPreRender}mapPubResToRemoteConfig(e,t,n){return e.map((i,o)=>{var l;let{stream_type:d}=i;const h=(l=t.find(f=>{let{stream_type:g}=f;return d===g}))===null||l===void 0?void 0:l.attributes;if(h&&L("DISABLE_SCREEN_SHARE_REMB")){const f=n[o]._hints;(me(f).call(f,Wt.SCREEN_TRACK)||me(f).call(f,Wt.SCREEN_LOW_TRACK))&&(h.remb=!1,S.debug("disable remb for screen share, hints:",f))}return h})}async tryToUnmuteAudio(e){for(let n=0;n<e.length;n++)if(e[n]instanceof Mn){var t;const i=this.filterTobeUnmutedTracks(e[n]);if(i.length===0)continue;await((t=this.connection)===null||t===void 0?void 0:t.unmuteLocal(i.map(l=>{let[,{id:d}]=l;return d})));const o=this.createUnmuteMessage(i);return void await ln(this,Ve.RequestUnmuteLocal,o)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=()=>this.getStats(),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var t;return!((t=this.connection)===null||t===void 0||!t.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,t)=>this.emit(Ve.RequestUpload,e,t),this.statsUploader.requestUploadStats=e=>this.emit(Ve.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks(),this.statsUploader.requestTransportStats=()=>{var e;return{connectState:((e=this.connection)===null||e===void 0?void 0:e.peerConnectionState)||"closed"}}}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await Sr(wv(this.dtlsFailedCount,qn)),this.emit(Ve.RequestReconnect)}async reconnectP2P(){const e=Array.from(this.localTrackMap.entries()),t=this.createGatewayUnpublishMessage(e);Array.from(this.remoteUserMap.entries()),t.length>0&&await ir(this,Ve.RequestUnpublishForReconnectPC,t),this.disconnectForReconnect(),this.emit(Ve.RequestReconnectPC)}canPublishLowStream(){return this.localTrackMap.has(ge.LocalVideoTrack)||this.pendingLocalTracks.some(e=>e instanceof on)}throwIfTrackTypeNotMatch(e){if(e.filter(t=>t instanceof on).length>1)throw new ae(P.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter(t=>t instanceof Mn).length>1&&(e.some(t=>t instanceof Mn&&t._bypassWebAudio)||!wt().webAudioMediaStreamDest))throw new ae(P.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const t of e){if(t instanceof on&&this.pendingLocalTracks.some(n=>n instanceof on))throw new ae(P.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t instanceof Mn&&this.pendingLocalTracks.some(n=>n instanceof Mn)&&(!wt().webAudioMediaStreamDest||t._bypassWebAudio||this.pendingLocalTracks.some(n=>n instanceof Mn&&n._bypassWebAudio)))throw new ae(P.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,t){var n;const i=!L("DISABLE_DUAL_STREAM_USE_ENCODING")&&wt().supportDualStreamEncoding,o=yc(yc({},{width:160,height:120,framerate:15,bitrate:50}),t);let l;l=i?e._mediaStreamTrack.clone():vI(e,o);const d=zt(8,"track-low-"),h=new on(l,yc(yc({},i&&{scaleResolutionDownBy:XR(o,e)}),{},{frameRate:o.framerate,bitrateMax:o.bitrate,bitrateMin:o.bitrate}),void 0,void 0,d);return h.on(Od.TRANSCEIVER_UPDATED,f=>{e._updateRtpTransceiver(f,Bh.LOW_STREAM)}),h._hints.push(Wt.LOW_STREAM),me(n=e._hints).call(n,Wt.SCREEN_TRACK)&&h._hints.push(Wt.SCREEN_LOW_TRACK),e.on("sei-to-send",f=>{h.emit("sei-to-send",f)}),e.addListener(Le.NEED_CLOSE,()=>{h.close()}),h}async globalLock(){return this.mutex.lock("From P2PChannel.globalLock")}async reportPCStats(e,t,n){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(this.connection&&this.connection instanceof zi){var o,l,d,h;const f=this.store.keyMetrics.descriptionStart||0,{iceConnectionState:g,dtlsTransportState:_,peerConnectionState:v}=this.connection,{local:y,remote:b}=await this.connection.getSelectedCandidatePair();ke.pcStats(this.store.sessionId,{startTime:f,eventElapse:e-f||0,iceconnectionsate:g,dtlsstate:_,connectionstate:v,intSucc:t?1:2,error:this._iceError||i||"",selectedLocalCandidateProtocol:(o=y==null?void 0:y.protocol)!==null&&o!==void 0?o:"",selectedLocalCandidateType:(l=y.candidateType)!==null&&l!==void 0?l:"",selectedLocalCandidateAddress:"".concat(y.address,":").concat(y.port),selectedRemoteCandidateProtocol:(d=b.protocol)!==null&&d!==void 0?d:"",selectedRemoteCandidateType:(h=b.candidateType)!==null&&h!==void 0?h:"",selectedRemoteCandidateAddress:"".concat(b.address,":").concat(b.port),restartCnt:n,preallocation:this.connection.isPreallocation}),this._iceError=null}}reportVideoFirstFrameRender(e){const t=this.store.keyMetrics,n=t.firstVideoFrameDecoded.find(_=>_.userId===e.uid);if(!n)return;const{isInternalUpload:i,isExternalUpload:o}=n;if(i&&o)return;const{subscribeEnd:l,firstPreRender:d,peerPublishDuration:h,peerPubStatusMs:f}=n;let{firstRender:g=0}=n;if(l&&(g||d)&&h&&f){n.isInternalUpload=!0;const{playEnd:_}=n;_&&(n.isExternalUpload=!0);const{firstPreRender:v=0}=n;g=v||g;const y=e.videoTrack,b={peer:e._uintid,width:(y==null?void 0:y._videoWidth)||0,height:(y==null?void 0:y._videoHeight)||0,ssrc:e._videoSSRC||0,p2pid:this.store.p2pId,peerPublishDuration:h,peerPubStatusMs:f,joinChannelStart:t.joinStart||0,preloadStart:t.preloadStart||0,preloadEnd:t.preloadEnd||0,apStart:t.requestAPStart||0,apEnd:t.requestAPEnd||0,suaEnd:t.requestSUAEnd||0,beforeConnect:t.beforeConnect||0,peerReceiver:t.peerReceiver||0,ice:t.iceConnectionEnd||0,pc:t.peerConnectionEnd||0,signalConnected:t.signalConnected||0,joinReq:t.joinReq||0,joinRes:t.joinRep||0,userJoinNotify:n.userJoinNotify||0,videoAddNotify:n.videoAddNotify||0,subscribeStart:n.subscribeStart||0,subscribeEnd:n.subscribeEnd||0,firstReceived:n.firstReceived||0,firstDecoded:n.firstDecoded||0,firstPreRender:v||0,firstRender:_?Math.max(g,_):Math.max(g,l),playStart:n.playStart||0,playEnd:n.playEnd||0,isPreSub:!(!e._videoSSRC||!this.isPreSubScribe(e._videoSSRC)),isPrePc:this.isPreallocation(),isPreInstantVideo:RF(this.store),firstReceivedEncodedFrame:n.firstReceivedEncodedFrame||0,frameType:n.frameType||"",rtpTimestamp:n.rtpTimestamp||0,framePayloadType:n.framePayloadType||0,frameDataLength:n.frameDataLength||0,mimeType:n.mimeType||""};ke.firstXLAPeerFirstVideoFrame(this.store.sessionId,b)}}reportVideoFirstFrameDecoded(e,t,n,i){var o;const l=Array.from(ms(o=this.remoteUserMap).call(o)).find(d=>d._videoSSRC===e);if(l){i||this.store.subscribe(l.uid,"video",void 0,void 0,void 0,void 0,Date.now());const d=this.store.keyMetrics,h=d.subscribe.find(f=>f.userId===l.uid&&f.type==="video");ke.firstRemoteVideoDecode(this.store.sessionId,Ar.FIRST_VIDEO_DECODE,wn.FIRST_VIDEO_DECODE,{peer:l._uintid,videowidth:t,videoheight:n,subscribeElapse:os.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:d.requestAPEnd||0,apStart:d.requestAPStart||0,joinGwEnd:d.joinGatewayEnd||0,joinGwStart:d.joinGatewayStart||0,pcEnd:d.peerConnectionEnd||0,pcStart:d.peerConnectionStart||0,subscriberEnd:(h==null?void 0:h.subscribeEnd)||0,subscriberStart:(h==null?void 0:h.subscribeStart)||0,videoAddNotify:(h==null?void 0:h.streamAdded)||0,state:i?1:0,firstFrame:(h==null?void 0:h.firstFrame)||0})}}async remoteMediaSsrcChanged(e,t,n){if(!this.connection)return!1;const i=this.remoteUserMap.get(e);if(!i)return!1;const o=i.get(t);if(!o)return!1;const l=await this.connection.getRemoteSSRC(o);return l!==void 0&&l!==n}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(e=>{let[t,{track:n}]=e;t===ge.LocalVideoLowTrack?n._updateRtpTransceiver(void 0,Bh.LOW_STREAM):n._updateRtpTransceiver(void 0)})}},Ce(St.prototype,"startP2PConnection",[Rs],Object.getOwnPropertyDescriptor(St.prototype,"startP2PConnection"),St.prototype),Ce(St.prototype,"connect",[Rs],Object.getOwnPropertyDescriptor(St.prototype,"connect"),St.prototype),Ce(St.prototype,"updateRemoteRTPCapabilities",[Rs],Object.getOwnPropertyDescriptor(St.prototype,"updateRemoteRTPCapabilities"),St.prototype),Ce(St.prototype,"publishDataChannel",[Rs],Object.getOwnPropertyDescriptor(St.prototype,"publishDataChannel"),St.prototype),Ce(St.prototype,"unpublish",[Rs],Object.getOwnPropertyDescriptor(St.prototype,"unpublish"),St.prototype),Ce(St.prototype,"unpublishDataChannel",[Rs],Object.getOwnPropertyDescriptor(St.prototype,"unpublishDataChannel"),St.prototype),Ce(St.prototype,"unpublishLowStream",[Rs],Object.getOwnPropertyDescriptor(St.prototype,"unpublishLowStream"),St.prototype),Ce(St.prototype,"subscribeDataChannel",[Rs],Object.getOwnPropertyDescriptor(St.prototype,"subscribeDataChannel"),St.prototype),Ce(St.prototype,"subscribe",[Rs],Object.getOwnPropertyDescriptor(St.prototype,"subscribe"),St.prototype),Ce(St.prototype,"massSubscribe",[Rs],Object.getOwnPropertyDescriptor(St.prototype,"massSubscribe"),St.prototype),Ce(St.prototype,"unsubscribe",[Rs],Object.getOwnPropertyDescriptor(St.prototype,"unsubscribe"),St.prototype),Ce(St.prototype,"unsubscribeDataChannel",[Rs],Object.getOwnPropertyDescriptor(St.prototype,"unsubscribeDataChannel"),St.prototype),Ce(St.prototype,"massUnsubscribe",[Rs],Object.getOwnPropertyDescriptor(St.prototype,"massUnsubscribe"),St.prototype),Ce(St.prototype,"muteRemote",[Rs],Object.getOwnPropertyDescriptor(St.prototype,"muteRemote"),St.prototype),Ce(St.prototype,"unmuteRemote",[Rs],Object.getOwnPropertyDescriptor(St.prototype,"unmuteRemote"),St.prototype),Ce(St.prototype,"hasRemoteMediaWithLock",[Rs],Object.getOwnPropertyDescriptor(St.prototype,"hasRemoteMediaWithLock"),St.prototype),Ce(St.prototype,"disconnectForReconnect",[Rs],Object.getOwnPropertyDescriptor(St.prototype,"disconnectForReconnect"),St.prototype),Ce(St.prototype,"updateBitrateLimit",[Rs],Object.getOwnPropertyDescriptor(St.prototype,"updateBitrateLimit"),St.prototype),Ce(St.prototype,"remoteMediaSsrcChanged",[Rs],Object.getOwnPropertyDescriptor(St.prototype,"remoteMediaSsrcChanged"),St.prototype),St);function Rs(e,t,n){const i=e[t];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const o=this.mutex,l=await o.lock("From P2PChannel.".concat(t));try{for(var d=arguments.length,h=new Array(d),f=0;f<d;f++)h[f]=arguments[f];return await i.apply(this,h)}finally{l()}},n}function oQ(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}function cQ(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?oQ(Object(n),!0).forEach(function(i){x(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):oQ(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}const EAe=Date.now(),vAe=20,bI=new Map,_0=new Map;async function lQ(e){const t=bI.get(e),n=Array.isArray(t)&&t[t.length-1],i=_0.get(e);if(!n)return void(i.isSyncing=!1);const o={uid:n.uid,payload:n.payload};i.firstRecvTs===0&&(i.firstRecvTs=n.recvTs,i.firstSendTs=n.sendTs);const l=n.sendTs-i.firstSendTs,d=l-(Date.now()-i.firstRecvTs);d>0&&(i.firstRecvTs=Date.now()-l);let h=n.mediaDelay+d;h<=0?(t.pop(),AQ(n.context,o),h=0):h=Math.min(h,vAe),setTimeout(()=>t.length&&lQ(e),h)}function AQ(e,t){e.safeEmit(_t.STREAM_MESSAGE,t.uid,t.payload),e.onStreamMessage&&e.onStreamMessage(t)}function yAe(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0;if(!e.syncWithAudio)return AQ(n,{uid:e.uid,payload:e.payload});const i="".concat(n.id,"-").concat(e.uid),o=bI.get(i)||[],l=o.findIndex(g=>e.sendTs>=g.sendTs),d=cQ(cQ({},e),{},{context:n,mediaDelay:t,recvTs:Date.now()});l===-1?o.push(d):o.splice(l,0,d),bI.set(i,o);let h=!1;var f;_0.has(i)?h=!((f=_0.get(i))===null||f===void 0||!f.isSyncing):_0.set(i,{isSyncing:h,firstRecvTs:0,firstSendTs:0}),h||lQ(i)}const wAe=Lt().name;function dQ(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}function uQ(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?dQ(Object(n),!0).forEach(function(i){x(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):dQ(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}const tp="websdk_ng_cache_parameter",bAe=L("MAX_PRELOAD_ASYNC_LENGTH"),SAe=1e4,Hd=new Map,Gd=[];let SI=null,CI=0,TI=0;const E0=new Map,hQ=new Uint8Array([241,141,127,212,103,139,200,225,251,157,127,139,143,2,22,163]),CAe=function(e,t){const n=[];let i=0;const o=async()=>{const l=n.shift();l&&await l(),n.length>0&&i<t?o():i--};return async function(){for(var l=arguments.length,d=new Array(l),h=0;h<l;h++)d[h]=arguments[h];return new be(async(f,g)=>{n.push(async()=>{try{const _=await e(...d);f(_)}catch(_){g(_)}}),i<t&&(i++,o())})}}(II,bAe),RI=Xs.CancelToken.source();class TAe{constructor(){x(this,"_audioContext",null)}createMuteAudioTrack(){this._audioContext=new AudioContext;const t=this._audioContext.sampleRate,n=10*t,i=this._audioContext.createBuffer(2,n,t),o=this._audioContext.createBufferSource();o.buffer=i;const l=this._audioContext.createMediaStreamDestination();return o.connect(l),o.start(),l.stream.getAudioTracks()[0]}close(){this._audioContext&&(this._audioContext.close(),this._audioContext=null)}}async function II(e,t,n,i,o,l,d){try{if(!L("ENABLE_PRELOAD"))return;if(!wt().supportWebCrypto)return void Gl(()=>{S.warn("Your browser does not support preloading, this feature  be run in a secure environment")},"preload_webcrypto_not_supported");if(!n&&n!==null)throw new ae(P.INVALID_PARAMS,"Invalid token: ".concat(n,". If you don not use token, set it to null"));n&&Kr(n,"token",1,2047),Kr(e,"appid",1,2047),zv(t),i&&qv(i);const h=Td();S.debug("preload channel ".concat(t,", uid is ").concat(i));const f={appId:e,cname:t,token:n||e,uid:typeof i!="string"?i:null,sid:h,proxyServer:o,role:d};let g,_;typeof i=="string"?(f.stringUid=i,[_,g]=await be.all([oAe(i,{sid:h,appId:e},RI.token),PV(uQ(uQ({},f),{},{token:n||e,uid:0}),RI.token)]),f.uid=_.uid,g.gatewayInfo.uid=f.uid,g.gatewayInfo.res.uid=f.uid):(l&&(f.stringUid=l),g=await PV(f,RI.token));const v={sid:h,appId:e,cname:t,token:n||e,uid:f.stringUid||i,intUid:f.uid||g.gatewayInfo.uid,stringUid:f.stringUid,ts:Date.now(),sua:_,ap:g};await OI(v),CI++}catch(h){throw TI++,function(f){SI||(SI=window.setTimeout(()=>{let _="";E0.forEach((v,y)=>{_+="".concat(y,": ").concat(v," ;")}),ke.reportApiInvoke(null,{name:yn.PRELOAD,options:{success:CI,failed:TI,err:_}}).onError(f),CI=0,TI=0,E0.clear(),SI=null},SAe));const g=E0.get(f.code)||0;E0.set(f.code,g+1)}(h),h}}async function NI(e){try{if(L("AP_REQUEST_DETAIL")||L("ENABLE_ROLE_SELECT_EDGE"))return;const t=pQ(e);if(!t||e.cloudProxyServer!=="disabled")return;const n=await async function(i,o){try{const l=await window.crypto.subtle.importKey("raw",tF(o),"AES-GCM",!1,["decrypt"]),d=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:hQ},l,Cd(i));return JSON.parse(window.atob(Kl(new Uint8Array(d))))}catch{return}}(t,e.token||e.appId);if(!n||!function(i,o){return i.cname===o.cname&&i.appId===o.appId&&i.token===o.token?o.stringUid?i.stringUid===o.stringUid:typeof o.uid=="number"?i.uid===o.uid:i.uid==o.uid:!1}(n,e))return;if(n&&Date.now()-n.ts<L("AP_CACHE_LIFETIME"))return n}catch(t){S.warn("Error get preloadInfo",t.message)}}function pQ(e){let t;try{if(t=gQ(tp),!t)return;const n=JSON.parse(t),i=_Q(e),o=function(d,h){for(let f=d.length-1;f>=0;f--)if(h(d[f]))return f;return-1}(n,d=>i in d);if(o===-1)return;const l=n.splice(o,1)[0];return v0(tp,JSON.stringify(n)),l[i]}catch(n){S.warn("Error delete preload info: ".concat(t),n.message),v0(tp,"")}}async function OI(e){let t;try{e.uid&&pQ({appId:e.appId,cname:e.cname,token:e.token,uid:e.uid,stringUid:e.stringUid});const n=_Q(e),i=await async function(l,d){try{const h=await window.crypto.subtle.importKey("raw",tF(d),"AES-GCM",!1,["encrypt"]),f=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:hQ},h,Cd(window.btoa(JSON.stringify(l))));return Kl(new Uint8Array(f))}catch{return}}(e,e.token||e.appId);if(!i)return;t=gQ(tp);const o=t?JSON.parse(t):[];o.push({[n]:i}),o.length>L("AP_CACHE_NUM")&&o.shift(),v0(tp,JSON.stringify(o))}catch(n){S.warn("Error caching server parameters:",n.message),v0(tp,"")}}function xI(e){if(e){let t=Hd.get(e);t&&(window.clearTimeout(t),t=null,Hd.delete(e)),me(Gd).call(Gd,e)||e.cloudProxyServer!=="disabled"||Gd.push(e)}if(Hd.size<L("AP_CACHE_NUM")&&Gd.length>0){const t=Gd.shift();Hd.set(t,window.setTimeout(async()=>{const{appId:n,cname:i,token:o,stringUid:l,uid:d,proxyServer:h,role:f}=t;try{await CAe(n,i,o,d,h,l,f),Hd.has(t)&&xI(t)}catch(g){S.warn("update preload failed",g.message),fQ(t)}},L("AP_UPDATE_INTERVAL")))}}function fQ(e){const t=Gd.indexOf(e);t!==-1&&Gd.splice(t,1);let n=Hd.get(e);n&&(window.clearTimeout(n),n=null,Hd.delete(e),xI())}function mQ(e,t){const n=e.sua,i=e.ap;t&&n&&ke.reqUserAccount(e.sid,{lts:n.requestTime,elapse:n.elapse,success:!0,serverAddr:n.url,stringUid:t,uid:e.intUid,errorCode:null,extend:n.req}),ke.reportResourceTiming(e.ap.url,e.sid),ke.joinWebProxyAP(e.sid,{lts:i.requestTime,elapse:i.elapse,sucess:1,apServerAddr:i.url,turnServerAddrList:i.proxyInfo.addresses.map(o=>o.ip).join(","),eventType:"disabled",unilbsServerIds:[Xn.CHOOSE_SERVER,Xn.CLOUD_PROXY_FALLBACK].toString()}),ke.joinChooseServer(e.sid,{lts:i.requestTime,elapse:i.elapse,succ:!0,csAddr:i.url,opid:i.opid,serverList:i.gatewayInfo.gatewayAddrs.map(o=>o.address),ec:null,cid:i.gatewayInfo.cid.toString(),uid:i.gatewayInfo.uid.toString(),csIp:i.gatewayInfo.csIp,unilbsServerIds:[Xn.CHOOSE_SERVER].toString(),isHttp3:i.isHttp3})}function gQ(e){return window.atob(window.localStorage.getItem(e)||"")}function v0(e,t){window.localStorage.setItem(e,window.btoa(t))}function _Q(e){let t="".concat(e.appId,"_").concat(e.cname);return typeof e.uid=="string"&&(t+="_s_".concat(e.uid)),typeof e.uid=="number"&&(t+="_".concat(e.uid)),e.token&&(t+="_".concat(e.token)),cF(t)}function RAe(e){let t=function(){const n=OAe.pop();return n?(n.offset=n.limit=0,n):{bytes:new Uint8Array(64),offset:0,limit:0}}();return function(n,i){let o=n.appId;o!==void 0&&(Jn(i,10),eA(i,o));let l=n.cid;l!==void 0&&(Jn(i,16),Jn(i,l));let d=n.cname;d!==void 0&&(Jn(i,26),eA(i,d));let h=n.deviceId;h!==void 0&&(Jn(i,34),eA(i,h));let f=n.elapse;f!==void 0&&(Jn(i,40),tA(i,f));let g=n.fileSize;g!==void 0&&(Jn(i,48),tA(i,np(g)));let _=n.height;_!==void 0&&(Jn(i,56),tA(i,np(_)));let v=n.jpg;v!==void 0&&(Jn(i,66),Jn(i,v.length),vQ(i,v));let y=n.networkType;y!==void 0&&(Jn(i,72),tA(i,np(y)));let b=n.osType;b!==void 0&&(Jn(i,80),tA(i,np(b)));let D=n.requestId;D!==void 0&&(Jn(i,90),eA(i,D));let I=n.sdkVersion;I!==void 0&&(Jn(i,98),eA(i,I));let O=n.sequence;O!==void 0&&(Jn(i,104),tA(i,np(O)));let U=n.sid;U!==void 0&&(Jn(i,114),eA(i,U));let j=n.timestamp;j!==void 0&&(Jn(i,120),tA(i,j));let G=n.uid;G!==void 0&&(Jn(i,128),Jn(i,G));let $=n.vid;$!==void 0&&(Jn(i,136),Jn(i,$));let Z=n.width;Z!==void 0&&(Jn(i,144),tA(i,np(Z)));let X=n.service;X!==void 0&&(Jn(i,152),Jn(i,X));let ee=n.callbackData;ee!==void 0&&(Jn(i,162),Jn(i,ee.length),vQ(i,ee));let le=n.ticket;le!==void 0&&(Jn(i,170),eA(i,le));let fe=n.vendorConfigs;fe!==void 0&&(Jn(i,178),eA(i,fe))}(e,t),function(n){let i=n.bytes,o=n.limit;return i.length===o?i:i.subarray(0,o)}(t)}function IAe(e){return function(n){let i={};e:for(;!xAe(n);){let o=jm(n);switch(o>>>3){case 0:break e;case 1:i.code=jm(n);break;case 2:i.msg=yQ(n,jm(n));break;case 3:i.requestId=yQ(n,jm(n));break;case 4:i.timestamp=DAe(n,!1);break;default:NAe(n,7&o)}}return i}({bytes:t=e,offset:0,limit:t.length});var t}function NAe(e,t){switch(t){case 0:for(;128&ro(e););break;case 2:DI(e,jm(e));break;case 5:DI(e,4);break;case 1:DI(e,8);break;default:throw new Error("Unimplemented type: "+t)}}function np(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let OAe=[];function DI(e,t){if(e.offset+t>e.limit)throw new Error("Skip past limit");e.offset+=t}function xAe(e){return e.offset>=e.limit}function y0(e,t){let n=e.bytes,i=e.offset,o=e.limit,l=i+t;if(l>n.length){let d=new Uint8Array(2*l);d.set(n),e.bytes=d}return e.offset=l,l>o&&(e.limit=l),i}function EQ(e,t){let n=e.offset;if(n+t>e.limit)throw new Error("Read past limit");return e.offset+=t,n}function vQ(e,t){let n=y0(e,t.length);e.bytes.set(t,n)}function yQ(e,t){let n=EQ(e,t),i=String.fromCharCode,o=e.bytes,l="",d="";for(let h=0;h<t;h++){let f,g,_,v,y=o[h+n];128&y?(224&y)==192?h+1>=t?d+=l:(f=o[h+n+1],(192&f)!=128?d+=l:(v=(31&y)<<6|63&f,v<128?d+=l:(d+=i(v),h++))):(240&y)==224?h+2>=t?d+=l:(f=o[h+n+1],g=o[h+n+2],(49344&(f|g<<8))!=32896?d+=l:(v=(15&y)<<12|(63&f)<<6|63&g,v<2048||v>=55296&&v<=57343?d+=l:(d+=i(v),h+=2))):(248&y)==240?h+3>=t?d+=l:(f=o[h+n+1],g=o[h+n+2],_=o[h+n+3],(12632256&(f|g<<8|_<<16))!=8421504?d+=l:(v=(7&y)<<18|(63&f)<<12|(63&g)<<6|63&_,v<65536||v>1114111?d+=l:(v-=65536,d+=i(55296+(v>>10),56320+(1023&v)),h+=3))):d+=l:d+=i(y)}return d}function eA(e,t){let n=t.length,i=0;for(let d=0;d<n;d++){let h=t.charCodeAt(d);h>=55296&&h<=56319&&d+1<n&&(h=(h<<10)+t.charCodeAt(++d)-56613888),i+=h<128?1:h<2048?2:h<65536?3:4}Jn(e,i);let o=y0(e,i),l=e.bytes;for(let d=0;d<n;d++){let h=t.charCodeAt(d);h>=55296&&h<=56319&&d+1<n&&(h=(h<<10)+t.charCodeAt(++d)-56613888),h<128?l[o++]=h:(h<2048?l[o++]=h>>6&31|192:(h<65536?l[o++]=h>>12&15|224:(l[o++]=h>>18&7|240,l[o++]=h>>12&63|128),l[o++]=h>>6&63|128),l[o++]=63&h|128)}}function ro(e){return e.bytes[EQ(e,1)]}function wQ(e,t){let n=y0(e,1);e.bytes[n]=t}function jm(e){let t,n=0,i=0;do t=ro(e),n<32&&(i|=(127&t)<<n),n+=7;while(128&t);return i}function Jn(e,t){for(t>>>=0;t>=128;)wQ(e,127&t|128),t>>>=7;wQ(e,t)}function DAe(e,t){let n,i=0,o=0,l=0;return n=ro(e),i=127&n,128&n&&(n=ro(e),i|=(127&n)<<7,128&n&&(n=ro(e),i|=(127&n)<<14,128&n&&(n=ro(e),i|=(127&n)<<21,128&n&&(n=ro(e),o=127&n,128&n&&(n=ro(e),o|=(127&n)<<7,128&n&&(n=ro(e),o|=(127&n)<<14,128&n&&(n=ro(e),o|=(127&n)<<21,128&n&&(n=ro(e),l=127&n,128&n&&(n=ro(e),l|=(127&n)<<7))))))))),{low:i|o<<28,high:o>>>4|l<<24,unsigned:t}}function tA(e,t){let n=t.low>>>0,i=(t.low>>>28|t.high<<4)>>>0,o=t.high>>>24,l=o===0?i===0?n<16384?n<128?1:2:n<1<<21?3:4:i<16384?i<128?5:6:i<1<<21?7:8:o<128?9:10,d=y0(e,l),h=e.bytes;switch(l){case 10:h[d+9]=o>>>7&1;case 9:h[d+8]=l!==9?128|o:127&o;case 8:h[d+7]=l!==8?i>>>21|128:i>>>21&127;case 7:h[d+6]=l!==7?i>>>14|128:i>>>14&127;case 6:h[d+5]=l!==6?i>>>7|128:i>>>7&127;case 5:h[d+4]=l!==5?128|i:127&i;case 4:h[d+3]=l!==4?n>>>21|128:n>>>21&127;case 3:h[d+2]=l!==3?n>>>14|128:n>>>14&127;case 2:h[d+1]=l!==2?n>>>7|128:n>>>7&127;case 1:h[d]=l!==1?128|n:127&n}}const bQ={},SQ={},w0=4294967296,BAe=w0*w0,CQ=BAe/2;RQ(0,!0);const TQ=RQ(0),kAe=Vm(0,-2147483648,!1),LAe=Vm(-1,2147483647,!1);function RQ(e,t){let n,i,o;return t?(o=0<=(e>>>=0)&&e<256)&&(i=SQ[e],i)?i:(n=Vm(e,0,!0),o&&(SQ[e]=n),n):(o=-128<=(e|=0)&&e<128)&&(i=bQ[e],i)?i:(n=Vm(e,e<0?-1:0,!1),o&&(bQ[e]=n),n)}function Vm(e,t,n){return{low:0|e,high:0|t,unsigned:!!n}}function IQ(e,t){if(isNaN(e))return TQ;{if(e<=-CQ)return kAe;if(e+1>=CQ)return LAe}return e<0?TQ:Vm(e%w0|0,e/w0|0,t)}function NQ(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}class BI extends Tn{get connectionState(){return this._connectionState}set connectionState(t){if(this._connectionState===t)return;const n=this._connectionState;this._connectionState=t,this.emit(Uo.CONNECTION_STATE_CHANGE,t,n)}get quality(){return this._quality}set quality(t){this._quality=t>1?1:t<.1?.1:t,this._qualityTimer&&(window.clearTimeout(this._qualityTimer),this._qualityTimer=null),this._quality>=1||(this._qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this._qualityRatio},6e4))}constructor(t){var n;super(),x(this,"name","AgoraRTCImageModeration"),x(this,"_connectionState",fa.CONNECTING),x(this,"_sequence",0),x(this,"_moderationStartTime",void 0),x(this,"_workerConnection",void 0),x(this,"_workerMessageLengthLimit",void 0),x(this,"_qualityRatio",void 0),x(this,"_connectInfo",void 0),x(this,"_cancelTokenSource",Xs.CancelToken.source()),x(this,"_retryConfig",void 0),x(this,"_moderationInterval",void 0),x(this,"_moderationTimer",null),x(this,"_moderationMode",1),x(this,"_quality",1),x(this,"_qualityTimer",null),x(this,"_ticket",void 0),x(this,"_moderationIntervalMinimum",void 0),x(this,"_uploadFailedNum",0),x(this,"_uploadNum",0),x(this,"_uploadTimer",null),x(this,"_extraInfo",void 0),x(this,"_vendor",""),x(this,"_encoder",new TextEncoder),x(this,"_moderationId",void 0),x(this,"inspectImage",()=>{if(this.connectionState!==fa.CONNECTED)throw new se(P.OPERATION_ABORTED,"image moderation service connection status is ".concat(this.connectionState));this._moderationTimer&&(window.clearInterval(this._moderationTimer),this._moderationTimer=null),this._moderationTimer=window.setInterval(()=>{this.connectionState===fa.CONNECTED?this.requestToInspectImage():S.debug("[".concat(this._moderationId,"] Moderation State is not connected , "),this.connectionState)},this._moderationInterval<this._moderationIntervalMinimum?this._moderationIntervalMinimum:this._moderationInterval),this.requestToInspectImage()}),this._moderationId=zt(5,"image-moderation-"),this._workerMessageLengthLimit=L("IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT"),this._moderationIntervalMinimum=L("IMAGE_MODERATION_INTERVAL_MINIMUM"),this._moderationInterval=(n=t.interval)!==null&&n!==void 0?n:1e3,t.extraInfo&&(this._extraInfo=this._encoder.encode(t.extraInfo)),t.vendor&&(this._vendor=t.vendor),this._qualityRatio=L("IMAGE_MODERATION_QUALITY_RATIO"),this._moderationStartTime=Number(Date.now()),this._workerConnection=new Im("worker-"+this._moderationId,qn),this.on(Uo.STATE_CHANGE,(i,o)=>{S.debug("[".concat(this._moderationId,"] Moderation operation :").concat(Gh[i]," ").concat(o||""))}),this.handleWorkerEvents()}async init(t,n){this.emit(Uo.STATE_CHANGE,Gh.CONNECT_AP),this._connectInfo=t;const i=this._cancelTokenSource.token;return this._retryConfig=n,new be((o,l)=>{this.on(Uo.CONNECTION_STATE_CHANGE,(d,h)=>{d===fa.CONNECTED&&o()}),this.requestAP(t,i,n).then(d=>{this.connectWorker(d)}).catch(d=>{l(d)})})}updateConfig(t){var n;this._moderationInterval=(n=t.interval)!==null&&n!==void 0?n:1e3,t.extraInfo&&(this._extraInfo=this._encoder.encode(t.extraInfo)),t.vendor&&(this._vendor=t.vendor),S.debug("[".concat(this._moderationId,"] updateConfig: ").concat(JSON.stringify(t))),this.connectionState===fa.CONNECTED&&this.inspectImage()}async requestAP(t,n,i){const o=L("WEBCS_DOMAIN").map(f=>"https://".concat(f,"/api/v1")),l=await function(f,g,_,v){let{appId:y,areaCode:b,cname:D,sid:I,token:O,uid:U}=g;qh++;const j="moderation_plugin",G={service_name:j,json_body:JSON.stringify({appId:y,areaCode:b,cname:D,command:"allocateEdge",requestId:qh,seq:qh,sid:I,appToken:O,ts:Date.now(),uid:U+""})};let $,Z,X=f[0];return Do(async()=>{$=Date.now();const ee=await Mo(X,{data:G,cancelToken:_,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(Z=Date.now()-$,ee.code!==0){const Je=new se(P.UNEXPECTED_RESPONSE,"moderation plugin ap error, code"+ee.code,{retry:!0,responseTime:Z});throw S.error(Je.toString()),Je}const le=JSON.parse(ee.json_body);if(le.code!==200){const Je=new se(P.UNEXPECTED_RESPONSE,"moderation plugin ap error, code: ".concat(le.code,", reason: ").concat(le.reason),{code:le.code,responseTime:Z});throw S.error(Je.toString()),Je}if(!le.servers||!Array.isArray(le.servers)||le.servers.length===0){const Je=new se(P.UNEXPECTED_RESPONSE,"moderation plugin ap empty server",{code:le.code,responseTime:Z});throw S.error(Je.toString()),Je}if(!le.servers.some(Je=>!!Je.wss)){const Je=new se(P.UNEXPECTED_RESPONSE,"moderation plugin ap empty port",{code:le.code,responseTime:Z});throw S.error(Je.toString()),Je}const fe=L("IMAGE_MODERATION_WORKER_WSS");if(fe)return{addressList:[fe],workerToken:le.workerToken,vid:le.vid,responseTime:Z};const Ie=L("IMAGE_MODERATION_WORKER_HOST");return{addressList:le.servers.map(Je=>{let{address:pt,wss:ct}=Je;if(pt&&ct)return"wss://".concat(pt.replace(/\./g,"-"),".").concat(Ie,":").concat(ct,"/moderation")}).filter(Je=>!!Je),workerToken:le.workerToken,vid:le.vid,ticket:le.appTicket,responseTime:Z}},(ee,le)=>(ke.apworkerEvent(I,{success:!0,sc:200,serviceName:j,responseDetail:JSON.stringify(ee.addressList),firstSuccess:le===0,responseTime:Z,serverIp:f[le%f.length]}),!1),(ee,le)=>(ke.apworkerEvent(I,{success:!1,sc:ee.data&&ee.data.code||200,serviceName:j,responseTime:Z,serverIp:f[le%f.length]}),!!(ee.code!==P.OPERATION_ABORTED&&ee.code!==P.UNEXPECTED_RESPONSE||ee.data&&ee.data.retry)&&(X=f[(le+1)%f.length],!0)),v)}(o,t,n,i);this.emit(Uo.STATE_CHANGE,Gh.AP_CONNECTED);const{addressList:d,ticket:h}=l;return this._ticket=h,d}async connectWorker(t){this.emit(Uo.STATE_CHANGE,Gh.CONNECT_WORKER),await this._workerConnection.init(t,1e4)}handleWorkerEvents(){this._workerConnection.on(lt.CONNECTED,async()=>{this.emit(Uo.STATE_CHANGE,Gh.WORKER_CONNECTED,this._workerConnection.url),this.connectionState=fa.CONNECTED}),this._workerConnection.on(lt.CLOSED,()=>{this.connectionState=fa.CLOSED}),this._workerConnection.on(lt.FAILED,()=>{this.connectionState=fa.CLOSED}),this._workerConnection.on(lt.RECONNECTING,()=>{this.connectionState=this.connectionState===fa.CONNECTED?fa.RECONNECTING:fa.CONNECTING}),this._workerConnection.on(lt.ON_MESSAGE,async t=>{if(t.data instanceof ArrayBuffer){const n=IAe(new Uint8Array(t.data));L("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&S.debug("[".concat(this._moderationId,"] Response message for worker of image moderation "),JSON.stringify(n)),this._uploadNum++,n.code===void 0||n.code===0||(this._uploadFailedNum++,S.error("[".concat(this._moderationId,"] Error response from worke, code is ").concat(n.code,", msg is ").concat(n.msg)),this._uploadTimer||(this._uploadTimer=window.setTimeout(()=>{ke.reportApiInvoke(this._connectInfo.sid||null,{name:yn.IMAGE_MODERATION_UPLOAD,options:[this._uploadFailedNum,this._uploadNum,n.code],tag:an.TRACER}).onError(new se(P.IMAGE_MODERATION_UPLOAD_FAILED,n.msg)),this._uploadTimer=null},L("IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL"))))}else S.error("[".concat(this._moderationId,"] Unexpected message type from worker"))}),this._workerConnection.on(lt.WILL_RECONNECT,(t,n,i)=>{t==="recover"&&i(t),i("tryNext")}),this._workerConnection.on(lt.REQUEST_NEW_URLS,(t,n)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(t).catch(n)})}static intToLong(t){return{low:t|=0,high:t>>31,unsigned:t>=0}}async requestToInspectImage(){const t=Ni(this,Uo.CLIENT_LOCAL_VIDEO_TRACK),n={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(t){if(!t.isPlaying)return void(L("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&S.debug("Only the track being played can be inspected"));this._sequence++;const i=await this.generateRequestData(t,n);this._workerConnection.sendMessage(i,!0,!0)}else L("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&S.debug("Only the track being published can be inspected")}async generateRequestData(t,n){let{appId:i,cname:o,cid:l,vid:d,sid:h,uid:f}=n;const g=Date.now(),_=await t.getCurrentFrameImage("image/jpeg",this.quality),v=await ZF(_,i,o),y=this._sequence+"-"+l+"-"+f+"-"+g+"-"+zt(12,""),b={appId:i,cid:l,cname:o,deviceId:"",elapse:BI.intToLong(Number(g-this._moderationStartTime)),fileSize:_.buffer.byteLength,height:_.height,width:_.width,jpg:v,networkType:6,osType:7,requestId:y,sdkVersion:"4.24.1",sequence:this._sequence,sid:h,timestamp:IQ(g),uid:f,vid:d,service:this._moderationMode,ticket:this._ticket,callbackData:this._extraInfo,vendorConfigs:this._vendor};this._extraInfo===void 0&&delete b.callbackData;const D=RAe(b);if(D.byteLength<this._workerMessageLengthLimit){if(L("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")){const I=function(O){for(var U=1;U<arguments.length;U++){var j=arguments[U]!=null?arguments[U]:{};U%2?NQ(Object(j),!0).forEach(function(G){x(O,G,j[G])}):Object.getOwnPropertyDescriptors?Object.defineProperties(O,Object.getOwnPropertyDescriptors(j)):NQ(Object(j)).forEach(function(G){Object.defineProperty(O,G,Object.getOwnPropertyDescriptor(j,G))})}return O}({},b);delete I.jpg,S.debug("[".concat(this._moderationId,"] Request message for worker of image moderation service: "),JSON.stringify(I))}return D}{const I=this.quality*this._qualityRatio;return this.quality=I,await this.generateRequestData(t,{appId:i,cname:o,cid:l,vid:d,sid:h,uid:f})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=Xs.CancelToken.source(),this._workerConnection&&this._workerConnection.close(),this._moderationTimer&&window.clearInterval(this._moderationTimer),this._moderationTimer=null,this._uploadTimer&&window.clearTimeout(this._uploadTimer),this._uploadTimer=null,this.connectionState=fa.CLOSED,this.emit(Uo.STATE_CHANGE,Gh.CLOSED)}}function OQ(e){if(sn(e.interval,"interval",1e3,1/0),e&&e.extraInfo&&e.extraInfo.length>1024)throw new se(P.INVALID_PARAMS,"config.extraInfo length cannot exceed 1024 bytes");if(e&&e.vendor&&e.vendor.length>1024)throw new se(P.INVALID_PARAMS,"config.vendor length cannot exceed 1024 bytes")}const UAe={name:"ImageModeration",create:function(e){let{config:t}=e;return OQ(t),new BI(t)}};var xQ,DQ,BQ,kQ,LQ,UQ,PQ,MQ,FQ,jQ,VQ,QQ,HQ,GQ,KQ,WQ,YQ,zQ,qQ,XQ,JQ,$Q,ZQ,e3,t3,n3,r3,s3,i3,a3,o3,c3,l3,A3,d3,u3,h3,p3,f3,m3,g3,_3,Ne;function E3(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}function so(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?E3(Object(n),!0).forEach(function(i){x(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):E3(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}Lr.setLogger(S);let PAe=(xQ=We(),DQ=We({argsMap:(e,t)=>{if(!Array.isArray(t)){if(!(t instanceof Uh))return[t];t=[t]}return t.map(n=>n?Object(n).toString():"null")}}),BQ=We({argsMap:(e,t)=>(t||(t=[]),Array.isArray(t)||t.trackMediaType!==Lh.DATA?(Array.isArray(t)||(t=[t]),t.map(n=>n.getTrackId())):[t.getChannelId()])}),kQ=We({argsMap:(e,t,n,i)=>[typeof t=="object"?t.uid:t,n,i]}),LQ=We({argsMap:(e,t,n)=>[t,n]}),UQ=We({argsMap:(e,t)=>t.map(n=>{let{user:i,mediaType:o}=n;return[i==null?void 0:i.uid,o]})}),PQ=We({argsMap:(e,t,n,i)=>[typeof t=="object"?t.uid:t,n,i]}),MQ=We({argsMap:(e,t)=>t.map(n=>{let{user:i,mediaType:o}=n;return{uid:i==null?void 0:i.uid,mediaType:o}})}),FQ=We(),jQ=We(),VQ=We(),QQ=We(),HQ=We(),GQ=We(),KQ=We(),WQ=We(),YQ=We(),zQ=We(),qQ=We(),XQ=We(),JQ=We(),$Q=We(),ZQ=We(),e3=We(),t3=We({argsMap:(e,t)=>[t]}),n3=We(),r3=We(),s3=We(),i3=We(),a3=We(),o3=We(),c3=We(),l3=We(),A3=We({argsMap:(e,t)=>(Array.isArray(t)||(t=[t]),[JSON.stringify(t)])}),d3=We(),u3=We(),h3=We(),p3=We(),f3=We(),m3=We(),g3=We({reportResult:!0}),_3=We(),Ne=class extends Tn{get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._p2pChannel.getAllTracks(!0)}get uid(){return this._uid}get channelName(){return this._channelName}get localDataChannels(){return this._p2pChannel.getAllDataChannels()}get mode(){return this._config.mode}get role(){var e;return((e=this._config)===null||e===void 0?void 0:e.role)||"audience"}get codec(){return this._config.codec}get audioCodec(){return this._config.audioCodec||"opus"}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}get __className__(){return"Client"}constructor(e,t){let n;if(super(),x(this,"store",void 0),x(this,"_uid",void 0),x(this,"_channelName",void 0),x(this,"_uintUid",void 0),x(this,"_users",[]),x(this,"_config",void 0),x(this,"_clientId",void 0),x(this,"_appId",void 0),x(this,"_sessionId",null),x(this,"_key",void 0),x(this,"_rtmConfig",{}),x(this,"_joinInfo",void 0),x(this,"_gateway",void 0),x(this,"_statsCollector",void 0),x(this,"_configDistribute",void 0),x(this,"_leaveMutex",void 0),x(this,"_publishMutex",void 0),x(this,"_renewTokenMutex",void 0),x(this,"_subscribeMutex",void 0),x(this,"_encryptionMode","none"),x(this,"_encryptionSecret",null),x(this,"_encryptionSalt",null),x(this,"_encryptDataStream",!1),x(this,"_encryptDataStreamKey",null),x(this,"_encryptDataStreamIv",null),x(this,"_proxyServer",void 0),x(this,"_turnServer",{servers:[],mode:"auto"}),x(this,"_cloudProxyServerMode","disabled"),x(this,"_isDualStreamEnabled",!1),x(this,"_defaultStreamFallbackType",void 0),x(this,"_lowStreamParameter",void 0),x(this,"_streamFallbackTypeCacheMap",new Map),x(this,"_remoteStreamTypeCacheMap",new Map),x(this,"_axiosCancelSource",Xs.CancelToken.source()),x(this,"_audioVolumeIndicationInterval",void 0),x(this,"_networkQualityInterval",void 0),x(this,"_userOfflineTimeout",void 0),x(this,"_streamRemovedTimeout",void 0),x(this,"_rteDetailInterval",void 0),x(this,"_liveTranscodeStreamingClient",void 0),x(this,"_liveRawStreamingClient",void 0),x(this,"_channelMediaRelayClient",void 0),x(this,"_networkQualitySensitivity","normal"),x(this,"_p2pChannel",void 0),x(this,"_useLocalAccessPoint",!1),x(this,"_setLocalAPVersion",void 0),x(this,"_joinAndNotLeaveYet",!1),x(this,"_numberOfJoinCount",0),x(this,"_joinResponse",null),x(this,"_remoteDefaultVideoStreamType",void 0),x(this,"_inspect",void 0),x(this,"_moderation",void 0),x(this,"_license",void 0),x(this,"_pendingPublishedUsers",[]),x(this,"ntpAlignErrorCount",0),x(this,"remoteInboundOffset",0),x(this,"_peerConnectionState",void 0),x(this,"_pendingRtpCapabilityChange",void 0),x(this,"_fallbackServerInfo",void 0),x(this,"_dualStreamMode",void 0),x(this,"_handleLocalTrackEnable",(o,l,d)=>{this.publish(o,!1).then(l).catch(d)}),x(this,"_handleLocalTrackDisable",(o,l,d)=>{this.unpublish(o).then(l).catch(d)}),x(this,"_handleUserOnline",o=>{if(L("BLOCK_LOCAL_CLIENT")&&Ud(o.uid,this.channelName))return void S.debug("[".concat(o.uid,"] will be ignored in local"));this.isStringUID&&typeof o.uid!="string"&&S.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));const l=this._users.find(d=>d.uid===o.uid);if(l)l._trust_in_room_=!0,l._is_pre_created&&(l._is_pre_created=!1,this.safeEmit(_t.USER_JOINED,l));else{const d=new $l(o.uid,o.uint_id||o.uid);this._users.push(d),S.debug("[".concat(this._clientId,"] user online"),o.uid),this.store.firstVideoFrameDecoded(d.uid,{userJoinNotify:Date.now()}),this.safeEmit(_t.USER_JOINED,d)}}),x(this,"_handleUserOffline",o=>{if(L("BLOCK_LOCAL_CLIENT")&&Ud(o.uid,this.channelName))return;const l=this._users.find(d=>d.uid===o.uid);l&&(this._handleRemoveStream(o),this._handleRemoveDataChannels(o),l._audio_pre_subscribed||l._video_pre_subscribed?l._is_pre_created=!0:vv(this._users,l),this._remoteStreamTypeCacheMap.delete(l.uid),this._streamFallbackTypeCacheMap.delete(l.uid),S.debug("[".concat(this._clientId,"] user offline"),o.uid,"reason:",o.reason),this.safeEmit(_t.USER_LEAVED,l,o.reason))}),x(this,"_handleAddAudioOrVideoStream",(o,l,d,h,f,g,_,v)=>{if(L("BLOCK_LOCAL_CLIENT")&&Ud(l,this.channelName))return;const y=this._users.find(I=>I.uid===l);if(!y)return void S.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));S.debug("[".concat(this._clientId,"] stream added with uid ").concat(l,", type ").concat(o)),this.store.subscribe(y.uid,o,void 0,void 0,void 0,Date.now()),o==="video"&&this.store.firstVideoFrameDecoded(y.uid,{videoAddNotify:Date.now()});const b=o==="audio"?y.hasAudio:y.hasVideo;y._uintid||(y._uintid=g||l),o==="audio"?y._trust_audio_stream_added_state_=!0:y._trust_video_stream_added_state_=!0,o==="audio"?(y._audio_added_=!0,d!==void 0&&(y._audioSSRC=d),h!==void 0&&(y._cname=h),_&&(y._audioOrtc=_)):(y._video_added_=!0,d!==void 0&&(y._videoSSRC=d),h!==void 0&&(y._cname=h),v!==void 0&&(y._rtxSsrcId=v),_&&(y._videoOrtc=_)),(o==="audio"?y.hasAudio:y.hasVideo)&&!b&&(S.info("[".concat(this._clientId,"] remote user ").concat(y.uid," published ").concat(o)),this.safeEmit(_t.USER_PUBLISHED,y,o)),o==="video"?ke.onGatewayStream(this._sessionId,Ar.ON_ADD_VIDEO_STREAM,wn.ON_ADD_VIDEO_STREAM,{peer:g||l,ssrc:y._videoSSRC}):ke.onGatewayStream(this._sessionId,Ar.ON_ADD_AUDIO_STREAM,wn.ON_ADD_AUDIO_STREAM,{peer:g||l,ssrc:y._audioSSRC}),this._p2pChannel.remoteMediaSsrcChanged(y,o,d).then(I=>{if(I&&(S.debug("[".concat(this._clientId,"] resubscribe ").concat(o," for user ").concat(y.uid," after rejoin because SSRC id changed.")),this._p2pChannel instanceof Qd))return this._p2pChannel.unsubscribe(y,o,!0).then(()=>this._subscribe(y,o,!0).catch(O=>{S.error("[".concat(this._clientId,"] resubscribe error"),O.toString())}))}),this._p2pChannel.hasPendingRemoteMedia(y,o)&&(S.debug("[".concat(this._clientId,"] resubscribe ").concat(o," for user ").concat(y.uid," after reconnect.")),this._subscribe(y,o,!0).catch(I=>{S.error("[".concat(this._clientId,"] resubscribe error"),I.toString())}));const D=this._getEncodingName(f);o==="video"&&(D==="unknown"?this.safeEmit(_t.AV1_DECODABLE_RESULT,!1):kr()||fs()||(D==null?void 0:D.toLocaleLowerCase())!==Id.av1||aAe().then(I=>{L("FLS_ENABLE_AV1_DECODE_DETECT")&&this.safeEmit(_t.AV1_DECODABLE_RESULT,I),I||this._gateway.downgradeCodec(D)}))}),x(this,"_handleRemoveStream",o=>{if(L("BLOCK_LOCAL_CLIENT")&&Ud(o.uid,this.channelName))return;const l=this._users.find(h=>h.uid===o.uid);if(!l)return void S.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));S.debug("[".concat(this._clientId,"] stream removed with uid ").concat(o.uid));let d=()=>{};l.hasAudio&&l.hasVideo?d=()=>{S.info("[".concat(this._clientId,"] remote user ").concat(l.uid," unpublished audio track")),this.safeEmit(_t.USER_UNPUBLISHED,l,"audio"),S.info("[".concat(this._clientId,"] remote user ").concat(l.uid," unpublished video track")),this.safeEmit(_t.USER_UNPUBLISHED,l,"video")}:l.hasVideo?d=()=>{S.info("[".concat(this._clientId,"] remote user ").concat(l.uid," unpublished video track")),this.safeEmit(_t.USER_UNPUBLISHED,l,"video")}:l.hasAudio&&(d=()=>{S.info("[".concat(this._clientId,"] remote user ").concat(l.uid," unpublished audio track")),this.safeEmit(_t.USER_UNPUBLISHED,l,"audio")}),l._video_pre_subscribed||l._audio_pre_subscribed||(l._trust_audio_stream_added_state_=!0,l._trust_video_stream_added_state_=!0,l._audio_added_=!1,l._video_added_=!1,this._p2pChannel instanceof Qd&&this._p2pChannel.unsubscribe(l).then(h=>{if(h)return this._gateway.unsubscribe(h,l.uid)}),l._audioSSRC=void 0,l._videoSSRC=void 0,l._audioOrtc=void 0,l._videoOrtc=void 0,l._rtxSsrcId=void 0),ke.onGatewayStream(this._sessionId,Ar.ON_REMOVE_STREAM,wn.ON_REMOVE_STREAM,{peer:o.uint_id||o.uid}),d()}),x(this,"_handleSetStreamLocalEnable",(o,l,d)=>{if(L("BLOCK_LOCAL_CLIENT")&&Ud(l,this.channelName))return;const h=this._users.find(_=>_.uid===l);if(!h)return void S.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));S.debug("[".concat(this._clientId,"] local ").concat(o," ").concat(d?"enabled":"disabled"," with uid ").concat(l));const f=o==="audio"?h.hasAudio:h.hasVideo;if(o==="audio"){h._trust_audio_enabled_state_=!0;const _=h._audio_enabled_;if(h._audio_enabled_=d,h._audio_enabled_===_)return;{const v=h._audio_enabled_?"enable-local-audio":"disable-local-audio";S.debug("[".concat(this._clientId,"] user-info-updated, uid: ").concat(l,", msg: ").concat(v)),this.safeEmit(_t.USER_INFO_UPDATED,l,v)}}else{h._trust_video_enabled_state_=!0;const _=h._video_enabled_;if(h._video_enabled_=d,h._video_enabled_===_)return;{const v=h._video_enabled_?"enable-local-video":"disable-local-video";S.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(l,", msg: ").concat(v)),this.safeEmit(_t.USER_INFO_UPDATED,l,v)}}const g=o==="audio"?h.hasAudio:h.hasVideo;return f!==g?!f&&g?(S.info("[".concat(this._clientId,"] remote user ").concat(l," published ").concat(o)),void this.safeEmit(_t.USER_PUBLISHED,h,o)):(o==="video"&&h._videoTrack&&h._videoTrack._destroy(),o==="audio"&&h._audioTrack,this._p2pChannel.muteRemote(h,o),S.info("[".concat(this._clientId,"] remote user ").concat(l," unpublished ").concat(o)),void this.safeEmit(_t.USER_UNPUBLISHED,h,o)):void 0}),x(this,"_handleMuteStream",(o,l,d)=>{if(L("BLOCK_LOCAL_CLIENT")&&Ud(o,this.channelName))return;S.debug("[".concat(this._clientId,"] receive mute message"),o,l,d);const h=this._users.find(_=>_.uid===o);if(!h)return void S.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(o));const f=l==="audio"?h.hasAudio:h.hasVideo;if(l==="audio"){h._trust_audio_mute_state_=!0;const _=h._audio_muted_;if(h._audio_muted_=d,h._audio_muted_===_)return;{const v=h._audio_muted_?"mute-audio":"unmute-audio";S.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(o,", msg: ").concat(v)),this.safeEmit(_t.USER_INFO_UPDATED,o,v)}}else{h._trust_video_mute_state_=!0;const _=h._video_muted_;if(h._video_muted_=d,h._video_muted_===_)return;{const v=h._video_muted_?"mute-video":"unmute-video";S.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(o,", msg: ").concat(v)),this.safeEmit(_t.USER_INFO_UPDATED,o,v)}}const g=l==="audio"?h.hasAudio:h.hasVideo;if(f!==g){if(!f&&g)return(l==="audio"?h._audioSSRC:h._videoSSRC)?(S.info("[".concat(this._clientId,"] remote user ").concat(o," published ").concat(l)),void this.safeEmit(_t.USER_PUBLISHED,h,l)):void S.warning("[".concat(this._clientId,"] remote user ").concat(o," receive ").concat(l," unmute message  before add stream message, ").concat(l," SSRC doesn't exist yet."));l==="video"&&h._videoTrack&&!h._video_pre_subscribed&&h._videoTrack._destroy(),l==="audio"&&h._audioTrack,this._p2pChannel.muteRemote(h,l),S.info("[".concat(this._clientId,"] remote user ").concat(o," unpublished ").concat(l)),this.safeEmit(_t.USER_UNPUBLISHED,h,l)}}),x(this,"_handleP2PLost",async o=>{S.debug("[".concat(this._clientId,"] receive p2p lost"),o),parseInt(o.p2pid,10)===this.store.p2pId?await this._p2pChannel.requestReconnect():S.warning("[".concat(this._clientId,"] P2PLost stream not found"),o)}),x(this,"_handleTokenWillExpire",()=>{S.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.safeEmit(_t.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)}),x(this,"_handleBeforeUnload",o=>{o.type==="beforeunload"&&o.returnValue!==void 0&&o.returnValue!==""||(this.leave(),S.info("[".concat(this._clientId,"] auto leave onbeforeunload or pagehide")))}),x(this,"_handleUpdateNetworkQuality",()=>{if(this._networkQualitySensitivity==="normal")return;if(navigator&&navigator.onLine!==void 0&&!navigator.onLine)return void this.safeEmit(_t.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});const o={downlinkNetworkQuality:0,uplinkNetworkQuality:0};o.uplinkNetworkQuality=this._p2pChannel.getUplinkNetworkQuality(),o.downlinkNetworkQuality=this._p2pChannel.getDownlinkNetworkQuality(),this.safeEmit(_t.NETWORK_QUALITY,o)}),x(this,"_handleP2PAddAudioOrVideoStream",(o,l,d,h)=>{const f=this._users.find(_=>_.uid===l);if(!f)return void S.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));S.debug("[".concat(this._clientId,"] stream added with uid ").concat(l,", type ").concat(o)),this.store.subscribe(f.uid,o,void 0,void 0,void 0,Date.now());const g=o==="audio"?f.hasAudio:f.hasVideo;o==="audio"?f._trust_audio_stream_added_state_=!0:f._trust_video_stream_added_state_=!0,o==="audio"?(f._audio_added_=!0,d!==void 0&&(f._audioSSRC=d),h!==void 0&&(f._audioMid=h)):(f._video_added_=!0,d!==void 0&&(f._videoSSRC=d),h!==void 0&&(f._videoMid=h)),(o==="audio"?f.hasAudio:f.hasVideo)&&!g&&(S.info("[".concat(this._clientId,"] remote user ").concat(f.uid," published ").concat(o)),this.safeEmit(_t.USER_PUBLISHED,f,o)),this._p2pChannel.hasPendingRemoteMedia(f,o)&&(S.debug("[".concat(this._clientId,"] resubscribe ").concat(o," for user ").concat(f.uid," after reconnect.")),this._subscribe(f,o,!0).catch(_=>{S.error("[".concat(this._clientId,"] resubscribe error"),_.toString())}))}),this._config=e,this._clientId=t||zt(5,"client-"),this.store=new class{constructor(o,l,d,h,f){at(this,"state",void 0),this.state={codec:o,audioCodec:l,mode:d,clientId:h,sessionId:null,p2pId:0,dcId:0,pubId:0,subId:0,keyMetrics:{publish:[],subscribe:[],firstVideoFrameDecoded:[]},joinChannelServiceRecords:[],cloudProxyServerMode:"disabled",useP2P:!1,p2pTransport:Rd.Default,hasStartJoinChannel:!1,isABTestSuccess:!1,rteUrl:void 0,rteSid:void 0,autoSubscribe:!1,enableInstantMuteRestore:!1,networkQualityProbe:!1,useDcSignal:!!f}}dispatch(o){this.state=function(l,d){switch(d.type){case tt.SET_SESSION_ID:return Ee(Ee({},l),{},{sessionId:d.sessionId});case tt.SET_P2P_ID:return Ee(Ee({},l),{},{p2pId:d.p2pId});case tt.SET_UID:return Ee(Ee({},l),{},{uid:d.uid});case tt.SET_INT_UID:return Ee(Ee({},l),{},{intUid:d.intUid});case tt.SET_PUB_ID:return Ee(Ee({},l),{},{pubId:d.pubId});case tt.KEY_METRIC_CLIENT_CREATED:return Ee(Ee({},l),{},{keyMetrics:Ee(Ee({},l.keyMetrics),{},{clientCreated:d.metric})});case tt.KEY_METRIC_JOIN_START:return Ee(Ee({},l),{},{keyMetrics:Ee(Ee({},l.keyMetrics),{},{joinStart:d.metric})});case tt.KEY_METRIC_PRELOAD_START:return Ee(Ee({},l),{},{keyMetrics:Ee(Ee({},l.keyMetrics),{},{preloadStart:d.metric})});case tt.KEY_METRIC_PRELOAD_END:return Ee(Ee({},l),{},{keyMetrics:Ee(Ee({},l.keyMetrics),{},{preloadEnd:d.metric})});case tt.KEY_METRIC_JOIN_END:return Ee(Ee({},l),{},{keyMetrics:Ee(Ee({},l.keyMetrics),{},{joinEnd:d.metric})});case tt.KEY_METRIC_REQUEST_AP_START:return Ee(Ee({},l),{},{keyMetrics:Ee(Ee({},l.keyMetrics),{},{requestAPStart:d.metric})});case tt.KEY_METRIC_REQUEST_AP_END:return Ee(Ee({},l),{},{keyMetrics:Ee(Ee({},l.keyMetrics),{},{requestAPEnd:d.metric})});case tt.KEY_METRIC_REQUEST_SUA_END:return Ee(Ee({},l),{},{keyMetrics:Ee(Ee({},l.keyMetrics),{},{requestSUAEnd:d.metric})});case tt.KEY_METRIC_BEFORE_CONNECT:return Ee(Ee({},l),{},{keyMetrics:Ee(Ee({},l.keyMetrics),{},{beforeConnect:d.metric})});case tt.KEY_METRIC_PEER_RECEIVER:return Ee(Ee({},l),{},{keyMetrics:Ee(Ee({},l.keyMetrics),{},{peerReceiver:d.metric})});case tt.KEY_METRIC_SIGNAL_CONNECTED:return Ee(Ee({},l),{},{keyMetrics:Ee(Ee({},l.keyMetrics),{},{signalConnected:d.metric})});case tt.KEY_METRIC_JOIN_REQ:return Ee(Ee({},l),{},{keyMetrics:Ee(Ee({},l.keyMetrics),{},{joinReq:d.metric})});case tt.KEY_METRIC_JOIN_REP:return Ee(Ee({},l),{},{keyMetrics:Ee(Ee({},l.keyMetrics),{},{joinRep:d.metric})});case tt.KEY_METRIC_JOIN_GATEWAY_START:return Ee(Ee({},l),{},{keyMetrics:Ee(Ee({},l.keyMetrics),{},{joinGatewayStart:d.metric})});case tt.KEY_METRIC_JOIN_GATEWAY_END:return Ee(Ee({},l),{},{keyMetrics:Ee(Ee({},l.keyMetrics),{},{joinGatewayEnd:d.metric})});case tt.KEY_METRIC_PEER_CONNECTION_START:return Ee(Ee({},l),{},{keyMetrics:Ee(Ee({},l.keyMetrics),{},{peerConnectionStart:d.metric})});case tt.KEY_METRIC_PEER_CONNECTION_END:return Ee(Ee({},l),{},{keyMetrics:Ee(Ee({},l.keyMetrics),{},{peerConnectionEnd:d.metric})});case tt.KEY_METRIC_DESCRIPTION_START:return Ee(Ee({},l),{},{keyMetrics:Ee(Ee({},l.keyMetrics),{},{descriptionStart:d.metric})});case tt.KEY_METRIC_SIGNAL_CHANNEL_OPEN:return Ee(Ee({},l),{},{keyMetrics:Ee(Ee({},l.keyMetrics),{},{signalChannelOpen:d.metric})});case tt.KEY_METRIC_ICE_CONNECTION_END:return Ee(Ee({},l),{},{keyMetrics:Ee(Ee({},l.keyMetrics),{},{iceConnectionEnd:d.metric})});case tt.KEY_METRIC_PUBLISH:{const h=l.keyMetrics.publish,f=h.findIndex(g=>g.trackId===d.metric.trackId);return f!==-1?(h[f]=Ee(Ee({},h[f]),d.metric),Ee(Ee({},l),{},{keyMetrics:Ee(Ee({},l.keyMetrics),{},{publish:[...h]})})):Ee(Ee({},l),{},{keyMetrics:Ee(Ee({},l.keyMetrics),{},{publish:[...l.keyMetrics.publish,d.metric]})})}case tt.KEY_METRIC_SUBSCRIBE:{const h=l.keyMetrics.subscribe,f=h.findIndex(g=>g.userId===d.metric.userId&&g.type===d.metric.type);return f!==-1?(h[f]=Ee(Ee({},h[f]),d.metric),Ee(Ee({},l),{},{keyMetrics:Ee(Ee({},l.keyMetrics),{},{subscribe:[...h]})})):Ee(Ee({},l),{},{keyMetrics:Ee(Ee({},l.keyMetrics),{},{subscribe:[...l.keyMetrics.subscribe,d.metric]})})}case tt.KEY_METRIC_FIRST_VIDEO_FRAME_DECODED:{const h=l.keyMetrics.firstVideoFrameDecoded,f=h.findIndex(g=>g.userId===d.metric.userId);return f!==-1?(h[f]=Ee(Ee({},h[f]),d.metric),Ee(Ee({},l),{},{keyMetrics:Ee(Ee({},l.keyMetrics),{},{firstVideoFrameDecoded:[...h]})})):Ee(Ee({},l),{},{keyMetrics:Ee(Ee({},l.keyMetrics),{},{firstVideoFrameDecoded:[...l.keyMetrics.firstVideoFrameDecoded,d.metric]})})}case tt.RESET_FIRST_VIDEO_FRAME_DECODED:return l.keyMetrics.firstVideoFrameDecoded=[],l;case tt.SET_CLOUD_PROXY_SERVER_MODE:return l.cloudProxyServerMode=d.mode,l;case tt.RECORD_JOIN_CHANNEL_SERVICE:return typeof d.index!="number"?l.joinChannelServiceRecords=[...l.joinChannelServiceRecords,d.record]:(l.joinChannelServiceRecords[d.index]=Ee(Ee({},l.joinChannelServiceRecords[d.index]),d.record),l.joinChannelServiceRecords=[...l.joinChannelServiceRecords]),l;case tt.RESET_JOIN_CHANNEL_SERVICE_RECORDS:return l.joinChannelServiceRecords=[],l;case tt.RESET_KEY_METRICS:return l.keyMetrics={publish:[],subscribe:[],firstVideoFrameDecoded:[]},l;case tt.SET_USE_P2P:return Ee(Ee({},l),{},{useP2P:d.val});case tt.SET_TRANSPORT_TYPE:return Ee(Ee({},l),{},{p2pTransport:d.val});case tt.SET_RTE_URL:return Ee(Ee({},l),{},{rteUrl:d.rteUrl});case tt.SET_RTE_SID:return Ee(Ee({},l),{},{rteSid:d.rteSid});default:return l}}(this.state,o)}get useDcSignal(){return this.state.useDcSignal}set useDcSignal(o){this.state.useDcSignal=o}set autoSubscribe(o){this.state.autoSubscribe=o}get autoSubscribe(){return this.state.autoSubscribe}set enableInstantMuteRestore(o){this.state.enableInstantMuteRestore=o}get enableInstantMuteRestore(){return this.state.enableInstantMuteRestore}set networkQualityProbe(o){this.state.networkQualityProbe=o}get networkQualityProbe(){return this.state.networkQualityProbe}set sessionId(o){this.dispatch({type:tt.SET_SESSION_ID,sessionId:o})}get sessionId(){return this.state.sessionId}set rteUrl(o){this.dispatch({type:tt.SET_RTE_URL,rteUrl:o})}get rteUrl(){return this.state.rteUrl}set rteSid(o){this.dispatch({type:tt.SET_RTE_SID,rteSid:o})}get rteSid(){return this.state.rteSid}set cid(o){this.state.cid=o}get cid(){return this.state.cid}set codec(o){this.state.codec=o}get codec(){return this.state.codec}get mode(){return this.state.mode}get audioCodec(){return this.state.audioCodec}get clientId(){return this.state.clientId}set p2pId(o){this.dispatch({type:tt.SET_P2P_ID,p2pId:o})}get p2pId(){return this.state.p2pId}set dcId(o){this.dispatch({type:tt.SET_DC_ID,dcId:o})}get dcId(){return this.state.dcId}set uid(o){this.dispatch({type:tt.SET_UID,uid:o})}get uid(){return this.state.uid}set intUid(o){this.dispatch({type:tt.SET_INT_UID,intUid:o})}get intUid(){return this.state.intUid}set pubId(o){this.dispatch({type:tt.SET_PUB_ID,pubId:o})}get pubId(){return this.state.pubId}set cloudProxyServerMode(o){this.dispatch({type:tt.SET_CLOUD_PROXY_SERVER_MODE,mode:o})}get cloudProxyServerMode(){return this.state.cloudProxyServerMode}set useP2P(o){this.dispatch({type:tt.SET_USE_P2P,val:o})}get useP2P(){return this.state.useP2P}set p2pTransport(o){this.dispatch({type:tt.SET_TRANSPORT_TYPE,val:o})}get p2pTransport(){return this.state.p2pTransport}set hasStartJoinChannel(o){this.state.hasStartJoinChannel=o}get hasStartJoinChannel(){return this.state.hasStartJoinChannel}set isABTestSuccess(o){this.state.isABTestSuccess=o}get isABTestSuccess(){return this.state.isABTestSuccess}clientCreated(){this.dispatch({type:tt.KEY_METRIC_CLIENT_CREATED,metric:Date.now()})}joinStart(){this.dispatch({type:tt.KEY_METRIC_JOIN_START,metric:Date.now()})}preloadStart(){this.dispatch({type:tt.KEY_METRIC_PRELOAD_START,metric:Date.now()})}preloadEnd(){this.dispatch({type:tt.KEY_METRIC_PRELOAD_END,metric:Date.now()})}joinEnd(){this.dispatch({type:tt.KEY_METRIC_JOIN_END,metric:Date.now()})}requestAPStart(){this.dispatch({type:tt.KEY_METRIC_REQUEST_AP_START,metric:Date.now()})}requestAPEnd(){this.dispatch({type:tt.KEY_METRIC_REQUEST_AP_END,metric:Date.now()})}requestSUAEnd(){this.dispatch({type:tt.KEY_METRIC_REQUEST_SUA_END,metric:Date.now()})}beforeConnect(){this.dispatch({type:tt.KEY_METRIC_BEFORE_CONNECT,metric:Date.now()})}peerReceiver(){this.dispatch({type:tt.KEY_METRIC_PEER_RECEIVER,metric:Date.now()})}signalConnected(){this.dispatch({type:tt.KEY_METRIC_SIGNAL_CONNECTED,metric:Date.now()})}joinReq(){this.dispatch({type:tt.KEY_METRIC_JOIN_REQ,metric:Date.now()})}joinRep(){this.dispatch({type:tt.KEY_METRIC_JOIN_REP,metric:Date.now()})}joinGatewayStart(){this.dispatch({type:tt.KEY_METRIC_JOIN_GATEWAY_START,metric:Date.now()})}joinGatewayEnd(){this.dispatch({type:tt.KEY_METRIC_JOIN_GATEWAY_END,metric:Date.now()})}peerConnectionStart(){this.dispatch({type:tt.KEY_METRIC_PEER_CONNECTION_START,metric:Date.now()})}peerConnectionEnd(){this.dispatch({type:tt.KEY_METRIC_PEER_CONNECTION_END,metric:Date.now()})}firstVideoFrameDecoded(o,l){this.dispatch({type:tt.KEY_METRIC_FIRST_VIDEO_FRAME_DECODED,metric:Ee({userId:o},l)})}descriptionStart(){this.dispatch({type:tt.KEY_METRIC_DESCRIPTION_START,metric:Date.now()})}signalChannelOpen(){this.dispatch({type:tt.KEY_METRIC_SIGNAL_CHANNEL_OPEN,metric:Date.now()})}iceConnectionEnd(){this.dispatch({type:tt.KEY_METRIC_ICE_CONNECTION_END,metric:Date.now()})}publish(o,l,d,h){this.dispatch({type:tt.KEY_METRIC_PUBLISH,metric:Ee(Ee({trackId:o,type:l},d&&{publishStart:d}),h&&{publishEnd:h})})}subscribe(o,l,d,h,f,g,_){this.dispatch({type:tt.KEY_METRIC_SUBSCRIBE,metric:Ee(Ee(Ee(Ee(Ee({userId:o,type:l},d&&{subscribeStart:d}),h&&{subscribeEnd:h}),f&&{firstFrame:f}),g&&{streamAdded:g}),_&&{firstDecoded:_})})}massSubscribe(o,l,d,h){o.forEach(f=>{this.dispatch({type:tt.KEY_METRIC_SUBSCRIBE,metric:Ee(Ee(Ee({userId:f.userId,type:f.type},l&&{subscribeStart:l}),d&&{subscribeEnd:d}),h&&{firstFrame:h})})})}get keyMetrics(){return this.state.keyMetrics}recordJoinChannelService(o,l){o.service==="gateway"&&Array.isArray(o.urls)&&(o.urls=o.urls.map(d=>d.replace(/(\d+)-\d+-\d+-(\d+)/,"$1-*-*-$2")));try{return typeof l!="number"?(this.dispatch({type:tt.RECORD_JOIN_CHANNEL_SERVICE,record:Ee(Ee({},o),{},{sessionId:this.sessionId,cloudProxyMode:this.cloudProxyServerMode,uid:this.uid})}),this.state.joinChannelServiceRecords.length-1):(l<0||l>=this.state.joinChannelServiceRecords.length||this.dispatch({type:tt.RECORD_JOIN_CHANNEL_SERVICE,record:o,index:l}),l)}catch{return 0}}resetJoinChannelServiceRecords(){this.dispatch({type:tt.RESET_JOIN_CHANNEL_SERVICE_RECORDS})}resetKeyMetrics(){this.dispatch({type:tt.RESET_KEY_METRICS})}resetFirstVideoFrameDecoded(){this.dispatch({type:tt.RESET_FIRST_VIDEO_FRAME_DECODED})}get joinChannelServiceRecords(){try{return this.state.joinChannelServiceRecords}catch{return[]}}}(e.codec,e.audioCodec,e.mode,this._clientId,L("SIGNAL_CHANNEL")===1),this._leaveMutex=new Lr("client-leave",this._clientId),this._publishMutex=new Lr("client-publish",this._clientId),this._renewTokenMutex=new Lr("client-renewtoken",this._clientId),this._subscribeMutex=new Lr("client-subscribe",this._clientId),this.store.clientCreated(),e.proxyServer&&this.setProxyServer(e.proxyServer,!0),e.turnServer&&this.setTurnServer(e.turnServer,!0),S.info("[".concat(this._clientId,"] Initializing AgoraRTC client v").concat(Aa," build: ").concat(cR,", mode: ").concat(this.mode,", codec: ").concat(this.codec)),e.clientRoleOptions)try{YT(e.clientRoleOptions),n=Object.assign({},e.clientRoleOptions)}catch(o){S.warning("[".concat(this._clientId,"] ").concat(o.toString()))}var i;this._statsCollector=new Pm(this.store),this._statsCollector.onStatsException=(o,l,d)=>{S.warn("[".concat(this._clientId,"] receive exception msg, code: ").concat(o,", msg: ").concat(l,", uid: ").concat(d)),o===uI.VIDEO_ENCODE_FAILED&&this.localTracks.forEach(h=>{h instanceof Pv&&L("ENABLE_ENCODE_EXCEPTION")&&h.findClosestProfile()}),this.safeEmit(_t.EXCEPTION,{code:o,msg:l,uid:d})},this._statsCollector.onUploadPublishDuration=(o,l,d,h)=>{const f=this._users.find(g=>g.uid===o);f&&(this.store.keyMetrics&&(this.store.firstVideoFrameDecoded(f.uid,{peerPublishDuration:d,peerPubStatusMs:Date.now()}),this._p2pChannel.reportVideoFirstFrameRender(f)),ke.peerPublishStatus(this._sessionId,{subscribeElapse:h,audioPublishDuration:l,videoPublishDuration:d,peer:f._uintid}))},this._statsCollector.onVideoCodecChanged=o=>{if(L("VIDEO_STANDARD_BITRATE_VERSION")&&(o==="av1"||o==="h265"||o==="h264")){const l=this.localTracks.find(d=>d instanceof on);l&&l._saveEncodeBitrateRatio!==1&&l.setSaveEncodeBitrateRatio(o==="h264"?L("BASELINE_MORE_H264_BITRATE_RATIO"):void 0)}},this.store.useP2P=e.mode==="p2p",this._gateway=new eAe(this.store,{clientId:this._clientId,mode:this.mode,codec:this.codec,websocketRetryConfig:e.websocketRetryConfig||qn,httpRetryConfig:e.httpRetryConfig||qn,forceWaitGatewayResponse:e.forceWaitGatewayResponse===void 0||e.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:e.role,clientRoleOptions:n}),this._configDistribute=new dAe(this._clientId,this.store),this.store.useP2P?(this._p2pChannel=(i={store:this.store,statsCollector:this._statsCollector},Po("P2PChannel").create(i)),this._handleP2PEvents()):this._p2pChannel=new Qd(this.store,this._statsCollector),this._handleP2PChannelEvents(),this._handleGatewayEvents(),this._handleGatewaySignalEvents()}async joinMeta(e,t,n,i,o){let l=!(arguments.length>5&&arguments[5]!==void 0)||arguments[5],d=arguments.length>6&&arguments[6]!==void 0&&arguments[6];en("JOIN_GATEWAY_USE_443PORT_ONLY",l),en("JOIN_GATEWAY_USE_DUAL_DOMAIN",d);const h=this._gateway.signal.websocket;return h instanceof YR&&(h.use443PortOnly=l,h.tryDoubleDomain=d),async function(f,g,_){mv.get(f)||mv.set(f,[]),gv.get(f)||gv.set(f,g),Ac.get(f)||Ac.set(f,0);const v=mv.get(f),y=gv.get(f);if(!v||!y)throw new Error("concurrent: deferQueue or maxConcurrency is null");if(Ac.get(f)===y){const U=fm();v.push(U),await U.promise}Ac.set(f,Ac.get(f)+1);for(var b=arguments.length,D=new Array(b>3?b-3:0),I=3;I<b;I++)D[I-3]=arguments[I];const O=await _(...D);return Ac.set(f,Ac.get(f)-1),Ac.get(f)===y-1&&v.length>0&&(v[0].resolve(),v.shift()),Ac.get(f)===0&&(mv.set(f,[]),gv.set(f,0),Ac.set(f,0)),O}("client.join",L("JOIN_MAX_CONCURRENCY"),this.join.bind(this),e,t,n,i,o)}async join(e,t,n,i,o){const l=++this._numberOfJoinCount;this.store.joinStart(),i&&(this.store.uid=i);const d=(bv||bv||(bv=(window.location.protocol.split(":")[0]||"").toUpperCase(),bv))==="HTTPS",h=AF()?window.isSecureContext:"Browser Not Support";(!AF()&&!d||!window.isSecureContext)&&S.warning("The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser");let f;ke.setAppId(e);try{if(!n&&n!==null)throw new se(P.INVALID_PARAMS,"Invalid token: ".concat(n,". If you don not use token, set it to null"));if(n&&Kr(n,"token",1,2047),Kr(e,"appid",1,2047),zv(t),i&&qv(i),o)if(typeof o=="string")Kr(o,"optionalInfo",1,256),f=o;else{if(typeof o!="object")throw new se(P.INVALID_PARAMS,"Invalid options: options is not a string or object");{const{autoSubscribe:O,enableInstantMuteRestore:U,networkQualityProbe:j}=o;O&&(za(O,"autoSubscribe"),S.info("[".concat(this._clientId,"] join: autoSubscribe: ").concat(O)),this.store.autoSubscribe=O),U&&(za(U,"enableInstantMuteRestore"),S.info("[".concat(this._clientId,"] join: enableInstantMuteRestore: ").concat(U)),this.store.enableInstantMuteRestore=U),j&&(za(j,"networkQualityProbe"),S.info("[".concat(this._clientId,"] join: networkQualityProbe: ").concat(j)),this.store.networkQualityProbe=j)}}}catch(O){throw ke.reportApiInvoke(Td(),{name:yn.JOIN,options:[e,t,n,i],states:{isHttps:d,isSecureContext:h},tag:an.TRACER}).onError(O),O}if(this._leaveMutex.isLocked&&(S.debug("[".concat(this._clientId,"] join: waiting leave operation")),(await this._leaveMutex.lock())(),S.debug("[".concat(this._clientId,"] join: continue"))),this._joinAndNotLeaveYet=!0,this.connectionState!=="DISCONNECTED"){const O=new se(P.INVALID_OPERATION,"[".concat(this._clientId,"] Client already in connecting/connected state"));throw ke.reportApiInvoke(Td(),{name:yn.JOIN,options:[e,t,n,i],states:{isHttps:d,isSecureContext:h},tag:an.TRACER}).onError(O),O}this._gateway.state="CONNECTING",this.store.preloadStart();const g=await NI({appId:e,cname:t,uid:i,stringUid:typeof i=="string"?i:void 0,token:n||e,cloudProxyServer:this._cloudProxyServerMode});if(this.store.preloadEnd(),!this._joinAndNotLeaveYet)throw new se(P.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));const _=(g==null?void 0:g.sid)||Td();S.info("[".concat(this._clientId,"] start join channel ").concat(t,", join number: ").concat(l)),this._sessionId||(this._sessionId=_,this.store.sessionId=this._sessionId);const v=ke.reportApiInvoke(this._sessionId,{id:this._clientId,name:yn.JOIN,options:[e,t,n,i],states:{isHttps:d,isSecureContext:h},tag:an.TRACER}),y=so(so(so({},this._rtmConfig),{},{role:this.role,clientId:this._clientId,appId:e,sid:this._sessionId,cname:t,uid:typeof i!="string"?i:null,turnServer:this._turnServer,proxyServer:this._proxyServer,token:n||e,cloudProxyServer:this._cloudProxyServerMode,optionalInfo:f,license:this._license,useLocalAccessPoint:this._useLocalAccessPoint,preload:!!g},this._remoteDefaultVideoStreamType!==void 0&&{defaultVideoStream:this._remoteDefaultVideoStreamType}),{},{apRequestDetail:L("AP_REQUEST_DETAIL")||void 0});if(this._useLocalAccessPoint&&(y.setLocalAPVersion=this._setLocalAPVersion),typeof i=="string"&&(y.stringUid=i,this._uintUid?(y.uid=this._uintUid,this._uintUid=void 0):y.uid=0),this._encryptionMode!=="none"&&this._encryptionSecret){if(y.aesmode=this._encryptionMode,y.aespassword=await(async O=>{const U=function(Z){const X=window.atob(`MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu
STM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+
HvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy
xQiYDz3vqa6bP29adwIDAQAB`),ee=new Uint8Array(new ArrayBuffer(X.length));for(let le=0;le<X.length;le+=1)ee[le]=X.charCodeAt(le);return ee}(),j=await window.crypto.subtle.importKey("spki",U,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),G=KT(O),$=await window.crypto.subtle.encrypt({name:"RSA-OAEP"},j,G);return function(Z){let X="";for(let ee=0;ee<Z.length;ee+=1)X+=String.fromCharCode(Z[ee]);return window.btoa(X)}(new Uint8Array($))})(this._encryptionSecret),!this._joinAndNotLeaveYet)throw new se(P.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this._encryptionSalt&&(y.aessalt=this._encryptionSalt)}if(this._encryptDataStream&&(this._encryptionMode==="aes-128-gcm2"||this._encryptionMode==="aes-256-gcm2"))if(this._encryptionSalt&&this._encryptionSecret)if(window.crypto.subtle){const O=new TextEncoder,U=L("USE_PURE_ENCRYPTION_MASTER_KEY")?O.encode(y.appId+this._encryptionSecret+this._encryptionSecret):O.encode(y.appId+y.cname+this._encryptionSecret);this._encryptDataStreamIv=await async function(j,G,$){const Z=await window.crypto.subtle.importKey("raw",G,"PBKDF2",!1,["deriveBits","deriveKey"]),X=j==="aes-128-gcm2"?128:256,ee=await window.crypto.subtle.deriveBits({name:"PBKDF2",iterations:vF,hash:"SHA-256",salt:$},Z,X+Dce);return new Uint8Array(ee).subarray(X/8)}(this._encryptionMode,U,Cd(this._encryptionSalt)),this._encryptDataStreamKey=await async function(j,G,$){const Z=await window.crypto.subtle.importKey("raw",G,"PBKDF2",!1,["deriveBits","deriveKey"]),X=j==="aes-128-gcm2"?128:256;return await window.crypto.subtle.deriveKey({name:"PBKDF2",iterations:vF,hash:"SHA-256",salt:$},Z,{name:"AES-GCM",length:X},!0,["encrypt","decrypt"])}(this._encryptionMode,U,Cd(this._encryptionSalt))}else h?S.warning("[".concat(this._clientId,"] encrypt datastream must be running in a secure context, fallback to plain data stream")):S.warning("[".concat(this._clientId,"] current browser do not support WebCrypto ,fallback to plain data stream")),this._encryptDataStream=!1;else this._encryptDataStream=!1,S.debug("[".concat(this._clientId,"] no salt / secret, cannot support encrypt data stream, fallback to plain data stream"));this._startSession(this._sessionId,{channel:t,appId:e,stringUid:y.stringUid});const b=this._sessionId;setTimeout(()=>{this.connectionState==="CONNECTING"&&b===this._sessionId&&ke.joinChannelTimeout(this._sessionId,5)},5e3);try{var D;let O;const U=y.cloudProxyServer;if(me(D=["proxy3","proxy4","proxy5"]).call(D,U)){const X=L("PROXY_SERVER_TYPE3");Array.isArray(X)?y.proxyServer=X[0]:y.proxyServer=X}if(ke.setProxyServer(y.proxyServer),S.setProxyServer(y.proxyServer),this.store.requestAPStart(),g){if(S.debug("[".concat(this._clientId,"] get serverInfo Success from Preload Cache ").concat(y.stringUid?", ".concat(y.stringUid," => ").concat(g.intUid):""," ")),y.stringUid&&!y.uid&&(y.uid=g.intUid),O={gatewayInfo:g.ap.gatewayInfo},L("JOIN_WITH_FALLBACK_MEDIA_PROXY")&&y.turnServer.mode==="auto")if(g.ap.proxyInfo.addresses.length===0)S.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers");else{const X=(await cV(g.ap.proxyInfo,g.ap.gatewayInfo.uid)).map(ee=>({turnServerURL:ee.address,tcpport:ee.tcpport||$r.tcpport,udpport:ee.udpport||$r.udpport,username:ee.username||$r.username,password:ee.password||$r.password,forceturn:!1,security:!0}));y.turnServer={mode:"manual",servers:X}}mQ(g,y.stringUid)}else{if(y.stringUid&&!y.uid){let X;[X,O]=await be.all([UV(y.stringUid,y,this._axiosCancelSource.token,this._config.httpRetryConfig||qn,this.store).finally(()=>{this.store.requestSUAEnd()}),LV(y,this._axiosCancelSource.token,this._config.httpRetryConfig||qn,!0,this.store).finally(()=>{this.store.requestAPEnd()})]),S.debug("[".concat(this._clientId,"] getUserAccount Success ").concat(y.stringUid," => ").concat(X)),y.uid=X,O.gatewayInfo.uid=X,O.gatewayInfo.res.uid=X}else O=await LV(y,this._axiosCancelSource.token,this._config.httpRetryConfig||qn,!0,this.store);if(!this._joinAndNotLeaveYet)throw new se(P.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"))}this.store.requestAPEnd(),setTimeout(()=>{this._configDistribute.startGetConfigDistribute(y,this._axiosCancelSource.token),this._configDistribute.on(Lo.UPDATE_BITRATE_LIMIT,X=>{this._p2pChannel.updateBitrateLimit(X)}),this._configDistribute.on(Lo.UPDATE_CLIENT_ROLE_OPTIONS,X=>{this._setClientRoleOptions(X)}),this._configDistribute.on(Lo.UPDATE_REMOTE_VIDEO_STREAM_TYPE,X=>{var ee;me(ee=[0,1,4,5,6,7,8,9]).call(ee,X)&&(this.remoteUsers.forEach(le=>{this._remoteStreamTypeCacheMap.get(le.uid)!==X&&this.setRemoteVideoStreamType(le.uid,X)}),this.setRemoteDefaultVideoStreamType(X))}),this._configDistribute.on(Lo.FALLBACK_TO_HLS,X=>{X&&this.safeEmit(_t.FALLBACK_TO_HLS,zT.CONFIG)}),this._configDistribute.on(Lo.UPDATE_VOS_CONFIGURE,X=>{this._gateway.setConfigure(X).catch(ee=>{S.debug("[".concat(this._clientId,"] auto set vos config failed"),ee)})})},0),this._key=n||e;const j=O.gatewayInfo,G=y.uid?y.uid:j.uid;this._joinInfo=so(so({},y),{},{cid:j.cid,uid:G,vid:j.vid,apResponse:j.res,apGatewayAddress:j.apGatewayAddress,uni_lbs_ip:j.uni_lbs_ip,gatewayAddrs:j.gatewayAddrs}),this.store.intUid=G,this.store.cid=j.cid;const $=await this._joinGateway();if(!this._joinAndNotLeaveYet)throw new se(P.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));v.onSuccess($),this._appId=e,this._channelName=y.cname,this._uid=$,this.store.uid=$,setTimeout(()=>{this._networkQualityInterval&&window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=window.setInterval(this._handleUpdateNetworkQuality,2e3),!kr()&&this.store.useDcSignal?(window.addEventListener("beforeunload",this._handleBeforeUnload),window.addEventListener("pagehide",this._handleBeforeUnload)):window.addEventListener(kr()?"beforeunload":"pagehide",this._handleBeforeUnload),this._statsCollector.startUpdateStats()},0);const Z=y.stringUid?"string uid: ".concat(y.stringUid,",uid: ").concat(y.uid):"uid: ".concat(this._uid);return S.info("[".concat(this._clientId,"] Joining channel success: channel: ").concat(t,",").concat(Z)),setTimeout(()=>{S.startUpload()},5e3),this.store.joinEnd(),I=this,me(Ld).call(Ld,I)||Ld.push(I),this._cloudProxyServerMode==="disabled"&&wt().supportWebCrypto&&L("ENABLE_PRELOAD")&&xI(this._joinInfo),this._rteDetailInterval&&(window.clearInterval(this._rteDetailInterval),this._rteDetailInterval=void 0),this._sessionId&&ke.reportRteDetail(this._sessionId),this._rteDetailInterval=window.setInterval(()=>{this._sessionId&&ke.reportRteDetail(this._sessionId)},L("RTE_DETAIL_REPORT_INTERVAL")||6e4),$}catch(O){const U=Array.isArray(O)?O[0]:O;throw U&&U.code===P.OPERATION_ABORTED?S.warning("[".concat(this._clientId,"] join number: ").concat(l,", Joining channel failed, rollback"),U):S.error("[".concat(this._clientId,"] join number: ").concat(l,", Joining channel failed, rollback"),U),U.code!==P.OPERATION_ABORTED&&this._numberOfJoinCount===l&&(this._gateway.state="DISCONNECTED",this._reset()),v.onError(U),U}var I}async _joinGateway(){if(!this._joinInfo||!this._key)throw new se(P.INVALID_OPERATION);try{return await this._gateway.join(this._joinInfo,this._key,!(this._joinInfo.cloudProxyServer!=="disabled"||this._joinInfo.proxyServer||!L("JOIN_WITH_FALLBACK_SIGNAL_PROXY")))}catch(e){if(e.code===P.INIT_DATACHANNEL_TIMEOUT){if(this._gateway.leave(!0,Ct.FALLBACK),S.debug("[".concat(this._clientId,"] join by datachannel timeout, fallback to websocket")),!this._joinInfo||!this._key)throw new se(P.INVALID_OPERATION);return ke.reportApiInvoke(this._sessionId,{name:yn.DATACHANNEL_FAILBACK,options:[this.store.clientId],tag:an.TRACER}).onSuccess(),await this._joinGateway()}throw e}}async leave(){S.info("[".concat(this._clientId,"] Leaving channel"));const e=()=>{!kr()&&this.store.useDcSignal?(window.addEventListener("beforeunload",this._handleBeforeUnload),window.addEventListener("pagehide",this._handleBeforeUnload)):window.addEventListener(kr()?"beforeunload":"pagehide",this._handleBeforeUnload),this._reset(),function(n){const i=Ld.indexOf(n);i!==-1&&Ld.splice(i,1)}(this),this._statsCollector.stopUpdateStats()};this.store.useDcSignal||e();const t=await this._leaveMutex.lock();if(this.connectionState==="DISCONNECTED")return S.info("[".concat(this._clientId,"] Leaving channel repeated, success")),void t();await this._gateway.leave(this.connectionState!=="CONNECTED",Ct.LEAVE),S.info("[".concat(this._clientId,"] Leaving channel success")),this._joinAndNotLeaveYet=!1,this.store.resetJoinChannelServiceRecords(),t(),this.store.useDcSignal&&e()}async publish(e){let t=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!Array.isArray(e)){if(!(e instanceof Uh))return this._publishDataChannel(e);e=[e]}if(e.length===0)throw new se(P.INVALID_PARAMS,"param list is empty");const n=e;if(this._gateway.role==="audience")throw new se(P.INVALID_OPERATION,"audience can not publish stream");for(const o of n){if(!(o instanceof Uh))throw new se(P.INVALID_PARAMS,"parameter is not local track");if(!o._enabled&&t)throw new se(P.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(o.getTrackId()))}S.info("[".concat(this._clientId,"] Publishing tracks, id ").concat(n.map(o=>"".concat(o.getTrackId()," "))));const i=await this._publishMutex.lock();await this._configDistribute.awaitConfigDistributeComplete(),t&&n.forEach(o=>{const l=this._configDistribute.getBitrateLimit();o instanceof on&&l&&o.setBitrateLimit(l.uplink)});try{await this._publishHighStream(n),S.info("[".concat(this._clientId,"] Publish success, id ").concat(n.map(o=>"".concat(o.getTrackId()," "))))}catch(o){throw S.error("[".concat(this._clientId,"] publish error"),o.toString()),o}finally{i()}}async _publishDataChannel(e){if(e==null)throw new se(P.INVALID_PARAMS,"parameter is not local track or datachannel config, config is ".concat(JSON.stringify(e)));sn(e.id,"id",0,65535,!0),za(e.ordered,"ordered"),Kr(e.metadata,"metadata",0,512),S.info("[".concat(this._clientId,"] Publishing datachannels, id ").concat(e.id));const t=await this._publishMutex.lock();try{if(this._p2pChannel.getAllDataChannels().findIndex(o=>o.id===e.id)!==-1)throw new se(P.INVALID_PARAMS,"Invalid id: ".concat(e.id,". If you want to republish the datachannel, unpublish first"));if(!this._joinInfo||this._uid===void 0)throw new se(P.INVALID_OPERATION,"Can't publish datachannel, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new se(P.INVALID_OPERATION,"can not publish datachannel in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&L("FORCE_TURN")&&!L("TURN_ENABLE_TCP")&&!L("TURN_ENABLE_UDP"))throw new se(P.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");const n=function(o){return TV(o,!1)}(e),i=await this._p2pChannel.publishDataChannel([n]);if(i.length>0){if(typeof n._originDataChannelId!="number")throw S.error("[".concat(this._clientId,"] can not publish with mediaType datachannel, cannot get RTCDatachannel id")),new se(P.CREATE_DATACHANNEL_ERROR);try{await be.all(i.map(o=>this._uid&&this._gateway.publishDataChannel(this._uid,o,!0))),await n._waitTillOpen()}catch(o){if(o.code!==P.DISCONNECT_P2P)throw o}}return S.info("[".concat(this._clientId,"] Publish dataChannels success, id ").concat(n.id)),n}catch(n){throw S.error("[".concat(this._clientId,"] publish datachannels error"),n.toString()),n}finally{t()}}async unpublish(e){if(!this._joinInfo||this._uid===void 0)throw new se(P.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");let t=[];if(e)if(Array.isArray(e))t=e;else{if(!(e instanceof Uh))return this._unpublishDataChannel([e]);t=[e]}else this.store.useP2P||await this._unpublishDataChannel(),t=this._p2pChannel.getAllTracks(!0);S.info("[".concat(this._clientId,"] Unpublish tracks, tracks ").concat(t.map(i=>"".concat(i.getTrackId()," "))," "));const n=await this._publishMutex.lock();try{if(this.store.useP2P){const i=await this._p2pChannel.unpublish(t);i&&await this._gateway.sendExtensionMessage(Kn.UNPUBLISH,{unpubMsg:i},!0)}else{const i=await this._p2pChannel.unpublish(t);i&&await this._gateway.unpublish(i,this._uid),S.info("[".concat(this._clientId,"] Unpublish success,tracks ").concat(t.map(o=>"".concat(o.getTrackId()))))}}catch(i){throw S.error("[".concat(this._clientId,"] unpublish error"),i.toString()),i}finally{n&&n()}}async _unpublishDataChannel(e){e!==void 0&&e.length!==0||(e=this._p2pChannel.getAllDataChannels()),S.info("[".concat(this._clientId,"] Unpublish datachannels, datachannels ").concat(e.map(n=>"".concat(n.id," "))," "));const t=await this._publishMutex.lock();try{const n=await this._p2pChannel.unpublishDataChannel(e);n&&await this._gateway.unpublishDataChannel(n),S.info("[".concat(this._clientId,"] Unpublish dataChannel success,dataChannel ").concat(e.map(i=>"".concat(i.id))))}catch(n){throw S.error("[".concat(this._clientId,"] unpublish dataChannel error"),n.toString()),n}finally{t&&t()}}async subscribe(e,t,n){if(!(e instanceof $l)){const i=this.remoteUsers.find(o=>o.uid===e);if(!i)throw new se(P.INVALID_REMOTE_USER,"user is not in the channel");e=i}return t==="datachannel"?this._subscribeDataChannel(e,n):this._subscribe(e,t)}async presubscribe(e,t){if(zn(t,"mediaType",["audio","video"]),this.store.useP2P)throw new se(P.INVALID_OPERATION,"can't presub at p2p mode");if(!this._joinInfo)throw new se(P.INVALID_OPERATION,"can't presub when not join");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new se(P.INVALID_OPERATION,"can't presub in ".concat(this.connectionState," state"));const n=t===xe.AUDIO,i=t===xe.VIDEO,o=await this._subscribeMutex.lock();try{const{ssrcId:l,ortc:d,rtxSsrcId:h,cname:f,uint_id:g}=await this._gateway.presubscribe(e,t,!0);if(l==null)throw new se(P.UNEXPECTED_RESPONSE,"no ssrc id");let _=this._users.find(y=>y.uid===e);_||(_=new $l(e,g||e),_._is_pre_created=!0,this._users.push(_)),f&&(_._cname=f),_._uintid||(_._uintid=g||e),n&&(_._audioSSRC=l,_._audio_pre_subscribed=!0,d&&(_._audioOrtc=d)),i&&(_._videoSSRC=l,_._video_pre_subscribed=!0,d&&(_._videoOrtc=d),h!=null&&(_._rtxSsrcId=h)),S.info("[".concat(this._clientId,"] presub succeed ssrc: ").concat(l)),await this._p2pChannel.subscribe(_,t,l,h,d);const v=n?_._audioTrack:_._videoTrack;if(!v)throw new se(P.UNEXPECTED_ERROR,"can not find remote track in user");return n&&(_._trust_audio_stream_added_state_=!0,_._audio_added_=!0),i&&(_._trust_video_stream_added_state_=!0,_._video_added_=!0),v}catch(l){throw S.error("[".concat(this._clientId,"] presub user ").concat(e," error"),l),l}finally{o()}}async _subscribeDataChannel(e,t){var n;if(sn(t,"channelId",0,65535,!0),!this._joinInfo)throw new se(P.INVALID_OPERATION,"Can't subscribe datachannel, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new se(P.INVALID_OPERATION,"Can't subscribe datachannel in ".concat(this.connectionState," state"));if(!this._users.find(h=>h===e))throw S.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),new se(P.INVALID_REMOTE_USER,"user is not in the channel");if(!e.hasAudio&&!e.hasVideo&&e._dataChannels.length===0)throw S.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),new se(P.INVALID_REMOTE_USER,"user is not published");const o=(n=e._dataChannels)===null||n===void 0?void 0:n.find(h=>h.id===t);if(!o)throw S.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, remote datachannel is not published")),new se(P.REMOTE_USER_IS_NOT_PUBLISHED);const l=await this._subscribeMutex.lock();S.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: datachannel"));try{const h=await this._p2pChannel.subscribeDataChannel(e,[o]);if(h&&me(h).call(h,o.id))try{var d;if(typeof o._originDataChannelId!="number")throw S.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, cannot get RTCDatachannel")),new se(P.CREATE_DATACHANNEL_ERROR);const f={id:o.id,datachannelId:o._originDataChannelId,ordered:o.ordered,maxRetransmits:o.maxRetransmits,metadata:(d=o.metadata)!==null&&d!==void 0?d:""};await this._gateway.subscribeDataChannel(e.uid,f,!0),await o._waitTillOpen()}catch(f){if((f==null?void 0:f.code)!==P.WS_ABORT)throw await this._p2pChannel.unsubscribeDataChannel(e,[o]),f;await this._p2pChannel.unsubscribeDataChannel(e,[o]),this._p2pChannel.setPendingRemoteDataChannel(e,o.id)}return S.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: datachannel")),o}finally{l()}}async _p2pSubscribe(e,t,n){if(zn(t,"mediaType",["audio","video"]),!this._joinInfo)throw new se(P.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new se(P.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(l=>l===e)){const l=new se(P.INVALID_REMOTE_USER,"user is not in the channel");throw S.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),l}if(!e.hasAudio&&!e.hasVideo){const l=new se(P.INVALID_REMOTE_USER,"user is not published");throw S.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),l}if(!n&&(t==="audio"&&!e.hasAudio||t==="video"&&!e.hasVideo)){const l=new se(P.REMOTE_USER_IS_NOT_PUBLISHED);throw S.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(t,", remote track is not published")),l}const o=await this._subscribeMutex.lock();S.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(t));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,t))await this._p2pChannel.unmuteRemote(e,t);else try{const d=t==="audio"?e._audioSSRC:e._videoSSRC,h=t==="audio"?e._audioMid:e._videoMid;this.store.subscribe(e.uid,t,Date.now()),this.store.useP2P&&await this._p2pChannel.subscribe(e,t,d,h)}catch(d){throw d}S.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(t)),this._defaultStreamFallbackType!==void 0&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch(d=>{S.warning("[".concat(this._clientId,"] auto set fallback failed"),d)});const l=t==="audio"?e._audioTrack:e._videoTrack;if(!l)throw new se(P.UNEXPECTED_ERROR,"can not find remote track in user object");return l}catch(l){throw S.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),l),l}finally{o()}}async _subscribe(e,t,n){if(this.store.useP2P)return this._p2pSubscribe(e,t);if(zn(t,"mediaType",["audio","video"]),!this._joinInfo)throw new se(P.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new se(P.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(g=>g===e)){const g=new se(P.INVALID_REMOTE_USER,"user is not in the channel");throw S.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),g}if(!e.hasAudio&&!e.hasVideo){const g=new se(P.INVALID_REMOTE_USER,"user is not published");throw S.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),g}if(!(n||(t!=="audio"||e.hasAudio&&e._audioSSRC!==void 0)&&(t!=="video"||e.hasVideo&&e._videoSSRC!==void 0))){const g=new se(P.REMOTE_USER_IS_NOT_PUBLISHED);throw S.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(t,", remote track is not published")),g}let o=t==="audio"?e._audioSSRC:e._videoSSRC,l=t==="audio"?e._audioOrtc:e._videoOrtc,d=t==="video"?e._rtxSsrcId:void 0,h={stream_type:t==="audio"?xe.AUDIO:xe.VIDEO,ssrcId:o};t==="video"&&this.store.firstVideoFrameDecoded(e.uid,{subscribeStart:Date.now()});const f=await this._subscribeMutex.lock();S.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(t));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,t))await this._p2pChannel.unmuteRemote(e,t);else try{const _=t==="audio"?e._audioSSRC:e._videoSSRC;_!==void 0&&_!==o&&(o=_,l=t==="audio"?e._audioOrtc:e._videoOrtc,d=t==="video"?e._rtxSsrcId:void 0,h={stream_type:t==="audio"?xe.AUDIO:xe.VIDEO,ssrcId:o}),os.markSubscribeStart(this.store.clientId,o),this.store.subscribe(e.uid,t,Date.now()),await this._p2pChannel.subscribe(e,t,o,d,l);try{this._p2pChannel.isPreSubScribe(o)||await this._gateway.subscribe(e.uid,h,!0)}catch(v){if((v==null?void 0:v.code)!==P.WS_ABORT)throw await this._p2pChannel.unsubscribe(e,t),v;await this._p2pChannel.unsubscribe(e,t,!0),this._p2pChannel.setPendingRemoteMedia(e,t)}this.store.subscribe(e.uid,t,void 0,Date.now()),this._p2pChannel.reportSubscribeEvent(!0,null,e,t)}catch(_){throw this._p2pChannel.reportSubscribeEvent(!1,_==null?void 0:_.code,e,t),_}S.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(t)),this._defaultStreamFallbackType!==void 0&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch(_=>{S.warning("[".concat(this._clientId,"] auto set fallback failed"),_)});const g=t==="audio"?e._audioTrack:e._videoTrack;if(!g)throw new se(P.UNEXPECTED_ERROR,"can not find remote track in user object");return t==="video"&&(this.store.firstVideoFrameDecoded(e.uid,{subscribeEnd:Date.now()}),this._p2pChannel.reportVideoFirstFrameRender(e)),g}catch(g){throw S.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),g),g}finally{f()}}async massSubscribe(e){if(Wc(e,"subscribeList"),!this._joinInfo)throw new se(P.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new se(P.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));const t=Date.now(),n=new Map,i=await this._subscribeMutex.lock();S.info("[".concat(this._clientId,"]start massSubscribe user ").concat(e.map(h=>{let{user:f,mediaType:g}=h;return"user: ".concat(f==null?void 0:f.uid,", mediaType: ").concat(g)}).join("; ")));const o=(e=[...e]).map(h=>{let{user:f,mediaType:g}=h;return{user:f,mediaType:g}}),l=await this._p2pChannel.globalLock();try{var d;for(let f=e.length-1;f>=0;f--){const g=e[f],{user:_,mediaType:v}=g;if(zn(v,"mediaType",["audio","video"]),!_){const I=new se(P.INVALID_PARAMS,"user property does not exist in subscribeList item");throw S.error("[".concat(this._clientId,"] user property does not exist in subscribeList item")),I}if(!this._users.find(I=>I===_)){const I=new se(P.INVALID_REMOTE_USER,"user is not in the channel");S.error("[".concat(this._clientId,"] can not massSubscribe ").concat(_.uid,", this user is not in the channel")),o[f].error=I,e.splice(f,1);continue}if(v==="audio"&&(!_.hasAudio||_._audioSSRC===void 0)||v==="video"&&(!_.hasVideo||_._videoSSRC===void 0)){const I=new se(P.REMOTE_USER_IS_NOT_PUBLISHED);S.error("[".concat(this._clientId,"] can not subscribe ").concat(_.uid," with mediaType ").concat(v,", remote user is not published")),o[f].error=I,e.splice(f,1);continue}const b=Tr.Video|Tr.LwoVideo,D=n.get(_);if(D){if(v==="video"?D&b:D&Tr.Audio){e.splice(f,1),S.warning("[".concat(this._clientId,"] repeat massSubscribe user:").concat(_.uid,", mediaType:").concat(v," twice"));continue}n.set(_,D|(v==="video"?b:Tr.Audio))}else n.set(_,v==="video"?b:Tr.Audio)}for(let f=e.length-1;f>=0;f--){const g=e[f],{user:_,mediaType:v}=g,y=Tr.Video|Tr.LwoVideo;if(this._p2pChannel.hasRemoteMedia(_,v)){await this._p2pChannel.unmuteRemoteNoLock(_,v);const b=n.get(_);n.set(_,v==="video"?b^y:b^Tr.Audio),e.splice(f,1)}}this.store.massSubscribe(e.map(f=>({userId:f.user.uid,type:f.mediaType})),t);let h=ca(d=Array.from(n.entries())).call(d,(f,g)=>{let[_,v]=g;if(v===0)return f;const y={stream_id:_.uid,stream_type:v};return v&Tr.Audio&&(y.audio_ssrc=_._audioSSRC),v&Tr.Video&&(y.video_ssrc=_._videoSSRC),f.push(y),f},[]);try{e.length>0&&await this._p2pChannel.massSubscribeNoLock(e.map(g=>{let{user:_,mediaType:v}=g;return{user:_,mediaType:v,ssrcId:v===xe.VIDEO?_._videoSSRC:_._audioSSRC,rtxSsrcId:v===xe.VIDEO?_._rtxSsrcId:void 0}}));const f=new Map;if(h=h.filter(g=>g.video_ssrc&&!this._p2pChannel.isPreSubScribe(g.video_ssrc)||g.audio_ssrc&&!this._p2pChannel.isPreSubScribe(g.audio_ssrc)||!g.video_ssrc&&!g.audio_ssrc),h.length>0){const g=await this._gateway.subscribeAll(h,!0);((g==null?void 0:g.users)||[]).forEach(_=>{let{stream_id:v,video_error_code:y,audio_error_code:b,error_code:D}=_;(y||b||D)&&f.set(v,{video_error_code:y,audio_error_code:b,error_code:D})})}if(Array.from(f.entries()).length>0){const g=[];Array.from(f.entries()).forEach(_=>{let[v,y]=_;const b=this.remoteUsers.find(D=>D.uid===v);if(b){let D;y.error_code||y.video_error_code&&y.audio_error_code?D=void 0:y.video_error_code?D=xe.VIDEO:y.audio_error_code&&(D=xe.AUDIO),g.push({user:b,mediaType:D})}}),g.length>0&&await this._p2pChannel.massUnsubscribeNoLock(g)}for(const g of o){const _=f.get(g.user.uid);if(_){const v=_.error_code||g.mediaType==="audio"&&_.audio_error_code||g.mediaType==="video"&&_.video_error_code;if(v){const y=Md(v);S.error("user:".concat(g.user.uid," mediaType:").concat(g.mediaType," has massSubscribe error ").concat(y.desc)),g.error=new se(P.SUBSCRIBE_FAILED,"code ".concat(v,": ").concat(y.desc))}}g.error||(g.mediaType==="video"?g.track=g.user.videoTrack:g.track=g.user.audioTrack)}return this.store.massSubscribe(o.filter(g=>!g.error).map(g=>({userId:g.user.uid,type:g.mediaType})),void 0,Date.now()),o.forEach(g=>{var _;ke.subscribe(this.store.sessionId,{succ:!!g.error,ec:((_=g.error)===null||_===void 0?void 0:_.code)||null,video:g.mediaType===xe.VIDEO,audio:g.mediaType===xe.AUDIO,peerid:g.user.uid,subscribeRequestid:g.mediaType===xe.VIDEO?g.user._videoSSRC:g.user._audioSSRC,p2pid:this.store.p2pId,eventElapse:Math.floor(performance.now()-t),preSsrc:this._p2pChannel.isPreSubScribe(g.user._videoSSRC)},!0)}),S.info("[".concat(this._clientId,"] massSubscribe success ").concat(e.map(g=>{let{user:_,mediaType:v}=g;return"user: ".concat(_==null?void 0:_.uid,", mediaType: ").concat(v)}).join("; "))),o}catch(f){throw await this._p2pChannel.massUnsubscribeNoLock(e),f}}finally{l(),i()}}async unsubscribe(e,t,n){if(!(e instanceof $l)){const l=this.remoteUsers.find(d=>d.uid===e);if(!l)throw new se(P.INVALID_REMOTE_USER,"user is not in the channel");e=l}if(t||this.store.useP2P){if(t==="datachannel")return this._unsubscribeDataChannel(e,n)}else await this._unsubscribeDataChannel(e,n);if(t&&zn(t,"mediaType",["audio","video"]),!this._joinInfo)throw new se(P.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");if(!this._users.find(l=>l===e)){const l=new se(P.INVALID_REMOTE_USER,"user is not in the channel");throw S.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),l}S.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: ").concat(t));const o=await this._subscribeMutex.lock();try{if(this.store.useP2P)await this._p2pChannel.unsubscribe(e,t);else{const l=await this._p2pChannel.unsubscribe(e,t);l&&await this._gateway.unsubscribe(l,e.uid),t&&t!=="audio"||(e._audio_pre_subscribed=!1),t&&t!=="video"||(e._video_pre_subscribed=!1),e._is_pre_created&&vv(this._users,e),S.info("[".concat(this._clientId,"] unsubscribe success uid: ").concat(e.uid,", mediaType: ").concat(t))}}catch(l){if(l.code===P.DISCONNECT_P2P)return void S.warning("disconnecting p2p, abort unsubscribe request.");throw S.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),l.toString()),l}finally{o()}}async _unsubscribeDataChannel(e,t){if(t&&sn(t,"id",0,65535,!0),!this._joinInfo)throw new se(P.INVALID_OPERATION,"Can't unsubscribe datachannel, haven't joined yet!");if(!this._users.find(o=>o===e)){const o=new se(P.INVALID_REMOTE_USER,"user is not in the channel");throw S.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),o}let i;if(typeof t=="number"){const o=e._dataChannels.find(l=>l.id===t);o&&(i=[o])}else i=e._dataChannels;if(i===void 0){const o=new se(P.REMOTE_USER_IS_NOT_PUBLISHED);throw S.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid," with channelId ").concat(t,", remote datachannel is not published")),o}S.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(i.map(o=>o.id)));try{const o=await this._p2pChannel.unsubscribeDataChannel(e,i);o&&await this._gateway.unsubscribeDataChannel(o,e.uid),S.info("[".concat(this._clientId,"] unsubscribe datachannel success uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(o))}catch(o){if(o.code===P.DISCONNECT_P2P)return void S.warning("disconnecting p2p, abort unsubscribe request.");throw S.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),o.toString()),o}}async massUnsubscribe(e){if(Wc(e,"unsubscribeList"),!this._joinInfo)throw new se(P.INVALID_OPERATION,"Can't unsubscribeAll stream, haven't joined yet!");S.info("[".concat(this._clientId,"] start massUnsubscribe ").concat(e.map(n=>{let{user:i,mediaType:o}=n;return"user: ".concat(i==null?void 0:i.uid,", mediaType: ").concat(o,";")}).join())),e=[...e];const t=new Map;for(let n=e.length-1;n>=0;n--){const{user:i,mediaType:o}=e[n];if(!i){const h=new se(P.INVALID_PARAMS,"user property does not exist in unsubscribeList item");throw S.error("[".concat(this._clientId,"] user property does not exist in unsubscribeList item")),h}if(zn(o,"mediaType",["video","audio",void 0]),!this._users.find(h=>h===i)){S.warning("[".concat(this._clientId,"] can not unsubscribe ").concat(i.uid,", user is not in the channel")),e.splice(n,1);continue}const d=Tr.Video|Tr.LwoVideo;if(t.has(i)){const h=t.get(i);let f;switch(o){case"video":f=h&d;break;case"audio":f=h&Tr.Audio;break;default:f=h&(Tr.Audio|d)}if(f){S.warning("[".concat(this._clientId,"] repeat massUnsubscribe user:").concat(i.uid,",mediaType:").concat(o," twice.")),e.splice(n,1);continue}o?o==="audio"?t.set(i,h|Tr.Audio):o==="video"&&t.set(i,h|d):t.set(i,h|Tr.Audio|d)}else o?o==="audio"?t.set(i,Tr.Audio):o==="video"&&t.set(i,d):t.set(i,Tr.Audio|d)}try{const n=await this._p2pChannel.massUnsubscribe(e);n&&await this._gateway.massUnsubscribe(n),S.info("[".concat(this._clientId,"] massUnsubscribe success ").concat(e.map(i=>{let{user:o,mediaType:l}=i;return"user: ".concat(o==null?void 0:o.uid,", mediaType: ").concat(l,";")}).join()))}catch(n){if(n.code===P.DISCONNECT_P2P)return void S.warning("[".concat(this._clientId,"] disconnecting p2p, abort unsubscribe request."));throw S.error("[".concat(this._clientId,"] massUnsubscribe error"),n.toString()),n}}async setLowStreamParameter(e){(function(n){if(!n)throw new ae(P.INVALID_PARAMS);kn(n.width)||HT(n.width,"streamParameter.width"),kn(n.height)||HT(n.height,"streamParameter.height"),kn(n.framerate)||HT(n.framerate,"streamParameter.framerate"),kn(n.bitrate)||sn(n.bitrate,"streamParameter.bitrate")})(e),(!e.width&&e.height||e.width&&!e.height)&&S.warning("[".concat(this._clientId,"] The width and height parameters take effect only when both are set")),S.info("[".concat(this._clientId,"] set low stream parameter to"),JSON.stringify(e));const t=this._configDistribute.getLowStreamConfigDistribute();if(t&&t.bitrate&&e.bitrate&&t.bitrate<e.bitrate&&(e.bitrate=t.bitrate),this._lowStreamParameter=e,this._isDualStreamEnabled)return this._p2pChannel.updateVideoStreamParameter(e,ge.LocalVideoLowTrack)}async setDualStreamMode(e,t){zn(e,"mode",[0,1,-1]);try{switch(t&&await this.setLowStreamParameter(t),this._dualStreamMode=e,this._joinInfo?this._gateway.setDualStreamMode(e).catch(n=>{S.warning("[".concat(this._clientId,"] set dual stream mode failed"),n.toString())}):S.debug("[".concat(this._clientId,"] haven't joined yet, cache dual stream mode ").concat(e)),e){case Ch.AUTO_SIMULCAST_STREAM:S.info("[".concat(this._clientId,"] set dual stream mode to ").concat(e));break;case Ch.DISABLE_SIMULCAST_STREM:return this.disableDualStream();case Ch.ENABLE_SIMULCAST_STREAM:return this.enableDualStream()}}catch(n){throw S.error("[".concat(this._clientId,"] set dual stream mode error"),n.toString()),n}}async enableDualStream(){if(!wt().supportDualStream)throw ke.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),new se(P.NOT_SUPPORTED,"Your browser is not support dual stream");if(this._isDualStreamEnabled)throw new se(P.INVALID_OPERATION,"Dual stream is already enabled");if(this._p2pChannel.canPublishLowStream())try{await this._publishLowStream()}catch(e){throw ke.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),e}this._isDualStreamEnabled=!0,this._dualStreamMode=Ch.ENABLE_SIMULCAST_STREAM,this._joinInfo&&this._gateway.setDualStreamMode(this._dualStreamMode,!0,!0).catch(e=>{S.debug("[".concat(this._clientId,"] try to inform gateway to set dual stream mode to ").concat(this._dualStreamMode," ,but failed"),e.toString())}),ke.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!0}),S.info("[".concat(this._clientId,"] enable dual stream"))}async disableDualStream(){if(this._isDualStreamEnabled){if(!this._joinInfo)return this._isDualStreamEnabled=!1,void S.info("[".concat(this._clientId,"] disable dual stream before join"));if(this._p2pChannel.getLocalMedia(ge.LocalVideoLowTrack))try{const e=await this._p2pChannel.unpublishLowStream();e&&await this._gateway.unpublish(e,this._joinInfo.stringUid||this._joinInfo.uid)}catch(e){throw ke.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!1}),e}this._isDualStreamEnabled=!1,this._dualStreamMode=Ch.DISABLE_SIMULCAST_STREM,this._joinInfo&&this._gateway.setDualStreamMode(this._dualStreamMode,!0,!0).catch(e=>{S.debug("[".concat(this._clientId,"] try to inform gateway to set dual stream mode to ").concat(this._dualStreamMode," ,but failed"),e.toString())}),ke.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!0}),S.info("[".concat(this._clientId,"] disable dual stream"))}}async setClientRole(e,t){if(function(i){zn(i,"role",["audience","host"])}(e),t&&YT(t),this.mode==="rtc"||this.mode==="p2p")throw S.warning("[".concat(this._clientId,"]").concat(this.mode," mode can not use setClientRole")),new se(P.INVALID_OPERATION,"".concat(this.mode," mode can not use setClientRole"));if(t&&t.level&&e==="host")throw new se(P.INVALID_OPERATION,"host mode can not set audience latency level");if(e==="audience"&&this._p2pChannel.hasLocalMedia())throw new se(P.INVALID_OPERATION,"can not set client role to audience when publishing stream");const n=this._config.role;if(this._joinInfo&&(this._joinInfo.role=e),e!==n&&L("ENABLE_ROLE_SELECT_EDGE")?(this._gateway.updateClientRole(e,t),this._config.role=e,this._gateway.reconnect("recover",Jr.REGIONAL_DISTRIBUTION)):(await this._gateway.setClientRole(e,t),this._config.role=e),S.info("[".concat(this._clientId,"] set client role to ").concat(e,", level: ").concat(t&&t.level)),n==="audience"&&e!=="audience"&&this._pendingRtpCapabilityChange&&this._p2pChannel instanceof Qd){const{video_codec:i}=this._pendingRtpCapabilityChange;this._p2pChannel.updateRemoteRTPCapabilities(i.map(o=>o.toLowerCase()).filter(o=>{var l;return me(l=Object.keys(Id)).call(l,o)}))}}async _setClientRoleOptions(e){if(this.mode==="rtc"||this.mode==="p2p"||this._config.role!=="audience"||this._p2pChannel.hasLocalMedia())return;let t=!1;try{e&&YT(e),await this._gateway.setClientRole(this._config.role,e),t=!0}catch{}finally{S.info("[".concat(this._clientId,"] set client role options ").concat(t?"succeed":"failed",", options is ").concat(e))}}getRemoteInboundOffset(){var e;const t=(e=this._p2pChannel.getStats())===null||e===void 0?void 0:e.audioSend[0];if(!t||!t.timestamp)return 0;const n=t.timestamp-Date.now();return Math.abs(n)>1e3+t.rttMs+100?this.ntpAlignErrorCount+=1:this.ntpAlignErrorCount=0,this.ntpAlignErrorCount>=3?n:0}getNtpWallTimeInMs(){return document.visibilityState==="visible"&&(this.remoteInboundOffset=this.getRemoteInboundOffset()),this.remoteInboundOffset+Date.now()+this._gateway.ntpOffset}setProxyServer(e,t){if(Kr(e,"proxyServer"),!t){if(this.connectionState!=="DISCONNECTED")throw new se(P.INVALID_OPERATION,"Set proxy server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new se(P.INVALID_OPERATION,"You have already set the proxy")}this._proxyServer=e,ke.setProxyServer(this._proxyServer),S.setProxyServer(this._proxyServer),S.info("[".concat(this._clientId,"] Set proxy server ").concat(t?"by initialize call":""," success."))}setTurnServer(e,t){if(Array.isArray(e)||(e=[e]),!t){if(this.connectionState!=="DISCONNECTED")throw new se(P.INVALID_OPERATION,"Set turn server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new se(P.INVALID_OPERATION,"You have already set the proxy")}if(yd(e))return this._turnServer={servers:e,mode:"original-manual"},void S.info("[".concat(this._clientId,"] Set original turnserver ").concat(t?"by initialize call":""," success: ").concat(e.map(n=>n.urls).join(","),"."));e.forEach(n=>$M(n)),this._turnServer={servers:e,mode:"manual"},S.info("[".concat(this._clientId,"] Set turnserver ").concat(t?"by initialize call":""," success."))}setLicense(e){if(this.connectionState!=="DISCONNECTED")throw new se(P.INVALID_OPERATION,"you should set license before join channel");if(Kr(e,"license",32,32),!/^[A-Za-z\d]+$/.test(e))throw new se(P.INVALID_PARAMS,"license should only contains characters from A-Z a-z 0-9");this._license=e,S.info("[".concat(this._clientId,"] set license success"),e)}startProxyServer(e){if(this.connectionState!=="DISCONNECTED")throw new se(P.INVALID_OPERATION,"Start proxy server before join channel");if(this._proxyServer||this._turnServer.mode==="manual"||this._useLocalAccessPoint)throw new se(P.INVALID_OPERATION,"You have already set the proxy");const t=[3,4,5];let n;switch(e===void 0&&(e=3),e){case 1:case 2:throw new se(P.NOT_SUPPORTED,"proxy mode 1/2 has been deprecated and not supported.");case 3:n="proxy3";break;case 4:n="proxy4";break;case 5:n="proxy5";break;default:throw new se(P.INVALID_PARAMS,"proxy server mode must be ".concat(t.join("|")))}this._cloudProxyServerMode=n,this.store.cloudProxyServerMode=n,S.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode)}stopProxyServer(){if(this.connectionState!=="DISCONNECTED")throw new se(P.INVALID_OPERATION,"Stop proxy server after leave channel");ke.setProxyServer(),S.setProxyServer(),this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled",S.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]}}setLocalAccessPointsV2(e){if(!e.accessPoints)throw new se(P.INVALID_PARAMS,"accessPoints is required.");Wc(e.accessPoints.serverList,"accessPoints.serverList"),Kr(e.accessPoints.domain,"accessPoints.domain");const t=(y,b)=>{sn(y,b,0,65535,!0)};let n=443;if(e.accessPoints.port&&(t(e.accessPoints.port,"accessPoints.port"),n=e.accessPoints.port),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new se(P.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");L("CLOSE_AFB_FOR_LOCAL_AP")&&(en("JOIN_WITH_FALLBACK_SIGNAL_PROXY",!1),en("JOIN_WITH_FALLBACK_MEDIA_PROXY",!1));const i=/^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,o=e.accessPoints.domain,l=e.accessPoints.serverList.map(y=>i.test(y)?"".concat(y.replace(/\./g,"-"),".").concat(o):y),d=l.map(y=>"".concat(y,":").concat(n));this._useLocalAccessPoint=!0,this._setLocalAPVersion=2,en("WEBCS_DOMAIN",d),en("WEBCS_DOMAIN_BACKUP_LIST",d),en("GATEWAY_DOMAINS",[o]),e.report&&e.report.hostname&&Array.isArray(e.report.hostname)&&e.report.hostname.length?(Wc(e.report.hostname,"report.hostname"),en("EVENT_REPORT_DOMAIN",e.report.hostname[0]),en("EVENT_REPORT_BACKUP_DOMAIN",e.report.hostname[1]||e.report.hostname[0])):(en("EVENT_REPORT_DOMAIN",l[0]),en("EVENT_REPORT_BACKUP_DOMAIN",l[1]||l[0]));let h=6443;e.report&&e.report.port&&(t(e.report.port,"report.port"),h=e.report.port),en("STATS_COLLECTOR_PORT",h),e.report?en("ENABLE_EVENT_REPORT",!0):en("ENABLE_EVENT_REPORT",!1);let f="";e.log&&e.log.hostname&&Array.isArray(e.log.hostname)&&e.log.hostname.length?(Wc(e.log.hostname,"log.hostname"),f=e.log.hostname[0]):f=l[0];let g=6444;e.log&&e.log.port&&(t(e.log.port,"log.port"),g=e.log.port),en("LOG_UPLOAD_SERVER","".concat(f,":").concat(g));let _=[];e.cds&&e.cds.hostname&&Array.isArray(e.cds.hostname)&&e.cds.hostname.length?(Wc(e.cds.hostname,"cds.hostname"),_=e.cds.hostname):_=l;let v=443;e.cds&&e.cds.port&&(t(e.cds.port,"cds.port"),v=e.cds.port),en("CDS_AP",_.map(y=>"".concat(y,":").concat(v))),e.cds?en("ENABLE_CONFIG_DISTRIBUTE",!0):en("ENABLE_CONFIG_DISTRIBUTE",!1),S.info("set local access point v2 success")}setLocalAccessPoints(e,t){if(Wc(e,"serverList"),Kr(t,"domain"),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new se(P.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");const n=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;e=e.map(i=>n.test(i)?"".concat(i.replace(/\./g,"-"),".").concat(t):i),this._useLocalAccessPoint=!0,this._setLocalAPVersion=1,en("WEBCS_DOMAIN",e),en("WEBCS_DOMAIN_BACKUP_LIST",e),en("GATEWAY_DOMAINS",[t]),en("EVENT_REPORT_DOMAIN",e[0]),en("EVENT_REPORT_BACKUP_DOMAIN",e[1]||e[0]),en("LOG_UPLOAD_SERVER","".concat(e[0],":6444")),S.info("[".concat(this._clientId,"] set local access point success"))}async setRemoteDefaultVideoStreamType(e){if(zn(e,"streamType",[0,1,4,5,6,7,8,9]),this._remoteDefaultVideoStreamType=e,this._joinInfo)try{await this._gateway.setDefaultRemoteVideoStreamType(e),this._joinInfo.defaultVideoStream=this._remoteDefaultVideoStreamType}catch(t){throw S.error("[".concat(this._clientId,"] set default remote video stream type error"),t.toString()),t}else S.debug("[".concat(this._clientId,"] haven't joined yet, cache remoteDefaultVideoStreamType ").concat(e))}async setRemoteVideoStreamType(e,t){zn(t,"streamType",[0,1,4,5,6,7,8,9]);try{await this._gateway.setRemoteVideoStreamType(e,t),setTimeout(()=>{const n=this._users.find(i=>i.uid===e);n&&n.videoTrack&&n.videoTrack.updateMediaStreamTrackResolution()},2e3)}catch(n){throw S.error("[".concat(this._clientId,"] set remote video stream type error"),n.toString()),n}S.info("[".concat(this._clientId,"] set remote ").concat(e," video stream type to ").concat(t)),this._remoteStreamTypeCacheMap.set(e,t)}async setStreamFallbackOption(e,t){zn(t,"fallbackType",[0,1,2,3,4,5,6,7,8]);try{await this._gateway.setStreamFallbackOption(e,t)}catch(n){throw S.error("[".concat(this._clientId,"] set stream fallback option"),n.toString()),n}S.info("[".concat(this._clientId,"] set remote ").concat(e," stream fallback type to ").concat(t)),this._streamFallbackTypeCacheMap.set(e,t)}setEncryptionConfig(e,t,n,i){(function(l){zn(l,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"])})(e),Kr(t,"secret");const o=["aes-128-gcm2","aes-256-gcm2"];if(me(o).call(o,e)){if(!n||!(n instanceof Uint8Array&&n.length===32))throw new se(P.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(n)throw new se(P.INVALID_PARAMS,"current encrypt mode does not need salt");if(i){if(za(i,"encryptDataStream"),!me(o).call(o,e))throw new se(P.INVALID_PARAMS,"current encrypt mode does not support data stream");this._encryptDataStream=!0}new RegExp(`^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'"|{}\\[\\]])(?=.{8,})`).test(t)||S.warning(`The secret is not strong:
      The secret must contain at least 1 lowercase alphabetical character,
      The secret must contain at least 1 uppercase alphabetical character,
      The secret must contain at least 1 numeric character,
      The secret must contain at least one special character,
      The secret must be eight characters or longer.
      `),this._encryptionMode=e,this._encryptionSecret=t,n&&(this._encryptionSalt=Kl(n))}async renewToken(e){if(Kr(e,"token",1,2047),!this._key||!this._joinInfo)throw new se(P.INVALID_OPERATION,"renewToken should not be called before user join");const t=this._key;this._key=e,this._joinInfo&&(this._joinInfo.token=e);const n=await this._renewTokenMutex.lock();try{if(L("USE_NEW_TOKEN")){S.debug("[".concat(this._clientId,"] start renew token with ticket from unilbs"));const i=await AAe(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||qn);S.debug("[".concat(this._clientId,"] get ticket from unilbs success")),await this._gateway.renewToken({token:e,ticket:i})}else S.debug("[".concat(this._clientId,"] start renew token without ticket")),await this._gateway.renewToken({token:e});S.debug("[".concat(this._clientId,"] renewToken success"))}catch(i){throw this._key=t,this._joinInfo.token=t,S.error("[".concat(this._clientId,"] renewToken failed"),i.toString()),i}finally{n()}}enableAudioVolumeIndicator(){this._audioVolumeIndicationInterval?S.warning("you have already enabled audio volume indicator!"):this._audioVolumeIndicationInterval=window.setInterval(()=>{const e=this._p2pChannel.getAudioLevels();this.safeEmit(_t.VOLUME_INDICATOR,e)},L("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3)}getRTCStats(){const e=this._statsCollector.getRTCStats(),t=this._gateway.getInChannelInfo();return e.Duration=Math.round(t.duration/1e3),e}async startLiveStreaming(e,t){if(!t){if(this.codec!=="h264")throw new se(P.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");if(!this._p2pChannel.hasLocalMedia())throw new se(P.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming")}if(this._liveRawStreamingClient&&this._liveRawStreamingClient.hasUrl(e)||this._liveTranscodeStreamingClient&&this._liveTranscodeStreamingClient.hasUrl(e))throw new se(P.LIVE_STREAMING_TASK_CONFLICT);const n=t?zc.TRANSCODE:zc.RAW;return this._createLiveStreamingClient(n).startLiveStreamingTask(e,n)}setLiveTranscoding(e){return this._createLiveStreamingClient(zc.TRANSCODE).setTranscodingConfig(e)}async stopLiveStreaming(e){const t=[this._liveRawStreamingClient,this._liveTranscodeStreamingClient].filter(n=>n&&n.hasUrl(e));if(!t.length)throw new se(P.INVALID_PARAMS,"can not find live streaming url to stop");await be.all(t.map(n=>n&&n.stopLiveStreamingTask(e)))}async startChannelMediaRelay(e){QV(e),await this._createChannelMediaRelayClient().startChannelMediaRelay(e)}async updateChannelMediaRelay(e){QV(e),await this._createChannelMediaRelayClient().updateChannelMediaRelay(e)}async stopChannelMediaRelay(){await this._createChannelMediaRelayClient().stopChannelMediaRelay(),this._statsCollector.onStatsChanged&&(this._statsCollector.onStatsChanged=void 0)}sendAudioMetadata(e){this._p2pChannel instanceof Qd&&this._p2pChannel.addAudioMetadata(e)}async sendStreamMessage(e){var t;let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!this._joinInfo)throw new se(P.INVALID_OPERATION,"can not send data stream, not joined");if((typeof e=="string"||e instanceof Uint8Array)&&(e={payload:e}),typeof e.payload=="string"){const o=new TextEncoder;e.payload=o.encode(e.payload)}let i=!1;if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&me(t=["aes-128-gcm2","aes-256-gcm2"]).call(t,this._encryptionMode)&&(i=!0,e.payload=await async function(o,l,d){var h;const f=ca(h=Array.from(d)).call(h,(I,O)=>I+O,0),g={serverTs:0,seq:Bce++,length:d.length,checkSum:f},_=new Uint8Array(oF(f,2)),v=new ArrayBuffer(xh),y=new DataView(v);y.setUint32(0,g.serverTs),y.setUint16(4,g.seq),y.setUint16(6,g.length),y.setUint16(8,g.checkSum);const b=16-d.length%16;d=nF(d,new Uint8Array(b));const D=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:o,tagLength:EF,additionalData:_},l,d);return nF(new Uint8Array(v),new Uint8Array(D))}(this._encryptDataStreamIv,this._encryptDataStreamKey,e.payload)),new Blob([e.payload]).size>1024)throw new se(P.INVALID_PARAMS,i?"encrypted stream message out of range.":"stream message out of range.");return this._gateway.signal.request(je.DATA_STREAM,{payload:Kl(e.payload),syncWithAudio:e.syncWithAudio,sendTs:Date.now()-EAe},!n)}sendMetadata(e){if(!this._joinInfo)throw new se(P.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([e]).size>1024)throw new se(P.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(je.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:Kl(e)})}async sendCustomReportMessage(e){if(Array.isArray(e)||(e=[e]),e.forEach(Qce),!this._joinInfo)throw new se(P.INVALID_OPERATION,"can not send custom report, not joined");await ke.sendCustomReportMessage(this._joinInfo.sid,e)}getLocalAudioStats(){return this._statsCollector.getLocalAudioTrackStats()}getRemoteAudioStats(){return this._statsCollector.getRemoteAudioTrackStats()}getLocalVideoStats(){return this._statsCollector.getLocalVideoTrackStats()}getRemoteVideoStats(){return this._statsCollector.getRemoteVideoTrackStats()}getRemoteNetworkQuality(){const e=this._statsCollector.getRemoteNetworkQualityStats();if(L("DELETE_NEQ_AFTER_USER_LEAVE")){const t=this._users.map(n=>n.uid+"");Object.keys(e).forEach(n=>{me(t).call(t,n)||delete e[n]})}return e}getNetworkQuality(){return this._statsCollector.getNetworkQuality()}async pickSVCLayer(e,t){zn(t.spatialLayer,"spatialLayer",[0,1,2,3]),zn(t.temporalLayer,"temporalLayer",[0,1,2,3]);try{await this._gateway.pickSVCLayer(e,t)}catch(n){throw S.error("[".concat(this._clientId,"] pick SVC layer failed"),n.toString()),n}}async setRTMConfig(e){const{apRTM:t=!1,rtmFlag:n}=e;if(za(t,"apRTM"),sn(n,"rtmFlag",0),this._rtmConfig.apRTM=t,this._rtmConfig.rtmFlag=n,S.debug("[".concat(this._clientId,"] setRTMconfig ").concat(JSON.stringify(e)," in ").concat(this.connectionState," state")),(this.connectionState==="CONNECTED"||this.connectionState==="RECONNECTING")&&this._joinInfo)return this._joinInfo.apRTM=t,this._joinInfo.rtmFlag=n,this._gateway.setRTM2Flag(n)}_reset(){if(S.debug("[".concat(this._clientId,"] reset client")),function(e){const t=Qh.indexOf(e);t!==-1&&Qh.splice(t,1)}(this._clientId),this.store.hasStartJoinChannel=!1,this.store.isABTestSuccess=!1,this.store.autoSubscribe=!1,this._pendingRtpCapabilityChange=void 0,this._axiosCancelSource.cancel(),this._axiosCancelSource=Xs.CancelToken.source(),this._streamFallbackTypeCacheMap=new Map,this._remoteStreamTypeCacheMap=new Map,this._configDistribute.stopGetConfigDistribute(),this._joinInfo&&fQ(this._joinInfo),this._rteDetailInterval&&(window.clearInterval(this._rteDetailInterval),this._rteDetailInterval=void 0,this._sessionId&&ke.reportRteDetail(this._sessionId)),this._fallbackServerInfo=void 0,this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId&&ke.removeSid(this._sessionId),this._sessionId=null,this.store.sessionId=null,this.store.resetFirstVideoFrameDecoded(),this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._encryptDataStreamKey=null,this._encryptDataStreamIv=null,this._pendingPublishedUsers=[],this._users.forEach(e=>{e._audioTrack&&e._audioTrack._destroy(),e._videoTrack&&e._videoTrack._destroy(),e._dataChannels&&(e._dataChannels.forEach(t=>t._close()),e._dataChannels.length=0)}),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),this._cloudProxyServerMode==="fallback"&&(this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled"),this._p2pChannel.reset(),this._publishMutex=new Lr("client-publish",this._clientId),this._subscribeMutex=new Lr("client-subscribe",this._clientId),this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0),this._inspect)try{this._inspect.close(),this._inspect=void 0}catch{}if(this._moderation)try{this.setImageModeration(!1)}catch{}}_startSession(e,t){var n;const i=e||Td();e?S.debug("[".concat(this._clientId,"] new Session ").concat(i)):S.debug("[".concat(this._clientId,"] renewSession ").concat(this._sessionId," => ").concat(i));const o=e?"":this._sessionId||"";this._sessionId=i,this.store.sessionId=i,ke.addSid(i);const l={lts:new Date().getTime(),mode:this.mode,buildFormat:1,stringUid:(t==null?void 0:t.stringUid)||((n=this._joinInfo)===null||n===void 0?void 0:n.stringUid),channelProfile:this.mode==="live"?1:0,channelMode:0,isABTestSuccess:Number(this._configDistribute.isSuccess),lsid:o,clientRole:this.role==="audience"?2:1,rteUrl:this.store.rteUrl,rteSid:this.store.rteSid};ke.sessionInit(this._sessionId,so({cname:t.channel,appid:t.appId},l)),this._joinInfo&&(this._joinInfo.sid=i),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=i)}async _publishHighStream(e){if(!this._joinInfo||this._uid===void 0)throw new se(P.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new se(P.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&L("FORCE_TURN")&&!L("TURN_ENABLE_TCP")&&!L("TURN_ENABLE_UDP"))throw new se(P.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");S.debug("[".concat(this._clientId,"] publish high stream"));try{const n=await this._p2pChannel.publish(e,this._isDualStreamEnabled,this._lowStreamParameter);if(this.store.useP2P){const i=(await n.next()).value;if(i){try{await this._gateway.sendExtensionMessage(Kn.PUBLISH,i,!0)}catch(o){throw n.throw(o),o}await n.next()}this._p2pChannel.reportPublishEvent(!0,null)}else{const i=(await n.next()).value;if(i){var t;let o;try{o=await this._gateway.publish(this._uid,i,!0)}catch(l){if(l.code!==P.DISCONNECT_P2P)throw n.throw(l),l}await n.next(((t=o)===null||t===void 0?void 0:t.ortc)||[])}this._p2pChannel.reportPublishEvent(!0,null);for(const o of e)o instanceof on&&o._encoderConfig&&this._gateway.setVideoProfile(o._encoderConfig).catch(l=>{S.debug("[".concat(this._clientId,"] stop setVideoProfile, because websocket is closed"))}),!o.muted&&o.enabled||await this._p2pChannel.muteLocalTrack(o)}}catch(n){if(this._p2pChannel.reportPublishEvent(!1,n==null?void 0:n.code,e),(n==null?void 0:n.code)===P.WS_ABORT)return;throw n}}async _publishLowStream(){if(!this._joinInfo||this._uid===void 0)throw new se(P.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new se(P.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));S.debug("[".concat(this._clientId,"] publish low stream"));const e=this._configDistribute.getLowStreamConfigDistribute();e&&e.bitrate&&(this._lowStreamParameter||(this._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),this._lowStreamParameter&&this._lowStreamParameter.bitrate&&e.bitrate<this._lowStreamParameter.bitrate&&(this._lowStreamParameter.bitrate=e.bitrate));try{const n=await this._p2pChannel.publishLowStream(this._lowStreamParameter),i=(await n.next()).value;if(i){var t;let o;try{o=await this._gateway.publish(this._uid,i,!0)}catch(l){if(l.code!==P.DISCONNECT_P2P)throw n.throw(l),l}n.next(((t=o)===null||t===void 0?void 0:t.ortc)||[]),this._p2pChannel.reportPublishEvent(!0,null,void 0,!0)}}catch(n){if(this._p2pChannel.reportPublishEvent(!1,n==null?void 0:n.code,void 0,!0),(n==null?void 0:n.code)===P.WS_ABORT)return;throw n}}_createLiveStreamingClient(e){const t=()=>{if(!this._joinInfo||!this._appId)return new se(P.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();const n=(i={joinInfo:this._joinInfo,appId:this._appId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig},Po("LiveStreaming").create(i));var i;return n.onLiveStreamError=(o,l)=>{ke.reportApiInvoke(this._sessionId,{name:yn.ON_LIVE_STREAM_ERROR,options:[o,l],tag:an.TRACER}).onSuccess(),this.safeEmit(_t.LIVE_STREAMING_ERROR,o,l)},n.onLiveStreamWarning=(o,l)=>{ke.reportApiInvoke(this._sessionId,{name:yn.ON_LIVE_STREAM_WARNING,options:[o,l],tag:an.TRACER}).onSuccess(),this.safeEmit(_t.LIVE_STREAMING_WARNING,o,l)},n.on(GR.REQUEST_WORKER_MANAGER_LIST,(o,l,d)=>{if(!this._joinInfo)return d(new se(P.INVALID_OPERATION,"can not find join info to get worker manager"));(async function(h,f,g,_){const v=L("UAP_AP").slice(0,L("AJAX_REQUEST_CONCURRENT")).map(y=>f.proxyServer?"https://".concat(f.proxyServer,"/ap/?url=").concat(y+"/api/v1?action=uap"):"https://".concat(y,"/api/v1?action=uap"));return await rAe(v,h,f,g,_)})(o,this._joinInfo,this._axiosCancelSource.token,qn).then(l).catch(d)}),n};return e===zc.RAW?(this._liveRawStreamingClient=this._liveRawStreamingClient||t(),this._liveRawStreamingClient):(this._liveTranscodeStreamingClient=this._liveTranscodeStreamingClient||t(),this._liveTranscodeStreamingClient)}_createChannelMediaRelayClient(){if(!this._joinInfo)return new se(P.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw();if(!this._channelMediaRelayClient){const{sendResolutionWidth:t,sendResolutionHeight:n}=this.getLocalVideoStats(),i=(e={joinInfo:this._joinInfo,clientId:this._clientId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig,resolution:{width:t,height:n}},Po("ChannelMediaRelay").create(e));i.on("state",o=>{o===hi.RELAY_STATE_FAILURE&&i&&i.dispose(),this.safeEmit(_t.CHANNEL_MEDIA_RELAY_STATE,o)}),i.on("event",o=>{this.safeEmit(_t.CHANNEL_MEDIA_RELAY_EVENT,o)}),this._channelMediaRelayClient=i,this._statsCollector.onStatsChanged=(o,l)=>{var d;o==="resolution"&&((d=this._channelMediaRelayClient)===null||d===void 0||d.setVideoProfile(l))}}var e;return this._channelMediaRelayClient}_handleUpdateDataChannel(e,t){const{added:n,deleted:i}=e,o=[];if(t){const l=[];this._users.forEach(d=>{d._dataChannels.forEach(h=>{n.every(f=>f.uid!==d._uintid||f.stream_id!==h.id)&&l.push({uid:d._uintid,stream_id:h.id,ordered:h.ordered,max_retrans_times:h.maxRetransmits,metadata:h.metadata})})}),l.length>0&&this._handleUpdateDataChannel({added:[],deleted:l})}Array.isArray(n)&&n.length>0&&n.forEach(l=>{const{uid:d,stream_id:h,ordered:f,max_retrans_times:g,metadata:_}=l,v=this._users.find(y=>y._uintid===d);if(!v)return void S.error("[".concat(this._clientId,"] can not find target user!(on_add_data_channel)"));if(S.debug("[".concat(this._clientId,"] data_channel added with uid ").concat(d)),me(o).call(o,v)||o.push(v),v._uintid||(v._uintid=d),v._dataChannels.findIndex(y=>y.id===l.stream_id)===-1){const y={id:h,ordered:!!f,maxRetransmits:g,metadata:_},b=function(D){return TV(D,!0)}(y);v._dataChannels.push(b),S.info("[".concat(this._clientId,"] remote user ").concat(v.uid," published datachannel")),t||this.safeEmit(_t.USER_PUBLISHED,v,"datachannel",y)}this._p2pChannel.hasPendingRemoteDataChannel(v,l.stream_id)&&(S.debug("[".concat(this._clientId,"] resubscribe datachannel for user ").concat(v.uid," after reconnect.")),this._subscribeDataChannel(v,l.stream_id).catch(y=>{S.error("[".concat(this._clientId,"] resubscribe datachannel error"),y.toString())}))}),t&&(this.safeEmit(_t.PUBLISHED_USER_LIST,this._pendingPublishedUsers),this._pendingPublishedUsers=[]),Array.isArray(i)&&i.length>0&&i.forEach(l=>{const{uid:d,stream_id:h}=l,f=this._users.find(_=>_._uintid===d);if(!f)return void S.error("[".concat(this._clientId,"] can not find target user!(on_delete_data_channel)"));const g=f._dataChannels.find(_=>_.id===l.stream_id);g&&(S.debug("[".concat(this._clientId,"] data_stream delete with uid ").concat(d)),this._p2pChannel.unsubscribeDataChannel(f,[g]).then(_=>{if(f._dataChannels=f._dataChannels.filter(v=>v!==g),_)return this._gateway.unsubscribeDataChannel(_,f.uid)}),S.info("[".concat(this._clientId,"] remote user ").concat(d," unpublished datachannel ,id:").concat(g.id)),this.safeEmit(_t.USER_UNPUBLISHED,f,"datachannel",g._config))})}_getEncodingName(e){var t,n;if(!this._joinResponse)return;const i=(t=this._joinResponse.ortc.rtpCapabilities.sendrecv)===null||t===void 0?void 0:t.videoCodecs;if(!i)return;for(const h of i){var o;if(h.payloadType===e)return h==null||(o=h.rtpMap)===null||o===void 0?void 0:o.encodingName}const l=(n=this._joinResponse.ortc.rtpCapabilities.recv)===null||n===void 0?void 0:n.videoCodecs;if(l)for(const h of l){var d;if(h.payloadType===e)return h==null||(d=h.rtpMap)===null||d===void 0?void 0:d.encodingName}return e===0?"unknown":void 0}_handleRemoveDataChannels(e){const t=this._users.find(n=>n.uid===e.uid);if(t){if(t._dataChannels!==void 0&&t._dataChannels.length>0){S.debug("[".concat(this._clientId,"] datachannel removed with uid ").concat(e.uid));const n=()=>{S.info("[".concat(this._clientId,"] remote user ").concat(t.uid," unpublished datachannel")),t._dataChannels.forEach(i=>{this.safeEmit(_t.USER_UNPUBLISHED,t,"datachannel",i._config)})};this._p2pChannel.unsubscribeDataChannel(t,t._dataChannels).then(i=>{if(i)return this._gateway.unsubscribeDataChannel(i,t.uid)}),n()}}else S.warning("[".concat(this._clientId,"] can not find target user!(on_remove_datachannel)"))}_handleGatewayEvents(){this._gateway.on(Gn.UPDATE_GATEWAY_CONFIG,()=>{(function(){let e;try{e=window.localStorage.getItem("websdk_ng_global_parameter")}catch(t){return void S.error("Error loading sdk config",t.message)}if(e)try{const t=JSON.parse(window.atob(e)),n=Date.now();Object.keys(t).forEach(i=>{const{value:o,type:l,expires:d}=t[i];d&&d<=n||l||PR()||!Object.prototype.hasOwnProperty.call(Rv,i)||(Vi[i]=o,qt[i]=o,S.debug("Update gateway parameters from config distribute",i,o))})}catch(t){S.error("Error update config from local cache",t.message)}})()}),this._gateway.on(Gn.DISCONNECT_P2P,async()=>{await this._p2pChannel.disconnectForReconnect()}),this._gateway.on(Gn.CONNECTION_STATE_CHANGE,(e,t,n)=>{var i;if(n===Ct.FALLBACK)return;const o=()=>{this.safeEmit(_t.CONNECTION_STATE_CHANGE,e,t,n)};if(ke.reportApiInvoke(this._sessionId||((i=this._gateway.joinInfo)===null||i===void 0?void 0:i.sid)||null,{name:yn.CONNECTION_STATE_CHANGE,options:[e,t,n],tag:an.TRACER}).onSuccess(JSON.stringify({cur:e,prev:t,reason:n})),S.info("[".concat(this._clientId,"] signal connection state change: ").concat(t," -> ").concat(e)),e==="DISCONNECTED")return this._reset(),void o();if(e==="RECONNECTING")this._users.forEach(d=>{d._trust_in_room_=!1,d._trust_audio_enabled_state_=!1,d._trust_video_enabled_state_=!1,d._trust_audio_mute_state_=!1,d._trust_video_mute_state_=!1,d._trust_audio_stream_added_state_=!1,d._trust_video_stream_added_state_=!1,d._is_pre_created||(d._audio_pre_subscribed||(d._audioSSRC=void 0,d._audioOrtc=void 0),d._video_pre_subscribed||(d._videoSSRC=void 0,d._videoOrtc=void 0,d._rtxSsrcId=void 0),d._cname=void 0)}),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0;else if(e==="CONNECTED"){var l;this._streamFallbackTypeCacheMap.forEach((d,h)=>{this._gateway.setStreamFallbackOption(h,d).catch(f=>{S.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),f)})}),this._remoteStreamTypeCacheMap.forEach((d,h)=>{this._gateway.setRemoteVideoStreamType(h,d).catch(f=>{S.warning("[".concat(this._clientId,"] auto set remote stream type failed"),f)})}),L("VOS_CONFIGURE")&&Array.isArray(L("VOS_CONFIGURE"))&&L("VOS_CONFIGURE").length>0&&(this._gateway.setConfigure(L("VOS_CONFIGURE")).catch(d=>{S.debug("[".concat(this._clientId,"] auto set vos config failed"),d)}),S.debug("[".concat(this._clientId,"] ws connected auto set vos config"))),this._remoteDefaultVideoStreamType!==void 0&&((l=this._joinInfo)===null||l===void 0?void 0:l.defaultVideoStream)===void 0&&this.setRemoteDefaultVideoStreamType(this._remoteDefaultVideoStreamType).then(()=>{S.debug("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway connected"))}).catch(d=>{S.error("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway failed, ").concat(d))}),this._dualStreamMode&&this._gateway.setDualStreamMode(this._dualStreamMode).catch(d=>{S.warning("[".concat(this._clientId,"] auto set dual stream mode failed"),d)}),this.store.useP2P||(this._p2pChannel.republish(),this._userOfflineTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._userOfflineTimeout=void 0,this._users.filter(d=>!d._trust_in_room_).forEach(d=>{S.debug("[".concat(this._clientId,"] user offline timeout, emit user offline ").concat(d.uid)),this._handleUserOffline({uid:d.uid})}))},3e3),this._streamRemovedTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._streamRemovedTimeout=void 0,this._users.forEach(d=>{d._trust_audio_mute_state_||(S.debug("[".concat(this._clientId,"] auto dispatch audio unmute event ").concat(d.uid)),this._handleMuteStream(d.uid,xe.AUDIO,!1)),d._trust_video_mute_state_||(S.debug("[".concat(this._clientId,"] auto dispatch video unmute event ").concat(d.uid)),this._handleMuteStream(d.uid,xe.VIDEO,!1)),d._trust_audio_enabled_state_||(S.debug("[".concat(this._clientId,"] auto dispatch enable local audio ").concat(d.uid)),this._handleSetStreamLocalEnable("audio",d.uid,!0)),d._trust_video_enabled_state_||(S.debug("[".concat(this._clientId,"] auto dispatch enable local video ").concat(d.uid)),this._handleSetStreamLocalEnable("video",d.uid,!0)),d._trust_video_stream_added_state_||(S.debug("[".concat(this._clientId,"] auto dispatch reset video stream added ").concat(d.uid)),this._handleResetAddStream(d,"video")),d._trust_audio_stream_added_state_||(S.debug("[".concat(this._clientId,"] auto dispatch reset audio stream added ").concat(d.uid)),this._handleResetAddStream(d,"audio")),d._video_added_||d._audio_added_||(S.debug("[".concat(this._clientId,"] auto dispatch stream remove ").concat(d.uid)),this._handleRemoveStream({uid:d.uid,uint_id:d._uintid}))}))},1e3))}o()}),this._gateway.on(Gn.REQUEST_NEW_GATEWAY_LIST,async(e,t)=>{if(!this._joinInfo)return t(new se(P.UNEXPECTED_ERROR,"can not recover, no join info"));try{let n;if(this._fallbackServerInfo)n=this._fallbackServerInfo,this._fallbackServerInfo=void 0,this._joinInfo.preload=!1,ke.reportApiInvoke(this._sessionId,{name:yn.VOS_FALLBACK_CN,options:{cur:n.gatewayInfo.gatewayAddrs,prev:this._joinInfo.gatewayAddrs,is_done:!0},tag:an.TRACER}).onSuccess(),S.info("[".concat(this._clientId,"] use fallback cn server info"));else{const o=await NI(so(so({},this._joinInfo),{},{uid:this._joinInfo.uid,stringUid:void 0}));o?(n=o.ap,mQ(o),this._joinInfo.preload=!0):(n=await A0(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||qn,this.store),this._joinInfo.preload=!1)}this._joinInfo&&(this._joinInfo.apResponse=n.gatewayInfo.res,this._joinInfo.gatewayAddrs=n.gatewayInfo.gatewayAddrs,this._joinInfo.uni_lbs_ip=n.gatewayInfo.uni_lbs_ip);const i=[];n.gatewayInfo.gatewayAddrs.forEach(o=>{let{address:l}=o;const[d,h]=l.split(":");this._joinInfo&&this._joinInfo.proxyServer?i.push({proxy:this._joinInfo.proxyServer,host:d,port:h}):i.push({host:d,port:h})}),e(i)}catch(n){t(n)}}),this._gateway.on(Gn.NETWORK_QUALITY,e=>{this._networkQualitySensitivity==="normal"&&this.safeEmit(_t.NETWORK_QUALITY,e)}),this._gateway.on(Gn.STREAM_TYPE_CHANGE,(e,t)=>{this.safeEmit(_t.STREAM_TYPE_CHANGED,e,t),ke.reportApiInvoke(this._sessionId,{name:yn.STREAM_TYPE_CHANGE,options:[e,t],tag:an.TRACER}).onSuccess(JSON.stringify({uid:e,streamType:t}))}),this._gateway.isPreSub=()=>"isPreSub"in this._p2pChannel&&this._p2pChannel.isPreSub(),this._gateway.isPreallocation=()=>"isPreallocation"in this._p2pChannel&&this._p2pChannel.isPreallocation(),this._gateway.on(Gn.IS_P2P_DISCONNECTED,e=>{this._p2pChannel.isP2PDisconnected()?e(!0):this._p2pChannel.hasLocalMedia()||this._p2pChannel.hasRemoteMedia()?e(!1):e(!0)}),this._gateway.on(Gn.REQUEST_P2P_CONNECTION_PARAMS,async(e,t,n)=>{try{let i=await this._p2pChannel.getEstablishParams();i&&"isPreallocation"in this._p2pChannel&&this._p2pChannel.isPreallocation()||(i=await this._p2pChannel.startP2PConnection(e)),t(i)}catch(i){n(i)}}),this._gateway.on(Gn.JOIN_RESPONSE,(e,t)=>{if(this.store.useP2P)return;let n;this._joinResponse=e,e.attributes?n=e.attributes.userAttributes.preSubSsrcs:S.debug("no attributes in joinResponse");const i=mV(e.ortc,t,n);this._p2pChannel.connect(i)}),this._gateway.on(Gn.PRE_CONNECT_PC,async(e,t,n)=>{const{candidates:i,fingerprint:o,turnServer:l}=e;if(this._joinInfo&&i.length>0&&!this._p2pChannel.isPlanB){const{cert:h,cid:f}=this._joinInfo.apResponse,g="".concat(f,"_").concat(h);if(g.length<4||g.length>256)return void S.debug("[".concat(this._clientId,"] ufrag length is not valid, length: ").concat(g.length));await this._p2pChannel.startP2PConnection({turnServer:l,cloudProxyServer:this._joinInfo.cloudProxyServer,isPreallocation:!0});try{var d;t(await this._p2pChannel.connect({iceParameters:{iceUfrag:"".concat(f,"_").concat(h),icePwd:"".concat(f,"_").concat(h)},dtlsParameters:{fingerprints:[{hashFunction:"sha-256",fingerprint:(d=L("FINGERPRINT"))!==null&&d!==void 0?d:o}]},candidates:i,rtpCapabilities:{send:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},recv:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]}},setup:"active",cname:"o/i14u9pJrxRKAsu",preallocation:!0}))}catch(_){_.code&&_.code===P.EXCHANGE_SDP_FAILED&&await this._p2pChannel.startP2PConnection({turnServer:l,cloudProxyServer:this._joinInfo.cloudProxyServer},!0),n(_)}}}),this._gateway.on(Gn.VOS_FALLBACK,e=>{e==="fallback_hls"&&this.safeEmit(_t.FALLBACK_TO_HLS,zT.VOSERROR)}),this._gateway.on(Gn.RESET_SIGNAL,()=>{this._p2pChannel instanceof Qd&&this._p2pChannel.fallbackConnection(),this._handleGatewaySignalEvents()}),this._gateway.on(Gn.DATACHANNEL_FAILBACK,()=>{ke.reportApiInvoke(this._sessionId,{name:yn.DATACHANNEL_FAILBACK,options:{},tag:an.TRACER}).onSuccess(),this._joinGateway()})}_handleGatewaySignalEvents(){this._gateway.signal.on(nt.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(nt.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(nt.ON_ADD_AUDIO_STREAM,e=>this._handleAddAudioOrVideoStream("audio",e.uid,e.ssrcId,e.cname,e.pt,e.uint_id,e.ortc)),this._gateway.signal.on(nt.ON_ADD_VIDEO_STREAM,e=>this._handleAddAudioOrVideoStream("video",e.uid,e.ssrcId,e.cname,e.pt,e.uint_id,e.ortc,e.rtxSsrcId)),this._gateway.signal.on(nt.ON_REMOTE_DATASTREAM_UPDATE,e=>{this._handleUpdateDataChannel(e)}),this._gateway.signal.on(nt.ON_REMOTE_FULL_DATASTREAM_INFO,e=>{this._handleUpdateDataChannel({added:e.datastreams||[],deleted:[]},!0)}),this._gateway.signal.on(nt.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(nt.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(nt.MUTE_AUDIO,e=>this._handleMuteStream(e.uid,xe.AUDIO,!0)),this._gateway.signal.on(nt.UNMUTE_AUDIO,e=>this._handleMuteStream(e.uid,xe.AUDIO,!1)),this._gateway.signal.on(nt.MUTE_VIDEO,e=>this._handleMuteStream(e.uid,xe.VIDEO,!0)),this._gateway.signal.on(nt.UNMUTE_VIDEO,e=>this._handleMuteStream(e.uid,xe.VIDEO,!1)),this._gateway.signal.on(nt.RECEIVE_METADATA,e=>{const t=Cd(e.metadata);this.safeEmit(_t.RECEIVE_METADATA,e.uid,t)}),this._gateway.signal.on(nt.ON_DATA_STREAM,async e=>{var t;if(!e)return;let n=Cd(e.payload);if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&me(t=["aes-128-gcm2","aes-256-gcm2"]).call(t,this._encryptionMode)){if(e.payload.length<xh)throw new se(P.UNEXPECTED_RESPONSE,"payload length ".concat(e.payload.length," is less than header length ").concat(xh));n=await async function(l,d,h){const f=h.subarray(0,xh),g=f.slice(8,xh),_=(g[0]<<8)+g[1],v=(f[6]<<8)+f[7],y=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:l,tagLength:EF,additionalData:new Uint8Array(oF(_,2))},d,h.subarray(xh));return new Uint8Array(y).subarray(0,v)}(this._encryptDataStreamIv,this._encryptDataStreamKey,n)}let i=0;if(e.ordered||e.syncWithAudio){const o=this._p2pChannel.getStats(),l=this.remoteUsers.find(h=>h.uid===e.uid),d=o==null?void 0:o.audioRecv.find(h=>h.ssrc===(l==null?void 0:l._audioSSRC));i=d==null?void 0:d.jitterBufferMs}(i==null||Number.isNaN(i))&&(i=0),yAe(so(so({},e),{},{payload:n}),i,{id:this._clientId,onStreamMessage:typeof this.onStreamMessage=="function"?this.onStreamMessage.bind(this):void 0,safeEmit:this.safeEmit.bind(this)})}),this._gateway.signal.on(nt.ON_CRYPT_ERROR,()=>{Gl(()=>{S.warning("[".concat(this._clientId,"] on crypt error")),this.safeEmit(_t.CRYPT_ERROR)},this._sessionId)}),this._gateway.signal.on(nt.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(nt.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{S.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._gateway.leave(!0,Ct.TOKEN_EXPIRE),this.safeEmit(_t.ON_TOKEN_PRIVILEGE_DID_EXPIRE),this._reset()}),this._gateway.signal.on(nt.ON_STREAM_FALLBACK_UPDATE,e=>{S.debug("[".concat(this._clientId,"] stream fallback peerId: ").concat(e.stream_id,", attr: ").concat(e.stream_type)),this.safeEmit(_t.STREAM_FALLBACK,e.stream_id,e.stream_type===1?"fallback":"recover")}),this._gateway.signal.on(nt.ENABLE_MULTI_STREAM,e=>{this._dualStreamMode===Ch.AUTO_SIMULCAST_STREAM&&this.enableDualStream().catch(t=>{S.debug("[".concat(this._clientId,"] set dual stream mode error"),t.toString())})}),this._gateway.signal.on(nt.ON_PUBLISH_STREAM,e=>{this.uid===this._uid&&(this._p2pChannel.reportPublishEvent(!0,null,void 0,!1,JSON.stringify({proxy:e.proxy})),S.info("[".concat(this._clientId,"] on publish stream, ").concat(JSON.stringify(e))))}),this._gateway.signal.on(nt.ENABLE_LOCAL_VIDEO,e=>{this._handleSetStreamLocalEnable("video",e.uid,!0)}),this._gateway.signal.on(nt.DISABLE_LOCAL_VIDEO,e=>{this._handleSetStreamLocalEnable("video",e.uid,!1)}),this._gateway.signal.on(Ue.REQUEST_TIMEOUT,(e,t)=>{if(this._joinInfo)switch(e){case je.PUBLISH:{if(!t)return;const o=t.ortc;if(o){var n,i;const l=o.some(f=>{let{stream_type:g}=f;return g===Xt.Audio}),d=o.some(f=>{let{stream_type:g}=f;return g!==Xt.Audio}),h=o.some(f=>{let{stream_type:g}=f;return g===Xt.Screen||g===Xt.ScreenLow});t.state==="offer"&&ke.publish(this._joinInfo.sid,{eventElapse:os.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:!1,ec:P.TIMEOUT,audio:l,video:d,p2pid:t.p2p_id,publishRequestid:this.store.pubId,screenshare:h,audioName:l?(n=o.find(f=>{let{stream_type:g}=f;return g===Xt.Audio}))===null||n===void 0||(n=n.ssrcs[0])===null||n===void 0?void 0:n.ssrcId.toString():void 0,videoName:d?(i=o.find(f=>{let{stream_type:g}=f;return g!==Xt.Audio}))===null||i===void 0||(i=i.ssrcs[0])===null||i===void 0?void 0:i.ssrcId.toString():void 0})}break}case je.SUBSCRIBE:t&&ke.subscribe(this._joinInfo.sid,{succ:!1,ec:P.TIMEOUT,audio:t.stream_type===xe.AUDIO,video:t.stream_type===xe.VIDEO,peerid:t.stream_id,subscribeRequestid:t.ssrcId,p2pid:this.store.p2pId,eventElapse:os.measureFromSubscribeStart(this.store.clientId,t.ssrcId),preSsrc:this._p2pChannel.isPreSubScribe(t.ssrcId)})}}),this._gateway.signal.on(nt.ON_P2P_OK,e=>{this.uid,this._uid}),this._gateway.signal.on(nt.ON_PUBLISHED_USER_LIST,e=>{if(e==null||!e.users)return;L("BLOCK_LOCAL_CLIENT")&&(e.users=e.users.filter(i=>!Ud(i.string_id||i.stream_id,this.channelName)));const t=[],n=[];for(const i of e.users){let o=this._users.find(_=>_._uintid===i.stream_id);o?o._trust_in_room_=!0:(o=new $l(i.string_id||i.stream_id,i.stream_id),this._users.push(o),this.store.firstVideoFrameDecoded(o.uid,{userJoinNotify:Date.now()}),this.getListeners(_t.PUBLISHED_USER_LIST).length===0&&(S.debug("[".concat(this._clientId,"] user online"),i.stream_id),this.safeEmit(_t.USER_JOINED,o)));const l=Tr.Audio&i.stream_type,d=(Tr.Video|Tr.LwoVideo)&i.stream_type,h=(65280&i.stream_type)!=0,f=l&&o.hasAudio,g=d&&o.hasVideo;d&&(o._trust_video_stream_added_state_=!0,o._video_added_=!0,o._videoSSRC=i.video_ssrc,o._rtxSsrcId=i.video_rtx),l&&(o._trust_audio_stream_added_state_=!0,o._audio_added_=!0,o._audioSSRC=i.audio_ssrc),l&&!f&&this.getListeners(_t.PUBLISHED_USER_LIST).length===0&&(S.info("[".concat(this._clientId,"] remote user ").concat(o.uid," published audio")),this.safeEmit(_t.USER_PUBLISHED,o,"audio")),d&&!g&&this.getListeners(_t.PUBLISHED_USER_LIST).length===0&&(S.info("[".concat(this._clientId,"] remote user ").concat(o.uid," published video")),this.safeEmit(_t.USER_PUBLISHED,o,"video")),(l&&!f||d&&!g||h)&&t.push(o),d&&this._p2pChannel.hasPendingRemoteMedia(o,"video")&&n.push({user:o,mediaType:"video"}),l&&this._p2pChannel.hasPendingRemoteMedia(o,"audio")&&n.push({user:o,mediaType:"audio"})}n.length>0&&(S.debug("[".concat(this._clientId,"] RE massSubscribe after reconnect ").concat(n.map(i=>"user: ".concat(i.user.uid,", mediaType: ").concat(i.mediaType)).join("; ")," ")),this.massSubscribe(n).catch(i=>{S.error("[".concat(this._clientId,"] mass resubscribe error"),i.toString())})),this.getListeners(_t.PUBLISHED_USER_LIST).length>0?L("ENABLE_DATASTREAM_2")?this._pendingPublishedUsers=t:(S.info("[".concat(this._clientId,"] client emit user-list event, users: ").concat(t.map(i=>i.uid).join(", "))),this.safeEmit(_t.PUBLISHED_USER_LIST,t)):S.info("[".concat(this._clientId,"] client not emit user-list event case there is no user-list listener, users: ").concat(t.map(i=>i.uid).join(", ")))}),this._gateway.signal.on(nt.ON_RTP_CAPABILITY_CHANGE,e=>{const{video_codec:t}=e;if(this._p2pChannel instanceof Qd){if(this.role==="audience"&&L("UPDATE_RTP_CAP_IN_HOST"))return this._pendingRtpCapabilityChange=e,void S.debug("[".concat(this._clientId,"] no need to change rtp capability because of audience, params: ").concat(JSON.stringify(e)));this._p2pChannel.updateRemoteRTPCapabilities(t.map(n=>n.toLowerCase()).filter(n=>{var i;return me(i=Object.keys(Id)).call(i,n)}))}}),this._gateway.signal.on(Ue.VOS_FALLBACK_PROMISE,async(e,t,n)=>{if(e==="FALLBACKCN"&&L("ENABLE_QUALITY_FALLBACK")){if(!this._joinInfo)return n(new se(P.UNEXPECTED_ERROR,"can not recover, no join info"));S.info("[".concat(this._clientId,"] try fallback to cn, start request new server info"));const o=this._joinInfo.apRequestDetail;try{this._joinInfo.apRequestDetail=e;const l=await A0(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||qn,this.store);if(L("QUALITY_FALLBACK_REHEARSAL"))return ke.reportApiInvoke(this._sessionId,{name:yn.VOS_FALLBACK_CN,options:{cur:l.gatewayInfo.gatewayAddrs,prev:this._joinInfo.gatewayAddrs,is_done:!1},tag:an.TRACER}).onSuccess(),this._joinInfo.apRequestDetail=o,void n();this._fallbackServerInfo=l,t()}catch(l){var i;const d=l==null||(i=l.data)===null||i===void 0?void 0:i.desc;L("QUALITY_FALLBACK_REHEARSAL")?(ke.reportApiInvoke(this._sessionId,{name:yn.VOS_FALLBACK_CN,options:{cur:"failed, errorReason: "+d||"unknown",prev:this._joinInfo.gatewayAddrs,is_done:!1},tag:an.TRACER}).onSuccess(),this._joinInfo.apRequestDetail=o):Array.isArray(d)&&me(d).call(d,"request downgrade fallback")&&this.safeEmit(_t.FALLBACK_TO_HLS,zT.AP_ERROR),n(l)}}else n()})}_handleP2PEvents(){this._gateway.signal.on(nt.ON_USER_OFFLINE,()=>{this._p2pChannel.disconnectForReconnect()}),this._gateway.signal.on(Kn.PUBLISH,(e,t,n)=>{const{uid:i}=e;e.forEach(o=>{const{kind:l,ssrcs:d,mid:h,isMuted:f}=o;this._handleP2PAddAudioOrVideoStream(l,i,d[0].ssrcId,h);const g=this._users.find(_=>_.uid===i);return g&&this.store.useP2P?this._p2pChannel.mockSubscribe(g,l,d[0].ssrcId,h).then(()=>{t()}).catch(n):t(),this._handleMuteStream(i,l,!!f)})}),this._gateway.signal.on(Kn.CALL,async(e,t,n)=>{if(this.store.useP2P)try{var i;t(await this._p2pChannel.startP2P({turnServer:(i=this._joinInfo)===null||i===void 0?void 0:i.turnServer},e))}catch(o){n(o)}}),this._gateway.signal.on(Ue.P2P_CONNECTION,async e=>{this.store.useP2P&&(await this._p2pChannel).p2pConnect(e)}),this._gateway.signal.on(Kn.UNPUBLISH,async(e,t,n)=>{if(this.store.useP2P){const{unpubMsg:i,uid:o}=e,l=this._users.find(d=>d.uid===o);if(!l)return S.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(o)),void t();try{i.forEach(async d=>{let{stream_type:h}=d;const f=h===Xt.Audio?xe.AUDIO:xe.VIDEO;await this._p2pChannel.unsubscribe(l,f),this._handleMuteStream(o,f,!0)}),t()}catch(d){n(d)}}}),this._gateway.signal.on(Kn.CONTROL,async(e,t)=>{const{action:n}=e;switch(n){case ql.MUTE_LOCAL_VIDEO:this._handleMuteStream(t,xe.VIDEO,!0);break;case ql.MUTE_LOCAL_AUDIO:this._handleMuteStream(t,xe.AUDIO,!0);break;case ql.UNMUTE_LOCAL_VIDEO:this._handleP2PAddAudioOrVideoStream("video",t),this._handleMuteStream(t,xe.VIDEO,!1);break;case ql.UNMUTE_LOCAL_AUDIO:this._handleP2PAddAudioOrVideoStream("audio",t),this._handleMuteStream(t,xe.AUDIO,!1)}}),this._gateway.signal.on(Kn.RESTART_ICE,async(e,t,n)=>{if(this.store.useP2P)try{const{direction:i,iceParameter:o}=e;i!==js.SEND_ONLY||o?t(await this._p2pChannel.restartICE(i,o)):(this._p2pChannel.handleDisconnect(i),t())}catch(i){n(i)}}),this._gateway.signal.on(Kn.CANDIDATE,e=>{if(this.store.useP2P){const{candidate:t,direction:n}=e;this._p2pChannel.addRemoteCandidate(t,n)}}),this._p2pChannel.on(Ve.RequestP2PRestartICE,async(e,t,n)=>{try{const{direction:i}=e;t(await this._gateway.sendExtensionMessage(Kn.RESTART_ICE,e,i===js.SEND_ONLY))}catch(i){n(i)}}),this._p2pChannel.on(Ve.LocalCandidate,e=>{this._gateway.sendExtensionMessage(Kn.CANDIDATE,JSON.stringify(e),!0)}),this._p2pChannel.on(Ve.RequestP2PMuteLocal,async(e,t,n)=>{try{await this._gateway.sendExtensionMessage(Kn.CONTROL,e,!0),t()}catch(i){n(i)}}),this._p2pChannel.on(Ve.RequestP2PUnmuteRemote,async(e,t,n)=>{if(this._joinInfo)try{await this._gateway.unmuteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(i){i.code===P.DISCONNECT_P2P?t():n(i)}else t()}),this._p2pChannel.on(Ve.RequestP2PMuteRemote,async(e,t,n)=>{if(this._joinInfo)try{await this._gateway.muteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(i){i.code===P.DISCONNECT_P2P?t():n(i)}else t()}),this._p2pChannel.on(Ve.StateChange,(e,t)=>{t===Kt.Connected&&this._p2pChannel.republish()})}_handleP2PChannelEvents(){this._p2pChannel.on(Ve.PeerConnectionStateChange,e=>{const t=this._peerConnectionState;e!==t&&(this.safeEmit(_t.PEERCONNECTION_STATE_CHANGE,e,t),this._peerConnectionState=e)}),this._p2pChannel.on(Ve.RequestMuteLocal,async(e,t,n)=>{if(this._joinInfo)try{await this._gateway.muteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(i){i.code===P.DISCONNECT_P2P?t():n(i)}else t()}),this._p2pChannel.on(Ve.RequestUnmuteLocal,async(e,t,n)=>{if(this._joinInfo)try{await this._gateway.unmuteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(i){i.code===P.DISCONNECT_P2P?t():n(i)}else t()}),this._p2pChannel.on(Ve.RequestRePublish,(e,t,n)=>{this.publish(e,!1).then(t).catch(n)}),this._p2pChannel.on(Ve.RequestRePublishDataChannel,(e,t,n)=>{be.all(e.map(async i=>{const o=await this._p2pChannel.publishDataChannel([i]);try{o.forEach(l=>{this._uid&&this._gateway.publishDataChannel(this._uid,l,!0)})}catch(l){if(l.code!==P.DISCONNECT_P2P)throw l}})).then(t).catch(n)}),this._p2pChannel.on(Ve.RequestReSubscribe,async(e,t,n)=>{try{for(const{user:i,kind:o}of e)o===xe.VIDEO?await this.subscribe(i,"video"):await this.subscribe(i,"audio");t()}catch(i){n(i)}}),this._p2pChannel.on(Ve.RequestUpload,(e,t)=>{this._gateway.upload(e,t)}),this._p2pChannel.on(Ve.RequestUploadStats,e=>{this._gateway.uploadWRTCStats(e)}),this._p2pChannel.on(Ve.MediaReconnectStart,e=>{this.safeEmit(_t.MEDIA_RECONNECT_START,e)}),this._p2pChannel.on(Ve.MediaReconnectEnd,e=>{this.safeEmit(_t.MEDIA_RECONNECT_END,e)}),this._p2pChannel.on(Ve.NeedSignalRTT,e=>{e(this._gateway.getSignalRTT())}),this._p2pChannel.on(Ve.RequestRestartICE,async e=>{if(this.store.useP2P)return;const t=await this._p2pChannel.restartICE(e),n=await t.next();if(n.done)return;const i=n.value;let o;try{o=await this._gateway.restartICE({iceParameters:i})}catch(d){return void t.throw(d)}const{iceParameters:l}=function(d){const h=d.iceParameters;return{iceParameters:{iceUfrag:h.iceUfrag,icePwd:h.icePwd}}}(o);await t.next({remoteIceParameters:l})}),this._p2pChannel.on(Ve.RequestReconnect,async()=>{this._gateway.reconnect()}),this._p2pChannel.on(Ve.RequestReconnectPC,async()=>{var e;const{iceParameters:t,dtlsParameters:n,rtpCapabilities:i}=await this._p2pChannel.startP2PConnection({turnServer:(e=this._joinInfo)===null||e===void 0?void 0:e.turnServer}),{gatewayEstablishParams:o,gatewayAddress:l}=await this._gateway.reconnectPC({iceParameters:t,dtlsParameters:n,rtpCapabilities:i}),d=mV(o,l);await this._p2pChannel.connect(d),await this._p2pChannel.republish(),await this._p2pChannel.reSubscribe()}),this._p2pChannel.on(Ve.RequestUnpublishForReconnectPC,async(e,t,n)=>{this._joinInfo&&this._uid!==void 0?(await this._gateway.unpublish(e,this._uid),t()):n()}),this._p2pChannel.on(Ve.P2PLost,()=>{this.safeEmit(_t.P2P_LOST,this.store.uid)}),this._p2pChannel.on(Ve.UpdateVideoEncoder,e=>{e._encoderConfig&&this._gateway.setVideoProfile(e._encoderConfig)}),this._p2pChannel.on(Ve.ConnectionTypeChange,e=>{this.safeEmit(_t.IS_USING_CLOUD_PROXY,e),this._gateway.setUsingProxy(e)}),this._p2pChannel.on(Ve.FirstVideoBufferReady,(e,t)=>{this.safeEmit(_t.FIRST_VIDEO_BUFFER_READY,e,t)}),this._p2pChannel.on(Ve.FirstVideoPreRender,(e,t)=>{this.safeEmit(_t.FIRST_VIDEO_PRE_RENDER,e,t)}),this._p2pChannel.on(Ve.RequestLowStreamParameter,e=>{e(this._lowStreamParameter||{width:160,height:120,framerate:15,bitrate:50})}),this._p2pChannel.on(Ve.QueryClientConnectionState,e=>{e(this.connectionState)}),this._p2pChannel.on(Ve.AudioMetadata,e=>{this.safeEmit(_t.AUDIO_METADATA,e)}),this._p2pChannel.on(Ve.AudioPts,e=>{this.safeEmit(_t.AUDIO_PTS,Number(e))})}getKeyMetrics(){return this.store.keyMetrics}async enableContentInspect(e){if(!this._joinInfo||this.connectionState!=="CONNECTED")throw new se(P.INVALID_OPERATION,"[".concat(this._clientId,"] can not create content inspect, please join channel first"));if(this._inspect)throw new se(P.INVALID_OPERATION,"[".concat(this._clientId,"] Inspect content service already in connecting/connected state"));try{const n=(t={config:e},Po("ContentInspect").create(t));this._inspect=n,this.handleVideoInspectEvents(n);const{appId:i,cname:o,sid:l,token:d,uid:h,cid:f,vid:g}=this._joinInfo;await n.init({appId:i,areaCode:"",cname:o,sid:l,token:d,uid:h,cid:f,vid:g?Number(g):0},qn)}catch(n){throw Array.isArray(n)?n[0]:n}var t}handleVideoInspectEvents(e){e.on(Pr.CONNECTION_STATE_CHANGE,(t,n)=>{if(this.safeEmit(_t.CONTENT_INSPECT_CONNECTION_STATE_CHANGE,t,n),n===Za.CONNECTED){if(this.connectionState!=="CONNECTED")return void this.safeEmit(_t.CONTENT_INSPECT_ERROR,new se(P.OPERATION_ABORTED,"Content inspect was cancelled because it left the channel"));e.inspectImage()}}),e.on(Pr.INSPECT_RESULT,(t,n)=>{var i;if((n==null?void 0:n.code)===P.INVALID_OPERATION&&this.connectionState==="DISCONNECTED")return S.debug("Stop inspect content because that has left channel"),this==null||(i=this._inspect)===null||i===void 0||i.close(),void(this._inspect=void 0);this.safeEmit(_t.CONTENT_INSPECT_RESULT,t,n)}),e.on(Pr.CLIENT_LOCAL_VIDEO_TRACK,t=>{t(this.localTracks.filter(n=>n.trackMediaType==="video")[0])})}async disableContentInspect(){if(!this._inspect)throw new se(P.INVALID_OPERATION,"[".concat(this._clientId,"] inspectVideoContent not started"));try{this._inspect.close(),this._inspect=void 0}catch(e){throw Array.isArray(e)?e[0]:e}}async setImageModeration(e,t){if(za(e,"enabled"),e){if(!t)throw new se(P.INVALID_PARAMS,"config is required");if(OQ(t),!this._joinInfo)throw new se(P.INVALID_OPERATION,"can not create image moderation, please join channel first");try{if(this._moderation)this._moderation.updateConfig(t);else{const i=(n={config:t},Po("ImageModeration").create(n));this._moderation=i,this.handleImageModerationEvents(i);const{appId:o,cname:l,sid:d,token:h,uid:f,cid:g,vid:_}=this._joinInfo;await i.init({appId:o,areaCode:"",cname:l,sid:d,token:h,uid:f,cid:g,vid:_?Number(_):0},qn)}}catch(i){throw Array.isArray(i)?i[0]:i}}else{var n;if(!this._moderation)throw new se(P.INVALID_OPERATION,"[".concat(this._clientId,"] image moderation not started"));try{this._moderation.close(),this._moderation.removeAllListeners(),this._moderation=void 0}catch(i){throw Array.isArray(i)?i[0]:i}}}handleImageModerationEvents(e){e.on(Uo.CONNECTION_STATE_CHANGE,(t,n)=>{if(this.safeEmit(_t.IMAGE_MODERATION_CONNECTION_STATE_CHANGE,t,n),t===fa.CONNECTED){if(this.connectionState!=="CONNECTED")throw this.setImageModeration(!1),new se(P.OPERATION_ABORTED,"Image moderation was cancelled because it left the channel");e.inspectImage()}}),e.on(Uo.CLIENT_LOCAL_VIDEO_TRACK,t=>{t(this.localTracks.filter(n=>n.trackMediaType==="video")[0])})}setP2PTransport(e){if(function(t){zn(t,"transport",["default","auto","relay","sd-rtn"])}(e),this.mode!=="p2p")throw new se(P.INVALID_OPERATION,"only p2p mode can set p2pTransport");this.store.p2pTransport=e,S.info("[".concat(this._clientId,"] set client p2pTransport to ").concat(e))}getJoinChannelServiceRecords(){return S.debug("getJoinChannelServiceRecords"),this.store.joinChannelServiceRecords}async setPublishAudioFilterEnabled(e){za(e,"enabled"),en("ENABLE_PUBLISH_AUDIO_FILTER",e),this._joinInfo&&await this._gateway.setPublishAudioFilterEnabled(e)}_setRteInfo(e,t){this.store.rteUrl=e,this.store.rteSid=t}_isPreRender(){return"isPreRender"in this._p2pChannel&&this._p2pChannel.isPreRender()}_handleResetAddStream(e,t){switch(t){case"audio":e._audio_added_=!1,e._trust_audio_stream_added_state_=!0;break;case"video":e._video_added_=!1,e._trust_video_stream_added_state_=!0}}},Ce(Ne.prototype,"leave",[xQ],Object.getOwnPropertyDescriptor(Ne.prototype,"leave"),Ne.prototype),Ce(Ne.prototype,"publish",[DQ],Object.getOwnPropertyDescriptor(Ne.prototype,"publish"),Ne.prototype),Ce(Ne.prototype,"unpublish",[BQ],Object.getOwnPropertyDescriptor(Ne.prototype,"unpublish"),Ne.prototype),Ce(Ne.prototype,"subscribe",[kQ],Object.getOwnPropertyDescriptor(Ne.prototype,"subscribe"),Ne.prototype),Ce(Ne.prototype,"presubscribe",[LQ],Object.getOwnPropertyDescriptor(Ne.prototype,"presubscribe"),Ne.prototype),Ce(Ne.prototype,"massSubscribe",[UQ],Object.getOwnPropertyDescriptor(Ne.prototype,"massSubscribe"),Ne.prototype),Ce(Ne.prototype,"unsubscribe",[PQ],Object.getOwnPropertyDescriptor(Ne.prototype,"unsubscribe"),Ne.prototype),Ce(Ne.prototype,"massUnsubscribe",[MQ],Object.getOwnPropertyDescriptor(Ne.prototype,"massUnsubscribe"),Ne.prototype),Ce(Ne.prototype,"setLowStreamParameter",[FQ],Object.getOwnPropertyDescriptor(Ne.prototype,"setLowStreamParameter"),Ne.prototype),Ce(Ne.prototype,"setDualStreamMode",[jQ],Object.getOwnPropertyDescriptor(Ne.prototype,"setDualStreamMode"),Ne.prototype),Ce(Ne.prototype,"enableDualStream",[VQ],Object.getOwnPropertyDescriptor(Ne.prototype,"enableDualStream"),Ne.prototype),Ce(Ne.prototype,"disableDualStream",[QQ],Object.getOwnPropertyDescriptor(Ne.prototype,"disableDualStream"),Ne.prototype),Ce(Ne.prototype,"setClientRole",[HQ],Object.getOwnPropertyDescriptor(Ne.prototype,"setClientRole"),Ne.prototype),Ce(Ne.prototype,"_setClientRoleOptions",[GQ],Object.getOwnPropertyDescriptor(Ne.prototype,"_setClientRoleOptions"),Ne.prototype),Ce(Ne.prototype,"setProxyServer",[KQ],Object.getOwnPropertyDescriptor(Ne.prototype,"setProxyServer"),Ne.prototype),Ce(Ne.prototype,"setTurnServer",[WQ],Object.getOwnPropertyDescriptor(Ne.prototype,"setTurnServer"),Ne.prototype),Ce(Ne.prototype,"setLicense",[YQ],Object.getOwnPropertyDescriptor(Ne.prototype,"setLicense"),Ne.prototype),Ce(Ne.prototype,"startProxyServer",[zQ],Object.getOwnPropertyDescriptor(Ne.prototype,"startProxyServer"),Ne.prototype),Ce(Ne.prototype,"stopProxyServer",[qQ],Object.getOwnPropertyDescriptor(Ne.prototype,"stopProxyServer"),Ne.prototype),Ce(Ne.prototype,"setLocalAccessPointsV2",[XQ],Object.getOwnPropertyDescriptor(Ne.prototype,"setLocalAccessPointsV2"),Ne.prototype),Ce(Ne.prototype,"setLocalAccessPoints",[JQ],Object.getOwnPropertyDescriptor(Ne.prototype,"setLocalAccessPoints"),Ne.prototype),Ce(Ne.prototype,"setRemoteDefaultVideoStreamType",[$Q],Object.getOwnPropertyDescriptor(Ne.prototype,"setRemoteDefaultVideoStreamType"),Ne.prototype),Ce(Ne.prototype,"setRemoteVideoStreamType",[ZQ],Object.getOwnPropertyDescriptor(Ne.prototype,"setRemoteVideoStreamType"),Ne.prototype),Ce(Ne.prototype,"setStreamFallbackOption",[e3],Object.getOwnPropertyDescriptor(Ne.prototype,"setStreamFallbackOption"),Ne.prototype),Ce(Ne.prototype,"setEncryptionConfig",[t3],Object.getOwnPropertyDescriptor(Ne.prototype,"setEncryptionConfig"),Ne.prototype),Ce(Ne.prototype,"renewToken",[n3],Object.getOwnPropertyDescriptor(Ne.prototype,"renewToken"),Ne.prototype),Ce(Ne.prototype,"enableAudioVolumeIndicator",[r3],Object.getOwnPropertyDescriptor(Ne.prototype,"enableAudioVolumeIndicator"),Ne.prototype),Ce(Ne.prototype,"startLiveStreaming",[s3],Object.getOwnPropertyDescriptor(Ne.prototype,"startLiveStreaming"),Ne.prototype),Ce(Ne.prototype,"setLiveTranscoding",[i3],Object.getOwnPropertyDescriptor(Ne.prototype,"setLiveTranscoding"),Ne.prototype),Ce(Ne.prototype,"stopLiveStreaming",[a3],Object.getOwnPropertyDescriptor(Ne.prototype,"stopLiveStreaming"),Ne.prototype),Ce(Ne.prototype,"startChannelMediaRelay",[o3],Object.getOwnPropertyDescriptor(Ne.prototype,"startChannelMediaRelay"),Ne.prototype),Ce(Ne.prototype,"updateChannelMediaRelay",[c3],Object.getOwnPropertyDescriptor(Ne.prototype,"updateChannelMediaRelay"),Ne.prototype),Ce(Ne.prototype,"stopChannelMediaRelay",[l3],Object.getOwnPropertyDescriptor(Ne.prototype,"stopChannelMediaRelay"),Ne.prototype),Ce(Ne.prototype,"sendCustomReportMessage",[A3],Object.getOwnPropertyDescriptor(Ne.prototype,"sendCustomReportMessage"),Ne.prototype),Ce(Ne.prototype,"pickSVCLayer",[d3],Object.getOwnPropertyDescriptor(Ne.prototype,"pickSVCLayer"),Ne.prototype),Ce(Ne.prototype,"setRTMConfig",[u3],Object.getOwnPropertyDescriptor(Ne.prototype,"setRTMConfig"),Ne.prototype),Ce(Ne.prototype,"enableContentInspect",[h3],Object.getOwnPropertyDescriptor(Ne.prototype,"enableContentInspect"),Ne.prototype),Ce(Ne.prototype,"disableContentInspect",[p3],Object.getOwnPropertyDescriptor(Ne.prototype,"disableContentInspect"),Ne.prototype),Ce(Ne.prototype,"setImageModeration",[f3],Object.getOwnPropertyDescriptor(Ne.prototype,"setImageModeration"),Ne.prototype),Ce(Ne.prototype,"setP2PTransport",[m3],Object.getOwnPropertyDescriptor(Ne.prototype,"setP2PTransport"),Ne.prototype),Ce(Ne.prototype,"getJoinChannelServiceRecords",[g3],Object.getOwnPropertyDescriptor(Ne.prototype,"getJoinChannelServiceRecords"),Ne.prototype),Ce(Ne.prototype,"setPublishAudioFilterEnabled",[_3],Object.getOwnPropertyDescriptor(Ne.prototype,"setPublishAudioFilterEnabled"),Ne.prototype),Ne);function v3(){var e;let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{codec:"vp8",audioCodec:"opus",mode:"rtc"};const n=zt(5,"client-"),i=ke.reportApiInvoke(null,{id:n,name:yn.CREATE_CLIENT,options:[t],tag:an.TRACER});try{(function(o){zn(o.codec,"config.codec",["vp8","vp9","av1","h264","h265"]),zn(o.mode,"config.mode",["rtc","live","p2p"]),o.audioCodec!==void 0&&zn(o.audioCodec,"config.audioCodec",["opus","pcmu","pcma","g722"]),o.proxyServer!==void 0&&Kr(o.proxyServer,"config.proxyServer",1,1e4),o.turnServer!==void 0&&$M(o.turnServer),o.httpRetryConfig!==void 0&&JM(o.httpRetryConfig),o.websocketRetryConfig!==void 0&&JM(o.websocketRetryConfig)})(t)}catch(o){throw i.onError(o),o}return(MM(16,0,!0)||VT(16,0,!0))&&(t.codec==="vp9"&&(t.codec="vp8",S.debug("browser not support vp9, force use vp8")),en("UNSUPPORTED_VIDEO_CODEC",["vp9"])),t.audioCodec===void 0&&(t.audioCodec="opus"),i.onSuccess(),new PAe(so(so({forceWaitGatewayResponse:!0},t),{},{role:me(e=["rtc","p2p"]).call(e,t.mode)?"host":t.role||"audience"}),n)}function MAe(){let e=!1;const t=Lt();return(t.name===Mt.CHROME&&Number(t.version)>=58&&(xo.engine.name!=="WebKit"||function(){const n=Lt();if(Ev()){if(n.os===br.MAC_OS)return!0;if(n.os===br.IOS){const i=xo.os.version&&xo.os.version.split(".");if(i&&Number(i[0])===14&&i[1]&&Number(i[1])>=3||i&&Number(i[0])>14)return!0}}return!1}())||t.name===Mt.FIREFOX&&Number(t.version)>=56||t.name===Mt.OPERA&&Number(t.version)>=45||t.name===Mt.SAFARI&&Number(t.version)>=11||t.name==="WebKit"&&(fs()||Ya())&&t.osVersion&&Number(t.osVersion.split(".")[0])>=11||VM()||Lt().name===Mt.QQ)&&(e=!0),e}class Qm{constructor(t,n){x(this,"id",0),x(this,"element",void 0),x(this,"peerPair",void 0),x(this,"context",void 0),x(this,"audioPlayerElement",void 0),x(this,"audioTrack",void 0),Qm.count+=1,this.id=Qm.count,this.element=t,this.context=n}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=t=>{const n=document.createElement("audio");n.srcObject=new MediaStream([t.track]),n.play(),this.audioPlayerElement=n}}async switchSdp(){if(!this.peerPair)return;const t=async(i,o)=>{const l=o==="offer"?await i.createOffer():await i.createAnswer();return await i.setLocalDescription(l),i.iceGatheringState==="complete"?i.localDescription:new be(d=>{i.onicegatheringstatechange=()=>{i.iceGatheringState==="complete"&&d(i.localDescription)}})},n=async(i,o)=>await i.setRemoteDescription(o);try{const i=await t(this.peerPair[0],"offer");await n(this.peerPair[1],i);const o=await t(this.peerPair[1],"answer");await n(this.peerPair[0],o)}catch(i){throw new se(P.LOCAL_AEC_ERROR,i.toString()).print()}}async getTracksFromMediaElement(t){if(this.audioTrack)return this.audioTrack;let n;try{t instanceof HTMLVideoElement&&(t.captureStream?t.captureStream():t.mozCaptureStream()),n=this.context.createMediaStreamDestination(),this.context.createMediaElementSource(t).connect(n)}catch(o){throw new se(P.LOCAL_AEC_ERROR,o.toString()).print()}if(!n)throw new se(P.LOCAL_AEC_ERROR,"no dest node when local aec").print();const i=n.stream.getAudioTracks()[0];return this.audioTrack=i,i}getElement(){return this.element}async startEchoCancellation(){this.context.resume(),this.peerPair&&this.close(),this.initPeers();const t=this.element,n=await this.getTracksFromMediaElement(t);this.peerPair&&this.peerPair[0].addTrack(n),await this.switchSdp()}close(){S.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&this.peerPair.forEach(t=>{t.close()}),this.peerPair=void 0,this.audioPlayerElement=void 0}}var y3,b0;x(Qm,"count",0);const FAe=window.AudioContext||window.webkitAudioContext,jAe=new(y3=We({report:ke}),Ce((b0=class{constructor(){x(this,"units",[]),x(this,"context",void 0)}processExternalMediaAEC(e){if(!this._doesEnvironmentNeedAEC())return S.debug("the system does not need to process local aec"),-1;this.context||(this.context=new FAe);let t=this.units.find(n=>n&&n.getElement()===e);return t||(t=new Qm(e,this.context),this.units.push(t)),t.startEchoCancellation(),S.debug("start processing local audio echo cancellation, id is",t.id),t.id}_doesEnvironmentNeedAEC(){return Lt().name!==Mt.SAFARI}}).prototype,"processExternalMediaAEC",[y3],Object.getOwnPropertyDescriptor(b0.prototype,"processExternalMediaAEC"),b0.prototype),b0);function w3(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}function b3(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?w3(Object(n),!0).forEach(function(i){x(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):w3(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}const kI=window||document;function S3(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(!kI)return;const n=ar._cspEventHandlerPointer;if(n&&t)return void console.error(n,t);const i=o=>{if(!(o&&o.blockedURI&&(ar.onSecurityPolicyViolation||ar.getListeners(mc.SECURITY_POLICY_VIOLATION).length>0)))return;const l=o.blockedURI;L("CSP_DETECTED_HOSTNAME_LIST").some(d=>me(l).call(l,d))&&(ar.onSecurityPolicyViolation&&typeof ar.onSecurityPolicyViolation=="function"&&ar.onSecurityPolicyViolation(o),ar.getListeners(mc.SECURITY_POLICY_VIOLATION).length>0&&ar.safeEmit(mc.SECURITY_POLICY_VIOLATION,o))};n&&kI.removeEventListener("securitypolicyviolation",n),(t||e&&typeof e=="function"||ar.getListeners(mc.SECURITY_POLICY_VIOLATION).length>0)&&kI.addEventListener("securitypolicyviolation",i),ar._cspEventHandlerPointer=i}var VAe=B,QAe=YC,C3=RegExp.prototype,HAe=function(e){return e===C3||VAe(C3,e)?QAe(e):e.flags},Is=A(HAe);function rp(e){let t=e.length;for(;--t>=0;)e[t]=0}const LI=256,T3=286,Hm=30,Gm=15,UI=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),S0=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),GAe=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),R3=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),$c=new Array(576);rp($c);const Km=new Array(60);rp(Km);const Wm=new Array(512);rp(Wm);const Ym=new Array(256);rp(Ym);const PI=new Array(29);rp(PI);const C0=new Array(Hm);function MI(e,t,n,i,o){this.static_tree=e,this.extra_bits=t,this.extra_base=n,this.elems=i,this.max_length=o,this.has_stree=e&&e.length}let I3,N3,O3;function FI(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}rp(C0);const x3=e=>e<256?Wm[e]:Wm[256+(e>>>7)],zm=(e,t)=>{e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255},qi=(e,t,n)=>{e.bi_valid>16-n?(e.bi_buf|=t<<e.bi_valid&65535,zm(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=n-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=n)},wc=(e,t,n)=>{qi(e,n[2*t],n[2*t+1])},D3=(e,t)=>{let n=0;do n|=1&e,e>>>=1,n<<=1;while(--t>0);return n>>>1},B3=(e,t,n)=>{const i=new Array(16);let o,l,d=0;for(o=1;o<=Gm;o++)d=d+n[o-1]<<1,i[o]=d;for(l=0;l<=t;l++){let h=e[2*l+1];h!==0&&(e[2*l]=D3(i[h]++,h))}},k3=e=>{let t;for(t=0;t<T3;t++)e.dyn_ltree[2*t]=0;for(t=0;t<Hm;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0},L3=e=>{e.bi_valid>8?zm(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},U3=(e,t,n,i)=>{const o=2*t,l=2*n;return e[o]<e[l]||e[o]===e[l]&&i[t]<=i[n]},jI=(e,t,n)=>{const i=e.heap[n];let o=n<<1;for(;o<=e.heap_len&&(o<e.heap_len&&U3(t,e.heap[o+1],e.heap[o],e.depth)&&o++,!U3(t,i,e.heap[o],e.depth));)e.heap[n]=e.heap[o],n=o,o<<=1;e.heap[n]=i},P3=(e,t,n)=>{let i,o,l,d,h=0;if(e.sym_next!==0)do i=255&e.pending_buf[e.sym_buf+h++],i+=(255&e.pending_buf[e.sym_buf+h++])<<8,o=e.pending_buf[e.sym_buf+h++],i===0?wc(e,o,t):(l=Ym[o],wc(e,l+LI+1,t),d=UI[l],d!==0&&(o-=PI[l],qi(e,o,d)),i--,l=x3(i),wc(e,l,n),d=S0[l],d!==0&&(i-=C0[l],qi(e,i,d)));while(h<e.sym_next);wc(e,256,t)},VI=(e,t)=>{const n=t.dyn_tree,i=t.stat_desc.static_tree,o=t.stat_desc.has_stree,l=t.stat_desc.elems;let d,h,f,g=-1;for(e.heap_len=0,e.heap_max=573,d=0;d<l;d++)n[2*d]!==0?(e.heap[++e.heap_len]=g=d,e.depth[d]=0):n[2*d+1]=0;for(;e.heap_len<2;)f=e.heap[++e.heap_len]=g<2?++g:0,n[2*f]=1,e.depth[f]=0,e.opt_len--,o&&(e.static_len-=i[2*f+1]);for(t.max_code=g,d=e.heap_len>>1;d>=1;d--)jI(e,n,d);f=l;do d=e.heap[1],e.heap[1]=e.heap[e.heap_len--],jI(e,n,1),h=e.heap[1],e.heap[--e.heap_max]=d,e.heap[--e.heap_max]=h,n[2*f]=n[2*d]+n[2*h],e.depth[f]=(e.depth[d]>=e.depth[h]?e.depth[d]:e.depth[h])+1,n[2*d+1]=n[2*h+1]=f,e.heap[1]=f++,jI(e,n,1);while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],((_,v)=>{const y=v.dyn_tree,b=v.max_code,D=v.stat_desc.static_tree,I=v.stat_desc.has_stree,O=v.stat_desc.extra_bits,U=v.stat_desc.extra_base,j=v.stat_desc.max_length;let G,$,Z,X,ee,le,fe=0;for(X=0;X<=Gm;X++)_.bl_count[X]=0;for(y[2*_.heap[_.heap_max]+1]=0,G=_.heap_max+1;G<573;G++)$=_.heap[G],X=y[2*y[2*$+1]+1]+1,X>j&&(X=j,fe++),y[2*$+1]=X,$>b||(_.bl_count[X]++,ee=0,$>=U&&(ee=O[$-U]),le=y[2*$],_.opt_len+=le*(X+ee),I&&(_.static_len+=le*(D[2*$+1]+ee)));if(fe!==0){do{for(X=j-1;_.bl_count[X]===0;)X--;_.bl_count[X]--,_.bl_count[X+1]+=2,_.bl_count[j]--,fe-=2}while(fe>0);for(X=j;X!==0;X--)for($=_.bl_count[X];$!==0;)Z=_.heap[--G],Z>b||(y[2*Z+1]!==X&&(_.opt_len+=(X-y[2*Z+1])*y[2*Z],y[2*Z+1]=X),$--)}})(e,t),B3(n,g,e.bl_count)},M3=(e,t,n)=>{let i,o,l=-1,d=t[1],h=0,f=7,g=4;for(d===0&&(f=138,g=3),t[2*(n+1)+1]=65535,i=0;i<=n;i++)o=d,d=t[2*(i+1)+1],++h<f&&o===d||(h<g?e.bl_tree[2*o]+=h:o!==0?(o!==l&&e.bl_tree[2*o]++,e.bl_tree[32]++):h<=10?e.bl_tree[34]++:e.bl_tree[36]++,h=0,l=o,d===0?(f=138,g=3):o===d?(f=6,g=3):(f=7,g=4))},F3=(e,t,n)=>{let i,o,l=-1,d=t[1],h=0,f=7,g=4;for(d===0&&(f=138,g=3),i=0;i<=n;i++)if(o=d,d=t[2*(i+1)+1],!(++h<f&&o===d)){if(h<g)do wc(e,o,e.bl_tree);while(--h!=0);else o!==0?(o!==l&&(wc(e,o,e.bl_tree),h--),wc(e,16,e.bl_tree),qi(e,h-3,2)):h<=10?(wc(e,17,e.bl_tree),qi(e,h-3,3)):(wc(e,18,e.bl_tree),qi(e,h-11,7));h=0,l=o,d===0?(f=138,g=3):o===d?(f=6,g=3):(f=7,g=4)}};let j3=!1;const V3=(e,t,n,i)=>{qi(e,0+(i?1:0),3),L3(e),zm(e,n),zm(e,~n),n&&e.pending_buf.set(e.window.subarray(t,t+n),e.pending),e.pending+=n};var KAe=e=>{j3||((()=>{let t,n,i,o,l;const d=new Array(16);for(i=0,o=0;o<28;o++)for(PI[o]=i,t=0;t<1<<UI[o];t++)Ym[i++]=o;for(Ym[i-1]=o,l=0,o=0;o<16;o++)for(C0[o]=l,t=0;t<1<<S0[o];t++)Wm[l++]=o;for(l>>=7;o<Hm;o++)for(C0[o]=l<<7,t=0;t<1<<S0[o]-7;t++)Wm[256+l++]=o;for(n=0;n<=Gm;n++)d[n]=0;for(t=0;t<=143;)$c[2*t+1]=8,t++,d[8]++;for(;t<=255;)$c[2*t+1]=9,t++,d[9]++;for(;t<=279;)$c[2*t+1]=7,t++,d[7]++;for(;t<=287;)$c[2*t+1]=8,t++,d[8]++;for(B3($c,287,d),t=0;t<Hm;t++)Km[2*t+1]=5,Km[2*t]=D3(t,5);I3=new MI($c,UI,257,T3,Gm),N3=new MI(Km,S0,0,Hm,Gm),O3=new MI(new Array(0),GAe,0,19,7)})(),j3=!0),e.l_desc=new FI(e.dyn_ltree,I3),e.d_desc=new FI(e.dyn_dtree,N3),e.bl_desc=new FI(e.bl_tree,O3),e.bi_buf=0,e.bi_valid=0,k3(e)},WAe=(e,t,n,i)=>{let o,l,d=0;e.level>0?(e.strm.data_type===2&&(e.strm.data_type=(h=>{let f,g=4093624447;for(f=0;f<=31;f++,g>>>=1)if(1&g&&h.dyn_ltree[2*f]!==0)return 0;if(h.dyn_ltree[18]!==0||h.dyn_ltree[20]!==0||h.dyn_ltree[26]!==0)return 1;for(f=32;f<LI;f++)if(h.dyn_ltree[2*f]!==0)return 1;return 0})(e)),VI(e,e.l_desc),VI(e,e.d_desc),d=(h=>{let f;for(M3(h,h.dyn_ltree,h.l_desc.max_code),M3(h,h.dyn_dtree,h.d_desc.max_code),VI(h,h.bl_desc),f=18;f>=3&&h.bl_tree[2*R3[f]+1]===0;f--);return h.opt_len+=3*(f+1)+5+5+4,f})(e),o=e.opt_len+3+7>>>3,l=e.static_len+3+7>>>3,l<=o&&(o=l)):o=l=n+5,n+4<=o&&t!==-1?V3(e,t,n,i):e.strategy===4||l===o?(qi(e,2+(i?1:0),3),P3(e,$c,Km)):(qi(e,4+(i?1:0),3),((h,f,g,_)=>{let v;for(qi(h,f-257,5),qi(h,g-1,5),qi(h,_-4,4),v=0;v<_;v++)qi(h,h.bl_tree[2*R3[v]+1],3);F3(h,h.dyn_ltree,f-1),F3(h,h.dyn_dtree,g-1)})(e,e.l_desc.max_code+1,e.d_desc.max_code+1,d+1),P3(e,e.dyn_ltree,e.dyn_dtree)),k3(e),i&&L3(e)},YAe=(e,t,n)=>(e.pending_buf[e.sym_buf+e.sym_next++]=t,e.pending_buf[e.sym_buf+e.sym_next++]=t>>8,e.pending_buf[e.sym_buf+e.sym_next++]=n,t===0?e.dyn_ltree[2*n]++:(e.matches++,t--,e.dyn_ltree[2*(Ym[n]+LI+1)]++,e.dyn_dtree[2*x3(t)]++),e.sym_next===e.sym_end),zAe=e=>{qi(e,2,3),wc(e,256,$c),(t=>{t.bi_valid===16?(zm(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)})(e)},qAe={_tr_init:KAe,_tr_stored_block:V3,_tr_flush_block:WAe,_tr_tally:YAe,_tr_align:zAe},qm=(e,t,n,i)=>{let o=65535&e|0,l=e>>>16&65535|0,d=0;for(;n!==0;){d=n>2e3?2e3:n,n-=d;do o=o+t[i++]|0,l=l+o|0;while(--d);o%=65521,l%=65521}return o|l<<16|0};const XAe=new Uint32Array((()=>{let e,t=[];for(var n=0;n<256;n++){e=n;for(var i=0;i<8;i++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t})());var Vs=(e,t,n,i)=>{const o=XAe,l=i+n;e^=-1;for(let d=i;d<l;d++)e=e>>>8^o[255&(e^t[d])];return-1^e},Kd={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},T0={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:JAe,_tr_stored_block:QI,_tr_flush_block:$Ae,_tr_tally:nA,_tr_align:ZAe}=qAe,{Z_NO_FLUSH:rA,Z_PARTIAL_FLUSH:ede,Z_FULL_FLUSH:tde,Z_FINISH:io,Z_BLOCK:Q3,Z_OK:ni,Z_STREAM_END:H3,Z_STREAM_ERROR:bc,Z_DATA_ERROR:nde,Z_BUF_ERROR:HI,Z_DEFAULT_COMPRESSION:rde,Z_FILTERED:sde,Z_HUFFMAN_ONLY:R0,Z_RLE:ide,Z_FIXED:ade,Z_DEFAULT_STRATEGY:ode,Z_UNKNOWN:cde,Z_DEFLATED:I0}=T0,GI=286,lde=30,Ade=19,dde=2*GI+1,ude=15,Wd=258,Sc=262,sp=42,Yd=113,Xm=666,zd=(e,t)=>(e.msg=Kd[t],t),G3=e=>2*e-(e>4?9:0),sA=e=>{let t=e.length;for(;--t>=0;)e[t]=0},hde=e=>{let t,n,i,o=e.w_size;t=e.hash_size,i=t;do n=e.head[--i],e.head[i]=n>=o?n-o:0;while(--t);t=o,i=t;do n=e.prev[--i],e.prev[i]=n>=o?n-o:0;while(--t)};let iA=(e,t,n)=>(t<<e.hash_shift^n)&e.hash_mask;const ma=e=>{const t=e.state;let n=t.pending;n>e.avail_out&&(n=e.avail_out),n!==0&&(e.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+n),e.next_out),e.next_out+=n,t.pending_out+=n,e.total_out+=n,e.avail_out-=n,t.pending-=n,t.pending===0&&(t.pending_out=0))},ga=(e,t)=>{$Ae(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,ma(e.strm)},jn=(e,t)=>{e.pending_buf[e.pending++]=t},Jm=(e,t)=>{e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t},KI=(e,t,n,i)=>{let o=e.avail_in;return o>i&&(o=i),o===0?0:(e.avail_in-=o,t.set(e.input.subarray(e.next_in,e.next_in+o),n),e.state.wrap===1?e.adler=qm(e.adler,t,o,n):e.state.wrap===2&&(e.adler=Vs(e.adler,t,o,n)),e.next_in+=o,e.total_in+=o,o)},K3=(e,t)=>{let n,i,o=e.max_chain_length,l=e.strstart,d=e.prev_length,h=e.nice_match;const f=e.strstart>e.w_size-Sc?e.strstart-(e.w_size-Sc):0,g=e.window,_=e.w_mask,v=e.prev,y=e.strstart+Wd;let b=g[l+d-1],D=g[l+d];e.prev_length>=e.good_match&&(o>>=2),h>e.lookahead&&(h=e.lookahead);do if(n=t,g[n+d]===D&&g[n+d-1]===b&&g[n]===g[l]&&g[++n]===g[l+1]){l+=2,n++;do;while(g[++l]===g[++n]&&g[++l]===g[++n]&&g[++l]===g[++n]&&g[++l]===g[++n]&&g[++l]===g[++n]&&g[++l]===g[++n]&&g[++l]===g[++n]&&g[++l]===g[++n]&&l<y);if(i=Wd-(y-l),l=y-Wd,i>d){if(e.match_start=t,d=i,i>=h)break;b=g[l+d-1],D=g[l+d]}}while((t=v[t&_])>f&&--o!=0);return d<=e.lookahead?d:e.lookahead},ip=e=>{const t=e.w_size;let n,i,o;do{if(i=e.window_size-e.lookahead-e.strstart,e.strstart>=t+(t-Sc)&&(e.window.set(e.window.subarray(t,t+t-i),0),e.match_start-=t,e.strstart-=t,e.block_start-=t,e.insert>e.strstart&&(e.insert=e.strstart),hde(e),i+=t),e.strm.avail_in===0)break;if(n=KI(e.strm,e.window,e.strstart+e.lookahead,i),e.lookahead+=n,e.lookahead+e.insert>=3)for(o=e.strstart-e.insert,e.ins_h=e.window[o],e.ins_h=iA(e,e.ins_h,e.window[o+1]);e.insert&&(e.ins_h=iA(e,e.ins_h,e.window[o+3-1]),e.prev[o&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=o,o++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<Sc&&e.strm.avail_in!==0)},W3=(e,t)=>{let n,i,o,l=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,d=0,h=e.strm.avail_in;do{if(n=65535,o=e.bi_valid+42>>3,e.strm.avail_out<o||(o=e.strm.avail_out-o,i=e.strstart-e.block_start,n>i+e.strm.avail_in&&(n=i+e.strm.avail_in),n>o&&(n=o),n<l&&(n===0&&t!==io||t===rA||n!==i+e.strm.avail_in)))break;d=t===io&&n===i+e.strm.avail_in?1:0,QI(e,0,0,d),e.pending_buf[e.pending-4]=n,e.pending_buf[e.pending-3]=n>>8,e.pending_buf[e.pending-2]=~n,e.pending_buf[e.pending-1]=~n>>8,ma(e.strm),i&&(i>n&&(i=n),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+i),e.strm.next_out),e.strm.next_out+=i,e.strm.avail_out-=i,e.strm.total_out+=i,e.block_start+=i,n-=i),n&&(KI(e.strm,e.strm.output,e.strm.next_out,n),e.strm.next_out+=n,e.strm.avail_out-=n,e.strm.total_out+=n)}while(d===0);return h-=e.strm.avail_in,h&&(h>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=h&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart&&(e.insert=e.strstart)),e.window.set(e.strm.input.subarray(e.strm.next_in-h,e.strm.next_in),e.strstart),e.strstart+=h,e.insert+=h>e.w_size-e.insert?e.w_size-e.insert:h),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),d?4:t!==rA&&t!==io&&e.strm.avail_in===0&&e.strstart===e.block_start?2:(o=e.window_size-e.strstart,e.strm.avail_in>o&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,o+=e.w_size,e.insert>e.strstart&&(e.insert=e.strstart)),o>e.strm.avail_in&&(o=e.strm.avail_in),o&&(KI(e.strm,e.window,e.strstart,o),e.strstart+=o,e.insert+=o>e.w_size-e.insert?e.w_size-e.insert:o),e.high_water<e.strstart&&(e.high_water=e.strstart),o=e.bi_valid+42>>3,o=e.pending_buf_size-o>65535?65535:e.pending_buf_size-o,l=o>e.w_size?e.w_size:o,i=e.strstart-e.block_start,(i>=l||(i||t===io)&&t!==rA&&e.strm.avail_in===0&&i<=o)&&(n=i>o?o:i,d=t===io&&e.strm.avail_in===0&&n===i?1:0,QI(e,e.block_start,n,d),e.block_start+=n,ma(e.strm)),d?3:1)},WI=(e,t)=>{let n,i;for(;;){if(e.lookahead<Sc){if(ip(e),e.lookahead<Sc&&t===rA)return 1;if(e.lookahead===0)break}if(n=0,e.lookahead>=3&&(e.ins_h=iA(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),n!==0&&e.strstart-n<=e.w_size-Sc&&(e.match_length=K3(e,n)),e.match_length>=3)if(i=nA(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do e.strstart++,e.ins_h=iA(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart;while(--e.match_length!=0);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=iA(e,e.ins_h,e.window[e.strstart+1]);else i=nA(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(i&&(ga(e,!1),e.strm.avail_out===0))return 1}return e.insert=e.strstart<2?e.strstart:2,t===io?(ga(e,!0),e.strm.avail_out===0?3:4):e.sym_next&&(ga(e,!1),e.strm.avail_out===0)?1:2},ap=(e,t)=>{let n,i,o;for(;;){if(e.lookahead<Sc){if(ip(e),e.lookahead<Sc&&t===rA)return 1;if(e.lookahead===0)break}if(n=0,e.lookahead>=3&&(e.ins_h=iA(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,n!==0&&e.prev_length<e.max_lazy_match&&e.strstart-n<=e.w_size-Sc&&(e.match_length=K3(e,n),e.match_length<=5&&(e.strategy===sde||e.match_length===3&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){o=e.strstart+e.lookahead-3,i=nA(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do++e.strstart<=o&&(e.ins_h=iA(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart);while(--e.prev_length!=0);if(e.match_available=0,e.match_length=2,e.strstart++,i&&(ga(e,!1),e.strm.avail_out===0))return 1}else if(e.match_available){if(i=nA(e,0,e.window[e.strstart-1]),i&&ga(e,!1),e.strstart++,e.lookahead--,e.strm.avail_out===0)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(i=nA(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,t===io?(ga(e,!0),e.strm.avail_out===0?3:4):e.sym_next&&(ga(e,!1),e.strm.avail_out===0)?1:2};function Cc(e,t,n,i,o){this.good_length=e,this.max_lazy=t,this.nice_length=n,this.max_chain=i,this.func=o}const $m=[new Cc(0,0,0,0,W3),new Cc(4,4,8,4,WI),new Cc(4,5,16,8,WI),new Cc(4,6,32,32,WI),new Cc(4,4,16,16,ap),new Cc(8,16,32,32,ap),new Cc(8,16,128,128,ap),new Cc(8,32,128,256,ap),new Cc(32,128,258,1024,ap),new Cc(32,258,258,4096,ap)];function pde(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=I0,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(2*dde),this.dyn_dtree=new Uint16Array(2*(2*lde+1)),this.bl_tree=new Uint16Array(2*(2*Ade+1)),sA(this.dyn_ltree),sA(this.dyn_dtree),sA(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(ude+1),this.heap=new Uint16Array(2*GI+1),sA(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*GI+1),sA(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const Zm=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.status!==sp&&t.status!==57&&t.status!==69&&t.status!==73&&t.status!==91&&t.status!==103&&t.status!==Yd&&t.status!==Xm?1:0},Y3=e=>{if(Zm(e))return zd(e,bc);e.total_in=e.total_out=0,e.data_type=cde;const t=e.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap===2?57:t.wrap?sp:Yd,e.adler=t.wrap===2?0:1,t.last_flush=-2,JAe(t),ni},z3=e=>{const t=Y3(e);return t===ni&&(n=>{n.window_size=2*n.w_size,sA(n.head),n.max_lazy_match=$m[n.level].max_lazy,n.good_match=$m[n.level].good_length,n.nice_match=$m[n.level].nice_length,n.max_chain_length=$m[n.level].max_chain,n.strstart=0,n.block_start=0,n.lookahead=0,n.insert=0,n.match_length=n.prev_length=2,n.match_available=0,n.ins_h=0})(e.state),t},q3=(e,t,n,i,o,l)=>{if(!e)return bc;let d=1;if(t===rde&&(t=6),i<0?(d=0,i=-i):i>15&&(d=2,i-=16),o<1||o>9||n!==I0||i<8||i>15||t<0||t>9||l<0||l>ade||i===8&&d!==1)return zd(e,bc);i===8&&(i=9);const h=new pde;return e.state=h,h.strm=e,h.status=sp,h.wrap=d,h.gzhead=null,h.w_bits=i,h.w_size=1<<h.w_bits,h.w_mask=h.w_size-1,h.hash_bits=o+7,h.hash_size=1<<h.hash_bits,h.hash_mask=h.hash_size-1,h.hash_shift=~~((h.hash_bits+3-1)/3),h.window=new Uint8Array(2*h.w_size),h.head=new Uint16Array(h.hash_size),h.prev=new Uint16Array(h.w_size),h.lit_bufsize=1<<o+6,h.pending_buf_size=4*h.lit_bufsize,h.pending_buf=new Uint8Array(h.pending_buf_size),h.sym_buf=h.lit_bufsize,h.sym_end=3*(h.lit_bufsize-1),h.level=t,h.strategy=l,h.method=n,z3(e)};var fde=(e,t)=>{if(Zm(e)||t>Q3||t<0)return e?zd(e,bc):bc;const n=e.state;if(!e.output||e.avail_in!==0&&!e.input||n.status===Xm&&t!==io)return zd(e,e.avail_out===0?HI:bc);const i=n.last_flush;if(n.last_flush=t,n.pending!==0){if(ma(e),e.avail_out===0)return n.last_flush=-1,ni}else if(e.avail_in===0&&G3(t)<=G3(i)&&t!==io)return zd(e,HI);if(n.status===Xm&&e.avail_in!==0)return zd(e,HI);if(n.status===sp&&n.wrap===0&&(n.status=Yd),n.status===sp){let o=I0+(n.w_bits-8<<4)<<8,l=-1;if(l=n.strategy>=R0||n.level<2?0:n.level<6?1:n.level===6?2:3,o|=l<<6,n.strstart!==0&&(o|=32),o+=31-o%31,Jm(n,o),n.strstart!==0&&(Jm(n,e.adler>>>16),Jm(n,65535&e.adler)),e.adler=1,n.status=Yd,ma(e),n.pending!==0)return n.last_flush=-1,ni}if(n.status===57){if(e.adler=0,jn(n,31),jn(n,139),jn(n,8),n.gzhead)jn(n,(n.gzhead.text?1:0)+(n.gzhead.hcrc?2:0)+(n.gzhead.extra?4:0)+(n.gzhead.name?8:0)+(n.gzhead.comment?16:0)),jn(n,255&n.gzhead.time),jn(n,n.gzhead.time>>8&255),jn(n,n.gzhead.time>>16&255),jn(n,n.gzhead.time>>24&255),jn(n,n.level===9?2:n.strategy>=R0||n.level<2?4:0),jn(n,255&n.gzhead.os),n.gzhead.extra&&n.gzhead.extra.length&&(jn(n,255&n.gzhead.extra.length),jn(n,n.gzhead.extra.length>>8&255)),n.gzhead.hcrc&&(e.adler=Vs(e.adler,n.pending_buf,n.pending,0)),n.gzindex=0,n.status=69;else if(jn(n,0),jn(n,0),jn(n,0),jn(n,0),jn(n,0),jn(n,n.level===9?2:n.strategy>=R0||n.level<2?4:0),jn(n,3),n.status=Yd,ma(e),n.pending!==0)return n.last_flush=-1,ni}if(n.status===69){if(n.gzhead.extra){let o=n.pending,l=(65535&n.gzhead.extra.length)-n.gzindex;for(;n.pending+l>n.pending_buf_size;){let h=n.pending_buf_size-n.pending;if(n.pending_buf.set(n.gzhead.extra.subarray(n.gzindex,n.gzindex+h),n.pending),n.pending=n.pending_buf_size,n.gzhead.hcrc&&n.pending>o&&(e.adler=Vs(e.adler,n.pending_buf,n.pending-o,o)),n.gzindex+=h,ma(e),n.pending!==0)return n.last_flush=-1,ni;o=0,l-=h}let d=new Uint8Array(n.gzhead.extra);n.pending_buf.set(d.subarray(n.gzindex,n.gzindex+l),n.pending),n.pending+=l,n.gzhead.hcrc&&n.pending>o&&(e.adler=Vs(e.adler,n.pending_buf,n.pending-o,o)),n.gzindex=0}n.status=73}if(n.status===73){if(n.gzhead.name){let o,l=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>l&&(e.adler=Vs(e.adler,n.pending_buf,n.pending-l,l)),ma(e),n.pending!==0)return n.last_flush=-1,ni;l=0}o=n.gzindex<n.gzhead.name.length?255&n.gzhead.name.charCodeAt(n.gzindex++):0,jn(n,o)}while(o!==0);n.gzhead.hcrc&&n.pending>l&&(e.adler=Vs(e.adler,n.pending_buf,n.pending-l,l)),n.gzindex=0}n.status=91}if(n.status===91){if(n.gzhead.comment){let o,l=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>l&&(e.adler=Vs(e.adler,n.pending_buf,n.pending-l,l)),ma(e),n.pending!==0)return n.last_flush=-1,ni;l=0}o=n.gzindex<n.gzhead.comment.length?255&n.gzhead.comment.charCodeAt(n.gzindex++):0,jn(n,o)}while(o!==0);n.gzhead.hcrc&&n.pending>l&&(e.adler=Vs(e.adler,n.pending_buf,n.pending-l,l))}n.status=103}if(n.status===103){if(n.gzhead.hcrc){if(n.pending+2>n.pending_buf_size&&(ma(e),n.pending!==0))return n.last_flush=-1,ni;jn(n,255&e.adler),jn(n,e.adler>>8&255),e.adler=0}if(n.status=Yd,ma(e),n.pending!==0)return n.last_flush=-1,ni}if(e.avail_in!==0||n.lookahead!==0||t!==rA&&n.status!==Xm){let o=n.level===0?W3(n,t):n.strategy===R0?((l,d)=>{let h;for(;;){if(l.lookahead===0&&(ip(l),l.lookahead===0)){if(d===rA)return 1;break}if(l.match_length=0,h=nA(l,0,l.window[l.strstart]),l.lookahead--,l.strstart++,h&&(ga(l,!1),l.strm.avail_out===0))return 1}return l.insert=0,d===io?(ga(l,!0),l.strm.avail_out===0?3:4):l.sym_next&&(ga(l,!1),l.strm.avail_out===0)?1:2})(n,t):n.strategy===ide?((l,d)=>{let h,f,g,_;const v=l.window;for(;;){if(l.lookahead<=Wd){if(ip(l),l.lookahead<=Wd&&d===rA)return 1;if(l.lookahead===0)break}if(l.match_length=0,l.lookahead>=3&&l.strstart>0&&(g=l.strstart-1,f=v[g],f===v[++g]&&f===v[++g]&&f===v[++g])){_=l.strstart+Wd;do;while(f===v[++g]&&f===v[++g]&&f===v[++g]&&f===v[++g]&&f===v[++g]&&f===v[++g]&&f===v[++g]&&f===v[++g]&&g<_);l.match_length=Wd-(_-g),l.match_length>l.lookahead&&(l.match_length=l.lookahead)}if(l.match_length>=3?(h=nA(l,1,l.match_length-3),l.lookahead-=l.match_length,l.strstart+=l.match_length,l.match_length=0):(h=nA(l,0,l.window[l.strstart]),l.lookahead--,l.strstart++),h&&(ga(l,!1),l.strm.avail_out===0))return 1}return l.insert=0,d===io?(ga(l,!0),l.strm.avail_out===0?3:4):l.sym_next&&(ga(l,!1),l.strm.avail_out===0)?1:2})(n,t):$m[n.level].func(n,t);if(o!==3&&o!==4||(n.status=Xm),o===1||o===3)return e.avail_out===0&&(n.last_flush=-1),ni;if(o===2&&(t===ede?ZAe(n):t!==Q3&&(QI(n,0,0,!1),t===tde&&(sA(n.head),n.lookahead===0&&(n.strstart=0,n.block_start=0,n.insert=0))),ma(e),e.avail_out===0))return n.last_flush=-1,ni}return t!==io?ni:n.wrap<=0?H3:(n.wrap===2?(jn(n,255&e.adler),jn(n,e.adler>>8&255),jn(n,e.adler>>16&255),jn(n,e.adler>>24&255),jn(n,255&e.total_in),jn(n,e.total_in>>8&255),jn(n,e.total_in>>16&255),jn(n,e.total_in>>24&255)):(Jm(n,e.adler>>>16),Jm(n,65535&e.adler)),ma(e),n.wrap>0&&(n.wrap=-n.wrap),n.pending!==0?ni:H3)},mde=(e,t)=>{let n=t.length;if(Zm(e))return bc;const i=e.state,o=i.wrap;if(o===2||o===1&&i.status!==sp||i.lookahead)return bc;if(o===1&&(e.adler=qm(e.adler,t,n,0)),i.wrap=0,n>=i.w_size){o===0&&(sA(i.head),i.strstart=0,i.block_start=0,i.insert=0);let f=new Uint8Array(i.w_size);f.set(t.subarray(n-i.w_size,n),0),t=f,n=i.w_size}const l=e.avail_in,d=e.next_in,h=e.input;for(e.avail_in=n,e.next_in=0,e.input=t,ip(i);i.lookahead>=3;){let f=i.strstart,g=i.lookahead-2;do i.ins_h=iA(i,i.ins_h,i.window[f+3-1]),i.prev[f&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=f,f++;while(--g);i.strstart=f,i.lookahead=2,ip(i)}return i.strstart+=i.lookahead,i.block_start=i.strstart,i.insert=i.lookahead,i.lookahead=0,i.match_length=i.prev_length=2,i.match_available=0,e.next_in=d,e.input=h,e.avail_in=l,i.wrap=o,ni},eg={deflateInit:(e,t)=>q3(e,t,I0,15,8,ode),deflateInit2:q3,deflateReset:z3,deflateResetKeep:Y3,deflateSetHeader:(e,t)=>Zm(e)||e.state.wrap!==2?bc:(e.state.gzhead=t,ni),deflate:fde,deflateEnd:e=>{if(Zm(e))return bc;const t=e.state.status;return e.state=null,t===Yd?zd(e,nde):ni},deflateSetDictionary:mde,deflateInfo:"pako deflate (from Nodeca project)"};const gde=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var N0={assign:function(e){const t=Array.prototype.slice.call(arguments,1);for(;t.length;){const n=t.shift();if(n){if(typeof n!="object")throw new TypeError(n+"must be non-object");for(const i in n)gde(n,i)&&(e[i]=n[i])}}return e},flattenChunks:e=>{let t=0;for(let i=0,o=e.length;i<o;i++)t+=e[i].length;const n=new Uint8Array(t);for(let i=0,o=0,l=e.length;i<l;i++){let d=e[i];n.set(d,o),o+=d.length}return n}};let X3=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{X3=!1}const tg=new Uint8Array(256);for(let e=0;e<256;e++)tg[e]=e>=252?6:e>=248?5:e>=240?4:e>=224?3:e>=192?2:1;tg[254]=tg[254]=1;var ng={string2buf:e=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(e);let t,n,i,o,l,d=e.length,h=0;for(o=0;o<d;o++)n=e.charCodeAt(o),(64512&n)==55296&&o+1<d&&(i=e.charCodeAt(o+1),(64512&i)==56320&&(n=65536+(n-55296<<10)+(i-56320),o++)),h+=n<128?1:n<2048?2:n<65536?3:4;for(t=new Uint8Array(h),l=0,o=0;l<h;o++)n=e.charCodeAt(o),(64512&n)==55296&&o+1<d&&(i=e.charCodeAt(o+1),(64512&i)==56320&&(n=65536+(n-55296<<10)+(i-56320),o++)),n<128?t[l++]=n:n<2048?(t[l++]=192|n>>>6,t[l++]=128|63&n):n<65536?(t[l++]=224|n>>>12,t[l++]=128|n>>>6&63,t[l++]=128|63&n):(t[l++]=240|n>>>18,t[l++]=128|n>>>12&63,t[l++]=128|n>>>6&63,t[l++]=128|63&n);return t},buf2string:(e,t)=>{const n=t||e.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(e.subarray(0,t));let i,o;const l=new Array(2*n);for(o=0,i=0;i<n;){let d=e[i++];if(d<128){l[o++]=d;continue}let h=tg[d];if(h>4)l[o++]=65533,i+=h-1;else{for(d&=h===2?31:h===3?15:7;h>1&&i<n;)d=d<<6|63&e[i++],h--;h>1?l[o++]=65533:d<65536?l[o++]=d:(d-=65536,l[o++]=55296|d>>10&1023,l[o++]=56320|1023&d)}}return((d,h)=>{if(h<65534&&d.subarray&&X3)return String.fromCharCode.apply(null,d.length===h?d:d.subarray(0,h));let f="";for(let g=0;g<h;g++)f+=String.fromCharCode(d[g]);return f})(l,o)},utf8border:(e,t)=>{(t=t||e.length)>e.length&&(t=e.length);let n=t-1;for(;n>=0&&(192&e[n])==128;)n--;return n<0||n===0?t:n+tg[e[n]]>t?n:t}},J3=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const $3=Object.prototype.toString,{Z_NO_FLUSH:_de,Z_SYNC_FLUSH:Ede,Z_FULL_FLUSH:vde,Z_FINISH:yde,Z_OK:O0,Z_STREAM_END:wde,Z_DEFAULT_COMPRESSION:bde,Z_DEFAULT_STRATEGY:Sde,Z_DEFLATED:Cde}=T0;function x0(e){this.options=N0.assign({level:bde,method:Cde,chunkSize:16384,windowBits:15,memLevel:8,strategy:Sde},e||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new J3,this.strm.avail_out=0;let n=eg.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(n!==O0)throw new Error(Kd[n]);if(t.header&&eg.deflateSetHeader(this.strm,t.header),t.dictionary){let i;if(i=typeof t.dictionary=="string"?ng.string2buf(t.dictionary):$3.call(t.dictionary)==="[object ArrayBuffer]"?new Uint8Array(t.dictionary):t.dictionary,n=eg.deflateSetDictionary(this.strm,i),n!==O0)throw new Error(Kd[n]);this._dict_set=!0}}function Z3(e,t){const n=new x0(t);if(n.push(e,!0),n.err)throw n.msg||Kd[n.err];return n.result}x0.prototype.push=function(e,t){const n=this.strm,i=this.options.chunkSize;let o,l;if(this.ended)return!1;for(l=t===~~t?t:t===!0?yde:_de,typeof e=="string"?n.input=ng.string2buf(e):$3.call(e)==="[object ArrayBuffer]"?n.input=new Uint8Array(e):n.input=e,n.next_in=0,n.avail_in=n.input.length;;)if(n.avail_out===0&&(n.output=new Uint8Array(i),n.next_out=0,n.avail_out=i),(l===Ede||l===vde)&&n.avail_out<=6)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else{if(o=eg.deflate(n,l),o===wde)return n.next_out>0&&this.onData(n.output.subarray(0,n.next_out)),o=eg.deflateEnd(this.strm),this.onEnd(o),this.ended=!0,o===O0;if(n.avail_out!==0){if(l>0&&n.next_out>0)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else if(n.avail_in===0)break}else this.onData(n.output)}return!0},x0.prototype.onData=function(e){this.chunks.push(e)},x0.prototype.onEnd=function(e){e===O0&&(this.result=N0.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var Tde={deflate:Z3,deflateRaw:function(e,t){return(t=t||{}).raw=!0,Z3(e,t)}};const D0=16209;var Rde=function(e,t){let n,i,o,l,d,h,f,g,_,v,y,b,D,I,O,U,j,G,$,Z,X,ee,le,fe;const Ie=e.state;n=e.next_in,le=e.input,i=n+(e.avail_in-5),o=e.next_out,fe=e.output,l=o-(t-e.avail_out),d=o+(e.avail_out-257),h=Ie.dmax,f=Ie.wsize,g=Ie.whave,_=Ie.wnext,v=Ie.window,y=Ie.hold,b=Ie.bits,D=Ie.lencode,I=Ie.distcode,O=(1<<Ie.lenbits)-1,U=(1<<Ie.distbits)-1;e:do{b<15&&(y+=le[n++]<<b,b+=8,y+=le[n++]<<b,b+=8),j=D[y&O];t:for(;;){if(G=j>>>24,y>>>=G,b-=G,G=j>>>16&255,G===0)fe[o++]=65535&j;else{if(!(16&G)){if(!(64&G)){j=D[(65535&j)+(y&(1<<G)-1)];continue t}if(32&G){Ie.mode=16191;break e}e.msg="invalid literal/length code",Ie.mode=D0;break e}$=65535&j,G&=15,G&&(b<G&&(y+=le[n++]<<b,b+=8),$+=y&(1<<G)-1,y>>>=G,b-=G),b<15&&(y+=le[n++]<<b,b+=8,y+=le[n++]<<b,b+=8),j=I[y&U];n:for(;;){if(G=j>>>24,y>>>=G,b-=G,G=j>>>16&255,!(16&G)){if(!(64&G)){j=I[(65535&j)+(y&(1<<G)-1)];continue n}e.msg="invalid distance code",Ie.mode=D0;break e}if(Z=65535&j,G&=15,b<G&&(y+=le[n++]<<b,b+=8,b<G&&(y+=le[n++]<<b,b+=8)),Z+=y&(1<<G)-1,Z>h){e.msg="invalid distance too far back",Ie.mode=D0;break e}if(y>>>=G,b-=G,G=o-l,Z>G){if(G=Z-G,G>g&&Ie.sane){e.msg="invalid distance too far back",Ie.mode=D0;break e}if(X=0,ee=v,_===0){if(X+=f-G,G<$){$-=G;do fe[o++]=v[X++];while(--G);X=o-Z,ee=fe}}else if(_<G){if(X+=f+_-G,G-=_,G<$){$-=G;do fe[o++]=v[X++];while(--G);if(X=0,_<$){G=_,$-=G;do fe[o++]=v[X++];while(--G);X=o-Z,ee=fe}}}else if(X+=_-G,G<$){$-=G;do fe[o++]=v[X++];while(--G);X=o-Z,ee=fe}for(;$>2;)fe[o++]=ee[X++],fe[o++]=ee[X++],fe[o++]=ee[X++],$-=3;$&&(fe[o++]=ee[X++],$>1&&(fe[o++]=ee[X++]))}else{X=o-Z;do fe[o++]=fe[X++],fe[o++]=fe[X++],fe[o++]=fe[X++],$-=3;while($>2);$&&(fe[o++]=fe[X++],$>1&&(fe[o++]=fe[X++]))}break}}break}}while(n<i&&o<d);$=b>>3,n-=$,b-=$<<3,y&=(1<<b)-1,e.next_in=n,e.next_out=o,e.avail_in=n<i?i-n+5:5-(n-i),e.avail_out=o<d?d-o+257:257-(o-d),Ie.hold=y,Ie.bits=b};const B0=15,Ide=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),Nde=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),Ode=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),xde=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var rg=(e,t,n,i,o,l,d,h)=>{const f=h.bits;let g,_,v,y,b,D,I=0,O=0,U=0,j=0,G=0,$=0,Z=0,X=0,ee=0,le=0,fe=null;const Ie=new Uint16Array(16),et=new Uint16Array(16);let Je,pt,ct,jt=null;for(I=0;I<=B0;I++)Ie[I]=0;for(O=0;O<i;O++)Ie[t[n+O]]++;for(G=f,j=B0;j>=1&&Ie[j]===0;j--);if(G>j&&(G=j),j===0)return o[l++]=20971520,o[l++]=20971520,h.bits=1,0;for(U=1;U<j&&Ie[U]===0;U++);for(G<U&&(G=U),X=1,I=1;I<=B0;I++)if(X<<=1,X-=Ie[I],X<0)return-1;if(X>0&&(e===0||j!==1))return-1;for(et[1]=0,I=1;I<B0;I++)et[I+1]=et[I]+Ie[I];for(O=0;O<i;O++)t[n+O]!==0&&(d[et[t[n+O]]++]=O);if(e===0?(fe=jt=d,D=20):e===1?(fe=Ide,jt=Nde,D=257):(fe=Ode,jt=xde,D=0),le=0,O=0,I=U,b=l,$=G,Z=0,v=-1,ee=1<<G,y=ee-1,e===1&&ee>852||e===2&&ee>592)return 1;for(;;){Je=I-Z,d[O]+1<D?(pt=0,ct=d[O]):d[O]>=D?(pt=jt[d[O]-D],ct=fe[d[O]-D]):(pt=96,ct=0),g=1<<I-Z,_=1<<$,U=_;do _-=g,o[b+(le>>Z)+_]=Je<<24|pt<<16|ct|0;while(_!==0);for(g=1<<I-1;le&g;)g>>=1;if(g!==0?(le&=g-1,le+=g):le=0,O++,--Ie[I]==0){if(I===j)break;I=t[n+d[O]]}if(I>G&&(le&y)!==v){for(Z===0&&(Z=G),b+=U,$=I-Z,X=1<<$;$+Z<j&&(X-=Ie[$+Z],!(X<=0));)$++,X<<=1;if(ee+=1<<$,e===1&&ee>852||e===2&&ee>592)return 1;v=le&y,o[v]=G<<24|$<<16|b-l|0}}return le!==0&&(o[b+le]=I-Z<<24|64<<16|0),h.bits=G,0};const{Z_FINISH:eH,Z_BLOCK:Dde,Z_TREES:k0,Z_OK:qd,Z_STREAM_END:Bde,Z_NEED_DICT:kde,Z_STREAM_ERROR:ao,Z_DATA_ERROR:tH,Z_MEM_ERROR:nH,Z_BUF_ERROR:Lde,Z_DEFLATED:rH}=T0,L0=16180,U0=16190,Zc=16191,YI=16192,zI=16194,P0=16199,M0=16200,qI=16206,Fr=16209,sH=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function Ude(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const Xd=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.mode<L0||t.mode>16211?1:0},iH=e=>{if(Xd(e))return ao;const t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=L0,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(852),t.distcode=t.distdyn=new Int32Array(592),t.sane=1,t.back=-1,qd},aH=e=>{if(Xd(e))return ao;const t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,iH(e)},oH=(e,t)=>{let n;if(Xd(e))return ao;const i=e.state;return t<0?(n=0,t=-t):(n=5+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?ao:(i.window!==null&&i.wbits!==t&&(i.window=null),i.wrap=n,i.wbits=t,aH(e))},cH=(e,t)=>{if(!e)return ao;const n=new Ude;e.state=n,n.strm=e,n.window=null,n.mode=L0;const i=oH(e,t);return i!==qd&&(e.state=null),i};let XI,JI,lH=!0;const Pde=e=>{if(lH){XI=new Int32Array(512),JI=new Int32Array(32);let t=0;for(;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(rg(1,e.lens,0,288,XI,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;rg(2,e.lens,0,32,JI,0,e.work,{bits:5}),lH=!1}e.lencode=XI,e.lenbits=9,e.distcode=JI,e.distbits=5},AH=(e,t,n,i)=>{let o;const l=e.state;return l.window===null&&(l.wsize=1<<l.wbits,l.wnext=0,l.whave=0,l.window=new Uint8Array(l.wsize)),i>=l.wsize?(l.window.set(t.subarray(n-l.wsize,n),0),l.wnext=0,l.whave=l.wsize):(o=l.wsize-l.wnext,o>i&&(o=i),l.window.set(t.subarray(n-i,n-i+o),l.wnext),(i-=o)?(l.window.set(t.subarray(n-i,n),0),l.wnext=i,l.whave=l.wsize):(l.wnext+=o,l.wnext===l.wsize&&(l.wnext=0),l.whave<l.wsize&&(l.whave+=o))),0};var Mde=(e,t)=>{let n,i,o,l,d,h,f,g,_,v,y,b,D,I,O,U,j,G,$,Z,X,ee,le=0;const fe=new Uint8Array(4);let Ie,et;const Je=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(Xd(e)||!e.output||!e.input&&e.avail_in!==0)return ao;n=e.state,n.mode===Zc&&(n.mode=YI),d=e.next_out,o=e.output,f=e.avail_out,l=e.next_in,i=e.input,h=e.avail_in,g=n.hold,_=n.bits,v=h,y=f,ee=qd;e:for(;;)switch(n.mode){case L0:if(n.wrap===0){n.mode=YI;break}for(;_<16;){if(h===0)break e;h--,g+=i[l++]<<_,_+=8}if(2&n.wrap&&g===35615){n.wbits===0&&(n.wbits=15),n.check=0,fe[0]=255&g,fe[1]=g>>>8&255,n.check=Vs(n.check,fe,2,0),g=0,_=0,n.mode=16181;break}if(n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&g)<<8)+(g>>8))%31){e.msg="incorrect header check",n.mode=Fr;break}if((15&g)!==rH){e.msg="unknown compression method",n.mode=Fr;break}if(g>>>=4,_-=4,X=8+(15&g),n.wbits===0&&(n.wbits=X),X>15||X>n.wbits){e.msg="invalid window size",n.mode=Fr;break}n.dmax=1<<n.wbits,n.flags=0,e.adler=n.check=1,n.mode=512&g?16189:Zc,g=0,_=0;break;case 16181:for(;_<16;){if(h===0)break e;h--,g+=i[l++]<<_,_+=8}if(n.flags=g,(255&Is(n))!==rH){e.msg="unknown compression method",n.mode=Fr;break}if(57344&Is(n)){e.msg="unknown header flags set",n.mode=Fr;break}n.head&&(n.head.text=g>>8&1),512&Is(n)&&4&n.wrap&&(fe[0]=255&g,fe[1]=g>>>8&255,n.check=Vs(n.check,fe,2,0)),g=0,_=0,n.mode=16182;case 16182:for(;_<32;){if(h===0)break e;h--,g+=i[l++]<<_,_+=8}n.head&&(n.head.time=g),512&Is(n)&&4&n.wrap&&(fe[0]=255&g,fe[1]=g>>>8&255,fe[2]=g>>>16&255,fe[3]=g>>>24&255,n.check=Vs(n.check,fe,4,0)),g=0,_=0,n.mode=16183;case 16183:for(;_<16;){if(h===0)break e;h--,g+=i[l++]<<_,_+=8}n.head&&(n.head.xflags=255&g,n.head.os=g>>8),512&Is(n)&&4&n.wrap&&(fe[0]=255&g,fe[1]=g>>>8&255,n.check=Vs(n.check,fe,2,0)),g=0,_=0,n.mode=16184;case 16184:if(1024&Is(n)){for(;_<16;){if(h===0)break e;h--,g+=i[l++]<<_,_+=8}n.length=g,n.head&&(n.head.extra_len=g),512&Is(n)&&4&n.wrap&&(fe[0]=255&g,fe[1]=g>>>8&255,n.check=Vs(n.check,fe,2,0)),g=0,_=0}else n.head&&(n.head.extra=null);n.mode=16185;case 16185:if(1024&Is(n)&&(b=n.length,b>h&&(b=h),b&&(n.head&&(X=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Uint8Array(n.head.extra_len)),n.head.extra.set(i.subarray(l,l+b),X)),512&Is(n)&&4&n.wrap&&(n.check=Vs(n.check,i,b,l)),h-=b,l+=b,n.length-=b),n.length))break e;n.length=0,n.mode=16186;case 16186:if(2048&Is(n)){if(h===0)break e;b=0;do X=i[l+b++],n.head&&X&&n.length<65536&&(n.head.name+=String.fromCharCode(X));while(X&&b<h);if(512&Is(n)&&4&n.wrap&&(n.check=Vs(n.check,i,b,l)),h-=b,l+=b,X)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=16187;case 16187:if(4096&Is(n)){if(h===0)break e;b=0;do X=i[l+b++],n.head&&X&&n.length<65536&&(n.head.comment+=String.fromCharCode(X));while(X&&b<h);if(512&Is(n)&&4&n.wrap&&(n.check=Vs(n.check,i,b,l)),h-=b,l+=b,X)break e}else n.head&&(n.head.comment=null);n.mode=16188;case 16188:if(512&Is(n)){for(;_<16;){if(h===0)break e;h--,g+=i[l++]<<_,_+=8}if(4&n.wrap&&g!==(65535&n.check)){e.msg="header crc mismatch",n.mode=Fr;break}g=0,_=0}n.head&&(n.head.hcrc=Is(n)>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=Zc;break;case 16189:for(;_<32;){if(h===0)break e;h--,g+=i[l++]<<_,_+=8}e.adler=n.check=sH(g),g=0,_=0,n.mode=U0;case U0:if(n.havedict===0)return e.next_out=d,e.avail_out=f,e.next_in=l,e.avail_in=h,n.hold=g,n.bits=_,kde;e.adler=n.check=1,n.mode=Zc;case Zc:if(t===Dde||t===k0)break e;case YI:if(n.last){g>>>=7&_,_-=7&_,n.mode=qI;break}for(;_<3;){if(h===0)break e;h--,g+=i[l++]<<_,_+=8}switch(n.last=1&g,g>>>=1,_-=1,3&g){case 0:n.mode=16193;break;case 1:if(Pde(n),n.mode=P0,t===k0){g>>>=2,_-=2;break e}break;case 2:n.mode=16196;break;case 3:e.msg="invalid block type",n.mode=Fr}g>>>=2,_-=2;break;case 16193:for(g>>>=7&_,_-=7&_;_<32;){if(h===0)break e;h--,g+=i[l++]<<_,_+=8}if((65535&g)!=(g>>>16^65535)){e.msg="invalid stored block lengths",n.mode=Fr;break}if(n.length=65535&g,g=0,_=0,n.mode=zI,t===k0)break e;case zI:n.mode=16195;case 16195:if(b=n.length,b){if(b>h&&(b=h),b>f&&(b=f),b===0)break e;o.set(i.subarray(l,l+b),d),h-=b,l+=b,f-=b,d+=b,n.length-=b;break}n.mode=Zc;break;case 16196:for(;_<14;){if(h===0)break e;h--,g+=i[l++]<<_,_+=8}if(n.nlen=257+(31&g),g>>>=5,_-=5,n.ndist=1+(31&g),g>>>=5,_-=5,n.ncode=4+(15&g),g>>>=4,_-=4,n.nlen>286||n.ndist>30){e.msg="too many length or distance symbols",n.mode=Fr;break}n.have=0,n.mode=16197;case 16197:for(;n.have<n.ncode;){for(;_<3;){if(h===0)break e;h--,g+=i[l++]<<_,_+=8}n.lens[Je[n.have++]]=7&g,g>>>=3,_-=3}for(;n.have<19;)n.lens[Je[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,Ie={bits:n.lenbits},ee=rg(0,n.lens,0,19,n.lencode,0,n.work,Ie),n.lenbits=Ie.bits,ee){e.msg="invalid code lengths set",n.mode=Fr;break}n.have=0,n.mode=16198;case 16198:for(;n.have<n.nlen+n.ndist;){for(;le=n.lencode[g&(1<<n.lenbits)-1],O=le>>>24,U=le>>>16&255,j=65535&le,!(O<=_);){if(h===0)break e;h--,g+=i[l++]<<_,_+=8}if(j<16)g>>>=O,_-=O,n.lens[n.have++]=j;else{if(j===16){for(et=O+2;_<et;){if(h===0)break e;h--,g+=i[l++]<<_,_+=8}if(g>>>=O,_-=O,n.have===0){e.msg="invalid bit length repeat",n.mode=Fr;break}X=n.lens[n.have-1],b=3+(3&g),g>>>=2,_-=2}else if(j===17){for(et=O+3;_<et;){if(h===0)break e;h--,g+=i[l++]<<_,_+=8}g>>>=O,_-=O,X=0,b=3+(7&g),g>>>=3,_-=3}else{for(et=O+7;_<et;){if(h===0)break e;h--,g+=i[l++]<<_,_+=8}g>>>=O,_-=O,X=0,b=11+(127&g),g>>>=7,_-=7}if(n.have+b>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=Fr;break}for(;b--;)n.lens[n.have++]=X}}if(n.mode===Fr)break;if(n.lens[256]===0){e.msg="invalid code -- missing end-of-block",n.mode=Fr;break}if(n.lenbits=9,Ie={bits:n.lenbits},ee=rg(1,n.lens,0,n.nlen,n.lencode,0,n.work,Ie),n.lenbits=Ie.bits,ee){e.msg="invalid literal/lengths set",n.mode=Fr;break}if(n.distbits=6,n.distcode=n.distdyn,Ie={bits:n.distbits},ee=rg(2,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,Ie),n.distbits=Ie.bits,ee){e.msg="invalid distances set",n.mode=Fr;break}if(n.mode=P0,t===k0)break e;case P0:n.mode=M0;case M0:if(h>=6&&f>=258){e.next_out=d,e.avail_out=f,e.next_in=l,e.avail_in=h,n.hold=g,n.bits=_,Rde(e,y),d=e.next_out,o=e.output,f=e.avail_out,l=e.next_in,i=e.input,h=e.avail_in,g=n.hold,_=n.bits,n.mode===Zc&&(n.back=-1);break}for(n.back=0;le=n.lencode[g&(1<<n.lenbits)-1],O=le>>>24,U=le>>>16&255,j=65535&le,!(O<=_);){if(h===0)break e;h--,g+=i[l++]<<_,_+=8}if(U&&!(240&U)){for(G=O,$=U,Z=j;le=n.lencode[Z+((g&(1<<G+$)-1)>>G)],O=le>>>24,U=le>>>16&255,j=65535&le,!(G+O<=_);){if(h===0)break e;h--,g+=i[l++]<<_,_+=8}g>>>=G,_-=G,n.back+=G}if(g>>>=O,_-=O,n.back+=O,n.length=j,U===0){n.mode=16205;break}if(32&U){n.back=-1,n.mode=Zc;break}if(64&U){e.msg="invalid literal/length code",n.mode=Fr;break}n.extra=15&U,n.mode=16201;case 16201:if(n.extra){for(et=n.extra;_<et;){if(h===0)break e;h--,g+=i[l++]<<_,_+=8}n.length+=g&(1<<n.extra)-1,g>>>=n.extra,_-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=16202;case 16202:for(;le=n.distcode[g&(1<<n.distbits)-1],O=le>>>24,U=le>>>16&255,j=65535&le,!(O<=_);){if(h===0)break e;h--,g+=i[l++]<<_,_+=8}if(!(240&U)){for(G=O,$=U,Z=j;le=n.distcode[Z+((g&(1<<G+$)-1)>>G)],O=le>>>24,U=le>>>16&255,j=65535&le,!(G+O<=_);){if(h===0)break e;h--,g+=i[l++]<<_,_+=8}g>>>=G,_-=G,n.back+=G}if(g>>>=O,_-=O,n.back+=O,64&U){e.msg="invalid distance code",n.mode=Fr;break}n.offset=j,n.extra=15&U,n.mode=16203;case 16203:if(n.extra){for(et=n.extra;_<et;){if(h===0)break e;h--,g+=i[l++]<<_,_+=8}n.offset+=g&(1<<n.extra)-1,g>>>=n.extra,_-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=Fr;break}n.mode=16204;case 16204:if(f===0)break e;if(b=y-f,n.offset>b){if(b=n.offset-b,b>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=Fr;break}b>n.wnext?(b-=n.wnext,D=n.wsize-b):D=n.wnext-b,b>n.length&&(b=n.length),I=n.window}else I=o,D=d-n.offset,b=n.length;b>f&&(b=f),f-=b,n.length-=b;do o[d++]=I[D++];while(--b);n.length===0&&(n.mode=M0);break;case 16205:if(f===0)break e;o[d++]=n.length,f--,n.mode=M0;break;case qI:if(n.wrap){for(;_<32;){if(h===0)break e;h--,g|=i[l++]<<_,_+=8}if(y-=f,e.total_out+=y,n.total+=y,4&n.wrap&&y&&(e.adler=n.check=Is(n)?Vs(n.check,o,y,d-y):qm(n.check,o,y,d-y)),y=f,4&n.wrap&&(Is(n)?g:sH(g))!==n.check){e.msg="incorrect data check",n.mode=Fr;break}g=0,_=0}n.mode=16207;case 16207:if(n.wrap&&Is(n)){for(;_<32;){if(h===0)break e;h--,g+=i[l++]<<_,_+=8}if(4&n.wrap&&g!==(4294967295&n.total)){e.msg="incorrect length check",n.mode=Fr;break}g=0,_=0}n.mode=16208;case 16208:ee=Bde;break e;case Fr:ee=tH;break e;case 16210:return nH;default:return ao}return e.next_out=d,e.avail_out=f,e.next_in=l,e.avail_in=h,n.hold=g,n.bits=_,(n.wsize||y!==e.avail_out&&n.mode<Fr&&(n.mode<qI||t!==eH))&&AH(e,e.output,e.next_out,y-e.avail_out),v-=e.avail_in,y-=e.avail_out,e.total_in+=v,e.total_out+=y,n.total+=y,4&n.wrap&&y&&(e.adler=n.check=Is(n)?Vs(n.check,o,y,e.next_out-y):qm(n.check,o,y,e.next_out-y)),e.data_type=n.bits+(n.last?64:0)+(n.mode===Zc?128:0)+(n.mode===P0||n.mode===zI?256:0),(v===0&&y===0||t===eH)&&ee===qd&&(ee=Lde),ee},el={inflateReset:aH,inflateReset2:oH,inflateResetKeep:iH,inflateInit:e=>cH(e,15),inflateInit2:cH,inflate:Mde,inflateEnd:e=>{if(Xd(e))return ao;let t=e.state;return t.window&&(t.window=null),e.state=null,qd},inflateGetHeader:(e,t)=>{if(Xd(e))return ao;const n=e.state;return 2&n.wrap?(n.head=t,t.done=!1,qd):ao},inflateSetDictionary:(e,t)=>{const n=t.length;let i,o,l;return Xd(e)?ao:(i=e.state,i.wrap!==0&&i.mode!==U0?ao:i.mode===U0&&(o=1,o=qm(o,t,n,0),o!==i.check)?tH:(l=AH(e,t,n,n),l?(i.mode=16210,nH):(i.havedict=1,qd)))},inflateInfo:"pako inflate (from Nodeca project)"},Fde=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const dH=Object.prototype.toString,{Z_NO_FLUSH:jde,Z_FINISH:Vde,Z_OK:sg,Z_STREAM_END:$I,Z_NEED_DICT:ZI,Z_STREAM_ERROR:Qde,Z_DATA_ERROR:uH,Z_MEM_ERROR:Hde}=T0;function F0(e){this.options=N0.assign({chunkSize:65536,windowBits:15,to:""},e||{});const t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,t.windowBits===0&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&!(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new J3,this.strm.avail_out=0;let n=el.inflateInit2(this.strm,t.windowBits);if(n!==sg)throw new Error(Kd[n]);if(this.header=new Fde,el.inflateGetHeader(this.strm,this.header),t.dictionary&&(typeof t.dictionary=="string"?t.dictionary=ng.string2buf(t.dictionary):dH.call(t.dictionary)==="[object ArrayBuffer]"&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(n=el.inflateSetDictionary(this.strm,t.dictionary),n!==sg)))throw new Error(Kd[n])}function hH(e,t){const n=new F0(t);if(n.push(e),n.err)throw n.msg||Kd[n.err];return n.result}F0.prototype.push=function(e,t){const n=this.strm,i=this.options.chunkSize,o=this.options.dictionary;let l,d,h;if(this.ended)return!1;for(d=t===~~t?t:t===!0?Vde:jde,dH.call(e)==="[object ArrayBuffer]"?n.input=new Uint8Array(e):n.input=e,n.next_in=0,n.avail_in=n.input.length;;){for(n.avail_out===0&&(n.output=new Uint8Array(i),n.next_out=0,n.avail_out=i),l=el.inflate(n,d),l===ZI&&o&&(l=el.inflateSetDictionary(n,o),l===sg?l=el.inflate(n,d):l===uH&&(l=ZI));n.avail_in>0&&l===$I&&n.state.wrap>0&&e[n.next_in]!==0;)el.inflateReset(n),l=el.inflate(n,d);switch(l){case Qde:case uH:case ZI:case Hde:return this.onEnd(l),this.ended=!0,!1}if(h=n.avail_out,n.next_out&&(n.avail_out===0||l===$I))if(this.options.to==="string"){let f=ng.utf8border(n.output,n.next_out),g=n.next_out-f,_=ng.buf2string(n.output,f);n.next_out=g,n.avail_out=i-g,g&&n.output.set(n.output.subarray(f,f+g),0),this.onData(_)}else this.onData(n.output.length===n.next_out?n.output:n.output.subarray(0,n.next_out));if(l!==sg||h!==0){if(l===$I)return l=el.inflateEnd(this.strm),this.onEnd(l),this.ended=!0,!0;if(n.avail_in===0)break}}return!0},F0.prototype.onData=function(e){this.chunks.push(e)},F0.prototype.onEnd=function(e){e===sg&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=N0.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var Gde={inflate:hH,inflateRaw:function(e,t){return(t=t||{}).raw=!0,hH(e,t)}};const{deflate:Kde,deflateRaw:Wde}=Tde,{inflate:Yde,inflateRaw:zde}=Gde;var qde=Kde,Xde=Wde,Jde=Yde,$de=zde,pH=function(e){return e[e.ONE_BYTE=0]="ONE_BYTE",e[e.TWO_BYTE=1]="TWO_BYTE",e}(pH||{});class Zde{constructor(){x(this,"_sequence",0),x(this,"_startTime",Date.now()),x(this,"isUseOneByte",!0)}get startTime(){const t=Date.now()-this._startTime;return t<Math.pow(2,16)?t:(this._startTime+=Math.pow(2,16),this.startTime)}get sequence(){return this._sequence<Math.pow(2,32)?this._sequence++:(this._sequence-=Math.pow(2,32),this.sequence)}serialize(t){const n={commonPacketHeader:{length:0,reserved:0,extension:0,sequence:this.sequence},commonStreamHeader:this.startTime,extension:void 0,payload:t};if(t.byteLength>128){const h=new Uint8Array(4);h.set([1,0,0,0]);const f={id:0,length:4,data:h.buffer},g={profile:this.isUseOneByte?0:1,length:this.isUseOneByte?5:6,datas:[f]};n.commonPacketHeader.extension=1,n.extension=g,n.payload=this.compress(t),n.commonPacketHeader.length=8+(n.extension.length+2)+n.payload.byteLength}else n.commonPacketHeader.length=8+n.payload.byteLength;L("SHOW_DATASTREAM2_LOG")&&S.debug("send data header: ".concat(JSON.stringify(n.commonPacketHeader)));const i=new ArrayBuffer(n.commonPacketHeader.length),o=new Uint8Array(i),l=new DataView(i);let d=0;if(l.setUint16(d,n.commonPacketHeader.extension<<15|n.commonPacketHeader.reserved<<14|n.commonPacketHeader.length,!0),d+=2,l.setUint32(d,n.commonPacketHeader.sequence,!0),d+=4,l.setUint16(d,n.commonStreamHeader,!0),d+=2,n.extension){const h=this.serializeExtension(n.extension);o.set(new Uint8Array(h),d),d+=h.byteLength}if(o.set(new Uint8Array(n.payload),d),d+=n.payload.byteLength,d!==n.commonPacketHeader.length)throw Error("serialize error!");return i}deserialize(t){if(t.byteLength<4)return new ArrayBuffer(0);const n=new DataView(t);let i=0;const o=n.getUint16(i,!0);i+=2;const l={length:16383&o,reserved:(16384&o)>>14,extension:(32768&o)>>15,sequence:n.getUint16(i+2,!0)<<16|n.getUint16(i,!0)};let d,h;if(i+=4,L("SHOW_DATASTREAM2_LOG")&&S.debug("receive data header: ".concat(JSON.stringify(l))),n.getUint16(i,!0),i+=2,l.extension){h=this.deserializeExtension(t.slice(i)),i+=2+h.length,d=t.slice(i);let f=!1;if(h.datas.length>0){const g=h.datas.find(_=>_.id===0);g&&(f=(1&new DataView(g.data).getUint32(0,!0))==1)}d=f?this.decompress(d):d}else d=t.slice(8);return d}serializeExtension(t){const{profile:n,length:i,datas:o}=t,l=new ArrayBuffer(i+2),d=new Uint8Array(l),h=new DataView(l);let f=0;if(h.setUint8(f++,n),h.setUint8(f++,i),o.forEach(g=>{n?(h.setUint8(f++,g.id),h.setUint8(f++,g.length),d.set(new Uint8Array(g.data),f),f+=g.data.byteLength):(h.setUint8(f++,g.id|g.length<<4),d.set(new Uint8Array(g.data),f),f+=g.data.byteLength)}),f!==i+2)throw Error("serialize extension error, is ".concat(f,"!==").concat(i+2));return l}deserializeExtension(t){const n=new DataView(t);let i=0;const o=n.getUint8(i);i++;const l=n.getUint8(i);i++;const d=o===pH.TWO_BYTE,h=[],f=new DataView(t,2);let g=0;for(;g<l;){let _=0,v=0,y=new ArrayBuffer(0);d?(_=f.getUint8(g),g++,v=f.getUint8(g),g++):(_=15&f.getUint8(g),v=f.getUint8(g)>>4,g++),v>0&&(y=f.buffer.slice(g+2,g+2+v),g+=y.byteLength),h.push({id:_,length:v,data:y})}if(g!==l)throw Error("parse error");return{profile:o,length:l,datas:h}}decompress(t){return Jde(new Uint8Array(t))}compress(t){return qde(new Uint8Array(t))}}const eue={name:"DataStream",create:(e,t)=>{const n=t?new sle(e):new ile(e);return n.useDataStream(new Zde),n}};class tue extends Tn{constructor(t,n,i){super(),x(this,"ws",void 0),x(this,"requestId",1),x(this,"heartBeatTimer",void 0),x(this,"joinInfo",void 0),x(this,"clientId",void 0),x(this,"onOpen",()=>{this.emit("open"),this.startHeartBeatCheck()}),x(this,"onClose",o=>{this.emit("close"),this.dispose()}),x(this,"onMessage",o=>{const l=JSON.parse(o.data);if(!l||l.command!=="serverResponse"||!l.requestId)return l&&l.command==="serverStatus"&&l.serverStatus&&l.serverStatus.command?(this.emit("status",l.serverStatus),void this.emit(l.serverStatus.command,l.serverStatus)):void 0;this.emit("req_".concat(l.requestId),l)}),this.joinInfo=t,this.clientId=n,this.ws=new Im("cross-channel-".concat(this.clientId),i),this.ws.on(lt.RECONNECTING,()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")}),this.ws.on(lt.CONNECTED,this.onOpen),this.ws.on(lt.ON_MESSAGE,this.onMessage),this.ws.on(lt.CLOSED,this.onClose)}isConnect(){return this.ws.state==="connected"}sendMessage(t){const n=this.requestId++;return t.requestId=n,t.seq=n,this.ws.sendMessage(t),n}waitStatus(t){return new be((n,i)=>{const o=window.setTimeout(()=>{i(new se(P.TIMEOUT,"wait status timeout, status: ".concat(t)))},5e3);this.once(t,l=>{window.clearTimeout(o),l.state&&l.state!==0?i(new se(P.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(t))):n(void 0)}),this.once("dispose",()=>{window.clearTimeout(o),i(new se(P.WS_ABORT))})})}async request(t){if(this.ws.state==="closed")throw new se(P.WS_DISCONNECT);const n=()=>new be((d,h)=>{this.ws.once(lt.CLOSED,()=>h(new se(P.WS_ABORT))),this.ws.once(lt.CONNECTED,d)});this.ws.state!=="connected"&&await n();const i=this.sendMessage(t),o=new be((d,h)=>{const f=()=>{h(new se(P.WS_ABORT))};this.ws.once(lt.RECONNECTING,f),this.ws.once(lt.CLOSED,f),this.once("req_".concat(i),d),Sr(3e3).then(()=>{this.removeAllListeners("req_".concat(i)),this.ws.off(lt.RECONNECTING,f),this.ws.off(lt.CLOSED,f),h(new se(P.TIMEOUT,"cross channel ws request timeout"))})}),l=await o;if(!l||l.code!==200)throw new se(P.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(JSON.stringify(l)));return l}async connect(t){this.ws.removeAllListeners(lt.REQUEST_NEW_URLS),this.ws.on(lt.REQUEST_NEW_URLS,n=>{n(t)}),await this.ws.init(t)}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(t){const n=this.requestId++;return t.requestId=n,this.ws.sendMessage(t),n}startHeartBeatCheck(){this.heartBeatTimer&&window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=window.setInterval(()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})},3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}}class nue extends Tn{set state(t){t!==this._state&&(t!==hi.RELAY_STATE_FAILURE&&(this.errorCode=Hh.RELAY_OK),this.emit("state",t,this.errorCode),this._state=t)}get state(){return this._state}constructor(t,n,i,o,l){super(),x(this,"joinInfo",void 0),x(this,"sid",void 0),x(this,"clientId",void 0),x(this,"cancelToken",Xs.CancelToken.source()),x(this,"workerToken",void 0),x(this,"requestId",0),x(this,"signal",void 0),x(this,"prevChannelMediaConfig",void 0),x(this,"httpRetryConfig",void 0),x(this,"_resolution",void 0),x(this,"_state",hi.RELAY_STATE_IDLE),x(this,"errorCode",Hh.RELAY_OK),x(this,"onStatus",d=>{S.debug("[".concat(this.clientId,"] ChannelMediaStatus: ").concat(JSON.stringify(d))),d&&d.command&&(d.command==="onAudioPacketReceived"&&this.emit("event",qc.PACKET_RECEIVED_AUDIO_FROM_SRC),d.command==="onVideoPacketReceived"&&this.emit("event",qc.PACKET_RECEIVED_VIDEO_FROM_SRC),d.command==="onSrcTokenPrivilegeDidExpire"&&(this.errorCode=Hh.SRC_TOKEN_EXPIRED,this.state=hi.RELAY_STATE_FAILURE),d.command==="onDestTokenPrivilegeDidExpire"&&(this.errorCode=Hh.DEST_TOKEN_EXPIRED,this.state=hi.RELAY_STATE_FAILURE))}),x(this,"onReconnect",async()=>{S.debug("[".concat(this.clientId,"] ChannelMediaSocket disconnect, reconnecting")),this.emit("event",qc.NETWORK_DISCONNECTED),this.state=hi.RELAY_STATE_IDLE,this.prevChannelMediaConfig&&this.sendStartRelayMessage(this.prevChannelMediaConfig).catch(d=>{this.state!==hi.RELAY_STATE_IDLE&&(S.error("auto restart channel media relay failed",d.toString()),this.errorCode=Hh.SERVER_CONNECTION_LOST,this.state=hi.RELAY_STATE_FAILURE)})}),this.joinInfo=t,this.clientId=n,this.sid=Td(),this.signal=new tue(this.joinInfo,this.clientId,i),this.httpRetryConfig=o,this._resolution=l}async startChannelMediaRelay(t){if(this.state!==hi.RELAY_STATE_IDLE)throw new se(P.INVALID_OPERATION);this.state=hi.RELAY_STATE_CONNECTING,await this.connect(),S.debug("[".concat(this.clientId,"] startChannelMediaRelay: connect success"));try{await this.sendStartRelayMessage(t)}catch(n){throw n.data&&n.data.serverResponse&&n.data.serverResponse.command==="SetSourceChannel"?new se(P.CROSS_CHANNEL_FAILED_JOIN_SRC):n.data&&n.data.serverResponse&&n.serverResponse.command==="SetDestChannelStatus"?new se(P.CROSS_CHANNEL_FAILED_JOIN_DEST):n.data&&n.data.serverResponse&&n.serverResponse.command==="StartPacketTransfer"?new se(P.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST):n}this.prevChannelMediaConfig=t}async updateChannelMediaRelay(t){if(this.state!==hi.RELAY_STATE_RUNNING)throw new se(P.INVALID_OPERATION);await this.sendUpdateMessage(t),this.prevChannelMediaConfig=t}async setVideoProfile(t){if(this._resolution=t,this.state!==hi.RELAY_STATE_RUNNING)throw new se(P.INVALID_OPERATION);const n=this.genMessage(Zs.SetVideoProfile);await this.signal.request(n),S.debug("[".concat(this.clientId,"] startChannelMediaRelay: setVideoProfile success"))}async stopChannelMediaRelay(){await this.sendStopRelayMessage(),S.debug("[".concat(this.clientId,"] stopChannelMediaRelay: send stop message success")),this.state=hi.RELAY_STATE_IDLE,this.dispose()}dispose(){S.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=Xs.CancelToken.source(),this.state=hi.RELAY_STATE_IDLE,this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}async connect(){const t=await lAe(this.joinInfo,this.cancelToken.token,this.httpRetryConfig);this.workerToken=t.workerToken,await this.signal.connect(t.addressList),this.emit("event",qc.NETWORK_CONNECTED),this.signal.on("status",this.onStatus),this.signal.on("reconnecting",this.onReconnect)}async sendStartRelayMessage(t){const n=this.genMessage(Zs.SetSdkProfile,t);await this.signal.request(n),S.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSdkProfile success"));const i=this.genMessage(Zs.SetSourceChannel,t);await this.signal.request(i),await this.signal.waitStatus("SetSourceChannelStatus"),this.emit("event",qc.PACKET_JOINED_SRC_CHANNEL),S.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceChannel success"));const o=this.genMessage(Zs.SetSourceUserId,t);await this.signal.request(o),S.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceUserId success"));const l=this.genMessage(Zs.SetDestChannel,t);await this.signal.request(l),await this.signal.waitStatus("SetDestChannelStatus"),this.emit("event",qc.PACKET_JOINED_DEST_CHANNEL),S.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetDestChannel success"));const d=this.genMessage(Zs.StartPacketTransfer,t);await this.signal.request(d),this.emit("event",qc.PACKET_SENT_TO_DEST_CHANNEL),this.state=hi.RELAY_STATE_RUNNING,S.debug("[".concat(this.clientId,"] startChannelMediaRelay: StartPacketTransfer success")),this.setVideoProfile(this._resolution)}async sendUpdateMessage(t){const n=this.genMessage(Zs.UpdateDestChannel,t);await this.signal.request(n),this.emit("event",qc.PACKET_UPDATE_DEST_CHANNEL),S.debug("[".concat(this.clientId,"] sendUpdateMessage: UpdateDestChannel success"))}async sendStopRelayMessage(){const t=this.genMessage(Zs.StopPacketTransfer);await this.signal.request(t),S.debug("[".concat(this.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))}genMessage(t,n){const i=[],o=[],l=[];this.requestId+=1;const d={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:Aa,sid:this.sid,ts:Date.now(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};d.sdkVersion==="4.24.1"&&(d.sdkVersion="0.0.1");let h=null,f=null;switch(t){case Zs.SetSdkProfile:return d.clientRequest={command:"SetSdkProfile",type:"multi_channel"},d;case Zs.SetSourceChannel:if(f=n&&n.getSrcChannelMediaInfo(),!f)throw new se(P.UNEXPECTED_ERROR,"can not find source config");return d.clientRequest={command:"SetSourceChannel",uid:"0",channelName:f.channelName,token:f.token||this.joinInfo.appId},d;case Zs.SetSourceUserId:if(f=n&&n.getSrcChannelMediaInfo(),!f)throw new se(P.UNEXPECTED_ERROR,"can not find source config");return d.clientRequest={command:"SetSourceUserId",uid:f.uid+""},d;case Zs.SetDestChannel:if(h=n&&n.getDestChannelMediaInfo(),!h)throw new se(P.UNEXPECTED_ERROR,"can not find dest config");return h.forEach(g=>{i.push(g.channelName),o.push(g.uid+""),l.push(g.token||this.joinInfo.appId)}),d.clientRequest={command:"SetDestChannel",channelName:i,uid:o,token:l},d;case Zs.StartPacketTransfer:return d.clientRequest={command:"StartPacketTransfer"},d;case Zs.Reconnect:return d.clientRequest={command:"Reconnect"},d;case Zs.StopPacketTransfer:return d.clientRequest={command:"StopPacketTransfer"},d;case Zs.UpdateDestChannel:if(h=n&&n.getDestChannelMediaInfo(),!h)throw new se(P.UNEXPECTED_ERROR,"can not find dest config");return h.forEach(g=>{i.push(g.channelName),o.push(g.uid+""),l.push(g.token||this.joinInfo.appId)}),d.clientRequest={command:"UpdateDestChannel",channelName:i,uid:o,token:l},d;case Zs.SetVideoProfile:d.clientRequest={command:"SetVideoProfile",width:this._resolution.width,height:this._resolution.height}}return d}}const rue={name:"ChannelMediaRelay",create:function(e){return new nue(e.joinInfo,e.clientId,e.websocketRetryConfig||qn,e.httpRetryConfig||qn,e.resolution)}};function fH(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}function ig(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?fH(Object(n),!0).forEach(function(i){x(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):fH(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}class sue extends Tn{constructor(t,n,i,o){super(),x(this,"spec",void 0),x(this,"token",void 0),x(this,"websocket",void 0),x(this,"pingpongTimer",void 0),x(this,"reconnectMode","retry"),x(this,"serviceMode",void 0),x(this,"reqId",0),x(this,"commandReqId",0),x(this,"handleWebSocketOpen",()=>{this.reconnectMode="retry",this.startPingPong()}),x(this,"handleWebSocketMessage",l=>{if(!l.data)return;const d=JSON.parse(l.data);d.requestId?this.emit("@".concat(d.requestId,"-").concat(d.sid),d):(ke.workerEvent(this.spec.sid,{actionType:"status",serverCode:d.code,workerType:this.serviceMode===zc.TRANSCODE?1:2}),this.emit(Yl.PUBLISH_STREAM_STATUS,d))}),this.spec=n,this.token=t,this.serviceMode=o,this.websocket=new Im("live-streaming",i),this.websocket.on(lt.CONNECTED,this.handleWebSocketOpen),this.websocket.on(lt.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(lt.REQUEST_NEW_URLS,(l,d)=>{ir(this,Yl.REQUEST_NEW_ADDRESS).then(l).catch(d)}),this.websocket.on(lt.RECONNECTING,()=>{this.websocket.reconnectMode=this.reconnectMode})}init(t){return this.websocket.init(t)}async request(t,n,i,o){this.reqId+=1,t==="request"&&(this.commandReqId+=1);const l=this.commandReqId,d=this.reqId;if(!d||!this.websocket)throw new se(P.UNEXPECTED_ERROR);const h=ig({command:t,sdkVersion:Aa==="4.24.1"?"0.0.1":Aa,seq:d,requestId:d,allocate:i,cname:this.spec.cname,appId:this.spec.appId,sid:this.spec.sid,uid:this.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},n);if(this.websocket.state==="closed")throw new se(P.WS_DISCONNECT);const f=()=>new be((y,b)=>{this.websocket.once(lt.CLOSED,()=>b(new se(P.WS_ABORT))),this.websocket.once(lt.CONNECTED,y)});this.websocket.state!=="connected"&&await f(),h.clientRequest&&(h.clientRequest.workerToken=this.token);const g=new be((y,b)=>{const D=()=>{b(new se(P.WS_ABORT))};this.websocket.once(lt.RECONNECTING,D),this.websocket.once(lt.CLOSED,D),this.once("@".concat(d,"-").concat(this.spec.sid),I=>{y(I)})});o&&ke.workerEvent(this.spec.sid,ig(ig({},o),{},{requestId:l,actionType:"request",payload:JSON.stringify(n.clientRequest),serverCode:0,code:0}));const _=Date.now();this.websocket.sendMessage(h);let v=null;try{v=await g}catch(y){if(this.websocket.state==="closed")throw y;return await f(),await this.request(t,n,i)}return o&&ke.workerEvent(this.spec.sid,ig(ig({},o),{},{requestId:l,actionType:"response",payload:JSON.stringify(v.serverResponse),serverCode:v.code,success:v.code===200,responseTime:Date.now()-_})),v.code!==200&&this.handleResponseError(v),v}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){const t=Aa==="4.24.1"?"0.0.1":Aa;this.reqId+=1,this.websocket.state==="connected"?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:t,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(t){switch(t.code){case ur.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void S.warning("live stream response already exists stream");case ur.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case ur.LIVE_STREAM_RESPONSE_BAD_STREAM:case ur.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new se(P.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:t.code}).throw();case ur.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if(t.serverResponse.command==="UnpublishStream")return;throw new se(P.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case ur.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new se(P.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:t.code}).throw();case ur.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const n=new se(P.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit(Yl.WARNING,n,t.serverResponse.url)}case ur.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:{const n=new se(P.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit(Yl.WARNING,n,t.serverResponse.url)}case ur.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new se(P.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case ur.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new se(P.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:t.code}).throw();case ur.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:{const n=new se(P.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit(Yl.WARNING,n,t.serverResponse.url)}case ur.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new se(P.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:t.code}).throw();case ur.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new se(P.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case ur.LIVE_STREAM_RESPONSE_WORKER_LOST:case ur.LIVE_STREAM_RESPONSE_WORKER_QUIT:if(t.serverResponse.command==="UnpublishStream")return;throw new se(P.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case ur.ERROR_FAIL_SEND_MESSAGE:if(t.serverResponse.command==="UnpublishStream")return;if(t.serverResponse.command==="UpdateTranscoding"||t.serverResponse.command==="ControlStream")return new se(P.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:t.code}).throw();throw new se(P.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case ur.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case ur.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case ur.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case ur.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new se(P.LIVE_STREAMING_CDN_ERROR,"",{code:t.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(()=>{this.websocket.state==="connected"&&this.request("ping",{}).catch(vm)},6e3)}}function mH(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}function fi(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?mH(Object(n),!0).forEach(function(i){x(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):mH(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}class iue extends Tn{constructor(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:qn,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:qn;super(),x(this,"onLiveStreamWarning",void 0),x(this,"onLiveStreamError",void 0),x(this,"spec",void 0),x(this,"retryTimeout",1e4),x(this,"connection",void 0),x(this,"httpRetryConfig",void 0),x(this,"wsRetryConfig",void 0),x(this,"streamingTasks",new Map),x(this,"isStartingStreamingTask",!1),x(this,"taskMutex",new Lr("live-streaming")),x(this,"cancelToken",Xs.CancelToken.source()),x(this,"transcodingConfig",void 0),x(this,"uapResponse",void 0),x(this,"lastTaskId",1),x(this,"statusError",new Map),this.spec=t,this.httpRetryConfig=i,this.wsRetryConfig=n}async setTranscodingConfig(t){const n=fi(fi({},Qle),t);n.videoCodecProfile!==66&&n.videoCodecProfile!==77&&n.videoCodecProfile!==100&&(S.debug("[".concat(this.spec.clientId,"] set transcoding config, fix video codec profile: ").concat(n.videoCodecProfile," -> 100")),n.videoCodecProfile=100),n.transcodingUsers||(n.transcodingUsers=n.userConfigs),n.transcodingUsers&&(n.transcodingUsers=n.transcodingUsers.map(d=>fi(fi(fi({},Vle),d),{},{zOrder:d.zOrder?d.zOrder+1:1}))),function(d){kn(d.width)||sn(d.width,"config.width",0,1e4),kn(d.height)||sn(d.height,"config.height",0,1e4),kn(d.videoBitrate)||sn(d.videoBitrate,"config.videoBitrate",1,1e6),kn(d.videoFrameRate)||sn(d.videoFrameRate,"config.videoFrameRate"),kn(d.lowLatency)||za(d.lowLatency,"config.lowLatency"),kn(d.audioSampleRate)||zn(d.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),kn(d.audioBitrate)||sn(d.audioBitrate,"config.audioBitrate",1,128),kn(d.audioChannels)||zn(d.audioChannels,"config.audioChannels",[1,2,3,4,5]),kn(d.videoGop)||sn(d.videoGop,"config.videoGop"),kn(d.videoCodecProfile)||zn(d.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),kn(d.userCount)||sn(d.userCount,"config.userCount",0,17),kn(d.backgroundColor)||sn(d.backgroundColor,"config.backgroundColor",0,16777215),kn(d.userConfigExtraInfo)||Kr(d.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),d.transcodingUsers&&!kn(d.transcodingUsers)&&(Wc(d.transcodingUsers,"config.transcodingUsers"),d.transcodingUsers.forEach((h,f)=>{qv(h.uid),kn(h.x)||sn(h.x,"transcodingUser[".concat(f,"].x"),0,1e4),kn(h.y)||sn(h.y,"transcodingUser[".concat(f,"].y"),0,1e4),kn(h.width)||sn(h.width,"transcodingUser[".concat(f,"].width"),0,1e4),kn(h.height)||sn(h.height,"transcodingUser[".concat(f,"].height"),0,1e4),kn(h.zOrder)||sn(h.zOrder-1,"transcodingUser[".concat(f,"].zOrder"),0,100),kn(h.alpha)||sn(h.alpha,"transcodingUser[".concat(f,"].alpha"),0,1,!1)})),kn(d.watermark)||HR(d.watermark,"watermark"),kn(d.backgroundImage)||HR(d.backgroundImage,"backgroundImage"),d.images&&!kn(d.images)&&(Wc(d.images,"config.images"),d.images.forEach((h,f)=>{HR(h,"images[".concat(f,"]"))}))}(n);const i=[];n.images&&i.push(...n.images.map(d=>fi(fi(fi({},QR),d),{},{zOrder:255}))),n.backgroundImage&&(i.push(fi(fi(fi({},QR),n.backgroundImage),{},{zOrder:0})),delete n.backgroundImage),n.watermark&&(i.push(fi(fi(fi({},QR),n.watermark),{},{zOrder:255})),delete n.watermark),n.images=i,n.transcodingUsers&&(n.userConfigs=n.transcodingUsers.map(d=>fi({},d)),n.userCount=n.transcodingUsers.length,delete n.transcodingUsers);const o=(n.userConfigs||[]).map(d=>typeof d.uid=="number"?be.resolve(d.uid):UV(d.uid,this.spec,this.cancelToken.token,this.httpRetryConfig));if((await be.all(o)).forEach((d,h)=>{n.userConfigs&&n.userConfigs[h]&&(n.userConfigs[h].uid=d)}),this.transcodingConfig=n,this.connection)try{var l;const d=await this.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:this.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(Ti(l=this.streamingTasks).call(l)).map(h=>h.taskId).join("#")});S.debug("[".concat(this.spec.clientId,"] update live transcoding config success, code: ").concat(d.code,", config:"),JSON.stringify(this.transcodingConfig))}catch(d){if(!d.data||!d.data.retry)throw d;d.data.changeAddress&&this.connection.tryNextAddress(),this.streamingTasks.forEach(h=>{S.warning("[".concat(this.spec.clientId,"] live streaming receive error"),d.toString(),"try to republish",h.url),this.startLiveStreamingTask(h.url,h.mode,d).then(()=>{S.debug("[".concat(this.spec.clientId,"] live streaming republish ").concat(h.url," success"))}).catch(f=>{S.error("[".concat(this.spec.clientId,"] live streaming republish failed"),h.url,f.toString()),this.onLiveStreamError&&this.onLiveStreamError(h.url,f)})})}}async startLiveStreamingTask(t,n,i){if(!this.transcodingConfig&&n===zc.TRANSCODE)throw new se(P.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");const o={command:"PublishStream",ts:Date.now(),url:t,uid:this.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0};S.debug("[".concat(this.spec.clientId,"] start live streaming ").concat(t,", mode: ").concat(n));const l=await this.taskMutex.lock();if(!this.connection&&i)return void l();if(this.streamingTasks.get(t)&&!i)return l(),new se(P.LIVE_STREAMING_TASK_CONFLICT).throw();try{this.connection||(this.connection=await this.connect(n))}catch(h){throw l(),h}switch(n){case zc.TRANSCODE:o.transcodingConfig=fi({},this.transcodingConfig)}this.uapResponse&&this.uapResponse.vid&&(o.vid=this.uapResponse.vid),this.isStartingStreamingTask=!0;const d=this.lastTaskId++;try{const h=new be((g,_)=>{Sr(this.retryTimeout).then(()=>{if(i)return _(i);const v=this.statusError.get(t);return v?(this.statusError.delete(t),_(v)):void 0})}),f=await be.race([this.connection.request("request",{clientRequest:o},!0,{url:t,command:"PublishStream",workerType:n===zc.TRANSCODE?1:2,requestByUser:!i,tid:d.toString()}),h]);this.isStartingStreamingTask=!1,S.debug("[".concat(this.spec.clientId,"] live streaming started, code: ").concat(f.code)),this.streamingTasks.set(t,{clientRequest:o,mode:n,url:t,taskId:d}),l()}catch(h){if(l(),this.isStartingStreamingTask=!1,!h.data||!h.data.retry||i)throw h;return h.data.changeAddress?(this.connection.tryNextAddress(),await this.startLiveStreamingTask(t,n,h)):await this.startLiveStreamingTask(t,n,h)}}stopLiveStreamingTask(t){return new be((n,i)=>{const o=this.streamingTasks.get(t);if(!o||!this.connection)return new se(P.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();const l=o.mode;o.abortTask=()=>{S.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(t),n()},this.connection.request("request",{clientRequest:{command:"UnpublishStream",url:o.url}},!1,{url:t,command:"UnPublishStream",workerType:l===zc.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then(d=>{S.debug("[".concat(this.spec.clientId,"] stop live streaming success, code: ").concat(d.code)),this.streamingTasks.delete(t),this.streamingTasks.size===0&&(this.connection&&this.connection.close(),this.connection=void 0),n()}).catch(i)})}resetAllTask(){var t;const n=Array.from(Ti(t=this.streamingTasks).call(t));this.terminate();for(const i of n)this.startLiveStreamingTask(i.url,i.mode).catch(o=>{this.onLiveStreamError&&this.onLiveStreamError(i.url,o)})}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=Xs.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}async connect(t){if(this.connection)throw new se(P.UNEXPECTED_ERROR,"live streaming connection has already connected");const n=await ir(this,GR.REQUEST_WORKER_MANAGER_LIST,t);return this.uapResponse=n,this.connection=new sue(n.workerToken,this.spec,this.wsRetryConfig,t),this.connection.on(Yl.WARNING,(i,o)=>this.onLiveStreamWarning&&this.onLiveStreamWarning(o,i)),this.connection.on(Yl.PUBLISH_STREAM_STATUS,i=>this.handlePublishStreamServer(i)),this.connection.on(Yl.REQUEST_NEW_ADDRESS,(i,o)=>{if(!this.connection)return o(new se(P.UNEXPECTED_ERROR,"can not get new live streaming address list"));ir(this,GR.REQUEST_WORKER_MANAGER_LIST,t).then(l=>{this.uapResponse=l,i(l.addressList)}).catch(o)}),await this.connection.init(n.addressList),this.connection}handlePublishStreamServer(t){const n=t.serverStatus&&t.serverStatus.url||"empty_url",i=this.streamingTasks.get(n),o=t.reason;switch(t.code){case ur.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case ur.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case ur.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case ur.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:{const d=new se(P.LIVE_STREAMING_CDN_ERROR,"",{code:t.code});if(i)return S.error(d.toString()),this.onLiveStreamError&&this.onLiveStreamError(n,d);if(!this.isStartingStreamingTask)return;this.statusError.set(n,d)}case ur.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const d=new se(P.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,o);return this.onLiveStreamWarning&&this.onLiveStreamWarning(n,d)}case ur.LIVE_STREAM_RESPONSE_WORKER_LOST:case ur.LIVE_STREAM_RESPONSE_WORKER_QUIT:{var l;if(!this.connection)return;this.connection.tryNextAddress();const d=Array.from(Ti(l=this.streamingTasks).call(l));for(const h of d)h.abortTask?h.abortTask():(S.warning("[".concat(this.spec.clientId,"] publish stream status code"),t.code,"try to republish",h.url),this.startLiveStreamingTask(h.url,h.mode,new se(P.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:t.code})).then(()=>{S.debug("[".concat(this.spec.clientId,"] republish live stream success"),h.url)}).catch(f=>{S.error(f.toString()),this.onLiveStreamError&&this.onLiveStreamError(h.url,f)}));return}}}hasUrl(t){return this.streamingTasks.has(t)}}const aue={name:"LiveStreaming",create:function(e){return new iue(e.joinInfo,e.websocketRetryConfig||qn,e.httpRetryConfig||qn)}};function oue(e){let t=EH();return function(n,i){let o=n.appId;o!==void 0&&(Jt(i,10),Tc(i,o));let l=n.cid;l!==void 0&&(Jt(i,16),Jt(i,l));let d=n.cname;d!==void 0&&(Jt(i,26),Tc(i,d));let h=n.deviceId;h!==void 0&&(Jt(i,34),Tc(i,h));let f=n.elapse;f!==void 0&&(Jt(i,40),aA(i,f));let g=n.fileSize;g!==void 0&&(Jt(i,48),aA(i,op(g)));let _=n.height;_!==void 0&&(Jt(i,56),aA(i,op(_)));let v=n.jpg;v!==void 0&&(Jt(i,66),Jt(i,v.length),function(bn,he){let ve=cp(bn,he.length);bn.bytes.set(he,ve)}(i,v));let y=n.networkType;y!==void 0&&(Jt(i,72),aA(i,op(y)));let b=n.osType;b!==void 0&&(Jt(i,80),aA(i,op(b)));let D=n.requestId;D!==void 0&&(Jt(i,90),Tc(i,D));let I=n.sdkVersion;I!==void 0&&(Jt(i,98),Tc(i,I));let O=n.sequence;O!==void 0&&(Jt(i,104),aA(i,op(O)));let U=n.sid;U!==void 0&&(Jt(i,114),Tc(i,U));let j=n.timestamp;j!==void 0&&(Jt(i,120),aA(i,j));let G=n.uid;G!==void 0&&(Jt(i,128),Jt(i,G));let $=n.vid;$!==void 0&&(Jt(i,136),Jt(i,$));let Z=n.width;Z!==void 0&&(Jt(i,144),aA(i,op(Z)));let X=n.service;X!==void 0&&(Jt(i,152),Jt(i,X));let ee=n.callbackData;ee!==void 0&&(Jt(i,162),Tc(i,ee));let le=n.jpgEncryption;le!==void 0&&(Jt(i,168),Jt(i,le));let fe=n.requestType;fe!==void 0&&(Jt(i,176),Jt(i,fe));let Ie=n.scorePorn;Ie!==void 0&&(Jt(i,185),sN(i,Ie));let et=n.scoreSexy;et!==void 0&&(Jt(i,193),sN(i,et));let Je=n.scoreNeutral;Je!==void 0&&(Jt(i,201),sN(i,Je));let pt=n.scene;pt!==void 0&&(Jt(i,208),Jt(i,pt));let ct=n.ossFilePrefix;ct!==void 0&&(Jt(i,218),Tc(i,ct));let jt=n.serviceVendor;if(jt!==void 0)for(let bn of jt){Jt(i,226);let he=EH();Aue(bn,he),Jt(i,he.limit),pue(i,he),hue(he)}}(e,t),function(n){let i=n.bytes,o=n.limit;return i.length===o?i:i.subarray(0,o)}(t)}function cue(e){return function(n){let i={};e:for(;!vH(n);){let o=Rc(n);switch(o>>>3){case 0:break e;case 1:i.code=Rc(n);break;case 2:i.msg=yH(n,Rc(n));break;case 3:{let l=due(n);i.data=lue(n),n.limit=l;break}default:gH(n,7&o)}}return i}({bytes:t=e,offset:0,limit:t.length});var t}function lue(e){let t={};e:for(;!vH(e);){let n=Rc(e);switch(n>>>3){case 0:break e;case 1:t.requestId=yH(e,Rc(e));break;case 2:t.requestType=Rc(e)>>>0;break;case 3:t.scorePorn=rN(e);break;case 4:t.scoreSexy=rN(e);break;case 5:t.scoreNeutral=rN(e);break;case 6:t.requestScene=Rc(e)>>>0;break;case 7:t.scene=Rc(e)>>>0;break;default:gH(e,7&n)}}return t}function Aue(e,t){let n=e.service;n!==void 0&&(Jt(t,8),Jt(t,n));let i=e.vendor;i!==void 0&&(Jt(t,16),Jt(t,i));let o=e.token;o!==void 0&&(Jt(t,26),Tc(t,o));let l=e.callbackUrl;l!==void 0&&(Jt(t,34),Tc(t,l))}function due(e){let t=Rc(e),n=e.limit;return e.limit=e.offset+t,n}function gH(e,t){switch(t){case 0:for(;128&wH(e););break;case 2:tN(e,Rc(e));break;case 5:tN(e,4);break;case 1:tN(e,8);break;default:throw new Error("Unimplemented type: "+t)}}let uue=new Float32Array(1);new Uint8Array(uue.buffer);let eN=new Float64Array(1),mi=new Uint8Array(eN.buffer);function op(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let _H=[];function EH(){const e=_H.pop();return e?(e.offset=e.limit=0,e):{bytes:new Uint8Array(64),offset:0,limit:0}}function hue(e){_H.push(e)}function tN(e,t){if(e.offset+t>e.limit)throw new Error("Skip past limit");e.offset+=t}function vH(e){return e.offset>=e.limit}function cp(e,t){let n=e.bytes,i=e.offset,o=e.limit,l=i+t;if(l>n.length){let d=new Uint8Array(2*l);d.set(n),e.bytes=d}return e.offset=l,l>o&&(e.limit=l),i}function nN(e,t){let n=e.offset;if(n+t>e.limit)throw new Error("Read past limit");return e.offset+=t,n}function yH(e,t){let n=nN(e,t),i=String.fromCharCode,o=e.bytes,l="",d="";for(let h=0;h<t;h++){let f,g,_,v,y=o[h+n];128&y?(224&y)==192?h+1>=t?d+=l:(f=o[h+n+1],(192&f)!=128?d+=l:(v=(31&y)<<6|63&f,v<128?d+=l:(d+=i(v),h++))):(240&y)==224?h+2>=t?d+=l:(f=o[h+n+1],g=o[h+n+2],(49344&(f|g<<8))!=32896?d+=l:(v=(15&y)<<12|(63&f)<<6|63&g,v<2048||v>=55296&&v<=57343?d+=l:(d+=i(v),h+=2))):(248&y)==240?h+3>=t?d+=l:(f=o[h+n+1],g=o[h+n+2],_=o[h+n+3],(12632256&(f|g<<8|_<<16))!=8421504?d+=l:(v=(7&y)<<18|(63&f)<<12|(63&g)<<6|63&_,v<65536||v>1114111?d+=l:(v-=65536,d+=i(55296+(v>>10),56320+(1023&v)),h+=3))):d+=l:d+=i(y)}return d}function Tc(e,t){let n=t.length,i=0;for(let d=0;d<n;d++){let h=t.charCodeAt(d);h>=55296&&h<=56319&&d+1<n&&(h=(h<<10)+t.charCodeAt(++d)-56613888),i+=h<128?1:h<2048?2:h<65536?3:4}Jt(e,i);let o=cp(e,i),l=e.bytes;for(let d=0;d<n;d++){let h=t.charCodeAt(d);h>=55296&&h<=56319&&d+1<n&&(h=(h<<10)+t.charCodeAt(++d)-56613888),h<128?l[o++]=h:(h<2048?l[o++]=h>>6&31|192:(h<65536?l[o++]=h>>12&15|224:(l[o++]=h>>18&7|240,l[o++]=h>>12&63|128),l[o++]=h>>6&63|128),l[o++]=63&h|128)}}function pue(e,t){let n=cp(e,t.limit),i=e.bytes,o=t.bytes;for(let l=0,d=t.limit;l<d;l++)i[l+n]=o[l]}function wH(e){return e.bytes[nN(e,1)]}function bH(e,t){let n=cp(e,1);e.bytes[n]=t}function rN(e){let t=nN(e,8),n=e.bytes;return mi[0]=n[t++],mi[1]=n[t++],mi[2]=n[t++],mi[3]=n[t++],mi[4]=n[t++],mi[5]=n[t++],mi[6]=n[t++],mi[7]=n[t++],eN[0]}function sN(e,t){let n=cp(e,8),i=e.bytes;eN[0]=t,i[n++]=mi[0],i[n++]=mi[1],i[n++]=mi[2],i[n++]=mi[3],i[n++]=mi[4],i[n++]=mi[5],i[n++]=mi[6],i[n++]=mi[7]}function Rc(e){let t,n=0,i=0;do t=wH(e),n<32&&(i|=(127&t)<<n),n+=7;while(128&t);return i}function Jt(e,t){for(t>>>=0;t>=128;)bH(e,127&t|128),t>>>=7;bH(e,t)}function aA(e,t){let n=t.low>>>0,i=(t.low>>>28|t.high<<4)>>>0,o=t.high>>>24,l=o===0?i===0?n<16384?n<128?1:2:n<1<<21?3:4:i<16384?i<128?5:6:i<1<<21?7:8:o<128?9:10,d=cp(e,l),h=e.bytes;switch(l){case 10:h[d+9]=o>>>7&1;case 9:h[d+8]=l!==9?128|o:127&o;case 8:h[d+7]=l!==8?i>>>21|128:i>>>21&127;case 7:h[d+6]=l!==7?i>>>14|128:i>>>14&127;case 6:h[d+5]=l!==6?i>>>7|128:i>>>7&127;case 5:h[d+4]=l!==5?128|i:127&i;case 4:h[d+3]=l!==4?n>>>21|128:n>>>21&127;case 3:h[d+2]=l!==3?n>>>14|128:n>>>14&127;case 2:h[d+1]=l!==2?n>>>7|128:n>>>7&127;case 1:h[d]=l!==1?128|n:127&n}}function SH(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}const fue=new Map([["moderation",1],["supervise",2]]);class mue extends Tn{get connectionState(){return this._connectionState}set connectionState(t){if(this._connectionState===t)return;const n=this._connectionState;this._connectionState=t,this.emit(Pr.CONNECTION_STATE_CHANGE,n,t)}get inspectType(){return this._inspectType}set inspectType(t){var n;this._inspectMode=ca(n=t.map(i=>fue.get(i)||0)).call(n,(i,o)=>i+o),this._inspectType=t}get quality(){return this._quality}set quality(t){this._quality=t>1?1:t<.1?.1:t,this.qualityTimer&&(window.clearTimeout(this.qualityTimer),this.qualityTimer=null),this._quality>=1||(this.qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this.qualityRatio},6e4))}constructor(t){super(),x(this,"name","AgoraRTCVideoContentInspect"),x(this,"_connectionState",Za.CONNECTING),x(this,"_innerConnectionState",void 0),x(this,"sequence",0),x(this,"inspectStartTime",void 0),x(this,"workerManagerConnection",void 0),x(this,"workerConnection",void 0),x(this,"workerMessageLengthLimit",void 0),x(this,"inspectIntervalMinimum",void 0),x(this,"qualityRatio",void 0),x(this,"_connectInfo",void 0),x(this,"_cancelTokenSource",Xs.CancelToken.source()),x(this,"_retryConfig",void 0),x(this,"wmSequence",0),x(this,"inspectInterval",void 0),x(this,"inspectTimer",null),x(this,"ossFilePrefix",void 0),x(this,"extraInfo",void 0),x(this,"_inspectType",void 0),x(this,"_inspectMode",void 0),x(this,"_quality",1),x(this,"qualityTimer",null),x(this,"_inspectId",void 0),x(this,"_needWorkUrlOnly",!1),x(this,"inspectImage",()=>{if(this.connectionState!==Za.CONNECTED)throw new se(P.OPERATION_ABORTED,"content inspect service connection status is ".concat(this.connectionState));this.inspectTimer&&(window.clearInterval(this.inspectTimer),this.inspectTimer=null),this.inspectTimer=window.setInterval(()=>{this.connectionState===Za.CONNECTED?this.requestToInspectImage():S.debug("[".concat(this._inspectId,"] Inspect State is not connected , "),this.connectionState)},this.inspectInterval<this.inspectIntervalMinimum?this.inspectIntervalMinimum:this.inspectInterval),this.requestToInspectImage()}),this._inspectId=zt(5,"inspect-"),this.workerMessageLengthLimit=L("VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT"),this.inspectIntervalMinimum=L("VIDEO_INSPECT_INTERVAL_MINIMUM"),this.qualityRatio=L("VIDEO_INSPECT_QUALITY_RATIO"),this.inspectInterval=t.interval,this.ossFilePrefix=t.ossFilePrefix,this.extraInfo=t.extraInfo,this.inspectType=t.inspectType,this.inspectStartTime=Number(Date.now()),this.workerManagerConnection=new Im("worker-manager-"+this._inspectId,qn),this.on(Pr.STATE_CHANGE,(n,i)=>{this._innerConnectionState=n,S.debug("[".concat(this._inspectId,"] Inspect operation :").concat(eo[n]," ").concat(i||""))}),this.handleWorkerManagerEvents(),this.workerConnection=new Im("worker-"+this._inspectId,qn),this.handleWorkerEvents()}async init(t,n){this.emit(Pr.STATE_CHANGE,eo.CONNECT_AP),this._connectInfo=t;const i=this._cancelTokenSource.token;return this._retryConfig=n,new be((o,l)=>{this.on(Pr.CONNECTION_STATE_CHANGE,(d,h)=>{h===Za.CONNECTED&&o()}),this.requestAP(t,i,n).then(d=>{this.connectWorkerManager(d)}).catch(d=>{l(d)})})}async requestAP(t,n,i){const o=L("WEBCS_DOMAIN").map(h=>"https://".concat(h,"/api/v1")),l=await function(h,f,g,_){let{appId:v,areaCode:y,cname:b,sid:D,token:I,uid:O}=f;qh++;const U="image_moderation_api",j={service_name:U,json_body:JSON.stringify({appId:v,areaCode:y,cname:b,command:"allocateEdge",requestId:qh,seq:qh,sid:D,token:I,ts:Date.now(),uid:O+""})};let G,$,Z=h[0];return Do(async()=>{G=Date.now();const X=await Mo(Z,{data:j,cancelToken:g,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if($=Date.now()-G,X.code!==0){const Je=new se(P.UNEXPECTED_RESPONSE,"image inspect ap error, code"+X.code,{retry:!0,responseTime:$});throw S.error(Je.toString()),Je}const ee=JSON.parse(X.json_body);if(ee.code!==200){const Je=new se(P.UNEXPECTED_RESPONSE,"image inspect ap error, code: ".concat(ee.code,", reason: ").concat(ee.reason),{code:ee.code,responseTime:$});throw S.error(Je.toString()),Je}if(!ee.servers||!Array.isArray(ee.servers)||ee.servers.length===0){const Je=new se(P.UNEXPECTED_RESPONSE,"image inspect ap empty server",{code:ee.code,responseTime:$});throw S.error(Je.toString()),Je}const le=L("VIDEO_INSPECT_WORKER_MANAGER_WSS");if(le)return{addressList:[le],workerToken:ee.workerToken,vid:ee.vid,responseTime:$};const fe=L("VIDEO_INSPECT_WORKER_MANAGER_HOST"),Ie=L("VIDEO_INSPECT_WORKER_MANAGER_PORT");return{addressList:ee.servers.map(Je=>{let{address:pt,wss:ct}=Je;if(pt&&ct)return"wss://".concat(pt.replace(/\./g,"-"),".").concat(fe,":").concat(Ie||ct)}).filter(Je=>!!Je),workerToken:ee.workerToken,vid:ee.vid,responseTime:$}},(X,ee)=>(ke.apworkerEvent(D,{success:!0,sc:200,serviceName:U,responseDetail:JSON.stringify(X.addressList),firstSuccess:ee===0,responseTime:$,serverIp:h[ee%h.length]}),!1),(X,ee)=>(ke.apworkerEvent(D,{success:!1,sc:X.data&&X.data.code||200,serviceName:U,responseTime:$,serverIp:h[ee%h.length]}),!!(X.code!==P.OPERATION_ABORTED&&X.code!==P.UNEXPECTED_RESPONSE||X.data&&X.data.retry)&&(Z=h[(ee+1)%h.length],!0)),_)}(o,t,n,i);this.emit(Pr.STATE_CHANGE,eo.AP_CONNECTED);const{addressList:d}=l;return this.wmSequence++,d}async connectWorkerManager(t){let n=arguments.length>1&&arguments[1]!==void 0&&arguments[1];this._needWorkUrlOnly=n,this.emit(Pr.STATE_CHANGE,eo.CONNECT_WORKER_MANAGER),await this.workerManagerConnection.init(t,1e4)}async connectWorker(t){await this.workerConnection.init([t])}handleWorkerManagerEvents(){this.workerManagerConnection.on(lt.CONNECTED,async()=>{this.emit(Pr.STATE_CHANGE,eo.WORKER_MANAGER_CONNECTED,this.workerManagerConnection.url),this.workerManagerConnection.sendMessage({appId:this._connectInfo.appId,cname:this._connectInfo.cname,uid:this._connectInfo.uid+"",sdkVersion:"4.24.1",sid:this._connectInfo.sid,seq:this.wmSequence,ts:Number(Date.now()),requestId:Math.floor(1e12*Math.random()),allocate:!0,clientRequest:{command:"join"}},!0)}),this.workerManagerConnection.on(lt.CLOSED,()=>{this._innerConnectionState<eo.GET_WORKER_MANAGER_RESPONSE&&S.debug("[".concat(this._inspectId,"] Inspect worker manager is closed before connecting worker"))}),this.workerManagerConnection.on(lt.FAILED,()=>{this._innerConnectionState<eo.GET_WORKER_MANAGER_RESPONSE&&S.debug("[".concat(this._inspectId,"] Connecting inspect worker manager is failed before connecting worker"))}),this.workerManagerConnection.on(lt.RECONNECTING,()=>{this._innerConnectionState<eo.GET_WORKER_MANAGER_RESPONSE&&S.debug("[".concat(this._inspectId,"] Inspect worker manager is reconnecting before connecting worker"))}),this.workerManagerConnection.on(lt.ON_MESSAGE,async t=>{this.emit(Pr.STATE_CHANGE,eo.GET_WORKER_MANAGER_RESPONSE);const n=this.workerManagerConnection.url;this.workerManagerConnection.close();const i=JSON.parse(t.data);if(i.code!==200)throw S.error("[".concat(this._inspectId,"] Unexpected code ").concat(i.code," from worker manager")),new se(P.UNEXPECTED_RESPONSE,"response code of worker is unexpected",i);if(!(i.serverResponse&&i.serverResponse.portWss&&n))throw S.error("[".concat(this._inspectId,"] Unexpected content from worker manager : ").concat(JSON.stringify(i))),new se(P.UNEXPECTED_RESPONSE,"response content of worker is unexpected",i);{const o=L("VIDEO_INSPECT_WORKER_PORT")||i.serverResponse.portWss,l=n.replace(/:\d+\/?$/,":".concat(o));this.emit(Pr.STATE_CHANGE,eo.CONNECT_WORKER,l),this._needWorkUrlOnly?this.emit(Pr.REQUEST_NEW_WORKER_URL,l):await this.connectWorker(l)}}),this.workerManagerConnection.on(lt.WILL_RECONNECT,(t,n,i)=>{i(t)}),this.workerManagerConnection.on(lt.REQUEST_NEW_URLS,(t,n)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(t).catch(n)})}handleWorkerEvents(){this.workerConnection.on(lt.CONNECTED,async()=>{this.emit(Pr.STATE_CHANGE,eo.WORKER_CONNECTED,this.workerConnection.url),this.connectionState=Za.CONNECTED}),this.workerConnection.on(lt.ON_MESSAGE,async t=>{if(t.data instanceof ArrayBuffer){const i=cue(new Uint8Array(t.data));if(L("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&S.debug("[".concat(this._inspectId,"] Response message for worker of inspect content "),JSON.stringify(i)),i.code===200){if(Array.isArray(this.inspectType)&&this.inspectType.length===1&&this.inspectType[0]==="supervise")return void this.emit(Pr.INSPECT_RESULT,void 0,void 0);if(i.data&&i.data.scorePorn&&i.data.scoreSexy&&i.data.scoreNeutral){var n;const o={porn:i.data.scorePorn,sexy:i.data.scoreSexy,neutral:i.data.scoreNeutral},l=ca(n=Object.keys(o)).call(n,(h,f)=>o[h]>o[f]?h:f,"porn"),d=Object.keys(o).find(h=>h===l);this.emit(Pr.INSPECT_RESULT,d)}else this.emit(Pr.INSPECT_RESULT,void 0,new se(P.UNEXPECTED_RESPONSE,i.code+"","There is an unexpected data on message"))}else this.emit(Pr.INSPECT_RESULT,void 0,new se(P.UNEXPECTED_RESPONSE,i.code+"",i.msg))}else S.error("[".concat(this._inspectId,"] Unexpected message type from worker")),this.emit(Pr.INSPECT_RESULT,void 0,new se(P.UNEXPECTED_RESPONSE,"invalid worker message type"))}),this.workerConnection.on(lt.CLOSED,()=>{this.connectionState=Za.CLOSED}),this.workerConnection.on(lt.FAILED,()=>{this.connectionState=Za.CLOSED}),this.workerConnection.on(lt.RECONNECTING,()=>{this.connectionState=this.connectionState===Za.CONNECTED?Za.RECONNECTING:Za.CONNECTING}),this.workerConnection.on(lt.WILL_RECONNECT,(t,n,i)=>{t==="recover"&&i(t),i("tryNext")}),this.workerConnection.on(lt.REQUEST_NEW_URLS,(t,n)=>{this.workerManagerConnection.close(),this.once(Pr.REQUEST_NEW_WORKER_URL,i=>{t([i])}),this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(i=>{this.connectWorkerManager(i,!0)}).catch(i=>{n(i)})})}async requestToInspectImage(){this.sequence++;const t=Ni(this,Pr.CLIENT_LOCAL_VIDEO_TRACK),n={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(t){if(!t.isPlaying)return void this.emit(Pr.INSPECT_RESULT,void 0,new se(P.INVALID_OPERATION,"Only the track being played can be inspected"));const i=await this.generateRequestData(t,n);this.workerConnection.sendMessage(i,!0,!0)}else this.emit(Pr.INSPECT_RESULT,void 0,new se(P.INVALID_OPERATION,"Only the track being published can be inspected"))}async generateRequestData(t,n){let{appId:i,cname:o,cid:l,vid:d,sid:h,uid:f}=n;const g=Date.now(),_=await t.getCurrentFrameImage("image/jpeg",this.quality),v=await ZF(_,i,o),y=this.sequence+"-"+l+"-"+f+"-"+g+"-"+zt(12,""),b={appId:i,cid:l,cname:o,deviceId:"",elapse:(D=Number(g-this.inspectStartTime),{low:D|=0,high:D>>31,unsigned:D>=0}),fileSize:v.byteLength,jpgEncryption:2,height:_.height,width:_.width,jpg:v,networkType:6,osType:7,requestId:y,sdkVersion:"4.24.1",sequence:this.sequence,sid:h,timestamp:IQ(g),uid:f,vid:d,service:this._inspectMode,callbackData:this.extraInfo,ossFilePrefix:this.ossFilePrefix};var D;this.extraInfo===void 0&&delete b.callbackData,this.ossFilePrefix===void 0&&delete b.ossFilePrefix;const I=oue(b);if(I.byteLength<this.workerMessageLengthLimit){if(L("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")){const O=function(U){for(var j=1;j<arguments.length;j++){var G=arguments[j]!=null?arguments[j]:{};j%2?SH(Object(G),!0).forEach(function($){x(U,$,G[$])}):Object.getOwnPropertyDescriptors?Object.defineProperties(U,Object.getOwnPropertyDescriptors(G)):SH(Object(G)).forEach(function($){Object.defineProperty(U,$,Object.getOwnPropertyDescriptor(G,$))})}return U}({},b);delete O.jpg,S.debug("[".concat(this._inspectId,"] Request message for worker of inspect content "),JSON.stringify(O))}return I}{const O=this.quality*this.qualityRatio;return this.quality=O,await this.generateRequestData(t,{appId:i,cname:o,cid:l,vid:d,sid:h,uid:f})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=Xs.CancelToken.source(),this.workerManagerConnection&&this.workerManagerConnection.close(),this.workerConnection&&this.workerConnection.close(),this.inspectTimer&&window.clearInterval(this.inspectTimer),this.inspectTimer=null,this.connectionState=Za.CLOSED,this.emit(Pr.STATE_CHANGE,eo.CLOSED)}}const gue={name:"ContentInspect",create:function(e){let{config:t}=e;return function(n){if(!n)throw new se(P.INVALID_PARAMS,"inspectConfig is necessary.");if(!n.inspectType||!Array.isArray(n.inspectType))throw new se(P.INVALID_PARAMS,"inspectConfig.inspectType is necessary and is an instance of Array.");{const i=[...new Set(n.inspectType)];i.forEach(o=>{var l;if(!me(l=["supervise","moderation"]).call(l,o))throw new se(P.INVALID_PARAMS,"".concat(o," is not a valid inspect type."))}),n.inspectType=i}if(n&&n.extraInfo&&n.extraInfo.length>1024)throw new se(P.INVALID_PARAMS,"inspectConfig.extraInfo length cannot exceed 1024 bytes")}(t),new mue(t)}};var CH=A(Ot.Object.getOwnPropertySymbols),_ue=Yt,Eue=$b.indexOf,vue=q_,iN=Ae([].indexOf),TH=!!iN&&1/iN([1],1,-0)<0;_ue({target:"Array",proto:!0,forced:TH||!vue("indexOf")},{indexOf:function(e){var t=arguments.length>1?arguments[1]:void 0;return TH?iN(this,e,t)||0:Eue(this,e,t)}});var yue=oa("Array","indexOf"),wue=B,bue=yue,aN=Array.prototype,Sue=function(e){var t=e.indexOf;return e===aN||wue(aN,e)&&t===aN.indexOf?bue:t},RH=A(Sue);function Cue(e,t){if(e==null)return{};var n,i,o=function(d,h){if(d==null)return{};var f={};for(var g in d)if({}.hasOwnProperty.call(d,g)){if(RH(h).call(h,g)!==-1)continue;f[g]=d[g]}return f}(e,t);if(CH){var l=CH(e);for(i=0;i<l.length;i++)n=l[i],RH(t).call(t,n)===-1&&{}.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}let IH=class{get localCapabilities(){return _n(this._localCapabilities)}get rtpCapabilities(){return _n(this._rtpCapabilities)}get candidates(){return _n(this._candidates)}get iceParameters(){return _n(this._iceParameters)}get dtlsParameters(){return _n(this._dtlsParameters)}constructor(e){x(this,"sessionDesc",void 0),x(this,"_localCapabilities",void 0),x(this,"_rtpCapabilities",void 0),x(this,"_candidates",void 0),x(this,"_iceParameters",void 0),x(this,"_dtlsParameters",void 0),x(this,"setup",void 0),x(this,"currentMidIndex",void 0),x(this,"cname","o/i14u9pJrxRKAsu"),x(this,"firefoxSsrcMidMap",new Map),e=_n(e);const{remoteIceParameters:t,remoteDtlsParameters:n,candidates:i,remoteRTPCapabilities:o,localCapabilities:l,direction:d,setup:h,videoCodec:f,audioCodec:g}=e;let _;this.setup=h,_=d===js.RECEIVE_ONLY?Ps(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`):Ps(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`),this._rtpCapabilities=o,this._candidates=i,this._iceParameters=t,this._dtlsParameters=n,this._localCapabilities=l;const v=d===js.RECEIVE_ONLY?this.rtpCapabilities.send:this.rtpCapabilities.recv,y=d===js.RECEIVE_ONLY?this._localCapabilities.recv:this._localCapabilities.send,b=d===js.RECEIVE_ONLY?o.send.videoCodecs:km(xe.VIDEO,v,y,f),D=d===js.RECEIVE_ONLY?o.send.audioCodecs:km(xe.AUDIO,v,y,g);for(const I of _.mediaDescriptions)I.attributes.iceUfrag=t.iceUfrag,I.attributes.icePwd=t.icePwd,I.attributes.fingerprints=n.fingerprints,I.attributes.candidates=i,I.attributes.setup=this.setup,I.media.mediaType==="application"&&(I.attributes.sctpPort="5000"),I.media.mediaType==="video"&&(I.media.fmts=b.map(O=>O.payloadType.toString(10)),I.attributes.payloads=b,I.attributes.extmaps=v.videoExtensions),I.media.mediaType==="audio"&&(I.media.fmts=D.map(O=>O.payloadType.toString(10)),I.attributes.payloads=D,I.attributes.extmaps=v.audioExtensions,zh(I));this.sessionDesc=_,this.currentMidIndex=_.mediaDescriptions.length-1}toString(){return Yc(this.sessionDesc)}hasMid(e){return Array.isArray(e)?e.every(t=>this.hasMid(t)):this.sessionDesc.mediaDescriptions.some(t=>t.attributes.mid===e)}send(e,t,n,i,o){n=n.replace(/ /g,"-");const{ssrcs:l,ssrcGroups:d}=Dm(t,this.cname,L("SYNC_GROUP")?n:void 0),h=this.findPreloadMediaDesc(l);if(h){if(gn()&&this.firefoxSsrcMidMap.set(l[0].ssrcId,h.attributes.mid),o&&(o.twcc||o.remb)){const f=this.sessionDesc.mediaDescriptions.indexOf(h);return this.sessionDesc.mediaDescriptions[f]=this.mungSendMediaDesc(h,o),{mid:h.attributes.mid,needExchangeSDP:!0}}return{mid:h.attributes.mid,needExchangeSDP:!1}}{const f=this.findAvailableMediaIndex(e,l,i);let g;return f===-1?(g=this.createOrRecycleSendMedia(e,l,d,"sendonly",i,o),this.updateBundleMids()):(g=_n(this.sessionDesc.mediaDescriptions[f]),g.attributes.direction="sendonly",g.attributes.ssrcs=l,g.attributes.ssrcGroups=d,this.sessionDesc.mediaDescriptions[f]=this.mungSendMediaDesc(g,o)),gn()&&this.firefoxSsrcMidMap.set(l[0].ssrcId,g.attributes.mid),{needExchangeSDP:!0,mid:g.attributes.mid}}}stopSending(e){const t=this.sessionDesc.mediaDescriptions.filter(n=>n.attributes.mid&&e.indexOf(n.attributes.mid)!==-1);if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");t.forEach(n=>{n.attributes.ssrcs=[]}),this.updateBundleMids()}receive(e,t,n){const i=[];return e.forEach(o=>{const l=o._mediaStreamTrack.kind,d=this.findAvailableRecvMediaIndex(l);let h,f=!1;d===-1?(f=!0,h=this.createOrRecycleRecvMedia(o,[],"recvonly",t,n),this.updateBundleMids()):(h=_n(this.sessionDesc.mediaDescriptions[d]),h.attributes.direction="recvonly"),i.push({mid:h.attributes.mid,needCreateTransceiver:f})}),i}stopReceiving(e){const t=this.sessionDesc.mediaDescriptions.filter(n=>e.indexOf(n.attributes.mid)!==-1);if(t.length!==e.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");t.forEach(n=>{n.media.port="0",n.attributes.direction="inactive"}),this.updateBundleMids()}addRemoteCandidate(e){const{foundation:t,protocol:n,address:i,port:o,type:l,relatedAddress:d,relatedPort:h,priority:f}=new RTCIceCandidate(e),g={foundation:t??"",componentId:"1",transport:n??"",priority:f?f+"":"",connectionAddress:i??"",port:o?o+"":"",type:l?l+"":"",relAddr:d??"",relPort:h?h+"":"",extension:{}};this.candidates.some(_=>_.priority===g.priority&&_.connectionAddress===g.connectionAddress&&_.port===g.port)||(this._candidates.push(g),this.sessionDesc.mediaDescriptions.forEach(_=>{_.attributes.candidates=this.candidates}))}clearRemoteCandidate(){this._candidates=[],this.sessionDesc.mediaDescriptions[0].attributes.candidates=this._candidates}createOrRecycleRecvMedia(e,t,n,i,o){const l=e._mediaStreamTrack.kind,d=this.rtpCapabilities.recv,h=km(l,d,this.localCapabilities.send,l===xe.AUDIO?o:i),f=l===xe.VIDEO?d.videoExtensions:d.audioExtensions,g="".concat(++this.currentMidIndex);let _={media:{mediaType:l,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:h.map(y=>y.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:f,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:h,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:n,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(g)}};_=this.mungRecvMediaDsec(_,e);const v=this.findFirstClosedMedia(l);if(v){const y=this.sessionDesc.mediaDescriptions.indexOf(v);this.sessionDesc.mediaDescriptions[y]=_}else this.sessionDesc.mediaDescriptions.push(_);return _}muteRemote(e){const t=this.sessionDesc.mediaDescriptions.filter(n=>me(e).call(e,n.attributes.mid||""));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach(n=>{n.attributes.direction="inactive"})}unmuteRemote(e){const t=this.sessionDesc.mediaDescriptions.filter(n=>me(e).call(e,n.attributes.mid||""));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach(n=>{n.attributes.direction="recvonly"})}findAvailableMediaIndex(e,t,n){return this.sessionDesc.mediaDescriptions.findIndex(i=>{const o=i.media.mediaType===e&&i.media.port!=="0"&&(i.attributes.direction==="sendonly"||i.attributes.direction==="sendrecv")&&i.attributes.ssrcs.length===0;if(gn()){if(o){const l=this.firefoxSsrcMidMap.get(t[0].ssrcId);return!(l||i.attributes.mid!=="0"&&i.attributes.mid!=="1")||!(!l||l!==i.attributes.mid)}return!1}return o&&i.attributes.mid===n})}findAvailableRecvMediaIndex(e){return this.sessionDesc.mediaDescriptions.findIndex(t=>{const n=t.media.mediaType===e&&t.media.port!=="0"&&(t.attributes.direction==="recvonly"||t.attributes.direction==="sendrecv");return t.attributes.mid!=="0"&&t.attributes.mid!=="1"&&n})}predictReceivingMids(e){const t=[];for(let n=0;n<e;n++)t.push((this.currentMidIndex+n+1).toString(10));return t}restartICE(e){e=_n(e),this._iceParameters=e,this.sessionDesc.mediaDescriptions.forEach(t=>{t.attributes.iceUfrag=e.iceUfrag,t.attributes.icePwd=e.icePwd})}createOrRecycleSendMedia(e,t,n,i,o,l){const d=this.rtpCapabilities.send,h=e===xe.VIDEO?d.videoCodecs:d.audioCodecs,f=e===xe.VIDEO?d.videoExtensions:d.audioExtensions;gn()&&(o="".concat(++this.currentMidIndex));let g={media:{mediaType:e,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:h.map(v=>v.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:f,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:n,rtcpFeedbackWildcards:[],payloads:h,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:i,rtcpMux:!0,rtcpRsize:!0,mid:o}};g=this.mungSendMediaDesc(g,l);const _=this.findFirstClosedMedia(e);if(_){const v=this.sessionDesc.mediaDescriptions.indexOf(_);this.sessionDesc.mediaDescriptions[v]=g}else this.sessionDesc.mediaDescriptions.push(g);return g}mungRecvMediaDsec(e,t,n){const i=_n(e);return $R(i),Fd(i,t),ZR(i,t),_V(i),s0(i,n,this.localCapabilities.send),i}mungSendMediaDesc(e,t){const n=_n(e);return s0(n,t,this.localCapabilities.recv),zh(n),n}updateRecvMedia(e,t){const n=this.sessionDesc.mediaDescriptions.findIndex(i=>i.attributes.mid===e);if(n!==-1){const i=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[n],t);this.sessionDesc.mediaDescriptions[n]=i}}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(e=>e.media.port!=="0").map(e=>e.attributes.mid)}findPreloadMediaDesc(e){return this.sessionDesc.mediaDescriptions.find(t=>{var n;return((n=t.attributes)===null||n===void 0||(n=n.ssrcs[0])===null||n===void 0?void 0:n.ssrcId)===e[0].ssrcId})}findFirstClosedMedia(e){return this.sessionDesc.mediaDescriptions.find(t=>gn()?t.media.port==="0"&&t.media.mediaType===e:t.media.port==="0")}};const Tue=["sdp"];var En;function NH(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}function oA(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?NH(Object(n),!0).forEach(function(i){x(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):NH(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}let OH=(En=class Op extends eV{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var t,n;return(t=(n=this.peerConnection.getReceivers()[0])===null||n===void 0||(n=n.transport)===null||n===void 0?void 0:n.state)!==null&&t!==void 0?t:null}get localCodecs(){return[]}set isInRestartIce(t){this._isInRestartIce=t}get isInRestartIce(){return this._isInRestartIce}constructor(t,n,i){super(t,n),x(this,"direction",void 0),x(this,"name",void 0),x(this,"store",void 0),x(this,"spec",void 0),x(this,"peerConnection",void 0),x(this,"initialOffer",void 0),x(this,"transport",void 0),x(this,"statsFilter",void 0),x(this,"localCandidateCount",0),x(this,"_isInRestartIce",!1),x(this,"mutex",void 0),x(this,"onLocalCandidate",void 0),x(this,"remoteSDP",void 0),x(this,"pendingCandidates",[]),x(this,"localCapabilities",void 0),x(this,"isReady",!1),x(this,"restartCnt",0),x(this,"curTurnServerIndex",0),this.store=n,this.spec=t,this.mutex=new Lr("P2PConnection-mutex",n.clientId),this.peerConnection=new RTCPeerConnection(Op.resolvePCConfiguration(t,n.p2pTransport),{optional:[{googDscp:!0}]}),this.direction=i??js.SEND_ONLY,this.name=this.direction===js.SEND_ONLY?"sendP2PConnection":"recvP2PConnection",this.statsFilter=Tv(this.peerConnection,L("STATS_UPDATE_INTERVAL"),void 0,gn()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1}async establish(t){try{const n=await tI();if(this.localCapabilities=Bm(n),t){const{sdp:i}=t,o=Cue(t,Tue),l=function(){const _={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},v=xm(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"sendonly"),y={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},b={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},D={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(no(v,_,"videoExtensions",y,b,D),no(v,_,"videoCodecs",y,b,D),no(v,_,"audioExtensions",y,b,D),no(v,_,"audioCodecs",y,b,D),L("RAISE_H264_BASELINE_PRIORITY")){const I=D.videoCodecs.findIndex(O=>O.rtpMap&&O.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&O.fmtp&&O.fmtp.parameters["profile-level-id"]==="42001f");if(I!==-1){const O=D.videoCodecs.findIndex(U=>U.rtpMap&&U.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(O<I){S.debug("raising H264 baseline profile priority");const U=D.videoCodecs[I];D.videoCodecs.splice(I,1),D.videoCodecs.splice(O,0,U)}O!==-1&&L("FILTER_SEND_H264_BASELINE")&&(y.videoCodecs=y.videoCodecs.filter(U=>!(U.rtpMap&&U.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&U.fmtp&&U.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:y,recv:b,sendrecv:D}}({},{},i);this.remoteSDP=new IH({remoteIceParameters:o.iceParameters,remoteDtlsParameters:o.dtlsParameters,candidates:[],remoteRTPCapabilities:l,localCapabilities:this.localCapabilities,direction:this.direction,setup:"actpass",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()}),this.isReady=!0;const d=await this.peerConnection.createAnswer();if(!d.sdp)throw new Error("Cannot get answer sdp when trying to establish PeerConnection.");const h=_c(d.sdp);await this.peerConnection.setLocalDescription(d);const f=await vV({},{},d.sdp);this.localCapabilities=Bm(f);const g=this.peerConnection.getTransceivers()[0];return g!=null&&g.receiver&&g.receiver.transport&&this.tryBindTransportEvents(g.receiver.transport),oA(oA({},h),{},{sdp:d.sdp})}{this.peerConnection.addTransceiver("video",{direction:"sendonly"}),this.peerConnection.addTransceiver("audio",{direction:"sendonly"});const i=await this.peerConnection.createOffer();if(!i.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const o=_c(i.sdp);return this.initialOffer=i,oA(oA({},o),{},{sdp:i.sdp})}}catch(n){throw new ae(P.GET_LOCAL_CONNECTION_PARAMS_FAILED,n.toString())}}async connect(t){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");await this.peerConnection.setLocalDescription(this.initialOffer);const{sdp:n,iceParameters:i,dtlsParameters:o}=t,l=await vV({},{},n);this.remoteSDP=new IH({remoteIceParameters:i,remoteDtlsParameters:o,candidates:[],remoteRTPCapabilities:l,localCapabilities:this.localCapabilities,direction:this.direction,setup:"active",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()});const d=this.peerConnection.getTransceivers()[0];d!=null&&d.sender&&d.sender.transport&&this.tryBindTransportEvents(d.sender.transport)}catch(n){throw new ae(P.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(n.toString()))}}async addRemoteCandidate(t){try{t&&this.pendingCandidates.push(t),this.peerConnection.remoteDescription&&this.isReady&&(this.pendingCandidates.forEach(n=>{this.peerConnection.addIceCandidate(n)}),this.pendingCandidates=[])}catch(n){throw new ae(P.ADD_CANDIDATE_FAILED,"P2PConnection.addRemoteCandidate failed; ".concat(n.toString()))}}send(t,n,i){var o=this;return qs(function*(){const l=yield ft(o.mutex.lock("From P2PConnection.send"));try{if(!o.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const d=[],h=o.remoteSDP.receive(t,n,i);t.forEach((O,U)=>{if(h[U].needCreateTransceiver){const j=o.peerConnection.addTransceiver(O._mediaStreamTrack,{direction:"sendonly"});d.push(j),O._updateRtpTransceiver(j)}else{const j=o.peerConnection.getTransceivers().find(G=>G.mid===h[U].mid);if(!j)throw new Error("cannot find transceiver when sendPeerconnection send, mid is ".concat(h[U].mid));d.push(j),O._updateRtpTransceiver(j)}}),gn()&&L("SIMULCAST")===!0&&(yield ft(o.applySimulcastForFirefox(d,t)));const f=h.map(O=>O.mid),g=yield ft(o.peerConnection.createOffer()),_=o.mungSendOfferSDP(g.sdp,t,f),v=Ps(_),y=f.map(O=>{const U=v.mediaDescriptions.find(j=>j.attributes.mid===O);if(!U)throw new Error("Cannot extract ssrc from mediaDescription.");return JR(U,L("USE_PUB_RTX"))}),b=d.map((O,U)=>{const j=f[U];return{localSSRC:y[U],id:j}});yield ft(o.peerConnection.setLocalDescription({type:"offer",sdp:_}));try{yield b}catch(O){const U=o.remoteSDP.toString();throw yield ft(o.peerConnection.setLocalDescription({type:"offer",sdp:_})),yield ft(o.peerConnection.setRemoteDescription({type:"answer",sdp:U})),yield ft(o.stopSending(f,!0)),O}yield ft(o.applySimulcastEncodings(d,t)),yield ft(o.applySendEncodings(d,t));const D=o.remoteSDP.toString(),I=o.logSDPExchange(_,"offer","local","send");return I==null||I(D),yield ft(o.setRemoteDescription({type:"answer",sdp:D})),d.map((O,U)=>{const j=f[U];return{localSSRC:y[U],id:j}})}catch(d){throw d instanceof ae?d:new ae(P.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(d.toString()))}finally{l()}})()}async stopSending(t,n){const i=n?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const o=this.peerConnection.getTransceivers().filter(f=>t.indexOf(f.mid)!==-1);if(o.length!==t.length)throw new Error("Transceivers' length (".concat(o.length,") doesn't match mids' length (").concat(t.length,") when trying to call P2PConnection.stopSending."));o.map(f=>{var g;f.direction="inactive",(g=f.stop)===null||g===void 0||g.call(f)});const l=await this.peerConnection.createOffer(),d=this.logSDPExchange(l.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(l),this.remoteSDP.stopReceiving(t);const h=this.remoteSDP.toString();d==null||d(h),await this.setRemoteDescription({type:"answer",sdp:h})}catch(o){throw new ae(P.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(o.toString()))}finally{i&&i()}}async receive(t,n,i,o){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));const{mid:l,needExchangeSDP:d}=this.remoteSDP.send(t,n,i,o);if(d){const f=this.remoteSDP.toString(),g=this.logSDPExchange(f,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:f});const _=await this.peerConnection.createAnswer(),v=this.mungReceiveAnswerSDP(_.sdp,l,t);g==null||g(v||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:v}),S.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP."))}else S.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," no need to exchange SDP."));const h=this.peerConnection.getTransceivers().find(f=>f.mid===l);if(!h||h.mid===null)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:h.receiver.track,mid:h.mid,transceiver:h}}catch(l){throw new ae(P.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(l.toString()))}}async mockReceive(t,n,i,o){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));const{mid:l,needExchangeSDP:d}=this.remoteSDP.send(t,n,i,o);if(d){const h=this.remoteSDP.toString(),f=this.logSDPExchange(h,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:h});const g=await this.peerConnection.createAnswer(),_=this.mungReceiveAnswerSDP(g.sdp,l,t);f==null||f(_||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:_}),S.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP."))}else S.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," no need to exchange SDP."))}catch(l){throw new ae(P.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(l.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(t);const n=this.remoteSDP.toString(),i=this.logSDPExchange(n,"offer","remote","stopReceiving");await this.setRemoteDescription({type:"offer",sdp:n});const o=await this.peerConnection.createAnswer();i==null||i(o.sdp||""),await this.peerConnection.setLocalDescription(o)}catch(n){throw new ae(P.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}async restartICE(t){try{if(this.store.p2pTransport===Rd.Auto&&(this.store.p2pTransport=Rd.SdRtn,wt().supportPCSetConfiguration&&this.peerConnection.setConfiguration(Op.resolvePCConfiguration(this.spec,this.store.p2pTransport))),this.restartCnt>3&&(this.restartCnt=0,wt().supportPCSetConfiguration&&this.peerConnection.setConfiguration(Op.resolvePCConfiguration(this.spec,this.store.p2pTransport,++this.curTurnServerIndex))),!t){this.restartCnt++,this.isReady=!1;const n=await this.peerConnection.createOffer({iceRestart:!0});if(!n.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const{iceParameters:i}=_c(n.sdp);return this.store.descriptionStart(),this.direction===js.SEND_ONLY&&await this.peerConnection.setLocalDescription(n),i}if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");if(this.remoteSDP.restartICE(t),this.store.descriptionStart(),this.direction===js.RECEIVE_ONLY){this.restartCnt++,await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()});const n=await this.peerConnection.createAnswer();if(!n.sdp)throw new Error("Cannot get answer sdp when trying to iceRestart.");const{iceParameters:i}=_c(n.sdp);return await this.peerConnection.setLocalDescription(n),i}await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()}),this.isReady=!0}catch(n){throw new ae(P.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}close(){var t;this.peerConnection.close(),this.peerConnection.onicecandidate=null,(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.transport=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const i=await this.peerConnection.createOffer(),o=this.mungSendOfferSDP(i.sdp,[n],[t]);this.remoteSDP.updateRecvMedia(t,n);const l=this.remoteSDP.toString(),d=this.logSDPExchange(o,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:o}),d==null||d(l),await this.peerConnection.setRemoteDescription({type:"answer",sdp:l})}catch(i){throw new ae(P.EXCHANGE_SDP_FAILED,i.toString())}}async updateSendParameters(t,n){const i=this.peerConnection.getTransceivers().filter(o=>o.mid===t);i.length===1&&(this.isVP8Simulcast(n)?gn()||await this.applySimulcastEncodings(i,[n]):await this.applySendEncodings(i,[n]))}setStatsRemoteVideoIsReady(t,n){this.statsFilter.setVideoIsReady2(t,n)}async replaceTrack(t,n){const i=this.peerConnection.getTransceivers().find(o=>o.mid===n);i&&await i.sender.replaceTrack(t._mediaStreamTrack)}async getSelectedCandidatePair(){const t=this.peerConnection.getReceivers();if(t.length>0&&t[0].transport&&t[0].transport.iceTransport&&t[0].transport.iceTransport.getSelectedCandidatePair&&t[0].transport.iceTransport.getSelectedCandidatePair()){const n=t[0].transport.iceTransport,{local:i,remote:o}=n.getSelectedCandidatePair();return{local:oA(oA({},Xa),{},{candidateType:i.type,protocol:i.protocol,address:i.address,port:i.port}),remote:oA(oA({},Xa),{},{candidateType:o.type,protocol:o.protocol,address:o.address,port:o.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t,n;me(t=["connected","completed"]).call(t,this.peerConnection.iceConnectionState)&&(this.isReady=!1),(n=this.onICEConnectionStateChange)===null||n===void 0||n.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;this.peerConnection.connectionState==="connected"&&(this.restartCnt=0),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.startICECandidate()}startICECandidate(){this.peerConnection.onicecandidate||(this.localCandidateCount=0,this.peerConnection.onicecandidate=t=>{if(t.candidate){var n;t.candidate.candidate&&((n=this.onLocalCandidate)===null||n===void 0||n.call(this,t.candidate.toJSON())),this.localCandidateCount+=1}else S.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount)})}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const o={iceServers:[]};var l;return t.iceServers?o.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(yd(t.turnServer.servers)?o.iceServers=t.turnServer.servers:(o.iceServers&&o.iceServers.push(...Op.turnServerConfigToIceServers(t.turnServer.servers,n,i)),L("USE_TURN_SERVER_OF_GATEWAY")&&o.iceServers&&t.turnServer.serversFromGateway&&o.iceServers.push(...Op.turnServerConfigToIceServers(t.turnServer.serversFromGateway,n,i)),me(l=[Rd.Relay,Rd.SdRtn]).call(l,n)&&(o.iceTransportPolicy="relay"),L("FORCE_TURN_TCP")?o.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(d=>{d.forceturn&&(o.iceTransportPolicy="relay")}))),L("ENABLE_ENCODED_TRANSFORM")&&wt().supportWebRTCEncodedTransform&&(o.encodedInsertableStreams=!0),S.debug("P2PConnection p2pTransport is ".concat(n)),o}static turnServerConfigToIceServers(t,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const o=[],l=t.filter(h=>h.tcpport);S.debug("P2PConnection turnServers is ".concat(l,", current index is ").concat(i));const d=l.length>i?l[i]:l[0];switch(n){case Rd.SdRtn:const h=t.filter(g=>{var _;return me(_=g.username).call(_,"glb:")&&g.turnServerURL==g.turnServerURL}),f=h.length>i?h[i]:h[0];f&&(o.push({username:f.username,credential:f.password,credentialType:"password",urls:"turn:".concat(to(f.turnServerURL),":").concat(f.tcpport,"?transport=udp")}),o.push({username:f.username,credential:f.password,credentialType:"password",urls:"turns:".concat(to(f.turnServerURL),":").concat(f.tcpport,"?transport=tcp")}));break;case Rd.Relay:d&&(o.push({username:d.username,credential:d.password,credentialType:"password",urls:"turn:".concat(d.turnServerURL,":").concat(d.tcpport,"?transport=udp")}),o.push({username:d.username,credential:d.password,credentialType:"password",urls:"turns:".concat(to(d.turnServerURL),":").concat(d.tcpport,"?transport=tcp")}));break;default:d&&(o.push({username:d.username,credential:d.password,credentialType:"password",urls:"turn:".concat(d.turnServerURL,":").concat(d.tcpport,"?transport=udp")}),o.push({username:d.username,credential:d.password,credentialType:"password",urls:"turns:".concat(to(d.turnServerURL),":").concat(d.tcpport,"?transport=tcp")}),o.push({username:d.username,credential:d.password,credentialType:"password",urls:"stun:".concat(d.turnServerURL,":").concat(d.tcpport)}))}return o}tryBindTransportEvents(t){if(t){this.transport=t,t.onstatechange=()=>{var i;t!=null&&t.state&&((i=this.onDTLSTransportStateChange)===null||i===void 0||i.call(this,t.state))},t.onerror=i=>{var o;(o=this.onDTLSTransportError)===null||o===void 0||o.call(this,"error"in i?i.error:i)};const n=t.iceTransport;n&&(n.onstatechange=()=>{const i=t==null?void 0:t.iceTransport.state;var o;i&&((o=this.onICETransportStateChange)===null||o===void 0||o.call(this,i))},n.getSelectedCandidatePair&&(n.onselectedcandidatepairchange=()=>{if(n.getSelectedCandidatePair()){const{local:i,remote:o}=n.getSelectedCandidatePair()||{};if(i&&o){const l=i.address+":"+i.port,d=o.address+":"+o.port;S.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify(gc(l)),", remote ").concat(JSON.stringify(gc(d))))}}}))}}tryUnbindTransportEvents(){this.transport&&(this.transport.onstatechange=null,this.transport.onerror=null,this.transport.iceTransport&&(this.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(t,n){var i;if(n||(n=this.peerConnection.getSenders().find(_=>_.track===t._mediaStreamTrack)),!n)return S.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(t))return S.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!wt().supportSetRtpSenderParameters)return S.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const o={},l={};switch(t._optimizationMode){case"motion":o.degradationPreference="maintain-framerate";break;case"detail":o.degradationPreference="maintain-resolution";break;default:o.degradationPreference="balanced"}if(t._encoderConfig){var d;const{bitrateMax:_,frameRate:v,scaleResolutionDownBy:y}=t._encoderConfig;_&&(l.maxBitrate=1e3*_),me(d=t._hints).call(d,Wt.LOW_STREAM)&&(v&&(l.maxFramerate=ei(v)),y&&y>=1&&(l.scaleResolutionDownBy=y))}if(L("DSCP_TYPE")&&uc()){var h;const _=L("DSCP_TYPE");me(h=["very-low","low","medium","high"]).call(h,_)&&(l.networkPriority=_)}const f=n.getParameters(),g=(i=f.encodings)===null||i===void 0?void 0:i[0];gn()&&!g&&(o.encodings=[l]),g&&Object.assign(g,l),Object.assign(f,o),S.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(f.encodings))),await n.setParameters(f)}async applySendEncodings(t,n){try{if(!wt().supportSetRtpSenderParameters||t.length!==n.length)return;for(let i=0;i<t.length;i++){const o=t[i],l=n[i];l instanceof on&&!this.isVP8Simulcast(l)&&await this.updateRtpSenderEncodings(l,o.sender)}}catch{S.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,n,i){const o=Ps(t);return n.forEach((l,d)=>{const h=i[d],f=o.mediaDescriptions.find(g=>g.attributes.mid===h);f&&(Fd(f,l),eI(f,l,this.store.codec))}),Yc(o)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var n;(n=this.onFirstAudioReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var n;(n=this.onFirstVideoReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var n;(n=this.onFirstAudioDecoded)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,n,i)=>{var o;(o=this.onFirstVideoDecoded)===null||o===void 0||o.call(this,t,n,i)},this.statsFilter.onSelectedLocalCandidateChanged=(t,n)=>{var i;(i=this.onSelectedLocalCandidateChanged)===null||i===void 0||i.call(this,t,n)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,n)=>{var i;(i=this.onSelectedRemoteCandidateChanged)===null||i===void 0||i.call(this,t,n)},this.statsFilter.onFirstVideoDecodedTimeout=t=>{var n;(n=this.onFirstVideoDecodedTimeout)===null||n===void 0||n.call(this,t)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(t,n){if(t.length===n.length)for(let f=0;f<t.length;f++){var i,o,l,d,h;const g=t[f],_=n[f];if(_ instanceof on&&!me(i=_._hints).call(i,Wt.LOW_STREAM)&&(o=_._encoderConfig)!==null&&o!==void 0&&o.bitrateMax&&((l=_._encoderConfig)===null||l===void 0?void 0:l.bitrateMax)>200&&(d=_._scalabilityMode)!==null&&d!==void 0&&d.numSpatialLayers&&((h=_._scalabilityMode)===null||h===void 0?void 0:h.numSpatialLayers)>1&&this.store.codec==="vp8"){const v={},y={high:1e3*(_._encoderConfig.bitrateMax-50),medium:5e4};v.encodings=[{rid:"m",active:!0,maxBitrate:y.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:y.high}];const b=g.sender.getParameters();await g.sender.setParameters(Object.assign(b,v))}}}async applySimulcastEncodings(t,n){if(!gn()&&t.length===n.length)for(let i=0;i<t.length;i++){const o=n[i];if(o instanceof on&&this.isVP8Simulcast(o)){const l=t[i],d={},h={high:1e3*(o._encoderConfig.bitrateMax-50),medium:5e4};d.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:h.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:h.medium,scaleResolutionDownBy:4}];const f=l.sender.getParameters();await l.sender.setParameters(Object.assign(f,d))}}}isVP8Simulcast(t){var n,i,o,l,d;return!!(t instanceof on&&L("SIMULCAST")&&this.store.codec==="vp8"&&!me(n=t._hints).call(n,Wt.LOW_STREAM)&&(i=t._encoderConfig)!==null&&i!==void 0&&i.bitrateMax&&((o=t._encoderConfig)===null||o===void 0?void 0:o.bitrateMax)>200&&(l=t._scalabilityMode)!==null&&l!==void 0&&l.numSpatialLayers&&((d=t._scalabilityMode)===null||d===void 0?void 0:d.numSpatialLayers)>1)}logSDPExchange(t,n,i,o){if(L("SDP_LOGGING"))return S.upload("[".concat(this.store.clientId,"] exchanging ").concat(i," ").concat(n," SDP during P2PConnection.").concat(o,`
`),t),n==="offer"?l=>{this.logSDPExchange(l,"answer",i==="local"?"remote":"local",o)}:void 0}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(d=>d.mid&&t.indexOf(d.mid)!==-1);if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(d=>{d.direction="inactive"});const i=await this.peerConnection.createOffer(),o=this.logSDPExchange(i.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(i),this.remoteSDP.muteRemote(t);const l=this.remoteSDP.toString();o==null||o(l),await this.setRemoteDescription({type:"answer",sdp:l})}catch(n){throw new ae(P.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(n.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(d=>d.mid&&t.indexOf(d.mid)!==-1);if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(async d=>{d.direction="sendonly"});const i=await this.peerConnection.createOffer(),o=this.logSDPExchange(i.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(i),this.remoteSDP.unmuteRemote(t);const l=this.remoteSDP.toString();o==null||o(l),await this.setRemoteDescription({type:"answer",sdp:l})}catch(n){throw new ae(P.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(n.toString()))}}async getRemoteSSRC(t,n){var i;if(n=n??((i=this.currentRemoteDescription)===null||i===void 0?void 0:i.sdp)){var o;const l=(o=Ps(n).mediaDescriptions.find(d=>d.attributes.mid===t))===null||o===void 0?void 0:o.attributes.ssrcs;return l==null?void 0:l[0].ssrcId}}async setRemoteDescription(t){var n;await this.peerConnection.setRemoteDescription(t),me(n=["connected","completed"]).call(n,this.peerConnection.iceConnectionState)||(this.isReady=!0,this.addRemoteCandidate())}mungReceiveAnswerSDP(t,n,i){const o=Ps(t),l=o.mediaDescriptions.find(d=>d.attributes.mid===n);return l&&i===xe.AUDIO&&l.media.mediaType==="audio"&&zh(l),Yc(o)}},Ce(En.prototype,"establish",[oo],Object.getOwnPropertyDescriptor(En.prototype,"establish"),En.prototype),Ce(En.prototype,"connect",[oo],Object.getOwnPropertyDescriptor(En.prototype,"connect"),En.prototype),Ce(En.prototype,"receive",[oo],Object.getOwnPropertyDescriptor(En.prototype,"receive"),En.prototype),Ce(En.prototype,"mockReceive",[oo],Object.getOwnPropertyDescriptor(En.prototype,"mockReceive"),En.prototype),Ce(En.prototype,"stopReceiving",[oo],Object.getOwnPropertyDescriptor(En.prototype,"stopReceiving"),En.prototype),Ce(En.prototype,"restartICE",[oo],Object.getOwnPropertyDescriptor(En.prototype,"restartICE"),En.prototype),Ce(En.prototype,"close",[oo],Object.getOwnPropertyDescriptor(En.prototype,"close"),En.prototype),Ce(En.prototype,"updateEncoderConfig",[oo],Object.getOwnPropertyDescriptor(En.prototype,"updateEncoderConfig"),En.prototype),Ce(En.prototype,"updateSendParameters",[oo],Object.getOwnPropertyDescriptor(En.prototype,"updateSendParameters"),En.prototype),Ce(En.prototype,"replaceTrack",[oo],Object.getOwnPropertyDescriptor(En.prototype,"replaceTrack"),En.prototype),Ce(En.prototype,"muteLocal",[oo],Object.getOwnPropertyDescriptor(En.prototype,"muteLocal"),En.prototype),Ce(En.prototype,"unmuteLocal",[oo],Object.getOwnPropertyDescriptor(En.prototype,"unmuteLocal"),En.prototype),En);function oo(e,t,n){const i=e[t];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const o=this.mutex,l=await o.lock("From P2PConnection.".concat(t));try{for(var d=arguments.length,h=new Array(d),f=0;f<d;f++)h[f]=arguments[f];return await i.apply(this,h)}finally{l()}},n}let Vo=function(e){return e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY",e}({});var xH,DH,BH,kH,LH,UH,PH,MH,FH,jH,VH,On;function QH(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}function j0(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?QH(Object(n),!0).forEach(function(i){x(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):QH(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}let Rue=(xH=Qo(Vo.SEND_ONLY),DH=Qo(Vo.SEND_ONLY),BH=Qo(),kH=Qo(Vo.RECEIVE_ONLY),LH=Qo(Vo.RECEIVE_ONLY),UH=Qo(Vo.RECEIVE_ONLY),PH=Qo(Vo.RECEIVE_ONLY),MH=Qo(Vo.RECEIVE_ONLY),FH=Qo(Vo.RECEIVE_ONLY),jH=Qo(),VH=Qo(Vo.RECEIVE_ONLY),On=class extends Tn{get state(){return this._state}set state(e){const t=this._state;this._state=e,this.emit(Ve.StateChange,t,this._state)}constructor(e,t){super(),x(this,"isPlanB",!1),x(this,"store",void 0),x(this,"statsUploader",void 0),x(this,"sendConnection",void 0),x(this,"recvConnection",void 0),x(this,"localTrackMap",new Map),x(this,"remoteUserMap",new Map),x(this,"localDataChannels",[]),x(this,"pendingLocalTracks",[]),x(this,"pendingRemoteTracks",[]),x(this,"statsCollector",void 0),x(this,"dtlsFailedCount",0),x(this,"sendMutex",void 0),x(this,"recvMutex",void 0),x(this,"_state",Kt.Disconnected),x(this,"_restartStates",["disconnected","failed"]),x(this,"reconnectInterval",void 0),x(this,"uploadUnplinkStarted",!1),x(this,"uploadDownlinkStarted",!1),x(this,"uplinkStateUploadInterval",void 0),x(this,"downlinkStatsUploadInterval",void 0),x(this,"handleMuteLocalTrack",async(n,i,o)=>{const l=await this.sendMutex.lock("Locking from P2PChannel2.handleMuteLocalTrack");try{if(!this.sendConnection||this.state!==Kt.Connected)return void o(new ae(P.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established."));const f=this.filterTobeMutedTracks(n);if(f.length===0)return void i();const g=f.find(b=>b[0]==="videoLowTrack");g&&g[1].track._originMediaStreamTrack.stop(),await this.sendConnection.muteLocal(f.map(b=>{let[,{id:D}]=b;return D}));let _=!1;var d,h;n.trackMediaType==="video"?_=!((d=this.localTrackMap.get(ge.LocalAudioTrack))===null||d===void 0||!d.track._muted):_=((h=this.localTrackMap.get(ge.LocalVideoTrack))===null||h===void 0?void 0:h.id)===void 0;const v=this.createMuteMessage(f);await ln(this,Ve.RequestMuteLocal,v);const y=n.trackMediaType==="video"?ql.MUTE_LOCAL_VIDEO:ql.MUTE_LOCAL_AUDIO;await ln(this,Ve.RequestP2PMuteLocal,{action:y,message:v,isMuteAll:_}),i()}catch(f){o(f)}finally{l()}}),x(this,"handleUnmuteLocalTrack",async(n,i,o)=>{const l=await this.sendMutex.lock("Locking from P2PChannel2.handleUnmuteLocalTrack");try{if(!this.sendConnection||this.state!==Kt.Connected)return void o(new ae(P.INVALID_OPERATION,"Cannot call P2PChannel2.handleUnmuteLocalTrack before sendConnection established."));const d=this.filterTobeUnmutedTracks(n);if(d.length===0)return void i();await this.sendConnection.unmuteLocal(d.map(g=>{let[,{id:_}]=g;return _}));const h=this.createUnmuteMessage(d),f=n.trackMediaType==="video"?ql.UNMUTE_LOCAL_VIDEO:ql.UNMUTE_LOCAL_AUDIO;await ln(this,Ve.RequestP2PMuteLocal,{action:f,message:h}),i()}catch(d){o(d)}finally{l()}}),x(this,"handleUpdateVideoEncoder",async(n,i,o,l)=>{let d;typeof l=="boolean"&&l||(d=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoEncoder"));try{const f=this.localTrackMap.get(ge.LocalVideoTrack);if(!this.sendConnection||!f||f.track!==n||this.state!==Kt.Connected)return void i();const{id:g,track:_}=f;g&&(await this.sendConnection.updateSendParameters(g,_),await this.sendConnection.updateEncoderConfig(g,_),this.emit(Ve.UpdateVideoEncoder,_)),i()}catch(f){o(f)}finally{var h;(h=d)===null||h===void 0||h()}}),x(this,"handleUpdateVideoSendParameters",async(n,i,o)=>{const l=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoSendParameters");try{const d=this.localTrackMap.get(ge.LocalVideoTrack);if(!this.sendConnection||!d||d.track!==n||this.state!==Kt.Connected)return void i();const{id:h,track:f}=d;h&&await this.sendConnection.updateSendParameters(h,f),i()}catch(d){o(d)}finally{l()}}),x(this,"handleReplaceTrack",async(n,i,o,l)=>{let d;S.debug("[".concat(this.store.clientId,"] P2PChannel2 handleReplaceTrack for [track-id-").concat(n.getTrackId(),"]")),typeof l=="boolean"&&l||(d=await this.sendMutex.lock("From P2PChannel2.handleReplaceTrack"));try{var h;const g=Array.from(this.localTrackMap.entries()).find(_=>{let[,{track:v}]=_;return n===v});if(!this.sendConnection||!g||g[1].id===void 0||this.state!==Kt.Connected)return void i();if(await((h=this.sendConnection)===null||h===void 0?void 0:h.replaceTrack(n,g[1].id)),g[0]===ge.LocalVideoTrack&&wt().supportDualStreamEncoding){const _=this.localTrackMap.get(ge.LocalVideoLowTrack);if(_){const v=n._mediaStreamTrack.clone();_.track._originMediaStreamTrack.stop(),_.track._mediaStreamTrack=v,_.track._originMediaStreamTrack=v,await new be((y,b)=>{this.handleReplaceTrack(_.track,y,b,!0)})}}i()}catch(g){o(g)}finally{var f;(f=d)===null||f===void 0||f()}}),x(this,"handleGetLocalVideoStats",n=>{n(this.statsCollector.getLocalVideoTrackStats())}),x(this,"handleGetLocalAudioStats",n=>{n(this.statsCollector.getLocalAudioTrackStats())}),x(this,"handleGetRemoteVideoStats",n=>this.statsCollector.getRemoteVideoTrackStats(n.uid)[n.uid]),x(this,"handleGetRemoteAudioStats",n=>this.statsCollector.getRemoteAudioTrackStats(n.uid)[n.uid]),this.store=e,this.statsCollector=t,this.statsCollector.addP2PChannel(this),this.statsUploader=new nQ(e),this.bindStatsUploaderEvents(),this.sendMutex=new Lr("P2PChannel2-send-mutex",e.clientId),this.recvMutex=new Lr("P2PChannel2-recv-mutex",e.clientId),this.reconnectInterval=window.setInterval(()=>{[this.sendConnection,this.recvConnection].forEach(n=>{n&&(n.iceConnectionState!=="disconnected"&&n.iceConnectionState!=="failed"||this.handleDisconnect(n.direction))})},L("ICE_RESTART_INTERVAL"))}async startP2PConnection(e,t){throw new ae(P.NOT_SUPPORTED,"p2p mode does not support startP2PConnection.")}async connect(e){throw new ae(P.NOT_SUPPORTED,"p2p mode does not support connect.")}async startP2P(e,t){let n;try{if(t){this.recvConnection&&(S.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset recvConnection.")),this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection)),n=await this.recvMutex.lock("From P2PChannel.startP2P"),this.recvConnection=new OH(e,this.store,js.RECEIVE_ONLY),this.bindConnectionEvents(this.recvConnection);const i=await this.recvConnection.establish(t);return{iceParameters:i.iceParameters,dtlsParameters:i.dtlsParameters,sdp:i.sdp}}{this.state=Kt.New,this.sendConnection&&(S.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset sendConnection.")),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection)),n=await this.sendMutex.lock("From P2PChannel.startP2P"),this.sendConnection=new OH(e,this.store),this.store.peerConnectionStart(),this.bindConnectionEvents(this.sendConnection);const i=await this.sendConnection.establish();return{iceParameters:i.iceParameters,dtlsParameters:i.dtlsParameters,sdp:i.sdp}}}finally{n&&n()}}async p2pConnect(e){if(!this.sendConnection)throw new ae(P.UNEXPECTED_ERROR,"Cannot P2PChannel2.p2pConnect before P2PChannel2.startP2PConnection .");this.store.peerConnectionStart(),await this.sendConnection.connect(e),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=Kt.Connected}async addRemoteCandidate(e,t){if(t===js.RECEIVE_ONLY){if(!this.sendConnection)throw new ae(P.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.sendConnection.addRemoteCandidate(e)}else{if(!this.recvConnection)throw new ae(P.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.recvConnection.addRemoteCandidate(e)}}publish(e,t,n){var i=this;return qs(function*(){const o=yield ft(i.sendMutex.lock("From P2PChannel.publish"));try{if(!i.sendConnection||i.state!==Kt.Connected){i.throwIfTrackTypeNotMatch(e);const g=e.filter(_=>i.pendingLocalTracks.indexOf(_)===-1);return void(i.pendingLocalTracks=i.pendingLocalTracks.concat(g))}i.store.pubId=i.store.pubId+1,os.markPublishStart(i.store.clientId,i.store.pubId);const l=i.filterTobePublishedTracks(e,t,n);if(l.length===0)return void(yield ft(i.tryToUnmuteAudio(e)));l.forEach(g=>{let{track:_,type:v}=g;const y=Date.now();i.store.publish(_.getTrackId(),v===ge.LocalAudioTrack?"audio":"video",y)}),i.bindLocalTrackEvents(l);const d=yield ft(i.sendConnection.send(l.map(g=>{let{track:_}=g;return _}),i.store.codec,i.store.audioCodec)),h=(yield ft(d.next())).value,f=i.createGatewayPublishMessage(l,h);try{yield f}catch(g){throw d.throw(g),(g==null?void 0:g.code)===P.WS_ABORT&&l.forEach(_=>{let{track:v}=_;i.pendingLocalTracks.indexOf(v)===-1&&i.pendingLocalTracks.push(v)}),i.unbindLocalTrackEvents(l),g}yield ft(d.next()),l.forEach(g=>{let{type:_}=g;i.statsCollector.addLocalStats(_)}),i.statsUploader.startUploadOutboundStats(),i.assignLocalTracks(l,h),l.forEach(g=>{let{track:_,type:v}=g;const y=Date.now();i.store.publish(_.getTrackId(),v===ge.LocalAudioTrack?"audio":"video",void 0,y)}),i.startUploadUplinkState()}finally{o()}})()}async unpublish(e){if(!this.sendConnection||this.state!==Kt.Connected)return void(e.length===0?this.pendingLocalTracks.length=0:this.pendingLocalTracks=this.pendingLocalTracks.filter(o=>!me(e).call(e,o)));const t=this.filterTobeUnpublishedTracks(e);if(t.length===0)return;const n=t.find(o=>o[0]==="videoLowTrack");n&&n[1].track.close();const i=this.createGatewayUnpublishMessage(t);if(await this.sendConnection.stopSending(t.map(o=>{let[,{id:l}]=o;return l})),this.withdrawLocalTracks(t),this.unbindLocalTrackEvents(t.map(o=>{let[l,{track:d}]=o;return{type:l,track:d}})),t.forEach(o=>{let[l]=o;this.statsCollector.removeLocalStats(l)}),this.localTrackMap.size===0&&(this.statsUploader.stopUploadOutboundStats(),this.stopUploadUplinkState()),this.sendConnection&&this.state===Kt.Connected)return n&&n[1].track.close(),i;e.forEach(o=>{const l=this.pendingLocalTracks.indexOf(o);l!==-1&&this.pendingLocalTracks.splice(l,1)})}startUploadUplinkState(){if(this.uploadUnplinkStarted)return;this.uploadUnplinkStarted=!0,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval);const e=()=>{const t=[],n=[];Array.from(this.localTrackMap.entries()).forEach(i=>{let[o,{track:l,ssrcs:d}]=i;const h={stream_type:fAe(l,o),ssrcs:d};l._muted||!l._enabled?t.push(h):n.push(h)}),t.length>0&&t.forEach(i=>{ln(this,Ve.RequestMuteLocal,[i])}),n.length>0&&n.forEach(i=>{ln(this,Ve.RequestUnmuteLocal,[i])})};e(),this.uplinkStateUploadInterval=window.setInterval(()=>{e()},3e3)}stopUploadUplinkState(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval))}publishLowStream(e){return qs(function*(){throw new ae(P.NOT_SUPPORTED,"p2p mode does not support publishLowStream.")})()}async republish(){this.pendingLocalTracks.length>0&&(S.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await ir(this,Ve.RequestRePublish,this.pendingLocalTracks),this.emit(Ve.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[])}async unpublishLowStream(){throw new ae(P.NOT_SUPPORTED,"p2p mode does not support unpublishLowStream.")}async subscribe(e,t,n,i){var o;if(!this.recvConnection)throw new ae(P.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");if((o=this.remoteUserMap.get(e))!==null&&o!==void 0&&o.has(t))return;const{track:l,mid:d,transceiver:h}=await this.recvConnection.receive(t,[{ssrcId:n}],String(e.uid),i);t===xe.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(l):(e._audioTrack=new jh(l,e.uid,e._uintid,this.store),S.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),h&&e._audioTrack._updateRtpTransceiver(h),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoSSRC=n,e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(l):(e._videoTrack=new Fh(l,e.uid,e._uintid,this.store),S.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId()))),h&&e._videoTrack._updateRtpTransceiver(h),this.bindRemoteTrackEvents(e,e._videoTrack));const f=this.remoteUserMap.get(e);f?f.set(t,d):this.remoteUserMap.set(e,new Map([[t,d]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats(),this.startUploadDownlinkState();const g=this.pendingRemoteTracks.findIndex(_=>{let{user:v,kind:y}=_;return v.uid===e.uid&&t===y});g!==-1&&(this.pendingRemoteTracks.splice(g,1),this.emit(Ve.MediaReconnectEnd,e.uid))}async mockSubscribe(e,t,n,i){if(!this.recvConnection)throw new ae(P.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");await this.recvConnection.mockReceive(t,[{ssrcId:n}],String(e.uid),i)}async unsubscribe(e,t,n){const i=this.pendingRemoteTracks.filter(l=>{let{user:d,kind:h}=l;return t!==void 0?d.uid===e.uid&&t===h:d.uid===e.uid});if(i.forEach(l=>{const d=this.pendingRemoteTracks.indexOf(l);this.pendingRemoteTracks.splice(d,1)}),this.recvConnection||n||i.forEach(l=>{let{kind:d}=l;var h;if(d===xe.AUDIO)(h=e._audioTrack)===null||h===void 0||h._destroy(),e._audioTrack=void 0;else if(d===xe.VIDEO){var f;(f=e._videoTrack)===null||f===void 0||f._destroy(),e._videoTrack=void 0}}),!this.recvConnection)return;const o=this.filterTobeUnSubscribedTracks(e,t);o.length!==0&&(await this.recvConnection.stopReceiving(o.map(l=>{let[,{id:d}]=l;return d})),this.withdrawRemoteTracks(o),this.remoteUserMap.size===0&&(this.statsUploader.stopUploadInboundStats(),this.stopUploadDownlinkState()),o.forEach(l=>{let[d,{kind:h}]=l;var f,g;if(h===xe.VIDEO&&d._videoSSRC&&((f=this.recvConnection)===null||f===void 0||f.setStatsRemoteVideoIsReady(d._videoSSRC,!1)),h===xe.VIDEO)this.unbindRemoteTrackEvents(d._videoTrack),n||((g=d._videoTrack)===null||g===void 0||g._destroy(),d._videoTrack=void 0);else if(h===xe.AUDIO){var _;this.unbindRemoteTrackEvents(d._audioTrack),!n&&((_=d._audioTrack)===null||_===void 0||_._destroy(),d._audioTrack=void 0)}}),o.forEach(l=>{let[,{kind:d}]=l;ln(this,Ve.RequestP2PMuteRemote,d)}))}startUploadDownlinkState(){if(this.uploadDownlinkStarted)return;this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval);const e=()=>Array.from(this.remoteUserMap.entries()).forEach(t=>{let[,n]=t;[xe.VIDEO,xe.AUDIO].forEach(i=>{n.has(i)?ln(this,Ve.RequestP2PUnmuteRemote,i):ln(this,Ve.RequestP2PMuteRemote,i)})});e(),this.downlinkStatsUploadInterval=window.setInterval(()=>{e()},3e3)}stopUploadDownlinkState(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval))}getAllDataChannels(){return this.localDataChannels}async massSubscribe(e){throw new ae(P.NOT_SUPPORTED,"p2p mode does not support massSubscribe.")}async massSubscribeNoLock(e){throw new ae(P.NOT_SUPPORTED,"p2p mode does not support massSubscribeNoLock.")}async massUnsubscribe(e){throw new ae(P.NOT_SUPPORTED,"p2p mode does not support massUnsubscribe.")}async massUnsubscribeNoLock(e){throw new ae(P.NOT_SUPPORTED,"p2p mode does not support massUnsubscribeNoLock.")}async muteRemote(e,t){if(!this.recvConnection)return;const n=this.remoteUserMap.get(e);if(!n)return void S.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid,"."));if(!n.get(t))return void S.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."));const i=t===xe.VIDEO?e._videoSSRC:e._audioSSRC;i!==void 0&&this.recvConnection.setStatsRemoteVideoIsReady(i,!1)}async unmuteRemote(e,t){return this.unmuteRemoteNoLock(e,t)}async unmuteRemoteNoLock(e,t){if(!this.recvConnection)return;const n=this.remoteUserMap.get(e);if(!n)return void S.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid,"."));n.get(t)||S.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."))}getAllTracks(e){const t=this.localTrackMap.get(ge.LocalAudioTrack);if((t==null?void 0:t.track)instanceof dr){const n=t.track;return Array.from(this.localTrackMap.entries()).filter(i=>{let[o]=i;return o!==ge.LocalAudioTrack}).filter(i=>{let[o]=i;return!(e&&o===ge.LocalVideoLowTrack)}).map(i=>{let[,{track:o}]=i;return o}).concat(n.trackList)}return Array.from(this.localTrackMap.entries()).filter(n=>{let[i]=n;return!(e&&i===ge.LocalVideoLowTrack)}).map(n=>{let[,{track:i}]=n;return i})}reportPublishEvent(e,t,n,i,o){if(e){const d=this.localTrackMap.get(ge.LocalAudioTrack),h=i?this.localTrackMap.get(ge.LocalVideoLowTrack):this.localTrackMap.get(ge.LocalVideoTrack);ke.publish(this.store.sessionId,{eventElapse:os.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:d==null?void 0:d.track.getTrackLabel(),videoName:h==null?void 0:h.track.getTrackLabel(),screenshare:(h==null?void 0:h.track._hints.indexOf(Wt.SCREEN_TRACK))!==-1,audio:!!d,video:!!h,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:o})}else{var l;n||(n=[]);const d=n.find(f=>f instanceof Mn),h=i?(l=this.localTrackMap.get(ge.LocalVideoTrack))===null||l===void 0?void 0:l.track:n.find(f=>f instanceof on);ke.publish(this.store.sessionId,{eventElapse:os.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:d==null?void 0:d.getTrackLabel(),videoName:h==null?void 0:h.getTrackLabel(),screenshare:(h==null?void 0:h._hints.indexOf(Wt.SCREEN_TRACK))!==-1,audio:!!d,video:!!h,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:o})}}reportSubscribeEvent(e,t,n,i){const o=i===xe.VIDEO?n._videoSSRC:n._audioSSRC;o&&ke.subscribe(this.store.sessionId,{succ:e,ec:t,video:i===xe.VIDEO,audio:i===xe.AUDIO,peerid:n.uid,subscribeRequestid:i===xe.VIDEO?n._videoSSRC:n._audioSSRC,p2pid:this.store.p2pId,eventElapse:os.measureFromSubscribeStart(this.store.clientId,o)})}reset(){S.debug("[".concat(this.store.clientId,"] P2PChannel2.reset")),this.sendMutex=new Lr("P2PChannel2-send-mutex",this.store.clientId),this.sendMutex=new Lr("P2PChannel2-recv-mutex",this.store.clientId),this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const e=this.localTrackMap.get(ge.LocalAudioTrack);if((e==null?void 0:e.track)instanceof dr){if(e.track.trackList.length>0){const t=e.track;e.track.trackList.forEach(n=>{t.removeAudioTrack(n)})}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.reconnectInterval&&(window.clearInterval(this.reconnectInterval),this.reconnectInterval=void 0),this.state=Kt.Disconnected}getStats(e){var t,n;return e?(n=this.recvConnection)===null||n===void 0?void 0:n.getStats():(t=this.sendConnection)===null||t===void 0?void 0:t.getStats()}getRemoteVideoIsReady(e){var t;return((t=this.recvConnection)===null||t===void 0?void 0:t.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){const e=this.localTrackMap.get(ge.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){const e=this.localTrackMap.get(ge.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}}getEncoderConfig(e){const t=this.localTrackMap.get(e);return t&&t.track instanceof on||t&&t.track instanceof Mn?t.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,t){if(!e)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}async hasRemoteMediaWithLock(e,t){if(!e)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}getRemoteMedia(e){var t;const n=Array.from(ms(t=this.remoteUserMap).call(t)).find(i=>i.uid===e);return n?{audioTrack:n.audioTrack,audioSSRC:n._audioSSRC,videoTrack:n.videoTrack,videoSSRC:n._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map(n=>{let[i]=n;return{uid:i.uid,level:i.audioTrack?100*i.audioTrack._source.getAccurateVolumeLevel():0}});const t=this.localTrackMap.get(ge.LocalAudioTrack);return t&&e.push({level:100*t.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=Ad(e).call(e,(n,i)=>n.level-i.level),e}async disconnectForReconnect(){this.sendConnection&&this.recvConnection&&(S.debug("[".concat(this.store.clientId,"] P2PChannel2.disconnectForReconnect closing P2PConnection")),this.state=Kt.Reconnecting,L("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t]=e;var n;t._videoTrack&&t._videoTrack._player&&((n=t._videoTrack._player.getVideoElement())===null||n===void 0||n.pause(),t._videoTrack._player.isKeepLastFrame=!0,t._videoTrack._originMediaStreamTrack.stop())}),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0,this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0,this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(e=>{var t;let[n,{track:i}]=e;switch(n){case ge.LocalVideoTrack:me(t=i._hints).call(t,Wt.LOW_STREAM)?i.close():this.pendingLocalTracks.push(i);break;case ge.LocalAudioTrack:i instanceof dr?this.pendingLocalTracks=this.pendingLocalTracks.concat(i.trackList):this.pendingLocalTracks.push(i);case ge.LocalVideoLowTrack:}}),this.emit(Ve.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,n]=e;Array.from(ms(n).call(n)).forEach(i=>{this.setPendingRemoteMedia(t,i)}),this.emit(Ve.MediaReconnectStart,t.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),S.debug("[".concat(this.store.clientId,"] P2PChannel2 disconnected, waiting to reconnect.")))}hasPendingRemoteMedia(e,t){for(const n of this.pendingRemoteTracks){const{user:i,kind:o}=n;if((e instanceof $l?e.uid:e)===i.uid&&t===o)return!0}return!1}setPendingRemoteMedia(e,t){this.hasPendingRemoteMedia(e,t)||this.pendingRemoteTracks.push({user:e,kind:t})}async restartICE(e,t){let n,i;if(e===js.SEND_ONLY){if(!this.sendConnection)throw new ae(P.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established.");n=await this.sendMutex.lock("From P2PChannel.restartICE"),i=this.sendConnection}else{if(!this.recvConnection)throw new ae(P.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before recvConnection established.");n=await this.recvMutex.lock("From P2PChannel.restartICE"),i=this.recvConnection}try{if(t){const o=await i.restartICE(t);return i.isInRestartIce=!1,o}{const o=await i.restartICE();if(o){const l=await ir(this,Ve.RequestP2PRestartICE,{direction:js.RECEIVE_ONLY,iceParameter:o});await i.restartICE(l),i.isInRestartIce=!1}}}finally{n()}}getUplinkNetworkQuality(){if(!this.sendConnection)return 0;const e=this.sendConnection.getStats(),t=this.localTrackMap.get(ge.LocalVideoTrack),n=this.localTrackMap.get(ge.LocalAudioTrack),i=e.videoSend.find(b=>{var D;return b.ssrc===(t==null||(D=t.ssrcs)===null||D===void 0?void 0:D[0].ssrcId)}),o=e.audioSend.find(b=>{var D;return b.ssrc===(n==null||(D=n.ssrcs)===null||D===void 0?void 0:D[0].ssrcId)});if(!i||!o)return 1;const l=Ni(this,Ve.NeedSignalRTT),d=i?i.rttMs:void 0,h=o?o.rttMs:void 0,f=d&&h?(d+h)/2:d||h,g=(f&&l?(f+l)/2:f||l)||0,_=100*e.sendPacketLossRate*.7/50+.3*g/1500,v=_<.17?1:_<.36?2:_<.59?3:_<.1?4:5,y=t==null?void 0:t.track;if(y&&y._encoderConfig&&y._hints.indexOf(Wt.SCREEN_TRACK)===-1){const b=y._encoderConfig.bitrateMax,D=e.bitrate.actualEncoded;if(b&&D){const I=(1e3*b-D)/(1e3*b);return W4[I<.15?0:I<.3?1:I<.45?2:I<.6?3:4][v]}}return v}getDownlinkNetworkQuality(){if(!this.recvConnection)return 0;const e=this.recvConnection.getStats();let t=0;return Array.from(this.remoteUserMap.entries()).forEach(n=>{let[i]=n;const o=i._audioSSRC,l=i._videoSSRC,d=e.audioRecv.find(D=>D.ssrc===o),h=e.videoRecv.find(D=>D.ssrc===l);if(!d&&!h)return void(t+=1);const f=Ni(this,Ve.NeedSignalRTT),g=e.rtt,_=(g&&f?(g+f)/2:g||f)||0,v=d?d.jitterMs:void 0,y=e.recvPacketLossRate;let b=.7*y*100/50+.3*_/1500;v&&(b=.6*y*100/50+.2*_/1500+.2*v/400),t+=b<.1?1:b<.17?2:b<.36?3:b<.59?4:5}),this.remoteUserMap.size>0?Math.round(t/this.remoteUserMap.size):t}async muteLocalTrack(e){return new be((t,n)=>{this.handleMuteLocalTrack(e,t,n)})}filterTobePublishedTracks(e,t,n){const i=[],o=wt(),l=this.getAllTracks();e=Th(e=e.filter(f=>l.indexOf(f)===-1));let d=!1,h=!1;for(const f of e){if(f instanceof on&&(this.localTrackMap.has(ge.LocalVideoTrack)||d?new ae(P.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(i.push({track:f,type:ge.LocalVideoTrack}),d=!0),t)){const g=this.getLowVideoTrack(f,n);i.push({track:g,type:ge.LocalVideoLowTrack})}if(f instanceof Mn){const g=this.localTrackMap.get(ge.LocalAudioTrack);if(g){if(!(g.track instanceof dr))throw new ae(P.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(f._bypassWebAudio)throw new ae(P.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");g.track.addAudioTrack(f),this.bindLocalAudioTrackEvents(f,!0)}else if(h){const _=i.find(v=>{let{type:y}=v;return y===ge.LocalAudioTrack});if(!(_.track instanceof dr))throw new ae(P.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(f._bypassWebAudio)throw new ae(P.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");_.track.addAudioTrack(f)}else{if(!o.webAudioMediaStreamDest||f instanceof dr||f._bypassWebAudio)i.push({track:f,type:ge.LocalAudioTrack});else{const _=new dr;_.addAudioTrack(f),i.push({track:_,type:ge.LocalAudioTrack})}h=!0}}}return i}filterTobeUnpublishedTracks(e){const t=[],n=this.getAllTracks();e=Th(e=e.filter(i=>n.indexOf(i)!==-1));for(const i of e){if(i instanceof Mn){const o=this.localTrackMap.get(ge.LocalAudioTrack);if(!o)continue;o.track instanceof dr?(o.track.removeAudioTrack(i),this.unbindLocalAudioTrackEvents(i),o.track.trackList.length===0&&(t.push([ge.LocalAudioTrack,o]),o.track.close())):t.push([ge.LocalAudioTrack,o])}if(i instanceof on){const o=this.localTrackMap.get(ge.LocalVideoTrack);if(!o)continue;t.push([ge.LocalVideoTrack,o]);const l=this.localTrackMap.get(ge.LocalVideoLowTrack);l&&t.push([ge.LocalVideoLowTrack,l])}}return t}bindLocalTrackEvents(e){e.forEach(t=>{let{track:n,type:i}=t;switch(i){case ge.LocalVideoTrack:n.addListener(Le.GET_STATS,this.handleGetLocalVideoStats),n.addListener(Le.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(Le.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(Le.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.addListener(Le.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.addListener(Le.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.addListener(Le.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(Le.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case ge.LocalAudioTrack:this.bindLocalAudioTrackEvents(n);case ge.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(e,t){e instanceof dr?e.trackList.forEach(n=>{n.addListener(Le.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(Le.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(Le.GET_STATS,this.handleGetLocalAudioStats),n.addListener(Le.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(Le.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.addListener(Le.GET_STATS,this.handleGetLocalAudioStats),e.addListener(Le.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(Le.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(Le.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(Le.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),t||e.addListener(Le.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map(t=>{let[n,{track:i}]=t;return{track:i,type:n}})),e.forEach(t=>{let{track:n,type:i}=t;switch(i){case ge.LocalVideoTrack:n.off(Le.GET_STATS,this.handleGetLocalVideoStats),n.off(Le.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.off(Le.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.off(Le.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.off(Le.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.off(Le.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.off(Le.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.off(Le.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case ge.LocalAudioTrack:this.unbindLocalAudioTrackEvents(n);case ge.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(e){e instanceof dr?e.trackList.forEach(t=>{t.off(Le.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(Le.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(Le.GET_STATS,this.handleGetLocalAudioStats),t.off(Le.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(Le.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.off(Le.GET_STATS,this.handleGetLocalAudioStats),e.off(Le.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(Le.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(Le.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(Le.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(Le.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,t){t instanceof Fh&&t.addListener(Le.GET_STATS,n=>{n(this.handleGetRemoteVideoStats(e))}),t instanceof jh&&t.addListener(Le.GET_STATS,n=>{n(this.handleGetRemoteAudioStats(e))})}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(Le.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,n]=e;n.has(xe.AUDIO)&&this.unbindRemoteTrackEvents(t._audioTrack),n.has(xe.VIDEO)&&this.unbindRemoteTrackEvents(t._videoTrack)})}createGatewayPublishMessage(e,t){return e.map((n,i)=>{var o;let l,{track:d,type:h}=n;switch(h){case ge.LocalAudioTrack:l=Xt.Audio;break;case ge.LocalVideoTrack:l=me(o=d._hints).call(o,Wt.SCREEN_TRACK)?Xt.Screen:Xt.High;break;case ge.LocalVideoLowTrack:l=Xt.Low}return{kind:h===ge.LocalAudioTrack?xe.AUDIO:xe.VIDEO,stream_type:l,mid:t[i].id,ssrcs:t[i].localSSRC,isMuted:d.muted||!d.enabled}})}createGatewayUnpublishMessage(e){return e.map(t=>{var n;let i,[o,{track:l,ssrcs:d,id:h}]=t;switch(o){case ge.LocalVideoTrack:i=me(n=l._hints).call(n,Wt.SCREEN_TRACK)?Xt.Screen:Xt.High;break;case ge.LocalAudioTrack:i=Xt.Audio;break;case ge.LocalVideoLowTrack:i=Xt.Low}return{stream_type:i,ssrcs:d,mid:h}})}assignLocalTracks(e,t){e.forEach((n,i)=>{let{track:o,type:l}=n;this.localTrackMap.set(l,{track:o,id:t[i].id,ssrcs:t[i].localSSRC})})}withdrawLocalTracks(e){e.forEach(t=>{let[n]=t;this.localTrackMap.delete(n)})}bindConnectionEvents(e){e.onConnectionStateChange=async t=>{var n;S.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: ").concat(e.name,".onConnectionStateChange(").concat(t,")")),this.emit(Ve.PeerConnectionStateChange,t),t!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),t==="connected"&&(e.isInRestartIce=!1),me(n=this._restartStates).call(n,t)&&!e.isInRestartIce&&(t==="disconnected"&&await Sr(800),e.iceConnectionState!=="disconnected"&&e.iceConnectionState!=="failed"||this.handleDisconnect(e.direction))},e.onICEConnectionStateChange=t=>{t!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),S.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(t,")")),ke.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:t,tag:an.TRACER}).onSuccess(),this.emit(Ve.IceConnectionStateChange,t)},e.onICETransportStateChange=t=>{S.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(t,")"))},e.onDTLSTransportStateChange=t=>{S.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(t,")"))},e.onDTLSTransportError=t=>{S.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(t,")"))},e.onFirstAudioDecoded=t=>{var n;const i=Array.from(ms(n=this.remoteUserMap).call(n)).find(l=>l._audioSSRC===t);var o;i&&(this.store.subscribe(i.uid,"audio",void 0,void 0,void 0,Date.now()),(o=i.audioTrack)===null||o===void 0||o.emit(ua.FIRST_FRAME_DECODED),ke.firstRemoteFrame(this.store.sessionId,Ar.FIRST_AUDIO_DECODE,wn.FIRST_AUDIO_DECODE,{peer:i._uintid,subscribeElapse:os.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=t=>{var n;const i=Array.from(ms(n=this.remoteUserMap).call(n)).find(o=>o._audioSSRC===t);i&&ke.firstRemoteFrame(this.store.sessionId,Ar.FIRST_AUDIO_RECEIVED,wn.FIRST_AUDIO_RECEIVED,{peer:i._uintid,subscribeElapse:os.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(t,n,i)=>{this.reportVideoFirstFrameDecoded(t,n,i)},e.onFirstVideoReceived=t=>{var n;const i=Array.from(ms(n=this.remoteUserMap).call(n)).find(o=>o._videoSSRC===t);i&&ke.firstRemoteFrame(this.store.sessionId,Ar.FIRST_VIDEO_RECEIVED,wn.FIRST_VIDEO_RECEIVED,{peer:i._uintid,subscribeElapse:os.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onSelectedLocalCandidateChanged=(t,n)=>{const i=t.candidateType==="relay",o=n.candidateType==="relay";n.candidateType!=="unknown"&&i===o||this.emit(Ve.ConnectionTypeChange,i),S.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(Xl(n))," -> ").concat(JSON.stringify(Xl(t)),")"))},e.onSelectedRemoteCandidateChanged=(t,n)=>{S.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(Xl(n))," -> ").concat(JSON.stringify(Xl(t)),")"))},e.onFirstVideoDecodedTimeout=t=>{this.reportVideoFirstFrameDecoded(t,void 0,void 0,!0)},e.onLocalCandidate=t=>{this.emit(Ve.LocalCandidate,{candidate:t,direction:e.direction})}}unbindConnectionEvents(e){e.onConnectionStateChange=void 0,e.onICEConnectionStateChange=void 0,e.onICETransportStateChange=void 0,e.onDTLSTransportStateChange=void 0,e.onDTLSTransportError=void 0,e.onFirstAudioDecoded=void 0,e.onFirstAudioReceived=void 0,e.onFirstVideoDecoded=void 0,e.onFirstVideoReceived=void 0,e.onSelectedLocalCandidateChanged=void 0,e.onSelectedRemoteCandidateChanged=void 0,e.onFirstVideoDecodedTimeout=void 0,e.onLocalCandidate=void 0}async handleDisconnect(e){const t=e===js.SEND_ONLY?this.sendConnection:this.recvConnection;t&&!t.isInRestartIce&&(t.isInRestartIce=!0,S.debug("[".concat(this.store.clientId,"] [P2PChannel-").concat(t.name,"] start use restartICE")),e===js.SEND_ONLY?this.restartICE(e):ir(this,Ve.RequestP2PRestartICE,{direction:js.SEND_ONLY}))}filterTobeMutedTracks(e){const t=[];if(this.getAllTracks().indexOf(e)===-1)return t;const n=this.localTrackMap.get(ge.LocalAudioTrack);if(e instanceof Mn&&(n==null?void 0:n.track)instanceof dr)return n.track.isActive||t.push([ge.LocalAudioTrack,n]),t;const i=Array.from(this.localTrackMap.entries()).find(o=>{let[,{track:l}]=o;return e===l});if(i&&(t.push(i),i[0]===ge.LocalVideoTrack)){const o=this.localTrackMap.get(ge.LocalVideoLowTrack);o&&t.push([ge.LocalVideoLowTrack,o])}return t}filterTobeUnmutedTracks(e){const t=[],n=this.localTrackMap.get(ge.LocalAudioTrack);if(e instanceof Mn&&(n==null?void 0:n.track)instanceof dr)return n.track.isActive&&t.push([ge.LocalAudioTrack,n]),t;const i=Array.from(this.localTrackMap.entries()).find(o=>{let[,{track:l}]=o;return e===l});if(i)if(i[0]===ge.LocalVideoTrack){t.push(i);const o=this.localTrackMap.get(ge.LocalVideoLowTrack);o&&t.push([ge.LocalVideoLowTrack,o])}else t.push(i);return t}createMuteMessage(e){return e.map(t=>{var n;let i,[o,{track:l,ssrcs:d,id:h}]=t;switch(o){case ge.LocalAudioTrack:i=Xt.Audio;break;case ge.LocalVideoTrack:i=me(n=l._hints).call(n,Wt.SCREEN_TRACK)?Xt.Screen:Xt.High;break;case ge.LocalVideoLowTrack:i=Xt.Low}return{stream_type:i,ssrcs:d,mid:h}})}createUnmuteMessage(e){return e.map(t=>{var n;let i,[o,{track:l,ssrcs:d,id:h}]=t;switch(o){case ge.LocalAudioTrack:i=Xt.Audio;break;case ge.LocalVideoTrack:i=me(n=l._hints).call(n,Wt.SCREEN_TRACK)?Xt.Screen:Xt.High;break;case ge.LocalVideoLowTrack:i=Xt.Low}return{stream_type:i,ssrcs:d,mid:h}})}filterTobeUnSubscribedTracks(e,t){const n=[],i=this.remoteUserMap.get(e);if(!i)return n;if(t){const o=i.get(t);if(!o)return n;n.push([e,{kind:t,id:o}])}else Array.from(i.entries()).forEach(o=>{let[l,d]=o;n.push([e,{kind:l,id:d}])});return n}createUnsubscribeMessage(e){const t=[];return e.forEach(n=>{let[i,{kind:o,id:l}]=n;switch(o){case xe.VIDEO:return void(i._videoSSRC&&t.push({stream_type:xe.VIDEO,ssrcId:i._videoSSRC}));case xe.AUDIO:return void(i._audioSSRC&&t.push({stream_type:xe.AUDIO,ssrcId:i._audioSSRC}))}}),t}withdrawRemoteTracks(e){e.forEach(t=>{let[n,{kind:i}]=t;const o=this.remoteUserMap.get(n);o&&(o.delete(i),Array.from(o.entries()).length===0&&this.remoteUserMap.delete(n))})}async updateBitrateLimit(e){const t=this.localTrackMap.get(ge.LocalVideoTrack),n=this.localTrackMap.get(ge.LocalVideoLowTrack);t&&(await t.track.setBitrateLimit(e.uplink),await new be((i,o)=>{this.handleUpdateVideoEncoder(t.track,i,o,!0)})),n&&e.low_stream_uplink&&(await n.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0}),await new be((i,o)=>{this.handleUpdateVideoEncoder(n.track,i,o,!0)}))}isP2PDisconnected(){if(this.sendConnection&&this.recvConnection){const e=this.sendConnection.peerConnectionState,t=this.recvConnection.peerConnectionState;return e!=="connected"&&t!=="connected"}return!0}async tryToUnmuteAudio(e){for(let t=0;t<e.length;t++)if(e[t]instanceof Mn){const n=this.filterTobeUnmutedTracks(e[t]);if(n.length===0)continue;const i=this.createUnmuteMessage(n);return void await ln(this,Ve.RequestUnmuteLocal,i)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=e=>this.getStats(e),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()).filter(e=>{let[,{ssrcs:t}]=e;return!!t}),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var t;return!((t=this.recvConnection)===null||t===void 0||!t.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,t)=>this.emit(Ve.RequestUpload,e,t),this.statsUploader.requestUploadStats=e=>this.emit(Ve.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await Sr(wv(this.dtlsFailedCount,qn)),this.emit(Ve.RequestReconnect)}async reconnectP2P(){}canPublishLowStream(){return this.localTrackMap.has(ge.LocalVideoTrack)||this.pendingLocalTracks.some(e=>e instanceof on)}throwIfTrackTypeNotMatch(e){if(e.filter(t=>t instanceof on).length>1)throw new ae(P.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter(t=>t instanceof Mn).length>1&&(e.some(t=>t instanceof Mn&&t._bypassWebAudio)||!wt().webAudioMediaStreamDest))throw new ae(P.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const t of e){if(t instanceof on&&this.pendingLocalTracks.some(n=>n instanceof on))throw new ae(P.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t instanceof Mn&&this.pendingLocalTracks.some(n=>n instanceof Mn)&&(!wt().webAudioMediaStreamDest||t._bypassWebAudio||this.pendingLocalTracks.some(n=>n instanceof Mn&&n._bypassWebAudio)))throw new ae(P.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,t){const n=!L("DISABLE_DUAL_STREAM_USE_ENCODING")&&wt().supportDualStreamEncoding,i=j0(j0({},{width:160,height:120,framerate:15,bitrate:50}),t);let o;o=n?e._mediaStreamTrack.clone():vI(e,i);const l=zt(8,"track-low-"),d=new on(o,j0(j0({},n&&{scaleResolutionDownBy:XR(i,e)}),{},{frameRate:i.framerate,bitrateMax:i.bitrate,bitrateMin:i.bitrate}),void 0,void 0,l);return d.on(Od.TRANSCEIVER_UPDATED,h=>{e._updateRtpTransceiver(h,Bh.LOW_STREAM)}),d._hints.push(Wt.LOW_STREAM),e.addListener(Le.NEED_CLOSE,()=>{d.close()}),d}async globalLock(){return this.recvMutex.lock("From P2PChannel2.globalLock")}reportVideoFirstFrameDecoded(e,t,n,i){var o;const l=Array.from(ms(o=this.remoteUserMap).call(o)).find(d=>d._videoSSRC===e);if(l){i||this.store.subscribe(l.uid,"video",void 0,void 0,void 0,void 0,Date.now());const d=this.store.keyMetrics,h=d.subscribe.find(f=>f.userId===l.uid&&f.type==="video");ke.firstRemoteVideoDecode(this.store.sessionId,Ar.FIRST_VIDEO_DECODE,wn.FIRST_VIDEO_DECODE,{peer:l._uintid,videowidth:t,videoheight:n,subscribeElapse:os.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:d.requestAPEnd||0,apStart:d.requestAPStart||0,joinGwEnd:d.joinGatewayEnd||0,joinGwStart:d.joinGatewayStart||0,pcEnd:d.peerConnectionEnd||0,pcStart:d.peerConnectionStart||0,subscriberEnd:(h==null?void 0:h.subscribeEnd)||0,subscriberStart:(h==null?void 0:h.subscribeStart)||0,videoAddNotify:(h==null?void 0:h.streamAdded)||0,state:i?1:0})}}async remoteMediaSsrcChanged(e,t,n){if(!this.recvConnection)return!1;const i=this.remoteUserMap.get(e);if(!i)return!1;const o=i.get(t);if(!o)return!1;const l=await this.recvConnection.getRemoteSSRC(o);return l!==void 0&&l!==n}isPreSubScribe(e){return!1}async publishDataChannel(e){throw new ae(P.NOT_SUPPORTED)}async unpublishDataChannel(e){throw new ae(P.NOT_SUPPORTED)}async subscribeDataChannel(e,t){throw new ae(P.NOT_SUPPORTED)}async unsubscribeDataChannel(e,t){throw new ae(P.NOT_SUPPORTED)}hasPendingRemoteDataChannel(e,t){throw new ae(P.NOT_SUPPORTED)}setPendingRemoteDataChannel(e,t){throw new ae(P.NOT_SUPPORTED)}async preConnect(e){throw new ae(P.NOT_SUPPORTED)}getEstablishParams(){throw new ae(P.NOT_SUPPORTED)}async reSubscribe(e){throw new ae(P.NOT_SUPPORTED)}reportVideoFirstFrameRender(e){}async updateVideoStreamParameter(e,t){throw new ae(P.NOT_SUPPORTED)}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(e=>{let[t,{track:n}]=e;t===ge.LocalVideoLowTrack?n._updateRtpTransceiver(void 0,Bh.LOW_STREAM):n._updateRtpTransceiver(void 0)})}},Ce(On.prototype,"p2pConnect",[xH],Object.getOwnPropertyDescriptor(On.prototype,"p2pConnect"),On.prototype),Ce(On.prototype,"unpublish",[DH],Object.getOwnPropertyDescriptor(On.prototype,"unpublish"),On.prototype),Ce(On.prototype,"unpublishLowStream",[BH],Object.getOwnPropertyDescriptor(On.prototype,"unpublishLowStream"),On.prototype),Ce(On.prototype,"subscribe",[kH],Object.getOwnPropertyDescriptor(On.prototype,"subscribe"),On.prototype),Ce(On.prototype,"mockSubscribe",[LH],Object.getOwnPropertyDescriptor(On.prototype,"mockSubscribe"),On.prototype),Ce(On.prototype,"unsubscribe",[UH],Object.getOwnPropertyDescriptor(On.prototype,"unsubscribe"),On.prototype),Ce(On.prototype,"muteRemote",[PH],Object.getOwnPropertyDescriptor(On.prototype,"muteRemote"),On.prototype),Ce(On.prototype,"unmuteRemote",[MH],Object.getOwnPropertyDescriptor(On.prototype,"unmuteRemote"),On.prototype),Ce(On.prototype,"hasRemoteMediaWithLock",[FH],Object.getOwnPropertyDescriptor(On.prototype,"hasRemoteMediaWithLock"),On.prototype),Ce(On.prototype,"disconnectForReconnect",[jH],Object.getOwnPropertyDescriptor(On.prototype,"disconnectForReconnect"),On.prototype),Ce(On.prototype,"remoteMediaSsrcChanged",[VH],Object.getOwnPropertyDescriptor(On.prototype,"remoteMediaSsrcChanged"),On.prototype),On);function Qo(e){return function(t,n,i){const o=t[n];if(typeof o!="function")throw new Error("Cannot use mutex on object property.");return i.value=async function(){for(var l=arguments.length,d=new Array(l),h=0;h<l;h++)d[h]=arguments[h];switch(e){case Vo.SEND_ONLY:{const f=await this.sendMutex.lock("From P2PChannel2.".concat(n));try{return await o.apply(this,d)}finally{f()}}case Vo.RECEIVE_ONLY:{const f=await this.recvMutex.lock("From P2PChannel2.".concat(n));try{return await o.apply(this,d)}finally{f()}}default:{const f=await this.sendMutex.lock("From P2PChannel2.".concat(n)),g=await this.recvMutex.lock("From P2PChannel2.".concat(n));try{return await o.apply(this,d)}finally{f(),g()}}}},i}}class Jd extends Tn{constructor(t,n){super(),x(this,"signal",void 0),x(this,"token",void 0),x(this,"tokenTimeout",void 0),x(this,"tokenInterval",void 0),x(this,"_sequence",0),x(this,"userMap",new Map),x(this,"encoder",new TextEncoder),this.signal=t,this.token=n;const i=()=>{this.signal.connectionState===Tt.CONNECTED&&this.check(),this.userMap.size===0?this.tokenInterval=window.setTimeout(i,1e3):this.tokenInterval=window.setTimeout(i,3*L("P2P_TOKEN_INTERVAL"))};i()}async send(t,n,i,o,l){var d;if(this.userMap.size===0)return;const h=Array.from(Ti(d=this.userMap).call(d))[0].token;typeof n!="string"&&(n=JSON.stringify(n)),o=o??zt(6,""),l=l??this._sequence++;const f={_id:o,_type:t,_seq:l,_message:n,token:"".concat(this.token,"_").concat(h)};L("SHOW_P2P_LOG")&&S.debug("send message",f,"noNeedResponse : ".concat(i)),this.splitMessage(JSON.stringify(f)).forEach(_=>{this.signal.request(je.DATA_STREAM,{payload:Kl(this.encoder.encode(_))})});const g=new be((_,v)=>{const y=window.setTimeout(()=>{this.off("res-@".concat(o,"_ack"),b),this.off("res-@".concat(o),I),this.off(Kh.ABORT,D),S.debug("[external-signal] request timeout, type: ".concat(t,", requestId: ").concat(o)),this.userMap.size===0?v(new ae(P.INVALID_REMOTE_USER)):v(new ae(P.TIMEOUT))},L("EXTERNAL_SIGNAL_REQUEST_TIMEOUT")),b=()=>{y&&window.clearTimeout(y),this.off(Kh.ABORT,D),i&&_()},D=()=>{y&&window.clearTimeout(y),this.off("res-@".concat(o,"_ack"),b),this.off("res-@".concat(o),I),v(new ae(P.EXTERNAL_SIGNAL_ABORT,"type: ".concat(t,", requestId: ").concat(o)))};this.once(Kh.ABORT,D),this.once("res-@".concat(o,"_ack"),b);const I=(U,j)=>{O=!0,y&&window.clearTimeout(y),this.off("res-@".concat(o,"_ack"),b),this.off(Kh.ABORT,D),U==="success"?_(j):v(new ae(P.P2P_MESSAGE_FAILED,"request ".concat(t," failed, requestId: ").concat(o)))};let O=!1;i||(this.once("res-@".concat(o),I),Sr(L("SIGNAL_REQUEST_TIMEOUT")).then(()=>{O||S.warning("external_signal request timeout, type: ".concat(t,", requestId: ").concat(o,", ").concat(f))}))});try{return await g}catch(_){if(_.code===P.TIMEOUT)return await this.send(t,n,i,o,l);throw _}}onMessage(t){var n;const{_uid:i}=t;let o,l=this.userMap.get(i);if(l)o=l.splitMessageMap;else{if(this.userMap.size>0||!("_type"in t)||t._type!==Kn.CHECK)return;const{token:g}=t;o=new Map,l={uid:i,isStart:!0,token:g,splitMessageMap:o,nextExpectedSequenceNumber:0,receivedMessagesMap:new Map},this.userMap.set(i,l),this.signal.emit(nt.ON_USER_ONLINE,{uid:i}),this.handleUserOnline()}if("id"in t&&"total"in t){var d;const{id:g,total:_}=t,v=(d=o.get(g))!==null&&d!==void 0?d:[];if(v.push(t),o.has(g)||o.set(g,v),v.length!==_)return;{const y=Ad(v).call(v,(b,D)=>b.index-D.index).map(b=>b.payload).join("");o.delete(g),(t=JSON.parse(y))._uid=i}}const{_type:h,token:f}=t;if(me(n=[Kn.ACK,Kn.CHECK]).call(n,h))return h===Kn.CHECK&&this.handleCheckToken(l,f),void this.receiveMessage(t);f==="".concat(l.token,"_").concat(this.token)?this.handleReceivedMessage(t):S.debug('Receive unexpected message", '.concat(f,", cur_token: ").concat(l.token,"_").concat(this.token),t)}check(){const t={_id:zt(6,""),token:this.token,_type:Kn.CHECK};L("SHOW_P2P_LOG")&&S.debug("send message",t),this.signal.request(je.DATA_STREAM,{payload:Kl(this.encoder.encode(JSON.stringify(t)))})}ack(t){const n={_id:t,_type:Kn.ACK,token:this.token};L("SHOW_P2P_LOG")&&S.debug("send message",n),this.signal.request(je.DATA_STREAM,{payload:Kl(this.encoder.encode(JSON.stringify(n)))})}response(t,n,i){this.send(Kn.RESPONSE,JSON.stringify({success:!i,message:n}),!0,t)}handleReceivedMessage(t){const n=()=>{this.userMap.forEach(g=>{const{receivedMessagesMap:_,nextExpectedSequenceNumber:v}=g;for(;_.has(v);){const y=_.get(v);_.delete(v),this.receiveMessage(y),g.nextExpectedSequenceNumber++}})};if(!t)return void n();const{_uid:i,_seq:o}=t,l=this.userMap.get(i),{receivedMessagesMap:d,isStart:h,nextExpectedSequenceNumber:f}=l;if(o<f)return this.ack(t._id),void S.debug("[external-signal] receive old message, seq: ".concat(o,", ").concat(t._message));d.set(o,t),h&&o===f&&(this.receiveMessage(t),d.delete(f),l.nextExpectedSequenceNumber++,n())}receiveMessage(t){const{_id:n,_type:i,_message:o,_uid:l}=t;if(L("SHOW_P2P_LOG")&&S.debug("receive message",t),n){let d;switch(t._type!==Kn.ACK&&(o&&(d=JSON.parse(o)),this.ack(t._id)),t._type){case Kn.CANDIDATE:case Kn.CONTROL:this.signal.emit(i,d,l);break;case Kn.PUBLISH:case Kn.UNPUBLISH:case Kn.RESTART_ICE:case Kn.CALL:d.uid=l,ir(this.signal,i,d).then(h=>{this.response(t._id,h)}).catch(()=>{this.response(t._id,void 0,!0)});break;case Kn.ACK:this.getListeners("res-@".concat(n,"_ack")).length>0&&this.emit("res-@".concat(n,"_ack"));break;case Kn.RESPONSE:{const{success:h,message:f}=d;this.emit("res-@".concat(n),h?"success":"failed",f);break}}}}splitMessage(t){if(t.length<Jd.MAX_MESSAGE_SIZE)return[t];const n=[],{remoteToken:i}=JSON.parse(t),o=zt(6,"");let l=0,d=800;const h=Math.ceil(t.length/d);for(;t.length>0;){l++;const f={id:o,index:l,total:h,payload:t.slice(0,d),token:"".concat(this.token,"_").concat(i)};JSON.stringify(f).length>Jd.MAX_MESSAGE_SIZE?d-=50:(n.push(f),t=t.slice(d))}return n.map(f=>JSON.stringify(f))}handleCheckToken(t,n){return t.token!==n?(S.debug("token changed, from ".concat(t.token," to ").concat(n)),this.reset(t.uid,n),!1):(this.tokenTimeout&&(window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0),this.tokenTimeout=window.setTimeout(()=>{S.debug("token timeout, ".concat(n)),this.reset(t.uid)},L("MAX_P2P_TIMEOUT")),!0)}async handleUserOnline(){const t=await ir(this.signal,Kn.CALL,void 0),n=await this.send(Kn.CALL,t);this.signal.emit(Ue.P2P_CONNECTION,n,!0)}async reset(t,n){const i=this.userMap.get(t);i&&(this.emit(Kh.ABORT),this.signal.emit(nt.ON_USER_OFFLINE,{uid:i.uid,reason:Hle.P2P_TOKEN_CHANGED}),this._sequence=0,this.userMap.clear(),n||(S.debug("change local token from ".concat(n," to ").concat(n)),this.token=zt(6,"")))}clear(){this._sequence=0,this.userMap.clear(),this.tokenInterval&&window.clearTimeout(this.tokenInterval),this.tokenInterval=void 0,this.tokenTimeout&&window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0,this.emit(Kh.ABORT)}}x(Jd,"MAX_SIZE",1),x(Jd,"MAX_MESSAGE_SIZE",1024);class Iue extends Tn{get connectionState(){return this._connectionState}set connectionState(t){t!==this._connectionState&&(this._connectionState=t,t===Tt.CONNECTED?this.emit(Ue.WS_CONNECTED):t===Tt.RECONNECTING?this.emit(Ue.WS_RECONNECTING,this._websocketReconnectReason):t===Tt.CLOSED&&this.emit(Ue.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(t,n){super(),x(this,"__name__","P2PSignal"),x(this,"_disconnectedReason",void 0),x(this,"_websocketReconnectReason",void 0),x(this,"_connectionState",Tt.CLOSED),x(this,"reconnectToken",void 0),x(this,"p2pToken",void 0),x(this,"websocket",void 0),x(this,"openConnectionTime",void 0),x(this,"clientId",void 0),x(this,"lastMsgTime",Date.now()),x(this,"uploadCache",[]),x(this,"uploadCacheInterval",void 0),x(this,"rttRolling",new ZT(5)),x(this,"pingpongTimer",void 0),x(this,"pingpongTimeoutCount",0),x(this,"joinResponse",void 0),x(this,"multiIpOption",void 0),x(this,"initError",void 0),x(this,"spec",void 0),x(this,"store",void 0),x(this,"_external_signal",void 0),x(this,"onWebsocketMessage",i=>{if(i.data instanceof ArrayBuffer)return void this.emit(Ue.ON_BINARY_DATA,i.data);const o=JSON.parse(i.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(o,"_id")){const l="res-@".concat(o._id);this.emit(l,o._result,o._message)}else if(Object.prototype.hasOwnProperty.call(o,"_type")){switch(o._type){case nt.ON_DATA_STREAM:return void this.handleDataStream(o._message);case nt.MUTE_AUDIO:case nt.MUTE_VIDEO:case nt.ON_P2P_LOST:case nt.ON_USER_ONLINE:return;case nt.ON_USER_OFFLINE:const{uid:l}=o._message;return S.debug("[".concat(this.clientId,"] user-offline uid: ").concat(l)),void this._external_signal.reset(l)}if(this.emit(o._type,o._message),o._type===nt.ON_NOTIFICATION&&this.handleNotification(o._message),o._type===nt.ON_USER_BANNED)switch(o._message.error_code){case 14:this.close(Ct.UID_BANNED);break;case 15:this.close(Ct.IP_BANNED);break;case 16:this.close(Ct.CHANNEL_BANNED)}if(o._type===nt.ON_USER_LICENSE_BANNED)switch(o._message.error_code){case Ke.ERR_LICENSE_MISSING:this.close(Ct.LICENSE_MISSING);break;case Ke.ERR_LICENSE_EXPIRED:this.close(Ct.LICENSE_EXPIRED);break;case Ke.ERR_LICENSE_MINUTES_EXCEEDED:this.close(Ct.LICENSE_MINUTES_EXCEEDED);break;case Ke.ERR_LICENSE_PERIOD_INVALID:this.close(Ct.LICENSE_PERIOD_INVALID);break;case Ke.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(Ct.LICENSE_MULTIPLE_SDK_SERVICE);break;case Ke.ERR_LICENSE_ILLEGAL:this.close(Ct.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=t.clientId,this.spec=t,this.store=n,this.websocket=new YR("gateway-".concat(this.clientId),this.spec.retryConfig,!0,L("JOIN_GATEWAY_USE_DUAL_DOMAIN"),L("JOIN_GATEWAY_USE_443PORT_ONLY"),n),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===Tt.CONNECTED&&this.reconnect("retry",Jr.OFFLINE)}),this.p2pToken=zt(6,""),this._external_signal=new Jd(this,this.p2pToken)}async request(t,n,i,o){const l=zt(6,""),d={_id:l,_type:t,_message:n},h=this.websocket.connectionID,f=()=>new be((D,I)=>{if(this.connectionState===Tt.CONNECTED)return D();const O=()=>{this.off(Ue.WS_CLOSED,U),D()},U=()=>{this.off(Ue.WS_CONNECTED,O),I(new ae(P.WS_ABORT))};this.once(Ue.WS_CONNECTED,O),this.once(Ue.WS_CLOSED,U)});if(this.connectionState!==Tt.CONNECTING&&this.connectionState!==Tt.RECONNECTING||t===je.JOIN||t===je.REJOIN||await f(),this.websocket.sendMessage(d,!0),o)return;const g=new be((D,I)=>{let O=!1;const U=(G,$)=>{O=!0,D({isSuccess:G==="success",message:$||{}}),this.off(Ue.WS_CLOSED,j),this.off(Ue.WS_RECONNECTING,j),this.emit(Ue.REQUEST_SUCCESS,t,n)};this.once("res-@".concat(l),U);const j=()=>{I(new ae(P.WS_ABORT,"type: ".concat(t))),this.off(Ue.WS_CLOSED,j),this.off(Ue.WS_RECONNECTING,j),this.off("res-@".concat(l),U)};this.once(Ue.WS_CLOSED,j),this.once(Ue.WS_RECONNECTING,j),Sr(L("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==h||O||(S.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(t)),this.emit(Ue.REQUEST_TIMEOUT,t,n))})});let _=null;try{_=await g}catch(D){if(this.connectionState===Tt.CLOSED||t===je.LEAVE)throw new ae(P.WS_ABORT);return!this.spec.forceWaitGatewayResponse||i?D.throw():t===je.JOIN||t===je.REJOIN?null:(await f(),await this.request(t,n))}if(_.isSuccess)return _.message;const v=Number(_.message.error_code||_.message.code),y=Md(v),b=new ae(P.UNEXPECTED_RESPONSE,"".concat(y.desc,": ").concat(_.message.error_str),{code:v,data:_.message,desc:y.desc});return y.action==="success"?_.message:(S.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(t,", error_code: ").concat(v,", message: ").concat(y.desc,", action: ").concat(y.action)),v===Ke.ERR_TOO_MANY_BROADCASTERS?((t===je.JOIN||t===je.REJOIN)&&(this.initError=b,this.close()),b.throw()):y.action==="failed"?b.throw():y.action==="quit"?(this.initError=b,this.close(),b.throw()):(v===Ke.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=_.message.option,S.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",Jr.MULTI_IP)):this.reconnect(y.action,Jr.SERVER_ERROR),t===je.JOIN||t===je.REJOIN?null:await this.request(t,n)))}waitMessage(t,n){return new be(i=>{const o=l=>{(!n||n(l))&&(this.off(t,o),i(l))};this.on(t,o)})}uploadWRTCStats(t){if(!this.store.sessionId)return void S.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const n={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:t};this.upload(Pd.WRTC_STATS,n)}upload(t,n){const i={_type:t,_message:n};try{this.websocket.sendMessage(i)}catch{const l=L("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(i),this.uploadCache.length>l&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==Tt.CONNECTED)return;const d=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(d._type,d._message)},L("UPLOAD_CACHE_INTERVAL")||2e3))}}send(t,n){const i={_type:t,_message:n};this.websocket.sendMessage(i)}async sendExtensionMessage(t,n,i){return await this._external_signal.send(t,n,i)}init(t){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new be((n,i)=>{this.once(Ue.WS_CONNECTED,()=>n(this.joinResponse)),this.once(Ue.WS_CLOSED,()=>i(this.initError||new ae(P.WS_ABORT))),this.connectionState=Tt.CONNECTING,this.websocket.init(t).catch(i)})}close(t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._external_signal.clear(),this._disconnectedReason=t||Ct.LEAVE,this.connectionState=Tt.CLOSED,S.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),this.p2pToken=zt(6,""),this._external_signal.clear(),this._external_signal=new Jd(this,this.p2pToken)}async join(){if(!this.joinResponse){this.emit(Ue.ABORT_P2P_EXECUTION);const t=await ir(this,Ue.REQUEST_JOIN_INFO),n=await this.request(je.JOIN,t);if(!n)return this.emit(Ue.REPORT_JOIN_GATEWAY,P.TIMEOUT,this.url||""),!1;this.joinResponse=n,this.emit(Ue.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=Tt.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}reconnect(t,n){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(t,n)}async downgradeCodec(t){return!1}handleDataStream(t){try{var n;const i=Cd(t.payload),o=new TextDecoder().decode(i),l=JSON.parse(o);"total"in l&&"id"in l||me(n=Object.values(Kn)).call(n,l._type)?(l._uid=t.uid,this._external_signal.onMessage(l)):this.emit(nt.ON_DATA_STREAM,t)}catch{this.emit(nt.ON_DATA_STREAM,t)}}handleNotification(t){S.debug("[".concat(this.clientId,"] receive notification: "),t);const n=Md(t.code);if(n.action!=="success"){if(n.action!=="failed")return n.action==="quit"?t.code===Ke.ERR_REPEAT_JOIN_CHANNEL&&L("IGNORE_UID_CHECK")?void this.close(Ct.UID_CONFLICT):(n.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(Ct.UID_BANNED),void this.close()):void this.reconnect(n.action,Jr.SERVER_ERROR);S.error("[".concat(this.clientId,"] ignore error: "),n.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const t=L("PING_PONG_TIME_OUT"),n=Date.now();this.pingpongTimeoutCount>=t&&(S.warning("[".concat(this.clientId,"] PINGPONG Timeout. Last Socket Message: ").concat(n-this.lastMsgTime,"ms")),n-this.lastMsgTime>L("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",Jr.TIMEOUT):this.request(je.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const i=Date.now()-n;this.rttRolling.add(i),L("REPORT_STATS")&&this.send(je.PING_BACK,{pingpongElapse:i})}).catch(i=>{})}handleWebsocketEvents(){this.websocket.on(lt.RECONNECT_CREATE_CONNECTION,t=>{this.emit(Ue.WS_RECONNECT_CREATE_CONNECTION,t)}),this.websocket.on(lt.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(lt.CLOSED,()=>{this.connectionState=Tt.CLOSED}),this.websocket.on(lt.FAILED,()=>{this._disconnectedReason=Ct.NETWORK_ERROR,this.connectionState=Tt.CLOSED}),this.websocket.on(lt.RECONNECTING,t=>{this._websocketReconnectReason=t,this.joinResponse=void 0,this.connectionState===Tt.CONNECTED?this.connectionState=Tt.RECONNECTING:this.connectionState=Tt.CONNECTING}),this.websocket.on(lt.WILL_RECONNECT,(t,n,i)=>{t!=="retry"?(S.debug("".concat(this.clientId," websocket will_connect event, renewSession reconnectMode is ").concat(t)),this.reconnectToken=void 0):S.debug("".concat(this.clientId," reconnect mode is retry, no need to renew session")),i(t)}),this.websocket.on(lt.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.join().catch(t=>{if(this.emit(Ue.REPORT_JOIN_GATEWAY,t,this.url||""),t instanceof ae&&t.code===P.UNEXPECTED_RESPONSE&&t.data.code===Ke.ERR_NO_AUTHORIZED)return S.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",Jr.SERVER_ERROR);S.error("[".concat(this.clientId,"] join gateway request failed"),t.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",Jr.SERVER_ERROR):(this.initError=t,this.close())})}),this.websocket.on(lt.REQUEST_NEW_URLS,(t,n)=>{ir(this,Ue.REQUEST_RECOVER,this.multiIpOption).then(t).catch(n)}),this.websocket.on(lt.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(nt.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})}}const Nue={name:"P2PChannel",create:function(e){let{store:t,statsCollector:n}=e;return new Rue(t,n)},createSubmodule:function(e){let{store:t,spec:n}=e;return new Iue(n,t)}};function HH(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}function GH(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?HH(Object(n),!0).forEach(function(i){x(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):HH(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}class Oue{constructor(t){x(this,"sessionDesc",void 0),x(this,"localCapabilities",void 0),x(this,"rtpCapabilities",void 0),x(this,"candidates",void 0),x(this,"_originCandidates",void 0),x(this,"iceParameters",void 0),x(this,"dtlsParameters",void 0),x(this,"setup",void 0),x(this,"currentMidIndex",void 0),x(this,"cname",void 0),t=_n(t);const{iceParameters:n,dtlsParameters:i,candidates:o,rtpCapabilities:l,setup:d,localCapabilities:h,sdkCodec:f,cname:g}=t,_=Ps(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE audio video
a=msid-semantic: WMS
a=ice-lite
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:audio
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:video
`);this.rtpCapabilities=l,this.candidates=o,this._originCandidates=_n(o),this.iceParameters=n,this.dtlsParameters=i,this.setup=d,this.localCapabilities=h,this.cname=g;for(let v=0;v<_.mediaDescriptions.length;v++){const y=_.mediaDescriptions[v];if(y.attributes.iceUfrag=n.iceUfrag,y.attributes.icePwd=n.icePwd,y.attributes.fingerprints=i.fingerprints,y.attributes.candidates=o,y.attributes.setup=d,y.media.mediaType==="video"){y.media.fmts=l.videoCodecs.map(I=>I.payloadType.toString(10));const b=l.videoCodecs.filter(I=>{var O,U;return(O=I.rtpMap)===null||O===void 0?void 0:me(U=O.encodingName.toLowerCase()).call(U,f)}),D=l.videoCodecs.filter(I=>!me(b).call(b,I));y.attributes.payloads=[...b,...D],y.attributes.extmaps=l.videoExtensions}y.media.mediaType==="audio"&&(y.media.fmts=l.audioCodecs.map(b=>b.payloadType.toString(10)),y.attributes.payloads=l.audioCodecs,y.attributes.extmaps=l.audioExtensions),_.mediaDescriptions[v]=this.mungMediaDesc(y)}this.sessionDesc=_,this.currentMidIndex=_.mediaDescriptions.length-1}toString(){return Yc(this.sessionDesc)}send(t,n,i){const{ssrcs:o,ssrcGroups:l}=Dm(n,this.cname),d=this.sessionDesc.mediaDescriptions.find(g=>t===xe.VIDEO?g.media.mediaType==="video":g.media.mediaType==="audio"),h=o[0].attributes.label,f=o[0].attributes.mslabel;return d.attributes.ssrcs=d.attributes.ssrcs.concat(o),d.attributes.ssrcGroups=d.attributes.ssrcGroups.concat(l),{id:h,mslabel:f}}batchSend(t){return t.map(n=>{let{kind:i,ssrcMsg:o}=n;return this.send(i,o,void 0)})}stopSending(t){this.sessionDesc.mediaDescriptions.forEach(n=>{const i=[],o=[],l=[];n.attributes.ssrcs.forEach(d=>{me(t).call(t,d.attributes.label||"")?l.push(d):i.push(d)}),n.attributes.ssrcGroups.forEach(d=>{var h;me(h=l.map(f=>f.ssrcId)).call(h,d.ssrcIds[0])||o.push(d)}),n.attributes.ssrcs=i,n.attributes.ssrcGroups=o})}mute(t){const n=this.sessionDesc.mediaDescriptions.find(i=>i.attributes.mid===t);if(!n)throw new Error("mediaDescription not found with ".concat(t," in remote SDP when calling RemoteSDP.mute."));n.attributes.direction="inactive"}unmute(t){const n=this.sessionDesc.mediaDescriptions.find(i=>i.attributes.mid===t);if(!n)throw new Error("mediaDescription not found with ".concat(t," in remote SDP when calling RemoteSDP.unmute."));n.attributes.direction="sendonly"}receive(t,n,i){t.forEach((o,l)=>{const d=o._mediaStreamTrack,h=this.sessionDesc.mediaDescriptions.findIndex(g=>g.attributes.mid===d.kind),f=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[h],o);this.sessionDesc.mediaDescriptions[h]=f})}stopReceiving(t){}updateCandidates(t){const n=this._originCandidates.filter(o=>o.transport==="udp"),i=[];if(n.forEach(o=>{i.push(GH(GH({},o),{},{foundation:"tcpcandidate",priority:Number(o.priority)-1+"",transport:"tcp",port:Number(o.port)+90+""}))}),n.length!==0){switch(t){case Ur.TCP_RELAY:this.candidates=i;break;case Ur.UDP_TCP_RELAY:case Ur.RELAY:this.candidates=[...n,...i];break;default:this.candidates=n}for(const o of this.sessionDesc.mediaDescriptions)o.attributes.candidates=this.candidates}}restartICE(t){t=_n(t),this.iceParameters=t,this.sessionDesc.mediaDescriptions.forEach(n=>{n.attributes.iceUfrag=t.iceUfrag,n.attributes.icePwd=t.icePwd})}predictReceivingMids(t){const n=[];for(let i=0;i<t;i++)n.push((this.currentMidIndex+i+1).toString(10));return n}mungRecvMediaDsec(t,n){const i=_n(t);return Fd(i,n),ZR(i,n),i}updateRecvMedia(t,n){const i=this.sessionDesc.mediaDescriptions.findIndex(o=>o.attributes.mid===t);if(i!==-1){const o=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[i],n);this.sessionDesc.mediaDescriptions[i]=o}}bumpMid(t){this.currentMidIndex+=t}updateTrackLabel(t,n,i){const o=this.sessionDesc.mediaDescriptions.find(d=>t===xe.VIDEO?d.attributes.mid==="video":d.attributes.mid==="audio");if(o){const d=o.attributes.ssrcs.find(h=>h.attributes.label===n);var l;d&&(d.attributes.label=i,(l=d.attributes.msid)===null||l===void 0||l.replace(n,i))}}mungMediaDesc(t){const n=_n(t);return $R(n),function(i){const o=i.attributes.extmaps.find(l=>r0(l.extensionName));o&&i.attributes.extmaps.splice(i.attributes.extmaps.indexOf(o),1),i.attributes.payloads.forEach(l=>{const d=l.rtcpFeedbacks.findIndex(h=>h.type==="transport-cc");d!==-1&&l.rtcpFeedbacks.splice(d,1)})}(n),n}getSSRC(t){for(const n of this.sessionDesc.mediaDescriptions)for(const i of n.attributes.ssrcs)if(i.attributes.label===t)return[i]}}var An;function KH(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}function V0(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?KH(Object(n),!0).forEach(function(i){x(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):KH(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}let xue=(An=class Ig extends $v{get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.videoCodecs.map(t=>t.rtpMap&&t.rtpMap.encodingName.toLowerCase()||"").filter(t=>{var n;return me(n=Object.keys(Id)).call(n,t)}))]}constructor(t,n){super(t,n),x(this,"store",void 0),x(this,"peerConnection",void 0),x(this,"remoteSDP",void 0),x(this,"initialOffer",void 0),x(this,"statsFilter",void 0),x(this,"useRTX",!1),x(this,"localCapabilities",void 0),x(this,"localCandidateCount",0),x(this,"allCandidatesReceived",!1),x(this,"establishPromise",void 0),x(this,"mutex",void 0),this.store=n,this.mutex=new Lr("P2PConnection-mutex",n.clientId),this.peerConnection=new RTCPeerConnection(Ig.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.statsFilter=Tv(this.peerConnection,L("STATS_UPDATE_INTERVAL"),void 0,gn()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(){try{const t=await this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});if(!t.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const n=_c(t.sdp),i=xm(t.sdp,{filterRTX:!this.useRTX,filterVideoFec:L("FILTER_VIDEO_FEC"),filterAudioFec:L("FILTER_AUDIO_FEC"),filterAudioCodec:["opus"]});return this.localCapabilities=i,this.initialOffer=t,V0(V0({},n),{},{rtpCapabilities:{send:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},recv:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},sendrecv:i},offerSDP:t.sdp})}catch(t){throw new ae(P.GET_LOCAL_CONNECTION_PARAMS_FAILED,t.toString())}}async updateRemoteConnect(){}async connect(t){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new Oue(V0(V0({},t),{},{rtpCapabilities:t.rtpCapabilities.send,localCapabilities:this.localCapabilities,sdkCodec:this.store.codec}));const n=this.remoteSDP.toString();await this.peerConnection.setLocalDescription(this.initialOffer),await this.peerConnection.setRemoteDescription({type:"answer",sdp:n})}catch(n){throw new ae(P.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(n.toString()))}}async updateRemoteRTPCapabilities(t,n){throw new ae(P.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}getPreMedia(t){}send(t,n){var i=this;return qs(function*(){const o=yield ft(i.mutex.lock());try{if(!i.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const l=t.map(y=>i.peerConnection.addTrack(y._mediaStreamTrack)),d=yield ft(i.peerConnection.createOffer()),h=Ps(d.sdp),f=t.map(y=>{const b=y._mediaStreamTrack,D=h.mediaDescriptions.find(I=>I.attributes.mid===b.kind);if(!D)throw new Error("Cannot extract ssrc from mediaDescription.");return function(I,O,U){const j=I.attributes.ssrcs.filter($=>$.attributes.label===O),G=I.attributes.ssrcGroups;if(j.length===0)throw new Error("Cannot extract ssrc from plan-b SDP.");if(G&&j.length>1){const $=G.find(Z=>Z.ssrcIds.indexOf(j[0].ssrcId)!==-1);return $?[{ssrcId:$.ssrcIds[0],rtx:U?$.ssrcIds[1]:void 0}]:[{ssrcId:j[0].ssrcId}]}return[{ssrcId:j[0].ssrcId}]}(D,b.id,i.useRTX)});let g;try{g=yield f}catch(y){throw l.forEach(b=>{kr()&&b.replaceTrack(null),i.peerConnection.removeTrack(b)}),y}const _=i.mungSendOfferSDP(d.sdp,t);i.remoteSDP.receive(t,n,g);const v=i.remoteSDP.toString();return yield ft(i.peerConnection.setLocalDescription({type:"offer",sdp:_})),yield ft(i.applySendEncodings(l,t)),yield ft(i.peerConnection.setRemoteDescription({type:"answer",sdp:v})),t.map((y,b)=>{const D=y._mediaStreamTrack.id;return{localSSRC:f[b],id:D}})}catch(l){throw new ae(P.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(l.toString()))}finally{o()}})()}async stopSending(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const n=this.peerConnection.getSenders().filter(l=>{var d;return t.indexOf(((d=l.track)===null||d===void 0?void 0:d.id)||"")!==-1});if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");n.map(l=>{kr()&&l.replaceTrack(null),this.peerConnection.removeTrack(l)});const i=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(i),this.remoteSDP.stopReceiving(t);const o=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:o})}catch(n){throw new ae(P.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(n.toString()))}}async receive(t,n,i,o){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));const{id:l,mslabel:d}=this.remoteSDP.send(t,n,o),h=new be((_,v)=>{const y=setTimeout(()=>{v(new Error("Cannot receive track, id: ".concat(l)))},1e4),b=D=>{const I=Lt();if((I.name==="Safari"&&Number(I.version)===11||fs())&&D.track.id!==l&&D.streams[0].id===d){var O;const U=D.streams[0].getTracks()[0];return(O=this.remoteSDP)===null||O===void 0||O.updateTrackLabel(t,l,D.track.id),this.peerConnection.removeEventListener("track",b),clearTimeout(y),void _(U)}if(D.track.id===l)return this.peerConnection.removeEventListener("track",b),clearTimeout(y),void _(D.track)};this.peerConnection.addEventListener("track",b)}),f=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:f});const g=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(g),{track:await h,id:l}}catch(l){throw new ae(P.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(l.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(t);const n=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const i=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(i)}catch(n){throw new ae(P.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}async muteRemote(t){}async unmuteRemote(t){}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const n=this.peerConnection.getSenders().filter(i=>{var o;return t.indexOf(((o=i.track)===null||o===void 0?void 0:o.id)||"")!==-1});if(n.length!==t.length)throw new Error("sender' length doesn't match mids' length.");n.map(i=>{if(kr()&&i.track)i.track.enabled=!1;else{const o=i.getParameters();o.encodings.forEach(l=>l.active=!1),i.setParameters(o)}})}catch(n){throw new ae(P.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(n.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const n=this.peerConnection.getSenders().filter(l=>{var d;return t.indexOf(((d=l.track)===null||d===void 0?void 0:d.id)||"")!==-1});if(n.length!==t.length)throw new Error("Senders' length doesn't match mids' length.");n.map(async l=>{if(kr()&&l.track)l.track.enabled=!0;else{const d=l.getParameters();d.encodings.forEach(h=>h.active=!0),await l.setParameters(d)}});const i=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(i);const o=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:o})}catch(n){throw new ae(P.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(n.toString()))}}restartICE(t){var n=this;return qs(function*(){const i=yield ft(n.mutex.lock("From P2PConnection.restartICE"));try{if(!n.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const o=wt().supportPCSetConfiguration;if(t===Ur.RELAY&&!o)return;if(o){const g=n.peerConnection.getConfiguration(),_=t===Ur.RELAY?"relay":"all";g.iceTransportPolicy!==_&&(S.debug("[".concat(n.store.clientId,"] restartICE change iceTransportPolicy from [").concat(g.iceTransportPolicy,"] to [").concat(_,"]")),g.iceTransportPolicy=_,n.peerConnection.setConfiguration(g))}t!==Ur.RELAY&&n.remoteSDP.updateCandidates(t);const l=yield ft(n.peerConnection.createOffer({iceRestart:!0}));if(!l.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const d=_c(l.sdp),{remoteIceParameters:h}=yield d.iceParameters;n.remoteSDP.restartICE(h);const f=n.remoteSDP.toString();yield ft(n.peerConnection.setLocalDescription(l)),yield ft(n.peerConnection.setRemoteDescription({type:"answer",sdp:f}))}catch(o){S.warning("[".concat(n.store.clientId,"] restart ICE failed, abort operation"),o)}finally{i()}})()}close(){var t;this.peerConnection.close(),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const i=await this.peerConnection.createOffer(),o=this.mungSendOfferSDP(i.sdp,[n]);this.remoteSDP.updateRecvMedia(n._mediaStreamTrack.kind,n);const l=this.remoteSDP.toString();await this.peerConnection.setLocalDescription({type:"offer",sdp:o}),await this.peerConnection.setRemoteDescription({type:"answer",sdp:l})}catch(i){throw new ae(P.EXCHANGE_SDP_FAILED,i.toString())}}async updateSendParameters(t,n){const i=this.peerConnection.getSenders().filter(o=>{var l;return((l=o.track)===null||l===void 0?void 0:l.id)===t});i.length===1&&await this.applySendEncodings(i,[n])}setStatsRemoteVideoIsReady(t,n){this.statsFilter.setVideoIsReady2(t,n)}async replaceTrack(t,n){const i=this.peerConnection.getSenders().find(o=>{var l;return((l=o.track)===null||l===void 0?void 0:l.id)===n});i&&await i.replaceTrack(t._mediaStreamTrack)}createDataChannels(t,n){throw new ae(P.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}stopDataChannels(t){throw new ae(P.NOT_SUPPORTED,"Planb mode does not support stopDataChannels.")}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t;(t=this.onICEConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=t=>{t.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,S.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,S.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},L("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){const n={iceServers:[],sdpSemantics:"plan-b"};return t.iceServers?n.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(yd(t.turnServer.servers)?n.iceServers=t.turnServer.servers:(n.iceServers&&n.iceServers.push(...Ig.turnServerConfigToIceServers(t.turnServer.servers)),L("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&t.turnServer.serversFromGateway&&n.iceServers.push(...Ig.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(i=>{i.forceturn&&(n.iceTransportPolicy="relay")}))),n}static turnServerConfigToIceServers(t){const n=[];return t.forEach(i=>{i.security?i.tcpport&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turns:".concat(i.turnServerURL,":").concat(i.tcpport,"?transport=tcp")}):(i.udpport&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.udpport,"?transport=udp")}),i.tcpport&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.tcpport,"?transport=tcp")}))}),n}async updateRtpSenderEncodings(t,n){var i;if(n||(n=this.peerConnection.getSenders().find(g=>{var _;return((_=g.track)===null||_===void 0?void 0:_.id)===t._mediaStreamTrack.id})),!n)return S.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(!wt().supportSetRtpSenderParameters)return S.warn("Browser not support set rtp-sender parameters");const o={},l={};if(t instanceof on)switch(t._optimizationMode){case"motion":o.degradationPreference="maintain-framerate";break;case"detail":o.degradationPreference="maintain-resolution";break;default:o.degradationPreference="balanced"}if(L("DSCP_TYPE")&&uc()){var d;const g=L("DSCP_TYPE");me(d=["very-low","low","medium","high"]).call(d,g)&&(l.networkPriority=g)}const h=n.getParameters(),f=(i=h.encodings)===null||i===void 0?void 0:i[0];f&&Object.assign(f,l),Object.assign(h,o),S.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(h.encodings))),await n.setParameters(h)}async applySendEncodings(t,n){try{if(!wt().supportSetRtpSenderParameters||t.length!==n.length)return;for(let i=0;i<t.length;i++){const o=t[i],l=n[i];o&&l&&await this.updateRtpSenderEncodings(l,o)}}catch{S.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,n){const i=Ps(t);return n.forEach((o,l)=>{const d=o._mediaStreamTrack,h=i.mediaDescriptions.find(f=>f.attributes.mid===d.kind);h&&Fd(h,o)}),Yc(i)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var n;(n=this.onFirstAudioReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var n;(n=this.onFirstVideoReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var n;(n=this.onFirstAudioDecoded)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,n,i)=>{var o;(o=this.onFirstVideoDecoded)===null||o===void 0||o.call(this,t,n,i)},this.statsFilter.onSelectedLocalCandidateChanged=(t,n)=>{var i;(i=this.onSelectedLocalCandidateChanged)===null||i===void 0||i.call(this,t,n)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,n)=>{var i;(i=this.onSelectedRemoteCandidateChanged)===null||i===void 0||i.call(this,t,n)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0}async batchReceive(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const n=this.remoteSDP.batchSend(t).map((l,d)=>{let{id:h,mslabel:f}=l;const{kind:g}=t[d];return new be((_,v)=>{const y=setTimeout(()=>{v(new Error("Cannot receive track, id: ".concat(h)))},1e4),b=D=>{const I=Lt();if(I.name==="Safari"&&Number(I.version)===11&&D.track.id!==h&&D.streams[0].id===f){var O;const U=D.streams[0].getTracks()[0];return(O=this.remoteSDP)===null||O===void 0||O.updateTrackLabel(g,h,D.track.id),this.peerConnection.removeEventListener("track",b),clearTimeout(y),void _({track:U,id:h})}if(D.track.id===h)return this.peerConnection.removeEventListener("track",b),clearTimeout(y),void _({track:D.track,id:h})};this.peerConnection.addEventListener("track",b)})}),i=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:i});const o=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(o),await be.all(n)}catch(n){throw new ae(P.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(n.toString()))}}async getRemoteSSRC(t){if(!this.remoteSDP)return;const n=this.remoteSDP.getSSRC(t);return n==null?void 0:n[0].ssrcId}setConfiguration(t){if(wt().supportPCSetConfiguration){const n=Ig.resolvePCConfiguration(t);this.peerConnection.setConfiguration(n)}}},Ce(An.prototype,"connect",[_a],Object.getOwnPropertyDescriptor(An.prototype,"connect"),An.prototype),Ce(An.prototype,"stopSending",[_a],Object.getOwnPropertyDescriptor(An.prototype,"stopSending"),An.prototype),Ce(An.prototype,"receive",[_a],Object.getOwnPropertyDescriptor(An.prototype,"receive"),An.prototype),Ce(An.prototype,"stopReceiving",[_a],Object.getOwnPropertyDescriptor(An.prototype,"stopReceiving"),An.prototype),Ce(An.prototype,"muteRemote",[_a],Object.getOwnPropertyDescriptor(An.prototype,"muteRemote"),An.prototype),Ce(An.prototype,"unmuteRemote",[_a],Object.getOwnPropertyDescriptor(An.prototype,"unmuteRemote"),An.prototype),Ce(An.prototype,"muteLocal",[_a],Object.getOwnPropertyDescriptor(An.prototype,"muteLocal"),An.prototype),Ce(An.prototype,"unmuteLocal",[_a],Object.getOwnPropertyDescriptor(An.prototype,"unmuteLocal"),An.prototype),Ce(An.prototype,"close",[_a],Object.getOwnPropertyDescriptor(An.prototype,"close"),An.prototype),Ce(An.prototype,"updateEncoderConfig",[_a],Object.getOwnPropertyDescriptor(An.prototype,"updateEncoderConfig"),An.prototype),Ce(An.prototype,"updateSendParameters",[_a],Object.getOwnPropertyDescriptor(An.prototype,"updateSendParameters"),An.prototype),Ce(An.prototype,"replaceTrack",[_a],Object.getOwnPropertyDescriptor(An.prototype,"replaceTrack"),An.prototype),Ce(An.prototype,"getRemoteSSRC",[_a],Object.getOwnPropertyDescriptor(An.prototype,"getRemoteSSRC"),An.prototype),An);function _a(e,t,n){const i=e[t];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const o=this.mutex,l=await o.lock("Locking from P2PConnection.".concat(t));try{for(var d=arguments.length,h=new Array(d),f=0;f<d;f++)h[f]=arguments[f];return await i.apply(this,h)}finally{l()}},n}const Due={name:"PlanBConnection",create:function(e){let{store:t,spec:n}=e;return new xue(n,t)}},Bue={interceptLocalAudioFrame:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!wt().supportWebRTCEncodedTransform)return void S.warning("browser not support audio encoded transform");if(Fv.has(e)||!e.track)return;const n={track:e.track};if(Kc()){if(!e.createEncodedStreams)return void S.warning("browser not support createEncodedStreams() API");let o=null;try{o=e.createEncodedStreams()}catch(d){return void S.error("create audio-encoded-streams error",d&&d.message)}const l=new TransformStream({transform(d,h){n.controller||(n.controller=h),e.track&&e.track.id!==n.track.id&&(S.debug("audio track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",i),n.track=e.track,n.track.addEventListener("ended",i));const f=t.metadata&&t.metadata();f?function(g,_){const{chunk:v,controller:y}=_,b=Wl.METADATA;v.data=function(D,I,O){const U=O.byteLength,j=U+OR+M4,G=IR+NR+j,$=new ArrayBuffer(D.byteLength+G),Z=new DataView($);Z.setUint8(0,P4),Z.setUint16(1,j),Z.setUint8(3,I),Z.setUint16(4,U);for(let ee=0;ee<U;ee++)Z.setUint8(6+ee,O[ee]);const X=new Uint8Array(Z.buffer);return X.set(new Uint8Array(D),G),X.buffer}(v.data,b,g),y.enqueue(v)}(f,{chunk:d,controller:h}):h.enqueue(d)}});o.readable.pipeThrough(l).pipeTo(o.writable)}else if(kr()){if(typeof RTCRtpScriptTransform>"u")return void S.warning("browser not support RTCRtpScriptTransform");const o=Mv(),l=new MessageChannel;await new be(h=>o.onmessage=f=>{f.data==="registered"&&h(void 0)});const d=new RTCRtpScriptTransform(o,{name:"audio-metadata-tx",port:l.port2},[l.port2]);e.transform=d,await new be(h=>o.onmessage=f=>{f.data==="started"&&h(void 0)}),l.port1.onmessage=h=>{var f;if(h.data.transformed&&e.track&&((f=e.track)===null||f===void 0?void 0:f.id)!==n.track.id)S.debug("audio track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",i),n.track=e.track,n.track.addEventListener("ended",i);else if(h.data.getMetadata){const g=t.metadata&&t.metadata();g&&l.port1.postMessage({metadata:g})}},n.worker=o}function i(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",i)}const o=Fv.get(e);if(o){Fv.delete(e);try{var l,d;(l=o.controller)===null||l===void 0||l.terminate(),(d=o.worker)===null||d===void 0||d.terminate()}catch(h){S.warning(h&&h.message)}}}Fv.set(e,n),e.track.addEventListener("ended",i)},interceptRemoteAudioFrame:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!wt().supportWebRTCEncodedTransform)return void S.warning("browser not support audio encoded transform");if(Kv.has(e))return;const n={track:e.track,onMetadata:t.onMetadata,onPts:t.onPts};if(Kc()&&!fs()){if(!e.createEncodedStreams)return void S.warning("browser not support createEncodedStreams() API");FT(Mt.CHROME,87,116)||(t.enableTopn=!1);let o=null;try{o=e.createEncodedStreams()}catch(d){return void S.error("create audio-encoded-streams error",d&&d.message)}const l=new TransformStream({transform(d,h){n.controller||(n.controller=h),e.track&&e.track.id!==n.track.id&&(S.debug("audio track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",i),n.track=e.track,n.track.addEventListener("ended",i)),t.enableTopn?function(f,g,_){var v;const y=xR(new DataView(g.data));if(!y)return _.enqueue(g);const b=f.track.id;Ale.set(b,f.track);const D=(v=y.tlv.find($=>$.tag===Wl.AUDIO_LEVEL))===null||v===void 0?void 0:v.value;let I=0;typeof D=="number"&&(I=127-D);const O=Math.round(Math.pow(10,I/60)-1),{selected:U,speaker:j}=function($,Z){let X=Vh.get($);if(X||(X=function(ee){const le=new j4;return Vh.set(ee,le),Bo||(Bo=new cle(L("TOPN_SILENCE_THRESHOLD")||500),Bo.on("ActiveSpeakerChanged",fe=>{fe!=null&&(Qv=fe)})),Bo.addSpeakers([le]),le}($)),Vh.size<=V4)return{selected:!0,speaker:X};if(!Bo)throw new Error("no active speaker detector");return Bo.levelChanged(X.id,Z),kd=Bo.loudest.map(ee=>ee.id),Qv&&!me(kd).call(kd,Qv)&&kd.length>=V4&&kd.pop(),{selected:me(kd).call(kd,X.id)||X.id===Qv,speaker:X}}(f,O),G=function($,Z,X){const ee=ko.get($)||new lle($,Z);return ee.score=X,ko.set($,ee),function(le){if(Hv.set(le,!0),!Gv)return void(Gv=Date.now());const fe=Date.now();fe-Gv>1e3&&(Hv.get(le)?Hv.set(le,!1):(Q4(le),Hv.delete(le)),Gv=fe)}($),ee}(b,f.track,j.energyScore);G.addSample(U),G.active&&(g.data=y.frame.buffer,_.enqueue(g))}(e,d,h):t.enableMetadata||t.enablePts?function(f,g,_,v){const y=new DataView(f.data),b=y.getUint8(0);let D;if(128&b&&b!==71){const U=function(j){if(j.byteLength<=0)return[];const G=[];let $=0;for(;$<j.byteLength;){const X=(128&j.getUint8($))>>7,ee=127&j.getUint8($);if(!(X&&$+4<=j.byteLength)){$++;break}{const le=j.getUint32($,!1),fe=(16776192&le)>>10,Ie=1023&le;G.push({pt:ee,ts_offset:fe,length:Ie,data:new Uint8Array}),$+=4}}let Z=j.byteLength-$;for(const X of G){if(X.length>Z)return console.warn("Broken red payload"),[];X.length>0&&(X.data=new Uint8Array(j.buffer,j.byteOffset+$,X.length),$+=X.length,Z-=X.length)}if(Z>0){const X={pt:G.length>0?G[G.length-1].pt:0,ts_offset:0,length:Z,data:new Uint8Array(j.buffer,j.byteOffset+$,Z)};G.push(X)}return G}(y);if(U.length>0){const j=function(G){let $=0;for(let ee=0;ee<G.length;ee++)$+=ee<G.length-1?4:1,$+=G[ee].length;const Z=new Uint8Array($);let X=0;for(let ee=0;ee<G.length;ee++)if(ee<G.length-1){const le=(2147483648|(127&G[ee].pt)<<24|(262143&G[ee].ts_offset)<<10|1023&G[ee].length)>>>0;Z[X++]=le>>24&255,Z[X++]=le>>16&255,Z[X++]=le>>8&255,Z[X++]=255&le}else Z[X++]=127&G[ee].pt;for(const ee of G)Z.set(ee.data,X),X+=ee.length;return Z}(U.map(G=>{const $=new Uint8Array(G.length);$.set(G.data);const Z=xR(new DataView($.buffer));return Z!=null&&Z.frame&&(G.data=Z==null?void 0:Z.frame),D=Z,G}));f.data=j.buffer}}else D=xR(y),D&&(f.data=D.frame.buffer);if(g.enqueue(f),!D)return;const I=D.tlv.find(U=>U.tag===Wl.METADATA);I&&_&&I.value instanceof Uint8Array&&_(I.value);const O=D.tlv.find(U=>U.tag===Wl.AUDIO_64_BIT_PTS);O&&v&&O.value instanceof Uint8Array&&O.value.length==8&&v(new DataView(O.value.buffer).getBigUint64(0,!0))}(d,h,t.onMetadata,t.onPts):h.enqueue(d)}});o.readable.pipeThrough(l).pipeTo(o.writable)}else{if(typeof RTCRtpScriptTransform>"u")return void S.warning("browser not support RTCRtpScriptTransform");const o=Mv(),l=new MessageChannel;await new be(h=>o.onmessage=f=>{f.data==="registered"&&h(void 0)});const d=new RTCRtpScriptTransform(o,{name:"audio-metadata-rx",port:l.port2},[l.port2]);e.transform=d,await new be(h=>o.onmessage=f=>{f.data==="started"&&h(void 0)}),l.port1.onmessage=h=>{var f;h.data.transformed&&e.track&&((f=e.track)===null||f===void 0?void 0:f.id)!==n.track.id?(S.debug("audio track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",i),n.track=e.track,n.track.addEventListener("ended",i)):h.data.metadata&&n.onMetadata?n.onMetadata(h.data.metadata):h.data.pts&&n.onPts&&n.onPts(h.data.pts)},n.worker=o}function i(){e.track.removeEventListener("ended",i),function(o){const l=Kv.get(o);if(l){(function(f){const g=Vh.get(f);g&&(Vh.delete(f),Bo&&(Bo.removeSpeakers([g]),Vh.size===0&&(Bo.destroy(),Bo=null)))})(o),Q4(o.track.id),Kv.delete(o);try{var d,h;(d=l.controller)===null||d===void 0||d.terminate(),(h=l.worker)===null||h===void 0||h.terminate()}catch(f){S.warning(f&&f.message)}}}(e)}Kv.set(e,n),e.track.addEventListener("ended",i)},interceptLocalVideoFrame:async function(e,t){if(!wt().supportWebRTCEncodedTransform)return void S.warning("browser not support video encoded transform");if(Wv.has(e)||!e.track)return;const n={track:e.track};if(Kc()){if(!e.createEncodedStreams)return void S.warning("browser not support createEncodedStreams() API");let o=null;try{o=e.createEncodedStreams()}catch(h){return void S.error("create video-encoded-streams error",h&&h.message)}const l=[];t.on("sei-to-send",h=>{l.push(h)});const d=new TransformStream({transform(h,f){n.controller||(n.controller=f),e.track&&e.track.id!==n.track.id&&(S.debug("video track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",i),n.track=e.track,n.track.addEventListener("ended",i));const g=K4(new Uint8Array(h.data)),_=l.shift();if(_){const v=function(y,b,D){switch(D){case LR:return function(I,O){const U=G4(O),j=U.length,G=Math.floor(j/255),$=j%255,Z=new Uint8Array(6+G+1+j+I.byteLength);Z[0]=0,Z[1]=0,Z[2]=0,Z[3]=1,Z[4]=6,Z[5]=101;let X=0;for(;X<G;)Z[6+X]=255,X++;return Z[6+X]=$,X++,Z.set(U,6+X),Z.set(new Uint8Array(I),6+X+j),Z.buffer}(y,b);case UR:return function(I,O){const U=G4(O),j=U.length,G=Math.floor(j/255),$=j%255,Z=new Uint8Array(7+G+1+j+1+I.byteLength);Z[0]=0,Z[1]=0,Z[2]=0,Z[3]=1,Z[4]=78,Z[5]=1,Z[6]=101;let X=0;for(;X<G;)Z[7+X]=255,X++;return Z[7+X]=$,X++,Z.set(U,7+X),X+=j,Z[7+X]=128,X++,Z.set(new Uint8Array(I),7+X),Z.buffer}(y,b);default:return null}}(h.data,_,g);v&&(h.data=v)}f.enqueue(h)}});o.readable.pipeThrough(d).pipeTo(o.writable)}else{if(!kr())return;{if(typeof RTCRtpScriptTransform>"u")return void S.warning("browser not support RTCRtpScriptTransform");const o=Mv(),l=new MessageChannel;await new be(h=>o.onmessage=f=>{f.data==="registered"&&h(void 0)});const d=new RTCRtpScriptTransform(o,{name:"sei-tx",port:l.port2},[l.port2]);e.transform=d,await new be(h=>o.onmessage=f=>{f.data==="started"&&h(void 0)}),t.on("sei-to-send",h=>{l.port1.postMessage({sei:h})}),l.port1.onmessage=h=>{var f;h.data.transformed&&e.track&&((f=e.track)===null||f===void 0?void 0:f.id)!==n.track.id&&(S.debug("video track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",i),n.track=e.track,n.track.addEventListener("ended",i))},n.worker=o}}function i(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",i)}const o=Wv.get(e);if(o){Wv.delete(e);try{var l,d;(l=o.controller)===null||l===void 0||l.terminate(),(d=o.worker)===null||d===void 0||d.terminate()}catch(h){S.warning(h&&h.message)}}}Wv.set(e,n),e.track.addEventListener("ended",i)},interceptRemoteVideoFrame:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!wt().supportWebRTCEncodedTransform)return void S.warning("browser not support video encoded transform");if(!e.track)return;if(Rm.has(e)){const o=Rm.get(e);return void(o&&(o.onSei=t.onSei))}const n={track:e.track,onSei:t.onSei};if(Kc()){if(!e.createEncodedStreams)return void S.warning("browser not support createEncodedStreams() API");let o=null;try{o=e.createEncodedStreams()}catch(d){return void S.error("create video-encoded-streams error",d&&d.message)}const l=new TransformStream({transform(d,h){if(n.controller||(n.controller=h),!n.firstFrameInfo){var f;const _=d.getMetadata()||{};n.firstFrameInfo=fn({type:d.type,rtpTimestamp:d.timestamp,payloadType:_.payloadType||0,ssrc:_.synchronizationSource||0,length:d.data.byteLength},"mimeType"in _?{mimeType:_.mimeType}:{}),(f=t.onFirstFrame)===null||f===void 0||f.call(t,n.firstFrameInfo)}e.track&&e.track.id!==n.track.id&&(S.debug("video track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",i),n.track=e.track,n.track.addEventListener("ended",i));const g=function(_,v){switch(v){case LR:return function(y){const b=new DataView(y.data);let D=0;for(;D+4<y.data.byteLength;){if(b.getUint8(D+0)===0&&b.getUint8(D+1)===0&&b.getUint8(D+2)===0&&b.getUint8(D+3)===1&&b.getUint8(D+4)===6){let I=D+6,O=0,U=0;for(;(U=b.getUint8(I++))===255;)O+=255;O+=U;const j=H4(y.data,I,O);return new Uint8Array(j)}D++}return null}(_);case UR:return function(y){const b=new DataView(y.data);let D=0;for(;D+5<y.data.byteLength;){if(b.getUint8(D+0)===0&&b.getUint8(D+1)===0&&b.getUint8(D+2)===0&&b.getUint8(D+3)===1&&b.getUint8(D+4)===78&&b.getUint8(D+5)===1&&b.getUint8(D+6)===101){let I=D+7,O=0,U=0;for(;(U=b.getUint8(I++))===255;)O+=255;O+=U;const j=H4(y.data,I,O);return new Uint8Array(j)}D++}return null}(_);default:return null}}(d,K4(new Uint8Array(d.data)));g&&n.onSei&&n.onSei(g),h.enqueue(d)}});o.readable.pipeThrough(l).pipeTo(o.writable)}else if(kr()){if(typeof RTCRtpScriptTransform>"u")return void S.warning("browser not support RTCRtpScriptTransform");const o=Mv(),l=new MessageChannel;await new be(h=>o.onmessage=f=>{f.data==="registered"&&h(void 0)});const d=new RTCRtpScriptTransform(o,{name:"sei-rx",port:l.port2},[l.port2]);e.transform=d,await new be(h=>o.onmessage=f=>{f.data==="started"&&h(void 0)}),l.port1.onmessage=h=>{var f;if(h.data.transformed&&e.track&&((f=e.track)===null||f===void 0?void 0:f.id)!==n.track.id)S.debug("video track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",i),n.track=e.track,n.track.addEventListener("ended",i);else if(h.data.sei&&n.onSei)n.onSei(h.data.sei);else if(h.data.firstFrameInfo&&t.onFirstFrame){var g;(g=t.onFirstFrame)===null||g===void 0||g.call(t,h.data.firstFrameInfo)}},n.worker=o}function i(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",i)}(function(o){const l=Rm.get(o);if(l){Rm.delete(o);try{var d,h;(d=l.controller)===null||d===void 0||d.terminate(),(h=l.worker)===null||h===void 0||h.terminate()}catch(f){S.warning(f&&f.message)}}})(e)}Rm.set(e,n),e.track.addEventListener("ended",i)}},kue={name:"InterceptFrame",create:()=>Bue};var Bt;function WH(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}function Ho(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?WH(Object(n),!0).forEach(function(i){x(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):WH(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}let Lue=(Bt=class xp extends $v{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var t,n;return(t=(n=this.peerConnection.getReceivers()[0])===null||n===void 0||(n=n.transport)===null||n===void 0?void 0:n.state)!==null&&t!==void 0?t:null}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.send.videoCodecs.map(t=>t.rtpMap&&t.rtpMap.encodingName.toLowerCase()||"").filter(t=>{var n;return me(n=Object.keys(Id)).call(n,t)}))]}constructor(t,n,i){super(t,n),x(this,"id",zt(5,"connection-")),x(this,"store",void 0),x(this,"peerConnection",void 0),x(this,"forceTurn",!1),x(this,"remoteSDP",void 0),x(this,"initialOffer",void 0),x(this,"transportEventReceiver",void 0),x(this,"statsFilter",void 0),x(this,"extension",{useXR:L("USE_XR")}),x(this,"localCapabilities",void 0),x(this,"remoteCodecs",void 0),x(this,"localCandidateCount",0),x(this,"allCandidatesReceived",!1),x(this,"isPreallocation",!1),x(this,"preMediaMap",new Map),x(this,"dataStreamChannelMap",new Map),x(this,"establishPromise",void 0),x(this,"recoveredDataChannelIds",[]),x(this,"currentDataChannelId",1),x(this,"supportAV1RtpSpec",!1),x(this,"mutex",void 0),x(this,"qualityLimitationReason",Nh.NONE),x(this,"isFirstConnected",!1),this.store=n,this.forceTurn=EI(t),this.mutex=new Lr("NVConnectionExtension-mutex",n.clientId),this.peerConnection=i,this.isFirstConnected=!1,this.statsFilter=Tv(this.peerConnection,L("STATS_UPDATE_INTERVAL"),void 0,gn()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,t.isPreallocation&&(this.isPreallocation=!0),this.establishPromise=this.establish()}getPreMedia(t){return this.preMediaMap.get(t)}isPreSub(){return this.preMediaMap.size>0}async updateRemoteRTPCapabilities(t,n){if(this.remoteCodecs=n,!this.remoteSDP)return void S.debug("[NVConnectionExtension] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(this.localCodecs,", codecs: ").concat(n));if(this.remoteSDP.updateRemoteCodec(t,n,this.store.codec)){const i=await this.peerConnection.createOffer(),o=this.logSDPExchange(i.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(i);const l=this.remoteSDP.toString();o==null||o(l),await this.peerConnection.setRemoteDescription({type:"answer",sdp:l})}else S.debug("[NVConnectionExtension] updateRemoteRTPCapabilities no need to exchange SDP.")}async establish(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});const n=await this.peerConnection.createOffer();if(!n.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const i=_c(n.sdp),o=await tI({filterRTX:!L("USE_PUB_RTX")&&!L("USE_SUB_RTX"),filterVideoFec:L("FILTER_VIDEO_FEC"),filterAudioFec:L("FILTER_AUDIO_FEC"),filterVideoCodec:L("FILTER_VIDEO_CODEC"),unsupportedVideoUplinkCodec:L("UNSUPPORTED_VIDEO_UPLINK_CODEC"),unsupportedVideoDownlinkCodec:L("UNSUPPORTED_VIDEO_DOWNLINK_CODEC")},this.extension);if(this.localCapabilities=Bm(o),this.initialOffer=n,L("ENABLE_SVC")&&this.store.codec=="av1"){const d=await EV();var t;d&&(this.supportAV1RtpSpec=!0,(t=o.send)===null||t===void 0||t.videoExtensions.push(d))}let l;return n.sdp&&i0(n.sdp)&&(l=_n(o),dV(l)),Ho(Ho({},i),{},{rtpCapabilities:l||o,offerSDP:n.sdp})}catch(n){throw new ae(P.GET_LOCAL_CONNECTION_PARAMS_FAILED,n.toString())}}async connect(t){try{if(!this.initialOffer)throw new Error("Cannot establish NVConnectionExtension without initial offer.");this.initialOffer.sdp&&i0(this.initialOffer.sdp)&&uV(t.rtpCapabilities,this.localCapabilities),this.remoteSDP=new GV(Ho(Ho({},t),{},{localCapabilities:this.localCapabilities}),this.supportAV1RtpSpec,!(!L("ENABLE_PRE_SUB_WITH_PRE_PC")||!L("PRE_USE_LOCAL_CODECS"))&&Sm(this.store),!0),t.preallocation&&(this.isPreallocation=!0),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const n=this.remoteSDP.toString(),i=nI(this.initialOffer.sdp,this.extension),o=this.logSDPExchange(i||"","offer","local","connect");this.store.descriptionStart(),await this.peerConnection.setLocalDescription({type:"offer",sdp:i}),o==null||o(n),await this.peerConnection.setRemoteDescription({type:"answer",sdp:n});const l=this.peerConnection.getTransceivers()[0];if(l!=null&&l.receiver&&this.tryBindTransportEvents(l.receiver),Sm(this.store))if(t.preallocation&&L("ENABLE_PRE_SUB_WITH_PRE_PC")){const d=L("PRE_SUB_NUM"),{mids:h,preSSRCs:f}=this.remoteSDP.preloadRemoteMedia(d);await pi(this.peerConnection,this.remoteSDP,this.extension),S.debug("[".concat(this.store.clientId,"] [NVConnectionExtension] preload media, in pre pc,add preload ssrcs ").concat(f)),this.presetMedia(h,f)}else{const{preSSRCs:d=[]}=t,h=d.map(g=>g.ssrcMsg[0].ssrcId);if(d.length===0)return;const{mids:f}=this.remoteSDP.batchSend(d.map(g=>Object.assign({},g)));await pi(this.peerConnection,this.remoteSDP,this.extension),S.debug("[NVConnectionExtension.connect] preload media, after join, add preload ssrcs ".concat(h)),this.presetMedia(f,h)}}catch(n){throw new ae(P.EXCHANGE_SDP_FAILED,"NVConnectionExtension.connect failed; ".concat(n.toString()))}}presetMedia(t,n){t.forEach((i,o)=>{this.peerConnection.getTransceivers().forEach(l=>{if(l.mid!=null&&i===l.mid&&l.receiver.track){const d=l.receiver.track;let h;d.kind==="video"&&L("ENABLE_PRE_RENDER")&&(h=new Uv({trackId:"track-".concat(d.kind,"-unknown-").concat(this.store.clientId,"_").concat(zt(5,""))},!0),h.updateVideoTrack(d),h.onFirstVideoFrameRender=()=>{var f;const g=this.preMediaMap.get(n[o]);g&&(g.firstVideoRender=Date.now()),(f=this.onFirstVideoRender)===null||f===void 0||f.call(this,n[o])},h.onVideoBufferReady=()=>{var f;(f=this.onFirstVideoBufferReady)===null||f===void 0||f.call(this,n[o])},h.play(this.store.sessionId||void 0)),this.preMediaMap.set(n[o],{mid:i,track:d,player:h,transceiver:l})}}),this.store.peerReceiver()})}checkDtlsParameters(t){return!!this.remoteSDP&&t.length>0&&this.remoteSDP.updateRemoteDtlsParameters(t)}async updateRemoteConnect(t){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.updateRemoteConnect before remote SDP created");let n=!1;const{rtpCapabilities:i}=t;if([,n]=this.remoteSDP.updateRemoteRTPCapabilities(i),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0){const d=this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);n=n||d}const{preSSRCs:o=[]}=t,l=o.map(d=>d.ssrcMsg[0].ssrcId);if(!this.remoteSDP.checkPreloadSsrcs(l)){const d=[],h=[];if(Array.from(this.preMediaMap.entries()).every(f=>{let[g,{mid:_,player:v,track:y}]=f;return d.push(_),h.push(g),this.preMediaMap.delete(g),v&&v.destroy(),!0}),d.length>0&&(this.remoteSDP.stopSending(d),await pi(this.peerConnection,this.remoteSDP,this.extension),S.warn("[NVConnectionExtension.updateRemoteConnect] preload media, failed, del preload ssrcs ".concat(h)),ke.reportApiInvoke(this.store.sessionId,{name:yn.PRELOAD_MEDIA_FAILED,options:[o,h],tag:an.TRACER}).onSuccess()),o.length>0){const{mids:f}=this.remoteSDP.batchSend(o.map(g=>Object.assign({},g)));await pi(this.peerConnection,this.remoteSDP,this.extension),S.debug("[NVConnectionExtension.updateRemoteConnect] preload media, after join, add preload ssrcs ".concat(l)),this.presetMedia(f,l)}}n?(await pi(this.peerConnection,this.remoteSDP,this.extension),S.debug("[NVConnectionExtension] updateRemoteConnect by exchanging SDP.")):S.debug("[NVConnectionExtension] updateRemoteConnect no need to exchange SDP, because no need to update remote codecs (use local codecs)")}catch(n){throw new ae(P.EXCHANGE_SDP_FAILED,"NVConnectionExtension.updateRemoteConnect failed; ".concat(n.toString()))}}send(t,n,i){var o=this;return qs(function*(){const l=yield ft(o.mutex.lock("From NVConnectionExtension.send"));try{if(!o.remoteSDP)throw new Error("Cannot call NVConnectionExtension.send before remote SDP created");const d=[],h=Om();t.forEach(O=>{const U=o.peerConnection.addTransceiver(O._mediaStreamTrack,Ho({direction:"sendonly"},O.trackMediaType==="video"&&o.supportAV1RtpSpec&&h?{sendEncodings:[{scalabilityMode:h}]}:{}));d.push(U),O._updateRtpTransceiver(U)}),gn()&&L("SIMULCAST")===!0&&(yield ft(o.applySimulcastForFirefox(d,t)));const f=yield ft(o.peerConnection.createOffer()),g=o.remoteSDP.predictReceivingMids(t.length),_=o.mungSendOfferSDP(f.sdp,t,g),v=Ps(_),y=g.map(O=>{const U=v.mediaDescriptions.find(j=>j.attributes.mid===O);if(!U)throw new Error("Cannot extract ssrc from mediaDescription.");return JR(U,L("USE_PUB_RTX"))});let b;try{b=yield y}catch(O){b=[],o.remoteSDP.receive(t,n,i,b);const U=o.remoteSDP.toString();throw yield ft(o.peerConnection.setLocalDescription({type:"offer",sdp:_})),yield ft(o.peerConnection.setRemoteDescription({type:"answer",sdp:U})),yield ft(o.stopSending(g,!0)),O}o.remoteSDP.receive(t,n,i,b);const D=o.remoteSDP.toString(),I=o.logSDPExchange(_,"offer","local","send");return yield ft(o.peerConnection.setLocalDescription({type:"offer",sdp:_})),yield ft(o.applySimulcastEncodings(d,t)),yield ft(o.applySendEncodings(d,t)),I==null||I(D),yield ft(o.peerConnection.setRemoteDescription({type:"answer",sdp:D})),d.map((O,U)=>{const j=g[U];return{localSSRC:y[U],id:j,transceiver:O}})}catch(d){throw d instanceof ae?d:new ae(P.EXCHANGE_SDP_FAILED,"NVConnectionExtension.send failed; ".concat(d.toString()))}finally{l()}})()}async createDataChannels(t,n){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.createDataChannels before remote SDP created");let i=this.dataStreamChannelMap.get(t);if(i&&i.readyState==="open")S.debug("[NVConnectionExtension] Channels are already available and can be reused directly.");else{const l=this.currentDataChannelId<1023?this.currentDataChannelId++:this.recoveredDataChannelIds.shift();if(typeof l!="number")throw new Error("create DataChannel error, because cannot get dc id");i=this.peerConnection.createDataChannel("datastream-channel",{id:l,negotiated:!0,ordered:!1,maxRetransmits:L("DATASTREAM_MAX_RETRANSMITS")}),i.binaryType="arraybuffer",this.dataStreamChannelMap.set(t,i)}n.forEach(l=>{l._updateOriginDataChannel(i)});const{needExchangeSDP:o}=this.remoteSDP.sendDataChannel();if(o){const l=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:l});const d=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(d),S.debug("[NVConnectionExtension] createDataChannels by exchanging SDP.")}else S.debug("[NVConnectionExtension] createDataChannels no need to exchange SDP.");return}catch(i){throw i instanceof ae?i:new ae(P.EXCHANGE_SDP_FAILED,"NVConnectionExtension.createDataChannels failed; ".concat(i.toString()))}}async stopDataChannels(t){try{const n=this.dataStreamChannelMap.get(t);return n&&(n.id&&this.recoveredDataChannelIds.push(n.id),n.close()),void this.dataStreamChannelMap.delete(t)}catch(n){throw n instanceof ae?n:new ae(P.DATACHANNEL_FAILED,"NVConnectionExtension.stopDataChannels failed; ".concat(n.toString()))}}async stopSending(t,n){const i=n?void 0:await this.mutex.lock("From NVConnectionExtension.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.stopSending before remote SDP created");const o=this.peerConnection.getTransceivers().filter(f=>t.indexOf(f.mid)!==-1);if(o.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call NVConnectionExtension.stopSending.");o.map(f=>{var g;$h(this.id+f.mid,this),f.direction="inactive",(g=f.stop)===null||g===void 0||g.call(f)});const l=await this.peerConnection.createOffer(),d=this.logSDPExchange(l.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(l),this.remoteSDP.stopReceiving(t);const h=this.remoteSDP.toString();d==null||d(h),await this.peerConnection.setRemoteDescription({type:"answer",sdp:h})}catch(o){throw new ae(P.EXCHANGE_SDP_FAILED,"NVConnectionExtension.stopSending failed; ".concat(o.toString()))}finally{i&&i()}}async receive(t,n,i,o){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.receive ".concat(t," before remoteSDP created."));const{mid:l,needExchangeSDP:d}=this.remoteSDP.send(t,n,i,o);d&&(await pi(this.peerConnection,this.remoteSDP,this.extension),S.debug("[".concat(this.store.clientId,"] [NVConnectionExtension] receive ").concat(t," by exchanging SDP.")));const h=this.peerConnection.getTransceivers().find(f=>f.mid===l);if(!h)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:h.receiver.track,id:l,transceiver:h}}catch(l){throw new ae(P.EXCHANGE_SDP_FAILED,"NVConnectionExtension.receive failed; ".concat(l.toString()))}}async batchReceive(t){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.batchReceive before remoteSDP created.");const{mids:n,needExchangeSDP:i}=this.remoteSDP.batchSend(t);return i&&(await pi(this.peerConnection,this.remoteSDP,this.extension),S.debug("[".concat(this.store.clientId,"] [NVConnectionExtension] batchReceive by exchanging SDP."))),n.map(o=>{const l=this.peerConnection.getTransceivers().find(d=>d.mid===o);if(!l)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:l.receiver.track,id:o,transceiver:l}})}catch(n){throw new ae(P.EXCHANGE_SDP_FAILED,"NVConnectionExtension.receive failed; ".concat(n.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.stopReceiving before remote SDP created.");t.forEach(l=>{Array.from(this.preMediaMap.entries()).some(d=>{let[h,{mid:f,player:g}]=d;if(f===l)return this.preMediaMap.delete(h),g&&g.destroy(),!0})}),this.remoteSDP.stopSending(t);const n=this.remoteSDP.toString(),i=this.logSDPExchange(n,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const o=await this.peerConnection.createAnswer();i==null||i(o.sdp||""),await this.peerConnection.setLocalDescription(o)}catch(n){throw new ae(P.EXCHANGE_SDP_FAILED,"NVConnectionExtension stopReceiving failed; ".concat(n.toString()))}}async muteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.muteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.mute(t);const n=this.remoteSDP.toString(),i=this.logSDPExchange(n,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const o=await this.peerConnection.createAnswer();i==null||i(o.sdp||""),await this.peerConnection.setLocalDescription(o)}catch(n){throw new ae(P.EXCHANGE_SDP_FAILED,"NVConnectionExtension.muteRemote failed; ".concat(n.toString()))}}async unmuteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.unmuteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.unmute(t);const n=this.remoteSDP.toString(),i=this.logSDPExchange(n,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const o=await this.peerConnection.createAnswer();i==null||i(o.sdp||""),await this.peerConnection.setLocalDescription(o)}catch(n){throw new ae(P.EXCHANGE_SDP_FAILED,"NVConnectionExtension.unmuteRemote failed; ".concat(n.toString()))}}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.muteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(d=>d.mid&&t.indexOf(d.mid)!==-1);if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(d=>{d.direction="inactive"});const i=await this.peerConnection.createOffer(),o=this.logSDPExchange(i.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(i),this.remoteSDP.muteRemote(t);const l=this.remoteSDP.toString();o==null||o(l),await this.peerConnection.setRemoteDescription({type:"answer",sdp:l})}catch(n){throw new ae(P.EXCHANGE_SDP_FAILED,"NVConnectionExtension.muteLocal failed; ".concat(n.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.unmuteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(d=>d.mid&&t.indexOf(d.mid)!==-1);if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(async(d,h)=>{d.direction="sendonly"});const i=await this.peerConnection.createOffer(),o=this.logSDPExchange(i.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(i),this.remoteSDP.unmuteRemote(t),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec(t,this.remoteCodecs,this.store.codec);const l=this.remoteSDP.toString();o==null||o(l),await this.peerConnection.setRemoteDescription({type:"answer",sdp:l})}catch(n){throw new ae(P.EXCHANGE_SDP_FAILED,"NVConnectionExtension.unmuteLocal failed; ".concat(n.toString()))}}restartICE(t){var n=this;return qs(function*(){const i=yield ft(n.mutex.lock("From NVConnectionExtension.restartICE"));try{if(!n.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const o=wt().supportPCSetConfiguration,l=L("FORCE_TURN_TCP")||n.forceTurn;if(t===Ur.RELAY&&!o)return;if(o&&!l){const v=t===Ur.RELAY?"relay":"all",y=n.peerConnection.getConfiguration();y.iceTransportPolicy!==v&&(S.debug("[".concat(n.store.clientId,"] restartICE change iceTransportPolicy from [").concat(y.iceTransportPolicy,"] to [").concat(v,"]")),y.iceTransportPolicy=v,n.peerConnection.setConfiguration(y))}n.remoteSDP.updateCandidates(t);const d=yield ft(n.peerConnection.createOffer({iceRestart:!0}));if(!d.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const h=_c(d.sdp),{remoteIceParameters:f}=yield h.iceParameters;n.remoteSDP.restartICE(f);const g=n.remoteSDP.toString(),_=n.logSDPExchange(d.sdp||"","offer","local","restartICE");n.store.descriptionStart(),yield ft(n.peerConnection.setLocalDescription(d)),_==null||_(g),yield ft(n.peerConnection.setRemoteDescription({type:"answer",sdp:g}))}catch(o){S.warning("[".concat(n.store.clientId,"] restart ICE failed, abort operation"),o)}finally{i()}})()}async extendCandidate(){if(!this.remoteSDP||this.isFirstConnected)return;const t=await this.mutex.lock("From NVConnectionExtension.extendCandidate");try{this.remoteSDP.updateCandidates(Ur.TCP_RELAY),await pi(this.peerConnection,this.remoteSDP,this.extension)}catch(n){S.warning("[".concat(this.store.clientId,"] extend candidate failed, abort operation"),n)}finally{t()}}close(){var t;this.peerConnection.getTransceivers().forEach(n=>{$h(this.id+n.mid,this)}),this.preMediaMap.forEach(n=>{let{player:i}=n;i&&i.destroy()}),this.preMediaMap.clear(),this.peerConnection.close(),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear(),this.recoveredDataChannelIds=[],this.currentDataChannelId=1}getStats(){return Ho(Ho({},this.statsFilter.getStats()),{},{qualityLimitationReason:this.qualityLimitationReason})}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,n){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.updateEncoderConfig before remote SDP created.");const i=await this.peerConnection.createOffer(),o=this.mungSendOfferSDP(i.sdp,[n],[t]);this.remoteSDP.updateRecvMedia(t,n);const l=this.remoteSDP.toString(),d=this.logSDPExchange(o,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:o}),d==null||d(l),await this.peerConnection.setRemoteDescription({type:"answer",sdp:l})}catch(i){throw new ae(P.EXCHANGE_SDP_FAILED,i.toString())}}async updateSendParameters(t,n){const i=this.peerConnection.getTransceivers().filter(o=>o.mid===t);i.length===1&&(this.isVP8Simulcast(n)?gn()||await this.applySimulcastEncodings(i,[n]):await this.applySendEncodings(i,[n]))}setStatsRemoteVideoIsReady(t,n){this.statsFilter.setVideoIsReady2(t,n)}async replaceTrack(t,n){const i=this.peerConnection.getTransceivers().find(o=>o.mid===n);i&&await i.sender.replaceTrack(t._mediaStreamTrack)}async getSelectedCandidatePair(){const t=this.peerConnection.getReceivers();if(t.length>0&&t[0].transport&&t[0].transport.iceTransport&&t[0].transport.iceTransport.getSelectedCandidatePair&&t[0].transport.iceTransport.getSelectedCandidatePair()){const n=t[0].transport.iceTransport,{local:i,remote:o}=n.getSelectedCandidatePair();return{local:Ho(Ho({},Xa),{},{candidateType:i.type,protocol:i.protocol,address:i.address,port:i.port}),remote:Ho(Ho({},Xa),{},{candidateType:o.type,protocol:o.protocol,address:o.address,port:o.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t;(t=this.onICEConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;this.peerConnection.connectionState==="connected"&&(this.isFirstConnected=!0),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidateerror=t=>{if(t&&(t.errorCode||t.errorText)){var n;const i="code: ".concat(t.errorCode,", message: ").concat(t.errorText),o=t.port?"local: ".concat(t.port):"",l=gc(t.url||"");S.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: NVConnectionExtension.onICECandidateError(").concat(i,"), url: ").concat(l||"",", host_candidate:").concat(o)),(n=this.onICECandidateError)===null||n===void 0||n.call(this,i)}},this.peerConnection.onicegatheringstatechange=t=>{t&&t.target&&"iceGatheringState"in t.target&&S.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] RTCPeerConnection.onicegatheringstatechange(").concat(t.target.iceGatheringState,")"))},this.peerConnection.onicecandidate=t=>{t.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,S.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,S.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},L("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){const n={iceServers:[]},i=t.cloudProxyServer||"disabled";return t.iceServers?n.iceServers=t.iceServers:t.turnServer&&(yd(t.turnServer.servers)?n.iceServers=t.turnServer.servers:L("NEW_TURN_MODE")&&n.iceServers&&i==="disabled"?(L("USE_TURN_SERVER_OF_GATEWAY")?t.turnServer.serversFromGateway&&n.iceServers.push(...xp.newTurnServerConfigToIceServers(t.turnServer.serversFromGateway)):n.iceServers.push(...xp.newTurnServerConfigToIceServers(t.turnServer.servers)),L("NEW_FORCE_TURN")&&(n.iceTransportPolicy="relay")):t.turnServer.mode!=="off"&&(n.iceServers&&n.iceServers.push(...xp.turnServerConfigToIceServers(t.turnServer.servers)),L("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&t.turnServer.serversFromGateway&&n.iceServers.push(...xp.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),L("FORCE_TURN_TCP")?n.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(o=>{o.forceturn&&(n.iceTransportPolicy="relay")}))),L("ENABLE_ENCODED_TRANSFORM")&&wt().supportWebRTCEncodedTransform&&(n.encodedInsertableStreams=!0),n}static turnServerConfigToIceServers(t){const n=[];return t.forEach(i=>{i.security?i.tcpport&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turns:".concat(to(i.turnServerURL),":").concat(i.tcpport,"?transport=tcp")}):(i.udpport&&!L("FORCE_TURN_TCP")&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.udpport,"?transport=udp")}),i.tcpport&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.tcpport,"?transport=tcp")}))}),n}static newTurnServerConfigToIceServers(t){const n=[];return t.forEach(i=>{const o=L("NEW_TURN_MODE");o===1?n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":3478?transport=udp")}):o===2?n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":3478?transport=tcp")}):o===3?n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turns:".concat(to(i.turnServerURL),":443?transport=tcp")}):o===4&&(n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":3478?transport=udp")}),n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":3478?transport=tcp")}),n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turns:".concat(to(i.turnServerURL),":443?transport=tcp")}))}),n}tryBindTransportEvents(t){const n=t.transport;if(n){this.transportEventReceiver=t,n.onstatechange=()=>{var o;n!=null&&n.state&&((o=this.onDTLSTransportStateChange)===null||o===void 0||o.call(this,n.state))},n.onerror=o=>{var l;(l=this.onDTLSTransportError)===null||l===void 0||l.call(this,"error"in o?o.error:o)};const i=n.iceTransport;i&&(i.onstatechange=()=>{const o=n==null?void 0:n.iceTransport.state;var l;o&&((l=this.onICETransportStateChange)===null||l===void 0||l.call(this,o))},i.getSelectedCandidatePair&&(i.onselectedcandidatepairchange=()=>{if(i.getSelectedCandidatePair()){const{local:o,remote:l}=i.getSelectedCandidatePair()||{};if(o&&l){const d=o.address+":"+o.port,h=l.address+":"+l.port;S.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify(gc(d)),", remote ").concat(JSON.stringify(gc(h))))}}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(t,n){var i,o;if(n||(n=this.peerConnection.getSenders().find(O=>O.track===t._mediaStreamTrack)),!n)return S.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(t))return S.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!wt().supportSetRtpSenderParameters)return S.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const l={},d={};switch(t._optimizationMode){case"motion":l.degradationPreference="maintain-framerate";break;case"detail":l.degradationPreference="maintain-resolution";break;case"balanced":l.degradationPreference="balanced"}const h=lV(this.peerConnection,t._mediaStreamTrack),f=$F(t);if(XV(t)&&h&&n&&f&&this.getLocalVideoStats&&me(i=["vp8","vp9"]).call(i,this.store.codec)){var g;const I=l.degradationPreference||(me(g=t._hints).call(g,Wt.CUSTOM_TRACK)?L("CUSTOM_ADAPTATION_DEFAULT_MODE"):"maintain-framerate");JV(this.id+h.mid,f,this,I,O=>{n&&this.updateAdaptation(n,O)},this.getLocalVideoStats.bind(this))}if(t._encoderConfig){var _;const{bitrateMax:I,frameRate:O,scaleResolutionDownBy:U}=t._encoderConfig;I&&(d.maxBitrate=1e3*I),(me(_=t._hints).call(_,Wt.LOW_STREAM)||t.isUseScaleResolutionDownBy)&&(O&&(d.maxFramerate=ei(O)),U&&U>=1&&(d.scaleResolutionDownBy=U))}const{maxFramerate:v}=L("ENCODER_CONFIG_LIMIT");if(v&&typeof v=="number"&&(d.maxFramerate=d.maxFramerate?Math.min(d.maxFramerate,v):v),L("DSCP_TYPE")&&uc()){var y;const I=L("DSCP_TYPE");me(y=["very-low","low","medium","high"]).call(y,I)&&(d.networkPriority=I)}const b=n.getParameters(),D=(o=b.encodings)===null||o===void 0?void 0:o[0];gn()&&!D&&(l.encodings=[d]),D&&Object.assign(D,d),Object.assign(b,l),S.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(b.encodings))),await n.setParameters(b),await wV(this.store.codec,n,L("SVC_MODE"))}async updateAdaptation(t,n){var i,o;if(!t)return S.debug("[updateAdaptation] no rtpSender found");if(!wt().supportSetRtpSenderParameters)return S.debug("[updateAdaptation] Browser not support set rtp-sender parameters");const l={},{bitrateMax:d,frameRate:h,scaleResolutionDownBy:f}=n;d&&(l.maxBitrate=1e3*d),h&&(l.maxFramerate=ei(h)),f&&f>=1&&me(i=["vp8","vp9"]).call(i,this.store.codec)&&(l.scaleResolutionDownBy=f);const g=t.getParameters(),_=(o=g.encodings)===null||o===void 0?void 0:o[0];_&&Object.assign(_,l),Object.assign(g,{});try{await t.setParameters(g),S.debug("[updateAdaptation] updateRtpSenderEncodings: ".concat(JSON.stringify(g.encodings)))}catch(v){!("transport"in t)||t.transport&&t.transport.state==="connected"?this.peerConnectionState!=="connected"?S.debug("[updateAdaptation] peerConnection not connected}"):S.debug("[updateAdaptation] updateRtpSenderEncodings failed",v):S.debug("[updateAdaptation] rtpSender transport not connected}")}}async applySendEncodings(t,n){try{if(!wt().supportSetRtpSenderParameters||t.length!==n.length)return;for(let i=0;i<t.length;i++){const o=t[i],l=n[i];l instanceof on&&!this.isVP8Simulcast(l)&&await this.updateRtpSenderEncodings(l,o.sender)}}catch{S.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,n,i){const o=Ps(t);return n.forEach((l,d)=>{const h=i[d],f=o.mediaDescriptions.find(g=>g.attributes.mid===h);f&&(Fd(f,l),eI(f,l,this.store.codec))}),Yc(o)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var n;(n=this.onFirstAudioReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var n;(n=this.onFirstVideoReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var n;(n=this.onFirstAudioDecoded)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,n,i)=>{var o;(o=this.onFirstVideoDecoded)===null||o===void 0||o.call(this,t,n,i)},this.statsFilter.onSelectedLocalCandidateChanged=(t,n)=>{var i;(i=this.onSelectedLocalCandidateChanged)===null||i===void 0||i.call(this,t,n)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,n)=>{var i;(i=this.onSelectedRemoteCandidateChanged)===null||i===void 0||i.call(this,t,n)},this.statsFilter.onFirstVideoDecodedTimeout=t=>{var n;(n=this.onFirstVideoDecodedTimeout)===null||n===void 0||n.call(this,t)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(t,n){if(t.length===n.length)for(let f=0;f<t.length;f++){var i,o,l,d,h;const g=t[f],_=n[f];if(_ instanceof on&&!me(i=_._hints).call(i,Wt.LOW_STREAM)&&(o=_._encoderConfig)!==null&&o!==void 0&&o.bitrateMax&&((l=_._encoderConfig)===null||l===void 0?void 0:l.bitrateMax)>200&&(d=_._scalabilityMode)!==null&&d!==void 0&&d.numSpatialLayers&&((h=_._scalabilityMode)===null||h===void 0?void 0:h.numSpatialLayers)>1&&this.store.codec==="vp8"){const v={},y={high:1e3*(_._encoderConfig.bitrateMax-50),medium:5e4};v.encodings=[{rid:"m",active:!0,maxBitrate:y.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:y.high}];const b=g.sender.getParameters();await g.sender.setParameters(Object.assign(b,v))}}}async applySimulcastEncodings(t,n){if(!gn()&&t.length===n.length)for(let i=0;i<t.length;i++){const o=n[i];if(o instanceof on&&this.isVP8Simulcast(o)){const l=t[i],d={},h={high:1e3*(o._encoderConfig.bitrateMax-50),medium:5e4};d.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:h.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:h.medium,scaleResolutionDownBy:4}];const f=l.sender.getParameters();await l.sender.setParameters(Object.assign(f,d))}}}isVP8Simulcast(t){var n,i,o,l,d;return!!(t instanceof on&&L("SIMULCAST")&&this.store.codec==="vp8"&&!me(n=t._hints).call(n,Wt.LOW_STREAM)&&(i=t._encoderConfig)!==null&&i!==void 0&&i.bitrateMax&&((o=t._encoderConfig)===null||o===void 0?void 0:o.bitrateMax)>200&&(l=t._scalabilityMode)!==null&&l!==void 0&&l.numSpatialLayers&&((d=t._scalabilityMode)===null||d===void 0?void 0:d.numSpatialLayers)>1)}logSDPExchange(t,n,i,o){if(L("SDP_LOGGING"))return S.upload("[".concat(this.store.clientId,"] exchanging ").concat(i," ").concat(n," SDP during NVConnectionExtension.").concat(o,`
`),t),n==="offer"?l=>{this.logSDPExchange(l,"answer",i==="local"?"remote":"local",o)}:void 0}async getRemoteSSRC(t){if(!this.remoteSDP)return;const n=this.remoteSDP.getSSRC(t);return n&&n.length!==0?n[0].ssrcId:void 0}setConfiguration(t){if(wt().supportPCSetConfiguration){const n=xp.resolvePCConfiguration(t);this.peerConnection.setConfiguration(n)}t.isPreallocation&&(this.isPreallocation=!0)}},Ce(Bt.prototype,"updateRemoteRTPCapabilities",[ri],Object.getOwnPropertyDescriptor(Bt.prototype,"updateRemoteRTPCapabilities"),Bt.prototype),Ce(Bt.prototype,"connect",[ri],Object.getOwnPropertyDescriptor(Bt.prototype,"connect"),Bt.prototype),Ce(Bt.prototype,"updateRemoteConnect",[ri],Object.getOwnPropertyDescriptor(Bt.prototype,"updateRemoteConnect"),Bt.prototype),Ce(Bt.prototype,"createDataChannels",[ri],Object.getOwnPropertyDescriptor(Bt.prototype,"createDataChannels"),Bt.prototype),Ce(Bt.prototype,"receive",[ri],Object.getOwnPropertyDescriptor(Bt.prototype,"receive"),Bt.prototype),Ce(Bt.prototype,"batchReceive",[ri],Object.getOwnPropertyDescriptor(Bt.prototype,"batchReceive"),Bt.prototype),Ce(Bt.prototype,"stopReceiving",[ri],Object.getOwnPropertyDescriptor(Bt.prototype,"stopReceiving"),Bt.prototype),Ce(Bt.prototype,"muteRemote",[ri],Object.getOwnPropertyDescriptor(Bt.prototype,"muteRemote"),Bt.prototype),Ce(Bt.prototype,"unmuteRemote",[ri],Object.getOwnPropertyDescriptor(Bt.prototype,"unmuteRemote"),Bt.prototype),Ce(Bt.prototype,"muteLocal",[ri],Object.getOwnPropertyDescriptor(Bt.prototype,"muteLocal"),Bt.prototype),Ce(Bt.prototype,"unmuteLocal",[ri],Object.getOwnPropertyDescriptor(Bt.prototype,"unmuteLocal"),Bt.prototype),Ce(Bt.prototype,"close",[ri],Object.getOwnPropertyDescriptor(Bt.prototype,"close"),Bt.prototype),Ce(Bt.prototype,"updateEncoderConfig",[ri],Object.getOwnPropertyDescriptor(Bt.prototype,"updateEncoderConfig"),Bt.prototype),Ce(Bt.prototype,"updateSendParameters",[ri],Object.getOwnPropertyDescriptor(Bt.prototype,"updateSendParameters"),Bt.prototype),Ce(Bt.prototype,"replaceTrack",[ri],Object.getOwnPropertyDescriptor(Bt.prototype,"replaceTrack"),Bt.prototype),Ce(Bt.prototype,"updateAdaptation",[ri],Object.getOwnPropertyDescriptor(Bt.prototype,"updateAdaptation"),Bt.prototype),Ce(Bt.prototype,"getRemoteSSRC",[ri],Object.getOwnPropertyDescriptor(Bt.prototype,"getRemoteSSRC"),Bt.prototype),Bt);function ri(e,t,n){const i=e[t];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const o=this.mutex,l=await o.lock("From NVConnectionExtension.".concat(t));try{for(var d=arguments.length,h=new Array(d),f=0;f<d;f++)h[f]=arguments[f];return await i.apply(this,h)}finally{l()}},n}var $t;function YH(e){var t,n,i,o=2;for(typeof Symbol<"u"&&(n=lv,i=Symbol.iterator);o--;){if(n&&(t=e[n])!=null)return t.call(e);if(i&&(t=e[i])!=null)return new Q0(t.call(e));n="@@asyncIterator",i="@@iterator"}throw new TypeError("Object is not async iterable")}function Q0(e){function t(n){if(Object(n)!==n)return be.reject(new TypeError(n+" is not an object."));var i=n.done;return be.resolve(n.value).then(function(o){return{value:o,done:i}})}return Q0=function(n){this.s=n,this.n=n.next},Q0.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(n){var i=this.s.return;return i===void 0?be.resolve({value:n,done:!0}):t(i.apply(this.s,arguments))},throw:function(n){var i=this.s.return;return i===void 0?be.reject(n):t(i.apply(this.s,arguments))}},new Q0(e)}let Uue=($t=class nw extends $v{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get localCodecs(){return this._p2pConnection.localCodecs}constructor(t,n){super(t,n),x(this,"name","DataChannelConnection"),x(this,"store",void 0),x(this,"peerConnection",void 0),x(this,"cname",void 0),x(this,"mutex",new Lr("DataChannelConnection-mutex")),x(this,"dataChannel",void 0),x(this,"_p2pConnection",void 0),x(this,"establishPromise",void 0),x(this,"_nvMedia",void 0),this.store=n,this.store.dcId=this.store.dcId+1,this.peerConnection=new RTCPeerConnection(nw.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.dataChannel=this.peerConnection.createDataChannel("agora-signal",{ordered:!1,maxPacketLifeTime:50}),this.dataChannel.binaryType="arraybuffer",this._p2pConnection=new Lue(t,n,this.peerConnection),this.bindPCEvents(),this.establishPromise=this._p2pConnection.establishPromise}getPreMedia(t){var n;return(n=this._p2pConnection)===null||n===void 0?void 0:n.getPreMedia(t)}isPreSub(){var t,n;return(t=(n=this._p2pConnection)===null||n===void 0?void 0:n.isPreSub())!==null&&t!==void 0&&t}async establish(){return await this._p2pConnection.establish()}getP2PConnectionParams(){return this._p2pConnection.establishPromise}updateRtpSenderEncodings(t){return this._p2pConnection.updateRtpSenderEncodings(t)}async connect(t){return this.cname=t.cname,await this._p2pConnection.connect(t),await new be((n,i)=>{const o=setTimeout(()=>{this.closeSignal(),i(new se(P.DATACHANNEL_CONNECTION_TIMEOUT,"Datachannel connection timed out, candidates: ".concat(JSON.stringify(t.candidates))))},L("DC_CONNECTION_TIMEOUT"));this.dataChannel.onopen=()=>{if(this.dataChannel.readyState==="open")return clearTimeout(o),void n()},this.dataChannel.onerror=l=>{this.closeSignal(),i(l)},this.dataChannel.addEventListener("close",()=>{i(new se(P.DATACHANNEL_CONNECTION_TIMEOUT))})}),{transmitter:this.dataChannel,close:this.closeSignal.bind(this)}}async updateRemoteRTPCapabilities(t,n){return this._p2pConnection.updateRemoteRTPCapabilities(t,n)}send(t,n,i){var o=this;return qs(function*(){const l=yield ft(o.mutex.lock("From DataChannelConnection.send"));try{return yield*bh(YH(o._p2pConnection.send(t,n,i)))}finally{l()}})()}async stopSending(t,n){return this._p2pConnection.stopSending(t,n)}async createDataChannels(t,n){return this._p2pConnection.createDataChannels(t,n)}async stopDataChannels(t){return this._p2pConnection.stopDataChannels(t)}async receive(t,n,i,o){return this._nvMedia?(S.debug("[DataChannelConnection] receive ".concat(t," by DataChannel.")),await this._nvMedia.reveiveByRTCMedia(t,n,this.cname)):(S.debug("[DataChannelConnection] receive ".concat(t," by WebRTC.")),await this._p2pConnection.receive(t,n,i,o))}async batchReceive(t){return[...await this._p2pConnection.batchReceive(t)]}async stopReceiving(t){return await this._p2pConnection.stopReceiving(t)}async muteRemote(t){return await this._p2pConnection.muteRemote(t)}async unmuteRemote(t){return await this._p2pConnection.unmuteRemote(t)}async muteLocal(t){return await this._p2pConnection.muteLocal(t)}async unmuteLocal(t){return await this._p2pConnection.unmuteLocal(t)}restartICE(t){var n=this;return qs(function*(){return yield*bh(YH(n._p2pConnection.restartICE(t)))})()}close(){var t;(t=this._nvMedia)===null||t===void 0||t.close(),this._p2pConnection.close(),this.unbindConnectionEvents(this._p2pConnection)}getStats(){return this._p2pConnection.getStats()}getRemoteVideoIsReady(t){return this._p2pConnection.getRemoteVideoIsReady(t)}updateRemoteConnect(t){var n;return(n=this._nvMedia)===null||n===void 0||n.setRemoteRtpCapabilities(t),this._p2pConnection.updateRemoteConnect(t)}async updateEncoderConfig(t,n){return await this._p2pConnection.updateEncoderConfig(t,n)}async updateSendParameters(t,n){return await this._p2pConnection.updateSendParameters(t,n)}setStatsRemoteVideoIsReady(t,n){this._p2pConnection.setStatsRemoteVideoIsReady(t,n)}async replaceTrack(t,n){return await this._p2pConnection.replaceTrack(t,n)}async getRemoteSSRC(t){return this._p2pConnection.getRemoteSSRC(t)}logSDPExchange(t,n,i,o){if(L("SDP_LOGGING"))return S.upload("exchanging ".concat(i," ").concat(n," SDP during DataChannelConnection.").concat(o,`
`),t),n==="offer"?l=>{this.logSDPExchange(l,"answer",i==="local"?"remote":"local",o)}:void 0}static resolvePCConfiguration(t){const n={iceServers:[]};return t.iceServers?n.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(yd(t.turnServer.servers)?n.iceServers=t.turnServer.servers:(n.iceServers&&n.iceServers.push(...nw.turnServerConfigToIceServers(t.turnServer.servers)),L("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&t.turnServer.serversFromGateway&&n.iceServers.push(...nw.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),L("FORCE_TURN_TCP")?n.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(i=>{i.forceturn&&(n.iceTransportPolicy="relay")}))),L("ENABLE_ENCODED_TRANSFORM")&&wt().supportWebRTCEncodedTransform&&(n.encodedInsertableStreams=!0),n}static turnServerConfigToIceServers(t){const n=[];return t.forEach(i=>{i.security?i.tcpport&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turns:".concat(to(i.turnServerURL),":").concat(i.tcpport,"?transport=tcp")}):(i.udpport&&!L("FORCE_TURN_TCP")&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.udpport,"?transport=udp")}),i.tcpport&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.tcpport,"?transport=tcp")}))}),n}bindPCEvents(){this._p2pConnection.onICEConnectionStateChange=t=>{var n;return(n=this.onICEConnectionStateChange)===null||n===void 0?void 0:n.call(this,t)},this._p2pConnection.onConnectionStateChange=t=>{var n;return(n=this.onConnectionStateChange)===null||n===void 0?void 0:n.call(this,t)},this._p2pConnection.onDTLSTransportStateChange=t=>{var n;return(n=this.onDTLSTransportStateChange)===null||n===void 0?void 0:n.call(this,t)},this._p2pConnection.onDTLSTransportError=t=>{var n;return(n=this.onDTLSTransportError)===null||n===void 0?void 0:n.call(this,t)},this._p2pConnection.onICETransportStateChange=t=>{var n;return(n=this.onICETransportStateChange)===null||n===void 0?void 0:n.call(this,t)},this._p2pConnection.onFirstAudioReceived=t=>{var n;return(n=this.onFirstAudioReceived)===null||n===void 0?void 0:n.call(this,t)},this._p2pConnection.onFirstVideoReceived=t=>{var n;return(n=this.onFirstVideoReceived)===null||n===void 0?void 0:n.call(this,t)},this._p2pConnection.onFirstAudioDecoded=t=>{var n;return(n=this.onFirstAudioDecoded)===null||n===void 0?void 0:n.call(this,t)},this._p2pConnection.onFirstVideoRender=t=>{var n;return(n=this.onFirstVideoRender)===null||n===void 0?void 0:n.call(this,t)},this._p2pConnection.onFirstVideoBufferReady=t=>{var n;return(n=this.onFirstVideoBufferReady)===null||n===void 0?void 0:n.call(this,t)},this._p2pConnection.onFirstVideoDecoded=(t,n,i)=>{var o;return(o=this.onFirstVideoDecoded)===null||o===void 0?void 0:o.call(this,t,n,i)},this._p2pConnection.onFirstVideoDecodedTimeout=t=>{var n;return(n=this.onFirstVideoDecodedTimeout)===null||n===void 0?void 0:n.call(this,t)},this._p2pConnection.onSelectedLocalCandidateChanged=(t,n)=>{var i;return(i=this.onSelectedLocalCandidateChanged)===null||i===void 0?void 0:i.call(this,t,n)},this._p2pConnection.onSelectedRemoteCandidateChanged=(t,n)=>{var i;return(i=this.onSelectedRemoteCandidateChanged)===null||i===void 0?void 0:i.call(this,t,n)}}closeSignal(){this.dataChannel.close(),this.peerConnection.close()}unbindConnectionEvents(t){t.onConnectionStateChange=void 0,t.onICEConnectionStateChange=void 0,t.onICETransportStateChange=void 0,t.onDTLSTransportStateChange=void 0,t.onDTLSTransportError=void 0,t.onFirstAudioDecoded=void 0,t.onFirstAudioReceived=void 0,t.onFirstVideoDecoded=void 0,t.onFirstVideoReceived=void 0,t.onSelectedLocalCandidateChanged=void 0,t.onSelectedRemoteCandidateChanged=void 0,t.onFirstVideoDecodedTimeout=void 0}setConfiguration(t){this._p2pConnection.setConfiguration(t)}},Ce($t.prototype,"connect",[Xi],Object.getOwnPropertyDescriptor($t.prototype,"connect"),$t.prototype),Ce($t.prototype,"updateRemoteRTPCapabilities",[Xi],Object.getOwnPropertyDescriptor($t.prototype,"updateRemoteRTPCapabilities"),$t.prototype),Ce($t.prototype,"createDataChannels",[Xi],Object.getOwnPropertyDescriptor($t.prototype,"createDataChannels"),$t.prototype),Ce($t.prototype,"receive",[Xi],Object.getOwnPropertyDescriptor($t.prototype,"receive"),$t.prototype),Ce($t.prototype,"stopReceiving",[Xi],Object.getOwnPropertyDescriptor($t.prototype,"stopReceiving"),$t.prototype),Ce($t.prototype,"muteRemote",[Xi],Object.getOwnPropertyDescriptor($t.prototype,"muteRemote"),$t.prototype),Ce($t.prototype,"unmuteRemote",[Xi],Object.getOwnPropertyDescriptor($t.prototype,"unmuteRemote"),$t.prototype),Ce($t.prototype,"muteLocal",[Xi],Object.getOwnPropertyDescriptor($t.prototype,"muteLocal"),$t.prototype),Ce($t.prototype,"unmuteLocal",[Xi],Object.getOwnPropertyDescriptor($t.prototype,"unmuteLocal"),$t.prototype),Ce($t.prototype,"close",[Xi],Object.getOwnPropertyDescriptor($t.prototype,"close"),$t.prototype),Ce($t.prototype,"updateEncoderConfig",[Xi],Object.getOwnPropertyDescriptor($t.prototype,"updateEncoderConfig"),$t.prototype),Ce($t.prototype,"updateSendParameters",[Xi],Object.getOwnPropertyDescriptor($t.prototype,"updateSendParameters"),$t.prototype),Ce($t.prototype,"replaceTrack",[Xi],Object.getOwnPropertyDescriptor($t.prototype,"replaceTrack"),$t.prototype),Ce($t.prototype,"getRemoteSSRC",[Xi],Object.getOwnPropertyDescriptor($t.prototype,"getRemoteSSRC"),$t.prototype),$t);function Xi(e,t,n){const i=e[t];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const o=this.mutex,l=await o.lock("From DataChannelConnection.".concat(t));try{for(var d=arguments.length,h=new Array(d),f=0;f<d;f++)h[f]=arguments[f];return await i.apply(this,h)}finally{l()}},n}function zH(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}class Pue extends Tn{get url(){return this._url?this._url:null}get reconnectMode(){return this._reconnectMode}set reconnectMode(t){var n;me(n=["tryNext","recover"]).call(n,t)&&this.resetReconnectCount(t),this._reconnectMode=t}get state(){return this._state}set state(t){t!==this._state&&(this._state=t,this._state==="reconnecting"?this.emit(hr.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(hr.CONNECTED):this._state==="closed"?this.emit(hr.CLOSED):this._state==="failed"&&this.emit(hr.FAILED))}constructor(t,n,i,o){super(),x(this,"connectionID",0),x(this,"currentURLIndex",0),x(this,"reconnectReason",void 0),x(this,"_reconnectMode","tryNext"),x(this,"_initMutex",void 0),x(this,"_name",void 0),x(this,"_state","closed"),x(this,"_reconnectInterrupter",void 0),x(this,"_url",void 0),x(this,"_retryConfig",void 0),x(this,"_reconnectCount",0),x(this,"_forceCloseTimeout",5e3),x(this,"_onlineReconnectListener",void 0),x(this,"_closeEstablishingTransmitter",()=>{}),x(this,"_store",void 0),x(this,"_joinChannelServiceRecordIndex",void 0),x(this,"_transmitter",void 0),x(this,"_useCompress",void 0),x(this,"_inflateLength",0),x(this,"_deflateLength",0),this._store=o,this._name=t,this._retryConfig=function(l){for(var d=1;d<arguments.length;d++){var h=arguments[d]!=null?arguments[d]:{};d%2?zH(Object(h),!0).forEach(function(f){x(l,f,h[f])}):Object.getOwnPropertyDescriptors?Object.defineProperties(l,Object.getOwnPropertyDescriptors(h)):zH(Object(h)).forEach(function(f){Object.defineProperty(l,f,Object.getOwnPropertyDescriptor(h,f))})}return l}({},n),this._useCompress=i}resetReconnectCount(t){S.debug("".concat(this._name," reset reconnect count, reason: ").concat(t)),this._reconnectCount=0}close(t,n){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this._reconnectInterrupter&&this._reconnectInterrupter(),this._transmitter){this._transmitter.onclose=null,this._transmitter.onopen=null,this._transmitter.onmessage=null;const i=this._transmitter;n?setTimeout(()=>i.close(),500):i.close(),this._transmitter=void 0}this.state=t?"failed":"closed",this._closeEstablishingTransmitter&&this._closeEstablishingTransmitter()}reconnect(t,n){if(!this._transmitter)return void S.warning("[".concat(this._name,"] can not reconnect, no websocket"));var i;t!==void 0&&(this.reconnectMode=t),S.debug("[".concat(this._name,"] reconnect is triggered initiative")),typeof this._joinChannelServiceRecordIndex=="number"&&((i=this._store)===null||i===void 0||i.recordJoinChannelService({status:"error",errors:[new Error(n)]},this._joinChannelServiceRecordIndex));const o=this._transmitter.onclose;this._transmitter.onclose=null,this._transmitter.close(),o&&o.bind(this._transmitter)({code:9999,reason:n})}getInflateData(){const t=this._inflateLength,n=this._deflateLength;return this.clearInflateData(),{inflateLength:t,deflateLength:n}}setInflateData(t){this._deflateLength=this._deflateLength+t.originLength,this._inflateLength=this._inflateLength+t.compressedLength}clearInflateData(){this._inflateLength=0,this._deflateLength=0}}let Go=function(e){return e[e.Default=0]="Default",e[e.Ack=1]="Ack",e}({});class Mue{constructor(t,n,i){x(this,"version",1),x(this,"initialRTO",void 0),x(this,"maxBatchAckCount",void 0),x(this,"maxRTO",void 0),x(this,"initialRTT",void 0),x(this,"ID",void 0),x(this,"rtt",void 0),x(this,"packetNumber",1),x(this,"rtoRatioMap",new Map),x(this,"timeoutMap",new Map),x(this,"unorderedPacketQueue",[]),x(this,"batchAckPacketQueue",[]),x(this,"lastOrderedPacketNumber",0),x(this,"batchAckTimer",void 0),x(this,"sendImpl",void 0),x(this,"receiveImpl",void 0),this.sendImpl=t,this.receiveImpl=n,this.ID=zt(7,"transmitter-"),this.initialRTO=(i==null?void 0:i.initialRTO)!==void 0?i.initialRTO:L("TRANSMITTER_INITIAL_RTO"),this.initialRTT=(i==null?void 0:i.initialRTT)!==void 0?i.initialRTT:L("TRANSMITTER_INITIAL_RTT"),this.rtt=(i==null?void 0:i.initialRTT)!==void 0?i.initialRTT:L("TRANSMITTER_INITIAL_RTT"),this.maxBatchAckCount=(i==null?void 0:i.maxBatchAckCount)!==void 0?i.maxBatchAckCount:L("TRANSMITTER_MAX_BATCH_ACK_COUNT"),this.maxRTO=(i==null?void 0:i.maxRTO)!==void 0?i.maxRTO:L("TRANSMITTER_MAX_RTO")}packetize(t,n){return{type:Go.Default,version:this.version,packetNumber:n,payload:t}}serialize(t){switch(t.type){case Go.Default:{let n;typeof t.payload=="string"?n=new TextEncoder().encode(t.payload):n=t.payload;const i=new ArrayBuffer(n.length+15),o=new DataView(i);return o.setUint16(0,t.version),o.setUint8(2,t.type),o.setUint32(3,t.packetNumber),YM(o,7,BigInt(t.sendTs)),new Uint8Array(o.buffer).set(n,15),i}case Go.Ack:{const n=new ArrayBuffer(16),i=new DataView(n);return i.setUint16(0,t.version),i.setUint8(2,t.type),i.setUint32(3,t.maxAckPacketNumber),i.setUint8(7,t.shift),YM(i,8,BigInt(t.ackSendTs)),n}}}deserialize(t){const n=new DataView(t),i=n.getUint16(0),o=n.getUint8(2);switch(o){case Go.Default:{const l=n.getUint32(3),d=WM(n,7),h=t.slice(15),f=new Uint8Array(h);return{version:i,type:o,packetNumber:l,sendTs:Number(d),payload:f}}case Go.Ack:{const l=n.getUint32(3),d=n.getUint8(7),h=WM(n,8);return{version:i,type:o,maxAckPacketNumber:l,shift:d,ackSendTs:Number(h)}}default:throw S.error("[".concat(this.ID,"] Unrecognized packet type ").concat(o)),new Error("Unrecognized packet type ".concat(o))}}sendMessage(t){L("DC_DEBUG_LOG")&&typeof t=="string"&&S.debug("[".concat(this.ID,"] sending message packet"),JSON.parse(t));const n=this.packetize(t,this.packetNumber);this.packetNumber=this.packetNumber===4294967295?1:this.packetNumber+1;const i=this.calculateRTO(n),o=window.setTimeout(()=>{this.resendMessage(n)},i);this.timeoutMap.set(n.packetNumber,o),this.sendPacket(n)}onData(t){const n=this.deserialize(t);n.type===Go.Default?this.ack(n):n.type===Go.Ack&&(this.updateRTT(n,Math.round(performance.now())),this.clearRTO(n))}close(){this.rtt=this.initialRTT,this.packetNumber=1,Array.from(this.timeoutMap.entries()).forEach(t=>{let[n,i]=t;window.clearTimeout(i)}),this.timeoutMap=new Map,this.rtoRatioMap=new Map,this.unorderedPacketQueue=[],this.batchAckPacketQueue=[],this.lastOrderedPacketNumber=0,this.batchAckTimer!==void 0&&window.clearTimeout(this.batchAckTimer)}resendMessage(t){const n=this.calculateRTO(t),i=window.setTimeout(()=>{L("DC_DEBUG_LOG")&&typeof t.payload=="string"&&S.debug("[".concat(this.ID,"] resending message packet"),JSON.parse(t.payload),"timeout: ".concat(n)),this.resendMessage(t)},n);this.timeoutMap.set(t.packetNumber,i),this.sendPacket(t)}calculateRTO(t){const n=this.rtoRatioMap.get(t.packetNumber);if(n===void 0)return this.rtoRatioMap.set(t.packetNumber,1),this.initialRTO;{const i=9*this.rtt/8*n;return this.rtoRatioMap.set(t.packetNumber,n+1),i>this.maxRTO?this.maxRTO:i}}updateRTT(t,n){const i=t.ackSendTs;this.rtt=this.rtt*(7/8)+(n-i-this.rtt)/8}ack(t){if(t.packetNumber===this.lastOrderedPacketNumber+1)for(this.batchAckPacketQueue.length>=this.maxBatchAckCount&&this.batchAck(),this.batchAckTimer?this.batchAckPacketQueue.push(t):(this.batchAckPacketQueue.push(t),this.batchAckTimer=window.setTimeout(()=>{this.batchAck()},this.rtt/8)),this.lastOrderedPacketNumber+=1,this.receiveImpl(t.payload);;){const n=this.unorderedPacketQueue[0];if(!n){this.unorderedPacketQueue.shift();break}this.batchAckTimer&&this.batchAck(),this.receiveImpl(n.payload),this.unorderedPacketQueue.shift(),this.lastOrderedPacketNumber+=1}else if(t.packetNumber<=this.lastOrderedPacketNumber){const n={ackSendTs:t.sendTs,maxAckPacketNumber:t.packetNumber,shift:0,type:Go.Ack,version:this.version};L("DC_DEBUG_LOG")&&S.debug("[".concat(this.ID,"] sending ack packet"),n,"packetNumber: ".concat(t.packetNumber)),this.sendPacket(n)}else if(t.packetNumber>this.lastOrderedPacketNumber){this.unorderedPacketQueue[t.packetNumber-this.lastOrderedPacketNumber-2]=t;const n={ackSendTs:t.sendTs,maxAckPacketNumber:t.packetNumber,shift:0,type:Go.Ack,version:this.version};L("DC_DEBUG_LOG")&&S.debug("[".concat(this.ID,"] sending ack packet"),n,"packetNumber: ".concat(t.packetNumber)),this.sendPacket(n)}}batchAck(){window.clearTimeout(this.batchAckTimer),this.batchAckTimer=void 0;const t={ackSendTs:this.batchAckPacketQueue[this.batchAckPacketQueue.length-1].sendTs,maxAckPacketNumber:this.batchAckPacketQueue[this.batchAckPacketQueue.length-1].packetNumber,shift:this.batchAckPacketQueue.length-1,type:Go.Ack,version:this.version};L("DC_DEBUG_LOG")&&S.debug("[".concat(this.ID,"] sending batch ack packet"),t,"shift: ".concat(this.batchAckPacketQueue.length-1)),this.sendPacket(t),this.batchAckPacketQueue=[]}sendPacket(t){t.type===Go.Default&&(t.sendTs=Math.round(performance.now()));const n=this.serialize(t);this.sendImpl(n)}clearRTO(t){for(let n=t.maxAckPacketNumber-t.shift;n<=t.maxAckPacketNumber;n++){const i=this.timeoutMap.get(n);i!==void 0&&window.clearTimeout(i),this.timeoutMap.delete(n),this.rtoRatioMap.delete(n)}}}class qH extends Pue{constructor(t,n){super(t,n,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3?arguments[3]:void 0),x(this,"_initMutex",void 0),x(this,"_reconnectInterrupter",void 0),x(this,"_url",void 0),x(this,"_transmitter",void 0),x(this,"_addresses",void 0),x(this,"_reliableTransmission",void 0),x(this,"_textEncoder",void 0),x(this,"_textDecoder",void 0),this._textEncoder=new TextEncoder,this._textDecoder=new TextDecoder,this._initMutex=new Lr("datachannel");const{timeout:i,timeoutFactor:o}=n,l=Math.max(300,Math.floor(3*i/5)),d=Math.max(1.2,Math.floor(8*o)/10);Us.ONLINE&&(this._retryConfig.timeout=l,this._retryConfig.timeoutFactor=d),Ln.on(wd.NETWORK_STATE_CHANGE,(h,f)=>{h!==f&&(this.resetReconnectCount("network state change: ".concat(f," -> ").concat(h)),h===Us.ONLINE?(this._retryConfig.timeout=l,this._retryConfig.timeoutFactor=d):(this._retryConfig.timeout=i,this._retryConfig.timeoutFactor=o))})}getConnection(){if(this._reliableTransmission)return this._reliableTransmission}async init(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;this._forceCloseTimeout=n;const i=(o,l)=>{this._addresses=t,this.currentURLIndex=this._addresses.findIndex(h=>h.fingerprint||L("FINGERPRINT"));const d=this._addresses[this.currentURLIndex];this.state="connecting",this.createTransmitterConnection(d).then(o).catch(l),this.once(hr.CLOSED,()=>l(new se(P.WS_DISCONNECT))),this.once(hr.CONNECTED,()=>o())};return this._initMutex.lock().then(o=>new be((l,d)=>{i(l,d)}).then(()=>{o()}).catch(()=>{o()}))}async sendMessage(t){let n=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this._transmitter||!this._reliableTransmission)throw new se(P.WS_ABORT,"datachannel is not ready");try{n||(t=JSON.stringify(t));const i=this._textEncoder.encode(t),o=Xde(i,{raw:!0});this._reliableTransmission.sendMessage(o)}catch(i){throw new se(P.WS_ERR,"send datachannel signal message error"+i.toString())}}unbindDcCloseEventListener(){this._transmitter&&(this._transmitter.onclose=null)}sendMessageWithJSON(t){const n=JSON.stringify(t);return{compressed:n,compressedLength:n.length,origin:t}}sendMessageWithUint8Array(t){return{compressed:t,compressedLength:t.byteLength,origin:t}}createTransmitterConnection(t){return this.connectionID+=1,this._joinChannelServiceRecordIndex=void 0,this._url="dc://".concat(t.ip,":").concat(t.port),new be((n,i)=>{var o;const l=()=>{S.debug("[".concat(this._name,"] datachannel opened:"),this._url),this.reconnectMode="recover",this.state="connected",this.resetReconnectCount("opened"),n()},d=async _=>{var v;if((v=this._closeEstablishingTransmitter)===null||v===void 0||v.call(this),S.debug("[".concat(this._name,"] datachannel close ").concat(this._url,", code: ").concat(_.code,", reason: ").concat(_.reason,", current mode: ").concat(this.reconnectMode)),this._reconnectCount<this._retryConfig.maxRetryCount){this.state==="connected"&&(this.reconnectReason=_.reason,this.state="reconnecting");const y=Ni(this,hr.WILL_RECONNECT,this.reconnectMode)||this.reconnectMode,b=await this.reconnectWithAction(y);if(this.state==="closed")return void S.debug("[".concat(this.connectionID,"] dc is closed, no need to reconnect"));if(!b)return i(new se(P.WS_DISCONNECT,"datachannel reconnect failed: ".concat(_.code))),void this.close(!0);n()}else i(new se(P.WS_DISCONNECT,"datachannel close: ".concat(_.code))),this.close()},h=async _=>{try{var v;(v=this._reliableTransmission)===null||v===void 0||v.onData(_.data)}catch(y){console.log(y)}};this._transmitter&&(this._transmitter.onclose=null,this._transmitter.close()),this._reliableTransmission&&(this._reliableTransmission.close(),this._reliableTransmission=void 0),S.debug("[".concat(this._name,"] start connect, address: ").concat(JSON.stringify(t)));const f=(o=this._store)===null||o===void 0?void 0:o.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"}),g=Date.now();ir(this,hr.TO_CONNECT_DATACHANNEL).then(_=>{var v,y;if(!_)throw new Error("transmissonInfo not exist yet");const{transmitter:b,close:D}=_;this._transmitter=b,(v=this._store)===null||v===void 0||v.signalChannelOpen();const I=Date.now()-g;S.debug("[choose dc] dc open cost ".concat(I,"ms")),this._reliableTransmission=new Mue(O=>{var U;this._transmitter&&this._transmitter.readyState==="open"&&((U=this._transmitter)===null||U===void 0||U.send(O))},O=>{if(typeof O=="string")this.emit(hr.ON_MESSAGE,O);else{const U=$de(O,{raw:!0}).buffer,j=this._textDecoder.decode(U);this.emit(hr.ON_MESSAGE,j)}}),this._closeEstablishingTransmitter=()=>{var O;(O=this._reliableTransmission)===null||O===void 0||O.close(),this._reliableTransmission=void 0,D()},l&&l(),b.onclose=d,b.onmessage=h,(y=this._store)===null||y===void 0||y.recordJoinChannelService({endTs:Date.now(),status:"success"},f),this._joinChannelServiceRecordIndex=f}).catch(_=>{var v;if((v=this._store)===null||v===void 0||v.recordJoinChannelService({endTs:Date.now(),status:_ instanceof se&&_.code===P.WS_ABORT?"aborted":"error",errors:[_]},f),this.state!=="closed"){if(_ instanceof se&&_.code===P.WS_ERR){const y=new se(P.WS_ERR,"init datachannel failed! Error: ".concat(_.toString()));return S.error("[".concat(this._name,"]").concat(y)),void i(y)}d&&d(_)}else i(new se(P.WS_DISCONNECT,"datachannel is closed: ".concat(_.toString())))})})}async reconnectWithAction(t){let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this._reconnectCount>=this._retryConfig.maxRetryCount||!this._addresses||this.state==="closed")return!1;this._onlineReconnectListener||Ln.networkState!==Us.OFFLINE||(this._onlineReconnectListener=Ln.onlineWaiter&&Ln.onlineWaiter.then(()=>{this._onlineReconnectListener=void 0}));let i=!0;if(this._reconnectInterrupter=()=>{i=!1},n){const h=wv(this._reconnectCount,this._retryConfig);S.debug("[".concat(this._name,"] wait ").concat(h,"ms to reconnect datachannel, mode: ").concat(t)),await be.race([Sr(h),this._onlineReconnectListener||new be(()=>{})])}if(this.state==="closed"||!i)return!1;this._reconnectCount+=1;const o=async(h,f)=>{this.emit(hr.RECONNECT_CREATE_CONNECTION,f),await this.createTransmitterConnection(h)};try{if(t==="retry"){const h=this._addresses[this.currentURLIndex];await o(h,t)}else if(t==="tryNext"){this.currentURLIndex+=1;for(let f=this.currentURLIndex;f<this._addresses.length;f++){if(this._addresses[f].fingerprint||L("FINGERPRINT")){this.currentURLIndex=f;break}this.currentURLIndex+=1}if(this.currentURLIndex>=this._addresses.length)return S.debug("[".concat(this._name,"] the available addresses are exhausted, change to recover")),await this.reconnectWithAction("recover",!1);S.debug("[".concat(this._name,"] datachannel url length: ").concat(this._addresses.length," current index: ").concat(this.currentURLIndex));const h=this._addresses[this.currentURLIndex];await o(h,t)}else t==="recover"&&(S.debug("[".concat(this._name,"] start to failback to websocket")),this.resetReconnectCount("recover mode"),this.emit(hr.FAILBACK));return!0}catch(h){var l,d;return S.error("[".concat(this._name,"] reconnect failed"),h.toString()),h!=null&&(l=h.data)!==null&&l!==void 0&&l.desc&&Array.isArray(h.data.desc)&&h.data.desc.length&&me(d=h.data.desc).call(d,"dynamic key expired")?(this.emit(hr.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):await this.reconnectWithAction(t,n)}}}class Fue extends Tn{get connectionState(){return this._connectionState}set connectionState(t){t!==this._connectionState&&(this._connectionState=t,t===Tt.CONNECTED?this.emit(Ue.WS_CONNECTED):t===Tt.RECONNECTING?this.emit(Ue.WS_RECONNECTING,this._websocketReconnectReason):t===Tt.CLOSED&&this.emit(Ue.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket?this.websocket.url:null}get rtt(){return this.rttRolling.mean()}processPendingNotifications(){this.pendingNotifications.length!==0&&(S.debug("[".concat(this.clientId,"] processing ").concat(this.pendingNotifications.length," pending notifications")),this.pendingNotifications.forEach(t=>{let{type:n,message:i}=t;this.emit(n,i),n===nt.ON_NOTIFICATION&&this.handleNotification(i),n===nt.ON_USER_BANNED&&this.handleUserBanned(i)}),this.pendingNotifications=[])}handleUserBanned(t){switch(t.error_code){case 14:this.close(Ct.UID_BANNED);break;case 15:this.close(Ct.IP_BANNED);break;case 16:this.close(Ct.CHANNEL_BANNED)}}constructor(t,n){super(),x(this,"__name__","DataChannelSignal"),x(this,"_disconnectedReason",void 0),x(this,"_websocketReconnectReason",void 0),x(this,"_connectionState",Tt.CLOSED),x(this,"reconnectToken",void 0),x(this,"websocket",void 0),x(this,"openConnectionTime",void 0),x(this,"clientId",void 0),x(this,"lastMsgTime",Date.now()),x(this,"uploadCache",[]),x(this,"uploadCacheInterval",void 0),x(this,"rttRolling",new ZT(5)),x(this,"pingpongTimer",void 0),x(this,"inflateDataTimer",void 0),x(this,"pingpongTimeoutCount",0),x(this,"ortc",void 0),x(this,"joinResponse",void 0),x(this,"multiIpOption",void 0),x(this,"initError",void 0),x(this,"spec",void 0),x(this,"store",void 0),x(this,"isJoining",!1),x(this,"pendingNotifications",[]),x(this,"onWebsocketMessage",i=>{if(i instanceof ArrayBuffer)return void this.emit(Ue.ON_BINARY_DATA,i);const o=JSON.parse(i);if(L("DC_DEBUG_LOG")&&S.debug("[datachannel-signal] received packet",o),this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(o,"_id")){const l="res-@".concat(o._id);this.emit(l,o._result,o._message)}else Object.prototype.hasOwnProperty.call(o,"_type")&&(this.isJoining?o._type===nt.ON_NOTIFICATION||o._type===nt.ON_USER_BANNED?(this.emit(o._type,o._message),o._type===nt.ON_NOTIFICATION&&this.handleNotification(o._message),o._type===nt.ON_USER_BANNED&&this.handleUserBanned(o._message)):(this.pendingNotifications.push({type:o._type,message:o._message}),S.debug("[".concat(this.clientId,"] cached notification during join: ").concat(o._type))):(this.emit(o._type,o._message),o._type===nt.ON_NOTIFICATION&&this.handleNotification(o._message),o._type===nt.ON_USER_BANNED&&this.handleUserBanned(o._message)))}),this.clientId=t.clientId,this.spec=t,this.store=n,this.websocket=new qH("gateway-".concat(this.clientId),this.spec.retryConfig,!0,n),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===Tt.CONNECTED&&this.reconnect("retry",zl.OFFLINE)})}async request(t,n,i,o){const l=zt(6,""),d={_id:l,_type:t,_message:n},h=this.websocket.connectionID,f=()=>new be((D,I)=>{if(this.connectionState===Tt.CONNECTED)return D();const O=()=>{this.off(Ue.WS_CLOSED,U),D()},U=()=>{this.off(Ue.WS_CONNECTED,O),I(new se(P.WS_ABORT))};this.once(Ue.WS_CONNECTED,O),this.once(Ue.WS_CLOSED,U),t!==je.PUBLISH&&t!==je.SUBSCRIBE&&t!==je.UNSUBSCRIBE&&t!==je.UNPUBLISH&&t!==je.CONTROL&&t!==je.RESTART_ICE||this.once(Ue.DISCONNECT_P2P,()=>{I(new se(P.DISCONNECT_P2P))}),t!==je.PUBLISH&&t!==je.RESTART_ICE||this.once(Ue.ABORT_P2P_EXECUTION,()=>{I(new se(P.DISCONNECT_P2P))})});if(this.connectionState!==Tt.CONNECTING&&this.connectionState!==Tt.RECONNECTING||t===je.JOIN||t===je.REJOIN||await f(),t===je.LEAVE&&(this.websocket.unbindDcCloseEventListener(),o=!0),L("DC_DEBUG_LOG")&&S.debug("[datachannel-signal] sendMessage",d),await this.websocket.sendMessage(d,!0,!1),o)return;const g=new be((D,I)=>{let O=!1;const U=(G,$)=>{O=!0,D({isSuccess:G==="success",message:$||{}}),this.off(Ue.WS_CLOSED,j),this.off(Ue.WS_RECONNECTING,j),this.emit(Ue.REQUEST_SUCCESS,t,n)};this.once("res-@".concat(l),U);const j=()=>{I(new se(P.WS_ABORT,"type: ".concat(t))),this.off(Ue.WS_CLOSED,j),this.off(Ue.WS_RECONNECTING,j),this.off("res-@".concat(l),U)};this.once(Ue.WS_CLOSED,j),this.once(Ue.WS_RECONNECTING,j),Sr(L("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==h||O||(S.warning("dc request timeout, type: ".concat(t)),this.emit(Ue.REQUEST_TIMEOUT,t,n))})});let _=null;try{_=await g}catch(D){if(this.connectionState===Tt.CLOSED||t===je.LEAVE)throw new se(P.WS_ABORT);return!this.spec.forceWaitGatewayResponse||i?D.throw():t===je.JOIN||t===je.REJOIN?null:(await f(),await this.request(t,n))}if(_.isSuccess)return _.message;const v=Number(_.message.error_code||_.message.code),y=Md(v),b=new se(P.UNEXPECTED_RESPONSE,"".concat(y.desc,": ").concat(_.message.error_str),{code:v,data:_.message});return y.action==="success"?_.message:(S.warning("[".concat(this.websocket.connectionID,"] unexpected response from type ").concat(t,", error_code: ").concat(v,", message: ").concat(y.desc,", action: ").concat(y.action)),v===Ke.ERR_TOO_MANY_BROADCASTERS?((t===je.JOIN||t===je.REJOIN)&&(this.initError=b,this.close()),b.throw()):y.action==="failed"?b.throw():y.action==="quit"?(this.initError=b,this.close(),b.throw()):(v===Ke.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=_.message.option,S.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",zl.MULTI_IP)):this.reconnect(y.action,zl.SERVER_ERROR),t===je.JOIN||t===je.REJOIN?null:await this.request(t,n)))}waitMessage(t,n){return new be(i=>{const o=l=>{(!n||n(l))&&(this.off(t,o),i(l))};this.on(t,o)})}uploadWRTCStats(t){if(!this.store.sessionId)return void S.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const n={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:t};this.upload(Pd.WRTC_STATS,n)}upload(t,n){const i={_type:t,_message:n};try{this.websocket.sendMessage(i)}catch{const l=L("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(i),this.uploadCache.length>l&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==Tt.CONNECTED)return;const d=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(d._type,d._message)},L("UPLOAD_CACHE_INTERVAL")||2e3))}}async send(t,n){const i={_type:t,_message:n};await this.websocket.sendMessage(i)}init(t){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new be((n,i)=>{this.once(Ue.WS_CONNECTED,()=>n(this.joinResponse)),this.once(Ue.WS_CLOSED,()=>i(this.initError||new se(P.WS_ABORT))),this.connectionState=Tt.CONNECTING,this.websocket.init(t).catch(i),this.websocket.once(hr.FAILBACK,()=>{i(new se(P.INIT_DATACHANNEL_TIMEOUT))}),this.inflateDataTimer&&window.clearInterval(this.inflateDataTimer),this.inflateDataTimer=window.setInterval(()=>{this.handleInflateData()},2e4),setTimeout(()=>{this.openConnectionTime===void 0&&(S.debug("[".concat(this.clientId,"] init datachannel timeout while join with failback to websocket")),i(new se(P.INIT_DATACHANNEL_TIMEOUT)))},L("DC_JOIN_WITH_FAILBACK"))})}close(t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.inflateDataTimer&&(this.handleInflateData(),window.clearInterval(this.inflateDataTimer),this.inflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this.isJoining=!1,this.pendingNotifications=[],this._disconnectedReason=t||Ct.LEAVE,this.connectionState=Tt.CLOSED,S.debug("[".concat(this.clientId,"] ")+"will close datachannel in signal"),this.websocket.close(),t===Ct.FALLBACK&&(this.websocket.removeAllListeners(),this.websocket=new qH("gateway-".concat(this.clientId),this.spec.retryConfig,!0,this.store),this.handleWebsocketEvents())}async join(){if(this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),L("DC_PINGPONG_INTERVAL")),!this.joinResponse){this.emit(Ue.ABORT_P2P_EXECUTION),this.store.signalConnected();const t=await ir(this,Ue.REQUEST_JOIN_INFO);this.store.joinReq(),this.isJoining=!0,this.pendingNotifications=[];const n=await this.request(je.JOIN,t);if(this.store.joinRep(),this.ortc=t==null?void 0:t.ortc,!n)return this.emit(Ue.REPORT_JOIN_GATEWAY,P.TIMEOUT,this.url||""),!1;this.joinResponse=n,this.emit(Ue.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=Tt.CONNECTED,this.isJoining=!1,this.processPendingNotifications(),!0}async rejoin(){if(!this.reconnectToken)throw new se(P.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const t=bd(this,Ue.REQUEST_REJOIN_INFO);t.token=this.reconnectToken;const n=await this.request(je.REJOIN,t);return!!n&&(this.connectionState=Tt.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),L("DC_PINGPONG_INTERVAL")),n.peers&&n.peers.forEach(i=>{this.emit(nt.ON_USER_ONLINE,{uid:i.uid}),i.audio&&this.emit(nt.ON_ADD_AUDIO_STREAM,{uid:i.uid,uint_id:i.uint_id,audio:!0,ssrcId:i.audio_ssrc}),i.video&&this.emit(nt.ON_ADD_VIDEO_STREAM,{uid:i.uid,uint_id:i.uint_id,video:!0,ssrcId:i.video_ssrc}),i.audio_mute?this.emit(nt.MUTE_AUDIO,{uid:i.uid}):this.emit(nt.UNMUTE_AUDIO,{uid:i.uid}),i.video_mute?this.emit(nt.MUTE_VIDEO,{uid:i.uid}):this.emit(nt.UNMUTE_VIDEO,{uid:i.uid}),i.audio_enable_local?this.emit(nt.ENABLE_LOCAL_AUDIO,{uid:i.uid}):this.emit(nt.DISABLE_LOCAL_AUDIO,{uid:i.uid}),i.video_enable_local?this.emit(nt.ENABLE_LOCAL_VIDEO,{uid:i.uid}):this.emit(nt.DISABLE_LOCAL_VIDEO,{uid:i.uid}),i.audio||i.video||this.emit(nt.ON_REMOVE_STREAM,{uid:i.uid,uint_id:i.uint_id})}),!0)}reconnect(t,n){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(t,n)}async downgradeCodec(t){if(!this.ortc)return!1;const n={downgrade_codec:t,ortc:this.ortc};return!!await this.request(je.DOWNGRADE_CODEC,n)}handleNotification(t){S.debug("[".concat(this.clientId,"] receive notification: "),t);const n=Md(t.code);if(n.action!=="success"){if(n.action!=="failed")return n.action==="quit"?(n.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(Ct.UID_BANNED),void this.close()):void this.reconnect(n.action,zl.SERVER_ERROR);S.error("[".concat(this.clientId,"] ignore error: "),n.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1,L("DC_DEBUG_LOG")&&console.debug("[datachannel-signal] pingpongTimeoutCount: ".concat(this.pingpongTimeoutCount));const t=L("PING_PONG_TIME_OUT"),n=Date.now();this.pingpongTimeoutCount>=t&&(S.warning("[datachannel-signal] PINGPONG Timeout. Last Socket Message: ".concat(n-this.lastMsgTime,"ms")),n-this.lastMsgTime>L("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("recover",zl.FALLBACK):this.request(je.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const i=Date.now()-n;this.rttRolling.add(i),L("REPORT_STATS")&&this.send(je.PING_BACK,{pingpongElapse:i})}).catch(i=>{})}handleInflateData(){const{inflateLength:t,deflateLength:n}=this.websocket.getInflateData();t!==0&&n!==0&&this.upload(Pd.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:n,ws_inflate_length:t})}handleWebsocketEvents(){this.websocket.on(hr.RECONNECT_CREATE_CONNECTION,t=>{this.emit(Ue.WS_RECONNECT_CREATE_CONNECTION,t)}),this.websocket.on(hr.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(hr.CLOSED,()=>{this.connectionState=Tt.CLOSED}),this.websocket.on(hr.FAILED,()=>{this._disconnectedReason=Ct.NETWORK_ERROR,this.connectionState=Tt.CLOSED}),this.websocket.on(hr.RECONNECTING,t=>{this._websocketReconnectReason=t,this.joinResponse=void 0,this.connectionState===Tt.CONNECTED?this.connectionState=Tt.RECONNECTING:this.connectionState=Tt.CONNECTING}),this.websocket.on(hr.WILL_RECONNECT,(t,n)=>{if(bd(this,Ue.IS_P2P_DISCONNECTED)&&t==="retry")return S.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),this.reconnectToken=void 0,this.emit(Ue.NEED_RENEW_SESSION),this.emit(Ue.DISCONNECT_P2P),n("tryNext");t!=="retry"&&(S.debug("".concat(this.clientId," websockt will_connect event, renewSession reconnectMode is ").concat(t)),this.reconnectToken=void 0,this.emit(Ue.NEED_RENEW_SESSION),this.emit(Ue.DISCONNECT_P2P)),n(t)}),this.websocket.on(hr.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(t=>{S.warning("[".concat(this.clientId,"] rejoin failed ").concat(t)),this.reconnect("tryNext",zl.SERVER_ERROR)}):this.join().catch(t=>{if(this.emit(Ue.REPORT_JOIN_GATEWAY,t.message||t.code,this.url||""),t instanceof se&&t.code===P.UNEXPECTED_RESPONSE&&t.data.code===Ke.ERR_NO_AUTHORIZED)return S.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",zl.SERVER_ERROR);S.error("[".concat(this.clientId,"] join gateway request failed"),t.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",zl.SERVER_ERROR):(this.initError=t,this.close())})}),this.websocket.on(hr.REQUEST_NEW_URLS,(t,n)=>{ir(this,Ue.REQUEST_RECOVER,this.multiIpOption).then(t).catch(n)}),this.websocket.on(hr.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(nt.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this.websocket.on(hr.TO_CONNECT_DATACHANNEL,(t,n)=>{ir(this,Ue.PRE_CONNECT_PC).then(t).catch(n)}),this.websocket.on(hr.FAILBACK,()=>{this.openConnectionTime!==void 0&&this.emit(Ue.DATACHANNEL_FAILBACK)})}}const jue={name:"DataChannelConnection",create:function(e){let{store:t,spec:n}=e;return new Uue(n,t)}},Vue={name:"DataChannelSignal",create:function(e){let{store:t,spec:n}=e;return new Fue(n,t)}};iR(),en("PROCESS_ID","process-".concat(zt(8,""),"-").concat(zt(4,""),"-").concat(zt(4,""),"-").concat(zt(4,""),"-").concat(zt(12,""))),function(){let e;try{e=window.localStorage.getItem("websdk_ng_global_parameter")}catch(t){return void S.error("Error loading sdk config",t.message)}if(e)try{const t=JSON.parse(window.atob(e)),n=Date.now();S.debug("Loading global parameters from cache",t),Object.keys(t).forEach(i=>{if(Object.prototype.hasOwnProperty.call(qt,i)){const{value:o,expires:l}=t[i];if(l&&l<=n)return;Vi[i]=o,qt[i]=o}})}catch(t){S.error("Error loading mutableParamsCache: ".concat(e),t.message)}}(),Array.isArray(Vi.AREAS)&&Vi.AREAS.length>0&&aI(Vi.AREAS,!0);const XH=(e,t,n)=>{S.debug("setParameter key:".concat(e,", value:").concat(JSON.stringify(t))),en(e,t,n)};Ec(rue,!1),Ec(aue,!1),Ec(UAe,!1),Ec(gue,!1),Ec(eue,!1),Ec(Nue,!1),Ec(Due,!1),Ec(kue,!1),Ec(jue,!1),Ec(Vue,!1);const ar=function(e){const t=new Tn,n=e,i={getListeners:t.getListeners.bind(t),on:(o,l)=>(function(d,h){d===mc.SECURITY_POLICY_VIOLATION&&S3(h,!0)}(o,l),t.on.bind(t)(o,l)),addListener:t.addListener.bind(t),once:t.once.bind(t),off:t.off.bind(t),removeAllListeners:t.removeAllListeners.bind(t),emit:t.emit.bind(t),safeEmit:t.safeEmit.bind(t)};return b3(b3({},n),i)}({__TRACK_LIST__:Nd,VERSION:Aa,BUILD:cR,ESM_BUNDLER:!1,ESM:!1,UMD:!0,DEV:!1,setParameter:XH,getParameter:L,getSupportedCodec:async function(){let e={audio:[],video:[]};try{let t=new RTCPeerConnection;const n=await async function(i){let o;return wt().supportUnifiedPlan?(i.addTransceiver("video",{direction:"recvonly"}),i.addTransceiver("audio",{direction:"recvonly"}),o=(await i.createOffer()).sdp):o=(await i.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0})).sdp,o}(t);if(!n)return e;t.close(),t=null,e=function(i){const o={video:[],audio:[]};return i.match(/ VP8/i)&&o.video.push("VP8"),i.match(/ VP9/i)&&o.video.push("VP9"),i.match(/ AV1/i)&&o.video.push("AV1"),i.match(/ H264/i)&&o.video.push("H264"),i.match(/ H265/i)&&o.video.push("H265"),i.match(/ opus/i)&&o.audio.push("OPUS"),i.match(/ PCMU/i)&&o.audio.push("PCMU"),i.match(/ PCMA/i)&&o.audio.push("PCMA"),i.match(/ G722/i)&&o.audio.push("G722"),o}(n)}catch(t){throw new se(P.CREATE_OFFER_FAILED,t.toString&&t.toString()).print()}return e},checkSystemRequirements:function(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];const t=ke.reportApiInvoke(null,{name:yn.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:an.TRACER}),n=function(){let l=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0],d=!1;try{const h=window.RTCPeerConnection,f=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,g=window.WebSocket;d=!(!h||!g),l&&!f&&(d=!1),d&&mm()&&LM(75)&&new h().close()}catch(h){S.error("check system requirement failed: ",h),d=!1}return d}(e),i=MAe();S.debug("checkSystemRequirements, api:",n,"browser",i);const o=n&&i;return t.onSuccess(o),L("IGNORE_RTC_DEVICE_CHECK")?n:o},getDevices:function(e){return Wi.enumerateDevices(!0,!0,e)},getMicrophones:function(e){return Wi.getRecordingDevices(e)},getCameras:function(e){return Wi.getCamerasDevices(e)},getElectronScreenSources:jF,getPlaybackDevices:function(e){return Wi.getSpeakers(e)},createClient:v3,createCameraVideoTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=L("CAMERA_CAPTURE_CONFIG"),n=zt(8,"track-cam-"),i=ke.reportApiInvoke(null,{id:n,tag:an.TRACER,name:yn.CREATE_CAM_VIDEO_TRACK,options:[fn({},e),t]});t&&(e.encoderConfig=t);const o=Lv(e);let l=null;S.info("start create camera video track with config",JSON.stringify(e),"trackId",n);try{l=(await Ki({video:o},n)).getVideoTracks()[0]||null}catch(h){throw i.onError(h),h}if(!l){const h=new ae(P.UNEXPECTED_ERROR,"can not find track in media stream");return i.onError(h),h.throw(S)}if(e.optimizationMode&&RR(n,l,e,$a(e.encoderConfig)),L("USE_STANDARD_BITRATE_DEFAULT")){const h=$a(e.encoderConfig);e.encoderConfig=h,delete h.bitrateMax,delete h.bitrateMin}const d=new Pv(l,e,o,e.scalabiltyMode?xv(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,n);return i.onSuccess(d.getTrackId()),S.info("create camera video success, trackId:",n),d},createCustomVideoTrack:function(e){const t=zt(8,"track-cus-"),n=ke.reportApiInvoke(null,{id:t,tag:an.TRACER,name:yn.CREATE_CUSTOM_VIDEO_TRACK,options:[e]});L("USE_STANDARD_BITRATE_DEFAULT")&&(delete e.bitrateMax,delete e.bitrateMin);const i=new on(e.mediaStreamTrack,{width:e.width,height:e.height,frameRate:e.frameRate,bitrateMax:e.bitrateMax,bitrateMin:e.bitrateMin},e.scalabiltyMode?xv(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,t,[Wt.CUSTOM_TRACK]);return n.onSuccess(i.getTrackId()),S.info("create custom video track success with config",e,"trackId",i.getTrackId()),i},createScreenVideoTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"disable";const n=typeof t=="object"?function(y){const b=XF(y);return NF()&&y.suppressLocalAudioPlayback&&(b.suppressLocalAudioPlayback=y.suppressLocalAudioPlayback),OF()&&y.restrictOwnAudio&&(b.restrictOwnAudio=!0),b}(t):void 0;n&&(t="auto");const i=zt(8,"track-scr-v-"),o=ke.reportApiInvoke(null,{id:i,tag:an.TRACER,name:yn.CREATE_SCREEN_VIDEO_TRACK,options:[fn({},e),t]});e.encoderConfig?typeof e.encoderConfig=="string"||e.encoderConfig.width&&e.encoderConfig.height||(e.encoderConfig.width={max:1920},e.encoderConfig.height={max:1080}):e.encoderConfig="1080p_2";const l=function(y){const b={};y.screenSourceType&&(b.mediaSource=y.screenSourceType),y.extensionId&&Kc()&&(b.extensionId=y.extensionId);const{displaySurface:D,selfBrowserSurface:I,surfaceSwitching:O,systemAudio:U,preferCurrentTab:j,windowAudio:G,monitorTypeSurfaces:$}=y;(dc(107)||Ed(107)||vd(93))&&(D&&(zn(D,"displaySurface",["browser","window","monitor"]),b.displaySurface=D),I?(zn(I,"selfBrowserSurface",["exclude","include"]),b.selfBrowserSurface=I):b.selfBrowserSurface="include",O&&(zn(O,"surfaceSwitching",["exclude","include"]),b.surfaceSwitching=O)),(dc(105)||Ed(105)||vd(91))&&U&&(zn(U,"systemAudio",["exclude","include"]),b.systemAudio=U),(dc(94)||Ed(94)||vd(80))&&j&&(b.preferCurrentTab=!0),(dc(141)||Ed(141)||vd(125))&&G&&(zn(G,"windowAudio",["exclude","system"]),b.windowAudio=G),(dc(119)||Ed(119)||vd(105))&&$&&(zn($,"monitorTypeSurfaces",["exclude","include"]),b.monitorTypeSurfaces=$),y.electronScreenSourceId&&(b.sourceId=y.electronScreenSourceId);const Z=y.encoderConfig?pR(y.encoderConfig):null;return b.mandatory={chromeMediaSource:"desktop",maxWidth:Z?Z.width:void 0,maxHeight:Z?Z.height:void 0},Z&&(Z.frameRate&&(typeof Z.frameRate=="number"?(b.mandatory.maxFrameRate=Z.frameRate,b.mandatory.minFrameRate=Z.frameRate):(b.mandatory.maxFrameRate=Z.frameRate.max||Z.frameRate.ideal||Z.frameRate.exact||void 0,b.mandatory.minFrameRate=Z.frameRate.min||Z.frameRate.ideal||Z.frameRate.exact||void 0),b.frameRate=Z.frameRate),Z.width&&(b.width=Z.width),Z.height&&(b.height=Z.height)),b}(e);let d=null,h=null;const f=wt();if(!f.supportShareAudio&&t==="enable"){const y=new ae(P.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio");return o.onError(y),y.throw(S)}S.info("start create screen video track with config",e,"withAudio",t,"trackId",i);const g=f.supportShareAudio&&t!=="disable";try{const y=await Ki({screen:l,screenAudio:g?n||!0:void 0},i);d=y.getVideoTracks()[0]||null,h=y.getAudioTracks()[0]||null}catch(y){throw o.onError(y),y}if(!d){const y=new ae(P.UNEXPECTED_ERROR,"can not find track in media stream");return o.onError(y),y.throw(S)}if(!h&&t==="enable"){d&&d.stop();const y=new ae(P.SHARE_AUDIO_NOT_ALLOWED);return o.onError(y),y.throw(S)}e.optimizationMode||(e.optimizationMode="detail"),e.optimizationMode&&(RR(i,d,e,e.encoderConfig&&pR(e.encoderConfig)||void 0),e.encoderConfig&&typeof e.encoderConfig!="string"&&(e.encoderConfig.bitrateMin=e.encoderConfig.bitrateMax));const _=new on(d,e.encoderConfig?pR(e.encoderConfig):{},e.scalabiltyMode?xv(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,i,[Wt.SCREEN_TRACK]);if(!h)return o.onSuccess(_.getTrackId()),S.info("create screen video track success","video:",_.getTrackId()),_;const v=new Mn(h,void 0,zt(8,"track-scr-a-"),!1);return o.onSuccess([_.getTrackId(),v.getTrackId()]),S.info("create screen video track success","video:",_.getTrackId(),"audio:",v.getTrackId()),[_,v]},createMicrophoneAndCameraTracks:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=L("CAMERA_CAPTURE_CONFIG"),i=zt(8,"track-mic-"),o=zt(8,"track-cam-"),l=ke.reportApiInvoke(null,{id:"".concat(i,"-").concat(o),tag:an.TRACER,name:yn.CREATE_MIC_AND_CAM_TRACKS,options:[e,t,n]});n&&(t.encoderConfig=n);const d=Lv(t),h=JF(e);let f=null,g=null;S.info("start create camera video track(".concat(o,") and microphone audio track(").concat(i,") with config, audio: ").concat(JSON.stringify(e),", video: ").concat(JSON.stringify(t)));try{const y=await Ki({audio:h,video:d},"".concat(i,"-").concat(o));f=y.getAudioTracks()[0],g=y.getVideoTracks()[0]}catch(y){throw l.onError(y),y}if(!f||!g){const y=new ae(P.UNEXPECTED_ERROR,"can not find tracks in media stream");return l.onError(y),y.throw(S)}if(t.optimizationMode&&RR(o,g,t,$a(t.encoderConfig)),L("USE_STANDARD_BITRATE_DEFAULT")){const y=$a(t.encoderConfig);t.encoderConfig=y,delete y.bitrateMax,delete y.bitrateMin}const _=new Tm(f,e,h,i),v=new Pv(g,t,d,t.scalabiltyMode?xv(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,o);return l.onSuccess([_.getTrackId(),v.getTrackId()]),S.info("create camera video track(".concat(o,") and microphone audio track(").concat(i,") success")),[_,v]},createMicrophoneAudioTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=zt(8,"track-mic-"),n=ke.reportApiInvoke(null,{id:t,tag:an.TRACER,name:yn.CREATE_MIC_AUDIO_TRACK,options:[e]}),i=JF(e);let o=null;S.info("start create microphone audio track with config",JSON.stringify(e),"trackId",t);try{o=(await Ki({audio:i},t)).getAudioTracks()[0]||null}catch(d){throw n.onError(d),d}if(!o){const d=new ae(P.UNEXPECTED_ERROR,"can not find track in media stream");return n.onError(d),d.throw(S)}const l=new Tm(o,e,i,t);return n.onSuccess(l.getTrackId()),S.info("create microphone audio track success, trackId:",t),l},createCustomAudioTrack:b4,createBufferSourceAudioTrack:async function(e){var t;const{cacheOnlineFile:n,encoderConfig:i}=e;let{source:o}=e;const l={source:o instanceof AudioBuffer?"AudioBuffer":o instanceof File?(t=File.name)!==null&&t!==void 0?t:"File":o,cacheOnlineFile:n,encoderConfig:i},d=zt(8,"track-buf-"),h=ke.reportApiInvoke(null,{id:d,tag:an.TRACER,name:yn.CREATE_BUFFER_AUDIO_TRACK,options:[l]});if(L("DISABLE_WEBAUDIO"))throw new ae(P.NOT_SUPPORTED,"can not create BufferSourceAudioTrack when WebAudio disabled");S.info("start create buffer source audio track with config",JSON.stringify(l),"trackId",d);const f=o;if(!(o instanceof AudioBuffer))try{o=await async function(v,y){let b=null;if(typeof v=="string"){const I=Mj.get(v);if(I)return S.debug("use cached audio resource: ",v),I;try{b=(await Do(()=>Xs.get(v,{responseType:"arraybuffer"}),void 0,void 0,{maxRetryCount:3})).data}catch(O){throw new ae(P.FETCH_AUDIO_FILE_FAILED,O.toString())}}else b=await new be((O,U)=>{const j=new FileReader;j.onload=G=>{G.target?O(G.target.result):U(new ae(P.READ_LOCAL_AUDIO_FILE_ERROR))},j.onerror=()=>{U(new ae(P.READ_LOCAL_AUDIO_FILE_ERROR))},j.readAsArrayBuffer(v)});const D=await function(I){const O=Ph();return new be((U,j)=>{O.decodeAudioData(I,G=>{U(G)},G=>{j(new ae(P.DECODE_AUDIO_FILE_FAILED,G.toString()))})})}(b);return typeof v=="string"&&y&&Mj.set(v,D),D}(o,n)}catch(v){return h.onError(v),v.throw(S)}const g=new rle(o),_=new nle(f,g,i?Dv(i):{},d);return S.info("create buffer source audio track success, trackId:",d),h.onSuccess(_.getTrackId()),_},setAppType:function(e){if(S.debug("setAppType: ".concat(e)),!(Number.isInteger(e)&&e>=0))throw S.debug("Invalid appType"),new se(P.INVALID_PARAMS,"invalid app type",e);en("APP_TYPE",Math.floor(e))},setLogLevel:function(e){S.setLogLevel(e)},enableLogUpload:function(){L("USE_NEW_LOG")?en("UPLOAD_LOG",!0):S.enableLogUpload()},disableLogUpload:function(){L("USE_NEW_LOG")?en("UPLOAD_LOG",!1):S.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new VV},checkAudioTrackIsActive:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const n=ke.reportApiInvoke(null,{tag:an.TRACER,name:yn.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[t]});if(!(e instanceof Mn||e instanceof jh)){const f=new se(P.INVALID_TRACK,"the parameter is not a audio track");return n.onError(f),f.throw()}t&&t<1e3&&(t=1e3);const i=e instanceof Mn?e.getTrackLabel():"remote_track",o=e.getVolumeLevel();let l=o,d=o;const h=Date.now();return new be(f=>{const g=setInterval(()=>{const _=e.getVolumeLevel();l=_>l?_:l,d=_<d?_:d;const v=l-d>1e-4,y=Date.now()-h;if(v||y>t){clearInterval(g);const b=v,D={duration:y,deviceLabel:i,maxVolumeLevel:l,result:b};S.info("[track-".concat(e.getTrackId(),"] check audio track active completed. ").concat(JSON.stringify(D))),n.onSuccess(D),f(b)}},200)})},checkVideoTrackIsActive:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const n=ke.reportApiInvoke(null,{tag:an.TRACER,name:yn.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[t]});if(!(e instanceof on||e instanceof Fh)){const v=new se(P.INVALID_TRACK,"the parameter is not a video track");return n.onError(v),v.throw()}t&&t<1e3&&(t=1e3);const i=e instanceof on?e.getTrackLabel():"remote_track",o=e.getMediaStreamTrack(!0),l=document.createElement("video");l.style.width="1px",l.style.height="1px",l.setAttribute("muted",""),l.muted=!0,l.setAttribute("playsinline",""),l.controls=!1,(kr()||Ev())&&(l.style.opacity="0.01",l.style.position="fixed",l.style.left="0",l.style.top="0",document.body.appendChild(l)),l.srcObject=new MediaStream([o]),l.play();const d=document.createElement("canvas");d.width=160,d.height=120;let h=0,f=0;try{const v=Date.now();h=await function(y,b,D,I){let O,U=0,j=null;return new be((G,$)=>{function Z(){U>I&&O&&(O(),G(U));const X=D.getContext("2d");if(!X){const fe=new se(P.UNEXPECTED_ERROR,"can not get canvas 2d context.");return S.error(fe.toString()),void $(fe)}X.drawImage(y,0,0,160,120);const ee=X.getImageData(0,0,D.width,D.height),le=Math.floor(ee.data.length/3);if(j){for(let fe=0;fe<le;fe+=3)if(ee.data[fe]!==j[fe])return U+=1,void(j=ee.data);j=ee.data}else j=ee.data}setTimeout(()=>{O&&(O(),G(U))},b),O=vR(()=>{Z()},30)})}(l,t,d,4),f=Date.now()-v}catch(v){throw n.onError(v),v}wAe===Mt.SAFARI&&(l.pause(),l.remove()),l.srcObject=null;const g=h>4,_={duration:f,changedPicNum:h,deviceLabel:i,result:g};return S.info("[track-".concat(e.getTrackId(),"] check video track active completed. ").concat(JSON.stringify(_))),n.onSuccess(_),g},setArea:aI,audioElementPlayCenter:Ts,resumeAudioContext:function(){return Ts.autoResumeAfterInterruption(!0)},processExternalMediaAEC:function(e){jAe.processExternalMediaAEC(e)},registerExtensions:function(e){const t=L("PLUGIN_INFO")||[];e.forEach(n=>{"name"in n&&!me(t).call(t,n.name)&&t.push(n.name);const i=n;i.__registered__=!0,i.logger.hookLog=S.extLog,i.reporter.hookApiInvoke=ke.extApiInvoke,i.parameters&&Object.keys(i.parameters).forEach(o=>{i.parameters[o]=L(o)})}),XH("PLUGIN_INFO",t)},ChannelMediaRelayError:Hh,ChannelMediaRelayEvent:qc,ChannelMediaRelayState:hi,RemoteStreamFallbackType:Xce,RemoteStreamType:qce,ConnectionDisconnectedReason:Ct,AudienceLatencyLevelType:Sce,AREAS:Ht,preload:async function(e,t,n,i){return II(e,t,n,i)},startLastmileProbeTest:async function(e,t,n,i){let o={state:"unavailable"};await II(e,t,n,i);const l=await NI({appId:e,cname:t,token:n||e,uid:i,cloudProxyServer:"disabled"});if(!l)return o;await OI(l);let d,h=v3({mode:"rtc",codec:"vp8"});try{d=await h.join(e,t,n,i,{networkQualityProbe:!0})}catch{return o}const f=new TAe,g=f.createMuteAudioTrack();let _=await b4({mediaStreamTrack:g});await h.publish([_]);let[v,y,b]=await new be((G,$)=>{const Z=setTimeout(()=>{clearTimeout(Z),G([!0,null,"audio"])},5e3);h.on("user-published",async(X,ee)=>{X.uid===d&&(clearTimeout(Z),G([!1,X,ee]))})});if(v||!y)return await h.unpublish([_]),await h.leave(),_.close(),f.close(),o;await h.subscribe(y,b),await new be((G,$)=>{const Z=setTimeout(()=>{clearTimeout(Z),G(null)},5e3)});let D=h.getRTCStats(),I=h.getLocalAudioStats();const O=D.RTT,U=I.sendJitterMs,j=I.currentPacketLossRate;return o={state:"complete",rtt:O,packetLossRate:j,jitter:U,networkQuality:((G,$,Z)=>{let X=1;if(Z>0){let et=Math.log(100*Z)/Math.log(2)+1;et=Math.min(5,Math.max(0,et)),X=1-et/5}let ee=1;if(G>0){let et=Math.log(G/40)/Math.log(2)+1;et=Math.min(5,Math.max(0,et)),ee=1-et/5}let le=1;if($>0){let et=Math.log($/10)/Math.log(2.5)+1;et=Math.min(5,Math.max(0,et)),le=1-et/5}const fe=.5*X+.3*ee+.2*le;let Ie=0;return Ie=fe>=.8?1:fe>=.6?2:fe>=.4?3:fe>=.2?4:5,Ie})(O,U,j)},await h.unsubscribe(y),await h.unpublish([_]),await h.leave(),_.close(),f.close(),await OI(l),o}});return Object.defineProperties(ar,{onAudioAutoplayFailed:{get:()=>$s.onAudioAutoplayFailed,set:e=>{$s.onAudioAutoplayFailed=e}},onAutoplayFailed:{get:()=>$s.onAutoplayFailed,set:e=>{$s.onAutoplayFailed=e}},_onSecurityPolicyViolation:{value:void 0,writable:!0},_cspEventHandlerPointer:{value:void 0,writable:!0},onSecurityPolicyViolation:{get:()=>ar._onSecurityPolicyViolation,set(e){ar._onSecurityPolicyViolation=e,S3(e)}},__CLIENT_LIST__:{get:()=>L("SHOW_GLOBAL_CLIENT_LIST")?Ld:[]}}),Wi.on(xd.CAMERA_DEVICE_CHANGED,e=>{S.info("camera device changed",JSON.stringify(e)),ar.onCameraChanged&&ar.onCameraChanged(e),ar.safeEmit(mc.CAMERA_CHANGED,e)}),Wi.on(xd.RECORDING_DEVICE_CHANGED,e=>{S.info("microphone device changed",JSON.stringify(e)),ar.onMicrophoneChanged&&ar.onMicrophoneChanged(e),ar.safeEmit(mc.MICROPHONE_CHANGED,e)}),Wi.on(xd.PLAYOUT_DEVICE_CHANGED,e=>{S.debug("playout device changed",JSON.stringify(e)),ar.onPlaybackDeviceChanged&&ar.onPlaybackDeviceChanged(e),ar.safeEmit(mc.PLAYBACK_DEVICE_CHANGED,e)}),Ts.onAutoplayFailed=()=>{S.info("detect audio element autoplay failed"),$s.onAudioAutoplayFailed&&$s.onAudioAutoplayFailed()},tn.on("autoplay-failed",()=>{S.info("detect webaudio autoplay failed"),$s.onAudioAutoplayFailed&&$s.onAudioAutoplayFailed(),ar.safeEmit(mc.AUTOPLAY_FAILED)}),tn.on(Wr.STATE_CHANGE,(e,t)=>{S.info("audio context state changed: ".concat(t," => ").concat(e)),ar.onAudioContextStateChanged&&ar.onAudioContextStateChanged(e,t),ar.safeEmit(mc.AUDIO_CONTEXT_STATE_CHANGED,e,t)}),Ln.on(wd.NETWORK_STATE_CHANGE,(e,t)=>{S.info("[network-indicator] network state changed, ".concat(t," => ").concat(e))}),window&&(window.__ARTC__=ar),ar})})(Nq);var Kx=Nq.exports;const ol=DK(Kx),Pwe="195fe587a4b84053aa0eff6ae05150b1";class zw{constructor(){Nc(this,"client",null);Nc(this,"localTracks",{videoTrack:null,audioTrack:null});ol.enableLogUpload(),ol.setLogLevel(0),ol.setArea({areaCode:[Kx.AREAS.NORTH_AMERICA],excludedArea:Kx.AREAS.CHINA}),console.log("AgoraRTC SDK version:",ol.VERSION),console.log("Browser check:",ol.checkSystemRequirements()),console.log("Region configured: NORTH_AMERICA"),this.client=ol.createClient({mode:"live",codec:"vp8",role:"host"}),console.log("Agora client created successfully"),this.client.on("connection-state-change",(s,a)=>{console.log(`Agora connection state changed from ${a} to ${s}`)}),this.client.on("network-quality",s=>{console.log("Network quality:",s)}),this.client.on("exception",s=>{console.error("Agora exception:",s)})}async joinChannel(s,a="audience"){if(!this.client)throw new Error("Client not initialized");console.log(" Joining Agora channel:",s.channel);let c=s.appId||Pwe,A=s.uid||0;if(console.log(" App ID:",c),console.log(" Channel:",s.channel),console.log(" UID:",A),console.log(" Role:",a),console.log(" Environment:",window.location.hostname),console.log(" Secure Context:",window.isSecureContext),typeof c!="string"||c.length!==32||!/^[a-f0-9]{32}$/i.test(c))throw new Error(`Invalid App ID provided: ${c}`);console.log(" App ID validation passed");try{await this.client.setClientRole(a==="host"?"host":"audience"),console.log(` Client role set to ${a}`)}catch(u){console.warn("Failed to set client role:",u.message)}if(console.log(" Joining channel WITHOUT TOKEN (App ID only mode)..."),console.log("  - SDK version:",ol.VERSION),console.log("  - Browser supported:",ol.checkSystemRequirements()),!navigator.onLine)throw new Error("Offline: Please reconnect to the internet before starting the stream.");console.log(" Using App ID only mode (no token/certificate)"),console.time("agora_join_no_token");try{await this.client.join(c,s.channel,null,A),console.timeEnd("agora_join_no_token"),console.log(" Joined channel successfully (no token)");return}catch(u){console.timeEnd("agora_join_no_token"),console.error(" Join failed:",u);const m=(u==null?void 0:u.message)||"";throw m.includes("CAN_NOT_GET_GATEWAY_SERVER")||m.includes("dynamic use static key")?new Error("Streaming authentication failed: Project requires token (certificate enabled) but valid token was not accepted. Verify token generation server and project security mode match."):m.includes("NETWORK_TIMEOUT")||m.includes("NETWORK_ERROR")?new Error("Network instability prevented connecting to Agora. Please check DNS/firewall and retry."):new Error(`Unable to connect to Agora: ${m}`)}}async createLocalTracks(){var s,a;try{if(console.log(" Requesting device access..."),!window.isSecureContext&&window.location.hostname!=="localhost")throw new Error("Camera access requires HTTPS or localhost. Current URL is not secure.");const[c,A]=await ol.createMicrophoneAndCameraTracks({AEC:!0,AGC:!0,ANS:!0},{encoderConfig:"720p_2",facingMode:"user"});return console.log(" Devices accessed successfully"),console.log("  Audio track:",c.getTrackLabel()),console.log("  Video track:",A.getTrackLabel()),c.enabled||(console.warn("Audio track not enabled, enabling..."),await c.setEnabled(!0)),A.enabled||(console.warn("Video track not enabled, enabling..."),await A.setEnabled(!0)),this.localTracks={audioTrack:c,videoTrack:A},this.localTracks}catch(c){throw console.error("Failed to create local tracks:",c),c.name==="NotAllowedError"?new Error(` Camera or microphone permission denied. Please:

1. Click the camera/microphone icon in your browser address bar
2. Select "Allow" for both camera and microphone
3. Refresh the page and try again

Note: HTTPS is required for camera access.`):c.name==="NotFoundError"?new Error(` No camera or microphone found. Please:

1. Connect a camera/microphone device
2. Check if other applications are using the camera
3. Restart your browser
4. Try again`):c.name==="OverconstrainedError"?new Error(` Camera constraints not supported. Please:

1. Try using a different camera
2. Check camera resolution settings
3. Update browser to latest version`):c.name==="NotReadableError"?new Error(` Camera is in use by another application. Please:

1. Close other apps using the camera
2. Restart your browser
3. Try again`):(s=c.message)!=null&&s.includes("screen")||(a=c.message)!=null&&a.includes("display")?new Error(` Screen sharing unavailable. This may be due to:

1. Browser security restrictions
2. Screen sharing blocked by system
3. Try using camera mode instead`):new Error(` Failed to access camera/microphone: ${c.message}

Troubleshooting:
1. Check browser permissions
2. Ensure HTTPS connection
3. Try refreshing the page`)}}async publishTracks(){if(!this.client)throw new Error("Client not initialized");if(!this.localTracks.videoTrack||!this.localTracks.audioTrack)throw new Error("Local tracks not created");console.log(" Publishing local tracks..."),await this.client.publish([this.localTracks.videoTrack,this.localTracks.audioTrack]),console.log(" Local tracks published")}async unpublishTracks(){this.client&&(!this.localTracks.videoTrack||!this.localTracks.audioTrack||(console.log(" Unpublishing local tracks..."),await this.client.unpublish([this.localTracks.videoTrack,this.localTracks.audioTrack]),console.log(" Local tracks unpublished")))}async leave(){console.log(" Leaving Agora channel..."),this.localTracks.videoTrack&&(this.localTracks.videoTrack.stop(),this.localTracks.videoTrack.close(),this.localTracks.videoTrack=null),this.localTracks.audioTrack&&(this.localTracks.audioTrack.stop(),this.localTracks.audioTrack.close(),this.localTracks.audioTrack=null),this.client&&(await this.client.leave(),console.log(" Left Agora channel"))}async leaveChannel(){await this.leave()}playVideoTrack(s,a){s.play(a)}async toggleVideo(s){this.localTracks.videoTrack&&(await this.localTracks.videoTrack.setEnabled(s),console.log(`Video ${s?"enabled":"disabled"}`))}async toggleAudio(s){this.localTracks.audioTrack&&(await this.localTracks.audioTrack.setEnabled(s),console.log(`Audio ${s?"enabled":"disabled"}`))}getRemoteUsers(){return this.client?this.client.remoteUsers||[]:[]}onUserJoined(s){this.client&&this.client.on("user-joined",s)}onUserLeft(s){this.client&&this.client.on("user-left",s)}onUserPublished(s){this.client&&this.client.on("user-published",s)}onUserUnpublished(s){this.client&&this.client.on("user-unpublished",s)}async subscribeUser(s,a){this.client&&await this.client.subscribe(s,a)}async unsubscribeUser(s,a){this.client&&await this.client.unsubscribe(s,a)}getRemoteVideoTrack(s){return s.videoTrack}getRemoteAudioTrack(s){return s.audioTrack}async runDiagnostics(){const s=[],a={cameras:!1,microphones:!1,screenShare:!1,networkConnectivity:!1,httpsConnection:!1,browserSupport:!1,diagnosticResults:s};a.httpsConnection=window.location.protocol==="https:"||window.location.hostname==="localhost",a.httpsConnection?s.push(" HTTPS connection available"):s.push(" HTTPS required for camera/microphone access"),a.browserSupport=!!(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia),a.browserSupport?s.push(" Browser supports media devices"):s.push(" Browser does not support media devices");try{const c=await navigator.mediaDevices.enumerateDevices(),A=c.filter(m=>m.kind==="videoinput"),u=c.filter(m=>m.kind==="audioinput");a.cameras=A.length>0,a.microphones=u.length>0,a.cameras?s.push(` ${A.length} camera(s) detected`):s.push(" No cameras detected"),a.microphones?s.push(` ${u.length} microphone(s) detected`):s.push(" No microphones detected")}catch(c){s.push(` Could not enumerate devices: ${c.message}`)}try{navigator.mediaDevices&&"getDisplayMedia"in navigator.mediaDevices?(a.screenShare=!0,s.push(" Screen sharing supported")):(a.screenShare=!1,s.push(" Screen sharing not supported"))}catch(c){s.push(` Screen sharing check failed: ${c.message}`)}try{await fetch("https://jtmmeumzjcldqukpqcfi.supabase.co/rest/v1/",{method:"HEAD",mode:"no-cors"}),a.networkConnectivity=!0,s.push(" Network connectivity to Supabase")}catch{a.networkConnectivity=!1,s.push(" No network connectivity to Supabase")}return a}static getTokenErrorMessage(s){if(!s)return"Unknown token generation error";const a=s.message||s.toString();return a.includes("Unauthorized")||a.includes("401")?" Authentication required. Please sign in to use livestreaming features.":a.includes("fetch")||a.includes("network")||a.includes("Failed to fetch")?" Network error. Please check your internet connection and try again.":a.includes("Function not found")?" Server configuration issue. Edge functions not deployed.":a.includes("certificate")?" Server configuration issue. Missing authentication certificates.":` Failed to generate streaming token: ${a}

Please check your internet connection and try again.`}}const Mwe=({onReaction:r})=>{const[s,a]=z.useState([]),c=A=>{const u=`${Date.now()}-${Math.random()}`,m=Math.random()*80+10;a(E=>[...E,{id:u,type:A,x:m}]),setTimeout(()=>{a(E=>E.filter(w=>w.id!==u))},3e3),r&&r(A)};return z.useEffect(()=>(window.triggerFloatingReaction=c,()=>{delete window.triggerFloatingReaction}),[]),p.jsxs("div",{className:"absolute inset-0 pointer-events-none overflow-hidden",children:[s.map(A=>p.jsx("div",{className:"absolute bottom-0 floating-reaction",style:{left:`${A.x}%`,animation:"float-up 3s ease-out forwards"},children:A.type==="like"?p.jsx(Ma,{className:"w-8 h-8 text-red-500 fill-red-500"}):p.jsx(b_,{className:"w-8 h-8 text-blue-500 fill-blue-500"})},A.id)),p.jsx("style",{children:`
        @keyframes float-up {
          0% {
            transform: translateY(0) scale(1);
            opacity: 1;
          }
          50% {
            transform: translateY(-50vh) scale(1.2);
            opacity: 0.8;
          }
          100% {
            transform: translateY(-100vh) scale(0.8);
            opacity: 0;
          }
        }
        
        .floating-reaction {
          z-index: 50;
        }
      `})]})},NG=r=>{window.triggerFloatingReaction&&window.triggerFloatingReaction(r)},Fwe=[5,10,25,50,100],jwe=({isOpen:r,onClose:s,scholarId:a,streamTitle:c})=>{const{profile:A}=gr(),[u,m]=z.useState(null),[E,w]=z.useState(""),[C,T]=z.useState(!1),[N,B]=z.useState(""),[k,Q]=z.useState("");if(!r)return null;const K=async()=>{const Y=u||parseFloat(E);if(!Y||Y<=0){Q("Please select or enter a valid amount");return}if(!A){Q("You must be logged in to donate");return}T(!0),Q(""),B("");try{const{data:F,error:M}=await oe.from("profiles").select("masjid_coin_balance").eq("id",A.id).single();if(M)throw M;const V=F.masjid_coin_balance||0;if(V<Y){Q(`Insufficient balance. You have ${V} coins.`),T(!1);return}const{error:W}=await oe.from("masjid_coin_transactions").insert({user_id:A.id,recipient_id:a,amount:Y,type:"donation",description:`Zakat donation during livestream: ${c}`,note:`Zakat donation - ${Y} coins`,status:"completed",payment_status:"completed"});if(W)throw W;const{error:q}=await oe.from("profiles").update({masjid_coin_balance:V-Y}).eq("id",A.id);if(q)throw console.error(" Failed to deduct user balance:",q),q;console.log(` User balance deducted: ${V}  ${V-Y} coins`);const{data:te,error:re}=await oe.from("profiles").select("masjid_coin_balance").eq("id",a).single();if(re)throw console.error(" Failed to fetch scholar profile:",re),await oe.from("profiles").update({masjid_coin_balance:V}).eq("id",A.id),new Error("Failed to credit scholar - transaction rolled back");const de=(te==null?void 0:te.masjid_coin_balance)||0,ce=de+Y,{error:Ae}=await oe.from("profiles").update({masjid_coin_balance:ce,updated_at:new Date().toISOString()}).eq("id",a);if(Ae)throw console.error(" Failed to credit scholar balance:",Ae),await oe.from("profiles").update({masjid_coin_balance:V}).eq("id",A.id),new Error("Failed to credit scholar - transaction rolled back");console.log(` Scholar balance updated: ${de}  ${ce} coins (${ce*100})`),B(` Successfully donated ${Y} coins! May Allah accept your Zakat.`),setTimeout(()=>{s(),m(null),w(""),B("")},2e3)}catch(F){console.error("Donation error:",F),Q(F.message||"Failed to process donation")}finally{T(!1)}};return p.jsx("div",{className:"fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-4",children:p.jsxs(qe,{className:"w-full max-w-md relative",children:[p.jsx("button",{onClick:s,className:"absolute top-4 right-4 text-gray-400 hover:text-gray-600",disabled:C,children:p.jsx(Hw,{className:"w-5 h-5"})}),p.jsxs(Pt,{children:[p.jsxs(Vt,{className:"flex items-center gap-2",children:[p.jsx(Lc,{className:"w-5 h-5 text-green-600"}),"Give Zakat During Stream"]}),p.jsx(vi,{children:"Support this scholar and earn rewards"})]}),p.jsxs($e,{className:"space-y-4",children:[p.jsxs("div",{children:[p.jsx("p",{className:"text-sm font-medium mb-2",children:"Quick Amounts:"}),p.jsx("div",{className:"grid grid-cols-3 gap-2",children:Fwe.map(Y=>p.jsxs(Re,{variant:u===Y?"default":"outline",onClick:()=>{m(Y),w(""),Q("")},disabled:C,className:"w-full",children:[Y," coins"]},Y))})]}),p.jsxs("div",{children:[p.jsx("p",{className:"text-sm font-medium mb-2",children:"Or enter custom amount:"}),p.jsx("input",{type:"number",value:E,onChange:Y=>{w(Y.target.value),m(null),Q("")},placeholder:"Enter amount",disabled:C,className:"w-full px-3 py-2 border rounded-lg",min:"1"})]}),k&&p.jsx("div",{className:"bg-red-50 text-red-700 p-3 rounded-lg text-sm",children:k}),N&&p.jsx("div",{className:"bg-green-50 text-green-700 p-3 rounded-lg text-sm",children:N}),p.jsx(Re,{onClick:K,disabled:C||!u&&!E,className:"w-full",children:C?"Processing...":"Donate Now"}),p.jsx("p",{className:"text-xs text-gray-500 text-center",children:"Your donation will be recorded and the scholar will be notified"})]})]})})},OG=window.__PAYSTACK_PUBLIC_KEY,Dq=r=>new Promise((s,a)=>{if(!OG&&!window.PaystackPop){a(new Error("Paystack public key not configured. Set VITE_PAYSTACK_PUBLIC_KEY or window.__PAYSTACK_PUBLIC_KEY"));return}if(window.PaystackPop)c();else{const A=document.createElement("script");A.src="https://js.paystack.co/v1/inline.js",A.onload=()=>c(),A.onerror=()=>a(new Error("Failed to load Paystack script")),document.body.appendChild(A)}function c(){window.PaystackPop.setup({key:OG,email:r.email,amount:Math.round(r.amount*100),ref:r.reference,metadata:r.metadata,callback_url:r.callback_url,channels:r.channels||["card","bank","ussd","bank_transfer"],onClose:()=>{a(new Error("Payment cancelled by user"))},callback:u=>{console.log("Paystack payment successful:",u),s(u)}}).openIframe()}}),Bq=(r="PMT")=>{const s=Date.now(),a=Math.floor(Math.random()*1e6);return`${r}_${s}_${a}`},Vwe=Object.freeze(Object.defineProperty({__proto__:null,generatePaymentReference:Bq,initializePaystackPayment:Dq},Symbol.toStringTag,{value:"Module"})),oO=()=>{const{profile:r}=gr(),{channelName:s}=bb(),{showNotification:a}=Hu();console.log("UserPrayerServiceViewer loaded with channelName:",s);const[c,A]=z.useState([]),[u,m]=z.useState(null),[E,w]=z.useState(!1),[C,T]=z.useState(!0),[N,B]=z.useState(""),[k,Q]=z.useState(!1),[K,Y]=z.useState(!1),[F,M]=z.useState(!1),[V,W]=z.useState(0),[q,te]=z.useState(0),[re,de]=z.useState(!1),[ce,Ae]=z.useState(!1),[ne,ue]=z.useState(!1),[ye,De]=z.useState([]),[Xe,we]=z.useState(""),[Se,Qe]=z.useState(!1),Ye=z.useRef(null),It=z.useRef(null),Fe=z.useRef(null),Ge=z.useRef(null);z.useEffect(()=>{dt();const Oe=setInterval(dt,5e3),Et=oe.channel("viewer-streams").on("postgres_changes",{event:"UPDATE",schema:"public",table:"streams",filter:"is_active=eq.false"},mt=>{console.log("Stream ended detected:",mt),u&&mt.new.id===u.id&&(console.log(" Current stream ended by scholar, disconnecting..."),rr(),B("Stream has ended by the scholar")),dt()}).subscribe();return()=>{clearInterval(Oe),Et.unsubscribe()}},[u]),z.useEffect(()=>{const Oe=()=>{Ae(!!document.fullscreenElement)};return document.addEventListener("fullscreenchange",Oe),()=>document.removeEventListener("fullscreenchange",Oe)},[]),z.useEffect(()=>{const Oe=()=>{ue(!!document.pictureInPictureElement)};return document.addEventListener("enterpictureinpicture",Oe),document.addEventListener("leavepictureinpicture",Oe),()=>{document.removeEventListener("enterpictureinpicture",Oe),document.removeEventListener("leavepictureinpicture",Oe)}},[]),z.useEffect(()=>{if(!u||!E)return;const Oe=async()=>{try{const{data:mt,error:ut}=await oe.from("streams").select("viewer_count, likes_count, dislikes_count").eq("id",u.id).maybeSingle();if(ut){console.error("Error polling stream data:",ut);return}if(mt&&(console.log(" Polled viewer count:",mt.viewer_count),m(Ot=>Ot?{...Ot,viewerCount:mt.viewer_count||0}:null),W(mt.likes_count||0),te(mt.dislikes_count||0)),r){const{data:Ot}=await oe.from("stream_reactions").select("reaction_type").eq("stream_id",u.id).eq("user_id",r.id).maybeSingle();Ot&&(Y(Ot.reaction_type==="like"),M(Ot.reaction_type==="dislike"))}}catch(mt){console.error("Error polling stream data:",mt)}};setTimeout(()=>Oe(),500);const Et=setInterval(Oe,3e3);return()=>clearInterval(Et)},[u,E,r]),z.useEffect(()=>{(async()=>{var mt;if(!s||u||k)return;console.log("Attempting to auto-join stream:",s),console.log("Active streams available:",c.length),Q(!0);let Et=c.find(ut=>ut.channel===s);if(!Et&&c.length===0){console.log("Stream not in list, fetching directly from database...");try{const{data:ut,error:Ot}=await oe.from("streams").select(`
              id,
              channel,
              title,
              scholar_id,
              viewer_count,
              started_at,
              is_active,
              scholar:profiles!scholar_id(full_name)
            `).eq("channel",s).eq("is_active",!0).single();Ot?console.error("Error fetching specific stream:",Ot):ut&&(console.log("Found stream in database:",ut),Et={id:ut.id,channel:ut.channel,title:ut.title,scholarName:((mt=ut.scholar)==null?void 0:mt.full_name)||"Unknown Scholar",scholarId:ut.scholar_id,viewerCount:ut.viewer_count||0,startedAt:ut.started_at})}catch(ut){console.error("Error in direct stream fetch:",ut)}}Et?(console.log(" Stream found, joining:",Et.title),await hn(Et)):(console.warn(" Stream not found:",s),B(`Stream "${s}" not found or has ended. The scholar may have stopped streaming.`)),Q(!1)})()},[s,c,u,k]);const dt=async()=>{var Oe,Et;try{if(!navigator.onLine){console.warn("No internet connection"),B("No internet connection. Please check your network.");return}console.log(" Fetching active streams...");const{data:mt,error:ut}=await oe.from("streams").select(`
          id,
          channel,
          title,
          scholar_id,
          viewer_count,
          started_at,
          scholar:profiles!scholar_id(full_name)
        `).eq("is_active",!0).order("started_at",{ascending:!1});if(ut){console.error("Error fetching streams:",ut),((Oe=ut.message)!=null&&Oe.includes("Failed to fetch")||(Et=ut.message)!=null&&Et.includes("NetworkError"))&&B("Cannot connect to server. Please check your internet connection.");return}console.log(` Found ${(mt==null?void 0:mt.length)||0} active streams`);const Ot=(mt||[]).map(pn=>{var Fn;return{id:pn.id,channel:pn.channel,title:pn.title,scholarName:((Fn=pn.scholar)==null?void 0:Fn.full_name)||"Unknown Scholar",scholarId:pn.scholar_id,viewerCount:pn.viewer_count||0,startedAt:pn.started_at}});A(Ot)}catch(mt){console.error("Error fetching streams:",mt)}},Nt=async(Oe,Et)=>{if(!(r!=null&&r.id)){B("Please login to access paid streams");return}const mt=Bq(),ut=crypto.randomUUID();try{const{error:Ot}=await oe.from("stream_access_payments").insert({id:ut,stream_id:Oe.id,user_id:r.id,scholar_id:Oe.scholarId,amount_paid:Et,payment_reference:mt,payment_status:"pending"});if(Ot)throw Ot;await Dq({email:r.email||"",amount:Et,reference:mt,metadata:{user_id:r.id,transaction_type:"donation",custom_fields:[{display_name:"Stream ID",variable_name:"stream_id",value:Oe.id},{display_name:"Scholar ID",variable_name:"scholar_id",value:Oe.scholarId}]}}),a(`Payment successful! ${Et} paid. Joining "${Oe.title}"...`,"payment"),setTimeout(()=>{hn(Oe,!0)},2e3)}catch(Ot){B(`Payment error: ${Ot.message}`)}},hn=async(Oe,Et=!1)=>{var mt,ut,Ot,pn,Fn,rd,xl,Qr;B(""),m(Oe);try{if(!navigator.onLine)throw new Error("No internet connection. Cannot join livestream.");const{data:Ys,error:di}=await oe.from("profiles").select("livestream_fee").eq("id",Oe.scholarId).single();if(di)throw(mt=di.message)!=null&&mt.includes("Failed to fetch")||(ut=di.message)!=null&&ut.includes("NetworkError")?new Error("Cannot connect to server. Please check your internet connection."):di;const wi=(Ys==null?void 0:Ys.livestream_fee)||0;if(wi>0&&!Et){const{data:Cs,error:zs}=await oe.from("stream_access_payments").select("*").eq("stream_id",Oe.id).eq("user_id",r==null?void 0:r.id).eq("payment_status","success").single();if(zs&&zs.code!=="PGRST116")throw zs;if(!Cs){await Nt(Oe,wi);return}}Ye.current=new zw;let aa=0;const sc=3;let Dl=!1;for(;aa<sc&&!Dl;){aa++,console.log(` Join attempt ${aa}/${sc}...`);try{await Ye.current.joinChannel({appId:"195fe587a4b84053aa0eff6ae05150b1",channel:Oe.channel,token:null,uid:0},"audience"),Dl=!0,console.log(" Successfully joined stream on attempt",aa)}catch(Cs){if(console.error(` Join attempt ${aa} failed:`,Cs),aa>=sc)throw navigator.onLine?Cs.code==="CAN_NOT_GET_GATEWAY_SERVER"?new Error("Unable to connect to stream. The stream may have ended or there might be a temporary connection issue. Please try again."):Cs.code==="NETWORK_ERROR"||(Ot=Cs.message)!=null&&Ot.includes("Failed to fetch")?new Error("Connection failed. Please check your internet connection and try again."):Cs.code==="INVALID_OPERATION"?new Error("Stream connection error. Please refresh the page and try again."):new Error(`Failed to join stream: ${Cs.message||"Unknown error"}. Please try again.`):new Error("No internet connection. Please check your network and try again.");const zs=aa*1e3;console.log(` Waiting ${zs}ms before retry...`),await new Promise(Bs=>setTimeout(Bs,zs))}}Ye.current.onUserPublished(async(Cs,zs)=>{try{if(console.log(` Remote user published ${zs}:`,Cs.uid),await Ye.current.subscribeUser(Cs,zs),zs==="video"){await new Promise(Fa=>setTimeout(Fa,100));const Bs=Ye.current.getRemoteVideoTrack(Cs);Bs&&It.current?(console.log(" Playing remote video track in container"),It.current.style&&(It.current.style.width="100%",It.current.style.height="100%"),await Bs.play(It.current,{fit:"contain"}),console.log(" Video track playing successfully")):console.error(" No video track or container:",{hasTrack:!!Bs,hasContainer:!!It.current})}else if(zs==="audio"){const Bs=Ye.current.getRemoteAudioTrack(Cs);Bs?(console.log(" Playing remote audio track through device speakers"),await Bs.play(),Bs.setVolume(100),console.log(" Audio playing through device speakers at volume 100"),console.log(" Audio track state:",{volumeLevel:Bs.getVolumeLevel()}),console.log(" System audio output: Using default device speakers"),console.log(" If no sound, check:"),console.log("  1. Device volume is up"),console.log("  2. Browser has audio permission"),console.log("  3. Correct audio output device selected in system settings")):console.warn(" No audio track available from remote user")}}catch(Bs){console.error(" Error subscribing to user:",Bs)}}),w(!0),a(`Successfully joined "${Oe.title}" by ${Oe.scholarName}`,"success"),await oe.from("stream_participants").insert({stream_id:Oe.id,user_id:r==null?void 0:r.id,is_active:!0}),await oe.rpc("increment_viewer_count",{stream_uuid:Oe.id}),console.log(" Viewer count incremented for stream:",Oe.id),He(Oe.id)}catch(Ys){console.error(" Error joining stream:",Ys);let di="Failed to join stream. ";(pn=Ys.message)!=null&&pn.includes("INVALID_VENDOR_KEY")||(Fn=Ys.message)!=null&&Fn.includes("invalid vendor key")?di+="Invalid Agora configuration. Please contact support.":(rd=Ys.message)!=null&&rd.includes("token")?di+="Authentication error. Please try again.":(xl=Ys.message)!=null&&xl.includes("network")||(Qr=Ys.message)!=null&&Qr.includes("connection")?di+="Network connection issue. Check your internet and try again.":di+=Ys.message||"Unknown error occurred.",B(di),Q(!1),m(null)}},rr=async()=>{try{console.log(" Leaving stream...");const Oe=u,Et=r==null?void 0:r.id;if(Ye.current){try{await Ye.current.leaveChannel(),console.log(" Left Agora channel")}catch(mt){console.error(" Error leaving Agora channel:",mt)}Ye.current=null}if(Oe&&Et)try{const{error:mt}=await oe.from("stream_participants").update({is_active:!1,left_at:new Date().toISOString()}).eq("stream_id",Oe.id).eq("user_id",Et).eq("is_active",!0);mt?console.error(" Error updating participant status:",mt):console.log(" Participant status updated"),await oe.rpc("decrement_viewer_count",{stream_uuid:Oe.id}),console.log(" Viewer count decremented for stream:",Oe.id)}catch(mt){console.error(" Database error:",mt)}w(!1),m(null),B(""),De([]),we(""),T(!0),console.log(" Successfully left stream - UI reset"),a("Left the stream","success")}catch(Oe){console.error(" Error leaving stream:",Oe),w(!1),m(null),Ye.current=null,a(Oe.message||"Error leaving stream, but you have been disconnected","error")}},He=async Oe=>{try{const{data:Et,error:mt}=await oe.from("stream_comments").select(`
          id,
          message,
          created_at,
          user_id,
          profiles:user_id (full_name)
        `).eq("stream_id",Oe).order("created_at",{ascending:!0});if(mt)throw mt;const ut=(Et||[]).map(Ot=>{var pn;return{id:Ot.id,message:Ot.message,user_name:((pn=Ot.profiles)==null?void 0:pn.full_name)||"Anonymous",created_at:Ot.created_at}});De(ut),setTimeout(()=>{var Ot;(Ot=Ge.current)==null||Ot.scrollIntoView({behavior:"smooth"})},100)}catch(Et){console.error("Error fetching comments:",Et)}},Pe=async()=>{if(!(!Xe.trim()||!u||!r)){Qe(!0);try{const{error:Oe}=await oe.from("stream_comments").insert({stream_id:u.id,user_id:r.id,message:Xe.trim()});if(Oe)throw Oe;we("")}catch(Oe){console.error("Error sending comment:",Oe),a("Failed to send comment","error")}finally{Qe(!1)}}};z.useEffect(()=>{if(!u)return;console.log(" Setting up real-time comments subscription for stream:",u.id);const Oe=oe.channel(`stream-comments:${u.id}`,{config:{broadcast:{self:!0}}}).on("postgres_changes",{event:"INSERT",schema:"public",table:"stream_comments",filter:`stream_id=eq.${u.id}`},async Et=>{var ut;console.log(" New comment received via real-time:",Et.new);const{data:mt}=await oe.from("stream_comments").select(`
              id,
              message,
              created_at,
              profiles:user_id (full_name)
            `).eq("id",Et.new.id).single();if(mt){const Ot={id:mt.id,message:mt.message,user_name:((ut=mt.profiles)==null?void 0:ut.full_name)||"Anonymous",created_at:mt.created_at};console.log(" Adding comment to UI:",Ot),De(pn=>[...pn,Ot]),setTimeout(()=>{var pn;(pn=Ge.current)==null||pn.scrollIntoView({behavior:"smooth"})},100)}}).subscribe(Et=>{console.log(" Comments subscription status:",Et)});return()=>{console.log(" Unsubscribing from comments"),Oe.unsubscribe()}},[u]),z.useEffect(()=>{if(!u||!E)return;const Oe=setInterval(async()=>{var Et;if(ye.length>0){const mt=(Et=ye[ye.length-1])==null?void 0:Et.created_at,{data:ut}=await oe.from("stream_comments").select(`
            id,
            message,
            created_at,
            profiles:user_id (full_name)
          `).eq("stream_id",u.id).gt("created_at",mt).order("created_at",{ascending:!0});if(ut&&ut.length>0){console.log(" Polling found",ut.length,"new comments");const Ot=ut.map(pn=>{var Fn;return{id:pn.id,message:pn.message,user_name:((Fn=pn.profiles)==null?void 0:Fn.full_name)||"Anonymous",created_at:pn.created_at}});De(pn=>[...pn,...Ot]),setTimeout(()=>{var pn;(pn=Ge.current)==null||pn.scrollIntoView({behavior:"smooth"})},100)}}},3e3);return()=>clearInterval(Oe)},[u,E,ye]);const yt=async()=>{try{const Oe=!C;if(T(Oe),Ye.current){const Et=Ye.current.getRemoteUsers();for(const mt of Et){const ut=mt.audioTrack;ut&&(Oe?(await ut.play(),ut.setVolume(100)):ut.setVolume(0))}}console.log(Oe?" Audio enabled":" Audio muted")}catch(Oe){console.error("Error toggling audio:",Oe)}},st=async()=>{if(!(!u||!r))try{K?(await oe.from("stream_reactions").delete().eq("stream_id",u.id).eq("user_id",r.id).eq("reaction_type","like"),Y(!1),W(Oe=>Math.max(0,Oe-1)),await oe.from("streams").update({likes_count:Math.max(0,V-1)}).eq("id",u.id)):(F&&(await oe.from("stream_reactions").delete().eq("stream_id",u.id).eq("user_id",r.id).eq("reaction_type","dislike"),M(!1),te(Oe=>Math.max(0,Oe-1)),await oe.from("streams").update({dislikes_count:Math.max(0,q-1)}).eq("id",u.id)),await oe.from("stream_reactions").insert({stream_id:u.id,user_id:r.id,reaction_type:"like"}),Y(!0),W(Oe=>Oe+1),NG("like"),await oe.from("streams").update({likes_count:V+1}).eq("id",u.id))}catch(Oe){console.error("Error toggling like:",Oe)}},qr=async()=>{if(!(!u||!r))try{F?(await oe.from("stream_reactions").delete().eq("stream_id",u.id).eq("user_id",r.id).eq("reaction_type","dislike"),M(!1),te(Oe=>Math.max(0,Oe-1)),await oe.from("streams").update({dislikes_count:Math.max(0,q-1)}).eq("id",u.id)):(K&&(await oe.from("stream_reactions").delete().eq("stream_id",u.id).eq("user_id",r.id).eq("reaction_type","like"),Y(!1),W(Oe=>Math.max(0,Oe-1)),await oe.from("streams").update({likes_count:Math.max(0,V-1)}).eq("id",u.id)),await oe.from("stream_reactions").insert({stream_id:u.id,user_id:r.id,reaction_type:"dislike"}),M(!0),te(Oe=>Oe+1),NG("dislike"),await oe.from("streams").update({dislikes_count:q+1}).eq("id",u.id))}catch(Oe){console.error("Error toggling dislike:",Oe)}},Ze=()=>{de(!0)},Qt=async()=>{if(Fe.current)try{document.fullscreenElement?(await document.exitFullscreen(),Ae(!1)):(await Fe.current.requestFullscreen(),Ae(!0))}catch(Oe){console.error("Fullscreen error:",Oe)}},wr=async()=>{if(It.current)try{const Oe=It.current.querySelector("video");if(!Oe){console.warn("No video element found for PiP");return}document.pictureInPictureElement?(await document.exitPictureInPicture(),ue(!1)):(await Oe.requestPictureInPicture(),ue(!0))}catch(Oe){console.error("Picture-in-Picture error:",Oe)}};return z.useEffect(()=>()=>{Ye.current&&E&&rr()},[]),p.jsxs("div",{className:"container mx-auto p-4 max-w-6xl",children:[p.jsxs(qe,{children:[p.jsx(Pt,{children:p.jsx(Vt,{children:"Live Prayer Services"})}),p.jsxs($e,{className:"space-y-6",children:[N&&!u&&p.jsxs("div",{className:"p-4 bg-destructive/10 border border-destructive rounded-md mb-4",children:[p.jsx("p",{className:"text-sm text-destructive font-semibold",children:N}),p.jsx(Re,{onClick:()=>{B(""),window.history.back()},variant:"outline",className:"mt-3",children:"Go Back"})]}),k?p.jsxs("div",{className:"text-center py-12",children:[p.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4"}),p.jsx("p",{className:"text-lg font-semibold",children:"Connecting to stream..."}),p.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:s})]}):u?p.jsxs("div",{className:"space-y-4",children:[p.jsxs("div",{className:"flex items-center justify-between p-4 bg-secondary rounded-lg",children:[p.jsxs("div",{children:[p.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[p.jsx("span",{className:"w-2 h-2 bg-destructive rounded-full animate-pulse"}),p.jsx("h3",{className:"font-semibold text-lg",children:u.title})]}),p.jsxs("p",{className:"text-sm text-muted-foreground",children:["by ",u.scholarName]})]}),p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx(yi,{className:"h-5 w-5"}),p.jsx("span",{className:"font-bold",children:u.viewerCount})]})]}),p.jsxs("div",{ref:Fe,className:`relative aspect-video bg-black rounded-lg overflow-hidden group ${ne?"ring-4 ring-blue-500":""}`,children:[p.jsx("div",{ref:It,className:"w-full h-full"}),p.jsxs("div",{className:"absolute top-4 right-4 opacity-0 group-hover:opacity-100 transition-opacity flex gap-2 z-10",children:[p.jsx(Re,{variant:"secondary",size:"icon",onClick:Qt,className:"bg-black/50 hover:bg-black/70 text-white",title:ce?"Exit Fullscreen":"Fullscreen",children:ce?p.jsx(wve,{className:"h-5 w-5"}):p.jsx(pve,{className:"h-5 w-5"})}),p.jsx(Re,{variant:"secondary",size:"icon",onClick:wr,className:"bg-black/50 hover:bg-black/70 text-white",title:"Picture-in-Picture",children:p.jsx(Nve,{className:"h-5 w-5"})})]}),p.jsx(Mwe,{}),!E&&p.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black",children:p.jsxs("div",{className:"text-white text-center",children:[p.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-white mx-auto mb-4"}),p.jsx("p",{children:"Connecting to stream..."})]})})]}),p.jsxs("div",{className:"space-y-3",children:[p.jsxs("div",{className:"flex items-center justify-center gap-2",children:[p.jsxs(Re,{variant:K?"default":"outline",size:"lg",onClick:st,className:"flex-1",children:[p.jsx(jx,{className:"h-5 w-5 mr-2"}),V]}),p.jsxs(Re,{variant:F?"default":"outline",size:"lg",onClick:qr,className:"flex-1",children:[p.jsx(b_,{className:"h-5 w-5 mr-2"}),q]}),p.jsxs(Re,{variant:"outline",size:"sm",onClick:Ze,className:"border-green-500 text-green-600 hover:bg-green-50 px-3",children:[p.jsx(Ma,{className:"h-4 w-4 mr-1"}),p.jsx("span",{className:"text-xs",children:"Zakat"})]})]}),p.jsxs("div",{className:"border rounded-lg p-3 space-y-2",children:[p.jsx("h3",{className:"text-sm font-semibold mb-2",children:"Live Chat"}),p.jsxs("div",{className:"h-32 overflow-y-auto space-y-2 mb-2 bg-gray-50 rounded p-2",children:[ye.length===0?p.jsx("p",{className:"text-xs text-gray-400 text-center py-4",children:"No messages yet. Be the first to comment!"}):ye.map(Oe=>p.jsxs("div",{className:"text-xs",children:[p.jsxs("span",{className:"font-semibold text-emerald-600",children:[Oe.user_name,": "]}),p.jsx("span",{className:"text-gray-700",children:Oe.message})]},Oe.id)),p.jsx("div",{ref:Ge})]}),p.jsxs("div",{className:"flex gap-2",children:[p.jsx("input",{type:"text",value:Xe,onChange:Oe=>we(Oe.target.value),onKeyPress:Oe=>Oe.key==="Enter"&&!Se&&Pe(),placeholder:"Type a message...",className:"flex-1 text-sm px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-emerald-500",maxLength:200,disabled:Se}),p.jsx(Re,{size:"sm",onClick:Pe,disabled:!Xe.trim()||Se,className:"px-4",children:Se?"...":"Send"})]})]}),p.jsxs("div",{className:"flex items-center gap-3",children:[p.jsx(Re,{variant:C?"default":"destructive",onClick:yt,className:"flex-1",children:C?p.jsxs(p.Fragment,{children:[p.jsx(i0e,{className:"h-4 w-4 mr-2"}),"Mute"]}):p.jsxs(p.Fragment,{children:[p.jsx(o0e,{className:"h-4 w-4 mr-2"}),"Unmute"]})}),p.jsx(Re,{variant:"destructive",onClick:rr,className:"flex-1",children:"Leave Stream"})]})]}),N&&p.jsx("div",{className:"p-3 bg-destructive/10 border border-destructive rounded-md",children:p.jsx("p",{className:"text-sm text-destructive",children:N})})]}):p.jsxs("div",{className:"space-y-4",children:[p.jsx("p",{className:"text-muted-foreground",children:"Join live prayer services and Islamic lectures from our scholars and imams"}),c.length===0&&!s?p.jsxs("div",{className:"text-center py-12 bg-secondary rounded-lg",children:[p.jsx("p",{className:"text-muted-foreground",children:"No live streams available at the moment"}),p.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"Check back later for prayer times and lectures"})]}):p.jsx("div",{className:"grid gap-4",children:c.map(Oe=>p.jsx("div",{className:"p-4 border rounded-lg hover:border-primary transition-colors",children:p.jsxs("div",{className:"flex items-start justify-between",children:[p.jsxs("div",{className:"flex-1",children:[p.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[p.jsx("span",{className:"w-2 h-2 bg-destructive rounded-full animate-pulse"}),p.jsx("h3",{className:"font-semibold text-lg",children:Oe.title})]}),p.jsxs("p",{className:"text-sm text-muted-foreground mb-2",children:["by ",Oe.scholarName]}),p.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted-foreground",children:[p.jsxs("div",{className:"flex items-center gap-1",children:[p.jsx(yi,{className:"h-4 w-4"}),p.jsxs("span",{children:[Oe.viewerCount," watching"]})]}),p.jsxs("span",{children:["Started ",new Date(Oe.startedAt).toLocaleTimeString()]})]})]}),p.jsx(Re,{onClick:()=>hn(Oe),children:"Join Stream"})]})},Oe.id))})]})]})]}),u&&p.jsx(jwe,{isOpen:re,onClose:()=>de(!1),scholarId:u.scholarId,streamTitle:u.title})]})},Qwe=()=>{const{profile:r}=gr(),{showNotification:s}=Hu(),[a,c]=z.useState([]),[A,u]=z.useState(null),[m,E]=z.useState(""),[w,C]=z.useState(!1),[T,N]=z.useState(!0),[B,k]=z.useState(""),[Q,K]=z.useState(!1),[Y,F]=z.useState(0);z.useEffect(()=>{V(),M()},[]);const M=async()=>{try{const{data:{user:q}}=await oe.auth.getUser();if(!q)return;const{data:te}=await oe.from("profiles").select("masjid_coin_balance").eq("id",q.id).single();te&&F(te.masjid_coin_balance||0)}catch(q){console.error("Error fetching balance:",q)}},V=async()=>{try{N(!0),console.log("Fetching scholars and imams...");const{data:q,error:te}=await oe.from("profiles").select("id, full_name, specializations, role").or("role.eq.scholar,role.eq.imam").order("full_name");if(te)throw console.error("Error fetching scholars:",te),te;console.log("Fetched scholars:",(q==null?void 0:q.length)||0,q);const re=(q||[]).map(de=>({id:de.id,name:de.full_name||"Unknown",specialization:de.specializations&&de.specializations.length>0?de.specializations[0]:"Islamic Studies"}));c(re)}catch(q){console.error("Error fetching scholars:",q),k("Failed to load scholars: "+q.message)}finally{N(!1)}},W=async()=>{if(!A){k("Please select a scholar/imam to support");return}const q=parseFloat(m);if(!q||q<1){k("Please enter a valid amount (minimum 1 coin)");return}k(""),C(!0);try{const{data:{user:te}}=await oe.auth.getUser();if(!te){k("You must be logged in to donate"),C(!1);return}const{data:re,error:de}=await oe.from("profiles").select("masjid_coin_balance, full_name").eq("id",te.id).single();if(de)throw new Error("Failed to fetch your balance");const ce=(re==null?void 0:re.masjid_coin_balance)||0;if(ce<q)throw new Error(`Insufficient balance. You need ${q} coins but have ${ce} coins. Please deposit more coins.`);const Ae=`DON_${te.id}_${Date.now()}`;console.log(` Processing zakat donation: ${q} coins from ${re.full_name} to ${A.name}`);const{error:ne}=await oe.from("masjid_coin_transactions").insert({user_id:te.id,recipient_id:null,amount:-q,type:"donation",description:`Zakat donation to ${A.name}`,payment_reference:Ae,payment_status:"completed",status:"completed"});if(ne)throw console.error(" Failed to create debit transaction:",ne),new Error("Failed to process donation");const{error:ue}=await oe.from("masjid_coin_transactions").insert({user_id:te.id,recipient_id:A.id,amount:q,type:"donation",description:`Zakat donation from ${re.full_name}`,payment_reference:Ae,payment_status:"completed",status:"completed"});if(ue)throw console.error(" Failed to create credit transaction:",ue),new Error("Failed to credit scholar");if(console.log(" Zakat donation transactions created. Database trigger will update balances automatically."),console.log(`   Donor: -${q} coins | Scholar: +${q} coins`),K(!0),s(`Zakat donation of ${q} coins sent to ${A.name}. May Allah accept your charity!`,"success"),r){const ye=q*100;await v0e(r.full_name||"A donor",ye)}E(""),u(null),await M(),setTimeout(()=>K(!1),5e3)}catch(te){k(te.message||"Failed to process donation")}finally{C(!1)}};return p.jsx(yr,{title:"Zakat & Donations",children:p.jsxs(qe,{children:[p.jsxs(Pt,{children:[p.jsxs(Vt,{className:"flex items-center gap-2",children:[p.jsx(Ma,{className:"h-6 w-6 text-primary"}),"Zakat & Donations"]}),p.jsx(vi,{children:"Support scholars with zakat from all sources (livestreams, non-livestreams) and charitable donations - separate from consultation booking fees"})]}),p.jsx($e,{className:"space-y-6",children:Q?p.jsxs("div",{className:"p-6 bg-primary/10 border border-primary rounded-lg text-center",children:[p.jsx(Ma,{className:"h-12 w-12 text-primary mx-auto mb-4"}),p.jsx("h3",{className:"text-xl font-semibold mb-2",children:"Thank You!"}),p.jsx("p",{className:"text-muted-foreground",children:"Your donation has been processed successfully. May Allah accept your charity."})]}):p.jsxs(p.Fragment,{children:[r&&p.jsx("div",{className:"p-4 bg-emerald-50 border border-emerald-200 rounded-lg",children:p.jsxs("div",{className:"flex items-center justify-between",children:[p.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Your Masjid Coin Balance:"}),p.jsxs("span",{className:"text-lg font-bold text-emerald-600",children:[" ",Y.toLocaleString()," coins"]})]})}),p.jsxs("div",{children:[p.jsx("label",{className:"block text-sm font-medium mb-2",children:"Select Scholar/Imam to Support"}),T?p.jsxs("div",{className:"p-8 text-center",children:[p.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto mb-2"}),p.jsx("p",{className:"text-sm text-muted-foreground",children:"Loading scholars..."})]}):a.length===0?p.jsxs("div",{className:"p-6 text-center border border-dashed rounded-lg",children:[p.jsx("p",{className:"text-muted-foreground mb-2",children:"No scholars or imams registered yet"}),p.jsx("p",{className:"text-xs text-muted-foreground",children:"Scholars and imams need to register with their roles to appear here"})]}):p.jsx("div",{className:"space-y-2",children:a.map(q=>p.jsx("div",{className:`p-4 border rounded-lg cursor-pointer transition-colors ${(A==null?void 0:A.id)===q.id?"border-primary bg-primary/5":"hover:border-primary/50"}`,onClick:()=>u(q),children:p.jsxs("div",{className:"flex items-center justify-between",children:[p.jsxs("div",{children:[p.jsx("p",{className:"font-semibold",children:q.name}),p.jsx("p",{className:"text-sm text-muted-foreground",children:q.specialization})]}),(A==null?void 0:A.id)===q.id&&p.jsx("div",{className:"w-5 h-5 rounded-full bg-primary flex items-center justify-center",children:p.jsx("span",{className:"text-white text-xs",children:""})})]})},q.id))})]}),p.jsxs("div",{children:[p.jsx("label",{className:"block text-sm font-medium mb-2",children:"Donation Amount (Masjid Coins)"}),p.jsxs("div",{className:"relative",children:[p.jsx(Tb,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-5 w-5 text-emerald-600"}),p.jsx(er,{type:"number",value:m,onChange:q=>E(q.target.value),placeholder:"0",min:"1",step:"1",className:"pl-10"})]}),p.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Minimum donation: 1 coin"})]}),p.jsx("div",{className:"grid grid-cols-4 gap-2",children:[5,10,25,50].map(q=>p.jsxs(Re,{variant:"outline",onClick:()=>E(q.toString()),children:[" ",q]},q))}),p.jsxs("div",{className:"p-4 bg-secondary rounded-lg",children:[p.jsx("h4",{className:"font-semibold mb-2 text-sm",children:"About Zakat & Donations"}),p.jsxs("ul",{className:"text-xs text-muted-foreground space-y-1",children:[p.jsx("li",{children:" 100% goes directly to the scholar/imam"}),p.jsx("li",{children:" Includes: livestream tips, non-livestream zakat, and charitable donations"}),p.jsx("li",{children:" Does NOT include consultation booking fees (handled separately)"}),p.jsx("li",{children:" Paid instantly using your Masjid Coin balance"}),p.jsx("li",{children:" Deposit more coins in MASJID COIN section if needed"})]})]}),B&&p.jsx("div",{className:"p-3 bg-destructive/10 border border-destructive rounded-md",children:p.jsx("p",{className:"text-sm text-destructive",children:B})}),p.jsx(Re,{onClick:W,disabled:w||!A||!m,className:"w-full",size:"lg",children:w?"Processing...":"Donate Now"})]})})]})})},Hwe=()=>{const{profile:r}=gr(),[s,a]=z.useState(0),[c,A]=z.useState(""),[u,m]=z.useState([]),[E,w]=z.useState(!1),[C,T]=z.useState(""),[N,B]=z.useState(""),k=.01;z.useEffect(()=>{if(!(r!=null&&r.id))return;Q();const V=oe.channel("masjid-coin-balance").on("postgres_changes",{event:"UPDATE",schema:"public",table:"profiles",filter:`id=eq.${r.id}`},q=>{console.log("Balance updated:",q),a(q.new.masjid_coin_balance||0)}).subscribe(),W=oe.channel("masjid-coin-transactions").on("postgres_changes",{event:"*",schema:"public",table:"masjid_coin_transactions",filter:`user_id=eq.${r.id}`},q=>{console.log("Transaction update:",q),Q()}).subscribe();return()=>{V.unsubscribe(),W.unsubscribe()}},[r==null?void 0:r.id]);const Q=async()=>{try{if(!(r!=null&&r.id))return;const{data:V,error:W}=await oe.from("profiles").select("masjid_coin_balance").eq("id",r.id).single();if(W)throw W;a((V==null?void 0:V.masjid_coin_balance)||0);const{data:q,error:te}=await oe.from("masjid_coin_transactions").select("*").eq("user_id",r.id).order("created_at",{ascending:!1}).limit(20);if(te)throw te;const de=(q||[]).filter(ce=>ce.payment_status==="success"||ce.payment_status==="completed"||ce.status==="completed"&&ce.type!=="deposit").map(ce=>({id:ce.id,amount:ce.amount/100,coins:ce.amount,type:ce.type,description:ce.description,date:new Date(ce.created_at).toLocaleDateString(),payment_status:ce.payment_status,status:ce.status}));m(de)}catch(V){console.error("Error fetching coin balance:",V)}},K=async(V,W,q)=>{try{B("Processing payment..."),await new Promise(ye=>setTimeout(ye,1500));const te=Math.floor(W*k),{error:re}=await oe.from("masjid_coin_transactions").update({payment_status:"success",status:"completed"}).eq("payment_reference",V).eq("user_id",q);if(re)throw console.error("Error updating transaction:",re),new Error("Failed to update transaction");const{data:de,error:ce}=await oe.from("profiles").select("masjid_coin_balance").eq("id",q).single();if(ce)throw console.error("Error fetching profile:",ce),new Error("Failed to fetch profile");const Ae=de.masjid_coin_balance||0,ne=Ae+te;console.log("Crediting balance:",{currentBalance:Ae,coins:te,newBalance:ne});const{error:ue}=await oe.from("profiles").update({masjid_coin_balance:ne}).eq("id",q);if(ue)throw console.error("Error updating balance:",ue),new Error("Failed to credit balance");B(`Payment successful! ${te} coins credited to your wallet.`),await Q()}catch(te){console.error("Payment processing error:",te),T(te.message||"Payment processing failed. Please contact support with reference: "+V)}},Y=async()=>{const V=parseFloat(c);if(!V||V<100){T("Please enter a valid amount (minimum 100 Naira)");return}if(!(r!=null&&r.id)||!(r!=null&&r.email)){T("Profile not loaded. Please refresh the page.");return}T(""),B(""),w(!0);try{const W=`DEP_${r.id}_${Date.now()}`,{error:q}=await oe.from("masjid_coin_transactions").insert({user_id:r.id,amount:Math.floor(V*k),type:"deposit",description:`Deposit ${V} Naira`,note:`Paystack deposit - ${V} Naira`,payment_reference:W,payment_status:"pending"});if(q)throw q;const{initializePaystackPayment:te}=await n_(async()=>{const{initializePaystackPayment:re}=await Promise.resolve().then(()=>Vwe);return{initializePaystackPayment:re}},void 0,import.meta.url);await te({email:r.email,amount:V,reference:W,metadata:{project:"masjid-app",user_id:r.id,transaction_type:"deposit",coins:Math.floor(V*k)}}),console.log("Payment successful, verifying transaction..."),await K(W,V,r.id),A("")}catch(W){console.error("Deposit error:",W),T(W.message||"Failed to process deposit. Please try again.")}finally{w(!1)}},F=s.toLocaleString(),M=(s/k).toFixed(2);return p.jsx(yr,{title:"Masjid Coin Wallet",children:p.jsxs("div",{className:"p-3 space-y-3",children:[p.jsxs(qe,{className:"bg-gradient-to-br from-amber-500 to-amber-700 text-white",children:[p.jsx(Pt,{className:"pb-2",children:p.jsxs("div",{className:"flex items-center justify-between",children:[p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx(Tb,{className:"h-5 w-5"}),p.jsx(Vt,{className:"text-white text-base",children:"Coin Balance"})]}),p.jsx(Re,{onClick:Q,variant:"ghost",size:"sm",className:"text-white hover:bg-amber-600 h-7 text-xs",children:"Refresh"})]})}),p.jsxs($e,{className:"pt-2 pb-3",children:[p.jsxs("div",{className:"flex items-baseline gap-2 mb-1",children:[p.jsx("span",{className:"text-3xl font-bold",children:F}),p.jsx("span",{className:"text-lg",children:"coins"})]}),p.jsxs("p",{className:"text-amber-100 text-xs",children:[" ",M]})]})]}),p.jsx(qe,{children:p.jsx($e,{className:"p-3",children:p.jsxs("div",{className:"flex items-center justify-between",children:[p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx(A0e,{className:"h-4 w-4 text-amber-600"}),p.jsx("span",{className:"font-semibold text-sm",children:"Conversion Rate"})]}),p.jsx("span",{className:"text-sm font-bold text-amber-600",children:"100 = 1 coin"})]})})}),p.jsxs(qe,{children:[p.jsxs(Pt,{className:"pb-3",children:[p.jsxs(Vt,{className:"flex items-center gap-2 text-base",children:[p.jsx(Lc,{className:"h-4 w-4"}),"Deposit Funds"]}),p.jsx(vi,{className:"text-xs",children:"Convert your money to Masjid Coins"})]}),p.jsxs($e,{className:"space-y-3",children:[C&&p.jsx("div",{className:"bg-red-50 border border-red-200 text-red-800 px-4 py-3 rounded-lg text-sm",children:C}),N&&p.jsx("div",{className:"bg-green-50 border border-green-200 text-green-800 px-4 py-3 rounded-lg text-sm",children:N}),p.jsxs("div",{className:"space-y-2",children:[p.jsx("label",{className:"text-sm font-medium",children:"Amount (Naira)"}),p.jsxs("div",{className:"relative",children:[p.jsx("span",{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 font-bold",children:""}),p.jsx(er,{type:"number",value:c,onChange:V=>A(V.target.value),placeholder:"Enter amount",className:"pl-10",min:"100",step:"100"})]}),c&&parseFloat(c)>=100&&p.jsxs("p",{className:"text-xs text-gray-500",children:["You'll receive: ",p.jsxs("span",{className:"font-bold text-amber-600",children:[(parseFloat(c)*k).toLocaleString()," coins"]})]})]}),p.jsx("div",{className:"grid grid-cols-4 gap-2",children:[500,1e3,2e3,5e3].map(V=>p.jsxs(Re,{variant:"outline",size:"sm",onClick:()=>A(V.toString()),className:"text-xs",children:["",V]},V))}),p.jsx(Re,{onClick:Y,disabled:E||!c,className:"w-full bg-amber-600 hover:bg-amber-700",children:E?"Processing...":"Deposit & Convert to Coins"})]})]}),p.jsxs(qe,{children:[p.jsx(Pt,{className:"pb-2",children:p.jsx(Vt,{className:"text-sm",children:"How to Use Coins"})}),p.jsx($e,{className:"pt-2",children:p.jsxs("div",{className:"space-y-2",children:[p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx("div",{className:"p-1.5 rounded-lg bg-red-50",children:p.jsx(bl,{className:"h-4 w-4 text-red-600"})}),p.jsx("div",{className:"flex-1",children:p.jsx("p",{className:"font-semibold text-xs",children:"Livestream Tips"})})]}),p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx("div",{className:"p-1.5 rounded-lg bg-blue-50",children:p.jsx(fr,{className:"h-4 w-4 text-blue-600"})}),p.jsx("div",{className:"flex-1",children:p.jsx("p",{className:"font-semibold text-xs",children:"Consultations"})})]}),p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx("div",{className:"p-1.5 rounded-lg bg-green-50",children:p.jsx(Ma,{className:"h-4 w-4 text-green-600"})}),p.jsx("div",{className:"flex-1",children:p.jsx("p",{className:"font-semibold text-xs",children:"Donations & Zakat"})})]})]})})]}),p.jsxs(qe,{children:[p.jsxs(Pt,{className:"pb-3",children:[p.jsx(Vt,{className:"text-base",children:"Transactions"}),p.jsx(vi,{className:"text-xs",children:"Recent activity"})]}),p.jsx($e,{children:p.jsx("div",{className:"space-y-2",children:u.length===0?p.jsx("p",{className:"text-center text-gray-500 py-4 text-sm",children:"No transactions yet"}):u.map(V=>p.jsxs("div",{className:"flex items-center justify-between p-2 bg-gray-50 rounded-lg",children:[p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx("div",{className:`p-1.5 rounded-full ${V.type==="deposit"?"bg-green-100":V.type==="livestream"?"bg-red-100":V.type==="consultation"?"bg-blue-100":"bg-amber-100"}`,children:V.type==="deposit"?p.jsx(Rb,{className:"h-3 w-3 text-green-600"}):V.type==="livestream"?p.jsx(bl,{className:"h-3 w-3 text-red-600"}):V.type==="consultation"?p.jsx(fr,{className:"h-3 w-3 text-blue-600"}):p.jsx(Ma,{className:"h-3 w-3 text-amber-600"})}),p.jsxs("div",{className:"flex-1 min-w-0",children:[p.jsx("p",{className:"font-medium text-xs truncate",children:V.description}),p.jsxs("div",{className:"flex items-center gap-1.5",children:[p.jsx("p",{className:"text-[10px] text-gray-500",children:new Date(V.date).toLocaleDateString("en-US",{month:"short",day:"numeric"})}),V.payment_status&&p.jsx("span",{className:`text-[10px] px-2 py-0.5 rounded-full ${V.payment_status==="success"||V.payment_status==="completed"?"bg-green-100 text-green-700":V.payment_status==="pending"?"bg-yellow-100 text-yellow-700":"bg-red-100 text-red-700"}`,children:V.payment_status==="success"||V.payment_status==="completed"?"Completed":V.payment_status==="pending"?"Pending":"Failed"})]})]})]}),p.jsxs("div",{className:"text-right",children:[p.jsxs("div",{className:`font-bold text-xs ${V.coins>=0?"text-green-600":"text-red-600"}`,children:[V.coins>=0?"+":"",V.coins.toLocaleString()]}),p.jsxs("p",{className:"text-[10px] text-gray-500",children:["",V.amount.toFixed(0)]})]})]},V.id))})})]})]})})},Gwe=()=>{const{profile:r}=gr(),s=wB(),{showNotification:a}=Hu(),[c,A]=z.useState(!1),[u,m]=z.useState(""),[E,w]=z.useState(""),[C,T]=z.useState(null),[N,B]=z.useState(0),[k,Q]=z.useState(!0),[K,Y]=z.useState(!0),[F,M]=z.useState(""),[V,W]=z.useState(!1),[q,te]=z.useState(null),[re,de]=z.useState(null),[ce,Ae]=z.useState(null),[ne,ue]=z.useState([]),[ye,De]=z.useState(!0),[Xe,we]=z.useState([]),Se=z.useRef(null),Qe=z.useRef(null),Ye=z.useRef(null),It=z.useRef(null);z.useEffect(()=>{Fe()},[r==null?void 0:r.id]);const Fe=async()=>{if(r!=null&&r.id)try{De(!0);const{data:Pe,error:yt}=await oe.from("streams").select("*").eq("scholar_id",r.id).eq("is_active",!0).order("created_at",{ascending:!1});if(yt){console.error("Error checking for old streams:",yt);return}Pe&&Pe.length>0&&(console.log(`Found ${Pe.length} active stream(s) that need to be stopped`),ue(Pe))}catch(Pe){console.error("Error in checkForOldStreams:",Pe)}finally{De(!1)}},Ge=async Pe=>{try{console.log("Stopping old stream:",Pe);const{error:yt}=await oe.from("streams").update({is_active:!1,ended_at:new Date().toISOString(),viewer_count:0}).eq("id",Pe);if(yt)throw yt;a("Old stream stopped successfully","success"),ue(st=>st.filter(qr=>qr.id!==Pe))}catch(yt){console.error("Error stopping old stream:",yt),a(`Failed to stop stream: ${yt.message}`,"error")}};z.useEffect(()=>()=>{Se.current&&c&&dt()},[c]);const dt=async()=>{try{C&&await oe.from("streams").update({is_active:!1,ended_at:new Date().toISOString()}).eq("id",C)}catch(Pe){console.error("Cleanup error:",Pe)}};z.useEffect(()=>{if(q&&Qe.current&&k){console.log(" Video ref and track ready, playing preview..."),console.log(" Video container:",Qe.current),console.log(" Video track:",q);try{q.play(Qe.current),console.log(" Video track play() called successfully"),W(!0),console.log(" previewReady set to true - overlay should hide")}catch(Pe){console.error(" Failed to play local video track:",Pe),M("Unable to display camera preview. Please retry or check camera permissions.")}}},[q,k]),z.useEffect(()=>{if(!c||!C)return;const Pe=async()=>{try{const{data:st}=await oe.from("streams").select("viewer_count, likes_count, dislikes_count").eq("id",C).single();st&&(console.log(" Polled stream data - Viewers:",st.viewer_count,"Likes:",st.likes_count,"Dislikes:",st.dislikes_count),B(st.viewer_count||0))}catch(st){console.error("Error polling stream data:",st)}},yt=setInterval(Pe,5e3);return Pe(),()=>clearInterval(yt)},[c,C]);const Nt=async()=>{var Pe,yt,st,qr,Ze,Qt,wr,Oe,Et,mt,ut,Ot,pn,Fn,rd,xl,Qr,Ys,di,wi,aa,sc,Dl,Cs,zs,Bs,Fa,kf;if(!u.trim()){M("Please enter a stream title");return}if(!s.canStream){M("You do not have permission to start a live stream");return}M(""),console.log("=== STARTING LIVESTREAM ===");try{if(!navigator.onLine)throw new Error("No internet connection detected. Please check your network and try again.");console.log("Testing internet connectivity...");try{await Promise.race([fetch("https://www.google.com/favicon.ico",{method:"HEAD",mode:"no-cors"}),new Promise((mn,Xr)=>setTimeout(()=>Xr(new Error("timeout")),5e3))]),console.log(" Internet connectivity verified")}catch{throw new Error("Unable to reach internet. Livestreaming requires stable internet connection. Please check your network and try again.")}if(!(r!=null&&r.id))throw new Error("Profile not loaded. Please refresh the page and try again.");console.log("Testing Supabase connection...");try{const{data:{session:mn},error:Xr}=await oe.auth.getSession();if(Xr)throw new Error(`Connection error: ${Xr.message}`);if(!mn)throw new Error("No active session. Please sign out and sign in again.");console.log(" Session verified:",mn.user.id)}catch(mn){throw(Pe=mn.message)!=null&&Pe.includes("Failed to fetch")||(yt=mn.message)!=null&&yt.includes("NetworkError")?new Error("Cannot connect to server. Please check your internet connection and try again."):mn}if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw window.location.protocol!=="https:"&&window.location.hostname!=="localhost"?new Error("Camera and microphone require HTTPS or localhost. Please use: http://localhost:5173/"):new Error("Camera and microphone are not supported on this device");if(!window.isSecureContext&&window.location.hostname!=="localhost")throw new Error("Camera access requires secure context. Please use: http://localhost:5173/");const Hr=`stream_${r.id}_${Date.now()}`;w(Hr),console.log("Channel:",Hr),console.log("User ID:",r.id),console.log("Step 1: Initializing Agora service..."),Se.current=new zw,console.log("Step 2: Requesting camera and microphone access...");const jc=await Se.current.createLocalTracks();console.log(" Camera and microphone access granted"),console.log("  Video track:",(st=jc.videoTrack)==null?void 0:st.getTrackLabel()),console.log("  Audio track:",(qr=jc.audioTrack)==null?void 0:qr.getTrackLabel()),console.log("Step 3: Storing video track for preview..."),jc.videoTrack?(te(jc.videoTrack),console.log(" Video track stored, waiting for DOM ref to attach...")):console.warn(" No video track created"),A(!0),console.log("Step 4: Joining channel as host with user ID:",r.id);const Ui="195fe587a4b84053aa0eff6ae05150b1";console.log("Using Agora App ID:",Ui),(!Ui||Ui.length!==32)&&console.warn("App ID validation warning - but continuing anyway as it may still work");try{console.log(" Attempting to join channel WITHOUT TOKEN (App ID only mode)..."),console.log(" Using App ID:",Ui),await Se.current.joinChannel({appId:Ui,channel:Hr,token:null,uid:0},"host"),console.log(" Channel joined successfully!")}catch(mn){throw console.error(" Failed to join channel:",mn),console.error("Error code:",mn.code),console.error("Error message:",mn.message),mn.code==="INVALID_OPERATION"?new Error("Streaming service error. Please check your internet connection and try again."):mn.code==="CAN_NOT_GET_GATEWAY_SERVER"||(Ze=mn.message)!=null&&Ze.includes("CAN_NOT_GET_GATEWAY_SERVER")||(Qt=mn.message)!=null&&Qt.includes("network")?new Error(`Cannot reach streaming servers. Please check:
 Internet connection is stable
 Firewall allows streaming
 No VPN blocking connection

Try moving to area with better signal.`):mn.code==="NETWORK_ERROR"||(wr=mn.message)!=null&&wr.includes("NetworkError")||(Oe=mn.message)!=null&&Oe.includes("Failed to fetch")?new Error(` STREAMING CONNECTION FAILED

Your Agora project requires tokens but token generation failed.

 SOLUTION (5 minutes):
1. Visit: https://console.agora.io
2. Find project: ${Ui}
3. Go to Authentication  Select "App ID"
4. Save changes
5. Refresh and try streaming again

Why this works: Switches from token mode to simpler App ID mode for testing.`):(Et=mn.message)!=null&&Et.includes("token")||(mt=mn.message)!=null&&mt.includes("invalid vendor key")?new Error('Streaming authentication failed. The Agora project needs to be set to "App ID" mode (no token required). Please contact support.'):mn.code==="ERR_INVALID_APP_ID"||(ut=mn.message)!=null&&ut.includes("4096")||(Ot=mn.message)!=null&&Ot.includes("Invalid App ID")?new Error(`App ID rejected by Agora servers. App ID: ${Ui}. Possible issues:
1. App ID not found in Agora Console
2. Project not in "Testing" mode
3. App ID contains typos

Please verify in Agora Console that this exact App ID exists and project is active.`):(pn=mn.message)!=null&&pn.includes("network")||(Fn=mn.message)!=null&&Fn.includes("connect")?new Error("Network connection error. Please check your internet connection and try again."):(rd=mn.message)!=null&&rd.includes("security")||(xl=mn.message)!=null&&xl.includes("certificate")?new Error("Agora security configuration error. Please ensure your project settings are correct."):new Error(`Streaming failed: ${mn.message||mn.code||"Unknown error"}. Check console for details.`)}console.log("Step 5: Publishing tracks to channel..."),await Se.current.publishTracks(),console.log(" Live stream started successfully!"),console.log(" Published tracks:"),console.log("  - Video enabled:",(Qr=jc.videoTrack)==null?void 0:Qr.enabled),console.log("  - Audio enabled:",(Ys=jc.audioTrack)==null?void 0:Ys.enabled),console.log("  - Audio track label:",(di=jc.audioTrack)==null?void 0:di.getTrackLabel()),a(` You are now live! Viewers can join "${u}"`,"success"),await E0e(r.full_name||"A scholar",u),Se.current.onUserJoined(async mn=>{B(Xr=>{const Hn=Xr+1;return console.log(" User joined:",mn.uid,"- Total viewers:",Hn),us!=null&&us.id&&oe.from("streams").update({viewer_count:Hn}).eq("id",us.id).then(()=>console.log(" Database updated with viewer count:",Hn)),Hn})}),Se.current.onUserLeft(async mn=>{B(Xr=>{const Hn=Math.max(0,Xr-1);return console.log(" User left:",mn.uid,"- Total viewers:",Hn),us!=null&&us.id&&oe.from("streams").update({viewer_count:Hn}).eq("id",us.id).then(()=>console.log(" Database updated with viewer count:",Hn)),Hn})}),A(!0),console.log(" Creating stream record in database..."),console.log("  - Scholar ID:",r==null?void 0:r.id),console.log("  - Title:",u),console.log("  - Channel:",Hr);const{data:us,error:Gu}=await oe.from("streams").insert({scholar_id:r==null?void 0:r.id,title:u,channel:Hr,is_active:!0,is_free:!0,price:0}).select().single();if(Gu)console.error(" Error creating stream record:",Gu),console.error("   Error details:",JSON.stringify(Gu,null,2)),M(`Failed to create stream record: ${Gu.message}. Stream is live but may not be visible to viewers.`);else{console.log(" Stream record created successfully"),console.log("   Stream ID:",us.id),T(us.id),Ye.current=oe.channel(`stream-${us.id}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"stream_reactions",filter:`stream_id=eq.${us.id}`},Xr=>{const Hn=Xr.new;console.log(" Reaction received:",Hn.reaction_type),de({type:Hn.reaction_type,count:1}),setTimeout(()=>de(null),3e3)}).on("postgres_changes",{event:"INSERT",schema:"public",table:"stream_participants",filter:`stream_id=eq.${us.id}`},async Xr=>{const Hn=Xr.new,{data:bi}=await oe.from("profiles").select("full_name").eq("id",Hn.user_id).single();if(bi){console.log(" User joined:",bi.full_name),Ae(`${bi.full_name} joined`),setTimeout(()=>Ae(null),5e3);const{data:sd}=await oe.from("streams").select("viewer_count").eq("id",us.id).single();sd&&B(sd.viewer_count||0)}}).on("postgres_changes",{event:"UPDATE",schema:"public",table:"streams",filter:`id=eq.${us.id}`},Xr=>{const Hn=Xr.new;Hn.viewer_count!==void 0&&B(Hn.viewer_count)}).on("postgres_changes",{event:"INSERT",schema:"public",table:"stream_comments",filter:`stream_id=eq.${us.id}`},async Xr=>{var bi;console.log(" New comment received:",Xr.new);const{data:Hn}=await oe.from("stream_comments").select(`
                  id,
                  message,
                  created_at,
                  profiles:user_id (full_name)
                `).eq("id",Xr.new.id).single();if(Hn){const sd={id:Hn.id,message:Hn.message,user_name:((bi=Hn.profiles)==null?void 0:bi.full_name)||"Anonymous",created_at:Hn.created_at};console.log(" Adding comment to scholar view:",sd),we(So=>[...So,sd]),setTimeout(()=>{var So;(So=It.current)==null||So.scrollIntoView({behavior:"smooth"})},100)}}).subscribe();const{data:mn}=await oe.from("stream_comments").select(`
            id,
            message,
            created_at,
            profiles:user_id (full_name)
          `).eq("stream_id",us.id).order("created_at",{ascending:!0}).limit(100);if(mn){const Xr=mn.map(Hn=>{var bi;return{id:Hn.id,message:Hn.message,user_name:((bi=Hn.profiles)==null?void 0:bi.full_name)||"Anonymous",created_at:Hn.created_at}});we(Xr),console.log(` Loaded ${Xr.length} existing comments`)}}}catch(Hr){console.error("Error starting stream:",Hr),(wi=Hr.message)!=null&&wi.includes("Authentication required")||(aa=Hr.message)!=null&&aa.includes("Not authenticated")?M("Authentication error. Please sign out and sign back in, then try again."):(sc=Hr.message)!=null&&sc.includes("token")||(Dl=Hr.message)!=null&&Dl.includes("Token")?M("Failed to generate streaming token. Please check your internet connection and try again."):(Cs=Hr.message)!=null&&Cs.includes("fetch")||(zs=Hr.message)!=null&&zs.includes("network")?M("Network error. Please check your internet connection and try again."):Hr.name==="NotAllowedError"||Hr.name==="PermissionDeniedError"?M("Camera and microphone access denied. Please allow permissions and try again."):Hr.name==="NotFoundError"||Hr.name==="DevicesNotFoundError"?M("No camera or microphone found. Please check your devices and try again."):(Bs=Hr.message)!=null&&Bs.includes("constraint")||(Fa=Hr.message)!=null&&Fa.includes("OverconstrainedError")?M("Camera or microphone is not compatible. Please try another device."):(kf=Hr.message)!=null&&kf.includes("already in use")?M("Camera or microphone is already in use by another app. Please close other apps and try again."):M(Hr.message||"Failed to start stream. Please try again.")}},hn=async()=>{console.log(" Stopping stream..."),Ye.current&&(await Ye.current.unsubscribe(),Ye.current=null);try{if(Se.current&&(console.log(" Stopping camera and microphone tracks..."),await Se.current.leaveChannel(),Se.current=null,console.log(" Camera and microphone released")),te(null),W(!1),C){console.log(" Marking stream as inactive in database:",C);const Pe=new Date().toISOString(),{error:yt}=await oe.from("streams").update({is_active:!1,ended_at:Pe,viewer_count:0}).eq("id",C);if(yt)throw console.error(" Error updating stream status:",yt),yt;console.log(" Stream marked as inactive - viewers will see this immediately via realtime")}A(!1),B(0),Q(!0),Y(!0),w(""),T(null),M(""),we([]),console.log(" Stream stopped successfully - all permissions released")}catch(Pe){console.error(" Error stopping stream:",Pe),M(Pe.message||"Failed to stop stream completely, but stream is marked as ended"),w(""),T(null),te(null),W(!1)}},rr=async()=>{Se.current&&(await Se.current.toggleVideo(!k),Q(Pe=>!Pe))},He=async()=>{Se.current&&(await Se.current.toggleAudio(!K),Y(Pe=>!Pe))};return s.canStream?p.jsx(yr,{title:c?" Live Stream":"Start Live Stream",children:p.jsxs(qe,{children:[p.jsx(Pt,{children:p.jsx(Vt,{children:c?" Live Stream":"Start Live Stream"})}),p.jsxs($e,{className:"space-y-6",children:[!c&&ne.length>0&&p.jsx("div",{className:"space-y-3",children:p.jsxs("div",{className:"p-4 bg-amber-50 border-2 border-amber-500 rounded-lg",children:[p.jsxs("h3",{className:"font-bold text-amber-900 mb-2 flex items-center gap-2",children:[p.jsx(nO,{className:"h-5 w-5"}),"Active Streams Found"]}),p.jsxs("p",{className:"text-sm text-amber-800 mb-3",children:["You have ",ne.length," active stream",ne.length>1?"s":""," that need to be stopped before starting a new one."]}),ne.map(Pe=>p.jsxs("div",{className:"bg-white p-3 rounded-md mb-2 flex items-center justify-between",children:[p.jsxs("div",{className:"flex-1",children:[p.jsx("p",{className:"font-semibold text-sm",children:Pe.title}),p.jsxs("p",{className:"text-xs text-muted-foreground",children:["Started: ",new Date(Pe.created_at).toLocaleString()]}),Pe.viewer_count>0&&p.jsxs("p",{className:"text-xs text-amber-700 flex items-center gap-1 mt-1",children:[p.jsx(yi,{className:"h-3 w-3"}),Pe.viewer_count," viewer",Pe.viewer_count>1?"s":""," watching"]})]}),p.jsxs(Re,{variant:"destructive",size:"sm",onClick:()=>Ge(Pe.id),children:[p.jsx(nO,{className:"h-4 w-4 mr-1"}),"Stop"]})]},Pe.id))]})}),ye&&!c&&p.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg text-center",children:[p.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-emerald-600 mx-auto mb-2"}),p.jsx("p",{className:"text-sm text-muted-foreground",children:"Checking for active streams..."})]}),c?p.jsxs("div",{className:"space-y-4",children:[p.jsxs("div",{className:"flex items-center justify-between p-4 bg-destructive/10 border border-destructive rounded-lg",children:[p.jsxs("div",{children:[p.jsx("p",{className:"font-semibold text-lg",children:u}),p.jsxs("p",{className:"text-sm text-muted-foreground",children:["Channel: ",E]})]}),p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx(yi,{className:"h-5 w-5"}),p.jsx("span",{className:"font-bold",children:N}),p.jsx("span",{className:"text-sm text-muted-foreground",children:"viewers"})]})]}),p.jsxs("div",{className:"relative aspect-video bg-black rounded-lg overflow-hidden",children:[p.jsx("div",{ref:Qe,className:"w-full h-full",style:{width:"100%",height:"100%",backgroundColor:"#000"}}),!k&&p.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black",children:p.jsx(fG,{className:"h-16 w-16 text-white"})}),k&&!V&&p.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black",children:p.jsxs("div",{className:"text-white text-center",children:[p.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-white mx-auto mb-2"}),p.jsx("p",{className:"text-sm",children:"Initializing camera..."})]})}),ce&&p.jsx("div",{className:"absolute top-4 left-4 right-4 flex justify-center animate-in slide-in-from-top duration-300",children:p.jsxs("div",{className:"bg-emerald-600/90 text-white px-4 py-2 rounded-full shadow-lg flex items-center gap-2",children:[p.jsx(yi,{className:"h-4 w-4"}),p.jsx("span",{className:"font-semibold",children:ce})]})}),re&&p.jsx("div",{className:"absolute bottom-20 right-4 animate-in zoom-in duration-300",children:p.jsx("div",{className:`${re.type==="like"?"bg-red-500":"bg-blue-500"} text-white rounded-full p-4 shadow-lg`,children:re.type==="like"?p.jsx("span",{className:"text-3xl",children:""}):p.jsx("span",{className:"text-3xl",children:""})})})]}),p.jsxs("div",{className:"border rounded-lg p-3 space-y-2 bg-gray-50",children:[p.jsxs("h3",{className:"text-sm font-semibold mb-2 flex items-center gap-2",children:[" Live Chat",p.jsxs("span",{className:"text-xs text-muted-foreground font-normal",children:["(",Xe.length," messages)"]})]}),p.jsxs("div",{className:"h-40 overflow-y-auto space-y-2 mb-2 bg-white rounded p-2 border",children:[Xe.length===0?p.jsx("p",{className:"text-xs text-gray-400 text-center py-4",children:"No messages yet. Viewers can send messages during the stream."}):Xe.map(Pe=>p.jsxs("div",{className:"text-xs",children:[p.jsxs("span",{className:"font-semibold text-emerald-600",children:[Pe.user_name,": "]}),p.jsx("span",{className:"text-gray-700",children:Pe.message})]},Pe.id)),p.jsx("div",{ref:It})]}),p.jsx("p",{className:"text-xs text-muted-foreground italic text-center",children:"You can see viewer messages but cannot reply during the stream"})]}),p.jsxs("div",{className:"flex items-center justify-center gap-4",children:[p.jsx(Re,{variant:k?"default":"destructive",size:"lg",onClick:rr,children:k?p.jsx(bl,{className:"h-5 w-5"}):p.jsx(fG,{className:"h-5 w-5"})}),p.jsx(Re,{variant:K?"default":"destructive",size:"lg",onClick:He,children:K?p.jsx(vve,{className:"h-5 w-5"}):p.jsx(_ve,{className:"h-5 w-5"})}),p.jsxs(Re,{variant:"destructive",size:"lg",onClick:hn,className:"ml-4",children:[p.jsx(nO,{className:"h-5 w-5 mr-2"}),"Stop Stream"]})]}),F&&p.jsx("div",{className:"p-3 bg-destructive/10 border border-destructive rounded-md",children:p.jsx("p",{className:"text-sm text-destructive",children:F})})]}):p.jsxs("div",{className:"space-y-4",children:[p.jsxs("div",{children:[p.jsx("label",{className:"block text-sm font-medium mb-2",children:"Stream Title"}),p.jsx(er,{type:"text",value:u,onChange:Pe=>m(Pe.target.value),placeholder:"e.g., Friday Jummah Prayer, Tafsir Session...",disabled:c})]}),p.jsxs("div",{className:"p-4 bg-secondary rounded-lg",children:[p.jsx("h3",{className:"font-semibold mb-2",children:"Stream Information"}),p.jsxs("ul",{className:"text-sm text-muted-foreground space-y-1",children:[p.jsx("li",{children:" Your stream will be visible to all members"}),p.jsx("li",{children:" Members can join and watch in real-time"}),p.jsx("li",{children:" You can control your video and audio during the stream"}),p.jsx("li",{children:' Click "Stop Stream" to end the broadcast'})]})]}),F&&p.jsx("div",{className:"p-3 bg-destructive/10 border border-destructive rounded-md",children:p.jsx("p",{className:"text-sm text-destructive whitespace-pre-wrap",children:F})}),p.jsx(Re,{onClick:Nt,className:"w-full",size:"lg",disabled:ne.length>0||ye,children:ne.length>0?"Stop Old Streams First":ye?"Checking...":"Start Live Stream"})]})]})]})}):p.jsx("div",{className:"container mx-auto p-4 max-w-4xl",children:p.jsx(qe,{children:p.jsx($e,{className:"p-8 text-center",children:p.jsx("p",{className:"text-destructive",children:"Access Denied: Only scholars and imams can start live streams."})})})})},Kwe=()=>{const{profile:r}=gr(),s=wB(),a=ss(),[c,A]=z.useState([]),[u,m]=z.useState("all"),[E,w]=z.useState(!1),[C,T]=z.useState(!!(r!=null&&r.is_online)),[N,B]=z.useState(!1);z.useEffect(()=>{K();const q=oe.channel("consultation-status").on("postgres_changes",{event:"*",schema:"public",table:"consultation_bookings",filter:r!=null&&r.id?`scholar_id=eq.${r.id}`:void 0},()=>{K(),k()}).subscribe();return k(),()=>{q.unsubscribe()}},[]);const k=async()=>{if(!(r!=null&&r.id))return;const{data:q}=await oe.from("consultation_bookings").select("id, status").eq("scholar_id",r.id).eq("status","confirmed").limit(1),te=(q||[]).length>0;B(te)},Q=async()=>{if(!(r!=null&&r.id))return;const q=!C;T(q),await oe.from("profiles").update({is_online:q}).eq("id",r.id)},K=async()=>{if(r!=null&&r.id)try{w(!0);const{data:q,error:te}=await oe.from("consultation_bookings").select("*, user:profiles!user_id(full_name, email), amount_paid").eq("scholar_id",r.id).order("booking_date",{ascending:!1});if(te)throw te;const re=(q||[]).map(de=>{var ce,Ae;return{id:de.id,userId:de.user_id,userName:((ce=de.user)==null?void 0:ce.full_name)||"Unknown",userEmail:((Ae=de.user)==null?void 0:Ae.email)||"",date:de.booking_date||"",time:de.booking_time||"",topic:de.topic||"No topic",status:de.status||"pending",fee:de.amount_paid||0,bookedAt:de.created_at||new Date().toISOString()}});A(re)}catch(q){console.error("Error fetching bookings:",q)}finally{w(!1)}},Y=async q=>{w(!0);try{console.log(" Confirming booking:",q);const{error:te}=await oe.from("consultation_bookings").update({status:"confirmed",scholar_accepted:!0}).eq("id",q);if(te)throw console.error(" Error confirming booking:",te),te;console.log(" Booking confirmed successfully"),await K(),await k()}catch(te){console.error(" Error confirming booking:",te),alert("Failed to confirm booking: "+(te.message||"Unknown error"))}finally{w(!1)}},F=async q=>{w(!0);try{const{error:te}=await oe.from("consultation_bookings").update({status:"cancelled"}).eq("id",q);if(te)throw te;await K()}catch(te){console.error("Error cancelling booking:",te),alert("Failed to cancel booking")}finally{w(!1)}},M=async q=>{w(!0);try{console.log(" Marking consultation as complete:",q);const{error:te}=await oe.from("consultation_bookings").update({status:"completed"}).eq("id",q);if(te)throw console.error(" Error updating booking status:",te),te;if(console.log(" Booking status updated to completed"),r!=null&&r.id){const{error:re}=await oe.from("profiles").update({is_online:!0}).eq("id",r.id);re?console.error(" Error setting scholar online:",re):(console.log(" Scholar set back online"),T(!0))}await K(),await k(),console.log(" Consultation marked as complete successfully!")}catch(te){console.error(" Error completing booking:",te),alert("Failed to complete booking: "+(te.message||"Unknown error"))}finally{w(!1)}},V=u==="all"?c:c.filter(q=>q.status===u),W={total:c.length,pending:c.filter(q=>q.status==="pending").length,confirmed:c.filter(q=>q.status==="confirmed").length,completed:c.filter(q=>q.status==="completed").length,totalEarnings:c.filter(q=>q.status==="completed").reduce((q,te)=>q+te.fee*100,0)};return s.canManageConsultations?p.jsx(yr,{title:"Manage Consultations",children:p.jsx("div",{className:"container mx-auto p-4 max-w-6xl",children:p.jsxs(qe,{children:[p.jsxs(Pt,{children:[p.jsxs(Vt,{className:"flex items-center gap-2",children:[p.jsx(Fx,{className:"h-6 w-6 text-primary"}),"Consultation Bookings"]}),p.jsx(vi,{children:"Manage your consultation appointments and schedule"}),p.jsxs("div",{className:"mt-4 flex items-center gap-3",children:[p.jsx("span",{className:`text-xs px-2 py-1 rounded ${N?"bg-yellow-100 text-yellow-800":"bg-green-100 text-green-800"}`,children:N?"Busy: In Session":"Available"}),p.jsx(Re,{variant:C?"default":"outline",size:"sm",onClick:Q,children:C?"Go Offline":"Go Online"})]})]}),p.jsxs($e,{className:"space-y-6",children:[p.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-5 gap-3",children:[p.jsxs("div",{className:"p-3 bg-secondary rounded-lg text-center",children:[p.jsx("p",{className:"text-xl font-bold",children:W.total}),p.jsx("p",{className:"text-xs text-muted-foreground",children:"Total"})]}),p.jsxs("div",{className:"p-3 bg-yellow-50 rounded-lg text-center",children:[p.jsx("p",{className:"text-xl font-bold text-yellow-800",children:W.pending}),p.jsx("p",{className:"text-xs text-yellow-800",children:"Pending"})]}),p.jsxs("div",{className:"p-3 bg-blue-50 rounded-lg text-center",children:[p.jsx("p",{className:"text-xl font-bold text-blue-800",children:W.confirmed}),p.jsx("p",{className:"text-xs text-blue-800",children:"Confirmed"})]}),p.jsxs("div",{className:"p-3 bg-green-50 rounded-lg text-center",children:[p.jsx("p",{className:"text-xl font-bold text-green-800",children:W.completed}),p.jsx("p",{className:"text-xs text-green-800",children:"Completed"})]}),p.jsxs("div",{className:"p-3 bg-primary/10 rounded-lg text-center col-span-2 sm:col-span-1",children:[p.jsxs("p",{className:"text-xl font-bold text-primary",children:["",W.totalEarnings.toLocaleString()]}),p.jsx("p",{className:"text-xs text-primary",children:"Earnings"})]})]}),p.jsxs("div",{className:"flex gap-2 flex-wrap",children:[p.jsxs(Re,{variant:u==="all"?"default":"outline",size:"sm",onClick:()=>m("all"),className:"text-xs px-2.5 py-1.5 h-8",children:["All (",c.length,")"]}),p.jsxs(Re,{variant:u==="pending"?"default":"outline",size:"sm",onClick:()=>m("pending"),className:"text-xs px-2.5 py-1.5 h-8",children:["Pending (",W.pending,")"]}),p.jsxs(Re,{variant:u==="confirmed"?"default":"outline",size:"sm",onClick:()=>m("confirmed"),className:"text-xs px-2.5 py-1.5 h-8",children:["Confirmed (",W.confirmed,")"]}),p.jsxs(Re,{variant:u==="completed"?"default":"outline",size:"sm",onClick:()=>m("completed"),className:"text-xs px-2.5 py-1.5 h-8",children:["Done (",W.completed,")"]})]}),p.jsx("div",{className:"space-y-4",children:V.length===0?p.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[p.jsx(fr,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),p.jsxs("p",{children:["No ",u!=="all"?u:""," bookings"]})]}):V.map(q=>p.jsxs("div",{className:"p-4 border rounded-lg",children:[p.jsxs("div",{className:"flex items-start justify-between mb-3",children:[p.jsxs("div",{className:"flex-1",children:[p.jsx("h3",{className:"font-semibold mb-1",children:q.userName}),p.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:q.userEmail}),p.jsx("p",{className:"text-sm mb-2",children:q.topic}),p.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted-foreground",children:[p.jsxs("div",{className:"flex items-center gap-1",children:[p.jsx(fr,{className:"h-4 w-4"}),new Date(q.date).toLocaleDateString()]}),p.jsxs("div",{className:"flex items-center gap-1",children:[p.jsx(Pa,{className:"h-4 w-4"}),q.time]}),p.jsxs("span",{className:"font-semibold text-primary",children:["",(q.fee*100).toLocaleString()]})]})]}),p.jsx("span",{className:`text-xs px-2 py-1 rounded ${q.status==="confirmed"?"bg-blue-100 text-blue-800":q.status==="pending"?"bg-yellow-100 text-yellow-800":q.status==="completed"?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:q.status})]}),p.jsxs("div",{className:"flex flex-wrap gap-2",children:[q.status==="pending"&&p.jsxs(p.Fragment,{children:[p.jsxs(Re,{size:"sm",onClick:()=>Y(q.id),disabled:E,className:"flex-1 min-w-[100px]",children:[p.jsx(Ks,{className:"h-4 w-4 mr-1"}),p.jsx("span",{className:"hidden sm:inline",children:"Confirm"}),p.jsx("span",{className:"sm:hidden",children:""})]}),p.jsxs(Re,{variant:"destructive",size:"sm",onClick:()=>F(q.id),disabled:E,className:"flex-1 min-w-[100px]",children:[p.jsx(hl,{className:"h-4 w-4 mr-1"}),p.jsx("span",{className:"hidden sm:inline",children:"Decline"}),p.jsx("span",{className:"sm:hidden",children:""})]})]}),q.status==="confirmed"&&p.jsxs(p.Fragment,{children:[p.jsxs(Re,{size:"sm",onClick:()=>a(`/consultation/${q.id}/messages`),className:"flex-1 min-w-[80px]",children:[p.jsx(Nl,{className:"h-4 w-4"}),p.jsx("span",{className:"ml-1 hidden sm:inline",children:"Chat"})]}),p.jsxs(Re,{size:"sm",onClick:()=>M(q.id),disabled:E,className:"flex-1 min-w-[100px]",children:[p.jsx(Ks,{className:"h-4 w-4"}),p.jsx("span",{className:"ml-1 hidden sm:inline",children:"Complete"})]}),p.jsxs(Re,{variant:"outline",size:"sm",onClick:()=>F(q.id),disabled:E,className:"flex-1 min-w-[80px]",children:[p.jsx(hl,{className:"h-4 w-4"}),p.jsx("span",{className:"ml-1 hidden sm:inline",children:"Cancel"})]})]})]})]},q.id))})]})]})})}):p.jsx("div",{className:"container mx-auto p-4 max-w-6xl",children:p.jsx(qe,{children:p.jsxs($e,{className:"p-8 text-center",children:[p.jsx("p",{className:"text-destructive mb-2",children:"Access Denied: Only scholars and imams can manage consultation bookings."}),p.jsxs("p",{className:"text-sm text-muted-foreground",children:["Your current role: ",r==null?void 0:r.role]})]})})})},Wwe=()=>{const{profile:r}=gr(),s=ss(),[a,c]=z.useState({totalConsultations:0,totalEarnings:0,totalStreams:0,totalViewers:0,upcomingBookings:0,completedConsultations:0});z.useEffect(()=>{c({totalConsultations:0,totalEarnings:0,totalStreams:0,totalViewers:0,upcomingBookings:0,completedConsultations:0})},[]);const A=[{title:"Total Earnings",value:`$${a.totalEarnings}`,icon:Lc,color:"bg-green-50",iconColor:"text-green-600",description:"From consultations"},{title:"Consultations",value:a.totalConsultations,icon:fr,color:"bg-violet-50",iconColor:"text-violet-600",description:"Total bookings"},{title:"Live Streams",value:a.totalStreams,icon:nq,color:"bg-red-50",iconColor:"text-red-600",description:"Total broadcasts"},{title:"Total Viewers",value:a.totalViewers,icon:yi,color:"bg-blue-50",iconColor:"text-blue-600",description:"Across all streams"},{title:"Upcoming",value:a.upcomingBookings,icon:Pa,color:"bg-amber-50",iconColor:"text-amber-600",description:"Scheduled bookings"},{title:"Completed",value:a.completedConsultations,icon:Rb,color:"bg-emerald-50",iconColor:"text-emerald-600",description:"Finished sessions"}];return p.jsx(yr,{title:"Scholar Analytics",children:p.jsxs("div",{className:"p-4 space-y-6",children:[p.jsx(qe,{className:"bg-gradient-to-br from-emerald-500 to-emerald-600 border-none shadow-lg text-white",children:p.jsxs($e,{className:"p-6",children:[p.jsxs("div",{className:"flex items-center gap-4 mb-3",children:[p.jsxs("div",{className:"relative",children:[p.jsx("div",{className:"absolute inset-0 bg-emerald-300/30 rounded-lg blur-lg animate-pulse"}),p.jsx("img",{src:"/masjid-logo-dashboard.png",alt:"Masjid Logo",className:"relative h-16 w-auto drop-shadow-2xl",style:{filter:"drop-shadow(0 0 8px rgba(16, 185, 129, 0.5))"},crossOrigin:"anonymous"})]}),p.jsxs("div",{children:[p.jsxs("h2",{className:"text-2xl font-bold",children:["Welcome, ",r==null?void 0:r.full_name]}),p.jsx("p",{className:"text-emerald-100 text-sm mt-1",children:"Scholar Dashboard"})]})]}),p.jsx("p",{className:"text-emerald-100",children:"Here's an overview of your performance and activities"})]})}),p.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[p.jsx(Re,{onClick:()=>s("/scholar-consultations"),className:"bg-emerald-600 hover:bg-emerald-700 h-auto py-4",children:p.jsxs("div",{className:"flex flex-col items-center gap-1",children:[p.jsx(Nl,{className:"w-5 h-5"}),p.jsx("span",{className:"text-sm",children:"My Consultations"})]})}),p.jsx(Re,{onClick:()=>s("/wallet"),variant:"outline",className:"h-auto py-4",children:p.jsxs("div",{className:"flex flex-col items-center gap-1",children:[p.jsx(Lc,{className:"w-5 h-5"}),p.jsx("span",{className:"text-sm",children:"Wallet"})]})})]}),p.jsx("div",{className:"grid grid-cols-2 gap-4",children:A.map((u,m)=>{const E=u.icon;return p.jsx(qe,{className:`${u.color} border-none shadow-md`,children:p.jsxs($e,{className:"p-4",children:[p.jsx("div",{className:"flex items-start justify-between mb-3",children:p.jsx("div",{className:"p-2 rounded-lg bg-white",children:p.jsx(E,{className:`h-5 w-5 ${u.iconColor}`})})}),p.jsxs("div",{children:[p.jsx("p",{className:"text-2xl font-bold text-gray-900 mb-1",children:u.value}),p.jsx("p",{className:"text-sm font-semibold text-gray-700",children:u.title}),p.jsx("p",{className:"text-xs text-gray-600",children:u.description})]})]})},m)})}),p.jsxs(qe,{children:[p.jsx(Pt,{children:p.jsx(Vt,{className:"text-lg",children:"Recent Activity"})}),p.jsx($e,{children:p.jsxs("div",{className:"space-y-4",children:[p.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[p.jsxs("div",{className:"flex items-center gap-3",children:[p.jsx("div",{className:"p-2 bg-green-100 rounded-full",children:p.jsx(Lc,{className:"h-4 w-4 text-green-600"})}),p.jsxs("div",{children:[p.jsx("p",{className:"text-sm font-semibold",children:"Consultation Payment"}),p.jsx("p",{className:"text-xs text-gray-600",children:"2 hours ago"})]})]}),p.jsx("span",{className:"text-sm font-bold text-green-600",children:"+$50"})]}),p.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[p.jsxs("div",{className:"flex items-center gap-3",children:[p.jsx("div",{className:"p-2 bg-violet-100 rounded-full",children:p.jsx(fr,{className:"h-4 w-4 text-violet-600"})}),p.jsxs("div",{children:[p.jsx("p",{className:"text-sm font-semibold",children:"New Booking"}),p.jsx("p",{className:"text-xs text-gray-600",children:"5 hours ago"})]})]}),p.jsx("span",{className:"text-xs text-gray-600",children:"Tomorrow 2PM"})]}),p.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[p.jsxs("div",{className:"flex items-center gap-3",children:[p.jsx("div",{className:"p-2 bg-red-100 rounded-full",children:p.jsx(yi,{className:"h-4 w-4 text-red-600"})}),p.jsxs("div",{children:[p.jsx("p",{className:"text-sm font-semibold",children:"Live Stream Ended"}),p.jsx("p",{className:"text-xs text-gray-600",children:"Yesterday"})]})]}),p.jsx("span",{className:"text-xs text-gray-600",children:"45 viewers"})]})]})})]}),p.jsxs(qe,{children:[p.jsx(Pt,{children:p.jsx(Vt,{className:"text-lg",children:"Performance Insights"})}),p.jsx($e,{children:p.jsxs("div",{className:"space-y-4",children:[p.jsxs("div",{children:[p.jsxs("div",{className:"flex justify-between text-sm mb-2",children:[p.jsx("span",{className:"text-gray-600",children:"Consultation Success Rate"}),p.jsx("span",{className:"font-bold text-emerald-600",children:"87%"})]}),p.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:p.jsx("div",{className:"bg-emerald-600 h-2 rounded-full",style:{width:"87%"}})})]}),p.jsxs("div",{children:[p.jsxs("div",{className:"flex justify-between text-sm mb-2",children:[p.jsx("span",{className:"text-gray-600",children:"Average Stream Viewers"}),p.jsx("span",{className:"font-bold text-blue-600",children:"23 per stream"})]}),p.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:p.jsx("div",{className:"bg-blue-600 h-2 rounded-full",style:{width:"65%"}})})]}),p.jsxs("div",{children:[p.jsxs("div",{className:"flex justify-between text-sm mb-2",children:[p.jsx("span",{className:"text-gray-600",children:"Member Satisfaction"}),p.jsx("span",{className:"font-bold text-amber-600",children:"4.8/5.0"})]}),p.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:p.jsx("div",{className:"bg-amber-600 h-2 rounded-full",style:{width:"96%"}})})]})]})})]})]})})},Ywe=()=>{const{profile:r}=gr(),{showNotification:s}=Hu(),[a,c]=z.useState(0),[A,u]=z.useState([]),[m,E]=z.useState(""),[w,C]=z.useState(!1),[T,N]=z.useState(""),[B,k]=z.useState(""),[Q,K]=z.useState(!0);z.useEffect(()=>{if(!(r!=null&&r.id))return;Y();const W=oe.channel("wallet-realtime").on("postgres_changes",{event:"*",schema:"public",table:"profiles",filter:`id=eq.${r.id}`},q=>{console.log(" Profile balance changed:",q),Y()}).on("postgres_changes",{event:"*",schema:"public",table:"masjid_coin_transactions",filter:`recipient_id=eq.${r.id}`},q=>{console.log(" New transaction received (recipient):",q),Y()}).on("postgres_changes",{event:"*",schema:"public",table:"masjid_coin_transactions",filter:`user_id=eq.${r.id}`},q=>{console.log(" New transaction created (user):",q),Y()}).subscribe(q=>{console.log(" Wallet realtime subscription status:",q)});return()=>{W.unsubscribe()}},[r==null?void 0:r.id]);const Y=async()=>{try{if(!(r!=null&&r.id)){console.log(" No profile ID, skipping wallet fetch");return}console.log(" Fetching wallet data for scholar:",r.id);const{data:W,error:q}=await oe.from("profiles").select("masjid_coin_balance").eq("id",r.id).single();if(q)throw q;const te=(W==null?void 0:W.masjid_coin_balance)||0,re=te*100;console.log(` Scholar balance: ${te} coins = ${re}`),c(re),console.log(" Fetching transactions for scholar ID:",r.id);let{data:de,error:ce}=await oe.from("masjid_coin_transactions").select("id, amount, type, created_at, user_id, recipient_id, payment_status, donor:profiles!user_id(full_name)").or(`recipient_id.eq.${r.id},user_id.eq.${r.id}`).eq("payment_status","completed").order("created_at",{ascending:!1}).limit(20);ce&&(console.warn(" Transaction query with join failed, using fallback:",ce),de=((await oe.from("masjid_coin_transactions").select("id, amount, type, created_at, user_id, recipient_id, payment_status").or(`recipient_id.eq.${r.id},user_id.eq.${r.id}`).eq("payment_status","completed").order("created_at",{ascending:!1}).limit(20)).data||[]).map(De=>({...De,donor:[]}))),console.log(` Found ${(de==null?void 0:de.length)||0} transactions`),de&&de.length>0&&console.log("Transaction details:",de.map(ye=>({type:ye.type,amount:ye.amount,payment_status:ye.payment_status,recipient_id:ye.recipient_id,user_id:ye.user_id,is_for_scholar:ye.recipient_id===r.id||ye.user_id===r.id})));const Ae=Array.from(new Set((de||[]).map(ye=>ye.user_id).filter(Boolean)));let ne={};if(Ae.length>0){const{data:ye}=await oe.from("profiles").select("id, full_name").in("id",Ae);ye==null||ye.forEach(De=>{ne[De.id]=De.full_name})}const ue=(de||[]).map(ye=>{var Ye;const De=ye.recipient_id===r.id,Xe=ye.user_id===r.id;if(!De&&!Xe)return console.error(" Security violation: Transaction does not belong to scholar!",{tx_id:ye.id,scholar_id:r.id,tx_recipient:ye.recipient_id,tx_user:ye.user_id}),null;let we="withdrawal";De?ye.type==="donation"||ye.type==="donation_received"||ye.type==="zakat"?(we="zakat",console.log(" Zakat transaction found:",{id:ye.id,amount:ye.amount,type:ye.type,recipient_id:ye.recipient_id})):ye.type==="consultation"&&(we="consultation"):Xe&&ye.type==="withdrawal"&&(we="withdrawal");const Qe=Math.abs(Number(ye.amount||0))*100;return{id:ye.id,amount:Qe,donorName:((Ye=ye.donor)==null?void 0:Ye.full_name)||ne[ye.user_id]||"Anonymous",date:new Date(ye.created_at).toISOString(),type:we}}).filter(ye=>ye!==null);u(ue)}catch(W){console.error("Error fetching wallet data:",W),N("Failed to load wallet data")}},F=async()=>{var te;const W=parseFloat(m);if(!W||W<100){N("Please enter a valid amount (minimum 100)");return}const q=Math.abs(a);if(W>q){N(`Insufficient balance. You have ${q.toFixed(2)} available.`);return}if(!(r!=null&&r.bank_account_number)||!(r!=null&&r.bank_code)){N("Please add your bank account details in Profile Settings before withdrawing.");return}N(""),k(""),C(!0);try{const re=W/100,de=`WTH_${Date.now()}_${Math.floor(Math.random()*1e6)}`;console.log(" Calling withdrawal API with:",{amount:W,reference:de,account_number:r.bank_account_number,bank_code:r.bank_code,account_name:r.bank_account_name||r.full_name});const{data:ce,error:Ae}=await oe.functions.invoke("process-withdrawal",{body:{amount:W,reference:de,scholar_id:r.id,account_number:r.bank_account_number,bank_code:r.bank_code,account_name:r.bank_account_name||r.full_name}});if(console.log(" Withdrawal API response:",{transferResult:ce,transferError:Ae}),Ae&&(console.error(" Full error details:",{name:Ae.name,message:Ae.message,context:Ae.context,details:Ae.details}),Ae.context))try{const Xe=await Ae.context.json();console.error(" Error response body:",Xe)}catch{console.error("Could not parse error response")}if(Ae||!(ce!=null&&ce.success)){const Xe=(Ae==null?void 0:Ae.message)||"";if(Xe.includes("Failed to send a request")||Xe.includes("CORS")||Xe.includes("ERR_FAILED"))throw new Error(" Withdrawal system is being deployed. Please try again in a few minutes or contact support.");const we=(ce==null?void 0:ce.message)||(Ae==null?void 0:Ae.message)||"Transfer failed";throw console.error(" Withdrawal failed:",we),new Error(we)}console.log(" Paystack transfer successful, updating database...");const{data:ne,error:ue}=await oe.from("profiles").select("masjid_coin_balance").eq("id",r.id).single();if(ue)throw ue;const De=Math.abs((ne==null?void 0:ne.masjid_coin_balance)||0)-re;await oe.from("profiles").update({masjid_coin_balance:De}).eq("id",r.id),await oe.from("masjid_coin_transactions").insert({user_id:r==null?void 0:r.id,recipient_id:r==null?void 0:r.id,amount:-re,type:"withdrawal",description:`Withdrawal to ${r.bank_name||"bank"} ${(te=r.bank_account_number)==null?void 0:te.slice(-4)}`,payment_reference:de,status:"completed",payment_status:"completed"}),k(`Withdrawal of ${W.toFixed(2)} initiated! Funds will arrive in your bank account within 24 hours.`),E(""),await Y()}catch(re){console.error("Withdrawal error:",re),N(re.message||"Failed to process withdrawal. Please try again.")}finally{C(!1)}},M=A.filter(W=>W.type==="zakat").reduce((W,q)=>W+q.amount,0),V=A.filter(W=>W.type==="withdrawal").reduce((W,q)=>W+q.amount,0);return p.jsx(yr,{title:"Manage Wallet",children:p.jsxs("div",{className:"p-4 space-y-4",children:[p.jsxs(qe,{className:"bg-gradient-to-br from-emerald-500 to-emerald-700 text-white",children:[p.jsx(Pt,{children:p.jsxs("div",{className:"flex items-center justify-between",children:[p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx(Ma,{className:"h-6 w-6"}),p.jsx(Vt,{className:"text-white",children:"Zakat & Consultation Balance"})]}),p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx(Re,{variant:"ghost",size:"icon",className:"text-white hover:bg-emerald-600",onClick:async()=>{await Y(),s("Balance refreshed!","success")},title:"Refresh Balance",children:p.jsx(aq,{className:"h-5 w-5"})}),p.jsx(Re,{variant:"ghost",size:"icon",className:"text-white hover:bg-emerald-600",onClick:()=>K(!Q),children:Q?p.jsx(sq,{className:"h-5 w-5"}):p.jsx($Ee,{className:"h-5 w-5"})})]})]})}),p.jsxs($e,{children:[p.jsx("div",{className:"text-4xl font-bold mb-2",children:Q?`${Math.abs(a).toFixed(2)}`:"****"}),p.jsx("p",{className:"text-emerald-100 text-sm",children:"From zakat contributions and consultation earnings"})]})]}),p.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[p.jsxs(qe,{children:[p.jsx(Pt,{className:"pb-2",children:p.jsx(vi,{className:"text-xs",children:"Total Zakat Received"})}),p.jsx($e,{children:p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx(Rb,{className:"h-4 w-4 text-green-600"}),p.jsxs("span",{className:"text-2xl font-bold text-green-600",children:["",M.toFixed(2)]})]})})]}),p.jsxs(qe,{children:[p.jsx(Pt,{className:"pb-2",children:p.jsx(vi,{className:"text-xs",children:"Total Withdrawn"})}),p.jsx($e,{children:p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx(eO,{className:"h-4 w-4 text-blue-600"}),p.jsxs("span",{className:"text-2xl font-bold text-blue-600",children:["",V.toFixed(2)]})]})})]})]}),p.jsxs(qe,{children:[p.jsxs(Pt,{children:[p.jsxs(Vt,{className:"flex items-center gap-2",children:[p.jsx(eO,{className:"h-5 w-5"}),"Withdraw Funds"]}),p.jsx(vi,{children:"Transfer funds to your bank account"})]}),p.jsxs($e,{className:"space-y-4",children:[!(r!=null&&r.bank_account_number)&&p.jsxs("div",{className:"bg-blue-50 border border-blue-200 text-blue-800 px-4 py-3 rounded-lg text-sm",children:[p.jsx("strong",{children:" Bank Account Required:"})," Please add your bank account details in"," ",p.jsx("button",{onClick:()=>window.location.href="/profile-settings",className:"underline font-semibold hover:text-blue-900",children:"Profile Settings"})," before withdrawing funds."]}),T&&p.jsx("div",{className:"bg-red-50 border border-red-200 text-red-800 px-4 py-3 rounded-lg text-sm",children:T}),B&&p.jsx("div",{className:"bg-green-50 border border-green-200 text-green-800 px-4 py-3 rounded-lg text-sm",children:B}),p.jsxs("div",{className:"space-y-2",children:[p.jsx("label",{className:"text-sm font-medium",children:"Amount ()"}),p.jsxs("div",{className:"relative",children:[p.jsx(Lc,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),p.jsx(er,{type:"number",value:m,onChange:W=>E(W.target.value),placeholder:"Enter amount",className:"pl-10",min:"1",max:a})]}),p.jsxs("p",{className:"text-xs text-gray-500",children:["Maximum: ",a.toFixed(2)]})]}),p.jsx(Re,{onClick:F,disabled:w||!m,className:"w-full bg-emerald-600 hover:bg-emerald-700",children:w?"Processing...":"Withdraw Funds"})]})]}),p.jsxs(qe,{children:[p.jsxs(Pt,{children:[p.jsx(Vt,{children:"Transaction History"}),p.jsx(vi,{children:"Zakat, donations, and withdrawals"})]}),p.jsx($e,{children:p.jsx("div",{className:"space-y-3",children:A.length===0?p.jsx("p",{className:"text-center text-gray-500 py-8",children:"No transactions yet"}):A.map(W=>p.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[p.jsxs("div",{className:"flex items-center gap-3",children:[p.jsx("div",{className:`p-2 rounded-full ${W.type==="zakat"?"bg-green-100":W.type==="consultation"?"bg-emerald-100":"bg-blue-100"}`,children:W.type==="zakat"?p.jsx(Ma,{className:"h-4 w-4 text-green-600"}):W.type==="consultation"?p.jsx(Lc,{className:"h-4 w-4 text-emerald-600"}):p.jsx(eO,{className:"h-4 w-4 text-blue-600"})}),p.jsxs("div",{children:[p.jsxs("p",{className:"font-medium text-sm",children:[W.type==="zakat"?"Zakat/Donation - ":W.type==="consultation"?"Consultation Fee - ":"",W.donorName]}),p.jsx("p",{className:"text-xs text-gray-500",children:new Date(W.date).toLocaleDateString()})]})]}),p.jsxs("div",{className:`font-bold ${W.type==="zakat"?"text-green-600":W.type==="consultation"?"text-emerald-600":"text-blue-600"}`,children:[W.type==="withdrawal"?"-":"+","",W.amount.toFixed(2)]})]},W.id))})})]})]})})},zwe=()=>{const{profile:r}=gr(),[s,a]=z.useState(!1),[c,A]=z.useState(!1),[u,m]=z.useState(!1),[E,w]=z.useState("");z.useEffect(()=>{const N=async()=>{if(!(r!=null&&r.id))return;const{data:k}=await oe.from("profiles").select("is_online").eq("id",r.id).single();a(!!(k!=null&&k.is_online));const{data:Q}=await oe.from("consultations").select("id, started_at, actual_ended_at, status").eq("scholar_id",r.id).is("actual_ended_at",null).limit(1);A(!!Q&&Q.length>0&&!!Q[0].started_at&&Q[0].status!=="completed")};N();const B=oe.channel("availability-updates").on("postgres_changes",{event:"*",schema:"public",table:"consultations",filter:`scholar_id=eq.${r==null?void 0:r.id}`},()=>N()).on("postgres_changes",{event:"UPDATE",schema:"public",table:"profiles",filter:`id=eq.${r==null?void 0:r.id}`},()=>N()).subscribe();return()=>{B.unsubscribe()}},[r==null?void 0:r.id]);const C=async N=>{try{if(m(!0),w(""),!(r!=null&&r.id))throw new Error("Not authenticated");const{error:B}=await oe.from("profiles").update({is_online:N}).eq("id",r.id);if(B)throw B;a(N)}catch(B){w(B.message||"Failed to update availability")}finally{m(!1)}},T=c?"Busy (in consultation)":s?"Available":"Offline";return p.jsx(yr,{title:"Availability",showBack:!0,children:p.jsxs(qe,{children:[p.jsxs(Pt,{children:[p.jsx(Vt,{children:"Consultation Availability"}),p.jsx(vi,{children:"Toggle whether members can see and book you for consultations."})]}),p.jsxs($e,{className:"space-y-4",children:[p.jsx("div",{className:"p-3 rounded bg-gray-50",children:p.jsxs("p",{className:"text-sm",children:["Current Status: ",p.jsx("span",{className:"font-semibold",children:T})]})}),E&&p.jsx("div",{className:"p-3 bg-destructive/10 border border-destructive rounded",children:p.jsx("p",{className:"text-destructive text-sm",children:E})}),p.jsxs("div",{className:"flex gap-2",children:[p.jsx(Re,{className:"bg-emerald-600 hover:bg-emerald-700",disabled:u||c||s,onClick:()=>C(!0),children:"Set Available"}),p.jsx(Re,{variant:"outline",disabled:u||!s,onClick:()=>C(!1),children:"Go Offline"})]}),c&&p.jsx("p",{className:"text-xs text-muted-foreground",children:"You are in an active consultation; availability changes are disabled."})]})]})})};function qwe({bookingId:r,scholarId:s,scholarName:a,consultationDuration:c,onClose:A}){const{profile:u}=gr(),[m,E]=z.useState([]),[w,C]=z.useState(""),[T,N]=z.useState(c*60),[B,k]=z.useState(!0),[Q,K]=z.useState(!1),[Y,F]=z.useState(!1),M=z.useRef(null),V=z.useRef(null),W=(u==null?void 0:u.role)==="scholar"||(u==null?void 0:u.role)==="imam";z.useEffect(()=>{(async()=>{try{console.log(" Fetching booking data for timer initialization...",{bookingId:r,consultationDuration:c});const{data:ue,error:ye}=await oe.from("consultation_bookings").select("started_at, consultation_duration").eq("id",r).single();if(ye){console.error(" Error fetching booking:",ye),console.log(" Using fallback timer with consultationDuration prop:",c),N(c*60),F(!0);return}console.log(" Booking data fetched:",ue);const De=ue.consultation_duration||c;if(console.log(" Consultation duration:",De,"minutes"),ue.started_at){const Xe=new Date(ue.started_at).getTime(),we=new Date().getTime(),Se=Math.floor((we-Xe)/1e3),Qe=De*60,Ye=Math.max(0,Qe-Se);console.log(" Timer initialized from started_at:"),console.log(`  - Start time: ${new Date(ue.started_at).toLocaleString()}`),console.log(`  - Elapsed: ${Se}s (${Math.floor(Se/60)}m ${Se%60}s)`),console.log(`  - Total: ${Qe}s (${De}m)`),console.log(`  - Remaining: ${Ye}s (${Math.floor(Ye/60)}m ${Ye%60}s)`),N(Ye),Ye<=0&&(console.log(" Timer expired"),k(!1))}else{console.log(" First time opening chat - setting started_at timestamp");const Xe=new Date().toISOString(),{error:we}=await oe.from("consultation_bookings").update({started_at:Xe}).eq("id",r);we?console.error(" Error setting started_at:",we):console.log(" started_at set to:",Xe);const Se=De*60;console.log(` Starting new timer: ${Se}s (${De}m)`),N(Se)}F(!0),console.log(" Timer initialization complete")}catch(ue){console.error(" Fatal error initializing timer:",ue),N(c*60),F(!0)}})()},[r,c]);const q=ne=>{const ue=Math.floor(ne/60),ye=ne%60;return`${ue}:${ye.toString().padStart(2,"0")}`};z.useEffect(()=>{if(!Y||!B){V.current&&(clearInterval(V.current),V.current=null);return}return console.log(" Starting countdown interval"),V.current=setInterval(()=>{N(ne=>{const ue=ne-1;return ue%30===0&&console.log(` Timer tick: ${Math.floor(ue/60)}:${(ue%60).toString().padStart(2,"0")}`),ue<=0?(console.log(" Timer reached 0 - expiring consultation"),k(!1),te(),0):ue})},1e3),()=>{V.current&&(console.log(" Cleaning up countdown interval"),clearInterval(V.current),V.current=null)}},[Y,B]);const te=async()=>{try{await oe.from("consultation_bookings").update({status:"completed"}).eq("id",r)}catch(ne){console.error("Error updating booking status:",ne)}};z.useEffect(()=>{re();const ne=oe.channel(`consultation_chat_${r}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"consultation_messages",filter:`booking_id=eq.${r}`},ue=>{const ye=ue.new;E(De=>[...De,ye]),de()}).subscribe();return()=>{oe.removeChannel(ne)}},[r]);const re=async()=>{try{const{data:ne,error:ue}=await oe.from("consultation_messages").select(`
          *,
          sender:profiles!sender_id(full_name)
        `).eq("booking_id",r).order("created_at",{ascending:!0});if(ue)throw ue;const ye=(ne==null?void 0:ne.map(De=>{var Xe;return{...De,sender_name:((Xe=De.sender)==null?void 0:Xe.full_name)||"Unknown"}}))||[];E(ye),de()}catch(ne){console.error("Error loading messages:",ne)}},de=()=>{setTimeout(()=>{var ne;(ne=M.current)==null||ne.scrollIntoView({behavior:"smooth"})},100)},ce=async()=>{if(!(!w.trim()||!B))try{const{error:ne}=await oe.from("consultation_messages").insert({booking_id:r,sender_id:u==null?void 0:u.id,message:w.trim()});if(ne)throw ne;C("")}catch(ne){console.error("Error sending message:",ne),alert("Failed to send message")}},Ae=async()=>{if(Q)return;const ne=15,ue=5,ye=(u==null?void 0:u.masjid_coin_balance)||0;if(ye<ue){alert(`Insufficient balance. You need ${ue} coins to extend consultation by ${ne} minutes.`);return}if(confirm(`Extend consultation by ${ne} minutes for ${ue} coins?`)){K(!0);try{const{error:De}=await oe.from("profiles").update({masjid_coin_balance:ye-ue}).eq("id",u==null?void 0:u.id);if(De)throw new Error("Failed to deduct coins");console.log(` Scholar will be credited ${ue} coins via database trigger`);const Xe=`EXT-${Date.now()}`;await oe.from("masjid_coin_transactions").insert([{user_id:u==null?void 0:u.id,recipient_id:s,amount:-ue,type:"consultation_extension",description:`Extended consultation with ${a}`,payment_reference:Xe,payment_status:"completed",status:"completed"},{user_id:s,recipient_id:s,amount:ue,type:"consultation_extension",description:`Extension fee from ${u==null?void 0:u.full_name}`,payment_reference:Xe,payment_status:"completed",status:"completed"}]),N(we=>we+ne*60),k(!0),alert(`Consultation extended by ${ne} minutes!`)}catch(De){console.error("Error extending consultation:",De),alert("Failed to extend consultation")}finally{K(!1)}}};return p.jsxs(qe,{className:"h-full flex flex-col",children:[p.jsxs(Pt,{className:"border-b",children:[p.jsxs("div",{className:"flex justify-between items-start",children:[p.jsxs("div",{children:[p.jsx(Vt,{children:"Consultation Chat"}),p.jsx(vi,{children:W?"Consulting with member":`Consulting with ${a}`})]}),p.jsx(Re,{onClick:A,variant:"outline",size:"sm",children:"Close"})]}),p.jsxs("div",{className:`mt-4 p-3 rounded-lg flex items-center justify-between ${T<300?"bg-red-50 border border-red-200":"bg-green-50 border border-green-200"}`,children:[p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx(Pa,{className:`w-5 h-5 ${T<300?"text-red-600":"text-green-600"}`}),Y?p.jsxs(p.Fragment,{children:[p.jsx("span",{className:`font-mono text-lg font-bold ${T<300?"text-red-700":"text-green-700"}`,children:q(T)}),p.jsx("span",{className:"text-sm text-gray-600",children:"remaining"})]}):p.jsx("span",{className:"text-sm text-gray-600",children:"Loading timer..."})]}),!W&&!B&&p.jsxs(Re,{onClick:Ae,disabled:Q,size:"sm",className:"bg-emerald-600 hover:bg-emerald-700",children:[p.jsx(aq,{className:"w-4 h-4 mr-2"}),"Extend (5 coins)"]})]}),!B&&p.jsxs("div",{className:"mt-3 p-3 bg-amber-50 border border-amber-200 rounded-lg flex items-start gap-2",children:[p.jsx(Of,{className:"h-5 w-5 text-amber-600 mt-0.5"}),p.jsx("p",{className:"text-sm text-amber-800",children:W?"Consultation time has expired. Waiting for member to extend or close.":"Consultation time has expired. You can extend for 15 more minutes using 5 Masjid Coins."})]})]}),p.jsxs($e,{className:"flex-1 flex flex-col p-0",children:[p.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[m.length===0?p.jsx("div",{className:"text-center text-gray-500 mt-8",children:"No messages yet. Start the conversation!"}):m.map(ne=>{const ue=ne.sender_id===(u==null?void 0:u.id);return p.jsx("div",{className:`flex ${ue?"justify-end":"justify-start"}`,children:p.jsxs("div",{className:`max-w-[70%] ${ue?"order-2":"order-1"}`,children:[p.jsxs("div",{className:`rounded-lg px-4 py-2 ${ue?"bg-emerald-600 text-white":"bg-gray-100 text-gray-900"}`,children:[!ue&&p.jsx("div",{className:"text-xs font-semibold mb-1 opacity-75",children:ne.sender_name}),p.jsx("p",{className:"text-sm whitespace-pre-wrap break-words",children:ne.message})]}),p.jsx("div",{className:`text-xs text-gray-500 mt-1 ${ue?"text-right":"text-left"}`,children:new Date(ne.created_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})},ne.id)}),p.jsx("div",{ref:M})]}),p.jsx("div",{className:"border-t p-4",children:B?p.jsxs("div",{className:"flex gap-2",children:[p.jsx(er,{value:w,onChange:ne=>C(ne.target.value),onKeyDown:ne=>ne.key==="Enter"&&!ne.shiftKey&&ce(),placeholder:"Type your message...",className:"flex-1"}),p.jsx(Re,{onClick:ce,disabled:!w.trim(),className:"bg-emerald-600 hover:bg-emerald-700",children:p.jsx(oq,{className:"w-4 h-4"})})]}):p.jsx("div",{className:"text-center text-gray-500 py-2",children:"Chat is disabled - consultation time has expired"})})]})]})}const xG=()=>{const{profile:r}=gr(),{showNotification:s}=Hu(),[a,c]=z.useState([]),[A,u]=z.useState(!0),[m,E]=z.useState(null),[w,C]=z.useState(null),[T,N]=z.useState(!1),[B,k]=z.useState(1e3),[Q,K]=z.useState(30),[Y,F]=z.useState(!1);z.useEffect(()=>{W(),M();const re=oe.channel("scholar_consultations").on("postgres_changes",{event:"*",schema:"public",table:"consultation_bookings",filter:`scholar_id=eq.${r==null?void 0:r.id}`},()=>{W()}).subscribe();return()=>{oe.removeChannel(re)}},[r==null?void 0:r.id]);const M=async()=>{if(r!=null&&r.id)try{const{data:re}=await oe.from("profiles").select("consultation_fee, consultation_duration").eq("id",r.id).single();re&&(k(re.consultation_fee||1e3),K(re.consultation_duration||30))}catch(re){console.error("Error loading settings:",re)}},V=async()=>{if(r!=null&&r.id){F(!0);try{const{error:re}=await oe.from("profiles").update({consultation_fee:B,consultation_duration:Q}).eq("id",r.id);if(re)throw re;alert("Settings saved successfully!"),N(!1)}catch(re){console.error("Error saving settings:",re),alert("Failed to save settings")}finally{F(!1)}}},W=async()=>{if(r!=null&&r.id)try{u(!0);const{data:re,error:de}=await oe.from("consultation_bookings").select(`
          *,
          user:profiles!user_id(full_name)
        `).eq("scholar_id",r.id).order("scheduled_at",{ascending:!0});if(de)throw de;c(re||[])}catch(re){console.error("Error fetching consultations:",re)}finally{u(!1)}},q=re=>{switch(re){case"confirmed":return"bg-green-100 text-green-800";case"pending":return"bg-yellow-100 text-yellow-800";case"completed":return"bg-blue-100 text-blue-800";case"cancelled":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},te=re=>{switch(re){case"confirmed":return p.jsx(Ks,{className:"w-4 h-4 text-green-600"});case"pending":return p.jsx(Pa,{className:"w-4 h-4 text-yellow-600"});case"completed":return p.jsx(Ks,{className:"w-4 h-4 text-blue-600"});case"cancelled":return p.jsx(Of,{className:"w-4 h-4 text-red-600"});default:return null}};return A?p.jsx(yr,{title:"My Consultations",children:p.jsx("div",{className:"flex items-center justify-center h-64",children:p.jsxs("div",{className:"text-center",children:[p.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-emerald-600 mx-auto"}),p.jsx("p",{className:"mt-4 text-gray-600",children:"Loading consultations..."})]})})}):p.jsxs(yr,{title:"My Consultations",children:[p.jsxs("div",{className:"space-y-4",children:[p.jsxs(Re,{onClick:()=>N(!T),variant:"outline",className:"w-full",children:[p.jsx(cq,{className:"w-4 h-4 mr-2"}),"Consultation Settings"]}),T&&p.jsxs(qe,{children:[p.jsx(Pt,{children:p.jsx(Vt,{children:"Consultation Settings"})}),p.jsxs($e,{className:"space-y-4",children:[p.jsxs("div",{children:[p.jsx("label",{htmlFor:"fee",className:"block text-sm font-medium mb-2",children:"Consultation Fee (Naira)"}),p.jsx(er,{id:"fee",type:"number",min:"100",step:"100",value:B,onChange:re=>k(Number(re.target.value))}),p.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["= ",Math.floor(B*.01)," Masjid Coins"]})]}),p.jsxs("div",{children:[p.jsx("label",{htmlFor:"duration",className:"block text-sm font-medium mb-2",children:"Consultation Duration (minutes)"}),p.jsx(er,{id:"duration",type:"number",min:"15",step:"15",value:Q,onChange:re=>K(Number(re.target.value))})]}),p.jsxs("div",{className:"flex gap-2",children:[p.jsx(Re,{onClick:V,disabled:Y,className:"flex-1 bg-emerald-600 hover:bg-emerald-700",children:Y?"Saving...":"Save Settings"}),p.jsx(Re,{onClick:()=>N(!1),variant:"outline",className:"flex-1",children:"Cancel"})]})]})]}),a.length===0?p.jsx(qe,{children:p.jsxs($e,{className:"p-6 text-center",children:[p.jsx(fr,{className:"w-12 h-12 text-gray-400 mx-auto mb-3"}),p.jsx("p",{className:"text-gray-600",children:"No consultations yet"})]})}):a.map(re=>p.jsxs(qe,{className:"hover:shadow-md transition-shadow",children:[p.jsx(Pt,{className:"pb-3",children:p.jsxs("div",{className:"flex items-start justify-between",children:[p.jsx("div",{className:"flex-1",children:p.jsxs(Vt,{className:"text-lg flex items-center gap-2",children:[p.jsx(yB,{className:"w-5 h-5"}),re.user.full_name]})}),p.jsxs("div",{className:"flex items-center gap-2",children:[te(re.status),p.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${q(re.status)}`,children:re.status})]})]})}),p.jsxs($e,{className:"space-y-3",children:[p.jsxs("div",{className:"space-y-2",children:[p.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[p.jsx(fr,{className:"w-4 h-4 text-gray-500"}),p.jsx("span",{children:new Date(re.scheduled_at).toLocaleDateString()})]}),p.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[p.jsx(Pa,{className:"w-4 h-4 text-gray-500"}),p.jsxs("span",{children:[new Date(re.scheduled_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})," ","(",re.consultation_duration," mins)"]})]}),re.topic&&p.jsxs("div",{className:"text-sm",children:[p.jsx("span",{className:"font-semibold",children:"Topic:"})," ",re.topic]})]}),re.status==="confirmed"&&p.jsxs(Re,{size:"sm",className:"w-full bg-emerald-600 hover:bg-emerald-700",onClick:()=>{s(`Starting consultation with ${re.user.full_name}. Duration: ${re.consultation_duration} minutes.`,"info"),E(re.id),C({id:re.user_id,name:re.user.full_name,duration:re.consultation_duration})},children:[p.jsx(Nl,{className:"w-4 h-4 mr-2"}),"Start Consultation Chat"]})]})]},re.id))]}),m&&w&&r&&p.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:p.jsx("div",{className:"bg-white rounded-lg w-full max-w-2xl h-[600px] max-h-[90vh]",children:p.jsx(qwe,{bookingId:m,scholarId:r.id,scholarName:r.full_name||"Scholar",userId:w.id,consultationDuration:w.duration,onClose:()=>{E(null),C(null)}})})})]})},Xwe=()=>{const{profile:r}=gr(),s=ss(),[a,c]=z.useState([]),[A,u]=z.useState([]),[m,E]=z.useState(!0),[w,C]=z.useState("");z.useEffect(()=>{T();const F=setInterval(T,5e3),M=oe.channel("streams-changes").on("postgres_changes",{event:"*",schema:"public",table:"streams"},V=>{console.log("Stream change detected:",V),T(),N()}).subscribe();return()=>{clearInterval(F),M.unsubscribe()}},[r==null?void 0:r.id]);const T=async()=>{var F,M;try{if(C(""),!navigator.onLine)throw new Error("No internet connection. Please check your network.");const V=new Date(Date.now()-24*60*60*1e3).toISOString(),{data:W,error:q}=await oe.from("streams").select(`
          *,
          scholar:profiles!scholar_id(full_name, role, certificate_verified)
        `).eq("is_active",!0).gte("started_at",V).order("started_at",{ascending:!1});if(q)throw console.error("Streams error:",q),(F=q.message)!=null&&F.includes("Failed to fetch")||(M=q.message)!=null&&M.includes("NetworkError")?new Error("Cannot connect to server. Please check your internet connection and try again."):new Error("Unable to load streams. Please check your internet connection.");if(console.log(`Found ${(W==null?void 0:W.length)||0} active streams`),!W||W.length===0){c([]),E(!1);return}const te=W.map(Ae=>Ae.id);let re=null,de=null;if(r!=null&&r.id&&te.length>0)try{const{data:Ae}=await oe.from("stream_reactions").select("stream_id, reaction_type").eq("user_id",r.id).in("stream_id",te);re=Ae;const{data:ne}=await oe.from("stream_access").select("stream_id, payment_status").eq("user_id",r.id).in("stream_id",te).eq("payment_status","success");de=ne}catch(Ae){console.warn("Optional data fetch failed:",Ae)}const ce=W.map(Ae=>{var ne;return{...Ae,user_reaction:((ne=re==null?void 0:re.find(ue=>ue.stream_id===Ae.id))==null?void 0:ne.reaction_type)||null,has_access:Ae.is_free||(de==null?void 0:de.some(ue=>ue.stream_id===Ae.id))||!1}});c(ce),console.log("Active streams loaded:",ce.map(Ae=>({id:Ae.id,title:Ae.title,is_active:Ae.is_active}))),E(!1),N()}catch(V){console.error("Error fetching streams:",V),C(V.message||"Failed to load streams. Please try again."),c([]),E(!1)}},N=async()=>{try{const F=new Date(Date.now()-864e5).toISOString(),{data:M,error:V}=await oe.from("streams").select(`
          *,
          scholar:profiles!scholar_id(full_name, role)
        `).eq("is_active",!1).not("ended_at","is",null).gte("ended_at",F).order("ended_at",{ascending:!1}).limit(5);if(V){console.error("Error fetching ended streams:",V);return}console.log(`Found ${(M==null?void 0:M.length)||0} ended streams`),u(M||[])}catch(F){console.error("Error fetching ended streams:",F)}},B=(F,M)=>{if(!M)return"Unknown duration";const V=new Date(F),q=new Date(M).getTime()-V.getTime(),te=Math.floor(q/6e4),re=Math.floor(te/60),de=te%60;return re>0?`${re}h ${de}m`:`${de}m`},k=async(F,M)=>{try{const V=a.find(W=>W.id===F);(V==null?void 0:V.user_reaction)===M?await oe.from("stream_reactions").delete().eq("stream_id",F).eq("user_id",(r==null?void 0:r.id)||""):await oe.from("stream_reactions").upsert({stream_id:F,user_id:(r==null?void 0:r.id)||"",reaction_type:M},{onConflict:"stream_id,user_id"}),await T()}catch(V){console.error("Error updating reaction:",V)}},Q=async F=>{try{if(console.log("Attempting to join stream:",F),console.log("Channel name:",F.channel),!F.channel){console.error(" Stream has no channel!",F),alert("Unable to join stream - invalid channel information. Please try again.");return}if(!F.is_free&&!F.has_access){s(`/stream/${F.id}/payment`);return}const{data:M}=await oe.from("stream_restrictions").select("*").eq("stream_id",F.id).eq("user_id",(r==null?void 0:r.id)||"").single();if(M&&M.restriction_type==="ban"){alert("You have been banned from this stream.");return}console.log(" Navigating to:",`/watch-stream/${F.channel}`),s(`/watch-stream/${F.channel}`)}catch(M){console.error("Error joining stream:",M)}},K=async F=>{const M=prompt("Please describe the reason for reporting this stream:");if(M)try{await oe.from("reports").insert({reporter_id:r==null?void 0:r.id,reported_stream_id:F,report_type:"inappropriate_content",description:M}),alert("Stream reported. Our team will review it shortly.")}catch(V){console.error("Error reporting stream:",V),alert("Failed to report stream. Please try again.")}},Y=async F=>{if(confirm("Are you sure you want to block this scholar? You will not see their streams anymore."))try{await oe.from("blocked_users").insert({blocker_id:r==null?void 0:r.id,blocked_id:F,reason:"Blocked from stream discovery"}),alert("Scholar blocked successfully."),await T()}catch(V){console.error("Error blocking scholar:",V),alert("Failed to block scholar. Please try again.")}};return m?p.jsx(qe,{className:"w-full max-w-4xl mx-auto",children:p.jsx($e,{className:"p-6",children:p.jsx("p",{children:"Loading active streams..."})})}):w?p.jsx(yr,{title:"Live Streams",children:p.jsx(qe,{className:"w-full max-w-4xl mx-auto",children:p.jsx($e,{className:"p-6",children:p.jsx("p",{className:"text-red-500",children:w})})})}):p.jsx(yr,{title:"Live Streams",children:p.jsxs("div",{className:"space-y-6",children:[a.length>0?p.jsxs("div",{children:[p.jsx("h2",{className:"text-xl font-bold mb-4",children:"Live Now"}),p.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:a.map(F=>p.jsxs(qe,{className:"hover:shadow-lg transition-shadow",children:[p.jsx(Pt,{children:p.jsx("div",{className:"flex items-start justify-between",children:p.jsxs("div",{className:"flex-1",children:[p.jsx(Vt,{className:"text-lg",children:F.title}),p.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["by ",F.scholar.full_name]}),p.jsxs("span",{className:"inline-block px-2 py-1 text-xs bg-red-100 text-red-600 rounded-full mt-2",children:[p.jsx(bl,{className:"inline w-3 h-3 mr-1"}),"LIVE"]})]})})}),p.jsx($e,{children:p.jsxs("div",{className:"space-y-3",children:[p.jsx("div",{className:"flex items-center justify-between text-sm",children:p.jsxs("div",{className:"flex items-center gap-3",children:[p.jsxs("span",{className:"flex items-center gap-1",children:[p.jsx(yi,{className:"w-4 h-4"}),F.viewer_count]}),p.jsxs("button",{onClick:()=>k(F.id,"like"),className:`flex items-center gap-1 ${F.user_reaction==="like"?"text-blue-600":"text-gray-600"} hover:text-blue-600`,children:[p.jsx(jx,{className:"w-4 h-4"}),F.likes_count]}),p.jsxs("button",{onClick:()=>k(F.id,"dislike"),className:`flex items-center gap-1 ${F.user_reaction==="dislike"?"text-red-600":"text-gray-600"} hover:text-red-600`,children:[p.jsx(b_,{className:"w-4 h-4"}),F.dislikes_count]})]})}),!F.is_free&&p.jsxs("div",{className:"flex items-center gap-1 text-sm font-semibold text-green-600",children:[p.jsx(Lc,{className:"w-4 h-4"}),"$",F.price.toFixed(2),F.has_access&&p.jsx("span",{className:"ml-2 text-xs text-gray-500",children:"(Already paid)"})]}),F.is_free&&p.jsx("div",{className:"text-sm font-semibold text-green-600",children:"FREE"}),p.jsxs("div",{className:"text-xs text-gray-500",children:["Started ",new Date(F.started_at).toLocaleTimeString()]})]})}),p.jsxs(S_,{className:"flex flex-col gap-2",children:[p.jsx(Re,{onClick:()=>Q(F),className:"w-full",variant:(!F.is_free&&!F.has_access,"default"),children:!F.is_free&&!F.has_access?`Pay & Join ($${F.price})`:"Join Stream"}),p.jsxs("div",{className:"flex gap-2 w-full",children:[p.jsxs(Re,{onClick:()=>K(F.id),variant:"outline",size:"sm",className:"flex-1",children:[p.jsx(Of,{className:"w-4 h-4 mr-1"}),"Report"]}),p.jsxs(Re,{onClick:()=>Y(F.scholar_id),variant:"outline",size:"sm",className:"flex-1",children:[p.jsx(EEe,{className:"w-4 h-4 mr-1"}),"Block"]})]})]})]},F.id))})]}):p.jsx(qe,{className:"w-full",children:p.jsx($e,{className:"p-6",children:p.jsx("p",{className:"text-gray-500 text-center",children:"No active streams at the moment. Check back later!"})})}),A.length>0&&p.jsxs("div",{children:[p.jsx("h2",{className:"text-xl font-bold mb-4 text-gray-600",children:"Recently Ended"}),p.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:A.map(F=>p.jsxs(qe,{className:"opacity-75",children:[p.jsx(Pt,{children:p.jsx("div",{className:"flex items-start justify-between",children:p.jsxs("div",{className:"flex-1",children:[p.jsx(Vt,{className:"text-lg text-gray-700",children:F.title}),p.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["by ",F.scholar.full_name]}),p.jsx("span",{className:"inline-block px-2 py-1 text-xs bg-gray-200 text-gray-600 rounded-full mt-2",children:"ENDED"})]})})}),p.jsx($e,{children:p.jsxs("div",{className:"space-y-2",children:[p.jsxs("div",{className:"text-sm text-gray-600",children:[p.jsx("strong",{children:"Duration:"})," ",B(F.started_at,F.ended_at)]}),p.jsxs("div",{className:"text-sm text-gray-600",children:[p.jsx("strong",{children:"Peak viewers:"})," ",F.viewer_count]}),p.jsxs("div",{className:"flex items-center gap-3 text-sm text-gray-600",children:[p.jsxs("span",{className:"flex items-center gap-1",children:[p.jsx(jx,{className:"w-4 h-4"}),F.likes_count]}),p.jsxs("span",{className:"flex items-center gap-1",children:[p.jsx(b_,{className:"w-4 h-4"}),F.dislikes_count]})]}),p.jsxs("div",{className:"text-xs text-gray-500",children:["Ended ",new Date(F.ended_at||"").toLocaleString()]})]})})]},F.id))})]})]})})},Jwe=()=>{const{profile:r}=gr(),s=ss(),[a,c]=z.useState(""),[A,u]=z.useState(!1),[m,E]=z.useState(""),[w,C]=z.useState(""),[T,N]=z.useState(!1),[B,k]=z.useState(0),[Q,K]=z.useState(30),[Y,F]=z.useState(0),[M,V]=z.useState(0),[W,q]=z.useState(!1),[te,re]=z.useState(""),[de,ce]=z.useState(""),[Ae,ne]=z.useState(""),[ue,ye]=z.useState(""),[De,Xe]=z.useState([]),[we,Se]=z.useState(!1),[Qe,Ye]=z.useState({phone_verified:!1,email_verified:!1,face_verified:!1,certificate_verified:!1,smileid_verified:!1});z.useEffect(()=>{r&&(c(r.phone_number||""),C(r.avatar_url||r.profile_picture_url||""),k(r.consultation_fee||0),K(r.consultation_duration||30),F(r.livestream_fee||0),V(r.live_consultation_fee||0),q(r.is_online||!1),re(r.bank_account_number||""),ce(r.bank_code||""),ne(r.bank_name||""),ye(r.bank_account_name||""),Ye({phone_verified:r.phone_verified||!1,email_verified:r.email_verified||!1,face_verified:r.face_verified||!1,certificate_verified:r.certificate_verified||!1,smileid_verified:r.smileid_verified||!1})),It()},[r]);const It=async()=>{try{const Qt=await(await fetch("https://api.paystack.co/bank?currency=NGN")).json();if(Qt.status&&Qt.data){const wr=Qt.data.reduce((Oe,Et)=>(Oe.find(mt=>mt.code===Et.code)||Oe.push({name:Et.name,code:Et.code}),Oe),[]);Xe(wr)}}catch(Ze){console.error("Error fetching banks:",Ze)}},Fe=async(Ze,Qt)=>{if(!(Ze.length!==10||!Qt)){Se(!0),E("");try{const Oe=await(await fetch(`https://api.paystack.co/bank/resolve?account_number=${Ze}&bank_code=${Qt}`,{headers:{Authorization:"Bearer undefined"}})).json();Oe.status&&Oe.data?(ye(Oe.data.account_name),E(` Account verified: ${Oe.data.account_name}`)):(E("Could not verify account. Please check account number and bank."),ye(""))}catch(wr){console.error("Error verifying account:",wr),E("Error verifying account. Please try again.")}finally{Se(!1)}}},Ge=async()=>{if(!a.trim()){E("Please enter a phone number");return}u(!0),E("");try{const{error:Ze}=await oe.from("profiles").update({phone_number:a}).eq("id",(r==null?void 0:r.id)||"");if(Ze)throw Ze;E("Phone number updated successfully!")}catch(Ze){E(`Error: ${Ze.message}`)}finally{u(!1)}},dt=async Ze=>{var wr;const Qt=(wr=Ze.target.files)==null?void 0:wr[0];if(!(!Qt||!(r!=null&&r.id))){if(Qt.size>5*1024*1024){E("Error: Image must be less than 5MB");return}if(!Qt.type.startsWith("image/")){E("Error: Please upload an image file");return}N(!0),E("");try{const Oe=Qt.name.split(".").pop(),Et=`${r.id}.${Oe}`,mt=`${r.id}/${Et}`;if(w){const Fn=w.split("/avatars/").pop();Fn&&await oe.storage.from("avatars").remove([Fn])}const{error:ut}=await oe.storage.from("avatars").upload(mt,Qt,{cacheControl:"3600",upsert:!0});if(ut)throw ut;const{data:{publicUrl:Ot}}=oe.storage.from("avatars").getPublicUrl(mt),{error:pn}=await oe.from("profiles").update({avatar_url:Ot,profile_picture_url:Ot}).eq("id",r.id);if(pn)throw pn;C(Ot),E(" Profile picture updated successfully!")}catch(Oe){console.error("Error uploading avatar:",Oe),E(`Error: ${Oe.message}`)}finally{N(!1)}}},Nt=async()=>{u(!0),E("");try{const{error:Ze}=await oe.from("profiles").update({consultation_fee:B,consultation_duration:Q,livestream_fee:Y,live_consultation_fee:M}).eq("id",(r==null?void 0:r.id)||"");if(Ze)throw Ze;E("Pricing and duration updated successfully!")}catch(Ze){E(`Error: ${Ze.message}`)}finally{u(!1)}},hn=async()=>{u(!0),E("");try{const Ze=!W,{error:Qt}=await oe.from("profiles").update({is_online:Ze}).eq("id",(r==null?void 0:r.id)||"");if(Qt)throw Qt;q(Ze),E(`Availability set to ${Ze?"Online":"Offline"}`)}catch(Ze){E(`Error: ${Ze.message}`)}finally{u(!1)}},rr=async()=>{if(!te||!de||!Ae||!ue){E("Please fill in all bank account fields");return}if(te.length!==10){E("Account number must be exactly 10 digits");return}u(!0),E("");try{console.log("Saving bank account:",{bank_account_number:te.trim(),bank_code:de.trim(),bank_name:Ae.trim(),bank_account_name:ue.trim()});const{error:Ze}=await oe.from("profiles").update({bank_account_number:te.trim(),bank_code:de.trim(),bank_name:Ae.trim(),bank_account_name:ue.trim()}).eq("id",(r==null?void 0:r.id)||"");if(Ze)throw console.error(" Bank account save error:",Ze),Ze;console.log(" Bank account saved successfully"),E(" Bank account details saved successfully!")}catch(Ze){E(`Error: ${Ze.message}`)}finally{u(!1)}},He=async()=>{if(!a.trim()){E("Please save a phone number first");return}u(!0),E("");try{const{error:Ze}=await oe.from("verification_data").insert({user_id:r==null?void 0:r.id,verification_type:"phone",verification_provider:"manual",status:"pending",data:{phone_number:a}});if(Ze)throw Ze;E("Phone verification initiated. Check your SMS for verification code.")}catch(Ze){E(`Error: ${Ze.message}`)}finally{u(!1)}},Pe=async()=>{u(!0),E("");try{const{error:Ze}=await oe.auth.resend({type:"signup",email:(r==null?void 0:r.email)||""});if(Ze)throw Ze;E("Verification email sent! Please check your inbox.")}catch(Ze){E(`Error: ${Ze.message}`)}finally{u(!1)}},yt=async()=>{u(!0),E("");try{alert(`SMILE ID Verification:

1. You will be redirected to Smile Identity
2. Provide your phone number
3. Provide your email
4. Take a selfie for face verification
5. Upload your certificates (Ijazah, etc.)

This process typically takes 1-2 business days for review.`);const{error:Ze}=await oe.from("verification_data").insert({user_id:r==null?void 0:r.id,verification_type:"smileid",verification_provider:"smile_identity",status:"pending",data:{phone:a,email:r==null?void 0:r.email,initiated_at:new Date().toISOString()}});if(Ze)throw Ze;E("SMILE ID verification initiated. You will be notified once approved.")}catch(Ze){E(`Error: ${Ze.message}`)}finally{u(!1)}},st=async Ze=>{var wr;const Qt=(wr=Ze.target.files)==null?void 0:wr[0];if(Qt){u(!0),E("");try{const Oe=Qt.name.split(".").pop(),Et=`${r==null?void 0:r.id}_certificate_${Date.now()}.${Oe}`,{error:mt}=await oe.storage.from("certificates").upload(Et,Qt);if(mt)throw mt;const{error:ut}=await oe.from("verification_data").insert({user_id:r==null?void 0:r.id,verification_type:"certificate",verification_provider:"manual",status:"pending",data:{file_name:Et,file_size:Qt.size,file_type:Qt.type}});if(ut)throw ut;E("Certificate uploaded successfully! Awaiting admin review.")}catch(Oe){E(`Error: ${Oe.message}`)}finally{u(!1)}}},qr=(r==null?void 0:r.role)==="scholar"||(r==null?void 0:r.role)==="imam";return p.jsxs("div",{className:"w-full max-w-4xl mx-auto p-4 space-y-6",children:[p.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[p.jsx(Re,{variant:"outline",size:"icon",onClick:()=>s(-1),className:"rounded-full",children:p.jsx(Qu,{className:"h-5 w-5"})}),p.jsx("h1",{className:"text-3xl font-bold",children:"Profile Settings"})]}),p.jsxs(qe,{children:[p.jsx(Pt,{children:p.jsx(Vt,{children:"Basic Information"})}),p.jsxs($e,{className:"space-y-4",children:[p.jsxs("div",{className:"flex flex-col items-center space-y-4 pb-4 border-b",children:[p.jsxs("div",{className:"relative",children:[p.jsx("div",{className:"w-24 h-24 rounded-full overflow-hidden bg-gray-200 flex items-center justify-center",children:w?p.jsx("img",{src:w,alt:"Profile",className:"w-full h-full object-cover"}):p.jsx(tO,{className:"w-8 h-8 text-gray-400"})}),p.jsxs("label",{className:"absolute bottom-0 right-0 bg-emerald-600 text-white p-2 rounded-full cursor-pointer hover:bg-emerald-700 shadow-lg",children:[p.jsx(tO,{className:"w-4 h-4"}),p.jsx("input",{type:"file",accept:"image/*",onChange:dt,className:"hidden",disabled:T})]})]}),p.jsxs("div",{className:"text-center",children:[p.jsx("p",{className:"text-sm font-medium",children:r==null?void 0:r.full_name}),p.jsx("p",{className:"text-xs text-gray-500",children:T?"Uploading...":"Click camera icon to upload photo"})]})]}),p.jsxs("div",{children:[p.jsx("label",{className:"block text-sm font-medium mb-2",children:"Full Name"}),p.jsx(er,{value:(r==null?void 0:r.full_name)||"",disabled:!0})]}),p.jsxs("div",{children:[p.jsx("label",{className:"block text-sm font-medium mb-2",children:"Email"}),p.jsx(er,{value:(r==null?void 0:r.email)||"",disabled:!0})]}),p.jsxs("div",{children:[p.jsx("label",{className:"block text-sm font-medium mb-2",children:"Role"}),p.jsx(er,{value:(r==null?void 0:r.role)||"",disabled:!0})]}),p.jsxs("div",{children:[p.jsx("label",{className:"block text-sm font-medium mb-2",children:"Phone Number"}),p.jsxs("div",{className:"flex flex-wrap gap-2",children:[p.jsx(er,{type:"tel",value:a,onChange:Ze=>c(Ze.target.value),placeholder:"+1234567890",className:"flex-1 min-w-[200px]"}),p.jsx(Re,{onClick:Ge,disabled:A,className:"min-w-[80px]",children:"Save"})]})]}),m&&p.jsx("div",{className:`p-3 rounded ${m.includes("Error")?"bg-red-100 text-red-700":"bg-green-100 text-green-700"}`,children:m})]})]}),!qr&&p.jsxs(qe,{children:[p.jsx(Pt,{children:p.jsx(Vt,{children:"Verification Status (Members)"})}),p.jsxs($e,{className:"space-y-4",children:[p.jsxs("div",{className:"flex items-center justify-between p-4 border rounded",children:[p.jsxs("div",{className:"flex items-center gap-3",children:[p.jsx(mf,{className:"w-5 h-5"}),p.jsxs("div",{children:[p.jsx("p",{className:"font-medium",children:"Phone Verification"}),p.jsx("p",{className:"text-sm text-gray-600",children:"Verify your phone number via SMS"})]})]}),p.jsxs("div",{className:"flex items-center gap-2",children:[Qe.phone_verified?p.jsx(Ks,{className:"w-5 h-5 text-green-600"}):p.jsx(hl,{className:"w-5 h-5 text-gray-400"}),p.jsx(Re,{onClick:He,disabled:A||Qe.phone_verified,size:"sm",children:Qe.phone_verified?"Verified":"Verify"})]})]}),p.jsxs("div",{className:"flex items-center justify-between p-4 border rounded",children:[p.jsxs("div",{className:"flex items-center gap-3",children:[p.jsx(uG,{className:"w-5 h-5"}),p.jsxs("div",{children:[p.jsx("p",{className:"font-medium",children:"Email Verification"}),p.jsx("p",{className:"text-sm text-gray-600",children:"Verify your email address"})]})]}),p.jsxs("div",{className:"flex items-center gap-2",children:[Qe.email_verified?p.jsx(Ks,{className:"w-5 h-5 text-green-600"}):p.jsx(hl,{className:"w-5 h-5 text-gray-400"}),p.jsx(Re,{onClick:Pe,disabled:A||Qe.email_verified,size:"sm",children:Qe.email_verified?"Verified":"Verify"})]})]})]})]}),qr&&p.jsxs(qe,{children:[p.jsxs(Pt,{children:[p.jsx(Vt,{children:"SMILE ID Verification (Scholars & Imams)"}),p.jsx("p",{className:"text-sm text-gray-600 mt-2",children:"Complete all verification steps to become a verified scholar/imam on the platform"})]}),p.jsxs($e,{className:"space-y-4",children:[p.jsx("div",{className:"p-4 bg-blue-50 border border-blue-200 rounded",children:p.jsxs("div",{className:"flex items-center gap-3",children:[p.jsx(pG,{className:"w-6 h-6 text-blue-600"}),p.jsxs("div",{children:[p.jsx("p",{className:"font-semibold",children:"SMILE ID Verification Status"}),p.jsx("p",{className:"text-sm text-gray-700",children:Qe.smileid_verified?" Fully Verified":"Verification Required"})]})]})}),p.jsxs("div",{className:"flex items-center justify-between p-4 border rounded",children:[p.jsxs("div",{className:"flex items-center gap-3",children:[p.jsx(mf,{className:"w-5 h-5"}),p.jsxs("div",{children:[p.jsx("p",{className:"font-medium",children:"Phone Verification"}),p.jsx("p",{className:"text-sm text-gray-600",children:"Verify phone via SMILE ID"})]})]}),Qe.phone_verified?p.jsx(Ks,{className:"w-5 h-5 text-green-600"}):p.jsx(hl,{className:"w-5 h-5 text-gray-400"})]}),p.jsxs("div",{className:"flex items-center justify-between p-4 border rounded",children:[p.jsxs("div",{className:"flex items-center gap-3",children:[p.jsx(uG,{className:"w-5 h-5"}),p.jsxs("div",{children:[p.jsx("p",{className:"font-medium",children:"Email Verification"}),p.jsx("p",{className:"text-sm text-gray-600",children:"Verify email via SMILE ID"})]})]}),Qe.email_verified?p.jsx(Ks,{className:"w-5 h-5 text-green-600"}):p.jsx(hl,{className:"w-5 h-5 text-gray-400"})]}),p.jsxs("div",{className:"flex items-center justify-between p-4 border rounded",children:[p.jsxs("div",{className:"flex items-center gap-3",children:[p.jsx(tO,{className:"w-5 h-5"}),p.jsxs("div",{children:[p.jsx("p",{className:"font-medium",children:"Face Verification"}),p.jsx("p",{className:"text-sm text-gray-600",children:"Biometric face scan via SMILE ID"})]})]}),Qe.face_verified?p.jsx(Ks,{className:"w-5 h-5 text-green-600"}):p.jsx(hl,{className:"w-5 h-5 text-gray-400"})]}),p.jsxs("div",{className:"flex items-center justify-between p-4 border rounded",children:[p.jsxs("div",{className:"flex items-center gap-3",children:[p.jsx(tve,{className:"w-5 h-5"}),p.jsxs("div",{children:[p.jsx("p",{className:"font-medium",children:"Certificate Verification"}),p.jsx("p",{className:"text-sm text-gray-600",children:"Upload Ijazah or credentials"})]})]}),p.jsxs("div",{className:"flex items-center gap-2",children:[Qe.certificate_verified?p.jsx(Ks,{className:"w-5 h-5 text-green-600"}):p.jsx(hl,{className:"w-5 h-5 text-gray-400"}),p.jsxs("label",{className:"cursor-pointer",children:[p.jsx("input",{type:"file",accept:".pdf,.jpg,.jpeg,.png",onChange:st,className:"hidden",disabled:A}),p.jsx("span",{children:p.jsx(Re,{size:"sm",disabled:A,type:"button",children:"Upload"})})]})]})]}),p.jsx("div",{className:"pt-4",children:p.jsx(Re,{onClick:yt,disabled:A||Qe.smileid_verified,className:"w-full",size:"lg",children:Qe.smileid_verified?" SMILE ID Verified":"Start SMILE ID Verification"})}),m&&p.jsx("div",{className:`p-3 rounded ${m.includes("Error")?"bg-red-100 text-red-700":"bg-green-100 text-green-700"}`,children:m})]})]}),qr&&p.jsxs(qe,{children:[p.jsx(Pt,{children:p.jsx(Vt,{children:"Service Pricing & Availability"})}),p.jsxs($e,{className:"space-y-4",children:[p.jsx("div",{className:"p-4 bg-gray-50 border border-gray-200 rounded-lg",children:p.jsxs("div",{className:"flex items-center justify-between",children:[p.jsxs("div",{children:[p.jsx("h4",{className:"font-medium",children:"Availability Status"}),p.jsx("p",{className:"text-sm text-gray-600 mt-1",children:W?"You are currently available for consultations":"You are currently offline"})]}),p.jsx(Re,{onClick:hn,disabled:A,variant:W?"default":"outline",className:W?"bg-green-600 hover:bg-green-700":"",children:W?"Online":"Offline"})]})}),p.jsx("div",{className:"border-t pt-4",children:p.jsx("h4",{className:"font-medium mb-4",children:"Set Your Fees"})}),p.jsxs("div",{children:[p.jsx("label",{className:"block text-sm font-medium mb-2",children:"Consultation Fee ()"}),p.jsx(er,{type:"number",min:"0",value:B,onChange:Ze=>k(Number(Ze.target.value)),placeholder:"e.g., 5000"}),p.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Fee for private 1-on-1 consultation sessions"})]}),p.jsxs("div",{children:[p.jsx("label",{className:"block text-sm font-medium mb-2",children:"Consultation Duration (minutes)"}),p.jsx(er,{type:"number",min:"5",step:"5",value:Q,onChange:Ze=>K(Number(Ze.target.value)),placeholder:"e.g., 30"}),p.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Default duration for consultation sessions (e.g., 15min/1000, 30min/2000)"})]}),p.jsxs("div",{children:[p.jsx("label",{className:"block text-sm font-medium mb-2",children:"Livestream Access Fee ()"}),p.jsx(er,{type:"number",min:"0",value:Y,onChange:Ze=>F(Number(Ze.target.value)),placeholder:"e.g., 1000"}),p.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Fee for viewers to access your paid livestreams (0 for free)"})]}),p.jsxs("div",{children:[p.jsx("label",{className:"block text-sm font-medium mb-2",children:"Live Consultation Fee ()"}),p.jsx(er,{type:"number",min:"0",value:M,onChange:Ze=>V(Number(Ze.target.value)),placeholder:"e.g., 2000"}),p.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Fee for live consultation requests during streams"})]}),p.jsx(Re,{onClick:Nt,disabled:A,className:"w-full",children:"Save Pricing"}),m&&p.jsx("div",{className:`p-3 rounded ${m.includes("Error")?"bg-red-100 text-red-700":"bg-green-100 text-green-700"}`,children:m})]})]}),qr&&p.jsxs(qe,{children:[p.jsxs(Pt,{children:[p.jsx(Vt,{children:"Bank Account for Withdrawals"}),p.jsx("p",{className:"text-sm text-gray-600 mt-2",children:"Add your bank account details to receive withdrawal payments via Paystack"})]}),p.jsxs($e,{className:"space-y-4",children:[p.jsxs("div",{children:[p.jsx("label",{className:"block text-sm font-medium mb-2",children:"Select Bank"}),p.jsxs("select",{value:de,onChange:Ze=>{const Qt=De.find(wr=>wr.code===Ze.target.value);ce(Ze.target.value),ne((Qt==null?void 0:Qt.name)||""),te.length===10&&Ze.target.value&&Fe(te,Ze.target.value)},className:"w-full p-2 border border-gray-300 rounded-md",children:[p.jsx("option",{value:"",children:"-- Select your bank --"}),De.map(Ze=>p.jsx("option",{value:Ze.code,children:Ze.name},Ze.code))]})]}),p.jsxs("div",{children:[p.jsx("label",{className:"block text-sm font-medium mb-2",children:"Account Number"}),p.jsx(er,{type:"text",maxLength:10,value:te,onChange:Ze=>{re(Ze.target.value),Ze.target.value.length===10&&de&&Fe(Ze.target.value,de)},placeholder:"Enter 10-digit account number"}),p.jsx("p",{className:"text-xs text-gray-500 mt-1",children:we&&"Verifying account..."})]}),p.jsxs("div",{children:[p.jsx("label",{className:"block text-sm font-medium mb-2",children:"Account Name"}),p.jsx(er,{type:"text",value:ue,disabled:!0,placeholder:"Will be auto-filled after verification",className:"bg-gray-50"}),p.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Automatically verified from your bank"})]}),p.jsx(Re,{onClick:rr,disabled:A||!ue,className:"w-full",children:"Save Bank Account"}),m&&p.jsx("div",{className:`p-3 rounded ${m.includes("Error")||m.includes("Could not")?"bg-red-100 text-red-700":"bg-green-100 text-green-700"}`,children:m})]})]}),(r==null?void 0:r.role)==="scholar"&&p.jsxs(qe,{children:[p.jsx(Pt,{children:p.jsx(Vt,{children:"Subscription Status"})}),p.jsx($e,{children:p.jsxs("div",{className:"space-y-3",children:[p.jsxs("div",{className:"flex justify-between",children:[p.jsx("span",{children:"Completed Consultations:"}),p.jsx("span",{className:"font-semibold",children:r.completed_consultations_count||0})]}),(r.completed_consultations_count||0)>=2&&!r.is_subscribed&&p.jsxs("div",{className:"p-4 bg-yellow-50 border border-yellow-200 rounded",children:[p.jsx("p",{className:"text-sm font-medium text-yellow-800",children:" Subscription Required"}),p.jsx("p",{className:"text-sm text-yellow-700 mt-1",children:"You have completed 2+ consultations. Please subscribe to continue offering services."}),p.jsx(Re,{className:"mt-3",size:"sm",children:"Subscribe Now"})]}),r.is_subscribed&&p.jsxs("div",{className:"p-4 bg-green-50 border border-green-200 rounded",children:[p.jsx("p",{className:"text-sm font-medium text-green-800",children:" Active Subscription"}),p.jsxs("p",{className:"text-sm text-green-700 mt-1",children:["Expires: ",r.subscription_expires_at?new Date(r.subscription_expires_at).toLocaleDateString():"N/A"]})]})]})})]}),p.jsxs(qe,{className:"border-red-200",children:[p.jsx(Pt,{className:"bg-red-50",children:p.jsxs(Vt,{className:"text-red-900 flex items-center gap-2",children:[p.jsx(pG,{className:"w-5 h-5"}),"Danger Zone"]})}),p.jsx($e,{className:"p-6",children:p.jsxs("div",{className:"space-y-4",children:[p.jsxs("div",{children:[p.jsx("h3",{className:"font-semibold text-gray-900 mb-1",children:"Delete Account"}),p.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Permanently delete your account and all associated data. This action cannot be undone."})]}),p.jsx(Re,{variant:"destructive",onClick:()=>s("/delete-account"),className:"w-full sm:w-auto",children:"Delete My Account"})]})})]})]})},$we=()=>{const{scholarId:r}=bb(),{profile:s}=gr(),a=ss(),[c,A]=z.useState(null),[u,m]=z.useState([]),[E,w]=z.useState(!0),[C,T]=z.useState(""),[N,B]=z.useState("all");z.useEffect(()=>{r&&(k(),Q())},[r]);const k=async()=>{try{const{data:q,error:te}=await oe.from("profiles").select("*").eq("id",r).single();if(te)throw te;A(q),w(!1)}catch(q){console.error("Error fetching scholar profile:",q),T(q.message),w(!1)}},Q=async()=>{try{const q=oe.from("scholar_reviews").select(`
          *,
          reviewer:profiles!reviewer_id(full_name, avatar_url)
        `).eq("scholar_id",r).order("created_at",{ascending:!1});N!=="all"&&q.eq("rating",N);const{data:te,error:re}=await q;if(re)throw re;m(te||[])}catch(q){console.error("Error fetching reviews:",q)}};z.useEffect(()=>{r&&Q()},[N]);const K=()=>{c&&a(`/consultation/${c.id}`)},Y=()=>{a(`/messages/${r}`)},F=q=>p.jsx("div",{className:"flex gap-1",children:[1,2,3,4,5].map(te=>p.jsx(xf,{className:`w-4 h-4 ${te<=q?"fill-yellow-400 text-yellow-400":"text-gray-300"}`},te))}),M=()=>{const q={5:0,4:0,3:0,2:0,1:0};return u.forEach(te=>{q[te.rating]++}),q};if(E)return p.jsx("div",{className:"w-full max-w-4xl mx-auto p-4",children:p.jsx(qe,{children:p.jsx($e,{className:"p-6",children:p.jsx("p",{children:"Loading scholar profile..."})})})});if(C||!c)return p.jsx("div",{className:"w-full max-w-4xl mx-auto p-4",children:p.jsx(qe,{children:p.jsxs($e,{className:"p-6",children:[p.jsx("p",{className:"text-red-500",children:C||"Scholar not found"}),p.jsx(Re,{onClick:()=>a(-1),className:"mt-4",children:"Go Back"})]})})});const V=M(),W=(s==null?void 0:s.id)===r;return p.jsxs(yr,{title:"Scholar Profile",children:[p.jsxs(qe,{children:[p.jsx(Pt,{children:p.jsxs("div",{className:"flex items-start gap-4",children:[p.jsx("div",{className:"flex-shrink-0",children:c.avatar_url?p.jsx("img",{src:c.avatar_url,alt:c.full_name,className:"w-24 h-24 rounded-full object-cover border-4 border-emerald-500 shadow-lg"}):p.jsx("div",{className:"w-24 h-24 rounded-full bg-gradient-to-br from-emerald-500 to-emerald-700 flex items-center justify-center border-4 border-emerald-500 shadow-lg",children:p.jsx("span",{className:"text-white text-3xl font-bold",children:c.full_name.charAt(0).toUpperCase()})})}),p.jsxs("div",{className:"flex-1 min-w-0",children:[p.jsxs(Vt,{className:"text-2xl sm:text-3xl flex items-center gap-2 flex-wrap",children:[c.full_name,c.smileid_verified&&p.jsx("span",{title:"Verified Scholar",children:p.jsx(Ks,{className:"w-5 h-5 sm:w-6 sm:h-6 text-blue-600"})})]}),p.jsx("div",{className:"flex items-center gap-2 mt-2",children:p.jsx("span",{className:"px-3 py-1 bg-purple-100 text-purple-800 rounded-full text-sm font-semibold",children:c.role.charAt(0).toUpperCase()+c.role.slice(1)})})]})]})}),p.jsxs($e,{className:"space-y-6",children:[p.jsxs("div",{className:"flex items-center gap-6 p-4 bg-gray-50 rounded-lg",children:[p.jsxs("div",{className:"text-center",children:[p.jsx("div",{className:"text-4xl font-bold text-yellow-600",children:c.average_rating>0?c.average_rating.toFixed(1):"N/A"}),p.jsx("div",{className:"flex justify-center mt-2",children:F(Math.round(c.average_rating))}),p.jsxs("div",{className:"text-sm text-gray-600 mt-1",children:[c.total_ratings," ",c.total_ratings===1?"review":"reviews"]})]}),p.jsx("div",{className:"flex-1 space-y-2",children:[5,4,3,2,1].map(q=>p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsxs("span",{className:"text-sm w-8",children:[q,""]}),p.jsx("div",{className:"flex-1 bg-gray-200 rounded-full h-2",children:p.jsx("div",{className:"bg-yellow-400 h-2 rounded-full",style:{width:`${c.total_ratings>0?V[q]/c.total_ratings*100:0}%`}})}),p.jsx("span",{className:"text-sm text-gray-600 w-8",children:V[q]})]},q))})]}),p.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[p.jsxs("div",{className:"p-4 border rounded-lg",children:[p.jsxs("div",{className:"flex items-center gap-2 text-gray-600 mb-1",children:[p.jsx(yi,{className:"w-4 h-4"}),p.jsx("span",{className:"text-sm",children:"Completed Consultations"})]}),p.jsx("div",{className:"text-2xl font-bold",children:c.completed_consultations_count})]}),p.jsxs("div",{className:"p-4 border rounded-lg",children:[p.jsxs("div",{className:"flex items-center gap-2 text-gray-600 mb-1",children:[p.jsx(fEe,{className:"w-4 h-4"}),p.jsx("span",{className:"text-sm",children:"Verification Status"})]}),p.jsx("div",{className:"text-sm font-semibold",children:c.smileid_verified?p.jsx("span",{className:"text-green-600",children:" Fully Verified"}):p.jsx("span",{className:"text-gray-500",children:"Pending"})})]}),p.jsxs("div",{className:"p-4 border rounded-lg",children:[p.jsxs("div",{className:"flex items-center gap-2 text-gray-600 mb-1",children:[p.jsx(fr,{className:"w-4 h-4"}),p.jsx("span",{className:"text-sm",children:"Member Since"})]}),p.jsx("div",{className:"text-sm font-semibold",children:new Date(c.created_at).toLocaleDateString("en-US",{year:"numeric",month:"long"})})]}),typeof c.consultation_fee=="number"&&p.jsxs("div",{className:"p-4 border rounded-lg",children:[p.jsxs("div",{className:"flex items-center gap-2 text-gray-600 mb-1",children:[p.jsx(Nl,{className:"w-4 h-4"}),p.jsx("span",{className:"text-sm",children:"Consultation Fee"})]}),p.jsxs("div",{className:"text-2xl font-bold text-emerald-700",children:["",c.consultation_fee,"/session"]})]})]}),c.bio&&p.jsxs("div",{children:[p.jsx("h3",{className:"font-semibold mb-2",children:"About"}),p.jsx("p",{className:"text-gray-700",children:c.bio})]}),c.specializations&&c.specializations.length>0&&p.jsxs("div",{children:[p.jsx("h3",{className:"font-semibold mb-2",children:"Specializations"}),p.jsx("div",{className:"flex flex-wrap gap-2",children:c.specializations.map((q,te)=>p.jsx("span",{className:"px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm",children:q},te))})]}),p.jsxs("div",{children:[p.jsx("h3",{className:"font-semibold mb-2",children:"Verification"}),p.jsxs("div",{className:"flex flex-wrap gap-3",children:[c.phone_verified&&p.jsxs("span",{className:"flex items-center gap-1 text-sm text-green-600",children:[p.jsx(Ks,{className:"w-4 h-4"}),"Phone Verified"]}),c.email_verified&&p.jsxs("span",{className:"flex items-center gap-1 text-sm text-green-600",children:[p.jsx(Ks,{className:"w-4 h-4"}),"Email Verified"]}),c.face_verified&&p.jsxs("span",{className:"flex items-center gap-1 text-sm text-green-600",children:[p.jsx(Ks,{className:"w-4 h-4"}),"Face Verified"]}),c.certificate_verified&&p.jsxs("span",{className:"flex items-center gap-1 text-sm text-green-600",children:[p.jsx(Ks,{className:"w-4 h-4"}),"Credentials Verified"]})]})]})]}),!W&&p.jsxs(S_,{className:"flex flex-col sm:flex-row gap-2 sm:gap-3 p-3",children:[p.jsxs(Re,{onClick:K,className:"w-full sm:flex-1 text-sm",children:[p.jsx(fr,{className:"w-4 h-4 mr-2"}),"Book Consultation"]}),p.jsxs(Re,{onClick:Y,variant:"outline",className:"w-full sm:flex-1 text-sm",children:[p.jsx(Nl,{className:"w-4 h-4 mr-2"}),"Message"]})]})]}),p.jsxs(qe,{children:[p.jsx(Pt,{children:p.jsxs("div",{className:"flex items-center justify-between",children:[p.jsx(Vt,{children:"Reviews & Ratings"}),p.jsxs("select",{value:N,onChange:q=>B(q.target.value==="all"?"all":parseInt(q.target.value)),className:"px-3 py-1 border rounded",children:[p.jsx("option",{value:"all",children:"All Ratings"}),p.jsx("option",{value:"5",children:"5 Stars"}),p.jsx("option",{value:"4",children:"4 Stars"}),p.jsx("option",{value:"3",children:"3 Stars"}),p.jsx("option",{value:"2",children:"2 Stars"}),p.jsx("option",{value:"1",children:"1 Star"})]})]})}),p.jsx($e,{children:u.length===0?p.jsx("p",{className:"text-gray-500 text-center py-8",children:"No reviews yet. Be the first to leave a review after your consultation!"}):p.jsx("div",{className:"space-y-4",children:u.map(q=>p.jsxs("div",{className:"p-4 border rounded-lg",children:[p.jsxs("div",{className:"flex items-start gap-3 mb-2",children:[q.reviewer.avatar_url?p.jsx("img",{src:q.reviewer.avatar_url,alt:q.reviewer.full_name,className:"w-10 h-10 rounded-full object-cover"}):p.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-blue-500 to-blue-700 flex items-center justify-center",children:p.jsx("span",{className:"text-white text-sm font-bold",children:q.reviewer.full_name.charAt(0).toUpperCase()})}),p.jsxs("div",{className:"flex-1",children:[p.jsx("p",{className:"font-semibold",children:q.reviewer.full_name}),p.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[F(q.rating),p.jsx("span",{className:"text-sm text-gray-500",children:new Date(q.created_at).toLocaleDateString()})]})]})]}),q.review_text&&p.jsx("p",{className:"text-gray-700 mt-2",children:q.review_text})]},q.id))})})]})]})},Zwe=()=>{var Qe,Ye,It;const{consultationId:r}=bb(),{profile:s}=gr(),a=ss(),[c,A]=z.useState(null),[u,m]=z.useState([]),[E,w]=z.useState(""),[C,T]=z.useState(!0),[N,B]=z.useState(null),[k,Q]=z.useState(!1),[K,Y]=z.useState(!1),F=z.useRef(null),M=z.useRef(null),V=z.useRef(null),W=z.useRef(null);z.useEffect(()=>(r&&(console.log("Consultation ID:",r),q(),re(),de(),ce()),()=>{console.log("Cleaning up subscriptions"),M.current&&oe.removeChannel(M.current),V.current&&oe.removeChannel(V.current)}),[r]),z.useEffect(()=>{Ae()},[u]),z.useEffect(()=>{if(!c){Q(!1),B(null);return}if(c.status==="completed"){Q(!1),B(null),console.log(" Session completed, timer stopped");return}if(!c.session_started_at||!c.session_ends_at){Q(!1),B(null),console.log(" Session not started yet, no timer");return}Q(!0),console.log(" Timer activated - Session ends at:",c.session_ends_at);const Fe=()=>{const dt=new Date().getTime(),Nt=new Date(c.session_ends_at).getTime(),hn=Math.max(0,Math.floor((Nt-dt)/1e3));B(hn),console.log(` Time remaining: ${Math.floor(hn/60)}:${String(hn%60).padStart(2,"0")}`),hn===0&&c.status!=="completed"&&(console.log(" TIME UP! Triggering session timeout"),Xe())};Fe();const Ge=setInterval(Fe,1e3);return()=>{console.log(" Cleaning up timer"),clearInterval(Ge)}},[c,c==null?void 0:c.status,c==null?void 0:c.session_started_at,c==null?void 0:c.session_ends_at]);const q=async()=>{try{console.log("Fetching consultation:",r);const{data:Fe,error:Ge}=await oe.from("consultation_bookings").select("payment_status, amount_paid").eq("id",r).single();if(Ge)throw console.error("Error fetching booking payment status:",Ge),Ge;if(console.log("Payment status:",Fe.payment_status),Fe.payment_status!=="completed"){console.warn("Payment not completed, blocking access"),T(!1);return}const{data:dt,error:Nt}=await oe.from("consultation_bookings").select(`
          *,
          scholar:profiles!scholar_id(full_name, avatar_url, consultation_duration, is_online),
          user:profiles!user_id(full_name, avatar_url)
        `).eq("id",r).single();if(Nt)throw console.error("Error fetching consultation details:",Nt),Nt;console.log("Consultation data:",{status:dt.status,scholarAccepted:dt.scholar_accepted,sessionStarted:dt.session_started_at,sessionEnds:dt.session_ends_at}),A(dt),dt.scholar_accepted&&!dt.session_started_at&&dt.status==="confirmed"&&(console.log(" Auto-starting consultation session..."),await te(dt)),T(!1)}catch(Fe){console.error("Error fetching consultation:",Fe),T(!1)}},te=async Fe=>{try{const Ge=new Date,dt=Fe.consultation_duration||30,Nt=new Date(Ge.getTime()+dt*60*1e3);console.log(` Auto-starting session: ${dt} minutes, ends at ${Nt.toLocaleTimeString()}`);const{error:hn}=await oe.from("consultation_bookings").update({session_started_at:Ge.toISOString(),session_ends_at:Nt.toISOString()}).eq("id",r);if(hn){console.error(" Error auto-starting session:",hn);return}console.log(" Session auto-started successfully"),q()}catch(Ge){console.error(" Error in autoStartSession:",Ge)}},re=async()=>{try{console.log("Fetching messages for consultation:",r);const{data:Fe,error:Ge}=await oe.from("consultation_messages").select(`
          *,
          sender:profiles!sender_id(full_name, avatar_url)
        `).eq("booking_id",r).order("created_at",{ascending:!0});if(Ge)throw console.error("Error fetching messages:",Ge),Ge;console.log("Fetched messages:",(Fe==null?void 0:Fe.length)||0),m(Fe||[])}catch(Fe){console.error("Error fetching messages:",Fe)}},de=()=>{M.current&&oe.removeChannel(M.current);const Fe=`messages:${r}`;console.log(" Subscribing to messages with channel:",Fe),M.current=oe.channel(Fe,{config:{broadcast:{self:!1},presence:{key:s==null?void 0:s.id}}}).on("broadcast",{event:"typing"},Ge=>{var dt;((dt=Ge.payload)==null?void 0:dt.userId)!==(s==null?void 0:s.id)&&(Y(!0),W.current&&clearTimeout(W.current),W.current=setTimeout(()=>Y(!1),3e3))}).on("broadcast",{event:"typing"},Ge=>{console.log(" Typing indicator received:",Ge),Ge.payload.userId!==(s==null?void 0:s.id)&&(Y(!0),W.current&&clearTimeout(W.current),W.current=setTimeout(()=>{Y(!1)},3e3))}).on("postgres_changes",{event:"INSERT",schema:"public",table:"consultation_messages",filter:`booking_id=eq.${r}`},async Ge=>{if(console.log(" New message received via subscription:",Ge),Ge.new.sender_id===(s==null?void 0:s.id)){console.log(" Skipping own message (already displayed)");return}const{data:dt,error:Nt}=await oe.from("consultation_messages").select(`
              *,
              sender:profiles!sender_id(full_name, avatar_url)
            `).eq("id",Ge.new.id).single();if(Nt){console.error(" Error fetching new message details:",Nt);return}dt&&(console.log(" Adding received message to chat:",dt.message),m(hn=>hn.find(He=>He.id===dt.id)?(console.log(" Message already exists, skipping"),hn):(console.log(" Message added to state"),[...hn,dt])),setTimeout(()=>Ae(),100))}).subscribe(Ge=>{console.log(" Message subscription status:",Ge),Ge==="SUBSCRIBED"?console.log(" Successfully subscribed to messages!"):Ge==="CHANNEL_ERROR"&&(console.error(" Subscription error, retrying in 2s..."),setTimeout(()=>de(),2e3))})},ce=()=>{V.current&&oe.removeChannel(V.current);const Fe=`consultation:${r}`;console.log("Subscribing to consultation updates with channel:",Fe),V.current=oe.channel(Fe,{config:{broadcast:{self:!1}}}).on("postgres_changes",{event:"UPDATE",schema:"public",table:"consultation_bookings",filter:`id=eq.${r}`},Ge=>{console.log(" Consultation booking updated:",Ge),console.log(" Updated fields:",Ge.new),q(),re()}).subscribe(Ge=>{console.log(" Consultation subscription status:",Ge),Ge==="SUBSCRIBED"?console.log(" Successfully subscribed to consultation updates!"):Ge==="CHANNEL_ERROR"&&(console.error(" Consultation subscription error, retrying in 2s..."),setTimeout(()=>ce(),2e3))})};z.useEffect(()=>{if(!r)return;const Fe=setInterval(()=>{re(),q()},3e3);return()=>clearInterval(Fe)},[r]);const Ae=()=>{var Fe;(Fe=F.current)==null||Fe.scrollIntoView({behavior:"smooth"})},ne=async Fe=>{if(Fe.preventDefault(),!!E.trim()){Y(!1);try{console.log("Sending message:",E.trim());const{data:Ge,error:dt}=await oe.from("consultation_messages").insert({booking_id:r,sender_id:s==null?void 0:s.id,message:E.trim()}).select(`
          *,
          sender:profiles!sender_id(full_name, avatar_url)
        `).single();if(dt)throw console.error("Error inserting message:",dt),dt;console.log("Message sent successfully:",Ge),Ge&&(m(Nt=>Nt.find(rr=>rr.id===Ge.id)?Nt:[...Nt,Ge]),Ae()),w("")}catch(Ge){console.error("Error sending message:",Ge),alert("Failed to send message: "+Ge.message)}}},ue=async()=>{try{if(!c)return;console.log("Accepting consultation:",r);const{error:Fe}=await oe.from("consultation_bookings").update({scholar_accepted:!0,scholar_accepted_at:new Date().toISOString(),status:"confirmed"}).eq("id",r);if(Fe)throw console.error("Error updating booking:",Fe),Fe;console.log(" Consultation accepted and confirmed, sending system message");try{await p0e(c.user_id,{title:"Consultation Accepted!",body:`${c.scholar.full_name} has accepted your consultation request`,type:"consultation",data:{consultationId:r,scholarName:c.scholar.full_name}}),console.log(" Push notification sent to user")}catch(Nt){console.error("Failed to send push notification:",Nt)}const{data:Ge,error:dt}=await oe.from("consultation_messages").insert({booking_id:r,sender_id:s==null?void 0:s.id,message:`${c.scholar.full_name} has accepted your consultation request. Waiting to start session...`}).select(`
          *,
          sender:profiles!sender_id(full_name, avatar_url)
        `).single();dt?console.error(" Error sending acceptance message:",dt):Ge&&(console.log(" Acceptance message sent, adding to chat"),m(Nt=>[...Nt,Ge]),setTimeout(()=>Ae(),100)),console.log(" Refreshing consultation data"),q()}catch(Fe){console.error("Error accepting consultation:",Fe),alert("Failed to accept consultation: "+Fe.message)}},ye=async()=>{try{if(!c)return;console.log("Starting session for consultation:",r);const Fe=new Date,Ge=c.consultation_duration||30,dt=new Date(Fe.getTime()+Ge*60*1e3);console.log("Session duration:",Ge,"minutes. End time:",dt);const{error:Nt}=await oe.from("consultation_bookings").update({session_started_at:Fe.toISOString(),session_ends_at:dt.toISOString(),status:"confirmed"}).eq("id",r);if(Nt)throw console.error("Error updating booking:",Nt),Nt;if(console.log("Booking updated with session times"),c.scholar_id){const{error:rr}=await oe.from("profiles").update({is_online:!1}).eq("id",c.scholar_id);rr&&console.error("Error setting scholar offline:",rr)}const{error:hn}=await oe.from("consultation_messages").insert({booking_id:r,sender_id:s==null?void 0:s.id,message:` ${c.scholar.full_name} has started the session. Session duration: ${Ge} minutes.`});hn&&console.error("Error sending session start message:",hn),console.log("Session started successfully, refreshing consultation"),q()}catch(Fe){console.error("Error starting session:",Fe),alert("Failed to start session: "+Fe.message)}},De=Fe=>{w(Fe.target.value),M.current&&Fe.target.value.trim()&&M.current.send({type:"broadcast",event:"typing",payload:{userId:s==null?void 0:s.id}})},Xe=async()=>{if((c==null?void 0:c.status)==="completed"){console.log(" Session already completed, skipping timeout");return}try{console.log(" Session timeout - completing consultation...");const{error:Fe}=await oe.from("consultation_bookings").update({status:"completed"}).eq("id",r).eq("status","confirmed");if(Fe)throw console.error(" Error updating booking status:",Fe),Fe;if(console.log(" Booking status updated to completed"),c!=null&&c.scholar_id){const{error:dt}=await oe.from("profiles").update({is_online:!0}).eq("id",c.scholar_id);dt?console.error(" Error setting scholar online:",dt):console.log(" Scholar set back online")}const{error:Ge}=await oe.from("consultation_messages").insert({booking_id:r,sender_id:s==null?void 0:s.id,message:" Consultation time has expired. Session closed automatically."});Ge&&console.error(" Error sending timeout message:",Ge),console.log(" Session ended successfully"),await q(),alert(" Time is up! The consultation session has ended.")}catch(Fe){console.error(" Error ending session:",Fe),alert("Failed to end session: "+Fe.message)}},we=async()=>{if(confirm("Are you sure you want to end this consultation session?"))try{console.log(" Manually ending session...");const{error:Fe}=await oe.from("consultation_bookings").update({status:"completed"}).eq("id",r);if(Fe)throw console.error(" Error updating booking status:",Fe),Fe;if(console.log(" Booking status updated to completed"),c!=null&&c.scholar_id){const{error:dt}=await oe.from("profiles").update({is_online:!0}).eq("id",c.scholar_id);dt&&console.error(" Error setting scholar online:",dt)}const{error:Ge}=await oe.from("consultation_messages").insert({booking_id:r,sender_id:s==null?void 0:s.id,message:`Session ended by ${s==null?void 0:s.full_name}.`});Ge&&console.error(" Error sending end message:",Ge),console.log(" Session ended successfully"),q()}catch(Fe){console.error(" Error ending session:",Fe),alert("Failed to end session: "+Fe.message)}},Se=(s==null?void 0:s.id)===(c==null?void 0:c.scholar_id);return C?p.jsx("div",{className:"w-full max-w-4xl mx-auto p-4",children:p.jsx(qe,{children:p.jsx($e,{className:"p-6",children:p.jsx("p",{children:"Loading consultation..."})})})}):c?p.jsx("div",{className:"w-full max-w-4xl mx-auto p-4",children:p.jsxs(qe,{className:"h-[calc(100vh-8rem)] flex flex-col",children:[p.jsxs(Pt,{className:"border-b",children:[p.jsxs("div",{className:"flex items-start gap-3",children:[p.jsx(Re,{variant:"ghost",size:"sm",onClick:()=>a(Se?"/manage-consultations":"/my-bookings"),className:"mt-1",children:p.jsx(Qu,{className:"h-4 w-4"})}),!Se&&((Qe=c.scholar)==null?void 0:Qe.avatar_url)&&p.jsxs("div",{className:"relative flex-shrink-0",children:[p.jsx("img",{src:c.scholar.avatar_url,alt:c.scholar.full_name,className:"w-12 h-12 rounded-full object-cover border-2 border-gray-200"}),c.scholar.is_online&&p.jsx("div",{className:"absolute bottom-0 right-0 w-3 h-3 bg-green-500 border-2 border-white rounded-full"})]}),Se&&((Ye=c.user)==null?void 0:Ye.avatar_url)&&p.jsx("div",{className:"flex-shrink-0",children:p.jsx("img",{src:c.user.avatar_url,alt:c.user.full_name,className:"w-12 h-12 rounded-full object-cover border-2 border-gray-200"})}),p.jsx("div",{className:"flex-1",children:p.jsxs("div",{className:"flex items-center justify-between",children:[p.jsxs("div",{children:[p.jsxs(Vt,{className:"text-lg",children:["Consultation: ",c.topic]}),p.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[p.jsxs("p",{className:"text-sm text-gray-600",children:["With ",Se?c.user.full_name:c.scholar.full_name]}),!Se&&((It=c.scholar)==null?void 0:It.is_online)&&p.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800",children:" Online"})]}),p.jsxs("p",{className:"text-xs text-gray-500",children:[new Date(c.booking_date).toLocaleDateString()," at ",c.booking_time,!Se&&c.consultation_duration&&!k&&p.jsxs("span",{className:"ml-2",children:[" ",c.consultation_duration," min session"]})]})]}),p.jsxs("div",{className:"text-right space-y-2",children:[p.jsx("span",{className:`inline-flex items-center px-3 py-1 rounded-full text-sm font-medium ${c.status==="confirmed"?"bg-emerald-100 text-emerald-800":c.status==="pending"?"bg-yellow-100 text-yellow-800":(c.status==="completed","bg-gray-100 text-gray-800")}`,children:c.status==="confirmed"&&k?" Active Session":c.status==="pending"&&!c.scholar_accepted?" Awaiting Scholar":c.status==="pending"&&c.scholar_accepted?" Waiting to Start":c.status==="completed"?" Completed":c.status}),k&&N!==null&&p.jsx("div",{className:`border rounded-md px-2 py-1.5 ${N<=300?"bg-red-50 border-red-300":"bg-blue-50 border-blue-300"}`,children:p.jsxs("div",{className:"flex items-center gap-1.5",children:[p.jsx(Pa,{className:`w-3.5 h-3.5 ${N<=300?"text-red-600":"text-blue-600"}`}),p.jsxs("div",{className:`text-sm font-bold ${N<=300?"text-red-600":"text-blue-600"}`,children:[Math.floor(N/60),":",String(N%60).padStart(2,"0")]}),p.jsx("span",{className:`text-[10px] font-medium ${N<=300?"text-red-600":"text-blue-600"}`,children:N<=300?"":"left"})]})})]})]})})]}),Se&&c.status==="pending"&&p.jsx("div",{className:"mt-4 space-y-2",children:c.scholar_accepted?p.jsx(Re,{onClick:ye,className:"w-full bg-blue-600 hover:bg-blue-700",children:" Start Session"}):p.jsx(Re,{onClick:ue,className:"w-full bg-green-600 hover:bg-green-700",children:" Accept Consultation Request"})}),Se&&c.status==="confirmed"&&k&&p.jsx("div",{className:"mt-4",children:p.jsx(Re,{onClick:we,className:"w-full bg-red-600 hover:bg-red-700",children:" End Session"})}),!Se&&c.status==="pending"&&p.jsx("div",{className:"mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:p.jsx("p",{className:"text-sm text-blue-900",children:c.scholar_accepted?p.jsxs(p.Fragment,{children:[" ",c.scholar.full_name," has accepted. Waiting for them to start the session..."]}):p.jsxs(p.Fragment,{children:[" Waiting for ",c.scholar.full_name," to accept your consultation request..."]})})})]}),p.jsxs($e,{className:"flex-1 overflow-y-auto p-4 space-y-3",children:[u.map(Fe=>{var Nt,hn,rr,He,Pe;const Ge=Fe.sender_id===(s==null?void 0:s.id),dt=(Nt=Fe.sender)==null?void 0:Nt.avatar_url;return p.jsxs("div",{className:`flex gap-2 ${Ge?"justify-end":"justify-start"}`,children:[!Ge&&p.jsx("div",{className:"flex-shrink-0",children:dt?p.jsx("img",{src:dt,alt:((hn=Fe.sender)==null?void 0:hn.full_name)||"User",className:"w-7 h-7 rounded-full object-cover"}):p.jsx("div",{className:"w-7 h-7 rounded-full bg-gray-400 flex items-center justify-center text-white text-[11px] font-semibold",children:((He=(rr=Fe.sender)==null?void 0:rr.full_name)==null?void 0:He.charAt(0))||"?"})}),p.jsxs("div",{className:`max-w-[70%] rounded-lg p-2.5 ${Ge?"bg-blue-600 text-white":"bg-gray-200 text-gray-900"}`,children:[!Ge&&Fe.sender&&p.jsx("p",{className:"text-[11px] font-semibold mb-0.5 opacity-80",children:Fe.sender.full_name}),p.jsx("p",{className:"text-[13px]",children:Fe.message}),p.jsx("p",{className:`text-[10px] mt-0.5 ${Ge?"text-blue-100":"text-gray-500"}`,children:new Date(Fe.created_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]}),Ge&&p.jsx("div",{className:"flex-shrink-0",children:s!=null&&s.avatar_url?p.jsx("img",{src:s.avatar_url,alt:(s==null?void 0:s.full_name)||"You",className:"w-7 h-7 rounded-full object-cover"}):p.jsx("div",{className:"w-7 h-7 rounded-full bg-blue-500 flex items-center justify-center text-white text-[11px] font-semibold",children:((Pe=s==null?void 0:s.full_name)==null?void 0:Pe.charAt(0))||"Y"})})]},Fe.id)}),K&&p.jsx("div",{className:"flex justify-start",children:p.jsx("div",{className:"max-w-[70%] rounded-lg p-3 bg-gray-100",children:p.jsxs("div",{className:"flex items-center gap-2 text-gray-500 text-sm",children:[p.jsxs("div",{className:"flex gap-1",children:[p.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"0ms"}}),p.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"150ms"}}),p.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"300ms"}})]}),p.jsx("span",{children:"typing..."})]})})}),p.jsx("div",{ref:F})]}),p.jsx("div",{className:"border-t p-4",children:c.status==="completed"?p.jsx("div",{className:"text-center text-gray-500 py-2",children:"This consultation has ended"}):p.jsxs("form",{onSubmit:ne,className:"flex gap-2",children:[p.jsx(er,{value:E,onChange:De,placeholder:"Type your message...",className:"flex-1"}),p.jsx(Re,{type:"submit",disabled:!E.trim(),children:p.jsx(oq,{className:"w-4 h-4"})})]})})]})}):p.jsx("div",{className:"w-full max-w-4xl mx-auto p-4",children:p.jsx(qe,{children:p.jsxs($e,{className:"p-6 text-center",children:[p.jsx(Of,{className:"h-12 w-12 text-red-500 mx-auto mb-4"}),p.jsx("p",{className:"text-red-500 font-semibold mb-2",children:"Access Denied"}),p.jsx("p",{className:"text-sm text-gray-600",children:"Payment for this consultation has not been completed."}),p.jsx("p",{className:"text-sm text-gray-600 mt-2",children:"Please complete the payment to access the consultation messaging."})]})})})},ebe=({consultationId:r,streamId:s,scholarId:a,scholarName:c,onSuccess:A,onCancel:u})=>{const{profile:m}=gr(),[E,w]=z.useState(0),[C,T]=z.useState(0),[N,B]=z.useState(""),[k,Q]=z.useState(!1),[K,Y]=z.useState(!1),[F,M]=z.useState(!1),[V,W]=z.useState(!1),q=r?"consultation":"livestream";z.useEffect(()=>{te()},[r,s]);const te=async()=>{try{let ce=!1;if(r){const{data:ye,error:De}=await oe.from("consultations").select("status, actual_ended_at").eq("id",r).single();if(De)throw De;ce=ye.status==="completed"&&!!ye.actual_ended_at}else if(s){const{data:ye,error:De}=await oe.from("streams").select("is_active, ended_at").eq("id",s).single();if(De)throw De;if(ce=!ye.is_active&&!!ye.ended_at,ce){const{data:Xe}=await oe.from("stream_participants").select("id").eq("stream_id",s).eq("user_id",m==null?void 0:m.id).maybeSingle();Xe||(ce=!1)}}if(W(ce),!ce){Y(!1);return}const Ae=oe.from("scholar_reviews").select("id").eq("reviewer_id",m==null?void 0:m.id);r?Ae.eq("consultation_id",r):s&&Ae.eq("stream_id",s);const{data:ne,error:ue}=await Ae.maybeSingle();if(ue)throw ue;ne?(M(!0),Y(!1)):Y(!0)}catch(ce){console.error("Error checking review eligibility:",ce)}},re=async ce=>{if(ce.preventDefault(),E===0){alert("Please select a rating");return}if(!N.trim()){alert("Please write a review");return}Q(!0);try{const Ae={scholar_id:a,reviewer_id:m==null?void 0:m.id,rating:E,review_text:N.trim()};r?Ae.consultation_id=r:s&&(Ae.stream_id=s);const{error:ne}=await oe.from("scholar_reviews").insert(Ae);if(ne)throw ne;await oe.from("notifications").insert({user_id:a,title:"New Review",message:`You received a ${E}-star review from ${m==null?void 0:m.full_name} for a ${q}`,notification_type:"review_received",related_id:r||s,action_url:`/scholar/${a}`}),alert("Review submitted successfully!"),A&&A()}catch(Ae){console.error("Error submitting review:",Ae),alert("Failed to submit review: "+Ae.message)}finally{Q(!1)}},de=()=>p.jsx("div",{className:"flex gap-2 justify-center my-4",children:[1,2,3,4,5].map(ce=>p.jsx("button",{type:"button",onClick:()=>w(ce),onMouseEnter:()=>T(ce),onMouseLeave:()=>T(0),className:"transition-transform hover:scale-110",children:p.jsx(xf,{className:`w-10 h-10 ${ce<=(C||E)?"fill-yellow-400 text-yellow-400":"text-gray-300"}`})},ce))});return V?F?p.jsx(qe,{className:"w-full max-w-md mx-auto",children:p.jsx($e,{className:"p-6",children:p.jsxs("div",{className:"text-center",children:[p.jsx(LEe,{className:"w-12 h-12 text-green-500 mx-auto mb-3"}),p.jsx("p",{className:"text-gray-700 font-semibold",children:"Review Already Submitted"}),p.jsx("p",{className:"text-sm text-gray-600 mt-2",children:"You have already reviewed this consultation."})]})})}):K?p.jsxs(qe,{className:"w-full max-w-md mx-auto",children:[p.jsxs(Pt,{children:[p.jsxs(Vt,{children:["Review Your ",q==="consultation"?"Consultation":"Livestream"]}),p.jsxs("p",{className:"text-sm text-gray-600",children:["with ",c]})]}),p.jsx($e,{children:p.jsxs("form",{onSubmit:re,className:"space-y-4",children:[p.jsxs("div",{children:[p.jsx("label",{className:"block text-sm font-semibold mb-2 text-center",children:"How would you rate your experience?"}),de(),E>0&&p.jsxs("p",{className:"text-center text-sm text-gray-600",children:[E===5&&"Excellent!",E===4&&"Very Good",E===3&&"Good",E===2&&"Fair",E===1&&"Poor"]})]}),p.jsxs("div",{children:[p.jsx("label",{className:"block text-sm font-semibold mb-2",children:"Share your experience"}),p.jsx("textarea",{value:N,onChange:ce=>B(ce.target.value),placeholder:"Tell others about your consultation experience...",className:"w-full min-h-[120px] p-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",maxLength:500}),p.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[N.length,"/500 characters"]})]}),p.jsxs("div",{className:"flex gap-2",children:[p.jsx(Re,{type:"submit",disabled:k||E===0||!N.trim(),className:"flex-1",children:k?"Submitting...":"Submit Review"}),u&&p.jsx(Re,{type:"button",variant:"outline",onClick:u,disabled:k,children:"Cancel"})]})]})})]}):p.jsx(qe,{className:"w-full max-w-md mx-auto",children:p.jsx($e,{className:"p-6",children:p.jsx("div",{className:"text-center text-gray-600",children:p.jsx("p",{children:"Unable to submit review at this time."})})})}):p.jsx(qe,{className:"w-full max-w-md mx-auto",children:p.jsx($e,{className:"p-6",children:p.jsx("div",{className:"text-center text-gray-600",children:p.jsxs("p",{children:["You can submit a review after the ",q," is completed."]})})})})},tbe=()=>{const{profile:r,signOut:s}=gr(),a=ss(),[c,A]=z.useState("warning"),[u,m]=z.useState(""),[E,w]=z.useState(!1),[C,T]=z.useState(""),N=async()=>{if(u!=="DELETE MY ACCOUNT"){T("Please type the exact confirmation text");return}w(!0),T("");try{const{error:B}=await oe.functions.invoke("delete-user-account",{body:{userId:r==null?void 0:r.id}});if(B){const{error:k}=await oe.rpc("delete_user_account",{user_id_to_delete:r==null?void 0:r.id});if(k)throw k;alert("Account data deleted. Please contact support to complete account deletion from authentication system.")}await s(),a("/signin")}catch(B){console.error("Error deleting account:",B),T("Failed to delete account. Please try again or contact support."),w(!1)}};return c==="warning"?p.jsx("div",{className:"w-full max-w-2xl mx-auto p-4",children:p.jsxs(qe,{className:"border-red-200",children:[p.jsx(Pt,{className:"bg-red-50 border-b border-red-200",children:p.jsxs("div",{className:"flex items-center gap-3",children:[p.jsx(Aq,{className:"w-8 h-8 text-red-600"}),p.jsxs("div",{children:[p.jsx(Vt,{className:"text-red-900",children:"Delete Account"}),p.jsx("p",{className:"text-sm text-red-700 mt-1",children:"This action cannot be undone"})]})]})}),p.jsxs($e,{className:"p-6 space-y-4",children:[p.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:[p.jsx("p",{className:"font-semibold text-yellow-900 mb-2",children:" Warning: The following data will be permanently deleted:"}),p.jsxs("ul",{className:"list-disc list-inside space-y-1 text-sm text-yellow-800",children:[p.jsx("li",{children:"Your profile and account information"}),p.jsx("li",{children:"All consultations (pending and completed)"}),p.jsx("li",{children:"All messages and communications"}),p.jsx("li",{children:"Reviews you've written and received"}),p.jsx("li",{children:"Livestream history and recordings"}),p.jsx("li",{children:"Zakat donations and payment history"}),p.jsx("li",{children:"All notifications and preferences"}),p.jsx("li",{children:"Blocked users and reports"}),p.jsx("li",{children:"Subscriptions and access permissions"})]})]}),p.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[p.jsx("p",{className:"font-semibold text-blue-900 mb-2",children:" Before you proceed:"}),p.jsxs("ul",{className:"list-disc list-inside space-y-1 text-sm text-blue-800",children:[p.jsx("li",{children:"Complete or cancel all pending consultations"}),p.jsx("li",{children:"Download any important conversation history"}),p.jsx("li",{children:"Cancel any active subscriptions"}),p.jsx("li",{children:"Withdraw any remaining account balance (if applicable)"})]})]}),(r==null?void 0:r.role)==="scholar"&&p.jsxs("div",{className:"bg-purple-50 border border-purple-200 rounded-lg p-4",children:[p.jsx("p",{className:"font-semibold text-purple-900 mb-2",children:" Scholar Account Notice:"}),p.jsx("p",{className:"text-sm text-purple-800",children:"Your scholar profile, ratings, and reviews will be permanently removed. Members will no longer be able to book consultations or view your livestreams."})]}),p.jsxs("div",{className:"flex gap-3 pt-4",children:[p.jsxs(Re,{variant:"outline",onClick:()=>a("/profile-settings"),className:"flex-1",children:[p.jsx(Qu,{className:"w-4 h-4 mr-2"}),"Go Back"]}),p.jsx(Re,{variant:"destructive",onClick:()=>A("confirm"),className:"flex-1",children:"I Understand, Continue"})]})]})]})}):p.jsx("div",{className:"w-full max-w-md mx-auto p-4",children:p.jsxs(qe,{className:"border-red-200",children:[p.jsx(Pt,{className:"bg-red-50 border-b border-red-200",children:p.jsxs("div",{className:"flex items-center gap-3",children:[p.jsx(lq,{className:"w-8 h-8 text-red-600"}),p.jsxs("div",{children:[p.jsx(Vt,{className:"text-red-900",children:"Final Confirmation"}),p.jsx("p",{className:"text-sm text-red-700 mt-1",children:"Type to confirm account deletion"})]})]})}),p.jsxs($e,{className:"p-6 space-y-4",children:[p.jsxs("div",{children:[p.jsx("p",{className:"text-sm text-gray-700 mb-4",children:"To confirm deletion of your account and all associated data, please type:"}),p.jsx("p",{className:"text-center font-bold text-lg mb-4 p-3 bg-gray-100 rounded-lg",children:"DELETE MY ACCOUNT"}),p.jsx(er,{value:u,onChange:B=>{m(B.target.value),T("")},placeholder:"Type here...",className:"text-center font-semibold"}),C&&p.jsx("p",{className:"text-red-600 text-sm mt-2",children:C})]}),p.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3",children:p.jsx("p",{className:"text-sm text-red-800 font-semibold",children:"Last chance: This will immediately and permanently delete your account"})}),p.jsxs("div",{className:"flex gap-3",children:[p.jsx(Re,{variant:"outline",onClick:()=>A("warning"),disabled:E,className:"flex-1",children:"Cancel"}),p.jsx(Re,{variant:"destructive",onClick:N,disabled:E||u!=="DELETE MY ACCOUNT",className:"flex-1",children:E?"Deleting...":"Delete Forever"})]})]})]})})},DG=()=>{const r=ss(),[s,a]=z.useState([]),[c,A]=z.useState(!0),[u,m]=z.useState(""),[E,w]=z.useState("all");z.useEffect(()=>{C();const N=oe.channel("scholar-presence").on("postgres_changes",{event:"*",schema:"public",table:"profiles"},()=>{C()}).on("postgres_changes",{event:"*",schema:"public",table:"consultations"},()=>{C()}).subscribe();return()=>{N.unsubscribe()}},[E]);const C=async()=>{try{A(!0),m("");let N=oe.from("profiles").select("*").in("role",["scholar","imam"]);E==="verified"?N=N.eq("certificate_verified",!0):E==="online"&&(N=N.eq("is_online",!0));const{data:B,error:k}=await N.order("average_rating",{ascending:!1});if(k)throw k;const Q=(B||[]).map(Y=>Y.id);let K={};if(Q.length>0){const{data:Y}=await oe.from("consultations").select("scholar_id, started_at, actual_ended_at, status").in("scholar_id",Q).is("actual_ended_at",null);Y==null||Y.forEach(F=>{F.started_at&&F.status!=="completed"&&(K[F.scholar_id]=!0)})}a((B||[]).map(Y=>({...Y,is_online:!!Y.is_online,busy:!!K[Y.id]}))),A(!1)}catch(N){console.error("Error fetching scholars:",N),m("Failed to load scholars. Please try again."),A(!1)}},T=N=>{r(`/scholar/${N}/book`)};return p.jsx(yr,{title:"Available Scholars",showBack:!0,children:p.jsxs("div",{className:"p-4 space-y-4",children:[p.jsxs("div",{className:"flex space-x-2 overflow-x-auto pb-2",children:[p.jsx(Re,{variant:E==="all"?"default":"outline",size:"sm",onClick:()=>w("all"),className:E==="all"?"bg-emerald-600":"",children:"All Scholars"}),p.jsx(Re,{variant:E==="verified"?"default":"outline",size:"sm",onClick:()=>w("verified"),className:E==="verified"?"bg-emerald-600":"",children:"Verified Only"}),p.jsx(Re,{variant:E==="online"?"default":"outline",size:"sm",onClick:()=>w("online"),className:E==="online"?"bg-emerald-600":"",children:"Online Now"})]}),c?p.jsx("div",{className:"text-center py-12",children:p.jsx("p",{className:"text-muted-foreground",children:"Loading scholars..."})}):u?p.jsxs("div",{className:"text-center py-12",children:[p.jsx("p",{className:"text-destructive mb-4",children:u}),p.jsx(Re,{onClick:C,children:"Retry"})]}):s.length===0?p.jsx("div",{className:"text-center py-12",children:p.jsx("p",{className:"text-muted-foreground",children:"No scholars available at the moment."})}):p.jsx("div",{className:"space-y-4",children:s.map(N=>p.jsx(qe,{className:"hover:shadow-lg transition-shadow",children:p.jsxs($e,{className:"p-4",children:[p.jsxs("div",{className:"flex justify-between items-start mb-3",children:[p.jsxs("div",{children:[p.jsxs("div",{className:"flex items-center space-x-2",children:[p.jsx("h3",{className:"text-lg font-semibold",children:N.full_name}),N.certificate_verified&&p.jsx(VEe,{className:"h-5 w-5 text-blue-600"})]}),p.jsx("p",{className:"text-sm text-muted-foreground capitalize",children:N.role})]}),N.average_rating>0&&p.jsxs("div",{className:"flex items-center space-x-1 bg-amber-50 px-2 py-1 rounded",children:[p.jsx(xf,{className:"h-4 w-4 text-amber-500 fill-amber-500"}),p.jsx("span",{className:"text-sm font-semibold",children:N.average_rating.toFixed(1)}),p.jsxs("span",{className:"text-xs text-muted-foreground",children:["(",N.total_ratings,")"]})]})]}),N.bio&&p.jsx("p",{className:"text-sm text-gray-600 mb-3 line-clamp-2",children:N.bio}),N.specializations&&N.specializations.length>0&&p.jsx("div",{className:"flex flex-wrap gap-2 mb-3",children:N.specializations.slice(0,3).map((B,k)=>p.jsx("span",{className:"text-xs bg-emerald-50 text-emerald-700 px-2 py-1 rounded-full",children:B},k))}),p.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[typeof N.consultation_fee=="number"&&N.consultation_fee>0&&p.jsx("div",{className:"col-span-3 -mt-1 mb-2 text-right",children:p.jsxs("span",{className:"text-xs px-2 py-1 rounded bg-emerald-50 text-emerald-700 font-semibold",children:["",N.consultation_fee,"/",N.consultation_duration||30,"min"]})}),p.jsxs(Re,{className:"bg-emerald-600 hover:bg-emerald-700",onClick:()=>T(N.id),children:[p.jsx(Nl,{className:"h-4 w-4 mr-1"}),"Book"]}),p.jsxs(Re,{variant:"outline",className:"border-blue-500 text-blue-600 hover:bg-blue-50",onClick:()=>r(`/livestreams?scholar=${N.id}`),children:[p.jsx(bl,{className:"h-4 w-4 mr-1"}),"Stream"]}),p.jsxs(Re,{variant:"outline",onClick:()=>r(`/scholar/${N.id}`),children:[p.jsx(yB,{className:"h-4 w-4 mr-1"}),"Profile"]})]})]})},N.id))})]})})},BG=()=>{const{profile:r}=gr(),s=ss(),[a,c]=z.useState([]),[A,u]=z.useState(!0);z.useEffect(()=>{if(!(r!=null&&r.id)){console.log("No profile ID, skipping fetch");return}console.log("Fetching bookings for profile:",r.id),m();const T=oe.channel(`my-consultation-bookings-${r.id}`).on("postgres_changes",{event:"*",schema:"public",table:"consultation_bookings",filter:`user_id=eq.${r.id}`},()=>{console.log("Consultation booking changed, refreshing..."),m()}).subscribe(N=>{console.log("Subscription status:",N)});return()=>{console.log("Unsubscribing from bookings"),T.unsubscribe()}},[r==null?void 0:r.id]);const m=async()=>{if(!(r!=null&&r.id)){console.log("No profile ID in fetchBookings");return}try{u(!0),console.log("Fetching consultation bookings for user:",r.id);const{data:T,error:N}=await oe.from("consultation_bookings").select(`
          *,
          scholar:profiles!scholar_id(full_name, specializations)
        `).eq("user_id",r.id).order("created_at",{ascending:!1});if(N)throw console.error("Error fetching consultation bookings:",N),N;console.log("Fetched consultations:",(T==null?void 0:T.length)||0),c(T||[])}catch(T){console.error("Error fetching bookings:",T)}finally{u(!1)}},E=T=>{switch(T){case"confirmed":return p.jsx(Ks,{className:"w-5 h-5 text-green-600"});case"cancelled":return p.jsx(hl,{className:"w-5 h-5 text-red-600"});case"completed":return p.jsx(Ks,{className:"w-5 h-5 text-blue-600"});default:return p.jsx(Of,{className:"w-5 h-5 text-yellow-600"})}},w=T=>{switch(T){case"confirmed":return"bg-green-100 text-green-800";case"cancelled":return"bg-red-100 text-red-800";case"completed":return"bg-blue-100 text-blue-800";default:return"bg-yellow-100 text-yellow-800"}},C=async T=>{if(confirm("Are you sure you want to cancel this consultation?"))try{const{error:N}=await oe.from("consultation_bookings").update({status:"cancelled"}).eq("id",T);if(N)throw N;await m()}catch(N){console.error("Error cancelling consultation:",N),alert("Failed to cancel consultation")}};return A?p.jsx(yr,{title:"My Bookings",children:p.jsx(qe,{children:p.jsx($e,{className:"p-6 text-center",children:p.jsx("p",{children:"Loading your bookings..."})})})}):p.jsx(yr,{title:"My Bookings",children:p.jsx("div",{className:"space-y-4",children:p.jsx("div",{className:"space-y-3",children:a.length===0?p.jsx(qe,{children:p.jsxs($e,{className:"p-6 text-center",children:[p.jsx(fr,{className:"w-12 h-12 text-gray-400 mx-auto mb-3"}),p.jsx("p",{className:"text-gray-600",children:"No consultation bookings yet"}),p.jsx(Re,{className:"mt-4",onClick:()=>s("/available-scholars"),children:"Book a Consultation"})]})}):a.map(T=>{var N;return p.jsxs(qe,{className:"hover:shadow-md transition-shadow",children:[p.jsx(Pt,{className:"pb-3",children:p.jsxs("div",{className:"flex items-start justify-between",children:[p.jsxs("div",{className:"flex-1",children:[p.jsxs(Vt,{className:"text-lg flex items-center gap-2",children:[p.jsx(yB,{className:"w-5 h-5"}),T.scholar.full_name]}),p.jsx("p",{className:"text-sm text-gray-600 mt-1",children:(N=T.scholar.specializations)==null?void 0:N.join(", ")})]}),p.jsxs("div",{className:"flex items-center gap-2",children:[E(T.status),p.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${w(T.status)}`,children:T.status})]})]})}),p.jsxs($e,{className:"space-y-3",children:[p.jsxs("div",{className:"space-y-2",children:[p.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[p.jsx(fr,{className:"w-4 h-4 text-gray-500"}),p.jsx("span",{children:new Date(T.booking_date).toLocaleDateString()})]}),p.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[p.jsx(Pa,{className:"w-4 h-4 text-gray-500"}),p.jsx("span",{children:T.booking_time})]}),T.topic&&p.jsxs("div",{className:"text-sm",children:[p.jsx("span",{className:"font-semibold",children:"Topic:"})," ",T.topic]})]}),p.jsxs("div",{className:"flex flex-wrap gap-2 pt-2",children:[T.status==="confirmed"&&T.payment_status==="completed"&&p.jsxs(p.Fragment,{children:[p.jsxs(Re,{size:"sm",className:"flex-1 min-w-[120px] bg-emerald-600 hover:bg-emerald-700",onClick:()=>s(`/consultation/${T.id}/messages`),children:[p.jsx(Nl,{className:"w-4 h-4 mr-1"}),p.jsx("span",{className:"hidden xs:inline",children:"Open Chat"}),p.jsx("span",{className:"xs:hidden",children:"Chat"})]}),p.jsx(Re,{size:"sm",variant:"outline",className:"flex-1 min-w-[100px]",onClick:()=>C(T.id),children:"Cancel"})]}),T.status==="confirmed"&&T.payment_status!=="completed"&&p.jsx("div",{className:"text-sm text-amber-600 bg-amber-50 p-2 rounded",children:" Awaiting payment confirmation"}),T.status==="pending"&&p.jsx(Re,{size:"sm",variant:"outline",className:"w-full",onClick:()=>C(T.id),children:"Cancel Booking"})]})]})]},T.id)})})})})},kG=()=>{const r=ss(),s=[{id:"education",name:"Islamic Education",icon:Mx,description:"Quran classes, Arabic lessons, Islamic studies",color:"bg-blue-50",iconColor:"text-blue-600",count:12},{id:"prayers",name:"Prayer Services",icon:tq,description:"Jummah prayers, Taraweeh, Eid prayers",color:"bg-emerald-50",iconColor:"text-emerald-600",count:8},{id:"sports",name:"Sports & Fitness",icon:qEe,description:"Football, basketball, swimming, gym sessions",color:"bg-orange-50",iconColor:"text-orange-600",count:15},{id:"social",name:"Social Events",icon:yi,description:"Community gatherings, meetups, networking",color:"bg-purple-50",iconColor:"text-purple-600",count:10},{id:"restaurant",name:"Halal Restaurants",icon:Vw,description:"Discover halal dining options and food events",color:"bg-red-50",iconColor:"text-red-600",count:18},{id:"charity",name:"Charity & Volunteering",icon:Ma,description:"Community service, fundraising, volunteer work",color:"bg-pink-50",iconColor:"text-pink-600",count:7},{id:"business",name:"Business & Career",icon:REe,description:"Workshops, networking, career development",color:"bg-indigo-50",iconColor:"text-indigo-600",count:9},{id:"family",name:"Family & Youth",icon:gEe,description:"Family activities, youth programs, kids events",color:"bg-yellow-50",iconColor:"text-yellow-600",count:14},{id:"arts",name:"Arts & Culture",icon:Sve,description:"Islamic art, nasheeds, cultural exhibitions",color:"bg-teal-50",iconColor:"text-teal-600",count:6},{id:"library",name:"Library & Books",icon:bEe,description:"Book clubs, reading circles, library services",color:"bg-gray-50",iconColor:"text-gray-600",count:5}];return p.jsx(yr,{title:"Activity Categories",children:p.jsxs("div",{className:"space-y-4",children:[p.jsxs("div",{className:"text-center mb-6",children:[p.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-2",children:"Explore Community Activities"}),p.jsx("p",{className:"text-gray-600",children:"Browse activities by category and join your community"})]}),p.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:s.map(a=>{const c=a.icon;return p.jsxs(qe,{className:`${a.color} border-none shadow-md hover:shadow-lg transition-all cursor-pointer`,onClick:()=>r(`/activities/${a.id}`),children:[p.jsx(Pt,{className:"pb-3",children:p.jsxs("div",{className:"flex items-start gap-3",children:[p.jsx("div",{className:`p-3 rounded-xl shadow-md ${a.color}`,children:p.jsx(c,{className:`h-8 w-8 ${a.iconColor} drop-shadow-md`})}),p.jsxs("div",{className:"flex-1",children:[p.jsx(Vt,{className:"text-lg",children:a.name}),p.jsxs("p",{className:"text-xs text-gray-600 mt-1",children:[a.count," activities"]})]})]})}),p.jsx($e,{children:p.jsx("p",{className:"text-sm text-gray-700",children:a.description})})]},a.id)})}),p.jsx(qe,{className:"bg-gradient-to-r from-emerald-50 to-blue-50 border-none shadow-md",children:p.jsxs($e,{className:"p-6 text-center",children:[p.jsx("h3",{className:"font-bold text-lg mb-2",children:"Looking for something specific?"}),p.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Can't find what you're looking for? Contact us to suggest new activities!"}),p.jsx("button",{className:"px-6 py-2 bg-emerald-600 text-white rounded-lg hover:bg-emerald-700 transition-colors shadow-md",onClick:()=>r("/contact"),children:"Contact Us"})]})})]})})},nbe=[],LG=()=>{const{categoryId:r}=bb(),{profile:s}=gr(),a=ss(),[c,A]=z.useState([]),[u,m]=z.useState(!0),E={education:"Islamic Education",prayers:"Prayer Services",sports:"Sports & Fitness",social:"Social Events",restaurant:"Halal Restaurants",charity:"Charity & Volunteering",business:"Business & Career",family:"Family & Youth",arts:"Arts & Culture",library:"Library & Books"};z.useEffect(()=>{w()},[r]);const w=async()=>{try{if(m(!0),r==="restaurant"){A(nbe),m(!1);return}const{data:T,error:N}=await oe.from("activities").select(`
          *,
          organizer:profiles!organizer_id(full_name)
        `).eq("category",r).eq("is_active",!0).order("date",{ascending:!0});if(N)throw N;A(T||[])}catch(T){console.error("Error fetching activities:",T)}finally{m(!1)}},C=async T=>{if(!(s!=null&&s.id)){alert("Please sign in to book activities"),a("/signin");return}try{const{error:N}=await oe.from("activity_bookings").insert({activity_id:T,user_id:s.id,booking_date:new Date().toISOString(),status:"pending"});if(N)throw N;alert("Activity booked successfully!"),a("/my-bookings")}catch(N){console.error("Error booking activity:",N),alert(N.message||"Failed to book activity")}};return u?p.jsx(yr,{title:E[r||""]||"Activities",children:p.jsx(qe,{children:p.jsx($e,{className:"p-6 text-center",children:p.jsx("p",{children:"Loading activities..."})})})}):r==="restaurant"?p.jsx(yr,{title:"Halal Restaurants",children:p.jsxs("div",{className:"space-y-4",children:[p.jsxs("div",{className:"text-center mb-4",children:[p.jsx(Vw,{className:"w-12 h-12 text-red-600 mx-auto mb-2"}),p.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:"Halal Dining Options"}),p.jsx("p",{className:"text-sm text-gray-600",children:"Certified halal restaurants in your area"})]}),c.map(T=>{var N;return p.jsxs(qe,{className:"shadow-md hover:shadow-lg transition-all",children:[p.jsx(Pt,{children:p.jsx("div",{className:"flex items-start justify-between",children:p.jsxs("div",{className:"flex-1",children:[p.jsxs(Vt,{className:"text-lg flex items-center gap-2",children:[p.jsx(PEe,{className:"w-5 h-5 text-red-600"}),T.title]}),p.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[p.jsxs("div",{className:"flex items-center",children:[p.jsx(xf,{className:"w-4 h-4 text-yellow-500 fill-yellow-500"}),p.jsx("span",{className:"text-sm font-bold ml-1",children:T.rating})]}),p.jsx("span",{className:"text-sm text-gray-600",children:T.price_range}),p.jsx("span",{className:"text-xs px-2 py-1 bg-green-100 text-green-700 rounded-full",children:T.cuisine})]})]})})}),p.jsxs($e,{className:"space-y-3",children:[p.jsx("p",{className:"text-sm text-gray-700",children:T.description}),p.jsxs("div",{className:"space-y-2",children:[p.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[p.jsx(wl,{className:"w-4 h-4 text-gray-500"}),p.jsx("span",{children:T.location})]}),p.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[p.jsx(Pa,{className:"w-4 h-4 text-gray-500"}),p.jsx("span",{children:T.hours})]}),p.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[p.jsx(mf,{className:"w-4 h-4 text-gray-500"}),p.jsx("span",{children:T.phone})]}),T.website&&p.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[p.jsx(iq,{className:"w-4 h-4 text-gray-500"}),p.jsx("a",{href:`https://${T.website}`,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:underline",children:T.website})]})]}),p.jsxs("div",{className:"mt-4",children:[p.jsx("h4",{className:"font-semibold text-sm mb-2",children:"Popular Menu Items:"}),p.jsx("div",{className:"space-y-2",children:(N=T.options)==null?void 0:N.map(B=>p.jsxs("div",{className:"flex items-start justify-between p-2 bg-gray-50 rounded-lg",children:[p.jsxs("div",{className:"flex-1",children:[p.jsx("p",{className:"font-medium text-sm",children:B.name}),p.jsx("p",{className:"text-xs text-gray-600",children:B.description})]}),p.jsxs("div",{className:"text-right",children:[p.jsxs("p",{className:"font-bold text-sm text-emerald-600",children:["$",B.price]}),B.available&&p.jsx("span",{className:"text-xs text-green-600",children:"Available"})]})]},B.id))})]})]}),p.jsxs(S_,{className:"flex gap-2",children:[p.jsxs(Re,{className:"flex-1",variant:"outline",onClick:()=>window.open(`tel:${T.phone}`),children:[p.jsx(mf,{className:"w-4 h-4 mr-1"}),"Call"]}),p.jsxs(Re,{className:"flex-1",onClick:()=>window.open(`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(T.location)}`),children:[p.jsx(wl,{className:"w-4 h-4 mr-1"}),"Directions"]})]})]},T.id)})]})}):p.jsx(yr,{title:E[r||""]||"Activities",children:p.jsx("div",{className:"space-y-4",children:c.length===0?p.jsx(qe,{children:p.jsxs($e,{className:"p-6 text-center",children:[p.jsx(fr,{className:"w-12 h-12 text-gray-400 mx-auto mb-3"}),p.jsx("p",{className:"text-gray-600",children:"No activities available in this category yet"}),p.jsx(Re,{className:"mt-4",onClick:()=>a("/activity-categories"),children:"Browse Other Categories"})]})}):c.map(T=>p.jsxs(qe,{className:"shadow-md hover:shadow-lg transition-all",children:[p.jsxs(Pt,{children:[p.jsx(Vt,{className:"text-lg",children:T.title}),p.jsxs("p",{className:"text-sm text-gray-600",children:["by ",T.organizer.full_name]})]}),p.jsxs($e,{className:"space-y-3",children:[p.jsx("p",{className:"text-sm text-gray-700",children:T.description}),p.jsxs("div",{className:"space-y-2",children:[p.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[p.jsx(fr,{className:"w-4 h-4 text-gray-500"}),p.jsx("span",{children:new Date(T.date).toLocaleDateString()})]}),p.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[p.jsx(Pa,{className:"w-4 h-4 text-gray-500"}),p.jsx("span",{children:T.time})]}),p.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[p.jsx(wl,{className:"w-4 h-4 text-gray-500"}),p.jsx("span",{children:T.location})]}),p.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[p.jsx(yi,{className:"w-4 h-4 text-gray-500"}),p.jsxs("span",{children:[T.current_participants||0," / ",T.capacity," participants"]})]}),T.price>0&&p.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[p.jsx(Lc,{className:"w-4 h-4 text-gray-500"}),p.jsxs("span",{className:"font-semibold text-emerald-600",children:["$",T.price]})]}),T.price===0&&p.jsx("div",{className:"text-sm font-semibold text-green-600",children:"FREE"})]}),T.options&&T.options.length>0&&p.jsxs("div",{className:"mt-4",children:[p.jsx("h4",{className:"font-semibold text-sm mb-2",children:"Available Options:"}),p.jsx("div",{className:"space-y-2",children:T.options.map(N=>p.jsxs("div",{className:"flex items-start justify-between p-2 bg-gray-50 rounded-lg",children:[p.jsxs("div",{className:"flex-1",children:[p.jsx("p",{className:"font-medium text-sm",children:N.name}),p.jsx("p",{className:"text-xs text-gray-600",children:N.description})]}),p.jsxs("div",{className:"text-right",children:[N.price>0&&p.jsxs("p",{className:"font-bold text-sm text-emerald-600",children:["$",N.price]}),p.jsx("span",{className:`text-xs ${N.available?"text-green-600":"text-red-600"}`,children:N.available?"Available":"Full"})]})]},N.id))})]})]}),p.jsx(S_,{children:p.jsx(Re,{className:"w-full",onClick:()=>C(T.id),disabled:T.current_participants>=T.capacity,children:T.current_participants>=T.capacity?"Fully Booked":"Book Activity"})})]},T.id))})})},rbe=()=>{const[r,s]=z.useState("Ready to test"),[a,c]=z.useState(!1),A=z.useRef(null),u=z.useRef(null),m=async()=>{try{s(" Running system diagnostics..."),A.current=new zw;const w=await A.current.runDiagnostics();let C=" System Diagnostics:\\n";if(w.diagnosticResults.forEach(B=>{C+=`${B}\\n`}),s(C),!w.httpsConnection)throw new Error("HTTPS connection required for camera/microphone access");if(!w.browserSupport)throw new Error("Browser does not support media devices");const T=void 0;if(!T)throw new Error("Missing VITE_AGORA_APP_ID environment variable");if(s(`${C}\\n App ID: ${T} (${T.length} chars)`),T.length!==32)throw new Error(`Invalid App ID length: ${T.length}`);s(`${C}\\n Joining test channel...`);const N=`test_${Date.now()}`;if(await A.current.joinChannel({appId:T,channel:N,token:null,uid:12345},"host"),s(`${C}\\n Successfully connected to Agora!`),c(!0),w.cameras||w.microphones){s(`${C}\\n Testing camera/microphone access...`);const B=await A.current.createLocalTracks();B.videoTrack&&u.current&&(B.videoTrack.play(u.current),s(`${C}\\n Video preview active! Agora is working correctly.`))}else s(`${C}\\n No camera/microphone detected, but Agora connection successful!`)}catch(w){console.error("Agora test failed:",w);let C=w.message;(w.message.includes("token")||w.message.includes("Token"))&&(C=zw.getTokenErrorMessage(w)),s(` Test failed:\\n${C}\\n\\n Solutions:\\n Check internet connection\\n Ensure you're signed in\\n Try refreshing the page\\n Check browser permissions for camera/microphone`)}},E=async()=>{try{A.current&&(await A.current.leave(),s(" Disconnected"),c(!1))}catch(w){console.error("Disconnect error:",w),s(` Disconnect failed: ${w.message}`)}};return p.jsxs(qe,{className:"max-w-2xl mx-auto",children:[p.jsx(Pt,{children:p.jsx(Vt,{children:" Agora Configuration Test"})}),p.jsxs($e,{className:"space-y-4",children:[p.jsx("div",{className:"p-4 bg-muted rounded-lg",children:p.jsx("p",{className:"font-mono text-sm",children:r})}),p.jsxs("div",{className:"flex gap-2",children:[p.jsx(Re,{onClick:m,disabled:a,className:"flex-1",children:"Test Agora Connection"}),p.jsx(Re,{onClick:E,disabled:!a,variant:"outline",className:"flex-1",children:"Disconnect"})]}),p.jsxs("div",{className:"relative aspect-video bg-black rounded-lg overflow-hidden",children:[p.jsx("div",{ref:u,className:"w-full h-full",style:{width:"100%",height:"100%"}}),!a&&p.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:p.jsx("p",{className:"text-white text-center",children:'Click "Test Agora Connection" to start video preview'})})]}),p.jsxs("div",{className:"text-xs text-muted-foreground space-y-1",children:[p.jsx("p",{children:p.jsx("strong",{children:"Current Environment:"})}),p.jsxs("p",{children:[" URL: ",window.location.href]}),p.jsxs("p",{children:[" Secure Context: ",window.isSecureContext?"":""]}),p.jsxs("p",{children:[" Platform: ",navigator.platform]}),p.jsxs("p",{children:[" User Agent: ",navigator.userAgent.substring(0,50),"..."]})]}),p.jsxs("div",{className:"mt-4 p-3 bg-blue-50 rounded-lg border border-blue-200",children:[p.jsx("p",{className:"font-semibold text-sm text-blue-800 mb-2",children:" If connection fails:"}),p.jsxs("p",{className:"text-xs text-blue-700",children:["1. Go to ",p.jsx("a",{href:"https://console.agora.io",target:"_blank",className:"underline",children:"console.agora.io"}),p.jsx("br",{}),"2. Find project with your App ID (VITE_AGORA_APP_ID)",p.jsx("br",{}),'3. Set Authentication to "App ID" (Testing mode)',p.jsx("br",{}),"4. Save and test again"]})]})]})]})},sbe=()=>{const[r,s]=z.useState(""),[a,c]=z.useState(!1),A=async()=>{c(!0),s(`Running diagnostics...

`);try{s(k=>k+`1. Checking authentication...
`);const{data:{session:m},error:E}=await oe.auth.getSession();if(E){s(k=>k+`    Session error: ${E.message}

`),c(!1);return}if(!m){s(k=>k+`    No active session - Please sign in

`),c(!1);return}s(k=>k+`    Session active
`),s(k=>k+`   User ID: ${m.user.id}
`),s(k=>k+`   Email: ${m.user.email}

`),s(k=>k+`2. Testing edge function connectivity...
`);const w=`diagnostic_${Date.now()}`,C=performance.now(),{data:T,error:N}=await oe.functions.invoke("generate-agora-token",{body:{channelName:w,uid:m.user.id,role:1,expirationTimeInSeconds:3600,debug:!0}}),B=Math.round(performance.now()-C);if(N){s(k=>k+`    Edge function error (${B}ms):
`),s(k=>k+`   ${N.message||JSON.stringify(N)}

`),s(k=>k+`3. Debug information:
`),s(k=>k+`   Error type: ${typeof N}
`),s(k=>k+`   Error keys: ${Object.keys(N).join(", ")}
`),N.context&&s(k=>k+`   Context: ${JSON.stringify(N.context,null,2)}
`),c(!1);return}if(!T){s(k=>k+`    No data returned from edge function

`),c(!1);return}if(s(k=>k+`    Edge function responded (${B}ms)
`),s(k=>k+`
3. Validating token...
`),!T.token){s(k=>k+`    No token in response
`),s(k=>k+`   Response: ${JSON.stringify(T,null,2)}

`),c(!1);return}s(k=>k+`    Token generated
`),s(k=>k+`   Length: ${T.token.length} characters
`),s(k=>k+`   Preview: ${T.token.substring(0,30)}...
`),s(k=>k+`   App ID: ${T.appId}
`),T.breakdown&&(s(k=>k+`
4. Token Details:
`),s(k=>k+`${JSON.stringify(T.breakdown,null,2)}
`)),s(k=>k+`
 ALL DIAGNOSTICS PASSED!
`),s(k=>k+`
Your livestream should work correctly.
`),s(k=>k+`If you still have issues, check:
`),s(k=>k+`- Camera/microphone permissions in browser
`),s(k=>k+`- Agora project is in "Testing" mode (App ID + Token)
`),s(k=>k+`- No VPN/firewall blocking Agora servers
`)}catch(m){s(E=>E+`
 Diagnostic failed: ${m.message}
`),s(E=>E+`Stack: ${m.stack}
`)}finally{c(!1)}},u=()=>{navigator.clipboard.writeText(r),alert("Diagnostic results copied to clipboard!")};return p.jsxs(qe,{className:"w-full max-w-4xl mx-auto",children:[p.jsx(Pt,{children:p.jsx(Vt,{children:" Livestream Token Diagnostics"})}),p.jsxs($e,{className:"space-y-4",children:[p.jsxs("div",{className:"flex gap-2",children:[p.jsx(Re,{onClick:A,disabled:a,children:a?"Running...":"Run Full Diagnostic"}),r&&p.jsx(Re,{onClick:u,variant:"outline",children:"Copy Results"})]}),r&&p.jsx("div",{className:"bg-black text-green-400 p-4 rounded-lg font-mono text-sm whitespace-pre-wrap overflow-x-auto",children:r}),p.jsxs("div",{className:"text-sm text-muted-foreground",children:[p.jsx("p",{className:"font-semibold mb-2",children:"This diagnostic will:"}),p.jsxs("ul",{className:"list-disc pl-5 space-y-1",children:[p.jsx("li",{children:"Check if you're properly authenticated"}),p.jsx("li",{children:"Test edge function connectivity"}),p.jsx("li",{children:"Attempt to generate a test token"}),p.jsx("li",{children:"Validate the token format"}),p.jsx("li",{children:"Show detailed error information if anything fails"})]})]})]})]})},ibe=()=>{const r=wB(),{profile:s}=gr(),{showNotification:a}=Hu(),c=ss(),[A,u]=z.useState([]),[m,E]=z.useState(null),[w,C]=z.useState(""),[T,N]=z.useState([]),[B,k]=z.useState(!1),[Q,K]=z.useState(""),[Y,F]=z.useState(!1),[M,V]=z.useState(!1),[W,q]=z.useState(0);z.useEffect(()=>{re(),te()},[]);const te=async()=>{try{const{data:{user:ne}}=await oe.auth.getUser();if(!ne)return;const{data:ue}=await oe.from("profiles").select("masjid_coin_balance").eq("id",ne.id).single();ue&&q(ue.masjid_coin_balance||0)}catch(ne){console.error("Error fetching balance:",ne)}};z.useEffect(()=>{if(!(s!=null&&s.id))return;console.log("Profile loaded, fetching bookings for:",s.id),de();const ne=oe.channel(`consultation-bookings:${s.id}`,{config:{broadcast:{self:!1}}}).on("postgres_changes",{event:"*",schema:"public",table:"consultation_bookings",filter:`user_id=eq.${s.id}`},()=>{console.log("Booking update detected, refreshing..."),de()}).subscribe(ye=>{console.log(" Booking subscription status:",ye),ye==="CHANNEL_ERROR"&&console.error(" Booking subscription error")}),ue=setInterval(()=>{de()},1e4);return()=>{ne.unsubscribe(),clearInterval(ue)}},[s==null?void 0:s.id]);const re=async()=>{try{const{data:ne,error:ue}=await oe.from("profiles").select("id, full_name, specializations, consultation_fee, consultation_duration, is_online").in("role",["scholar","imam"]).eq("is_online",!0).order("full_name");if(ue)throw console.error("Supabase error:",ue),K(`Failed to load scholars: ${ue.message}`),ue;if(console.log("Fetched scholars:",ne),!ne||ne.length===0){console.log("No scholars found in database"),u([]);return}const De=(ne||[]).map(Xe=>{const we=typeof Xe.consultation_fee=="number"?Xe.consultation_fee:Number(Xe.consultation_fee||0);return console.log(`Scholar ${Xe.full_name}: fee = ${Xe.consultation_fee}, parsed = ${we}`),{id:Xe.id,name:Xe.full_name,specialization:Array.isArray(Xe.specializations)&&Xe.specializations.length>0?Xe.specializations[0]:"Islamic Studies",consultationFee:we,consultationDuration:Xe.consultation_duration||30,isOnline:Xe.is_online||!1}}).filter(Xe=>Xe.consultationFee>0);console.log("Scholars with fees:",De),u(De),De.length===0&&console.log("No scholars with consultation fees set")}catch(ne){console.error("Error fetching scholars:",ne),K(`Failed to load scholars: ${ne.message||"Unknown error"}`)}},de=async()=>{try{if(!(s!=null&&s.id)){console.log("No profile ID available");return}console.log("Fetching bookings for user:",s.id);const{data:ne,error:ue}=await oe.from("consultation_bookings").select("*, scholar:profiles!scholar_id(full_name)").eq("user_id",s.id).order("created_at",{ascending:!1}).limit(10);if(ue)throw console.error("Supabase error fetching bookings:",ue),ue;if(console.log("Fetched bookings:",ne),!ne||ne.length===0){console.log("No bookings found for user"),N([]);return}const ye=(ne||[]).map(De=>{var Xe;return{id:De.id,scholarId:De.scholar_id,scholarName:((Xe=De.scholar)==null?void 0:Xe.full_name)||"Unknown",topic:De.topic||"No topic specified",status:De.status||"pending",createdAt:De.created_at,sessionStarted:!!De.started_at,scholarAccepted:De.scholar_accepted||!1,amountPaid:De.amount_paid||0}});console.log("Formatted bookings:",ye),N(ye)}catch(ne){console.error("Error fetching bookings:",ne),K(`Failed to load bookings: ${ne.message}`)}},ce=async()=>{if(!r.canBookConsultation){K("Only members can book consultations");return}if(!m||!w.trim()){K("Please select a scholar and enter a topic");return}if(!m.isOnline){K("Scholar is currently offline. Please try again when they are online.");return}if(!(s!=null&&s.id)){K("User not authenticated");return}K(""),k(!0);try{const{data:ne,error:ue}=await oe.from("consultation_bookings").select("id, status").eq("user_id",s.id).eq("scholar_id",m.id).in("status",["pending","confirmed"]);if(ue)throw ue;if(ne&&ne.length>0)throw new Error(`You already have an active booking with ${m.name}. Please cancel it first or wait for it to complete.`);const ye=crypto.randomUUID(),De=`CONSULT_${s.id}_${Date.now()}`,we=Math.floor(m.consultationFee*.01),{data:Se,error:Qe}=await oe.from("profiles").select("masjid_coin_balance").eq("id",s.id).single();if(Qe)throw new Error("Failed to fetch your balance");const Ye=(Se==null?void 0:Se.masjid_coin_balance)||0;if(Ye<we)throw new Error(`Insufficient balance. You need ${we} coins (${m.consultationFee}) but have ${Ye} coins. Please deposit more coins.`);console.log(` User will be debited ${we} coins via database trigger`),console.log(` Scholar will be credited ${we} coins via database trigger`);const It=new Date().toISOString(),{error:Fe}=await oe.from("consultation_bookings").insert({id:ye,user_id:s.id,scholar_id:m.id,booking_date:It.split("T")[0],booking_time:It.split("T")[1].substring(0,5),topic:w,payment_status:"completed",payment_reference:De,amount_paid:we,consultation_duration:m.consultationDuration||30,status:"pending",scholar_accepted:!1});if(Fe)throw console.error(" Booking creation failed:",Fe),new Error(Fe.message||"Failed to create booking");console.log(" Booking created successfully");const{error:Ge}=await oe.from("masjid_coin_transactions").insert({user_id:s.id,recipient_id:null,amount:-we,type:"consultation",description:`Consultation with ${m.name}`,payment_reference:De,payment_status:"completed",status:"completed"});if(Ge)throw console.error(" Failed to create debit transaction:",Ge),new Error("Failed to process consultation payment");console.log(" Debit transaction recorded");const{error:dt}=await oe.from("masjid_coin_transactions").insert({user_id:s.id,recipient_id:m.id,amount:we,type:"consultation",description:`Consultation fee from ${s.full_name}`,payment_reference:De,payment_status:"completed",status:"completed"});if(dt)throw console.error(" Failed to create credit transaction:",dt),new Error("Failed to credit scholar");console.log(" Credit transaction recorded"),console.log(" Consultation payment complete. Database trigger will update balances."),console.log(`   User: -${we} coins | Scholar: +${we} coins`),console.log(" Booking completed successfully!"),F(!0),E(null),C(""),await te(),a(`Payment successful! ${we} coins deducted. Redirecting to chat...`,"payment"),await _0e(m.name,m.consultationDuration||30),await de(),setTimeout(()=>{c(`/consultation/${ye}/messages`)},1500)}catch(ne){console.error("Booking error:",ne),K(ne.message||"Failed to book consultation")}finally{k(!1)}},Ae=async ne=>{try{const ue=T.find(dt=>dt.id===ne);if(!ue)return;if(ue.sessionStarted){a("Cannot cancel consultation after session has started","error");return}if(!confirm(`Cancel consultation with ${ue.scholarName}? You will be refunded ${ue.amountPaid} coins.`))return;k(!0);const{data:ye,error:De}=await oe.from("consultation_bookings").select("scholar_id, amount_paid, user_id").eq("id",ne).single();if(De)throw De;const Xe=ye.amount_paid||0,{error:we}=await oe.from("consultation_bookings").update({status:"cancelled",payment_status:"refunded"}).eq("id",ne);if(we)throw we;const{data:Se,error:Qe}=await oe.from("profiles").select("masjid_coin_balance").eq("id",ye.user_id).single();if(Qe)throw Qe;const Ye=((Se==null?void 0:Se.masjid_coin_balance)||0)+Xe;await oe.from("profiles").update({masjid_coin_balance:Ye}).eq("id",ye.user_id);const{data:It,error:Fe}=await oe.from("profiles").select("masjid_coin_balance").eq("id",ye.scholar_id).single();if(Fe)throw Fe;const Ge=Math.max(0,((It==null?void 0:It.masjid_coin_balance)||0)-Xe);await oe.from("profiles").update({masjid_coin_balance:Ge}).eq("id",ye.scholar_id),await oe.from("masjid_coin_transactions").insert([{user_id:ye.user_id,recipient_id:ye.scholar_id,amount:Xe,type:"refund",description:`Refund for cancelled consultation with ${ue.scholarName}`,status:"completed"},{user_id:ye.scholar_id,recipient_id:ye.user_id,amount:-Xe,type:"refund",description:"Refund issued for cancelled consultation",status:"completed"}]),a(`Consultation cancelled. ${Xe} coins refunded to your account.`,"success"),await de()}catch(ue){console.error("Error cancelling booking:",ue),a(ue.message||"Failed to cancel booking","error")}finally{k(!1)}};return r.canBookConsultation?p.jsxs(yr,{title:"Consultations",children:[p.jsxs("div",{className:"flex gap-4 mb-4",children:[p.jsx(Re,{variant:M?"outline":"default",onClick:()=>V(!1),children:"Book Consultation"}),p.jsxs(Re,{variant:M?"default":"outline",onClick:()=>{V(!0),de()},children:["My Bookings (",T.length,")"]})]}),M?p.jsxs(qe,{children:[p.jsxs(Pt,{children:[p.jsx(Vt,{children:"My Consultations"}),p.jsx(vi,{children:"View and manage your consultation bookings"})]}),p.jsxs($e,{children:[Q&&p.jsx("div",{className:"mb-4 p-3 bg-destructive/10 border border-destructive rounded-md",children:p.jsx("p",{className:"text-sm text-destructive",children:Q})}),B?p.jsxs("div",{className:"text-center py-12",children:[p.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4"}),p.jsx("p",{className:"text-muted-foreground",children:"Loading bookings..."})]}):T.length===0?p.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[p.jsx(fr,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),p.jsx("p",{children:"No consultation bookings yet"}),p.jsx("p",{className:"text-sm mt-2",children:"Book a consultation with an online scholar to get started"})]}):p.jsx("div",{className:"space-y-4",children:T.map(ne=>p.jsx("div",{className:"p-4 border rounded-lg",children:p.jsxs("div",{className:"flex items-start justify-between",children:[p.jsxs("div",{className:"flex-1",children:[p.jsx("h3",{className:"font-semibold mb-1",children:ne.scholarName}),p.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:ne.topic}),p.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[p.jsx(Pa,{className:"h-4 w-4"}),new Date(ne.createdAt).toLocaleString()]})]}),p.jsxs("div",{className:"flex flex-col items-end gap-2",children:[p.jsx("span",{className:`text-xs px-2 py-1 rounded ${ne.status==="confirmed"?"bg-primary/10 text-primary":ne.status==="pending"?"bg-yellow-100 text-yellow-800":ne.status==="completed"?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:ne.sessionStarted?"Session Active":ne.status}),(ne.status==="pending"||ne.status==="confirmed")&&p.jsx(Re,{size:"sm",onClick:()=>c(`/consultation/${ne.id}/messages`),className:"bg-blue-600 hover:bg-blue-700",children:" Join Chat"}),(ne.status==="pending"||ne.status==="confirmed")&&!ne.sessionStarted&&p.jsx(Re,{variant:"outline",size:"sm",onClick:()=>Ae(ne.id),disabled:B,children:"Cancel & Refund"})]})]})},ne.id))})]})]}):p.jsxs(qe,{children:[p.jsxs(Pt,{children:[p.jsxs(Vt,{className:"flex items-center gap-2",children:[p.jsx(Fx,{className:"h-6 w-6 text-primary"}),"Book a Consultation"]}),p.jsx(vi,{children:"Book an instant consultation with available scholars and imams"})]}),p.jsx($e,{className:"space-y-6",children:Y?p.jsxs("div",{className:"p-6 bg-primary/10 border border-primary rounded-lg text-center",children:[p.jsx(fr,{className:"h-12 w-12 text-primary mx-auto mb-4"}),p.jsx("h3",{className:"text-xl font-semibold mb-2",children:"Booking Confirmed!"}),p.jsx("p",{className:"text-muted-foreground mb-2",children:"Your consultation has been booked successfully."}),p.jsx("p",{className:"text-sm text-emerald-600 font-semibold",children:" Paid with Masjid Coins"})]}):p.jsxs(p.Fragment,{children:[p.jsxs("div",{children:[p.jsx("label",{className:"block text-sm font-medium mb-2",children:"Select Scholar/Imam"}),A.length===0?p.jsxs("div",{className:"p-6 bg-muted/50 border rounded-lg text-center",children:[p.jsx(Fx,{className:"h-12 w-12 text-muted-foreground mx-auto mb-3"}),p.jsx("p",{className:"text-muted-foreground mb-2",children:"No scholars online at the moment"}),p.jsx("p",{className:"text-sm text-muted-foreground",children:"Scholars must be online to accept instant consultations. Please check back later."})]}):p.jsx("div",{className:"space-y-2",children:A.map(ne=>p.jsx("div",{className:`p-4 border rounded-lg cursor-pointer transition-colors ${(m==null?void 0:m.id)===ne.id?"border-primary bg-primary/5":"hover:border-primary/50"}`,onClick:()=>E(ne),children:p.jsxs("div",{className:"flex items-center justify-between",children:[p.jsxs("div",{className:"flex-1",children:[p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx("p",{className:"font-semibold",children:ne.name}),ne.isOnline&&p.jsx("span",{className:"px-2 py-0.5 text-xs bg-green-100 text-green-700 rounded-full",children:"Online"})]}),p.jsx("p",{className:"text-sm text-muted-foreground",children:ne.specialization})]}),p.jsxs("div",{className:"text-right",children:[p.jsxs("p",{className:"text-lg font-bold text-emerald-600 flex items-center gap-1",children:["",ne.consultationFee.toLocaleString()]}),p.jsxs("p",{className:"text-xs text-muted-foreground",children:[Math.floor(ne.consultationFee*.01)," coins"]})]})]})},ne.id))})]}),s&&p.jsx("div",{className:"p-4 bg-emerald-50 border border-emerald-200 rounded-lg",children:p.jsxs("div",{className:"flex items-center justify-between",children:[p.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Your Masjid Coin Balance:"}),p.jsxs("span",{className:"text-lg font-bold text-emerald-600",children:[" ",W.toLocaleString()," coins"]})]})}),m&&p.jsxs(p.Fragment,{children:[p.jsxs("div",{children:[p.jsx("label",{className:"block text-sm font-medium mb-2",children:"Consultation Topic"}),p.jsx(er,{type:"text",value:w,onChange:ne=>C(ne.target.value),placeholder:"Brief description of what you'd like to discuss..."})]}),p.jsx("div",{className:"p-4 bg-blue-50 border border-blue-200 rounded-lg",children:p.jsxs("p",{className:"text-sm text-blue-900",children:[" This will start an instant consultation with ",m.name,". Duration: ",m.consultationDuration||30," minutes"]})})]}),Q&&p.jsx("div",{className:"p-3 bg-destructive/10 border border-destructive rounded-md",children:p.jsx("p",{className:"text-sm text-destructive",children:Q})}),p.jsx(Re,{onClick:ce,disabled:B||!m||!w||!(m!=null&&m.isOnline),className:"w-full",size:"lg",children:B?"Processing...":`Start Consultation & Pay ${(m==null?void 0:m.consultationFee)||0}`})]})})]})]}):p.jsx("div",{className:"container mx-auto p-4 max-w-4xl",children:p.jsx(qe,{children:p.jsxs($e,{className:"p-8 text-center",children:[p.jsx("p",{className:"text-destructive mb-2",children:"Access Denied: Only members can book consultations."}),p.jsx("p",{className:"text-sm text-muted-foreground",children:"Scholars and imams manage consultations but cannot book them."})]})})})};/*!
 * html2canvas 1.4.1 <https://html2canvas.hertzen.com>
 * Copyright (c) 2022 Niklas von Hertzen <https://hertzen.com>
 * Released under MIT License
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var Wx=function(r,s){return Wx=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,c){a.__proto__=c}||function(a,c){for(var A in c)Object.prototype.hasOwnProperty.call(c,A)&&(a[A]=c[A])},Wx(r,s)};function rc(r,s){if(typeof s!="function"&&s!==null)throw new TypeError("Class extends value "+String(s)+" is not a constructor or null");Wx(r,s);function a(){this.constructor=r}r.prototype=s===null?Object.create(s):(a.prototype=s.prototype,new a)}function co(r,s,a,c){function A(u){return u instanceof a?u:new a(function(m){m(u)})}return new(a||(a=Promise))(function(u,m){function E(T){try{C(c.next(T))}catch(N){m(N)}}function w(T){try{C(c.throw(T))}catch(N){m(N)}}function C(T){T.done?u(T.value):A(T.value).then(E,w)}C((c=c.apply(r,[])).next())})}function wa(r,s){var a={label:0,sent:function(){if(u[0]&1)throw u[1];return u[1]},trys:[],ops:[]},c,A,u,m;return m={next:E(0),throw:E(1),return:E(2)},typeof Symbol=="function"&&(m[Symbol.iterator]=function(){return this}),m;function E(C){return function(T){return w([C,T])}}function w(C){if(c)throw new TypeError("Generator is already executing.");for(;a;)try{if(c=1,A&&(u=C[0]&2?A.return:C[0]?A.throw||((u=A.return)&&u.call(A),0):A.next)&&!(u=u.call(A,C[1])).done)return u;switch(A=0,u&&(C=[C[0]&2,u.value]),C[0]){case 0:case 1:u=C;break;case 4:return a.label++,{value:C[1],done:!1};case 5:a.label++,A=C[1],C=[0];continue;case 7:C=a.ops.pop(),a.trys.pop();continue;default:if(u=a.trys,!(u=u.length>0&&u[u.length-1])&&(C[0]===6||C[0]===2)){a=0;continue}if(C[0]===3&&(!u||C[1]>u[0]&&C[1]<u[3])){a.label=C[1];break}if(C[0]===6&&a.label<u[1]){a.label=u[1],u=C;break}if(u&&a.label<u[2]){a.label=u[2],a.ops.push(C);break}u[2]&&a.ops.pop(),a.trys.pop();continue}C=s.call(r,a)}catch(T){C=[6,T],A=0}finally{c=u=0}if(C[0]&5)throw C[1];return{value:C[0]?C[1]:void 0,done:!0}}}var Uu=function(){function r(s,a,c,A){this.left=s,this.top=a,this.width=c,this.height=A}return r.prototype.add=function(s,a,c,A){return new r(this.left+s,this.top+a,this.width+c,this.height+A)},r.fromClientRect=function(s,a){return new r(a.left+s.windowBounds.left,a.top+s.windowBounds.top,a.width,a.height)},r.fromDOMRectList=function(s,a){var c=Array.from(a).find(function(A){return A.width!==0});return c?new r(c.left+s.windowBounds.left,c.top+s.windowBounds.top,c.width,c.height):r.EMPTY},r.EMPTY=new r(0,0,0,0),r}(),CB=function(r,s){return Uu.fromClientRect(r,s.getBoundingClientRect())},Nb=function(r){for(var s=[],a=0,c=r.length;a<c;){var A=r.charCodeAt(a++);if(A>=55296&&A<=56319&&a<c){var u=r.charCodeAt(a++);(u&64512)===56320?s.push(((A&1023)<<10)+(u&1023)+65536):(s.push(A),a--)}else s.push(A)}return s},ls=function(){for(var r=[],s=0;s<arguments.length;s++)r[s]=arguments[s];if(String.fromCodePoint)return String.fromCodePoint.apply(String,r);var a=r.length;if(!a)return"";for(var c=[],A=-1,u="";++A<a;){var m=r[A];m<=65535?c.push(m):(m-=65536,c.push((m>>10)+55296,m%1024+56320)),(A+1===a||c.length>16384)&&(u+=String.fromCharCode.apply(String,c),c.length=0)}return u},UG="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",abe=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(var Ey=0;Ey<UG.length;Ey++)abe[UG.charCodeAt(Ey)]=Ey;var PG="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Ng=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(var vy=0;vy<PG.length;vy++)Ng[PG.charCodeAt(vy)]=vy;var obe=function(r){var s=r.length*.75,a=r.length,c,A=0,u,m,E,w;r[r.length-1]==="="&&(s--,r[r.length-2]==="="&&s--);var C=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u"&&typeof Uint8Array.prototype.slice<"u"?new ArrayBuffer(s):new Array(s),T=Array.isArray(C)?C:new Uint8Array(C);for(c=0;c<a;c+=4)u=Ng[r.charCodeAt(c)],m=Ng[r.charCodeAt(c+1)],E=Ng[r.charCodeAt(c+2)],w=Ng[r.charCodeAt(c+3)],T[A++]=u<<2|m>>4,T[A++]=(m&15)<<4|E>>2,T[A++]=(E&3)<<6|w&63;return C},cbe=function(r){for(var s=r.length,a=[],c=0;c<s;c+=2)a.push(r[c+1]<<8|r[c]);return a},lbe=function(r){for(var s=r.length,a=[],c=0;c<s;c+=4)a.push(r[c+3]<<24|r[c+2]<<16|r[c+1]<<8|r[c]);return a},Iu=5,TB=11,cO=2,Abe=TB-Iu,kq=65536>>Iu,dbe=1<<Iu,lO=dbe-1,ube=1024>>Iu,hbe=kq+ube,pbe=hbe,fbe=32,mbe=pbe+fbe,gbe=65536>>TB,_be=1<<Abe,Ebe=_be-1,MG=function(r,s,a){return r.slice?r.slice(s,a):new Uint16Array(Array.prototype.slice.call(r,s,a))},vbe=function(r,s,a){return r.slice?r.slice(s,a):new Uint32Array(Array.prototype.slice.call(r,s,a))},ybe=function(r,s){var a=obe(r),c=Array.isArray(a)?lbe(a):new Uint32Array(a),A=Array.isArray(a)?cbe(a):new Uint16Array(a),u=24,m=MG(A,u/2,c[4]/2),E=c[5]===2?MG(A,(u+c[4])/2):vbe(c,Math.ceil((u+c[4])/4));return new wbe(c[0],c[1],c[2],c[3],m,E)},wbe=function(){function r(s,a,c,A,u,m){this.initialValue=s,this.errorValue=a,this.highStart=c,this.highValueIndex=A,this.index=u,this.data=m}return r.prototype.get=function(s){var a;if(s>=0){if(s<55296||s>56319&&s<=65535)return a=this.index[s>>Iu],a=(a<<cO)+(s&lO),this.data[a];if(s<=65535)return a=this.index[kq+(s-55296>>Iu)],a=(a<<cO)+(s&lO),this.data[a];if(s<this.highStart)return a=mbe-gbe+(s>>TB),a=this.index[a],a+=s>>Iu&Ebe,a=this.index[a],a=(a<<cO)+(s&lO),this.data[a];if(s<=1114111)return this.data[this.highValueIndex]}return this.errorValue},r}(),FG="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bbe=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(var yy=0;yy<FG.length;yy++)bbe[FG.charCodeAt(yy)]=yy;var Sbe="KwAAAAAAAAAACA4AUD0AADAgAAACAAAAAAAIABAAGABAAEgAUABYAGAAaABgAGgAYgBqAF8AZwBgAGgAcQB5AHUAfQCFAI0AlQCdAKIAqgCyALoAYABoAGAAaABgAGgAwgDKAGAAaADGAM4A0wDbAOEA6QDxAPkAAQEJAQ8BFwF1AH0AHAEkASwBNAE6AUIBQQFJAVEBWQFhAWgBcAF4ATAAgAGGAY4BlQGXAZ8BpwGvAbUBvQHFAc0B0wHbAeMB6wHxAfkBAQIJAvEBEQIZAiECKQIxAjgCQAJGAk4CVgJeAmQCbAJ0AnwCgQKJApECmQKgAqgCsAK4ArwCxAIwAMwC0wLbAjAA4wLrAvMC+AIAAwcDDwMwABcDHQMlAy0DNQN1AD0DQQNJA0kDSQNRA1EDVwNZA1kDdQB1AGEDdQBpA20DdQN1AHsDdQCBA4kDkQN1AHUAmQOhA3UAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AKYDrgN1AHUAtgO+A8YDzgPWAxcD3gPjA+sD8wN1AHUA+wMDBAkEdQANBBUEHQQlBCoEFwMyBDgEYABABBcDSARQBFgEYARoBDAAcAQzAXgEgASIBJAEdQCXBHUAnwSnBK4EtgS6BMIEyAR1AHUAdQB1AHUAdQCVANAEYABgAGAAYABgAGAAYABgANgEYADcBOQEYADsBPQE/AQEBQwFFAUcBSQFLAU0BWQEPAVEBUsFUwVbBWAAYgVgAGoFcgV6BYIFigWRBWAAmQWfBaYFYABgAGAAYABgAKoFYACxBbAFuQW6BcEFwQXHBcEFwQXPBdMF2wXjBeoF8gX6BQIGCgYSBhoGIgYqBjIGOgZgAD4GRgZMBmAAUwZaBmAAYABgAGAAYABgAGAAYABgAGAAYABgAGIGYABpBnAGYABgAGAAYABgAGAAYABgAGAAYAB4Bn8GhQZgAGAAYAB1AHcDFQSLBmAAYABgAJMGdQA9A3UAmwajBqsGqwaVALMGuwbDBjAAywbSBtIG1QbSBtIG0gbSBtIG0gbdBuMG6wbzBvsGAwcLBxMHAwcbByMHJwcsBywHMQcsB9IGOAdAB0gHTgfSBkgHVgfSBtIG0gbSBtIG0gbSBtIG0gbSBiwHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAdgAGAALAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAdbB2MHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsB2kH0gZwB64EdQB1AHUAdQB1AHUAdQB1AHUHfQdgAIUHjQd1AHUAlQedB2AAYAClB6sHYACzB7YHvgfGB3UAzgfWBzMB3gfmB1EB7gf1B/0HlQENAQUIDQh1ABUIHQglCBcDLQg1CD0IRQhNCEEDUwh1AHUAdQBbCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIcAh3CHoIMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIgggwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAALAcsBywHLAcsBywHLAcsBywHLAcsB4oILAcsB44I0gaWCJ4Ipgh1AHUAqgiyCHUAdQB1AHUAdQB1AHUAdQB1AHUAtwh8AXUAvwh1AMUIyQjRCNkI4AjoCHUAdQB1AO4I9gj+CAYJDgkTCS0HGwkjCYIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiAAIAAAAFAAYABgAGIAXwBgAHEAdQBFAJUAogCyAKAAYABgAEIA4ABGANMA4QDxAMEBDwE1AFwBLAE6AQEBUQF4QkhCmEKoQrhCgAHIQsAB0MLAAcABwAHAAeDC6ABoAHDCwMMAAcABwAHAAdDDGMMAAcAB6MM4wwjDWMNow3jDaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAEjDqABWw6bDqABpg6gAaABoAHcDvwOPA+gAaABfA/8DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DpcPAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcAB9cPKwkyCToJMAB1AHUAdQBCCUoJTQl1AFUJXAljCWcJawkwADAAMAAwAHMJdQB2CX4JdQCECYoJjgmWCXUAngkwAGAAYABxAHUApgn3A64JtAl1ALkJdQDACTAAMAAwADAAdQB1AHUAdQB1AHUAdQB1AHUAowYNBMUIMAAwADAAMADICcsJ0wnZCRUE4QkwAOkJ8An4CTAAMAB1AAAKvwh1AAgKDwoXCh8KdQAwACcKLgp1ADYKqAmICT4KRgowADAAdQB1AE4KMAB1AFYKdQBeCnUAZQowADAAMAAwADAAMAAwADAAMAAVBHUAbQowADAAdQC5CXUKMAAwAHwBxAijBogEMgF9CoQKiASMCpQKmgqIBKIKqgquCogEDQG2Cr4KxgrLCjAAMADTCtsKCgHjCusK8Qr5CgELMAAwADAAMAB1AIsECQsRC3UANAEZCzAAMAAwADAAMAB1ACELKQswAHUANAExCzkLdQBBC0kLMABRC1kLMAAwADAAMAAwADAAdQBhCzAAMAAwAGAAYABpC3ELdwt/CzAAMACHC4sLkwubC58Lpwt1AK4Ltgt1APsDMAAwADAAMAAwADAAMAAwAL4LwwvLC9IL1wvdCzAAMADlC+kL8Qv5C/8LSQswADAAMAAwADAAMAAwADAAMAAHDDAAMAAwADAAMAAODBYMHgx1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1ACYMMAAwADAAdQB1AHUALgx1AHUAdQB1AHUAdQA2DDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AD4MdQBGDHUAdQB1AHUAdQB1AEkMdQB1AHUAdQB1AFAMMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQBYDHUAdQB1AF8MMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUA+wMVBGcMMAAwAHwBbwx1AHcMfwyHDI8MMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAYABgAJcMMAAwADAAdQB1AJ8MlQClDDAAMACtDCwHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsB7UMLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AA0EMAC9DDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAsBywHLAcsBywHLAcsBywHLQcwAMEMyAwsBywHLAcsBywHLAcsBywHLAcsBywHzAwwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAHUAdQB1ANQM2QzhDDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMABgAGAAYABgAGAAYABgAOkMYADxDGAA+AwADQYNYABhCWAAYAAODTAAMAAwADAAFg1gAGAAHg37AzAAMAAwADAAYABgACYNYAAsDTQNPA1gAEMNPg1LDWAAYABgAGAAYABgAGAAYABgAGAAUg1aDYsGVglhDV0NcQBnDW0NdQ15DWAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAlQCBDZUAiA2PDZcNMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAnw2nDTAAMAAwADAAMAAwAHUArw23DTAAMAAwADAAMAAwADAAMAAwADAAMAB1AL8NMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAB1AHUAdQB1AHUAdQDHDTAAYABgAM8NMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAA1w11ANwNMAAwAD0B5A0wADAAMAAwADAAMADsDfQN/A0EDgwOFA4wABsOMAAwADAAMAAwADAAMAAwANIG0gbSBtIG0gbSBtIG0gYjDigOwQUuDsEFMw7SBjoO0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGQg5KDlIOVg7SBtIGXg5lDm0OdQ7SBtIGfQ6EDooOjQ6UDtIGmg6hDtIG0gaoDqwO0ga0DrwO0gZgAGAAYADEDmAAYAAkBtIGzA5gANIOYADaDokO0gbSBt8O5w7SBu8O0gb1DvwO0gZgAGAAxA7SBtIG0gbSBtIGYABgAGAAYAAED2AAsAUMD9IG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGFA8sBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAccD9IGLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHJA8sBywHLAcsBywHLAccDywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywPLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAc0D9IG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAccD9IG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGFA8sBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHPA/SBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gYUD0QPlQCVAJUAMAAwADAAMACVAJUAlQCVAJUAlQCVAEwPMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAA//8EAAQABAAEAAQABAAEAAQABAANAAMAAQABAAIABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQACgATABcAHgAbABoAHgAXABYAEgAeABsAGAAPABgAHABLAEsASwBLAEsASwBLAEsASwBLABgAGAAeAB4AHgATAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQABYAGwASAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAWAA0AEQAeAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAFAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAJABYAGgAbABsAGwAeAB0AHQAeAE8AFwAeAA0AHgAeABoAGwBPAE8ADgBQAB0AHQAdAE8ATwAXAE8ATwBPABYAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAFAAUABQAFAAUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAB4AHgAeAFAATwBAAE8ATwBPAEAATwBQAFAATwBQAB4AHgAeAB4AHgAeAB0AHQAdAB0AHgAdAB4ADgBQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgBQAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAJAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAkACQAJAAkACQAJAAkABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAFAAHgAeAB4AKwArAFAAUABQAFAAGABQACsAKwArACsAHgAeAFAAHgBQAFAAUAArAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAUAAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAYAA0AKwArAB4AHgAbACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQADQAEAB4ABAAEAB4ABAAEABMABAArACsAKwArACsAKwArACsAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAKwArACsAKwBWAFYAVgBWAB4AHgArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AGgAaABoAGAAYAB4AHgAEAAQABAAEAAQABAAEAAQABAAEAAQAEwAEACsAEwATAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABLAEsASwBLAEsASwBLAEsASwBLABoAGQAZAB4AUABQAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQABMAUAAEAAQABAAEAAQABAAEAB4AHgAEAAQABAAEAAQABABQAFAABAAEAB4ABAAEAAQABABQAFAASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUAAeAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAFAABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQAUABQAB4AHgAYABMAUAArACsABAAbABsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAFAABAAEAAQABAAEAFAABAAEAAQAUAAEAAQABAAEAAQAKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAArACsAHgArAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAUAAEAAQABAAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAABAAEAA0ADQBLAEsASwBLAEsASwBLAEsASwBLAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUAArACsAKwBQAFAAUABQACsAKwAEAFAABAAEAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABABQACsAKwArACsAKwArACsAKwAEACsAKwArACsAUABQACsAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAFAAUAAaABoAUABQAFAAUABQAEwAHgAbAFAAHgAEACsAKwAEAAQABAArAFAAUABQAFAAUABQACsAKwArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQACsAUABQACsAKwAEACsABAAEAAQABAAEACsAKwArACsABAAEACsAKwAEAAQABAArACsAKwAEACsAKwArACsAKwArACsAUABQAFAAUAArAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLAAQABABQAFAAUAAEAB4AKwArACsAKwArACsAKwArACsAKwAEAAQABAArAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQACsAKwAEAFAABAAEAAQABAAEAAQABAAEACsABAAEAAQAKwAEAAQABAArACsAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAB4AGwArACsAKwArACsAKwArAFAABAAEAAQABAAEAAQAKwAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABAArACsAKwArACsAKwArAAQABAAEACsAKwArACsAUABQACsAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAB4AUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArAAQAUAArAFAAUABQAFAAUABQACsAKwArAFAAUABQACsAUABQAFAAUAArACsAKwBQAFAAKwBQACsAUABQACsAKwArAFAAUAArACsAKwBQAFAAUAArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArAAQABAAEAAQABAArACsAKwAEAAQABAArAAQABAAEAAQAKwArAFAAKwArACsAKwArACsABAArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAHgAeAB4AHgAeAB4AGwAeACsAKwArACsAKwAEAAQABAAEAAQAUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAUAAEAAQABAAEAAQABAAEACsABAAEAAQAKwAEAAQABAAEACsAKwArACsAKwArACsABAAEACsAUABQAFAAKwArACsAKwArAFAAUAAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAKwAOAFAAUABQAFAAUABQAFAAHgBQAAQABAAEAA4AUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAKwArAAQAUAAEAAQABAAEAAQABAAEACsABAAEAAQAKwAEAAQABAAEACsAKwArACsAKwArACsABAAEACsAKwArACsAKwArACsAUAArAFAAUAAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwBQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAFAABAAEAAQABAAEAAQABAArAAQABAAEACsABAAEAAQABABQAB4AKwArACsAKwBQAFAAUAAEAFAAUABQAFAAUABQAFAAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAFAAUABQAFAAUABQAFAAUABQABoAUABQAFAAUABQAFAAKwAEAAQABAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQACsAUAArACsAUABQAFAAUABQAFAAUAArACsAKwAEACsAKwArACsABAAEAAQABAAEAAQAKwAEACsABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArAAQABAAeACsAKwArACsAKwArACsAKwArACsAKwArAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAAqAFwAXAAqACoAKgAqACoAKgAqACsAKwArACsAGwBcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAeAEsASwBLAEsASwBLAEsASwBLAEsADQANACsAKwArACsAKwBcAFwAKwBcACsAXABcAFwAXABcACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACsAXAArAFwAXABcAFwAXABcAFwAXABcAFwAKgBcAFwAKgAqACoAKgAqACoAKgAqACoAXAArACsAXABcAFwAXABcACsAXAArACoAKgAqACoAKgAqACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwBcAFwAXABcAFAADgAOAA4ADgAeAA4ADgAJAA4ADgANAAkAEwATABMAEwATAAkAHgATAB4AHgAeAAQABAAeAB4AHgAeAB4AHgBLAEsASwBLAEsASwBLAEsASwBLAFAAUABQAFAAUABQAFAAUABQAFAADQAEAB4ABAAeAAQAFgARABYAEQAEAAQAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQADQAEAAQABAAEAAQADQAEAAQAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArAA0ADQAeAB4AHgAeAB4AHgAEAB4AHgAeAB4AHgAeACsAHgAeAA4ADgANAA4AHgAeAB4AHgAeAAkACQArACsAKwArACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgBcAEsASwBLAEsASwBLAEsASwBLAEsADQANAB4AHgAeAB4AXABcAFwAXABcAFwAKgAqACoAKgBcAFwAXABcACoAKgAqAFwAKgAqACoAXABcACoAKgAqACoAKgAqACoAXABcAFwAKgAqACoAKgBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAqACoAKgAqAFwAKgBLAEsASwBLAEsASwBLAEsASwBLACoAKgAqACoAKgAqAFAAUABQAFAAUABQACsAUAArACsAKwArACsAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgBQAFAAUABQAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUAArACsAUABQAFAAUABQAFAAUAArAFAAKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAKwBQACsAUABQAFAAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsABAAEAAQAHgANAB4AHgAeAB4AHgAeAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUAArACsADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAANAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAWABEAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAA0ADQANAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAANAA0AKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUAArAAQABAArACsAKwArACsAKwArACsAKwArACsAKwBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqAA0ADQAVAFwADQAeAA0AGwBcACoAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwAeAB4AEwATAA0ADQAOAB4AEwATAB4ABAAEAAQACQArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUAAEAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAHgArACsAKwATABMASwBLAEsASwBLAEsASwBLAEsASwBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAArACsAXABcAFwAXABcACsAKwArACsAKwArACsAKwArACsAKwBcAFwAXABcAFwAXABcAFwAXABcAFwAXAArACsAKwArAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAXAArACsAKwAqACoAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAArACsAHgAeAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAqACoAKwAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKwArAAQASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArACoAKgAqACoAKgAqACoAXAAqACoAKgAqACoAKgArACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsABAAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABABQAFAAUABQAFAAUABQACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwANAA0AHgANAA0ADQANAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAEAAQAHgAeAB4AHgAeAB4AHgAeAB4AKwArACsABAAEAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwAeAB4AHgAeAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArAA0ADQANAA0ADQBLAEsASwBLAEsASwBLAEsASwBLACsAKwArAFAAUABQAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAA0ADQBQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUAAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArAAQABAAEAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAAQAUABQAFAAUABQAFAABABQAFAABAAEAAQAUAArACsAKwArACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsABAAEAAQABAAEAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAKwBQACsAUAArAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgBQAB4AHgAeAFAAUABQACsAHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQACsAKwAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAFAAUABQACsAHgAeAB4AHgAeAB4AHgAOAB4AKwANAA0ADQANAA0ADQANAAkADQANAA0ACAAEAAsABAAEAA0ACQANAA0ADAAdAB0AHgAXABcAFgAXABcAFwAWABcAHQAdAB4AHgAUABQAFAANAAEAAQAEAAQABAAEAAQACQAaABoAGgAaABoAGgAaABoAHgAXABcAHQAVABUAHgAeAB4AHgAeAB4AGAAWABEAFQAVABUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ADQAeAA0ADQANAA0AHgANAA0ADQAHAB4AHgAeAB4AKwAEAAQABAAEAAQABAAEAAQABAAEAFAAUAArACsATwBQAFAAUABQAFAAHgAeAB4AFgARAE8AUABPAE8ATwBPAFAAUABQAFAAUAAeAB4AHgAWABEAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArABsAGwAbABsAGwAbABsAGgAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGgAbABsAGwAbABoAGwAbABoAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAHgAeAFAAGgAeAB0AHgBQAB4AGgAeAB4AHgAeAB4AHgAeAB4AHgBPAB4AUAAbAB4AHgBQAFAAUABQAFAAHgAeAB4AHQAdAB4AUAAeAFAAHgBQAB4AUABPAFAAUAAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAHgBQAFAAUABQAE8ATwBQAFAAUABQAFAATwBQAFAATwBQAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAFAAUABQAFAATwBPAE8ATwBPAE8ATwBPAE8ATwBQAFAAUABQAFAAUABQAFAAUAAeAB4AUABQAFAAUABPAB4AHgArACsAKwArAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB4AHQAdAB4AHgAeAB0AHQAeAB4AHQAeAB4AHgAdAB4AHQAbABsAHgAdAB4AHgAeAB4AHQAeAB4AHQAdAB0AHQAeAB4AHQAeAB0AHgAdAB0AHQAdAB0AHQAeAB0AHgAeAB4AHgAeAB0AHQAdAB0AHgAeAB4AHgAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB4AHgAeAB0AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHgAeAB0AHQAdAB0AHgAeAB0AHQAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAeAB4AHgAdAB4AHgAeAB4AHgAeAB4AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABYAEQAWABEAHgAeAB4AHgAeAB4AHQAeAB4AHgAeAB4AHgAeACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAWABEAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAFAAHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAeAB4AHQAdAB0AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB4AHQAdAB4AHgAeAB4AHQAdAB4AHgAeAB4AHQAdAB0AHgAeAB0AHgAeAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlAB4AHQAdAB4AHgAdAB4AHgAeAB4AHQAdAB4AHgAeAB4AJQAlAB0AHQAlAB4AJQAlACUAIAAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAeAB4AHgAeAB0AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHgAdAB0AHQAeAB0AJQAdAB0AHgAdAB0AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAdAB0AHQAdACUAHgAlACUAJQAdACUAJQAdAB0AHQAlACUAHQAdACUAHQAdACUAJQAlAB4AHQAeAB4AHgAeAB0AHQAlAB0AHQAdAB0AHQAdACUAJQAlACUAJQAdACUAJQAgACUAHQAdACUAJQAlACUAJQAlACUAJQAeAB4AHgAlACUAIAAgACAAIAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AFwAXABcAFwAXABcAHgATABMAJQAeAB4AHgAWABEAFgARABYAEQAWABEAFgARABYAEQAWABEATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABYAEQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAWABEAFgARABYAEQAWABEAFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFgARABYAEQAWABEAFgARABYAEQAWABEAFgARABYAEQAWABEAFgARABYAEQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAWABEAFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAEAAQABAAeAB4AKwArACsAKwArABMADQANAA0AUAATAA0AUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAUAANACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAA0ADQANAA0ADQANAA0ADQAeAA0AFgANAB4AHgAXABcAHgAeABcAFwAWABEAFgARABYAEQAWABEADQANAA0ADQATAFAADQANAB4ADQANAB4AHgAeAB4AHgAMAAwADQANAA0AHgANAA0AFgANAA0ADQANAA0ADQANAA0AHgANAB4ADQANAB4AHgAeACsAKwArACsAKwArACsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwArACsAKwArACsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArAA0AEQARACUAJQBHAFcAVwAWABEAFgARABYAEQAWABEAFgARACUAJQAWABEAFgARABYAEQAWABEAFQAWABEAEQAlAFcAVwBXAFcAVwBXAFcAVwBXAAQABAAEAAQABAAEACUAVwBXAFcAVwA2ACUAJQBXAFcAVwBHAEcAJQAlACUAKwBRAFcAUQBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFEAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBRAFcAUQBXAFEAVwBXAFcAVwBXAFcAUQBXAFcAVwBXAFcAVwBRAFEAKwArAAQABAAVABUARwBHAFcAFQBRAFcAUQBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBRAFcAVwBXAFcAVwBXAFEAUQBXAFcAVwBXABUAUQBHAEcAVwArACsAKwArACsAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwAlACUAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACsAKwArACsAKwArACsAKwArACsAKwArAFEAUQBRAFEAUQBRAFEAUQBRAFEAUQBRAFEAUQBRAFEAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBPAE8ATwBPAE8ATwBPAE8AJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQAlAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAEcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAADQATAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABLAEsASwBLAEsASwBLAEsASwBLAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAABAAEAAQABAAeAAQABAAEAAQABAAEAAQABAAEAAQAHgBQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUABQAAQABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAeAA0ADQANAA0ADQArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAB4AHgAeAB4AHgAeAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAHgAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAeAB4AUABQAFAAUABQAFAAUABQAFAAUABQAAQAUABQAFAABABQAFAAUABQAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAeAB4AHgAeAAQAKwArACsAUABQAFAAUABQAFAAHgAeABoAHgArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAADgAOABMAEwArACsAKwArACsAKwArACsABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwANAA0ASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAFAAUAAeAB4AHgBQAA4AUABQAAQAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAA0ADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArAB4AWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYACsAKwArAAQAHgAeAB4AHgAeAB4ADQANAA0AHgAeAB4AHgArAFAASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArAB4AHgBcAFwAXABcAFwAKgBcAFwAXABcAFwAXABcAFwAXABcAEsASwBLAEsASwBLAEsASwBLAEsAXABcAFwAXABcACsAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArAFAAUABQAAQAUABQAFAAUABQAFAAUABQAAQABAArACsASwBLAEsASwBLAEsASwBLAEsASwArACsAHgANAA0ADQBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKgAqACoAXAAqACoAKgBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAAqAFwAKgAqACoAXABcACoAKgBcAFwAXABcAFwAKgAqAFwAKgBcACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFwAXABcACoAKgBQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAA0ADQBQAFAAUAAEAAQAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUAArACsAUABQAFAAUABQAFAAKwArAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQADQAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAVABVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBUAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVACsAKwArACsAKwArACsAKwArACsAKwArAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAKwArACsAKwBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAKwArACsAKwAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAKwArACsAKwArAFYABABWAFYAVgBWAFYAVgBWAFYAVgBWAB4AVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgArAFYAVgBWAFYAVgArAFYAKwBWAFYAKwBWAFYAKwBWAFYAVgBWAFYAVgBWAFYAVgBWAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAEQAWAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAaAB4AKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAGAARABEAGAAYABMAEwAWABEAFAArACsAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACUAJQAlACUAJQAWABEAFgARABYAEQAWABEAFgARABYAEQAlACUAFgARACUAJQAlACUAJQAlACUAEQAlABEAKwAVABUAEwATACUAFgARABYAEQAWABEAJQAlACUAJQAlACUAJQAlACsAJQAbABoAJQArACsAKwArAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAcAKwATACUAJQAbABoAJQAlABYAEQAlACUAEQAlABEAJQBXAFcAVwBXAFcAVwBXAFcAVwBXABUAFQAlACUAJQATACUAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXABYAJQARACUAJQAlAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAWACUAEQAlABYAEQARABYAEQARABUAVwBRAFEAUQBRAFEAUQBRAFEAUQBRAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAEcARwArACsAVwBXAFcAVwBXAFcAKwArAFcAVwBXAFcAVwBXACsAKwBXAFcAVwBXAFcAVwArACsAVwBXAFcAKwArACsAGgAbACUAJQAlABsAGwArAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwAEAAQABAAQAB0AKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsADQANAA0AKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAB4AHgAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAAQAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAA0AUABQAFAAUAArACsAKwArAFAAUABQAFAAUABQAFAAUAANAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwAeACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAKwArAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUAArACsAKwBQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwANAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAB4AUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAUABQAFAAUABQAAQABAAEACsABAAEACsAKwArACsAKwAEAAQABAAEAFAAUABQAFAAKwBQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEACsAKwArACsABABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAA0ADQANAA0ADQANAA0ADQAeACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAArACsAKwArAFAAUABQAFAAUAANAA0ADQANAA0ADQAUACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsADQANAA0ADQANAA0ADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAAQABAAEAAQAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUAArAAQABAANACsAKwBQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAB4AHgAeAB4AHgArACsAKwArACsAKwAEAAQABAAEAAQABAAEAA0ADQAeAB4AHgAeAB4AKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgANAA0ADQANACsAKwArACsAKwArACsAKwArACsAKwAeACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsASwBLAEsASwBLAEsASwBLAEsASwANAA0ADQANAFAABAAEAFAAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAeAA4AUAArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAADQANAB4ADQAEAAQABAAEAB4ABAAEAEsASwBLAEsASwBLAEsASwBLAEsAUAAOAFAADQANAA0AKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAANAA0AHgANAA0AHgAEACsAUABQAFAAUABQAFAAUAArAFAAKwBQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAA0AKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsABAAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQACsABAAEAFAABAAEAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABAArACsAUAArACsAKwArACsAKwAEACsAKwArACsAKwBQAFAAUABQAFAABAAEACsAKwAEAAQABAAEAAQABAAEACsAKwArAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwArACsABAAEAAQABAAEAAQABABQAFAAUABQAA0ADQANAA0AHgBLAEsASwBLAEsASwBLAEsASwBLAA0ADQArAB4ABABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAAQABAAEAFAAUAAeAFAAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAArACsABAAEAAQABAAEAAQABAAEAAQADgANAA0AEwATAB4AHgAeAA0ADQANAA0ADQANAA0ADQANAA0ADQANAA0ADQANAFAAUABQAFAABAAEACsAKwAEAA0ADQAeAFAAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKwArACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBcAFwADQANAA0AKgBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAKwArAFAAKwArAFAAUABQAFAAUABQAFAAUAArAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQAKwAEAAQAKwArAAQABAAEAAQAUAAEAFAABAAEAA0ADQANACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAArACsABAAEAAQABAAEAAQABABQAA4AUAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAFAABAAEAAQABAAOAB4ADQANAA0ADQAOAB4ABAArACsAKwArACsAKwArACsAUAAEAAQABAAEAAQABAAEAAQABAAEAAQAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAA0ADQANAFAADgAOAA4ADQANACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEACsABAAEAAQABAAEAAQABAAEAFAADQANAA0ADQANACsAKwArACsAKwArACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwAOABMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAArACsAKwAEACsABAAEACsABAAEAAQABAAEAAQABABQAAQAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAKwBQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQAKwAEAAQAKwAEAAQABAAEAAQAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAaABoAGgAaAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsADQANAA0ADQANACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAASABIAEgAQwBDAEMAUABQAFAAUABDAFAAUABQAEgAQwBIAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAASABDAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwAJAAkACQAJAAkACQAJABYAEQArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABIAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwANAA0AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEAAQABAANACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAA0ADQANAB4AHgAeAB4AHgAeAFAAUABQAFAADQAeACsAKwArACsAKwArACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAANAA0AHgAeACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwAEAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAARwBHABUARwAJACsAKwArACsAKwArACsAKwArACsAKwAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACsAKwArACsAKwArACsAKwBXAFcAVwBXAFcAVwBXAFcAVwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUQBRAFEAKwArACsAKwArACsAKwArACsAKwArACsAKwBRAFEAUQBRACsAKwArACsAKwArACsAKwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUAArACsAHgAEAAQADQAEAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArAB4AHgAeAB4AHgAeAB4AKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAAQABAAEAAQABAAeAB4AHgAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAB4AHgAEAAQABAAEAAQABAAEAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQAHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwBQAFAAKwArAFAAKwArAFAAUAArACsAUABQAFAAUAArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAUAArAFAAUABQAFAAUABQAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAHgAeAFAAUABQAFAAUAArAFAAKwArACsAUABQAFAAUABQAFAAUAArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeACsAKwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4ABAAeAB4AHgAeAB4AHgAeAB4AHgAeAAQAHgAeAA0ADQANAA0AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAAQABAAEAAQAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArAAQABAAEAAQABAAEAAQAKwAEAAQAKwAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwAEAAQABAAEAAQABAAEAFAAUABQAFAAUABQAFAAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwBQAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArABsAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArAB4AHgAeAB4ABAAEAAQABAAEAAQABABQACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArABYAFgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAGgBQAFAAUAAaAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAKwBQACsAKwBQACsAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwBQACsAUAArACsAKwArACsAKwBQACsAKwArACsAUAArAFAAKwBQACsAUABQAFAAKwBQAFAAKwBQACsAKwBQACsAUAArAFAAKwBQACsAUAArAFAAUAArAFAAKwArAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUAArAFAAUABQAFAAKwBQACsAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAUABQAFAAKwBQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8AJQAlACUAHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB4AHgAeACUAJQAlAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAJQAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlAB4AHgAlACUAJQAlACUAHgAlACUAJQAlACUAIAAgACAAJQAlACAAJQAlACAAIAAgACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACEAIQAhACEAIQAlACUAIAAgACUAJQAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlACUAIAAlACUAJQAlACAAIAAgACUAIAAgACAAJQAlACUAJQAlACUAJQAgACUAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAlAB4AJQAeACUAJQAlACUAJQAgACUAJQAlACUAHgAlAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAJQAlACUAJQAgACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACAAIAAgACUAJQAlACAAIAAgACAAIAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABcAFwAXABUAFQAVAB4AHgAeAB4AJQAlACUAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAgACUAJQAlACUAJQAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAgACUAJQAgACUAJQAlACUAJQAlACUAJQAgACAAIAAgACAAIAAgACAAJQAlACUAJQAlACUAIAAlACUAJQAlACUAJQAlACUAJQAgACAAIAAgACAAIAAgACAAIAAgACUAJQAgACAAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAgACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAlACAAIAAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAgACAAIAAlACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwArAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACUAVwBXACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAA==",jG=50,Cbe=1,Lq=2,Uq=3,Tbe=4,Rbe=5,VG=7,Pq=8,QG=9,BA=10,Yx=11,HG=12,zx=13,Ibe=14,Og=15,qx=16,wy=17,_g=18,Nbe=19,GG=20,Xx=21,Eg=22,AO=23,Ep=24,ba=25,xg=26,Dg=27,vp=28,Obe=29,Eu=30,xbe=31,by=32,Sy=33,Jx=34,$x=35,Zx=36,R_=37,eD=38,rw=39,sw=40,dO=41,Mq=42,Dbe=43,Bbe=[9001,65288],Fq="!",In="",Cy="",tD=ybe(Sbe),cl=[Eu,Zx],nD=[Cbe,Lq,Uq,Rbe],jq=[BA,Pq],KG=[Dg,xg],kbe=nD.concat(jq),WG=[eD,rw,sw,Jx,$x],Lbe=[Og,zx],Ube=function(r,s){s===void 0&&(s="strict");var a=[],c=[],A=[];return r.forEach(function(u,m){var E=tD.get(u);if(E>jG?(A.push(!0),E-=jG):A.push(!1),["normal","auto","loose"].indexOf(s)!==-1&&[8208,8211,12316,12448].indexOf(u)!==-1)return c.push(m),a.push(qx);if(E===Tbe||E===Yx){if(m===0)return c.push(m),a.push(Eu);var w=a[m-1];return kbe.indexOf(w)===-1?(c.push(c[m-1]),a.push(w)):(c.push(m),a.push(Eu))}if(c.push(m),E===xbe)return a.push(s==="strict"?Xx:R_);if(E===Mq||E===Obe)return a.push(Eu);if(E===Dbe)return u>=131072&&u<=196605||u>=196608&&u<=262141?a.push(R_):a.push(Eu);a.push(E)}),[c,a,A]},uO=function(r,s,a,c){var A=c[a];if(Array.isArray(r)?r.indexOf(A)!==-1:r===A)for(var u=a;u<=c.length;){u++;var m=c[u];if(m===s)return!0;if(m!==BA)break}if(A===BA)for(var u=a;u>0;){u--;var E=c[u];if(Array.isArray(r)?r.indexOf(E)!==-1:r===E)for(var w=a;w<=c.length;){w++;var m=c[w];if(m===s)return!0;if(m!==BA)break}if(E!==BA)break}return!1},YG=function(r,s){for(var a=r;a>=0;){var c=s[a];if(c===BA)a--;else return c}return 0},Pbe=function(r,s,a,c,A){if(a[c]===0)return In;var u=c-1;if(Array.isArray(A)&&A[u]===!0)return In;var m=u-1,E=u+1,w=s[u],C=m>=0?s[m]:0,T=s[E];if(w===Lq&&T===Uq)return In;if(nD.indexOf(w)!==-1)return Fq;if(nD.indexOf(T)!==-1||jq.indexOf(T)!==-1)return In;if(YG(u,s)===Pq)return Cy;if(tD.get(r[u])===Yx||(w===by||w===Sy)&&tD.get(r[E])===Yx||w===VG||T===VG||w===QG||[BA,zx,Og].indexOf(w)===-1&&T===QG||[wy,_g,Nbe,Ep,vp].indexOf(T)!==-1||YG(u,s)===Eg||uO(AO,Eg,u,s)||uO([wy,_g],Xx,u,s)||uO(HG,HG,u,s))return In;if(w===BA)return Cy;if(w===AO||T===AO)return In;if(T===qx||w===qx)return Cy;if([zx,Og,Xx].indexOf(T)!==-1||w===Ibe||C===Zx&&Lbe.indexOf(w)!==-1||w===vp&&T===Zx||T===GG||cl.indexOf(T)!==-1&&w===ba||cl.indexOf(w)!==-1&&T===ba||w===Dg&&[R_,by,Sy].indexOf(T)!==-1||[R_,by,Sy].indexOf(w)!==-1&&T===xg||cl.indexOf(w)!==-1&&KG.indexOf(T)!==-1||KG.indexOf(w)!==-1&&cl.indexOf(T)!==-1||[Dg,xg].indexOf(w)!==-1&&(T===ba||[Eg,Og].indexOf(T)!==-1&&s[E+1]===ba)||[Eg,Og].indexOf(w)!==-1&&T===ba||w===ba&&[ba,vp,Ep].indexOf(T)!==-1)return In;if([ba,vp,Ep,wy,_g].indexOf(T)!==-1)for(var N=u;N>=0;){var B=s[N];if(B===ba)return In;if([vp,Ep].indexOf(B)!==-1)N--;else break}if([Dg,xg].indexOf(T)!==-1)for(var N=[wy,_g].indexOf(w)!==-1?m:u;N>=0;){var B=s[N];if(B===ba)return In;if([vp,Ep].indexOf(B)!==-1)N--;else break}if(eD===w&&[eD,rw,Jx,$x].indexOf(T)!==-1||[rw,Jx].indexOf(w)!==-1&&[rw,sw].indexOf(T)!==-1||[sw,$x].indexOf(w)!==-1&&T===sw||WG.indexOf(w)!==-1&&[GG,xg].indexOf(T)!==-1||WG.indexOf(T)!==-1&&w===Dg||cl.indexOf(w)!==-1&&cl.indexOf(T)!==-1||w===Ep&&cl.indexOf(T)!==-1||cl.concat(ba).indexOf(w)!==-1&&T===Eg&&Bbe.indexOf(r[E])===-1||cl.concat(ba).indexOf(T)!==-1&&w===_g)return In;if(w===dO&&T===dO){for(var k=a[u],Q=1;k>0&&(k--,s[k]===dO);)Q++;if(Q%2!==0)return In}return w===by&&T===Sy?In:Cy},Mbe=function(r,s){s||(s={lineBreak:"normal",wordBreak:"normal"});var a=Ube(r,s.lineBreak),c=a[0],A=a[1],u=a[2];(s.wordBreak==="break-all"||s.wordBreak==="break-word")&&(A=A.map(function(E){return[ba,Eu,Mq].indexOf(E)!==-1?R_:E}));var m=s.wordBreak==="keep-all"?u.map(function(E,w){return E&&r[w]>=19968&&r[w]<=40959}):void 0;return[c,A,m]},Fbe=function(){function r(s,a,c,A){this.codePoints=s,this.required=a===Fq,this.start=c,this.end=A}return r.prototype.slice=function(){return ls.apply(void 0,this.codePoints.slice(this.start,this.end))},r}(),jbe=function(r,s){var a=Nb(r),c=Mbe(a,s),A=c[0],u=c[1],m=c[2],E=a.length,w=0,C=0;return{next:function(){if(C>=E)return{done:!0,value:null};for(var T=In;C<E&&(T=Pbe(a,u,A,++C,m))===In;);if(T!==In||C===E){var N=new Fbe(a,T,w,C);return w=C,{value:N,done:!1}}return{done:!0,value:null}}}},Vbe=1,Qbe=2,K_=4,zG=8,qw=10,qG=47,Zg=92,Hbe=9,Gbe=32,Ty=34,vg=61,Kbe=35,Wbe=36,Ybe=37,Ry=39,Iy=40,yg=41,zbe=95,na=45,qbe=33,Xbe=60,Jbe=62,$be=64,Zbe=91,eSe=93,tSe=61,nSe=123,Ny=63,rSe=125,XG=124,sSe=126,iSe=128,JG=65533,hO=42,yu=43,aSe=44,oSe=58,cSe=59,I_=46,lSe=0,ASe=8,dSe=11,uSe=14,hSe=31,pSe=127,Oc=-1,Vq=48,Qq=97,Hq=101,fSe=102,mSe=117,gSe=122,Gq=65,Kq=69,Wq=70,_Se=85,ESe=90,Ei=function(r){return r>=Vq&&r<=57},vSe=function(r){return r>=55296&&r<=57343},yp=function(r){return Ei(r)||r>=Gq&&r<=Wq||r>=Qq&&r<=fSe},ySe=function(r){return r>=Qq&&r<=gSe},wSe=function(r){return r>=Gq&&r<=ESe},bSe=function(r){return ySe(r)||wSe(r)},SSe=function(r){return r>=iSe},Oy=function(r){return r===qw||r===Hbe||r===Gbe},Xw=function(r){return bSe(r)||SSe(r)||r===zbe},$G=function(r){return Xw(r)||Ei(r)||r===na},CSe=function(r){return r>=lSe&&r<=ASe||r===dSe||r>=uSe&&r<=hSe||r===pSe},vA=function(r,s){return r!==Zg?!1:s!==qw},xy=function(r,s,a){return r===na?Xw(s)||vA(s,a):Xw(r)?!0:!!(r===Zg&&vA(r,s))},pO=function(r,s,a){return r===yu||r===na?Ei(s)?!0:s===I_&&Ei(a):Ei(r===I_?s:r)},TSe=function(r){var s=0,a=1;(r[s]===yu||r[s]===na)&&(r[s]===na&&(a=-1),s++);for(var c=[];Ei(r[s]);)c.push(r[s++]);var A=c.length?parseInt(ls.apply(void 0,c),10):0;r[s]===I_&&s++;for(var u=[];Ei(r[s]);)u.push(r[s++]);var m=u.length,E=m?parseInt(ls.apply(void 0,u),10):0;(r[s]===Kq||r[s]===Hq)&&s++;var w=1;(r[s]===yu||r[s]===na)&&(r[s]===na&&(w=-1),s++);for(var C=[];Ei(r[s]);)C.push(r[s++]);var T=C.length?parseInt(ls.apply(void 0,C),10):0;return a*(A+E*Math.pow(10,-m))*Math.pow(10,w*T)},RSe={type:2},ISe={type:3},NSe={type:4},OSe={type:13},xSe={type:8},DSe={type:21},BSe={type:9},kSe={type:10},LSe={type:11},USe={type:12},PSe={type:14},Dy={type:23},MSe={type:1},FSe={type:25},jSe={type:24},VSe={type:26},QSe={type:27},HSe={type:28},GSe={type:29},KSe={type:31},rD={type:32},Yq=function(){function r(){this._value=[]}return r.prototype.write=function(s){this._value=this._value.concat(Nb(s))},r.prototype.read=function(){for(var s=[],a=this.consumeToken();a!==rD;)s.push(a),a=this.consumeToken();return s},r.prototype.consumeToken=function(){var s=this.consumeCodePoint();switch(s){case Ty:return this.consumeStringToken(Ty);case Kbe:var a=this.peekCodePoint(0),c=this.peekCodePoint(1),A=this.peekCodePoint(2);if($G(a)||vA(c,A)){var u=xy(a,c,A)?Qbe:Vbe,m=this.consumeName();return{type:5,value:m,flags:u}}break;case Wbe:if(this.peekCodePoint(0)===vg)return this.consumeCodePoint(),OSe;break;case Ry:return this.consumeStringToken(Ry);case Iy:return RSe;case yg:return ISe;case hO:if(this.peekCodePoint(0)===vg)return this.consumeCodePoint(),PSe;break;case yu:if(pO(s,this.peekCodePoint(0),this.peekCodePoint(1)))return this.reconsumeCodePoint(s),this.consumeNumericToken();break;case aSe:return NSe;case na:var E=s,w=this.peekCodePoint(0),C=this.peekCodePoint(1);if(pO(E,w,C))return this.reconsumeCodePoint(s),this.consumeNumericToken();if(xy(E,w,C))return this.reconsumeCodePoint(s),this.consumeIdentLikeToken();if(w===na&&C===Jbe)return this.consumeCodePoint(),this.consumeCodePoint(),jSe;break;case I_:if(pO(s,this.peekCodePoint(0),this.peekCodePoint(1)))return this.reconsumeCodePoint(s),this.consumeNumericToken();break;case qG:if(this.peekCodePoint(0)===hO)for(this.consumeCodePoint();;){var T=this.consumeCodePoint();if(T===hO&&(T=this.consumeCodePoint(),T===qG))return this.consumeToken();if(T===Oc)return this.consumeToken()}break;case oSe:return VSe;case cSe:return QSe;case Xbe:if(this.peekCodePoint(0)===qbe&&this.peekCodePoint(1)===na&&this.peekCodePoint(2)===na)return this.consumeCodePoint(),this.consumeCodePoint(),FSe;break;case $be:var N=this.peekCodePoint(0),B=this.peekCodePoint(1),k=this.peekCodePoint(2);if(xy(N,B,k)){var m=this.consumeName();return{type:7,value:m}}break;case Zbe:return HSe;case Zg:if(vA(s,this.peekCodePoint(0)))return this.reconsumeCodePoint(s),this.consumeIdentLikeToken();break;case eSe:return GSe;case tSe:if(this.peekCodePoint(0)===vg)return this.consumeCodePoint(),xSe;break;case nSe:return LSe;case rSe:return USe;case mSe:case _Se:var Q=this.peekCodePoint(0),K=this.peekCodePoint(1);return Q===yu&&(yp(K)||K===Ny)&&(this.consumeCodePoint(),this.consumeUnicodeRangeToken()),this.reconsumeCodePoint(s),this.consumeIdentLikeToken();case XG:if(this.peekCodePoint(0)===vg)return this.consumeCodePoint(),BSe;if(this.peekCodePoint(0)===XG)return this.consumeCodePoint(),DSe;break;case sSe:if(this.peekCodePoint(0)===vg)return this.consumeCodePoint(),kSe;break;case Oc:return rD}return Oy(s)?(this.consumeWhiteSpace(),KSe):Ei(s)?(this.reconsumeCodePoint(s),this.consumeNumericToken()):Xw(s)?(this.reconsumeCodePoint(s),this.consumeIdentLikeToken()):{type:6,value:ls(s)}},r.prototype.consumeCodePoint=function(){var s=this._value.shift();return typeof s>"u"?-1:s},r.prototype.reconsumeCodePoint=function(s){this._value.unshift(s)},r.prototype.peekCodePoint=function(s){return s>=this._value.length?-1:this._value[s]},r.prototype.consumeUnicodeRangeToken=function(){for(var s=[],a=this.consumeCodePoint();yp(a)&&s.length<6;)s.push(a),a=this.consumeCodePoint();for(var c=!1;a===Ny&&s.length<6;)s.push(a),a=this.consumeCodePoint(),c=!0;if(c){var A=parseInt(ls.apply(void 0,s.map(function(w){return w===Ny?Vq:w})),16),u=parseInt(ls.apply(void 0,s.map(function(w){return w===Ny?Wq:w})),16);return{type:30,start:A,end:u}}var m=parseInt(ls.apply(void 0,s),16);if(this.peekCodePoint(0)===na&&yp(this.peekCodePoint(1))){this.consumeCodePoint(),a=this.consumeCodePoint();for(var E=[];yp(a)&&E.length<6;)E.push(a),a=this.consumeCodePoint();var u=parseInt(ls.apply(void 0,E),16);return{type:30,start:m,end:u}}else return{type:30,start:m,end:m}},r.prototype.consumeIdentLikeToken=function(){var s=this.consumeName();return s.toLowerCase()==="url"&&this.peekCodePoint(0)===Iy?(this.consumeCodePoint(),this.consumeUrlToken()):this.peekCodePoint(0)===Iy?(this.consumeCodePoint(),{type:19,value:s}):{type:20,value:s}},r.prototype.consumeUrlToken=function(){var s=[];if(this.consumeWhiteSpace(),this.peekCodePoint(0)===Oc)return{type:22,value:""};var a=this.peekCodePoint(0);if(a===Ry||a===Ty){var c=this.consumeStringToken(this.consumeCodePoint());return c.type===0&&(this.consumeWhiteSpace(),this.peekCodePoint(0)===Oc||this.peekCodePoint(0)===yg)?(this.consumeCodePoint(),{type:22,value:c.value}):(this.consumeBadUrlRemnants(),Dy)}for(;;){var A=this.consumeCodePoint();if(A===Oc||A===yg)return{type:22,value:ls.apply(void 0,s)};if(Oy(A))return this.consumeWhiteSpace(),this.peekCodePoint(0)===Oc||this.peekCodePoint(0)===yg?(this.consumeCodePoint(),{type:22,value:ls.apply(void 0,s)}):(this.consumeBadUrlRemnants(),Dy);if(A===Ty||A===Ry||A===Iy||CSe(A))return this.consumeBadUrlRemnants(),Dy;if(A===Zg)if(vA(A,this.peekCodePoint(0)))s.push(this.consumeEscapedCodePoint());else return this.consumeBadUrlRemnants(),Dy;else s.push(A)}},r.prototype.consumeWhiteSpace=function(){for(;Oy(this.peekCodePoint(0));)this.consumeCodePoint()},r.prototype.consumeBadUrlRemnants=function(){for(;;){var s=this.consumeCodePoint();if(s===yg||s===Oc)return;vA(s,this.peekCodePoint(0))&&this.consumeEscapedCodePoint()}},r.prototype.consumeStringSlice=function(s){for(var a=5e4,c="";s>0;){var A=Math.min(a,s);c+=ls.apply(void 0,this._value.splice(0,A)),s-=A}return this._value.shift(),c},r.prototype.consumeStringToken=function(s){var a="",c=0;do{var A=this._value[c];if(A===Oc||A===void 0||A===s)return a+=this.consumeStringSlice(c),{type:0,value:a};if(A===qw)return this._value.splice(0,c),MSe;if(A===Zg){var u=this._value[c+1];u!==Oc&&u!==void 0&&(u===qw?(a+=this.consumeStringSlice(c),c=-1,this._value.shift()):vA(A,u)&&(a+=this.consumeStringSlice(c),a+=ls(this.consumeEscapedCodePoint()),c=-1))}c++}while(!0)},r.prototype.consumeNumber=function(){var s=[],a=K_,c=this.peekCodePoint(0);for((c===yu||c===na)&&s.push(this.consumeCodePoint());Ei(this.peekCodePoint(0));)s.push(this.consumeCodePoint());c=this.peekCodePoint(0);var A=this.peekCodePoint(1);if(c===I_&&Ei(A))for(s.push(this.consumeCodePoint(),this.consumeCodePoint()),a=zG;Ei(this.peekCodePoint(0));)s.push(this.consumeCodePoint());c=this.peekCodePoint(0),A=this.peekCodePoint(1);var u=this.peekCodePoint(2);if((c===Kq||c===Hq)&&((A===yu||A===na)&&Ei(u)||Ei(A)))for(s.push(this.consumeCodePoint(),this.consumeCodePoint()),a=zG;Ei(this.peekCodePoint(0));)s.push(this.consumeCodePoint());return[TSe(s),a]},r.prototype.consumeNumericToken=function(){var s=this.consumeNumber(),a=s[0],c=s[1],A=this.peekCodePoint(0),u=this.peekCodePoint(1),m=this.peekCodePoint(2);if(xy(A,u,m)){var E=this.consumeName();return{type:15,number:a,flags:c,unit:E}}return A===Ybe?(this.consumeCodePoint(),{type:16,number:a,flags:c}):{type:17,number:a,flags:c}},r.prototype.consumeEscapedCodePoint=function(){var s=this.consumeCodePoint();if(yp(s)){for(var a=ls(s);yp(this.peekCodePoint(0))&&a.length<6;)a+=ls(this.consumeCodePoint());Oy(this.peekCodePoint(0))&&this.consumeCodePoint();var c=parseInt(a,16);return c===0||vSe(c)||c>1114111?JG:c}return s===Oc?JG:s},r.prototype.consumeName=function(){for(var s="";;){var a=this.consumeCodePoint();if($G(a))s+=ls(a);else if(vA(a,this.peekCodePoint(0)))s+=ls(this.consumeEscapedCodePoint());else return this.reconsumeCodePoint(a),s}},r}(),zq=function(){function r(s){this._tokens=s}return r.create=function(s){var a=new Yq;return a.write(s),new r(a.read())},r.parseValue=function(s){return r.create(s).parseComponentValue()},r.parseValues=function(s){return r.create(s).parseComponentValues()},r.prototype.parseComponentValue=function(){for(var s=this.consumeToken();s.type===31;)s=this.consumeToken();if(s.type===32)throw new SyntaxError("Error parsing CSS component value, unexpected EOF");this.reconsumeToken(s);var a=this.consumeComponentValue();do s=this.consumeToken();while(s.type===31);if(s.type===32)return a;throw new SyntaxError("Error parsing CSS component value, multiple values found when expecting only one")},r.prototype.parseComponentValues=function(){for(var s=[];;){var a=this.consumeComponentValue();if(a.type===32)return s;s.push(a),s.push()}},r.prototype.consumeComponentValue=function(){var s=this.consumeToken();switch(s.type){case 11:case 28:case 2:return this.consumeSimpleBlock(s.type);case 19:return this.consumeFunction(s)}return s},r.prototype.consumeSimpleBlock=function(s){for(var a={type:s,values:[]},c=this.consumeToken();;){if(c.type===32||WSe(c,s))return a;this.reconsumeToken(c),a.values.push(this.consumeComponentValue()),c=this.consumeToken()}},r.prototype.consumeFunction=function(s){for(var a={name:s.value,values:[],type:18};;){var c=this.consumeToken();if(c.type===32||c.type===3)return a;this.reconsumeToken(c),a.values.push(this.consumeComponentValue())}},r.prototype.consumeToken=function(){var s=this._tokens.shift();return typeof s>"u"?rD:s},r.prototype.reconsumeToken=function(s){this._tokens.unshift(s)},r}(),W_=function(r){return r.type===15},Ob=function(r){return r.type===17},rs=function(r){return r.type===20},sD=function(r,s){return rs(r)&&r.value===s},xb=function(r){return r.type!==31&&r.type!==4},Mc=function(r){var s=[],a=[];return r.forEach(function(c){if(c.type===4){if(a.length===0)throw new Error("Error parsing function args, zero tokens for arg");s.push(a),a=[];return}c.type!==31&&a.push(c)}),a.length&&s.push(a),s},WSe=function(r,s){return s===11&&r.type===12||s===28&&r.type===29?!0:s===2&&r.type===3},JA=function(r){return r.type===17||r.type===15},ws=function(r){return r.type===16||JA(r)},qq=function(r){return r.length>1?[r[0],r[1]]:[r[0]]},li={type:17,number:0,flags:K_},RB={type:16,number:50,flags:K_},kA={type:16,number:100,flags:K_},Bg=function(r,s,a){var c=r[0],A=r[1];return[Er(c,s),Er(typeof A<"u"?A:c,a)]},Er=function(r,s){if(r.type===16)return r.number/100*s;if(W_(r))switch(r.unit){case"rem":case"em":return 16*r.number;case"px":default:return r.number}return r.number},Xq="deg",Jq="grad",$q="rad",Zq="turn",Db={name:"angle",parse:function(r,s){if(s.type===15)switch(s.unit){case Xq:return Math.PI*s.number/180;case Jq:return Math.PI/200*s.number;case $q:return s.number;case Zq:return Math.PI*2*s.number}throw new Error("Unsupported angle type")}},e9=function(r){return r.type===15&&(r.unit===Xq||r.unit===Jq||r.unit===$q||r.unit===Zq)},t9=function(r){var s=r.filter(rs).map(function(a){return a.value}).join(" ");switch(s){case"to bottom right":case"to right bottom":case"left top":case"top left":return[li,li];case"to top":case"bottom":return Eo(0);case"to bottom left":case"to left bottom":case"right top":case"top right":return[li,kA];case"to right":case"left":return Eo(90);case"to top left":case"to left top":case"right bottom":case"bottom right":return[kA,kA];case"to bottom":case"top":return Eo(180);case"to top right":case"to right top":case"left bottom":case"bottom left":return[kA,li];case"to left":case"right":return Eo(270)}return 0},Eo=function(r){return Math.PI*r/180},KA={name:"color",parse:function(r,s){if(s.type===18){var a=YSe[s.name];if(typeof a>"u")throw new Error('Attempting to parse an unsupported color function "'+s.name+'"');return a(r,s.values)}if(s.type===5){if(s.value.length===3){var c=s.value.substring(0,1),A=s.value.substring(1,2),u=s.value.substring(2,3);return LA(parseInt(c+c,16),parseInt(A+A,16),parseInt(u+u,16),1)}if(s.value.length===4){var c=s.value.substring(0,1),A=s.value.substring(1,2),u=s.value.substring(2,3),m=s.value.substring(3,4);return LA(parseInt(c+c,16),parseInt(A+A,16),parseInt(u+u,16),parseInt(m+m,16)/255)}if(s.value.length===6){var c=s.value.substring(0,2),A=s.value.substring(2,4),u=s.value.substring(4,6);return LA(parseInt(c,16),parseInt(A,16),parseInt(u,16),1)}if(s.value.length===8){var c=s.value.substring(0,2),A=s.value.substring(2,4),u=s.value.substring(4,6),m=s.value.substring(6,8);return LA(parseInt(c,16),parseInt(A,16),parseInt(u,16),parseInt(m,16)/255)}}if(s.type===20){var E=N_[s.value.toUpperCase()];if(typeof E<"u")return E}return N_.TRANSPARENT}},tf=function(r){return(255&r)===0},Qs=function(r){var s=255&r,a=255&r>>8,c=255&r>>16,A=255&r>>24;return s<255?"rgba("+A+","+c+","+a+","+s/255+")":"rgb("+A+","+c+","+a+")"},LA=function(r,s,a,c){return(r<<24|s<<16|a<<8|Math.round(c*255)<<0)>>>0},ZG=function(r,s){if(r.type===17)return r.number;if(r.type===16){var a=s===3?1:255;return s===3?r.number/100*a:Math.round(r.number/100*a)}return 0},eK=function(r,s){var a=s.filter(xb);if(a.length===3){var c=a.map(ZG),A=c[0],u=c[1],m=c[2];return LA(A,u,m,1)}if(a.length===4){var E=a.map(ZG),A=E[0],u=E[1],m=E[2],w=E[3];return LA(A,u,m,w)}return 0};function fO(r,s,a){return a<0&&(a+=1),a>=1&&(a-=1),a<1/6?(s-r)*a*6+r:a<1/2?s:a<2/3?(s-r)*6*(2/3-a)+r:r}var tK=function(r,s){var a=s.filter(xb),c=a[0],A=a[1],u=a[2],m=a[3],E=(c.type===17?Eo(c.number):Db.parse(r,c))/(Math.PI*2),w=ws(A)?A.number/100:0,C=ws(u)?u.number/100:0,T=typeof m<"u"&&ws(m)?Er(m,1):1;if(w===0)return LA(C*255,C*255,C*255,1);var N=C<=.5?C*(w+1):C+w-C*w,B=C*2-N,k=fO(B,N,E+1/3),Q=fO(B,N,E),K=fO(B,N,E-1/3);return LA(k*255,Q*255,K*255,T)},YSe={hsl:tK,hsla:tK,rgb:eK,rgba:eK},nK=function(r,s){return KA.parse(r,zq.create(s).parseComponentValue())},N_={ALICEBLUE:4042850303,ANTIQUEWHITE:4209760255,AQUA:16777215,AQUAMARINE:2147472639,AZURE:4043309055,BEIGE:4126530815,BISQUE:4293182719,BLACK:255,BLANCHEDALMOND:4293643775,BLUE:65535,BLUEVIOLET:2318131967,BROWN:2771004159,BURLYWOOD:3736635391,CADETBLUE:1604231423,CHARTREUSE:2147418367,CHOCOLATE:3530104575,CORAL:4286533887,CORNFLOWERBLUE:1687547391,CORNSILK:4294499583,CRIMSON:3692313855,CYAN:16777215,DARKBLUE:35839,DARKCYAN:9145343,DARKGOLDENROD:3095837695,DARKGRAY:2846468607,DARKGREEN:6553855,DARKGREY:2846468607,DARKKHAKI:3182914559,DARKMAGENTA:2332068863,DARKOLIVEGREEN:1433087999,DARKORANGE:4287365375,DARKORCHID:2570243327,DARKRED:2332033279,DARKSALMON:3918953215,DARKSEAGREEN:2411499519,DARKSLATEBLUE:1211993087,DARKSLATEGRAY:793726975,DARKSLATEGREY:793726975,DARKTURQUOISE:13554175,DARKVIOLET:2483082239,DEEPPINK:4279538687,DEEPSKYBLUE:12582911,DIMGRAY:1768516095,DIMGREY:1768516095,DODGERBLUE:512819199,FIREBRICK:2988581631,FLORALWHITE:4294635775,FORESTGREEN:579543807,FUCHSIA:4278255615,GAINSBORO:3705462015,GHOSTWHITE:4177068031,GOLD:4292280575,GOLDENROD:3668254975,GRAY:2155905279,GREEN:8388863,GREENYELLOW:2919182335,GREY:2155905279,HONEYDEW:4043305215,HOTPINK:4285117695,INDIANRED:3445382399,INDIGO:1258324735,IVORY:4294963455,KHAKI:4041641215,LAVENDER:3873897215,LAVENDERBLUSH:4293981695,LAWNGREEN:2096890111,LEMONCHIFFON:4294626815,LIGHTBLUE:2916673279,LIGHTCORAL:4034953471,LIGHTCYAN:3774873599,LIGHTGOLDENRODYELLOW:4210742015,LIGHTGRAY:3553874943,LIGHTGREEN:2431553791,LIGHTGREY:3553874943,LIGHTPINK:4290167295,LIGHTSALMON:4288707327,LIGHTSEAGREEN:548580095,LIGHTSKYBLUE:2278488831,LIGHTSLATEGRAY:2005441023,LIGHTSLATEGREY:2005441023,LIGHTSTEELBLUE:2965692159,LIGHTYELLOW:4294959359,LIME:16711935,LIMEGREEN:852308735,LINEN:4210091775,MAGENTA:4278255615,MAROON:2147483903,MEDIUMAQUAMARINE:1724754687,MEDIUMBLUE:52735,MEDIUMORCHID:3126187007,MEDIUMPURPLE:2473647103,MEDIUMSEAGREEN:1018393087,MEDIUMSLATEBLUE:2070474495,MEDIUMSPRINGGREEN:16423679,MEDIUMTURQUOISE:1221709055,MEDIUMVIOLETRED:3340076543,MIDNIGHTBLUE:421097727,MINTCREAM:4127193855,MISTYROSE:4293190143,MOCCASIN:4293178879,NAVAJOWHITE:4292783615,NAVY:33023,OLDLACE:4260751103,OLIVE:2155872511,OLIVEDRAB:1804477439,ORANGE:4289003775,ORANGERED:4282712319,ORCHID:3664828159,PALEGOLDENROD:4008225535,PALEGREEN:2566625535,PALETURQUOISE:2951671551,PALEVIOLETRED:3681588223,PAPAYAWHIP:4293907967,PEACHPUFF:4292524543,PERU:3448061951,PINK:4290825215,PLUM:3718307327,POWDERBLUE:2967529215,PURPLE:2147516671,REBECCAPURPLE:1714657791,RED:4278190335,ROSYBROWN:3163525119,ROYALBLUE:1097458175,SADDLEBROWN:2336560127,SALMON:4202722047,SANDYBROWN:4104413439,SEAGREEN:780883967,SEASHELL:4294307583,SIENNA:2689740287,SILVER:3233857791,SKYBLUE:2278484991,SLATEBLUE:1784335871,SLATEGRAY:1887473919,SLATEGREY:1887473919,SNOW:4294638335,SPRINGGREEN:16744447,STEELBLUE:1182971135,TAN:3535047935,TEAL:8421631,THISTLE:3636451583,TOMATO:4284696575,TRANSPARENT:0,TURQUOISE:1088475391,VIOLET:4001558271,WHEAT:4125012991,WHITE:4294967295,WHITESMOKE:4126537215,YELLOW:4294902015,YELLOWGREEN:2597139199},zSe={name:"background-clip",initialValue:"border-box",prefix:!1,type:1,parse:function(r,s){return s.map(function(a){if(rs(a))switch(a.value){case"padding-box":return 1;case"content-box":return 2}return 0})}},qSe={name:"background-color",initialValue:"transparent",prefix:!1,type:3,format:"color"},Bb=function(r,s){var a=KA.parse(r,s[0]),c=s[1];return c&&ws(c)?{color:a,stop:c}:{color:a,stop:null}},rK=function(r,s){var a=r[0],c=r[r.length-1];a.stop===null&&(a.stop=li),c.stop===null&&(c.stop=kA);for(var A=[],u=0,m=0;m<r.length;m++){var E=r[m].stop;if(E!==null){var w=Er(E,s);w>u?A.push(w):A.push(u),u=w}else A.push(null)}for(var C=null,m=0;m<A.length;m++){var T=A[m];if(T===null)C===null&&(C=m);else if(C!==null){for(var N=m-C,B=A[C-1],k=(T-B)/(N+1),Q=1;Q<=N;Q++)A[C+Q-1]=k*Q;C=null}}return r.map(function(K,Y){var F=K.color;return{color:F,stop:Math.max(Math.min(1,A[Y]/s),0)}})},XSe=function(r,s,a){var c=s/2,A=a/2,u=Er(r[0],s)-c,m=A-Er(r[1],a);return(Math.atan2(m,u)+Math.PI*2)%(Math.PI*2)},JSe=function(r,s,a){var c=typeof r=="number"?r:XSe(r,s,a),A=Math.abs(s*Math.sin(c))+Math.abs(a*Math.cos(c)),u=s/2,m=a/2,E=A/2,w=Math.sin(c-Math.PI/2)*E,C=Math.cos(c-Math.PI/2)*E;return[A,u-C,u+C,m-w,m+w]},Jo=function(r,s){return Math.sqrt(r*r+s*s)},sK=function(r,s,a,c,A){var u=[[0,0],[0,s],[r,0],[r,s]];return u.reduce(function(m,E){var w=E[0],C=E[1],T=Jo(a-w,c-C);return(A?T<m.optimumDistance:T>m.optimumDistance)?{optimumCorner:E,optimumDistance:T}:m},{optimumDistance:A?1/0:-1/0,optimumCorner:null}).optimumCorner},$Se=function(r,s,a,c,A){var u=0,m=0;switch(r.size){case 0:r.shape===0?u=m=Math.min(Math.abs(s),Math.abs(s-c),Math.abs(a),Math.abs(a-A)):r.shape===1&&(u=Math.min(Math.abs(s),Math.abs(s-c)),m=Math.min(Math.abs(a),Math.abs(a-A)));break;case 2:if(r.shape===0)u=m=Math.min(Jo(s,a),Jo(s,a-A),Jo(s-c,a),Jo(s-c,a-A));else if(r.shape===1){var E=Math.min(Math.abs(a),Math.abs(a-A))/Math.min(Math.abs(s),Math.abs(s-c)),w=sK(c,A,s,a,!0),C=w[0],T=w[1];u=Jo(C-s,(T-a)/E),m=E*u}break;case 1:r.shape===0?u=m=Math.max(Math.abs(s),Math.abs(s-c),Math.abs(a),Math.abs(a-A)):r.shape===1&&(u=Math.max(Math.abs(s),Math.abs(s-c)),m=Math.max(Math.abs(a),Math.abs(a-A)));break;case 3:if(r.shape===0)u=m=Math.max(Jo(s,a),Jo(s,a-A),Jo(s-c,a),Jo(s-c,a-A));else if(r.shape===1){var E=Math.max(Math.abs(a),Math.abs(a-A))/Math.max(Math.abs(s),Math.abs(s-c)),N=sK(c,A,s,a,!1),C=N[0],T=N[1];u=Jo(C-s,(T-a)/E),m=E*u}break}return Array.isArray(r.size)&&(u=Er(r.size[0],c),m=r.size.length===2?Er(r.size[1],A):u),[u,m]},ZSe=function(r,s){var a=Eo(180),c=[];return Mc(s).forEach(function(A,u){if(u===0){var m=A[0];if(m.type===20&&m.value==="to"){a=t9(A);return}else if(e9(m)){a=Db.parse(r,m);return}}var E=Bb(r,A);c.push(E)}),{angle:a,stops:c,type:1}},By=function(r,s){var a=Eo(180),c=[];return Mc(s).forEach(function(A,u){if(u===0){var m=A[0];if(m.type===20&&["top","left","right","bottom"].indexOf(m.value)!==-1){a=t9(A);return}else if(e9(m)){a=(Db.parse(r,m)+Eo(270))%Eo(360);return}}var E=Bb(r,A);c.push(E)}),{angle:a,stops:c,type:1}},eCe=function(r,s){var a=Eo(180),c=[],A=1,u=0,m=3,E=[];return Mc(s).forEach(function(w,C){var T=w[0];if(C===0){if(rs(T)&&T.value==="linear"){A=1;return}else if(rs(T)&&T.value==="radial"){A=2;return}}if(T.type===18){if(T.name==="from"){var N=KA.parse(r,T.values[0]);c.push({stop:li,color:N})}else if(T.name==="to"){var N=KA.parse(r,T.values[0]);c.push({stop:kA,color:N})}else if(T.name==="color-stop"){var B=T.values.filter(xb);if(B.length===2){var N=KA.parse(r,B[1]),k=B[0];Ob(k)&&c.push({stop:{type:16,number:k.number*100,flags:k.flags},color:N})}}}}),A===1?{angle:(a+Eo(180))%Eo(360),stops:c,type:A}:{size:m,shape:u,stops:c,position:E,type:A}},n9="closest-side",r9="farthest-side",s9="closest-corner",i9="farthest-corner",a9="circle",o9="ellipse",c9="cover",l9="contain",tCe=function(r,s){var a=0,c=3,A=[],u=[];return Mc(s).forEach(function(m,E){var w=!0;if(E===0){var C=!1;w=m.reduce(function(N,B){if(C)if(rs(B))switch(B.value){case"center":return u.push(RB),N;case"top":case"left":return u.push(li),N;case"right":case"bottom":return u.push(kA),N}else(ws(B)||JA(B))&&u.push(B);else if(rs(B))switch(B.value){case a9:return a=0,!1;case o9:return a=1,!1;case"at":return C=!0,!1;case n9:return c=0,!1;case c9:case r9:return c=1,!1;case l9:case s9:return c=2,!1;case i9:return c=3,!1}else if(JA(B)||ws(B))return Array.isArray(c)||(c=[]),c.push(B),!1;return N},w)}if(w){var T=Bb(r,m);A.push(T)}}),{size:c,shape:a,stops:A,position:u,type:2}},ky=function(r,s){var a=0,c=3,A=[],u=[];return Mc(s).forEach(function(m,E){var w=!0;if(E===0?w=m.reduce(function(T,N){if(rs(N))switch(N.value){case"center":return u.push(RB),!1;case"top":case"left":return u.push(li),!1;case"right":case"bottom":return u.push(kA),!1}else if(ws(N)||JA(N))return u.push(N),!1;return T},w):E===1&&(w=m.reduce(function(T,N){if(rs(N))switch(N.value){case a9:return a=0,!1;case o9:return a=1,!1;case l9:case n9:return c=0,!1;case r9:return c=1,!1;case s9:return c=2,!1;case c9:case i9:return c=3,!1}else if(JA(N)||ws(N))return Array.isArray(c)||(c=[]),c.push(N),!1;return T},w)),w){var C=Bb(r,m);A.push(C)}}),{size:c,shape:a,stops:A,position:u,type:2}},nCe=function(r){return r.type===1},rCe=function(r){return r.type===2},IB={name:"image",parse:function(r,s){if(s.type===22){var a={url:s.value,type:0};return r.cache.addImage(s.value),a}if(s.type===18){var c=A9[s.name];if(typeof c>"u")throw new Error('Attempting to parse an unsupported image function "'+s.name+'"');return c(r,s.values)}throw new Error("Unsupported image type "+s.type)}};function sCe(r){return!(r.type===20&&r.value==="none")&&(r.type!==18||!!A9[r.name])}var A9={"linear-gradient":ZSe,"-moz-linear-gradient":By,"-ms-linear-gradient":By,"-o-linear-gradient":By,"-webkit-linear-gradient":By,"radial-gradient":tCe,"-moz-radial-gradient":ky,"-ms-radial-gradient":ky,"-o-radial-gradient":ky,"-webkit-radial-gradient":ky,"-webkit-gradient":eCe},iCe={name:"background-image",initialValue:"none",type:1,prefix:!1,parse:function(r,s){if(s.length===0)return[];var a=s[0];return a.type===20&&a.value==="none"?[]:s.filter(function(c){return xb(c)&&sCe(c)}).map(function(c){return IB.parse(r,c)})}},aCe={name:"background-origin",initialValue:"border-box",prefix:!1,type:1,parse:function(r,s){return s.map(function(a){if(rs(a))switch(a.value){case"padding-box":return 1;case"content-box":return 2}return 0})}},oCe={name:"background-position",initialValue:"0% 0%",type:1,prefix:!1,parse:function(r,s){return Mc(s).map(function(a){return a.filter(ws)}).map(qq)}},cCe={name:"background-repeat",initialValue:"repeat",prefix:!1,type:1,parse:function(r,s){return Mc(s).map(function(a){return a.filter(rs).map(function(c){return c.value}).join(" ")}).map(lCe)}},lCe=function(r){switch(r){case"no-repeat":return 1;case"repeat-x":case"repeat no-repeat":return 2;case"repeat-y":case"no-repeat repeat":return 3;case"repeat":default:return 0}},nf;(function(r){r.AUTO="auto",r.CONTAIN="contain",r.COVER="cover"})(nf||(nf={}));var ACe={name:"background-size",initialValue:"0",prefix:!1,type:1,parse:function(r,s){return Mc(s).map(function(a){return a.filter(dCe)})}},dCe=function(r){return rs(r)||ws(r)},kb=function(r){return{name:"border-"+r+"-color",initialValue:"transparent",prefix:!1,type:3,format:"color"}},uCe=kb("top"),hCe=kb("right"),pCe=kb("bottom"),fCe=kb("left"),Lb=function(r){return{name:"border-radius-"+r,initialValue:"0 0",prefix:!1,type:1,parse:function(s,a){return qq(a.filter(ws))}}},mCe=Lb("top-left"),gCe=Lb("top-right"),_Ce=Lb("bottom-right"),ECe=Lb("bottom-left"),Ub=function(r){return{name:"border-"+r+"-style",initialValue:"solid",prefix:!1,type:2,parse:function(s,a){switch(a){case"none":return 0;case"dashed":return 2;case"dotted":return 3;case"double":return 4}return 1}}},vCe=Ub("top"),yCe=Ub("right"),wCe=Ub("bottom"),bCe=Ub("left"),Pb=function(r){return{name:"border-"+r+"-width",initialValue:"0",type:0,prefix:!1,parse:function(s,a){return W_(a)?a.number:0}}},SCe=Pb("top"),CCe=Pb("right"),TCe=Pb("bottom"),RCe=Pb("left"),ICe={name:"color",initialValue:"transparent",prefix:!1,type:3,format:"color"},NCe={name:"direction",initialValue:"ltr",prefix:!1,type:2,parse:function(r,s){switch(s){case"rtl":return 1;case"ltr":default:return 0}}},OCe={name:"display",initialValue:"inline-block",prefix:!1,type:1,parse:function(r,s){return s.filter(rs).reduce(function(a,c){return a|xCe(c.value)},0)}},xCe=function(r){switch(r){case"block":case"-webkit-box":return 2;case"inline":return 4;case"run-in":return 8;case"flow":return 16;case"flow-root":return 32;case"table":return 64;case"flex":case"-webkit-flex":return 128;case"grid":case"-ms-grid":return 256;case"ruby":return 512;case"subgrid":return 1024;case"list-item":return 2048;case"table-row-group":return 4096;case"table-header-group":return 8192;case"table-footer-group":return 16384;case"table-row":return 32768;case"table-cell":return 65536;case"table-column-group":return 131072;case"table-column":return 262144;case"table-caption":return 524288;case"ruby-base":return 1048576;case"ruby-text":return 2097152;case"ruby-base-container":return 4194304;case"ruby-text-container":return 8388608;case"contents":return 16777216;case"inline-block":return 33554432;case"inline-list-item":return 67108864;case"inline-table":return 134217728;case"inline-flex":return 268435456;case"inline-grid":return 536870912}return 0},DCe={name:"float",initialValue:"none",prefix:!1,type:2,parse:function(r,s){switch(s){case"left":return 1;case"right":return 2;case"inline-start":return 3;case"inline-end":return 4}return 0}},BCe={name:"letter-spacing",initialValue:"0",prefix:!1,type:0,parse:function(r,s){return s.type===20&&s.value==="normal"?0:s.type===17||s.type===15?s.number:0}},Jw;(function(r){r.NORMAL="normal",r.STRICT="strict"})(Jw||(Jw={}));var kCe={name:"line-break",initialValue:"normal",prefix:!1,type:2,parse:function(r,s){switch(s){case"strict":return Jw.STRICT;case"normal":default:return Jw.NORMAL}}},LCe={name:"line-height",initialValue:"normal",prefix:!1,type:4},iK=function(r,s){return rs(r)&&r.value==="normal"?1.2*s:r.type===17?s*r.number:ws(r)?Er(r,s):s},UCe={name:"list-style-image",initialValue:"none",type:0,prefix:!1,parse:function(r,s){return s.type===20&&s.value==="none"?null:IB.parse(r,s)}},PCe={name:"list-style-position",initialValue:"outside",prefix:!1,type:2,parse:function(r,s){switch(s){case"inside":return 0;case"outside":default:return 1}}},MCe={name:"list-style-type",initialValue:"none",prefix:!1,type:2,parse:function(r,s){switch(s){case"disc":return 0;case"circle":return 1;case"square":return 2;case"decimal":return 3;case"cjk-decimal":return 4;case"decimal-leading-zero":return 5;case"lower-roman":return 6;case"upper-roman":return 7;case"lower-greek":return 8;case"lower-alpha":return 9;case"upper-alpha":return 10;case"arabic-indic":return 11;case"armenian":return 12;case"bengali":return 13;case"cambodian":return 14;case"cjk-earthly-branch":return 15;case"cjk-heavenly-stem":return 16;case"cjk-ideographic":return 17;case"devanagari":return 18;case"ethiopic-numeric":return 19;case"georgian":return 20;case"gujarati":return 21;case"gurmukhi":return 22;case"hebrew":return 22;case"hiragana":return 23;case"hiragana-iroha":return 24;case"japanese-formal":return 25;case"japanese-informal":return 26;case"kannada":return 27;case"katakana":return 28;case"katakana-iroha":return 29;case"khmer":return 30;case"korean-hangul-formal":return 31;case"korean-hanja-formal":return 32;case"korean-hanja-informal":return 33;case"lao":return 34;case"lower-armenian":return 35;case"malayalam":return 36;case"mongolian":return 37;case"myanmar":return 38;case"oriya":return 39;case"persian":return 40;case"simp-chinese-formal":return 41;case"simp-chinese-informal":return 42;case"tamil":return 43;case"telugu":return 44;case"thai":return 45;case"tibetan":return 46;case"trad-chinese-formal":return 47;case"trad-chinese-informal":return 48;case"upper-armenian":return 49;case"disclosure-open":return 50;case"disclosure-closed":return 51;case"none":default:return-1}}},Mb=function(r){return{name:"margin-"+r,initialValue:"0",prefix:!1,type:4}},FCe=Mb("top"),jCe=Mb("right"),VCe=Mb("bottom"),QCe=Mb("left"),HCe={name:"overflow",initialValue:"visible",prefix:!1,type:1,parse:function(r,s){return s.filter(rs).map(function(a){switch(a.value){case"hidden":return 1;case"scroll":return 2;case"clip":return 3;case"auto":return 4;case"visible":default:return 0}})}},GCe={name:"overflow-wrap",initialValue:"normal",prefix:!1,type:2,parse:function(r,s){switch(s){case"break-word":return"break-word";case"normal":default:return"normal"}}},Fb=function(r){return{name:"padding-"+r,initialValue:"0",prefix:!1,type:3,format:"length-percentage"}},KCe=Fb("top"),WCe=Fb("right"),YCe=Fb("bottom"),zCe=Fb("left"),qCe={name:"text-align",initialValue:"left",prefix:!1,type:2,parse:function(r,s){switch(s){case"right":return 2;case"center":case"justify":return 1;case"left":default:return 0}}},XCe={name:"position",initialValue:"static",prefix:!1,type:2,parse:function(r,s){switch(s){case"relative":return 1;case"absolute":return 2;case"fixed":return 3;case"sticky":return 4}return 0}},JCe={name:"text-shadow",initialValue:"none",type:1,prefix:!1,parse:function(r,s){return s.length===1&&sD(s[0],"none")?[]:Mc(s).map(function(a){for(var c={color:N_.TRANSPARENT,offsetX:li,offsetY:li,blur:li},A=0,u=0;u<a.length;u++){var m=a[u];JA(m)?(A===0?c.offsetX=m:A===1?c.offsetY=m:c.blur=m,A++):c.color=KA.parse(r,m)}return c})}},$Ce={name:"text-transform",initialValue:"none",prefix:!1,type:2,parse:function(r,s){switch(s){case"uppercase":return 2;case"lowercase":return 1;case"capitalize":return 3}return 0}},ZCe={name:"transform",initialValue:"none",prefix:!0,type:0,parse:function(r,s){if(s.type===20&&s.value==="none")return null;if(s.type===18){var a=nTe[s.name];if(typeof a>"u")throw new Error('Attempting to parse an unsupported transform function "'+s.name+'"');return a(s.values)}return null}},eTe=function(r){var s=r.filter(function(a){return a.type===17}).map(function(a){return a.number});return s.length===6?s:null},tTe=function(r){var s=r.filter(function(w){return w.type===17}).map(function(w){return w.number}),a=s[0],c=s[1];s[2],s[3];var A=s[4],u=s[5];s[6],s[7],s[8],s[9],s[10],s[11];var m=s[12],E=s[13];return s[14],s[15],s.length===16?[a,c,A,u,m,E]:null},nTe={matrix:eTe,matrix3d:tTe},aK={type:16,number:50,flags:K_},rTe=[aK,aK],sTe={name:"transform-origin",initialValue:"50% 50%",prefix:!0,type:1,parse:function(r,s){var a=s.filter(ws);return a.length!==2?rTe:[a[0],a[1]]}},iTe={name:"visible",initialValue:"none",prefix:!1,type:2,parse:function(r,s){switch(s){case"hidden":return 1;case"collapse":return 2;case"visible":default:return 0}}},e_;(function(r){r.NORMAL="normal",r.BREAK_ALL="break-all",r.KEEP_ALL="keep-all"})(e_||(e_={}));var aTe={name:"word-break",initialValue:"normal",prefix:!1,type:2,parse:function(r,s){switch(s){case"break-all":return e_.BREAK_ALL;case"keep-all":return e_.KEEP_ALL;case"normal":default:return e_.NORMAL}}},oTe={name:"z-index",initialValue:"auto",prefix:!1,type:0,parse:function(r,s){if(s.type===20)return{auto:!0,order:0};if(Ob(s))return{auto:!1,order:s.number};throw new Error("Invalid z-index number parsed")}},d9={name:"time",parse:function(r,s){if(s.type===15)switch(s.unit.toLowerCase()){case"s":return 1e3*s.number;case"ms":return s.number}throw new Error("Unsupported time type")}},cTe={name:"opacity",initialValue:"1",type:0,prefix:!1,parse:function(r,s){return Ob(s)?s.number:1}},lTe={name:"text-decoration-color",initialValue:"transparent",prefix:!1,type:3,format:"color"},ATe={name:"text-decoration-line",initialValue:"none",prefix:!1,type:1,parse:function(r,s){return s.filter(rs).map(function(a){switch(a.value){case"underline":return 1;case"overline":return 2;case"line-through":return 3;case"none":return 4}return 0}).filter(function(a){return a!==0})}},dTe={name:"font-family",initialValue:"",prefix:!1,type:1,parse:function(r,s){var a=[],c=[];return s.forEach(function(A){switch(A.type){case 20:case 0:a.push(A.value);break;case 17:a.push(A.number.toString());break;case 4:c.push(a.join(" ")),a.length=0;break}}),a.length&&c.push(a.join(" ")),c.map(function(A){return A.indexOf(" ")===-1?A:"'"+A+"'"})}},uTe={name:"font-size",initialValue:"0",prefix:!1,type:3,format:"length"},hTe={name:"font-weight",initialValue:"normal",type:0,prefix:!1,parse:function(r,s){if(Ob(s))return s.number;if(rs(s))switch(s.value){case"bold":return 700;case"normal":default:return 400}return 400}},pTe={name:"font-variant",initialValue:"none",type:1,prefix:!1,parse:function(r,s){return s.filter(rs).map(function(a){return a.value})}},fTe={name:"font-style",initialValue:"normal",prefix:!1,type:2,parse:function(r,s){switch(s){case"oblique":return"oblique";case"italic":return"italic";case"normal":default:return"normal"}}},Os=function(r,s){return(r&s)!==0},mTe={name:"duration",initialValue:"0s",prefix:!1,type:1,parse:function(r,s){return s.filter(W_).map(function(a){return d9.parse(r,a)})}},gTe={name:"box-shadow",initialValue:"none",type:1,prefix:!1,parse:function(r,s){return s.length===1&&sD(s[0],"none")?[]:Mc(s).map(function(a){for(var c={color:255,offsetX:li,offsetY:li,blur:li,spread:li,inset:!1},A=0,u=0;u<a.length;u++){var m=a[u];sD(m,"inset")?c.inset=!0:JA(m)?(A===0?c.offsetX=m:A===1?c.offsetY=m:A===2?c.blur=m:c.spread=m,A++):c.color=KA.parse(r,m)}return c})}},_Te={name:"paint-order",initialValue:"normal",prefix:!1,type:1,parse:function(r,s){var a=[0,1,2],c=[];return s.filter(rs).forEach(function(A){switch(A.value){case"stroke":c.push(1);break;case"fill":c.push(0);break;case"markers":c.push(2);break}}),a.forEach(function(A){c.indexOf(A)===-1&&c.push(A)}),c}},ETe={name:"-webkit-text-stroke-color",initialValue:"currentcolor",prefix:!1,type:3,format:"color"},vTe={name:"-webkit-text-stroke-width",initialValue:"0",type:0,prefix:!1,parse:function(r,s){return W_(s)?s.number:0}},yTe=function(){function r(s,a){var c,A;this.animationDuration=gt(s,mTe,a.animationDuration),this.backgroundClip=gt(s,zSe,a.backgroundClip),this.backgroundColor=gt(s,qSe,a.backgroundColor),this.backgroundImage=gt(s,iCe,a.backgroundImage),this.backgroundOrigin=gt(s,aCe,a.backgroundOrigin),this.backgroundPosition=gt(s,oCe,a.backgroundPosition),this.backgroundRepeat=gt(s,cCe,a.backgroundRepeat),this.backgroundSize=gt(s,ACe,a.backgroundSize),this.borderTopColor=gt(s,uCe,a.borderTopColor),this.borderRightColor=gt(s,hCe,a.borderRightColor),this.borderBottomColor=gt(s,pCe,a.borderBottomColor),this.borderLeftColor=gt(s,fCe,a.borderLeftColor),this.borderTopLeftRadius=gt(s,mCe,a.borderTopLeftRadius),this.borderTopRightRadius=gt(s,gCe,a.borderTopRightRadius),this.borderBottomRightRadius=gt(s,_Ce,a.borderBottomRightRadius),this.borderBottomLeftRadius=gt(s,ECe,a.borderBottomLeftRadius),this.borderTopStyle=gt(s,vCe,a.borderTopStyle),this.borderRightStyle=gt(s,yCe,a.borderRightStyle),this.borderBottomStyle=gt(s,wCe,a.borderBottomStyle),this.borderLeftStyle=gt(s,bCe,a.borderLeftStyle),this.borderTopWidth=gt(s,SCe,a.borderTopWidth),this.borderRightWidth=gt(s,CCe,a.borderRightWidth),this.borderBottomWidth=gt(s,TCe,a.borderBottomWidth),this.borderLeftWidth=gt(s,RCe,a.borderLeftWidth),this.boxShadow=gt(s,gTe,a.boxShadow),this.color=gt(s,ICe,a.color),this.direction=gt(s,NCe,a.direction),this.display=gt(s,OCe,a.display),this.float=gt(s,DCe,a.cssFloat),this.fontFamily=gt(s,dTe,a.fontFamily),this.fontSize=gt(s,uTe,a.fontSize),this.fontStyle=gt(s,fTe,a.fontStyle),this.fontVariant=gt(s,pTe,a.fontVariant),this.fontWeight=gt(s,hTe,a.fontWeight),this.letterSpacing=gt(s,BCe,a.letterSpacing),this.lineBreak=gt(s,kCe,a.lineBreak),this.lineHeight=gt(s,LCe,a.lineHeight),this.listStyleImage=gt(s,UCe,a.listStyleImage),this.listStylePosition=gt(s,PCe,a.listStylePosition),this.listStyleType=gt(s,MCe,a.listStyleType),this.marginTop=gt(s,FCe,a.marginTop),this.marginRight=gt(s,jCe,a.marginRight),this.marginBottom=gt(s,VCe,a.marginBottom),this.marginLeft=gt(s,QCe,a.marginLeft),this.opacity=gt(s,cTe,a.opacity);var u=gt(s,HCe,a.overflow);this.overflowX=u[0],this.overflowY=u[u.length>1?1:0],this.overflowWrap=gt(s,GCe,a.overflowWrap),this.paddingTop=gt(s,KCe,a.paddingTop),this.paddingRight=gt(s,WCe,a.paddingRight),this.paddingBottom=gt(s,YCe,a.paddingBottom),this.paddingLeft=gt(s,zCe,a.paddingLeft),this.paintOrder=gt(s,_Te,a.paintOrder),this.position=gt(s,XCe,a.position),this.textAlign=gt(s,qCe,a.textAlign),this.textDecorationColor=gt(s,lTe,(c=a.textDecorationColor)!==null&&c!==void 0?c:a.color),this.textDecorationLine=gt(s,ATe,(A=a.textDecorationLine)!==null&&A!==void 0?A:a.textDecoration),this.textShadow=gt(s,JCe,a.textShadow),this.textTransform=gt(s,$Ce,a.textTransform),this.transform=gt(s,ZCe,a.transform),this.transformOrigin=gt(s,sTe,a.transformOrigin),this.visibility=gt(s,iTe,a.visibility),this.webkitTextStrokeColor=gt(s,ETe,a.webkitTextStrokeColor),this.webkitTextStrokeWidth=gt(s,vTe,a.webkitTextStrokeWidth),this.wordBreak=gt(s,aTe,a.wordBreak),this.zIndex=gt(s,oTe,a.zIndex)}return r.prototype.isVisible=function(){return this.display>0&&this.opacity>0&&this.visibility===0},r.prototype.isTransparent=function(){return tf(this.backgroundColor)},r.prototype.isTransformed=function(){return this.transform!==null},r.prototype.isPositioned=function(){return this.position!==0},r.prototype.isPositionedWithZIndex=function(){return this.isPositioned()&&!this.zIndex.auto},r.prototype.isFloating=function(){return this.float!==0},r.prototype.isInlineLevel=function(){return Os(this.display,4)||Os(this.display,33554432)||Os(this.display,268435456)||Os(this.display,536870912)||Os(this.display,67108864)||Os(this.display,134217728)},r}(),gt=function(r,s,a){var c=new Yq,A=a!==null&&typeof a<"u"?a.toString():s.initialValue;c.write(A);var u=new zq(c.read());switch(s.type){case 2:var m=u.parseComponentValue();return s.parse(r,rs(m)?m.value:s.initialValue);case 0:return s.parse(r,u.parseComponentValue());case 1:return s.parse(r,u.parseComponentValues());case 4:return u.parseComponentValue();case 3:switch(s.format){case"angle":return Db.parse(r,u.parseComponentValue());case"color":return KA.parse(r,u.parseComponentValue());case"image":return IB.parse(r,u.parseComponentValue());case"length":var E=u.parseComponentValue();return JA(E)?E:li;case"length-percentage":var w=u.parseComponentValue();return ws(w)?w:li;case"time":return d9.parse(r,u.parseComponentValue())}break}},wTe="data-html2canvas-debug",bTe=function(r){var s=r.getAttribute(wTe);switch(s){case"all":return 1;case"clone":return 2;case"parse":return 3;case"render":return 4;default:return 0}},oK=function(r,s){var a=bTe(r);return a===1||s===a},Fc=function(){function r(s,a){if(this.context=s,this.textNodes=[],this.elements=[],this.flags=0,oK(a,3))debugger;this.styles=new yTe(s,window.getComputedStyle(a,null)),bRe(a)&&(this.styles.animationDuration.some(function(c){return c>0})&&(a.style.animationDuration="0s"),this.styles.transform!==null&&(a.style.transform="none")),this.bounds=CB(this.context,a),oK(a,4)&&(this.flags|=16)}return r}(),STe="AAAAAAAAAAAAEA4AGBkAAFAaAAACAAAAAAAIABAAGAAwADgACAAQAAgAEAAIABAACAAQAAgAEAAIABAACAAQAAgAEAAIABAAQABIAEQATAAIABAACAAQAAgAEAAIABAAVABcAAgAEAAIABAACAAQAGAAaABwAHgAgACIAI4AlgAIABAAmwCjAKgAsAC2AL4AvQDFAMoA0gBPAVYBWgEIAAgACACMANoAYgFkAWwBdAF8AX0BhQGNAZUBlgGeAaMBlQGWAasBswF8AbsBwwF0AcsBYwHTAQgA2wG/AOMBdAF8AekB8QF0AfkB+wHiAHQBfAEIAAMC5gQIAAsCEgIIAAgAFgIeAggAIgIpAggAMQI5AkACygEIAAgASAJQAlgCYAIIAAgACAAKBQoFCgUTBRMFGQUrBSsFCAAIAAgACAAIAAgACAAIAAgACABdAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABoAmgCrwGvAQgAbgJ2AggAHgEIAAgACADnAXsCCAAIAAgAgwIIAAgACAAIAAgACACKAggAkQKZAggAPADJAAgAoQKkAqwCsgK6AsICCADJAggA0AIIAAgACAAIANYC3gIIAAgACAAIAAgACABAAOYCCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAkASoB+QIEAAgACAA8AEMCCABCBQgACABJBVAFCAAIAAgACAAIAAgACAAIAAgACABTBVoFCAAIAFoFCABfBWUFCAAIAAgACAAIAAgAbQUIAAgACAAIAAgACABzBXsFfQWFBYoFigWKBZEFigWKBYoFmAWfBaYFrgWxBbkFCAAIAAgACAAIAAgACAAIAAgACAAIAMEFCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAMgFCADQBQgACAAIAAgACAAIAAgACAAIAAgACAAIAO4CCAAIAAgAiQAIAAgACABAAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAD0AggACAD8AggACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIANYFCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAMDvwAIAAgAJAIIAAgACAAIAAgACAAIAAgACwMTAwgACAB9BOsEGwMjAwgAKwMyAwsFYgE3A/MEPwMIAEUDTQNRAwgAWQOsAGEDCAAIAAgACAAIAAgACABpAzQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFIQUoBSwFCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABtAwgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABMAEwACAAIAAgACAAIABgACAAIAAgACAC/AAgACAAyAQgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACACAAIAAwAAgACAAIAAgACAAIAAgACAAIAAAARABIAAgACAAIABQASAAIAAgAIABwAEAAjgCIABsAqAC2AL0AigDQAtwC+IJIQqVAZUBWQqVAZUBlQGVAZUBlQGrC5UBlQGVAZUBlQGVAZUBlQGVAXsKlQGVAbAK6wsrDGUMpQzlDJUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAfAKAAuZA64AtwCJALoC6ADwAAgAuACgA/oEpgO6AqsD+AAIAAgAswMIAAgACAAIAIkAuwP5AfsBwwPLAwgACAAIAAgACADRA9kDCAAIAOED6QMIAAgACAAIAAgACADuA/YDCAAIAP4DyQAIAAgABgQIAAgAXQAOBAgACAAIAAgACAAIABMECAAIAAgACAAIAAgACAD8AAQBCAAIAAgAGgQiBCoECAExBAgAEAEIAAgACAAIAAgACAAIAAgACAAIAAgACAA4BAgACABABEYECAAIAAgATAQYAQgAVAQIAAgACAAIAAgACAAIAAgACAAIAFoECAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAOQEIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAB+BAcACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAEABhgSMBAgACAAIAAgAlAQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAwAEAAQABAADAAMAAwADAAQABAAEAAQABAAEAAQABHATAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAdQMIAAgACAAIAAgACAAIAMkACAAIAAgAfQMIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACACFA4kDCAAIAAgACAAIAOcBCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAIcDCAAIAAgACAAIAAgACAAIAAgACAAIAJEDCAAIAAgACADFAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABgBAgAZgQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAbAQCBXIECAAIAHkECAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABAAJwEQACjBKoEsgQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAC6BMIECAAIAAgACAAIAAgACABmBAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAxwQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAGYECAAIAAgAzgQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAigWKBYoFigWKBYoFigWKBd0FXwUIAOIF6gXxBYoF3gT5BQAGCAaKBYoFigWKBYoFigWKBYoFigWKBYoFigXWBIoFigWKBYoFigWKBYoFigWKBYsFEAaKBYoFigWKBYoFigWKBRQGCACKBYoFigWKBQgACAAIANEECAAIABgGigUgBggAJgYIAC4GMwaKBYoF0wQ3Bj4GigWKBYoFigWKBYoFigWKBYoFigWKBYoFigUIAAgACAAIAAgACAAIAAgAigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWLBf///////wQABAAEAAQABAAEAAQABAAEAAQAAwAEAAQAAgAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAQADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAUAAAAFAAUAAAAFAAUAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQABAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUAAQAAAAUABQAFAAUABQAFAAAAAAAFAAUAAAAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAFAAUAAQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABwAFAAUABQAFAAAABwAHAAcAAAAHAAcABwAFAAEAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAcABwAFAAUAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAAAAQABAAAAAAAAAAAAAAAFAAUABQAFAAAABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAcABwAHAAcAAAAHAAcAAAAAAAUABQAHAAUAAQAHAAEABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABwABAAUABQAFAAUAAAAAAAAAAAAAAAEAAQABAAEAAQABAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABwAFAAUAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUAAQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQABQANAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQABAAEAAQABAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQABAAEAAQABAAEAAQABAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAABQAHAAUABQAFAAAAAAAAAAcABQAFAAUABQAFAAQABAAEAAQABAAEAAQABAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUAAAAFAAUABQAFAAUAAAAFAAUABQAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAAAAAAAAAAAAUABQAFAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAUAAAAHAAcABwAFAAUABQAFAAUABQAFAAUABwAHAAcABwAFAAcABwAAAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAUABwAHAAUABQAFAAUAAAAAAAcABwAAAAAABwAHAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAABQAFAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAABwAHAAcABQAFAAAAAAAAAAAABQAFAAAAAAAFAAUABQAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAFAAUABQAFAAUAAAAFAAUABwAAAAcABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAFAAUABwAFAAUABQAFAAAAAAAHAAcAAAAAAAcABwAFAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAcABwAAAAAAAAAHAAcABwAAAAcABwAHAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAABQAHAAcABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAHAAcABwAAAAUABQAFAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAcABQAHAAcABQAHAAcAAAAFAAcABwAAAAcABwAFAAUAAAAAAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAUABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAFAAcABwAFAAUABQAAAAUAAAAHAAcABwAHAAcABwAHAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAHAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAABwAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAUAAAAFAAAAAAAAAAAABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABwAFAAUABQAFAAUAAAAFAAUAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABwAFAAUABQAFAAUABQAAAAUABQAHAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABQAFAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAcABQAFAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAHAAUABQAFAAUABQAFAAUABwAHAAcABwAHAAcABwAHAAUABwAHAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABwAHAAcABwAFAAUABwAHAAcAAAAAAAAAAAAHAAcABQAHAAcABwAHAAcABwAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAcABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAHAAUABQAFAAUABQAFAAUAAAAFAAAABQAAAAAABQAFAAUABQAFAAUABQAFAAcABwAHAAcABwAHAAUABQAFAAUABQAFAAUABQAFAAUAAAAAAAUABQAFAAUABQAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABwAFAAcABwAHAAcABwAFAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAUABQAFAAUABwAHAAUABQAHAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAcABQAFAAcABwAHAAUABwAFAAUABQAHAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABwAHAAcABwAHAAUABQAFAAUABQAFAAUABQAHAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAcABQAFAAUABQAFAAUABQAAAAAAAAAAAAUAAAAAAAAAAAAAAAAABQAAAAAABwAFAAUAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUAAAAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAABQAAAAAAAAAFAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAUABQAHAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAHAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAHAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAcABwAFAAUABQAFAAcABwAFAAUABwAHAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAcABwAFAAUABwAHAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAFAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAFAAUABQAAAAAABQAFAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAFAAcABwAAAAAAAAAAAAAABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAFAAcABwAFAAcABwAAAAcABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAFAAUABQAAAAUABQAAAAAAAAAAAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABwAFAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABQAFAAUABQAFAAUABQAFAAUABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAHAAcABQAHAAUABQAAAAAAAAAAAAAAAAAFAAAABwAHAAcABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAHAAcABwAAAAAABwAHAAAAAAAHAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAAAAAAFAAUABQAFAAUABQAFAAAAAAAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAUABQAFAAUABwAHAAUABQAFAAcABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAcABQAFAAUABQAFAAUABwAFAAcABwAFAAcABQAFAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAcABQAFAAUABQAAAAAABwAHAAcABwAFAAUABwAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAHAAUABQAFAAUABQAFAAUABQAHAAcABQAHAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAFAAcABwAFAAUABQAFAAUABQAHAAUAAAAAAAAAAAAAAAAAAAAAAAcABwAFAAUABQAFAAcABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAUABQAFAAUABQAHAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAAAAAAFAAUABwAHAAcABwAFAAAAAAAAAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABwAHAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAFAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAcABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAAAHAAUABQAFAAUABQAFAAUABwAFAAUABwAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUAAAAAAAAABQAAAAUABQAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAHAAcAAAAFAAUAAAAHAAcABQAHAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAAAAAAAAAAAAAAAAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAUABQAFAAAAAAAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAABQAFAAUABQAFAAUABQAAAAUABQAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAFAAUABQAFAAUADgAOAA4ADgAOAA4ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAAAAAAAAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAMAAwADAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkAAAAAAAAAAAAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAAAAAAAAAAAAsADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwACwAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAADgAOAA4AAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAAAA4ADgAOAA4ADgAOAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAAAA4AAAAOAAAAAAAAAAAAAAAAAA4AAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAADgAAAAAAAAAAAA4AAAAOAAAAAAAAAAAADgAOAA4AAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAAAA4ADgAOAA4ADgAOAA4ADgAOAAAADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4AAAAAAAAAAAAAAAAAAAAAAA4ADgAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAOAA4ADgAOAA4ADgAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAAAAAAAAA=",cK="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",kg=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(var Ly=0;Ly<cK.length;Ly++)kg[cK.charCodeAt(Ly)]=Ly;var CTe=function(r){var s=r.length*.75,a=r.length,c,A=0,u,m,E,w;r[r.length-1]==="="&&(s--,r[r.length-2]==="="&&s--);var C=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u"&&typeof Uint8Array.prototype.slice<"u"?new ArrayBuffer(s):new Array(s),T=Array.isArray(C)?C:new Uint8Array(C);for(c=0;c<a;c+=4)u=kg[r.charCodeAt(c)],m=kg[r.charCodeAt(c+1)],E=kg[r.charCodeAt(c+2)],w=kg[r.charCodeAt(c+3)],T[A++]=u<<2|m>>4,T[A++]=(m&15)<<4|E>>2,T[A++]=(E&3)<<6|w&63;return C},TTe=function(r){for(var s=r.length,a=[],c=0;c<s;c+=2)a.push(r[c+1]<<8|r[c]);return a},RTe=function(r){for(var s=r.length,a=[],c=0;c<s;c+=4)a.push(r[c+3]<<24|r[c+2]<<16|r[c+1]<<8|r[c]);return a},Nu=5,NB=11,mO=2,ITe=NB-Nu,u9=65536>>Nu,NTe=1<<Nu,gO=NTe-1,OTe=1024>>Nu,xTe=u9+OTe,DTe=xTe,BTe=32,kTe=DTe+BTe,LTe=65536>>NB,UTe=1<<ITe,PTe=UTe-1,lK=function(r,s,a){return r.slice?r.slice(s,a):new Uint16Array(Array.prototype.slice.call(r,s,a))},MTe=function(r,s,a){return r.slice?r.slice(s,a):new Uint32Array(Array.prototype.slice.call(r,s,a))},FTe=function(r,s){var a=CTe(r),c=Array.isArray(a)?RTe(a):new Uint32Array(a),A=Array.isArray(a)?TTe(a):new Uint16Array(a),u=24,m=lK(A,u/2,c[4]/2),E=c[5]===2?lK(A,(u+c[4])/2):MTe(c,Math.ceil((u+c[4])/4));return new jTe(c[0],c[1],c[2],c[3],m,E)},jTe=function(){function r(s,a,c,A,u,m){this.initialValue=s,this.errorValue=a,this.highStart=c,this.highValueIndex=A,this.index=u,this.data=m}return r.prototype.get=function(s){var a;if(s>=0){if(s<55296||s>56319&&s<=65535)return a=this.index[s>>Nu],a=(a<<mO)+(s&gO),this.data[a];if(s<=65535)return a=this.index[u9+(s-55296>>Nu)],a=(a<<mO)+(s&gO),this.data[a];if(s<this.highStart)return a=kTe-LTe+(s>>NB),a=this.index[a],a+=s>>Nu&PTe,a=this.index[a],a=(a<<mO)+(s&gO),this.data[a];if(s<=1114111)return this.data[this.highValueIndex]}return this.errorValue},r}(),AK="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",VTe=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(var Uy=0;Uy<AK.length;Uy++)VTe[AK.charCodeAt(Uy)]=Uy;var QTe=1,_O=2,EO=3,dK=4,uK=5,HTe=7,hK=8,vO=9,yO=10,pK=11,fK=12,mK=13,gK=14,wO=15,GTe=function(r){for(var s=[],a=0,c=r.length;a<c;){var A=r.charCodeAt(a++);if(A>=55296&&A<=56319&&a<c){var u=r.charCodeAt(a++);(u&64512)===56320?s.push(((A&1023)<<10)+(u&1023)+65536):(s.push(A),a--)}else s.push(A)}return s},KTe=function(){for(var r=[],s=0;s<arguments.length;s++)r[s]=arguments[s];if(String.fromCodePoint)return String.fromCodePoint.apply(String,r);var a=r.length;if(!a)return"";for(var c=[],A=-1,u="";++A<a;){var m=r[A];m<=65535?c.push(m):(m-=65536,c.push((m>>10)+55296,m%1024+56320)),(A+1===a||c.length>16384)&&(u+=String.fromCharCode.apply(String,c),c.length=0)}return u},WTe=FTe(STe),lo="",bO="",YTe=function(r){return WTe.get(r)},zTe=function(r,s,a){var c=a-2,A=s[c],u=s[a-1],m=s[a];if(u===_O&&m===EO)return lo;if(u===_O||u===EO||u===dK||m===_O||m===EO||m===dK)return bO;if(u===hK&&[hK,vO,pK,fK].indexOf(m)!==-1||(u===pK||u===vO)&&(m===vO||m===yO)||(u===fK||u===yO)&&m===yO||m===mK||m===uK||m===HTe||u===QTe)return lo;if(u===mK&&m===gK){for(;A===uK;)A=s[--c];if(A===gK)return lo}if(u===wO&&m===wO){for(var E=0;A===wO;)E++,A=s[--c];if(E%2===0)return lo}return bO},qTe=function(r){var s=GTe(r),a=s.length,c=0,A=0,u=s.map(YTe);return{next:function(){if(c>=a)return{done:!0,value:null};for(var m=lo;c<a&&(m=zTe(s,u,++c))===lo;);if(m!==lo||c===a){var E=KTe.apply(null,s.slice(A,c));return A=c,{value:E,done:!1}}return{done:!0,value:null}}}},XTe=function(r){for(var s=qTe(r),a=[],c;!(c=s.next()).done;)c.value&&a.push(c.value.slice());return a},JTe=function(r){var s=123;if(r.createRange){var a=r.createRange();if(a.getBoundingClientRect){var c=r.createElement("boundtest");c.style.height=s+"px",c.style.display="block",r.body.appendChild(c),a.selectNode(c);var A=a.getBoundingClientRect(),u=Math.round(A.height);if(r.body.removeChild(c),u===s)return!0}}return!1},$Te=function(r){var s=r.createElement("boundtest");s.style.width="50px",s.style.display="block",s.style.fontSize="12px",s.style.letterSpacing="0px",s.style.wordSpacing="0px",r.body.appendChild(s);var a=r.createRange();s.innerHTML=typeof"".repeat=="function"?"&#128104;".repeat(10):"";var c=s.firstChild,A=Nb(c.data).map(function(w){return ls(w)}),u=0,m={},E=A.every(function(w,C){a.setStart(c,u),a.setEnd(c,u+w.length);var T=a.getBoundingClientRect();u+=w.length;var N=T.x>m.x||T.y>m.y;return m=T,C===0?!0:N});return r.body.removeChild(s),E},ZTe=function(){return typeof new Image().crossOrigin<"u"},eRe=function(){return typeof new XMLHttpRequest().responseType=="string"},tRe=function(r){var s=new Image,a=r.createElement("canvas"),c=a.getContext("2d");if(!c)return!1;s.src="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg'></svg>";try{c.drawImage(s,0,0),a.toDataURL()}catch{return!1}return!0},_K=function(r){return r[0]===0&&r[1]===255&&r[2]===0&&r[3]===255},nRe=function(r){var s=r.createElement("canvas"),a=100;s.width=a,s.height=a;var c=s.getContext("2d");if(!c)return Promise.reject(!1);c.fillStyle="rgb(0, 255, 0)",c.fillRect(0,0,a,a);var A=new Image,u=s.toDataURL();A.src=u;var m=iD(a,a,0,0,A);return c.fillStyle="red",c.fillRect(0,0,a,a),EK(m).then(function(E){c.drawImage(E,0,0);var w=c.getImageData(0,0,a,a).data;c.fillStyle="red",c.fillRect(0,0,a,a);var C=r.createElement("div");return C.style.backgroundImage="url("+u+")",C.style.height=a+"px",_K(w)?EK(iD(a,a,0,0,C)):Promise.reject(!1)}).then(function(E){return c.drawImage(E,0,0),_K(c.getImageData(0,0,a,a).data)}).catch(function(){return!1})},iD=function(r,s,a,c,A){var u="http://www.w3.org/2000/svg",m=document.createElementNS(u,"svg"),E=document.createElementNS(u,"foreignObject");return m.setAttributeNS(null,"width",r.toString()),m.setAttributeNS(null,"height",s.toString()),E.setAttributeNS(null,"width","100%"),E.setAttributeNS(null,"height","100%"),E.setAttributeNS(null,"x",a.toString()),E.setAttributeNS(null,"y",c.toString()),E.setAttributeNS(null,"externalResourcesRequired","true"),m.appendChild(E),E.appendChild(A),m},EK=function(r){return new Promise(function(s,a){var c=new Image;c.onload=function(){return s(c)},c.onerror=a,c.src="data:image/svg+xml;charset=utf-8,"+encodeURIComponent(new XMLSerializer().serializeToString(r))})},Sa={get SUPPORT_RANGE_BOUNDS(){var r=JTe(document);return Object.defineProperty(Sa,"SUPPORT_RANGE_BOUNDS",{value:r}),r},get SUPPORT_WORD_BREAKING(){var r=Sa.SUPPORT_RANGE_BOUNDS&&$Te(document);return Object.defineProperty(Sa,"SUPPORT_WORD_BREAKING",{value:r}),r},get SUPPORT_SVG_DRAWING(){var r=tRe(document);return Object.defineProperty(Sa,"SUPPORT_SVG_DRAWING",{value:r}),r},get SUPPORT_FOREIGNOBJECT_DRAWING(){var r=typeof Array.from=="function"&&typeof window.fetch=="function"?nRe(document):Promise.resolve(!1);return Object.defineProperty(Sa,"SUPPORT_FOREIGNOBJECT_DRAWING",{value:r}),r},get SUPPORT_CORS_IMAGES(){var r=ZTe();return Object.defineProperty(Sa,"SUPPORT_CORS_IMAGES",{value:r}),r},get SUPPORT_RESPONSE_TYPE(){var r=eRe();return Object.defineProperty(Sa,"SUPPORT_RESPONSE_TYPE",{value:r}),r},get SUPPORT_CORS_XHR(){var r="withCredentials"in new XMLHttpRequest;return Object.defineProperty(Sa,"SUPPORT_CORS_XHR",{value:r}),r},get SUPPORT_NATIVE_TEXT_SEGMENTATION(){var r=!!(typeof Intl<"u"&&Intl.Segmenter);return Object.defineProperty(Sa,"SUPPORT_NATIVE_TEXT_SEGMENTATION",{value:r}),r}},t_=function(){function r(s,a){this.text=s,this.bounds=a}return r}(),rRe=function(r,s,a,c){var A=aRe(s,a),u=[],m=0;return A.forEach(function(E){if(a.textDecorationLine.length||E.trim().length>0)if(Sa.SUPPORT_RANGE_BOUNDS){var w=vK(c,m,E.length).getClientRects();if(w.length>1){var C=OB(E),T=0;C.forEach(function(B){u.push(new t_(B,Uu.fromDOMRectList(r,vK(c,T+m,B.length).getClientRects()))),T+=B.length})}else u.push(new t_(E,Uu.fromDOMRectList(r,w)))}else{var N=c.splitText(E.length);u.push(new t_(E,sRe(r,c))),c=N}else Sa.SUPPORT_RANGE_BOUNDS||(c=c.splitText(E.length));m+=E.length}),u},sRe=function(r,s){var a=s.ownerDocument;if(a){var c=a.createElement("html2canvaswrapper");c.appendChild(s.cloneNode(!0));var A=s.parentNode;if(A){A.replaceChild(c,s);var u=CB(r,c);return c.firstChild&&A.replaceChild(c.firstChild,c),u}}return Uu.EMPTY},vK=function(r,s,a){var c=r.ownerDocument;if(!c)throw new Error("Node has no owner document");var A=c.createRange();return A.setStart(r,s),A.setEnd(r,s+a),A},OB=function(r){if(Sa.SUPPORT_NATIVE_TEXT_SEGMENTATION){var s=new Intl.Segmenter(void 0,{granularity:"grapheme"});return Array.from(s.segment(r)).map(function(a){return a.segment})}return XTe(r)},iRe=function(r,s){if(Sa.SUPPORT_NATIVE_TEXT_SEGMENTATION){var a=new Intl.Segmenter(void 0,{granularity:"word"});return Array.from(a.segment(r)).map(function(c){return c.segment})}return cRe(r,s)},aRe=function(r,s){return s.letterSpacing!==0?OB(r):iRe(r,s)},oRe=[32,160,4961,65792,65793,4153,4241],cRe=function(r,s){for(var a=jbe(r,{lineBreak:s.lineBreak,wordBreak:s.overflowWrap==="break-word"?"break-word":s.wordBreak}),c=[],A,u=function(){if(A.value){var m=A.value.slice(),E=Nb(m),w="";E.forEach(function(C){oRe.indexOf(C)===-1?w+=ls(C):(w.length&&c.push(w),c.push(ls(C)),w="")}),w.length&&c.push(w)}};!(A=a.next()).done;)u();return c},lRe=function(){function r(s,a,c){this.text=ARe(a.data,c.textTransform),this.textBounds=rRe(s,this.text,c,a)}return r}(),ARe=function(r,s){switch(s){case 1:return r.toLowerCase();case 3:return r.replace(dRe,uRe);case 2:return r.toUpperCase();default:return r}},dRe=/(^|\s|:|-|\(|\))([a-z])/g,uRe=function(r,s,a){return r.length>0?s+a.toUpperCase():r},h9=function(r){rc(s,r);function s(a,c){var A=r.call(this,a,c)||this;return A.src=c.currentSrc||c.src,A.intrinsicWidth=c.naturalWidth,A.intrinsicHeight=c.naturalHeight,A.context.cache.addImage(A.src),A}return s}(Fc),p9=function(r){rc(s,r);function s(a,c){var A=r.call(this,a,c)||this;return A.canvas=c,A.intrinsicWidth=c.width,A.intrinsicHeight=c.height,A}return s}(Fc),f9=function(r){rc(s,r);function s(a,c){var A=r.call(this,a,c)||this,u=new XMLSerializer,m=CB(a,c);return c.setAttribute("width",m.width+"px"),c.setAttribute("height",m.height+"px"),A.svg="data:image/svg+xml,"+encodeURIComponent(u.serializeToString(c)),A.intrinsicWidth=c.width.baseVal.value,A.intrinsicHeight=c.height.baseVal.value,A.context.cache.addImage(A.svg),A}return s}(Fc),m9=function(r){rc(s,r);function s(a,c){var A=r.call(this,a,c)||this;return A.value=c.value,A}return s}(Fc),aD=function(r){rc(s,r);function s(a,c){var A=r.call(this,a,c)||this;return A.start=c.start,A.reversed=typeof c.reversed=="boolean"&&c.reversed===!0,A}return s}(Fc),hRe=[{type:15,flags:0,unit:"px",number:3}],pRe=[{type:16,flags:0,number:50}],fRe=function(r){return r.width>r.height?new Uu(r.left+(r.width-r.height)/2,r.top,r.height,r.height):r.width<r.height?new Uu(r.left,r.top+(r.height-r.width)/2,r.width,r.width):r},mRe=function(r){var s=r.type===gRe?new Array(r.value.length+1).join(""):r.value;return s.length===0?r.placeholder||"":s},$w="checkbox",Zw="radio",gRe="password",yK=707406591,xB=function(r){rc(s,r);function s(a,c){var A=r.call(this,a,c)||this;switch(A.type=c.type.toLowerCase(),A.checked=c.checked,A.value=mRe(c),(A.type===$w||A.type===Zw)&&(A.styles.backgroundColor=3739148031,A.styles.borderTopColor=A.styles.borderRightColor=A.styles.borderBottomColor=A.styles.borderLeftColor=2779096575,A.styles.borderTopWidth=A.styles.borderRightWidth=A.styles.borderBottomWidth=A.styles.borderLeftWidth=1,A.styles.borderTopStyle=A.styles.borderRightStyle=A.styles.borderBottomStyle=A.styles.borderLeftStyle=1,A.styles.backgroundClip=[0],A.styles.backgroundOrigin=[0],A.bounds=fRe(A.bounds)),A.type){case $w:A.styles.borderTopRightRadius=A.styles.borderTopLeftRadius=A.styles.borderBottomRightRadius=A.styles.borderBottomLeftRadius=hRe;break;case Zw:A.styles.borderTopRightRadius=A.styles.borderTopLeftRadius=A.styles.borderBottomRightRadius=A.styles.borderBottomLeftRadius=pRe;break}return A}return s}(Fc),g9=function(r){rc(s,r);function s(a,c){var A=r.call(this,a,c)||this,u=c.options[c.selectedIndex||0];return A.value=u&&u.text||"",A}return s}(Fc),_9=function(r){rc(s,r);function s(a,c){var A=r.call(this,a,c)||this;return A.value=c.value,A}return s}(Fc),E9=function(r){rc(s,r);function s(a,c){var A=r.call(this,a,c)||this;A.src=c.src,A.width=parseInt(c.width,10)||0,A.height=parseInt(c.height,10)||0,A.backgroundColor=A.styles.backgroundColor;try{if(c.contentWindow&&c.contentWindow.document&&c.contentWindow.document.documentElement){A.tree=ERe(a,c.contentWindow.document.documentElement);var u=c.contentWindow.document.documentElement?nK(a,getComputedStyle(c.contentWindow.document.documentElement).backgroundColor):N_.TRANSPARENT,m=c.contentWindow.document.body?nK(a,getComputedStyle(c.contentWindow.document.body).backgroundColor):N_.TRANSPARENT;A.backgroundColor=tf(u)?tf(m)?A.styles.backgroundColor:m:u}}catch{}return A}return s}(Fc),_Re=["OL","UL","MENU"],iw=function(r,s,a,c){for(var A=s.firstChild,u=void 0;A;A=u)if(u=A.nextSibling,wRe(A)&&A.data.trim().length>0)a.textNodes.push(new lRe(r,A,a.styles));else if(y9(A))if(DRe(A)&&A.assignedNodes)A.assignedNodes().forEach(function(E){return iw(r,E,a,c)});else{var m=v9(r,A);m.styles.isVisible()&&(vRe(A,m,c)?m.flags|=4:yRe(m.styles)&&(m.flags|=2),_Re.indexOf(A.tagName)!==-1&&(m.flags|=8),a.elements.push(m),A.slot,A.shadowRoot?iw(r,A.shadowRoot,m,c):!b9(A)&&!w9(A)&&!S9(A)&&iw(r,A,m,c))}},v9=function(r,s){return ORe(s)?new h9(r,s):NRe(s)?new p9(r,s):w9(s)?new f9(r,s):CRe(s)?new m9(r,s):TRe(s)?new aD(r,s):RRe(s)?new xB(r,s):S9(s)?new g9(r,s):b9(s)?new _9(r,s):xRe(s)?new E9(r,s):new Fc(r,s)},ERe=function(r,s){var a=v9(r,s);return a.flags|=4,iw(r,s,a,a),a},vRe=function(r,s,a){return s.styles.isPositionedWithZIndex()||s.styles.opacity<1||s.styles.isTransformed()||IRe(r)&&a.styles.isTransparent()},yRe=function(r){return r.isPositioned()||r.isFloating()},wRe=function(r){return r.nodeType===Node.TEXT_NODE},y9=function(r){return r.nodeType===Node.ELEMENT_NODE},bRe=function(r){return y9(r)&&typeof r.style<"u"&&!SRe(r)},SRe=function(r){return typeof r.className=="object"},CRe=function(r){return r.tagName==="LI"},TRe=function(r){return r.tagName==="OL"},RRe=function(r){return r.tagName==="INPUT"},w9=function(r){return r.tagName==="svg"},IRe=function(r){return r.tagName==="BODY"},NRe=function(r){return r.tagName==="CANVAS"},ORe=function(r){return r.tagName==="IMG"},xRe=function(r){return r.tagName==="IFRAME"},b9=function(r){return r.tagName==="TEXTAREA"},S9=function(r){return r.tagName==="SELECT"},DRe=function(r){return r.tagName==="SLOT"},wK={integers:[1e3,900,500,400,100,90,50,40,10,9,5,4,1],values:["M","CM","D","CD","C","XC","L","XL","X","IX","V","IV","I"]},bK={integers:[9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,900,800,700,600,500,400,300,200,100,90,80,70,60,50,40,30,20,10,9,8,7,6,5,4,3,2,1],values:["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""]},BRe={integers:[1e4,9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,400,300,200,100,90,80,70,60,50,40,30,20,19,18,17,16,15,10,9,8,7,6,5,4,3,2,1],values:["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""]},kRe={integers:[1e4,9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,900,800,700,600,500,400,300,200,100,90,80,70,60,50,40,30,20,10,9,8,7,6,5,4,3,2,1],values:["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""]},wp=function(r,s,a,c,A,u){return r<s||r>a?DB(r,A,u.length>0):c.integers.reduce(function(m,E,w){for(;r>=E;)r-=E,m+=c.values[w];return m},"")+u},C9=function(r,s,a,c){var A="";do a||r--,A=c(r)+A,r/=s;while(r*s>=s);return A},cs=function(r,s,a,c,A){var u=a-s+1;return(r<0?"-":"")+(C9(Math.abs(r),u,c,function(m){return ls(Math.floor(m%u)+s)})+A)},cu=function(r,s,a){a===void 0&&(a=". ");var c=s.length;return C9(Math.abs(r),c,!1,function(A){return s[Math.floor(A%c)]})+a},Dp=1,mA=2,gA=4,Lg=8,ll=function(r,s,a,c,A,u){if(r<-9999||r>9999)return DB(r,4,A.length>0);var m=Math.abs(r),E=A;if(m===0)return s[0]+E;for(var w=0;m>0&&w<=4;w++){var C=m%10;C===0&&Os(u,Dp)&&E!==""?E=s[C]+E:C>1||C===1&&w===0||C===1&&w===1&&Os(u,mA)||C===1&&w===1&&Os(u,gA)&&r>100||C===1&&w>1&&Os(u,Lg)?E=s[C]+(w>0?a[w-1]:"")+E:C===1&&w>0&&(E=a[w-1]+E),m=Math.floor(m/10)}return(r<0?c:"")+E},SK="",CK="",TK="",SO="",DB=function(r,s,a){var c=a?". ":"",A=a?"":"",u=a?", ":"",m=a?" ":"";switch(s){case 0:return""+m;case 1:return""+m;case 2:return""+m;case 5:var E=cs(r,48,57,!0,c);return E.length<4?"0"+E:E;case 4:return cu(r,"",A);case 6:return wp(r,1,3999,wK,3,c).toLowerCase();case 7:return wp(r,1,3999,wK,3,c);case 8:return cs(r,945,969,!1,c);case 9:return cs(r,97,122,!1,c);case 10:return cs(r,65,90,!1,c);case 11:return cs(r,1632,1641,!0,c);case 12:case 49:return wp(r,1,9999,bK,3,c);case 35:return wp(r,1,9999,bK,3,c).toLowerCase();case 13:return cs(r,2534,2543,!0,c);case 14:case 30:return cs(r,6112,6121,!0,c);case 15:return cu(r,"",A);case 16:return cu(r,"",A);case 17:case 48:return ll(r,"",SK,"",A,mA|gA|Lg);case 47:return ll(r,"",CK,"",A,Dp|mA|gA|Lg);case 42:return ll(r,"",SK,"",A,mA|gA|Lg);case 41:return ll(r,"",CK,"",A,Dp|mA|gA|Lg);case 26:return ll(r,"","",TK,A,0);case 25:return ll(r,"","",TK,A,Dp|mA|gA);case 31:return ll(r,"","",SO,u,Dp|mA|gA);case 33:return ll(r,"","",SO,u,0);case 32:return ll(r,"","",SO,u,Dp|mA|gA);case 18:return cs(r,2406,2415,!0,c);case 20:return wp(r,1,19999,kRe,3,c);case 21:return cs(r,2790,2799,!0,c);case 22:return cs(r,2662,2671,!0,c);case 22:return wp(r,1,10999,BRe,3,c);case 23:return cu(r,"");case 24:return cu(r,"");case 27:return cs(r,3302,3311,!0,c);case 28:return cu(r,"",A);case 29:return cu(r,"",A);case 34:return cs(r,3792,3801,!0,c);case 37:return cs(r,6160,6169,!0,c);case 38:return cs(r,4160,4169,!0,c);case 39:return cs(r,2918,2927,!0,c);case 40:return cs(r,1776,1785,!0,c);case 43:return cs(r,3046,3055,!0,c);case 44:return cs(r,3174,3183,!0,c);case 45:return cs(r,3664,3673,!0,c);case 46:return cs(r,3872,3881,!0,c);case 3:default:return cs(r,48,57,!0,c)}},RK;(function(r){r[r.BEFORE=0]="BEFORE",r[r.AFTER=1]="AFTER"})(RK||(RK={}));var LRe=function(){function r(){}return r.getOrigin=function(s){var a=r._link;return a?(a.href=s,a.href=a.href,a.protocol+a.hostname+a.port):"about:blank"},r.isSameOrigin=function(s){return r.getOrigin(s)===r._origin},r.setContext=function(s){r._link=s.document.createElement("a"),r._origin=r.getOrigin(s.location.href)},r._origin="about:blank",r}(),At=function(){function r(s,a){this.type=0,this.x=s,this.y=a}return r.prototype.add=function(s,a){return new r(this.x+s,this.y+a)},r}(),bp=function(r,s,a){return new At(r.x+(s.x-r.x)*a,r.y+(s.y-r.y)*a)},Py=function(){function r(s,a,c,A){this.type=1,this.start=s,this.startControl=a,this.endControl=c,this.end=A}return r.prototype.subdivide=function(s,a){var c=bp(this.start,this.startControl,s),A=bp(this.startControl,this.endControl,s),u=bp(this.endControl,this.end,s),m=bp(c,A,s),E=bp(A,u,s),w=bp(m,E,s);return a?new r(this.start,c,m,w):new r(w,E,u,this.end)},r.prototype.add=function(s,a){return new r(this.start.add(s,a),this.startControl.add(s,a),this.endControl.add(s,a),this.end.add(s,a))},r.prototype.reverse=function(){return new r(this.end,this.endControl,this.startControl,this.start)},r}(),fo=function(r){return r.type===1},URe=function(){function r(s){var a=s.styles,c=s.bounds,A=Bg(a.borderTopLeftRadius,c.width,c.height),u=A[0],m=A[1],E=Bg(a.borderTopRightRadius,c.width,c.height),w=E[0],C=E[1],T=Bg(a.borderBottomRightRadius,c.width,c.height),N=T[0],B=T[1],k=Bg(a.borderBottomLeftRadius,c.width,c.height),Q=k[0],K=k[1],Y=[];Y.push((u+w)/c.width),Y.push((Q+N)/c.width),Y.push((m+K)/c.height),Y.push((C+B)/c.height);var F=Math.max.apply(Math,Y);F>1&&(u/=F,m/=F,w/=F,C/=F,N/=F,B/=F,Q/=F,K/=F);var M=c.width-w,V=c.height-B,W=c.width-N,q=c.height-K,te=a.borderTopWidth,re=a.borderRightWidth,de=a.borderBottomWidth,ce=a.borderLeftWidth,Ae=Er(a.paddingTop,s.bounds.width),ne=Er(a.paddingRight,s.bounds.width),ue=Er(a.paddingBottom,s.bounds.width),ye=Er(a.paddingLeft,s.bounds.width);this.topLeftBorderDoubleOuterBox=u>0||m>0?jr(c.left+ce/3,c.top+te/3,u-ce/3,m-te/3,Yn.TOP_LEFT):new At(c.left+ce/3,c.top+te/3),this.topRightBorderDoubleOuterBox=u>0||m>0?jr(c.left+M,c.top+te/3,w-re/3,C-te/3,Yn.TOP_RIGHT):new At(c.left+c.width-re/3,c.top+te/3),this.bottomRightBorderDoubleOuterBox=N>0||B>0?jr(c.left+W,c.top+V,N-re/3,B-de/3,Yn.BOTTOM_RIGHT):new At(c.left+c.width-re/3,c.top+c.height-de/3),this.bottomLeftBorderDoubleOuterBox=Q>0||K>0?jr(c.left+ce/3,c.top+q,Q-ce/3,K-de/3,Yn.BOTTOM_LEFT):new At(c.left+ce/3,c.top+c.height-de/3),this.topLeftBorderDoubleInnerBox=u>0||m>0?jr(c.left+ce*2/3,c.top+te*2/3,u-ce*2/3,m-te*2/3,Yn.TOP_LEFT):new At(c.left+ce*2/3,c.top+te*2/3),this.topRightBorderDoubleInnerBox=u>0||m>0?jr(c.left+M,c.top+te*2/3,w-re*2/3,C-te*2/3,Yn.TOP_RIGHT):new At(c.left+c.width-re*2/3,c.top+te*2/3),this.bottomRightBorderDoubleInnerBox=N>0||B>0?jr(c.left+W,c.top+V,N-re*2/3,B-de*2/3,Yn.BOTTOM_RIGHT):new At(c.left+c.width-re*2/3,c.top+c.height-de*2/3),this.bottomLeftBorderDoubleInnerBox=Q>0||K>0?jr(c.left+ce*2/3,c.top+q,Q-ce*2/3,K-de*2/3,Yn.BOTTOM_LEFT):new At(c.left+ce*2/3,c.top+c.height-de*2/3),this.topLeftBorderStroke=u>0||m>0?jr(c.left+ce/2,c.top+te/2,u-ce/2,m-te/2,Yn.TOP_LEFT):new At(c.left+ce/2,c.top+te/2),this.topRightBorderStroke=u>0||m>0?jr(c.left+M,c.top+te/2,w-re/2,C-te/2,Yn.TOP_RIGHT):new At(c.left+c.width-re/2,c.top+te/2),this.bottomRightBorderStroke=N>0||B>0?jr(c.left+W,c.top+V,N-re/2,B-de/2,Yn.BOTTOM_RIGHT):new At(c.left+c.width-re/2,c.top+c.height-de/2),this.bottomLeftBorderStroke=Q>0||K>0?jr(c.left+ce/2,c.top+q,Q-ce/2,K-de/2,Yn.BOTTOM_LEFT):new At(c.left+ce/2,c.top+c.height-de/2),this.topLeftBorderBox=u>0||m>0?jr(c.left,c.top,u,m,Yn.TOP_LEFT):new At(c.left,c.top),this.topRightBorderBox=w>0||C>0?jr(c.left+M,c.top,w,C,Yn.TOP_RIGHT):new At(c.left+c.width,c.top),this.bottomRightBorderBox=N>0||B>0?jr(c.left+W,c.top+V,N,B,Yn.BOTTOM_RIGHT):new At(c.left+c.width,c.top+c.height),this.bottomLeftBorderBox=Q>0||K>0?jr(c.left,c.top+q,Q,K,Yn.BOTTOM_LEFT):new At(c.left,c.top+c.height),this.topLeftPaddingBox=u>0||m>0?jr(c.left+ce,c.top+te,Math.max(0,u-ce),Math.max(0,m-te),Yn.TOP_LEFT):new At(c.left+ce,c.top+te),this.topRightPaddingBox=w>0||C>0?jr(c.left+Math.min(M,c.width-re),c.top+te,M>c.width+re?0:Math.max(0,w-re),Math.max(0,C-te),Yn.TOP_RIGHT):new At(c.left+c.width-re,c.top+te),this.bottomRightPaddingBox=N>0||B>0?jr(c.left+Math.min(W,c.width-ce),c.top+Math.min(V,c.height-de),Math.max(0,N-re),Math.max(0,B-de),Yn.BOTTOM_RIGHT):new At(c.left+c.width-re,c.top+c.height-de),this.bottomLeftPaddingBox=Q>0||K>0?jr(c.left+ce,c.top+Math.min(q,c.height-de),Math.max(0,Q-ce),Math.max(0,K-de),Yn.BOTTOM_LEFT):new At(c.left+ce,c.top+c.height-de),this.topLeftContentBox=u>0||m>0?jr(c.left+ce+ye,c.top+te+Ae,Math.max(0,u-(ce+ye)),Math.max(0,m-(te+Ae)),Yn.TOP_LEFT):new At(c.left+ce+ye,c.top+te+Ae),this.topRightContentBox=w>0||C>0?jr(c.left+Math.min(M,c.width+ce+ye),c.top+te+Ae,M>c.width+ce+ye?0:w-ce+ye,C-(te+Ae),Yn.TOP_RIGHT):new At(c.left+c.width-(re+ne),c.top+te+Ae),this.bottomRightContentBox=N>0||B>0?jr(c.left+Math.min(W,c.width-(ce+ye)),c.top+Math.min(V,c.height+te+Ae),Math.max(0,N-(re+ne)),B-(de+ue),Yn.BOTTOM_RIGHT):new At(c.left+c.width-(re+ne),c.top+c.height-(de+ue)),this.bottomLeftContentBox=Q>0||K>0?jr(c.left+ce+ye,c.top+q,Math.max(0,Q-(ce+ye)),K-(de+ue),Yn.BOTTOM_LEFT):new At(c.left+ce+ye,c.top+c.height-(de+ue))}return r}(),Yn;(function(r){r[r.TOP_LEFT=0]="TOP_LEFT",r[r.TOP_RIGHT=1]="TOP_RIGHT",r[r.BOTTOM_RIGHT=2]="BOTTOM_RIGHT",r[r.BOTTOM_LEFT=3]="BOTTOM_LEFT"})(Yn||(Yn={}));var jr=function(r,s,a,c,A){var u=4*((Math.sqrt(2)-1)/3),m=a*u,E=c*u,w=r+a,C=s+c;switch(A){case Yn.TOP_LEFT:return new Py(new At(r,C),new At(r,C-E),new At(w-m,s),new At(w,s));case Yn.TOP_RIGHT:return new Py(new At(r,s),new At(r+m,s),new At(w,C-E),new At(w,C));case Yn.BOTTOM_RIGHT:return new Py(new At(w,s),new At(w,s+E),new At(r+m,C),new At(r,C));case Yn.BOTTOM_LEFT:default:return new Py(new At(w,C),new At(w-m,C),new At(r,s+E),new At(r,s))}},eb=function(r){return[r.topLeftBorderBox,r.topRightBorderBox,r.bottomRightBorderBox,r.bottomLeftBorderBox]},PRe=function(r){return[r.topLeftContentBox,r.topRightContentBox,r.bottomRightContentBox,r.bottomLeftContentBox]},tb=function(r){return[r.topLeftPaddingBox,r.topRightPaddingBox,r.bottomRightPaddingBox,r.bottomLeftPaddingBox]},MRe=function(){function r(s,a,c){this.offsetX=s,this.offsetY=a,this.matrix=c,this.type=0,this.target=6}return r}(),My=function(){function r(s,a){this.path=s,this.target=a,this.type=1}return r}(),FRe=function(){function r(s){this.opacity=s,this.type=2,this.target=6}return r}(),jRe=function(r){return r.type===0},T9=function(r){return r.type===1},VRe=function(r){return r.type===2},IK=function(r,s){return r.length===s.length?r.some(function(a,c){return a===s[c]}):!1},QRe=function(r,s,a,c,A){return r.map(function(u,m){switch(m){case 0:return u.add(s,a);case 1:return u.add(s+c,a);case 2:return u.add(s+c,a+A);case 3:return u.add(s,a+A)}return u})},R9=function(){function r(s){this.element=s,this.inlineLevel=[],this.nonInlineLevel=[],this.negativeZIndex=[],this.zeroOrAutoZIndexOrTransformedOrOpacity=[],this.positiveZIndex=[],this.nonPositionedFloats=[],this.nonPositionedInlineLevel=[]}return r}(),I9=function(){function r(s,a){if(this.container=s,this.parent=a,this.effects=[],this.curves=new URe(this.container),this.container.styles.opacity<1&&this.effects.push(new FRe(this.container.styles.opacity)),this.container.styles.transform!==null){var c=this.container.bounds.left+this.container.styles.transformOrigin[0].number,A=this.container.bounds.top+this.container.styles.transformOrigin[1].number,u=this.container.styles.transform;this.effects.push(new MRe(c,A,u))}if(this.container.styles.overflowX!==0){var m=eb(this.curves),E=tb(this.curves);IK(m,E)?this.effects.push(new My(m,6)):(this.effects.push(new My(m,2)),this.effects.push(new My(E,4)))}}return r.prototype.getEffects=function(s){for(var a=[2,3].indexOf(this.container.styles.position)===-1,c=this.parent,A=this.effects.slice(0);c;){var u=c.effects.filter(function(w){return!T9(w)});if(a||c.container.styles.position!==0||!c.parent){if(A.unshift.apply(A,u),a=[2,3].indexOf(c.container.styles.position)===-1,c.container.styles.overflowX!==0){var m=eb(c.curves),E=tb(c.curves);IK(m,E)||A.unshift(new My(E,6))}}else A.unshift.apply(A,u);c=c.parent}return A.filter(function(w){return Os(w.target,s)})},r}(),oD=function(r,s,a,c){r.container.elements.forEach(function(A){var u=Os(A.flags,4),m=Os(A.flags,2),E=new I9(A,r);Os(A.styles.display,2048)&&c.push(E);var w=Os(A.flags,8)?[]:c;if(u||m){var C=u||A.styles.isPositioned()?a:s,T=new R9(E);if(A.styles.isPositioned()||A.styles.opacity<1||A.styles.isTransformed()){var N=A.styles.zIndex.order;if(N<0){var B=0;C.negativeZIndex.some(function(Q,K){return N>Q.element.container.styles.zIndex.order?(B=K,!1):B>0}),C.negativeZIndex.splice(B,0,T)}else if(N>0){var k=0;C.positiveZIndex.some(function(Q,K){return N>=Q.element.container.styles.zIndex.order?(k=K+1,!1):k>0}),C.positiveZIndex.splice(k,0,T)}else C.zeroOrAutoZIndexOrTransformedOrOpacity.push(T)}else A.styles.isFloating()?C.nonPositionedFloats.push(T):C.nonPositionedInlineLevel.push(T);oD(E,T,u?T:a,w)}else A.styles.isInlineLevel()?s.inlineLevel.push(E):s.nonInlineLevel.push(E),oD(E,s,a,w);Os(A.flags,8)&&N9(A,w)})},N9=function(r,s){for(var a=r instanceof aD?r.start:1,c=r instanceof aD?r.reversed:!1,A=0;A<s.length;A++){var u=s[A];u.container instanceof m9&&typeof u.container.value=="number"&&u.container.value!==0&&(a=u.container.value),u.listValue=DB(a,u.container.styles.listStyleType,!0),a+=c?-1:1}},HRe=function(r){var s=new I9(r,null),a=new R9(s),c=[];return oD(s,a,a,c),N9(s.container,c),a},NK=function(r,s){switch(s){case 0:return vo(r.topLeftBorderBox,r.topLeftPaddingBox,r.topRightBorderBox,r.topRightPaddingBox);case 1:return vo(r.topRightBorderBox,r.topRightPaddingBox,r.bottomRightBorderBox,r.bottomRightPaddingBox);case 2:return vo(r.bottomRightBorderBox,r.bottomRightPaddingBox,r.bottomLeftBorderBox,r.bottomLeftPaddingBox);case 3:default:return vo(r.bottomLeftBorderBox,r.bottomLeftPaddingBox,r.topLeftBorderBox,r.topLeftPaddingBox)}},GRe=function(r,s){switch(s){case 0:return vo(r.topLeftBorderBox,r.topLeftBorderDoubleOuterBox,r.topRightBorderBox,r.topRightBorderDoubleOuterBox);case 1:return vo(r.topRightBorderBox,r.topRightBorderDoubleOuterBox,r.bottomRightBorderBox,r.bottomRightBorderDoubleOuterBox);case 2:return vo(r.bottomRightBorderBox,r.bottomRightBorderDoubleOuterBox,r.bottomLeftBorderBox,r.bottomLeftBorderDoubleOuterBox);case 3:default:return vo(r.bottomLeftBorderBox,r.bottomLeftBorderDoubleOuterBox,r.topLeftBorderBox,r.topLeftBorderDoubleOuterBox)}},KRe=function(r,s){switch(s){case 0:return vo(r.topLeftBorderDoubleInnerBox,r.topLeftPaddingBox,r.topRightBorderDoubleInnerBox,r.topRightPaddingBox);case 1:return vo(r.topRightBorderDoubleInnerBox,r.topRightPaddingBox,r.bottomRightBorderDoubleInnerBox,r.bottomRightPaddingBox);case 2:return vo(r.bottomRightBorderDoubleInnerBox,r.bottomRightPaddingBox,r.bottomLeftBorderDoubleInnerBox,r.bottomLeftPaddingBox);case 3:default:return vo(r.bottomLeftBorderDoubleInnerBox,r.bottomLeftPaddingBox,r.topLeftBorderDoubleInnerBox,r.topLeftPaddingBox)}},WRe=function(r,s){switch(s){case 0:return Fy(r.topLeftBorderStroke,r.topRightBorderStroke);case 1:return Fy(r.topRightBorderStroke,r.bottomRightBorderStroke);case 2:return Fy(r.bottomRightBorderStroke,r.bottomLeftBorderStroke);case 3:default:return Fy(r.bottomLeftBorderStroke,r.topLeftBorderStroke)}},Fy=function(r,s){var a=[];return fo(r)?a.push(r.subdivide(.5,!1)):a.push(r),fo(s)?a.push(s.subdivide(.5,!0)):a.push(s),a},vo=function(r,s,a,c){var A=[];return fo(r)?A.push(r.subdivide(.5,!1)):A.push(r),fo(a)?A.push(a.subdivide(.5,!0)):A.push(a),fo(c)?A.push(c.subdivide(.5,!0).reverse()):A.push(c),fo(s)?A.push(s.subdivide(.5,!1).reverse()):A.push(s),A},O9=function(r){var s=r.bounds,a=r.styles;return s.add(a.borderLeftWidth,a.borderTopWidth,-(a.borderRightWidth+a.borderLeftWidth),-(a.borderTopWidth+a.borderBottomWidth))},nb=function(r){var s=r.styles,a=r.bounds,c=Er(s.paddingLeft,a.width),A=Er(s.paddingRight,a.width),u=Er(s.paddingTop,a.width),m=Er(s.paddingBottom,a.width);return a.add(c+s.borderLeftWidth,u+s.borderTopWidth,-(s.borderRightWidth+s.borderLeftWidth+c+A),-(s.borderTopWidth+s.borderBottomWidth+u+m))},YRe=function(r,s){return r===0?s.bounds:r===2?nb(s):O9(s)},zRe=function(r,s){return r===0?s.bounds:r===2?nb(s):O9(s)},CO=function(r,s,a){var c=YRe(Bp(r.styles.backgroundOrigin,s),r),A=zRe(Bp(r.styles.backgroundClip,s),r),u=qRe(Bp(r.styles.backgroundSize,s),a,c),m=u[0],E=u[1],w=Bg(Bp(r.styles.backgroundPosition,s),c.width-m,c.height-E),C=XRe(Bp(r.styles.backgroundRepeat,s),w,u,c,A),T=Math.round(c.left+w[0]),N=Math.round(c.top+w[1]);return[C,T,N,m,E]},Sp=function(r){return rs(r)&&r.value===nf.AUTO},jy=function(r){return typeof r=="number"},qRe=function(r,s,a){var c=s[0],A=s[1],u=s[2],m=r[0],E=r[1];if(!m)return[0,0];if(ws(m)&&E&&ws(E))return[Er(m,a.width),Er(E,a.height)];var w=jy(u);if(rs(m)&&(m.value===nf.CONTAIN||m.value===nf.COVER)){if(jy(u)){var C=a.width/a.height;return C<u!=(m.value===nf.COVER)?[a.width,a.width/u]:[a.height*u,a.height]}return[a.width,a.height]}var T=jy(c),N=jy(A),B=T||N;if(Sp(m)&&(!E||Sp(E))){if(T&&N)return[c,A];if(!w&&!B)return[a.width,a.height];if(B&&w){var k=T?c:A*u,Q=N?A:c/u;return[k,Q]}var K=T?c:a.width,Y=N?A:a.height;return[K,Y]}if(w){var F=0,M=0;return ws(m)?F=Er(m,a.width):ws(E)&&(M=Er(E,a.height)),Sp(m)?F=M*u:(!E||Sp(E))&&(M=F/u),[F,M]}var V=null,W=null;if(ws(m)?V=Er(m,a.width):E&&ws(E)&&(W=Er(E,a.height)),V!==null&&(!E||Sp(E))&&(W=T&&N?V/c*A:a.height),W!==null&&Sp(m)&&(V=T&&N?W/A*c:a.width),V!==null&&W!==null)return[V,W];throw new Error("Unable to calculate background-size for element")},Bp=function(r,s){var a=r[s];return typeof a>"u"?r[0]:a},XRe=function(r,s,a,c,A){var u=s[0],m=s[1],E=a[0],w=a[1];switch(r){case 2:return[new At(Math.round(c.left),Math.round(c.top+m)),new At(Math.round(c.left+c.width),Math.round(c.top+m)),new At(Math.round(c.left+c.width),Math.round(w+c.top+m)),new At(Math.round(c.left),Math.round(w+c.top+m))];case 3:return[new At(Math.round(c.left+u),Math.round(c.top)),new At(Math.round(c.left+u+E),Math.round(c.top)),new At(Math.round(c.left+u+E),Math.round(c.height+c.top)),new At(Math.round(c.left+u),Math.round(c.height+c.top))];case 1:return[new At(Math.round(c.left+u),Math.round(c.top+m)),new At(Math.round(c.left+u+E),Math.round(c.top+m)),new At(Math.round(c.left+u+E),Math.round(c.top+m+w)),new At(Math.round(c.left+u),Math.round(c.top+m+w))];default:return[new At(Math.round(A.left),Math.round(A.top)),new At(Math.round(A.left+A.width),Math.round(A.top)),new At(Math.round(A.left+A.width),Math.round(A.height+A.top)),new At(Math.round(A.left),Math.round(A.height+A.top))]}},JRe="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",OK="Hidden Text",$Re=function(){function r(s){this._data={},this._document=s}return r.prototype.parseMetrics=function(s,a){var c=this._document.createElement("div"),A=this._document.createElement("img"),u=this._document.createElement("span"),m=this._document.body;c.style.visibility="hidden",c.style.fontFamily=s,c.style.fontSize=a,c.style.margin="0",c.style.padding="0",c.style.whiteSpace="nowrap",m.appendChild(c),A.src=JRe,A.width=1,A.height=1,A.style.margin="0",A.style.padding="0",A.style.verticalAlign="baseline",u.style.fontFamily=s,u.style.fontSize=a,u.style.margin="0",u.style.padding="0",u.appendChild(this._document.createTextNode(OK)),c.appendChild(u),c.appendChild(A);var E=A.offsetTop-u.offsetTop+2;c.removeChild(u),c.appendChild(this._document.createTextNode(OK)),c.style.lineHeight="normal",A.style.verticalAlign="super";var w=A.offsetTop-c.offsetTop+2;return m.removeChild(c),{baseline:E,middle:w}},r.prototype.getMetrics=function(s,a){var c=s+" "+a;return typeof this._data[c]>"u"&&(this._data[c]=this.parseMetrics(s,a)),this._data[c]},r}(),x9=function(){function r(s,a){this.context=s,this.options=a}return r}(),ZRe=1e4;(function(r){rc(s,r);function s(a,c){var A=r.call(this,a,c)||this;return A._activeEffects=[],A.canvas=c.canvas?c.canvas:document.createElement("canvas"),A.ctx=A.canvas.getContext("2d"),c.canvas||(A.canvas.width=Math.floor(c.width*c.scale),A.canvas.height=Math.floor(c.height*c.scale),A.canvas.style.width=c.width+"px",A.canvas.style.height=c.height+"px"),A.fontMetrics=new $Re(document),A.ctx.scale(A.options.scale,A.options.scale),A.ctx.translate(-c.x,-c.y),A.ctx.textBaseline="bottom",A._activeEffects=[],A.context.logger.debug("Canvas renderer initialized ("+c.width+"x"+c.height+") with scale "+c.scale),A}return s.prototype.applyEffects=function(a){for(var c=this;this._activeEffects.length;)this.popEffect();a.forEach(function(A){return c.applyEffect(A)})},s.prototype.applyEffect=function(a){this.ctx.save(),VRe(a)&&(this.ctx.globalAlpha=a.opacity),jRe(a)&&(this.ctx.translate(a.offsetX,a.offsetY),this.ctx.transform(a.matrix[0],a.matrix[1],a.matrix[2],a.matrix[3],a.matrix[4],a.matrix[5]),this.ctx.translate(-a.offsetX,-a.offsetY)),T9(a)&&(this.path(a.path),this.ctx.clip()),this._activeEffects.push(a)},s.prototype.popEffect=function(){this._activeEffects.pop(),this.ctx.restore()},s.prototype.renderStack=function(a){return co(this,void 0,void 0,function(){var c;return wa(this,function(A){switch(A.label){case 0:return c=a.element.container.styles,c.isVisible()?[4,this.renderStackContent(a)]:[3,2];case 1:A.sent(),A.label=2;case 2:return[2]}})})},s.prototype.renderNode=function(a){return co(this,void 0,void 0,function(){return wa(this,function(c){switch(c.label){case 0:if(Os(a.container.flags,16))debugger;return a.container.styles.isVisible()?[4,this.renderNodeBackgroundAndBorders(a)]:[3,3];case 1:return c.sent(),[4,this.renderNodeContent(a)];case 2:c.sent(),c.label=3;case 3:return[2]}})})},s.prototype.renderTextWithLetterSpacing=function(a,c,A){var u=this;if(c===0)this.ctx.fillText(a.text,a.bounds.left,a.bounds.top+A);else{var m=OB(a.text);m.reduce(function(E,w){return u.ctx.fillText(w,E,a.bounds.top+A),E+u.ctx.measureText(w).width},a.bounds.left)}},s.prototype.createFontStyle=function(a){var c=a.fontVariant.filter(function(m){return m==="normal"||m==="small-caps"}).join(""),A=sIe(a.fontFamily).join(", "),u=W_(a.fontSize)?""+a.fontSize.number+a.fontSize.unit:a.fontSize.number+"px";return[[a.fontStyle,c,a.fontWeight,u,A].join(" "),A,u]},s.prototype.renderTextNode=function(a,c){return co(this,void 0,void 0,function(){var A,u,m,E,w,C,T,N,B=this;return wa(this,function(k){return A=this.createFontStyle(c),u=A[0],m=A[1],E=A[2],this.ctx.font=u,this.ctx.direction=c.direction===1?"rtl":"ltr",this.ctx.textAlign="left",this.ctx.textBaseline="alphabetic",w=this.fontMetrics.getMetrics(m,E),C=w.baseline,T=w.middle,N=c.paintOrder,a.textBounds.forEach(function(Q){N.forEach(function(K){switch(K){case 0:B.ctx.fillStyle=Qs(c.color),B.renderTextWithLetterSpacing(Q,c.letterSpacing,C);var Y=c.textShadow;Y.length&&Q.text.trim().length&&(Y.slice(0).reverse().forEach(function(F){B.ctx.shadowColor=Qs(F.color),B.ctx.shadowOffsetX=F.offsetX.number*B.options.scale,B.ctx.shadowOffsetY=F.offsetY.number*B.options.scale,B.ctx.shadowBlur=F.blur.number,B.renderTextWithLetterSpacing(Q,c.letterSpacing,C)}),B.ctx.shadowColor="",B.ctx.shadowOffsetX=0,B.ctx.shadowOffsetY=0,B.ctx.shadowBlur=0),c.textDecorationLine.length&&(B.ctx.fillStyle=Qs(c.textDecorationColor||c.color),c.textDecorationLine.forEach(function(F){switch(F){case 1:B.ctx.fillRect(Q.bounds.left,Math.round(Q.bounds.top+C),Q.bounds.width,1);break;case 2:B.ctx.fillRect(Q.bounds.left,Math.round(Q.bounds.top),Q.bounds.width,1);break;case 3:B.ctx.fillRect(Q.bounds.left,Math.ceil(Q.bounds.top+T),Q.bounds.width,1);break}}));break;case 1:c.webkitTextStrokeWidth&&Q.text.trim().length&&(B.ctx.strokeStyle=Qs(c.webkitTextStrokeColor),B.ctx.lineWidth=c.webkitTextStrokeWidth,B.ctx.lineJoin=window.chrome?"miter":"round",B.ctx.strokeText(Q.text,Q.bounds.left,Q.bounds.top+C)),B.ctx.strokeStyle="",B.ctx.lineWidth=0,B.ctx.lineJoin="miter";break}})}),[2]})})},s.prototype.renderReplacedElement=function(a,c,A){if(A&&a.intrinsicWidth>0&&a.intrinsicHeight>0){var u=nb(a),m=tb(c);this.path(m),this.ctx.save(),this.ctx.clip(),this.ctx.drawImage(A,0,0,a.intrinsicWidth,a.intrinsicHeight,u.left,u.top,u.width,u.height),this.ctx.restore()}},s.prototype.renderNodeContent=function(a){return co(this,void 0,void 0,function(){var c,A,u,m,E,w,M,M,C,T,N,B,W,k,Q,q,K,Y,F,M,V,W,q;return wa(this,function(te){switch(te.label){case 0:this.applyEffects(a.getEffects(4)),c=a.container,A=a.curves,u=c.styles,m=0,E=c.textNodes,te.label=1;case 1:return m<E.length?(w=E[m],[4,this.renderTextNode(w,u)]):[3,4];case 2:te.sent(),te.label=3;case 3:return m++,[3,1];case 4:if(!(c instanceof h9))return[3,8];te.label=5;case 5:return te.trys.push([5,7,,8]),[4,this.context.cache.match(c.src)];case 6:return M=te.sent(),this.renderReplacedElement(c,A,M),[3,8];case 7:return te.sent(),this.context.logger.error("Error loading image "+c.src),[3,8];case 8:if(c instanceof p9&&this.renderReplacedElement(c,A,c.canvas),!(c instanceof f9))return[3,12];te.label=9;case 9:return te.trys.push([9,11,,12]),[4,this.context.cache.match(c.svg)];case 10:return M=te.sent(),this.renderReplacedElement(c,A,M),[3,12];case 11:return te.sent(),this.context.logger.error("Error loading svg "+c.svg.substring(0,255)),[3,12];case 12:return c instanceof E9&&c.tree?(C=new s(this.context,{scale:this.options.scale,backgroundColor:c.backgroundColor,x:0,y:0,width:c.width,height:c.height}),[4,C.render(c.tree)]):[3,14];case 13:T=te.sent(),c.width&&c.height&&this.ctx.drawImage(T,0,0,c.width,c.height,c.bounds.left,c.bounds.top,c.bounds.width,c.bounds.height),te.label=14;case 14:if(c instanceof xB&&(N=Math.min(c.bounds.width,c.bounds.height),c.type===$w?c.checked&&(this.ctx.save(),this.path([new At(c.bounds.left+N*.39363,c.bounds.top+N*.79),new At(c.bounds.left+N*.16,c.bounds.top+N*.5549),new At(c.bounds.left+N*.27347,c.bounds.top+N*.44071),new At(c.bounds.left+N*.39694,c.bounds.top+N*.5649),new At(c.bounds.left+N*.72983,c.bounds.top+N*.23),new At(c.bounds.left+N*.84,c.bounds.top+N*.34085),new At(c.bounds.left+N*.39363,c.bounds.top+N*.79)]),this.ctx.fillStyle=Qs(yK),this.ctx.fill(),this.ctx.restore()):c.type===Zw&&c.checked&&(this.ctx.save(),this.ctx.beginPath(),this.ctx.arc(c.bounds.left+N/2,c.bounds.top+N/2,N/4,0,Math.PI*2,!0),this.ctx.fillStyle=Qs(yK),this.ctx.fill(),this.ctx.restore())),eIe(c)&&c.value.length){switch(B=this.createFontStyle(u),W=B[0],k=B[1],Q=this.fontMetrics.getMetrics(W,k).baseline,this.ctx.font=W,this.ctx.fillStyle=Qs(u.color),this.ctx.textBaseline="alphabetic",this.ctx.textAlign=nIe(c.styles.textAlign),q=nb(c),K=0,c.styles.textAlign){case 1:K+=q.width/2;break;case 2:K+=q.width;break}Y=q.add(K,0,0,-q.height/2+1),this.ctx.save(),this.path([new At(q.left,q.top),new At(q.left+q.width,q.top),new At(q.left+q.width,q.top+q.height),new At(q.left,q.top+q.height)]),this.ctx.clip(),this.renderTextWithLetterSpacing(new t_(c.value,Y),u.letterSpacing,Q),this.ctx.restore(),this.ctx.textBaseline="alphabetic",this.ctx.textAlign="left"}if(!Os(c.styles.display,2048))return[3,20];if(c.styles.listStyleImage===null)return[3,19];if(F=c.styles.listStyleImage,F.type!==0)return[3,18];M=void 0,V=F.url,te.label=15;case 15:return te.trys.push([15,17,,18]),[4,this.context.cache.match(V)];case 16:return M=te.sent(),this.ctx.drawImage(M,c.bounds.left-(M.width+10),c.bounds.top),[3,18];case 17:return te.sent(),this.context.logger.error("Error loading list-style-image "+V),[3,18];case 18:return[3,20];case 19:a.listValue&&c.styles.listStyleType!==-1&&(W=this.createFontStyle(u)[0],this.ctx.font=W,this.ctx.fillStyle=Qs(u.color),this.ctx.textBaseline="middle",this.ctx.textAlign="right",q=new Uu(c.bounds.left,c.bounds.top+Er(c.styles.paddingTop,c.bounds.width),c.bounds.width,iK(u.lineHeight,u.fontSize.number)/2+1),this.renderTextWithLetterSpacing(new t_(a.listValue,q),u.letterSpacing,iK(u.lineHeight,u.fontSize.number)/2+2),this.ctx.textBaseline="bottom",this.ctx.textAlign="left"),te.label=20;case 20:return[2]}})})},s.prototype.renderStackContent=function(a){return co(this,void 0,void 0,function(){var c,A,F,u,m,F,E,w,F,C,T,F,N,B,F,k,Q,F,K,Y,F;return wa(this,function(M){switch(M.label){case 0:if(Os(a.element.container.flags,16))debugger;return[4,this.renderNodeBackgroundAndBorders(a.element)];case 1:M.sent(),c=0,A=a.negativeZIndex,M.label=2;case 2:return c<A.length?(F=A[c],[4,this.renderStack(F)]):[3,5];case 3:M.sent(),M.label=4;case 4:return c++,[3,2];case 5:return[4,this.renderNodeContent(a.element)];case 6:M.sent(),u=0,m=a.nonInlineLevel,M.label=7;case 7:return u<m.length?(F=m[u],[4,this.renderNode(F)]):[3,10];case 8:M.sent(),M.label=9;case 9:return u++,[3,7];case 10:E=0,w=a.nonPositionedFloats,M.label=11;case 11:return E<w.length?(F=w[E],[4,this.renderStack(F)]):[3,14];case 12:M.sent(),M.label=13;case 13:return E++,[3,11];case 14:C=0,T=a.nonPositionedInlineLevel,M.label=15;case 15:return C<T.length?(F=T[C],[4,this.renderStack(F)]):[3,18];case 16:M.sent(),M.label=17;case 17:return C++,[3,15];case 18:N=0,B=a.inlineLevel,M.label=19;case 19:return N<B.length?(F=B[N],[4,this.renderNode(F)]):[3,22];case 20:M.sent(),M.label=21;case 21:return N++,[3,19];case 22:k=0,Q=a.zeroOrAutoZIndexOrTransformedOrOpacity,M.label=23;case 23:return k<Q.length?(F=Q[k],[4,this.renderStack(F)]):[3,26];case 24:M.sent(),M.label=25;case 25:return k++,[3,23];case 26:K=0,Y=a.positiveZIndex,M.label=27;case 27:return K<Y.length?(F=Y[K],[4,this.renderStack(F)]):[3,30];case 28:M.sent(),M.label=29;case 29:return K++,[3,27];case 30:return[2]}})})},s.prototype.mask=function(a){this.ctx.beginPath(),this.ctx.moveTo(0,0),this.ctx.lineTo(this.canvas.width,0),this.ctx.lineTo(this.canvas.width,this.canvas.height),this.ctx.lineTo(0,this.canvas.height),this.ctx.lineTo(0,0),this.formatPath(a.slice(0).reverse()),this.ctx.closePath()},s.prototype.path=function(a){this.ctx.beginPath(),this.formatPath(a),this.ctx.closePath()},s.prototype.formatPath=function(a){var c=this;a.forEach(function(A,u){var m=fo(A)?A.start:A;u===0?c.ctx.moveTo(m.x,m.y):c.ctx.lineTo(m.x,m.y),fo(A)&&c.ctx.bezierCurveTo(A.startControl.x,A.startControl.y,A.endControl.x,A.endControl.y,A.end.x,A.end.y)})},s.prototype.renderRepeat=function(a,c,A,u){this.path(a),this.ctx.fillStyle=c,this.ctx.translate(A,u),this.ctx.fill(),this.ctx.translate(-A,-u)},s.prototype.resizeImage=function(a,c,A){var u;if(a.width===c&&a.height===A)return a;var m=(u=this.canvas.ownerDocument)!==null&&u!==void 0?u:document,E=m.createElement("canvas");E.width=Math.max(1,c),E.height=Math.max(1,A);var w=E.getContext("2d");return w.drawImage(a,0,0,a.width,a.height,0,0,c,A),E},s.prototype.renderBackgroundImage=function(a){return co(this,void 0,void 0,function(){var c,A,u,m,E,w;return wa(this,function(C){switch(C.label){case 0:c=a.styles.backgroundImage.length-1,A=function(T){var N,B,k,Ae,we,Se,ye,De,de,Q,Ae,we,Se,ye,De,K,Y,F,M,V,W,q,te,re,de,ce,Ae,ne,ue,ye,De,Xe,we,Se,Qe,Ye,It,Fe,Ge,dt,Nt,hn;return wa(this,function(rr){switch(rr.label){case 0:if(T.type!==0)return[3,5];N=void 0,B=T.url,rr.label=1;case 1:return rr.trys.push([1,3,,4]),[4,u.context.cache.match(B)];case 2:return N=rr.sent(),[3,4];case 3:return rr.sent(),u.context.logger.error("Error loading background-image "+B),[3,4];case 4:return N&&(k=CO(a,c,[N.width,N.height,N.width/N.height]),Ae=k[0],we=k[1],Se=k[2],ye=k[3],De=k[4],de=u.ctx.createPattern(u.resizeImage(N,ye,De),"repeat"),u.renderRepeat(Ae,de,we,Se)),[3,6];case 5:nCe(T)?(Q=CO(a,c,[null,null,null]),Ae=Q[0],we=Q[1],Se=Q[2],ye=Q[3],De=Q[4],K=JSe(T.angle,ye,De),Y=K[0],F=K[1],M=K[2],V=K[3],W=K[4],q=document.createElement("canvas"),q.width=ye,q.height=De,te=q.getContext("2d"),re=te.createLinearGradient(F,V,M,W),rK(T.stops,Y).forEach(function(He){return re.addColorStop(He.stop,Qs(He.color))}),te.fillStyle=re,te.fillRect(0,0,ye,De),ye>0&&De>0&&(de=u.ctx.createPattern(q,"repeat"),u.renderRepeat(Ae,de,we,Se))):rCe(T)&&(ce=CO(a,c,[null,null,null]),Ae=ce[0],ne=ce[1],ue=ce[2],ye=ce[3],De=ce[4],Xe=T.position.length===0?[RB]:T.position,we=Er(Xe[0],ye),Se=Er(Xe[Xe.length-1],De),Qe=$Se(T,we,Se,ye,De),Ye=Qe[0],It=Qe[1],Ye>0&&It>0&&(Fe=u.ctx.createRadialGradient(ne+we,ue+Se,0,ne+we,ue+Se,Ye),rK(T.stops,Ye*2).forEach(function(He){return Fe.addColorStop(He.stop,Qs(He.color))}),u.path(Ae),u.ctx.fillStyle=Fe,Ye!==It?(Ge=a.bounds.left+.5*a.bounds.width,dt=a.bounds.top+.5*a.bounds.height,Nt=It/Ye,hn=1/Nt,u.ctx.save(),u.ctx.translate(Ge,dt),u.ctx.transform(1,0,0,Nt,0,0),u.ctx.translate(-Ge,-dt),u.ctx.fillRect(ne,hn*(ue-dt)+dt,ye,De*hn),u.ctx.restore()):u.ctx.fill())),rr.label=6;case 6:return c--,[2]}})},u=this,m=0,E=a.styles.backgroundImage.slice(0).reverse(),C.label=1;case 1:return m<E.length?(w=E[m],[5,A(w)]):[3,4];case 2:C.sent(),C.label=3;case 3:return m++,[3,1];case 4:return[2]}})})},s.prototype.renderSolidBorder=function(a,c,A){return co(this,void 0,void 0,function(){return wa(this,function(u){return this.path(NK(A,c)),this.ctx.fillStyle=Qs(a),this.ctx.fill(),[2]})})},s.prototype.renderDoubleBorder=function(a,c,A,u){return co(this,void 0,void 0,function(){var m,E;return wa(this,function(w){switch(w.label){case 0:return c<3?[4,this.renderSolidBorder(a,A,u)]:[3,2];case 1:return w.sent(),[2];case 2:return m=GRe(u,A),this.path(m),this.ctx.fillStyle=Qs(a),this.ctx.fill(),E=KRe(u,A),this.path(E),this.ctx.fill(),[2]}})})},s.prototype.renderNodeBackgroundAndBorders=function(a){return co(this,void 0,void 0,function(){var c,A,u,m,E,w,C,T,N=this;return wa(this,function(B){switch(B.label){case 0:return this.applyEffects(a.getEffects(2)),c=a.container.styles,A=!tf(c.backgroundColor)||c.backgroundImage.length,u=[{style:c.borderTopStyle,color:c.borderTopColor,width:c.borderTopWidth},{style:c.borderRightStyle,color:c.borderRightColor,width:c.borderRightWidth},{style:c.borderBottomStyle,color:c.borderBottomColor,width:c.borderBottomWidth},{style:c.borderLeftStyle,color:c.borderLeftColor,width:c.borderLeftWidth}],m=tIe(Bp(c.backgroundClip,0),a.curves),A||c.boxShadow.length?(this.ctx.save(),this.path(m),this.ctx.clip(),tf(c.backgroundColor)||(this.ctx.fillStyle=Qs(c.backgroundColor),this.ctx.fill()),[4,this.renderBackgroundImage(a.container)]):[3,2];case 1:B.sent(),this.ctx.restore(),c.boxShadow.slice(0).reverse().forEach(function(k){N.ctx.save();var Q=eb(a.curves),K=k.inset?0:ZRe,Y=QRe(Q,-K+(k.inset?1:-1)*k.spread.number,(k.inset?1:-1)*k.spread.number,k.spread.number*(k.inset?-2:2),k.spread.number*(k.inset?-2:2));k.inset?(N.path(Q),N.ctx.clip(),N.mask(Y)):(N.mask(Q),N.ctx.clip(),N.path(Y)),N.ctx.shadowOffsetX=k.offsetX.number+K,N.ctx.shadowOffsetY=k.offsetY.number,N.ctx.shadowColor=Qs(k.color),N.ctx.shadowBlur=k.blur.number,N.ctx.fillStyle=k.inset?Qs(k.color):"rgba(0,0,0,1)",N.ctx.fill(),N.ctx.restore()}),B.label=2;case 2:E=0,w=0,C=u,B.label=3;case 3:return w<C.length?(T=C[w],T.style!==0&&!tf(T.color)&&T.width>0?T.style!==2?[3,5]:[4,this.renderDashedDottedBorder(T.color,T.width,E,a.curves,2)]:[3,11]):[3,13];case 4:return B.sent(),[3,11];case 5:return T.style!==3?[3,7]:[4,this.renderDashedDottedBorder(T.color,T.width,E,a.curves,3)];case 6:return B.sent(),[3,11];case 7:return T.style!==4?[3,9]:[4,this.renderDoubleBorder(T.color,T.width,E,a.curves)];case 8:return B.sent(),[3,11];case 9:return[4,this.renderSolidBorder(T.color,E,a.curves)];case 10:B.sent(),B.label=11;case 11:E++,B.label=12;case 12:return w++,[3,3];case 13:return[2]}})})},s.prototype.renderDashedDottedBorder=function(a,c,A,u,m){return co(this,void 0,void 0,function(){var E,w,C,T,N,B,k,Q,K,Y,F,M,V,W,q,te,q,te;return wa(this,function(re){return this.ctx.save(),E=WRe(u,A),w=NK(u,A),m===2&&(this.path(w),this.ctx.clip()),fo(w[0])?(C=w[0].start.x,T=w[0].start.y):(C=w[0].x,T=w[0].y),fo(w[1])?(N=w[1].end.x,B=w[1].end.y):(N=w[1].x,B=w[1].y),A===0||A===2?k=Math.abs(C-N):k=Math.abs(T-B),this.ctx.beginPath(),m===3?this.formatPath(E):this.formatPath(w.slice(0,2)),Q=c<3?c*3:c*2,K=c<3?c*2:c,m===3&&(Q=c,K=c),Y=!0,k<=Q*2?Y=!1:k<=Q*2+K?(F=k/(2*Q+K),Q*=F,K*=F):(M=Math.floor((k+K)/(Q+K)),V=(k-M*Q)/(M-1),W=(k-(M+1)*Q)/M,K=W<=0||Math.abs(K-V)<Math.abs(K-W)?V:W),Y&&(m===3?this.ctx.setLineDash([0,Q+K]):this.ctx.setLineDash([Q,K])),m===3?(this.ctx.lineCap="round",this.ctx.lineWidth=c):this.ctx.lineWidth=c*2+1.1,this.ctx.strokeStyle=Qs(a),this.ctx.stroke(),this.ctx.setLineDash([]),m===2&&(fo(w[0])&&(q=w[3],te=w[0],this.ctx.beginPath(),this.formatPath([new At(q.end.x,q.end.y),new At(te.start.x,te.start.y)]),this.ctx.stroke()),fo(w[1])&&(q=w[1],te=w[2],this.ctx.beginPath(),this.formatPath([new At(q.end.x,q.end.y),new At(te.start.x,te.start.y)]),this.ctx.stroke())),this.ctx.restore(),[2]})})},s.prototype.render=function(a){return co(this,void 0,void 0,function(){var c;return wa(this,function(A){switch(A.label){case 0:return this.options.backgroundColor&&(this.ctx.fillStyle=Qs(this.options.backgroundColor),this.ctx.fillRect(this.options.x,this.options.y,this.options.width,this.options.height)),c=HRe(a),[4,this.renderStack(c)];case 1:return A.sent(),this.applyEffects([]),[2,this.canvas]}})})},s})(x9);var eIe=function(r){return r instanceof _9||r instanceof g9?!0:r instanceof xB&&r.type!==Zw&&r.type!==$w},tIe=function(r,s){switch(r){case 0:return eb(s);case 2:return PRe(s);case 1:default:return tb(s)}},nIe=function(r){switch(r){case 1:return"center";case 2:return"right";case 0:default:return"left"}},rIe=["-apple-system","system-ui"],sIe=function(r){return/iPhone OS 15_(0|1)/.test(window.navigator.userAgent)?r.filter(function(s){return rIe.indexOf(s)===-1}):r};(function(r){rc(s,r);function s(a,c){var A=r.call(this,a,c)||this;return A.canvas=c.canvas?c.canvas:document.createElement("canvas"),A.ctx=A.canvas.getContext("2d"),A.options=c,A.canvas.width=Math.floor(c.width*c.scale),A.canvas.height=Math.floor(c.height*c.scale),A.canvas.style.width=c.width+"px",A.canvas.style.height=c.height+"px",A.ctx.scale(A.options.scale,A.options.scale),A.ctx.translate(-c.x,-c.y),A.context.logger.debug("EXPERIMENTAL ForeignObject renderer initialized ("+c.width+"x"+c.height+" at "+c.x+","+c.y+") with scale "+c.scale),A}return s.prototype.render=function(a){return co(this,void 0,void 0,function(){var c,A;return wa(this,function(u){switch(u.label){case 0:return c=iD(this.options.width*this.options.scale,this.options.height*this.options.scale,this.options.scale,this.options.scale,a),[4,iIe(c)];case 1:return A=u.sent(),this.options.backgroundColor&&(this.ctx.fillStyle=Qs(this.options.backgroundColor),this.ctx.fillRect(0,0,this.options.width*this.options.scale,this.options.height*this.options.scale)),this.ctx.drawImage(A,-this.options.x*this.options.scale,-this.options.y*this.options.scale),[2,this.canvas]}})})},s})(x9);var iIe=function(r){return new Promise(function(s,a){var c=new Image;c.onload=function(){s(c)},c.onerror=a,c.src="data:image/svg+xml;charset=utf-8,"+encodeURIComponent(new XMLSerializer().serializeToString(r))})};typeof window<"u"&&LRe.setContext(window);const aIe=()=>{var Nt,hn,rr;const{profile:r}=gr(),{showNotification:s}=Hu(),[a,c]=z.useState([]),[A,u]=z.useState(0),[m,E]=z.useState(!0),[w,C]=z.useState(!1),[T,N]=z.useState(!1),[B,k]=z.useState(null),Q=z.useRef(null),[K,Y]=z.useState(!1),[F,M]=z.useState({title:"",description:"",category:"islamic_reminder",videoFile:null}),[V,W]=z.useState(0),[q,te]=z.useState(""),[re,de]=z.useState("explicit_content"),[ce,Ae]=z.useState("");z.useEffect(()=>{ue()},[]),z.useEffect(()=>{if(Q.current&&a.length>0){Q.current.play().catch(console.error),Y(!1);const He=(A+1)%a.length;if(a[He]){const Pe=document.createElement("video");Pe.src=a[He].video_url,Pe.preload="auto",Pe.load()}}},[A,a]);const ne=a[A];z.useEffect(()=>{if(!ne||K||!(r!=null&&r.id))return;const He=setTimeout(async()=>{await De(ne.id),Y(!0)},3e3);return()=>clearTimeout(He)},[ne,K,r]);const ue=async()=>{var He,Pe,yt;try{E(!0);const st=new Date(Date.now()-24*60*60*1e3).toISOString(),{data:qr,error:Ze}=await oe.from("islamic_reels").select(`
          *,
          profiles:user_id (full_name, avatar_url)
        `).eq("is_approved",!0).eq("is_active",!0).gte("created_at",st).order("created_at",{ascending:!1}).limit(50);if(Ze)throw Ze;if(r!=null&&r.id&&qr){const Qt=qr.map(Fn=>Fn.id),[wr,Oe,Et]=await Promise.all([oe.from("reel_likes").select("reel_id").eq("user_id",r.id).in("reel_id",Qt),oe.from("reel_dislikes").select("reel_id").eq("user_id",r.id).in("reel_id",Qt),oe.from("reel_favorites").select("reel_id").eq("user_id",r.id).in("reel_id",Qt)]),mt=new Set(((He=wr.data)==null?void 0:He.map(Fn=>Fn.reel_id))||[]),ut=new Set(((Pe=Oe.data)==null?void 0:Pe.map(Fn=>Fn.reel_id))||[]),Ot=new Set(((yt=Et.data)==null?void 0:yt.map(Fn=>Fn.reel_id))||[]),pn=qr.map(Fn=>({...Fn,liked_by_user:mt.has(Fn.id),disliked_by_user:ut.has(Fn.id),favorited_by_user:Ot.has(Fn.id)}));c(pn)}else c(qr||[])}catch(st){console.error("Error fetching reels:",st)}finally{E(!1)}},ye=async(He,Pe)=>{if(!(!(r!=null&&r.id)||!window.confirm("Are you sure you want to delete this reel? This action cannot be undone.")))try{const st=Pe.split("/videos/");if(st.length>1){const Ze=st[1],{error:Qt}=await oe.storage.from("videos").remove([Ze]);Qt&&console.error("Error deleting video file:",Qt)}const{error:qr}=await oe.from("islamic_reels").delete().eq("id",He).eq("user_id",r.id);if(qr)throw qr;s("Reel deleted successfully","success"),await ue()}catch(st){console.error("Error deleting reel:",st),s("Failed to delete reel: "+st.message,"error")}},De=async He=>{try{if(!(r!=null&&r.id))return;const{error:Pe}=await oe.from("reel_views").insert({reel_id:He,user_id:r.id,watched_duration_seconds:0,completed:!1});if(Pe&&Pe.code!=="23505")console.error("Error tracking view:",Pe);else{console.log(" View tracked for reel:",He);const{data:yt}=await oe.from("reel_rewards").select("*").eq("reel_id",He).eq("user_id",r.id).order("created_at",{ascending:!1}).limit(1);if(yt&&yt.length>0){const st=yt[0];await g0e(st.coins_awarded,`Your reel reached ${st.milestone_views} views!`),s(` You earned ${st.coins_awarded} coins! Your reel reached ${st.milestone_views} views!`,"success")}}}catch(Pe){console.error("Error in trackReelView:",Pe)}},Xe=()=>{A<a.length-1&&(u(He=>He+1),Se(a[A+1].id))},we=()=>{A>0&&u(He=>He-1)},Se=async He=>{try{await oe.rpc("increment_reel_views",{reel_id:He})}catch(Pe){console.error("Error incrementing views:",Pe)}},Qe=async He=>{if(r!=null&&r.id)try{const Pe=a.find(yt=>yt.id===He);if(!Pe)return;Pe.liked_by_user?(await oe.from("reel_likes").delete().eq("reel_id",He).eq("user_id",r.id),await oe.from("islamic_reels").update({likes_count:Math.max(0,Pe.likes_count-1)}).eq("id",He),c(yt=>yt.map(st=>st.id===He?{...st,likes_count:Math.max(0,st.likes_count-1),liked_by_user:!1}:st))):(Pe.disliked_by_user&&(await oe.from("reel_dislikes").delete().eq("reel_id",He).eq("user_id",r.id),await oe.from("islamic_reels").update({dislikes_count:Math.max(0,Pe.dislikes_count-1)}).eq("id",He)),await oe.from("reel_likes").insert({reel_id:He,user_id:r.id}),await oe.from("islamic_reels").update({likes_count:Pe.likes_count+1}).eq("id",He),c(yt=>yt.map(st=>st.id===He?{...st,likes_count:st.likes_count+1,dislikes_count:st.disliked_by_user?Math.max(0,st.dislikes_count-1):st.dislikes_count,liked_by_user:!0,disliked_by_user:!1}:st)))}catch(Pe){console.error("Error toggling like:",Pe)}},Ye=async He=>{if(r!=null&&r.id)try{const Pe=a.find(yt=>yt.id===He);if(!Pe)return;Pe.disliked_by_user?(await oe.from("reel_dislikes").delete().eq("reel_id",He).eq("user_id",r.id),await oe.from("islamic_reels").update({dislikes_count:Math.max(0,Pe.dislikes_count-1)}).eq("id",He),c(yt=>yt.map(st=>st.id===He?{...st,dislikes_count:Math.max(0,st.dislikes_count-1),disliked_by_user:!1}:st))):(Pe.liked_by_user&&(await oe.from("reel_likes").delete().eq("reel_id",He).eq("user_id",r.id),await oe.from("islamic_reels").update({likes_count:Math.max(0,Pe.likes_count-1)}).eq("id",He)),await oe.from("reel_dislikes").insert({reel_id:He,user_id:r.id}),await oe.from("islamic_reels").update({dislikes_count:Pe.dislikes_count+1}).eq("id",He),c(yt=>yt.map(st=>st.id===He?{...st,dislikes_count:st.dislikes_count+1,likes_count:st.liked_by_user?Math.max(0,st.likes_count-1):st.likes_count,disliked_by_user:!0,liked_by_user:!1}:st)))}catch(Pe){console.error("Error toggling dislike:",Pe)}},It=async He=>{if(r!=null&&r.id)try{const Pe=a.find(yt=>yt.id===He);if(!Pe)return;Pe.favorited_by_user?(await oe.from("reel_favorites").delete().eq("reel_id",He).eq("user_id",r.id),c(yt=>yt.map(st=>st.id===He?{...st,favorites_count:st.favorites_count-1,favorited_by_user:!1}:st))):(await oe.from("reel_favorites").insert({reel_id:He,user_id:r.id}),c(yt=>yt.map(st=>st.id===He?{...st,favorites_count:st.favorites_count+1,favorited_by_user:!0}:st)))}catch(Pe){console.error("Error toggling favorite:",Pe)}},Fe=async He=>{if(navigator.share)try{await navigator.share({title:He.title,text:He.description||"",url:window.location.href}),await oe.from("islamic_reels").update({shares_count:He.shares_count+1}).eq("id",He.id)}catch(Pe){console.error("Error sharing:",Pe)}},Ge=async()=>{if(!(!(r!=null&&r.id)||!B))try{const{error:He}=await oe.from("reel_flags").insert({reel_id:B.id,reporter_id:r.id,reason:re,description:ce});if(He)throw He;alert("Thank you for reporting. Our moderation team will review this content."),N(!1),Ae("")}catch(He){console.error("Error flagging reel:",He),He.code==="23505"&&alert("You have already flagged this content.")}},dt=async()=>{var He;if(!(r!=null&&r.id)||!F.videoFile){te("Please select a video file");return}if(!F.title.trim()){te("Please enter a title");return}try{W(5),console.log(" Starting video upload...",{fileName:F.videoFile.name,fileSize:`${(F.videoFile.size/1024/1024).toFixed(2)} MB`,fileType:F.videoFile.type});const Pe=(He=F.videoFile.name.split(".").pop())==null?void 0:He.toLowerCase(),st=`reels/${`${r.id}_${Date.now()}.${Pe}`}`,Ze={mp4:"video/mp4",mov:"video/quicktime",avi:"video/x-msvideo",webm:"video/webm",mpeg:"video/mpeg",mpg:"video/mpeg",m4v:"video/mp4"}[Pe||""]||F.videoFile.type||"video/mp4";console.log(` Uploading to: ${st} with MIME type: ${Ze}`),W(10);const Qt=setInterval(()=>{W(mt=>mt<50?mt+5:mt)},500),{error:wr}=await oe.storage.from("videos").upload(st,F.videoFile,{cacheControl:"3600",upsert:!1,contentType:Ze});if(clearInterval(Qt),wr)throw console.error(" Upload failed:",wr),wr;console.log(" Video uploaded successfully"),W(70);const{data:{publicUrl:Oe}}=oe.storage.from("videos").getPublicUrl(st);W(80);const{error:Et}=await oe.from("islamic_reels").insert({user_id:r.id,title:F.title,description:F.description,category:F.category,video_url:Oe,is_approved:!0,moderation_status:"approved"});if(Et)throw Et;W(100),s(" Reel uploaded successfully! It is now visible to all users.","success"),await m0e(r.full_name||"A user",F.title),C(!1),M({title:"",description:"",category:"islamic_reminder",videoFile:null}),W(0),te("")}catch(Pe){console.error("Error uploading reel:",Pe),console.error("Error details:",{message:Pe.message,code:Pe.code,details:Pe.details,hint:Pe.hint}),te(`Failed to upload: ${Pe.message||"Please try again."}`),W(0)}};return m?p.jsx(yr,{title:"Islamic Reels",children:p.jsx("div",{className:"flex items-center justify-center h-96",children:p.jsxs("div",{className:"text-center",children:[p.jsx(Px,{className:"h-12 w-12 animate-spin mx-auto mb-4 text-primary"}),p.jsx("p",{children:"Loading reels..."})]})})}):p.jsx(yr,{title:"Islamic Reels",children:p.jsxs("div",{className:"p-4 space-y-4",children:[p.jsxs(Re,{onClick:()=>C(!0),className:"w-full bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700",children:[p.jsx(rO,{className:"h-4 w-4 mr-2"}),"Upload Reel"]}),p.jsx("div",{className:"flex gap-2 overflow-x-auto pb-2",children:["All","Quran","Dua","Reminder","Food","Travel","Education"].map(He=>p.jsx(Re,{variant:"outline",size:"sm",className:"whitespace-nowrap",children:He},He))}),ne&&p.jsxs(qe,{className:"overflow-hidden",children:[p.jsxs("div",{className:"relative bg-black aspect-[9/16]",children:[p.jsx("video",{ref:Q,src:ne.video_url,poster:ne.thumbnail_url||void 0,loop:!0,playsInline:!0,preload:"auto",muted:!1,autoPlay:!0,className:"w-full h-full object-contain",onClick:()=>{var He,Pe,yt;return(He=Q.current)!=null&&He.paused?(Pe=Q.current)==null?void 0:Pe.play():(yt=Q.current)==null?void 0:yt.pause()},onLoadStart:()=>console.log("Video loading started"),onCanPlay:()=>console.log("Video can play"),onError:He=>console.error("Video error:",He)}),p.jsx("div",{className:"absolute bottom-0 left-0 right-0 p-4 bg-gradient-to-t from-black/80 to-transparent text-white",children:p.jsxs("div",{className:"flex items-start gap-3",children:[p.jsx("img",{src:((Nt=ne.profiles)==null?void 0:Nt.avatar_url)||"https://via.placeholder.com/40",alt:(hn=ne.profiles)==null?void 0:hn.full_name,className:"w-10 h-10 rounded-full border-2 border-white"}),p.jsxs("div",{className:"flex-1",children:[p.jsx("h3",{className:"font-bold text-lg",children:ne.title}),p.jsx("p",{className:"text-sm opacity-90",children:(rr=ne.profiles)==null?void 0:rr.full_name}),ne.description&&p.jsx("p",{className:"text-sm mt-2 opacity-75",children:ne.description})]})]})}),p.jsxs("div",{className:"absolute right-2 bottom-20 flex flex-col gap-3",children:[p.jsxs("button",{onClick:()=>Qe(ne.id),className:"flex flex-col items-center gap-0.5",children:[p.jsx("div",{className:`w-10 h-10 rounded-full ${ne.liked_by_user?"bg-red-500":"bg-white/20"} flex items-center justify-center backdrop-blur-sm`,children:p.jsx(Ma,{className:`h-5 w-5 ${ne.liked_by_user?"fill-white":""} text-white`})}),p.jsx("span",{className:"text-white text-[10px] font-medium",children:ne.likes_count})]}),p.jsxs("button",{onClick:()=>Ye(ne.id),className:"flex flex-col items-center gap-0.5",children:[p.jsx("div",{className:`w-10 h-10 rounded-full ${ne.disliked_by_user?"bg-gray-700":"bg-white/20"} flex items-center justify-center backdrop-blur-sm`,children:p.jsx(b_,{className:`h-5 w-5 ${ne.disliked_by_user?"fill-white":""} text-white`})}),p.jsx("span",{className:"text-white text-[10px] font-medium",children:ne.dislikes_count})]}),p.jsxs("button",{className:"flex flex-col items-center gap-0.5",children:[p.jsx("div",{className:"w-10 h-10 rounded-full bg-white/20 flex items-center justify-center backdrop-blur-sm",children:p.jsx(Nl,{className:"h-5 w-5 text-white"})}),p.jsx("span",{className:"text-white text-[10px] font-medium",children:ne.comments_count})]}),p.jsxs("button",{onClick:()=>It(ne.id),className:"flex flex-col items-center gap-0.5",children:[p.jsx("div",{className:`w-10 h-10 rounded-full ${ne.favorited_by_user?"bg-yellow-500":"bg-white/20"} flex items-center justify-center backdrop-blur-sm`,children:p.jsx(CEe,{className:`h-5 w-5 ${ne.favorited_by_user?"fill-white":""} text-white`})}),p.jsx("span",{className:"text-white text-[10px] font-medium",children:ne.favorites_count})]}),p.jsxs("button",{onClick:()=>Fe(ne),className:"flex flex-col items-center gap-0.5",children:[p.jsx("div",{className:"w-10 h-10 rounded-full bg-white/20 flex items-center justify-center backdrop-blur-sm",children:p.jsx(Pve,{className:"h-5 w-5 text-white"})}),p.jsx("span",{className:"text-white text-[10px] font-medium",children:ne.shares_count})]}),p.jsx("button",{onClick:()=>{k(ne),N(!0)},className:"flex flex-col items-center gap-0.5",children:p.jsx("div",{className:"w-10 h-10 rounded-full bg-white/20 flex items-center justify-center backdrop-blur-sm",children:p.jsx(dG,{className:"h-4 w-4 text-white"})})}),(r==null?void 0:r.id)===ne.user_id&&p.jsx("button",{onClick:()=>ye(ne.id,ne.video_url),className:"flex flex-col items-center gap-0.5",children:p.jsx("div",{className:"w-10 h-10 rounded-full bg-red-500/80 flex items-center justify-center backdrop-blur-sm",children:p.jsx(lq,{className:"h-4 w-4 text-white"})})}),p.jsxs("div",{className:"flex flex-col items-center gap-0.5 mt-1",children:[p.jsx(sq,{className:"h-3.5 w-3.5 text-white"}),p.jsx("span",{className:"text-white text-[10px]",children:ne.views_count})]})]})]}),p.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50",children:[p.jsx(Re,{onClick:we,disabled:A===0,variant:"outline",size:"sm",children:"Previous"}),p.jsxs("span",{className:"text-sm text-gray-600",children:[A+1," / ",a.length]}),p.jsx(Re,{onClick:Xe,disabled:A===a.length-1,variant:"outline",size:"sm",children:"Next"})]})]}),a.length===0&&p.jsx(qe,{children:p.jsxs($e,{className:"p-8 text-center",children:[p.jsx(Px,{className:"h-16 w-16 mx-auto mb-4 text-gray-400"}),p.jsx("h3",{className:"font-bold text-lg mb-2",children:"No Reels Yet"}),p.jsx("p",{className:"text-gray-600 mb-4",children:"Be the first to upload an Islamic reel!"}),p.jsxs(Re,{onClick:()=>C(!0),children:[p.jsx(rO,{className:"h-4 w-4 mr-2"}),"Upload Reel"]})]})}),w&&p.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:p.jsxs(qe,{className:"w-full max-w-lg max-h-[90vh] overflow-y-auto",children:[p.jsx(Pt,{children:p.jsxs("div",{className:"flex items-center justify-between",children:[p.jsxs(Vt,{className:"flex items-center gap-2",children:[p.jsx(rO,{className:"h-5 w-5"}),"Upload Reel"]}),p.jsx(Re,{variant:"ghost",size:"sm",onClick:()=>C(!1),children:p.jsx(Hw,{className:"h-4 w-4"})})]})}),p.jsxs($e,{className:"space-y-4",children:[p.jsxs("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-3 flex items-start gap-2",children:[p.jsx(Aq,{className:"h-5 w-5 text-amber-600 flex-shrink-0 mt-0.5"}),p.jsxs("div",{className:"text-sm text-amber-800",children:[p.jsx("p",{className:"font-medium mb-1",children:"Content Moderation Policy"}),p.jsxs("ul",{className:"list-disc list-inside space-y-1 text-xs",children:[p.jsx("li",{children:"No explicit or inappropriate content"}),p.jsx("li",{children:"Must be Islamic-themed or educational"}),p.jsx("li",{children:"Respectful language only"}),p.jsx("li",{children:"All reels reviewed before approval"})]})]})]}),q&&p.jsx("div",{className:"bg-red-50 border border-red-200 text-red-800 p-3 rounded-lg text-sm",children:q}),p.jsxs("div",{children:[p.jsx("label",{className:"block text-sm font-medium mb-2",children:"Video File *"}),p.jsx("input",{type:"file",accept:"video/*",onChange:He=>M(Pe=>{var yt;return{...Pe,videoFile:((yt=He.target.files)==null?void 0:yt[0])||null}}),className:"w-full border rounded-lg p-2 text-sm"}),p.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Max 100MB, MP4 recommended"})]}),p.jsxs("div",{children:[p.jsx("label",{className:"block text-sm font-medium mb-2",children:"Title *"}),p.jsx(er,{value:F.title,onChange:He=>M(Pe=>({...Pe,title:He.target.value})),placeholder:"e.g., Beautiful Quran Recitation",maxLength:100})]}),p.jsxs("div",{children:[p.jsx("label",{className:"block text-sm font-medium mb-2",children:"Description"}),p.jsx("textarea",{className:"w-full p-2 border rounded-md",value:F.description,onChange:He=>M(Pe=>({...Pe,description:He.target.value})),placeholder:"Tell viewers about your reel...",rows:3,maxLength:500})]}),p.jsxs("div",{children:[p.jsx("label",{className:"block text-sm font-medium mb-2",children:"Category *"}),p.jsxs("select",{value:F.category,onChange:He=>M(Pe=>({...Pe,category:He.target.value})),className:"w-full border rounded-lg p-2",children:[p.jsx("option",{value:"quran_recitation",children:"Quran Recitation"}),p.jsx("option",{value:"dua",children:"Dua"}),p.jsx("option",{value:"islamic_reminder",children:"Islamic Reminder"}),p.jsx("option",{value:"halal_food",children:"Halal Food"}),p.jsx("option",{value:"travel",children:"Travel"}),p.jsx("option",{value:"education",children:"Education"}),p.jsx("option",{value:"lifestyle",children:"Lifestyle"})]})]}),V>0&&p.jsxs("div",{children:[p.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:p.jsx("div",{className:"bg-primary h-2 rounded-full transition-all",style:{width:`${V}%`}})}),p.jsxs("p",{className:"text-xs text-center mt-1",children:[V,"%"]})]}),p.jsx(Re,{onClick:dt,disabled:V>0,className:"w-full",children:V>0?"Uploading...":"Upload Reel"})]})]})}),T&&B&&p.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:p.jsxs(qe,{className:"w-full max-w-md",children:[p.jsx(Pt,{children:p.jsxs("div",{className:"flex items-center justify-between",children:[p.jsxs(Vt,{className:"flex items-center gap-2",children:[p.jsx(dG,{className:"h-5 w-5 text-red-600"}),"Report Content"]}),p.jsx(Re,{variant:"ghost",size:"sm",onClick:()=>N(!1),children:p.jsx(Hw,{className:"h-4 w-4"})})]})}),p.jsxs($e,{className:"space-y-4",children:[p.jsx("p",{className:"text-sm text-gray-600",children:"Why are you reporting this reel?"}),p.jsxs("div",{children:[p.jsx("label",{className:"block text-sm font-medium mb-2",children:"Reason *"}),p.jsxs("select",{value:re,onChange:He=>de(He.target.value),className:"w-full border rounded-lg p-2",children:[p.jsx("option",{value:"explicit_content",children:"Explicit/Inappropriate Content"}),p.jsx("option",{value:"harassment",children:"Harassment or Hate Speech"}),p.jsx("option",{value:"spam",children:"Spam"}),p.jsx("option",{value:"misinformation",children:"Misinformation"}),p.jsx("option",{value:"other",children:"Other"})]})]}),p.jsxs("div",{children:[p.jsx("label",{className:"block text-sm font-medium mb-2",children:"Additional Details"}),p.jsx("textarea",{className:"w-full p-2 border rounded-md",value:ce,onChange:He=>Ae(He.target.value),placeholder:"Please provide more information...",rows:3})]}),p.jsxs("div",{className:"flex gap-2",children:[p.jsx(Re,{variant:"outline",onClick:()=>N(!1),className:"flex-1",children:"Cancel"}),p.jsx(Re,{onClick:Ge,className:"flex-1 bg-red-600 hover:bg-red-700",children:"Submit Report"})]})]})]})})]})})},oIe=()=>{const r=ss(),[s,a]=z.useState(""),[c,A]=z.useState("all"),u=["all","Mediterranean","Turkish","Arabic","Pakistani","Egyptian","Moroccan"],E=[].filter(w=>{const C=w.name.toLowerCase().includes(s.toLowerCase())||w.cuisine.toLowerCase().includes(s.toLowerCase()),T=c==="all"||w.cuisine.toLowerCase().includes(c.toLowerCase());return C&&T});return p.jsxs("div",{className:"min-h-screen bg-gradient-to-b from-emerald-50 to-white pb-20",children:[p.jsxs("div",{className:"bg-gradient-to-r from-emerald-600 to-emerald-700 text-white p-4 sticky top-0 z-10 shadow-lg",children:[p.jsxs("div",{className:"flex items-center mb-3",children:[p.jsx(Re,{variant:"ghost",size:"icon",className:"text-white hover:bg-emerald-500 mr-2",onClick:()=>r(-1),children:p.jsx(Qu,{className:"h-6 w-6"})}),p.jsxs("div",{children:[p.jsx("h1",{className:"text-xl font-bold",children:"Halal Restaurants"}),p.jsx("p",{className:"text-sm text-emerald-100",children:"Discover local dining options"})]})]}),p.jsxs("div",{className:"relative",children:[p.jsx(Bve,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),p.jsx(er,{type:"text",placeholder:"Search restaurants...",value:s,onChange:w=>a(w.target.value),className:"pl-10 bg-white text-gray-900"})]})]}),p.jsx("div",{className:"px-4 py-3 bg-white shadow-sm overflow-x-auto",children:p.jsx("div",{className:"flex gap-2",children:u.map(w=>p.jsx("button",{onClick:()=>A(w),className:`px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap transition-colors ${c===w?"bg-emerald-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:w.charAt(0).toUpperCase()+w.slice(1)},w))})}),p.jsxs("div",{className:"px-4 py-2 text-sm text-gray-600",children:[E.length," restaurant",E.length!==1?"s":""," found"]}),p.jsxs("div",{className:"px-4 space-y-4",children:[E.map(w=>p.jsxs(qe,{className:"overflow-hidden hover:shadow-lg transition-shadow",children:[p.jsxs("div",{className:"flex",children:[p.jsx("div",{className:"w-32 h-32 flex-shrink-0",children:p.jsx("img",{src:w.image,alt:w.name,className:"w-full h-full object-cover"})}),p.jsxs($e,{className:"flex-1 p-3",children:[p.jsxs("div",{className:"flex items-start justify-between mb-1",children:[p.jsx("h3",{className:"font-semibold text-gray-900 text-base leading-tight",children:w.name}),w.halal&&p.jsx("span",{className:"bg-green-100 text-green-800 text-xs px-2 py-0.5 rounded-full ml-2 flex-shrink-0",children:"Halal "})]}),p.jsxs("div",{className:"flex items-center text-sm text-gray-600 mb-2",children:[p.jsx(Qw,{className:"h-3.5 w-3.5 mr-1"}),p.jsx("span",{className:"text-xs",children:w.cuisine}),p.jsx("span",{className:"mx-2 text-gray-400",children:""}),p.jsx("span",{className:"text-xs font-medium text-gray-700",children:w.priceRange})]}),p.jsxs("div",{className:"flex items-center mb-2",children:[p.jsxs("div",{className:"flex items-center",children:[p.jsx(xf,{className:"h-4 w-4 fill-yellow-400 text-yellow-400 mr-1"}),p.jsx("span",{className:"font-semibold text-sm",children:w.rating}),p.jsxs("span",{className:"text-gray-500 text-xs ml-1",children:["(",w.reviews,")"]})]}),w.delivery&&p.jsx("span",{className:"ml-auto bg-blue-100 text-blue-800 text-xs px-2 py-0.5 rounded",children:" Delivery"})]}),p.jsxs("div",{className:"flex items-start text-xs text-gray-600 mb-1",children:[p.jsx(wl,{className:"h-3.5 w-3.5 mr-1 mt-0.5 flex-shrink-0"}),p.jsx("span",{className:"line-clamp-1",children:w.address})]}),p.jsxs("div",{className:"flex items-center text-xs text-gray-600",children:[p.jsx(Pa,{className:"h-3.5 w-3.5 mr-1 flex-shrink-0"}),p.jsx("span",{className:"truncate",children:w.hours})]})]})]}),p.jsx("div",{className:"px-3 pb-3",children:p.jsxs(Re,{variant:"outline",size:"sm",className:"w-full",onClick:()=>window.open(`tel:${w.phone}`),children:[p.jsx(mf,{className:"h-4 w-4 mr-2"}),"Call Now"]})})]},w.id)),E.length===0&&p.jsxs("div",{className:"text-center py-12",children:[p.jsx(Qw,{className:"h-16 w-16 text-gray-300 mx-auto mb-3"}),p.jsx("p",{className:"text-gray-500",children:"No restaurants found"}),p.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"Try adjusting your search or filters"})]})]})]})},cIe=()=>{const[r,s]=z.useState([]),[a,c]=z.useState([]),[A,u]=z.useState("activities"),[m,E]=z.useState("all"),[w,C]=z.useState(!0);z.useEffect(()=>{T()},[]);const T=async()=>{try{C(!0);const{data:K,error:Y}=await oe.from("activities").select("*").eq("is_active",!0).order("start_time",{ascending:!0});if(Y)throw Y;s(K||[]);const{data:F,error:M}=await oe.from("restaurants").select("*").eq("is_active",!0).order("rating",{ascending:!1});if(M)throw M;c(F||[])}catch(K){console.error("Error fetching data:",K)}finally{C(!1)}},N=K=>new Date(K).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),B=K=>{switch(K){case"education":return p.jsx(w_,{className:"h-4 w-4"});case"charity":return p.jsx(Ma,{className:"h-4 w-4"});case"community":return p.jsx(yi,{className:"h-4 w-4"});case"worship":return p.jsx(OEe,{className:"h-4 w-4"});case"youth":return p.jsx(yi,{className:"h-4 w-4"});default:return p.jsx(fr,{className:"h-4 w-4"})}},k=m==="all"?r:r.filter(K=>K.category===m),Q=["all","education","charity","community","worship","youth"];return p.jsx(yr,{title:"Community",children:p.jsxs("div",{className:"p-4 space-y-4",children:[p.jsxs("div",{className:"flex gap-2",children:[p.jsxs(Re,{onClick:()=>u("activities"),variant:A==="activities"?"default":"outline",className:"flex-1",children:[p.jsx(fr,{className:"h-4 w-4 mr-2"}),"Activities (",r.length,")"]}),p.jsxs(Re,{onClick:()=>u("restaurants"),variant:A==="restaurants"?"default":"outline",className:"flex-1",children:[p.jsx(Qw,{className:"h-4 w-4 mr-2"}),"Restaurants (",a.length,")"]})]}),A==="activities"&&p.jsxs(p.Fragment,{children:[p.jsx("div",{className:"flex gap-2 overflow-x-auto pb-2",children:Q.map(K=>p.jsx(Re,{onClick:()=>E(K),variant:m===K?"default":"outline",size:"sm",className:"whitespace-nowrap capitalize",children:K},K))}),p.jsxs("div",{className:"space-y-4",children:[k.map(K=>p.jsxs(qe,{className:"overflow-hidden hover:shadow-lg transition-shadow",children:[K.image_url&&p.jsx("img",{src:K.image_url,alt:K.title,className:"w-full h-48 object-cover"}),p.jsxs($e,{className:"p-4 space-y-3",children:[p.jsx("div",{className:"flex items-start justify-between",children:p.jsxs("div",{className:"flex-1",children:[p.jsx("div",{className:"flex items-center gap-2 mb-2",children:p.jsxs("span",{className:"px-2 py-1 bg-primary/10 text-primary rounded-full text-xs font-medium flex items-center gap-1 capitalize",children:[B(K.category),K.category]})}),p.jsx("h3",{className:"font-bold text-lg mb-1",children:K.title}),p.jsx("p",{className:"text-sm text-gray-600 line-clamp-2",children:K.description})]})}),p.jsxs("div",{className:"space-y-2 text-sm text-gray-600",children:[p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx(Pa,{className:"h-4 w-4 text-primary"}),p.jsx("span",{children:N(K.start_time)})]}),p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx(wl,{className:"h-4 w-4 text-primary"}),p.jsx("span",{children:K.location})]}),K.max_participants&&p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx(yi,{className:"h-4 w-4 text-primary"}),p.jsxs("span",{children:[K.current_participants," / ",K.max_participants," registered"]})]})]}),p.jsx(Re,{className:"w-full",children:"Register Now"})]})]},K.id)),k.length===0&&p.jsx(qe,{children:p.jsxs($e,{className:"p-8 text-center",children:[p.jsx(fr,{className:"h-16 w-16 mx-auto mb-4 text-gray-400"}),p.jsx("h3",{className:"font-bold text-lg mb-2",children:"No Activities Found"}),p.jsx("p",{className:"text-gray-600",children:"Check back soon for upcoming events!"})]})})]})]}),A==="restaurants"&&p.jsxs("div",{className:"space-y-4",children:[a.map(K=>p.jsxs(qe,{className:"overflow-hidden hover:shadow-lg transition-shadow",children:[K.image_url&&p.jsx("img",{src:K.image_url,alt:K.name,className:"w-full h-48 object-cover"}),p.jsxs($e,{className:"p-4 space-y-3",children:[p.jsx("div",{className:"flex items-start justify-between",children:p.jsxs("div",{className:"flex-1",children:[p.jsx("h3",{className:"font-bold text-lg mb-1",children:K.name}),p.jsx("p",{className:"text-sm text-gray-600 mb-2",children:K.description}),p.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[p.jsx("span",{className:"px-2 py-1 bg-emerald-100 text-emerald-800 rounded-full text-xs font-medium",children:K.cuisine_type}),K.halal_certified&&p.jsx("span",{className:"px-2 py-1 bg-green-100 text-green-800 rounded-full text-xs font-medium",children:" Halal Certified"}),K.delivery_available&&p.jsx("span",{className:"px-2 py-1 bg-blue-100 text-blue-800 rounded-full text-xs font-medium",children:" Delivery"})]})]})}),p.jsxs("div",{className:"space-y-2 text-sm text-gray-600",children:[p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx(xf,{className:"h-4 w-4 text-amber-500 fill-amber-500"}),p.jsx("span",{className:"font-medium",children:K.rating}),p.jsx("span",{className:"text-gray-400",children:""}),p.jsx("span",{children:K.price_range})]}),p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx(wl,{className:"h-4 w-4 text-primary"}),p.jsx("span",{children:K.address})]}),p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx(mf,{className:"h-4 w-4 text-primary"}),p.jsx("a",{href:`tel:${K.phone}`,className:"text-primary hover:underline",children:K.phone})]})]}),p.jsxs("div",{className:"flex gap-2",children:[p.jsx(Re,{className:"flex-1",variant:"outline",children:"View Menu"}),p.jsx(Re,{className:"flex-1",children:"Order Now"})]})]})]},K.id)),a.length===0&&p.jsx(qe,{children:p.jsxs($e,{className:"p-8 text-center",children:[p.jsx(Qw,{className:"h-16 w-16 mx-auto mb-4 text-gray-400"}),p.jsx("h3",{className:"font-bold text-lg mb-2",children:"No Restaurants Found"}),p.jsx("p",{className:"text-gray-600",children:"Check back soon for halal dining options!"})]})})]}),w&&p.jsx("div",{className:"flex items-center justify-center py-8",children:p.jsxs("div",{className:"text-center",children:[p.jsx("div",{className:"animate-spin h-8 w-8 border-4 border-primary border-t-transparent rounded-full mx-auto mb-2"}),p.jsx("p",{className:"text-sm text-gray-600",children:"Loading..."})]})})]})})};function lIe(){const r=ss(),s=[{icon:fr,title:"Prayer Times",description:"Accurate prayer times for your location with notifications"},{icon:w_,title:"Quran Reader",description:"Read and study the Holy Quran with translations"},{icon:yi,title:"Scholar Consultation",description:"Connect with verified Islamic scholars and imams"},{icon:Tb,title:"Masjid Coin",description:"Earn rewards and support your community"},{icon:iq,title:"Live Streams",description:"Watch live Islamic lectures and prayer services"},{icon:Nl,title:"Community",description:"Connect with Muslims worldwide"}];return p.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-emerald-50 via-white to-emerald-50",children:[p.jsx("header",{className:"bg-white shadow-sm sticky top-0 z-50",children:p.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 flex justify-between items-center",children:[p.jsx("div",{className:"flex items-center gap-3",children:p.jsx("img",{src:"/masjid-logo.png",alt:"Masjid",className:"h-12 w-auto",style:{filter:"drop-shadow(0 2px 8px rgba(5, 150, 105, 0.3))"}})}),p.jsxs("div",{className:"flex gap-2",children:[p.jsx(Re,{variant:"ghost",onClick:()=>r("/signin"),className:"text-emerald-700 hover:text-emerald-800 hover:bg-emerald-50",children:"Sign In"}),p.jsx(Re,{onClick:()=>r("/signup"),className:"bg-emerald-600 hover:bg-emerald-700 text-white",children:"Get Started"})]})]})}),p.jsxs("section",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-20 text-center",children:[p.jsx("div",{className:"mb-8 flex justify-center",children:p.jsxs("div",{className:"relative",children:[p.jsx("div",{className:"absolute inset-0 bg-emerald-300/30 rounded-full blur-3xl animate-pulse"}),p.jsx("img",{src:"/masjid-logo.png",alt:"Masjid Mobile",className:"h-48 w-auto relative z-10",style:{filter:"drop-shadow(0 0 20px rgba(255, 255, 255, 0.9)) drop-shadow(0 0 40px rgba(16, 185, 129, 0.6)) drop-shadow(0 4px 20px rgba(0, 0, 0, 0.3))",transform:"scale(1.1)"}})]})}),p.jsx("h1",{className:"text-5xl md:text-6xl font-bold text-gray-900 mb-4",style:{fontFamily:'"Amiri", serif'},children:"   "}),p.jsx("p",{className:"text-xl md:text-2xl text-emerald-700 font-semibold mb-3",style:{fontFamily:'"Amiri", serif'},children:"As-salamu alaykum"}),p.jsx("h2",{className:"text-4xl md:text-5xl font-bold text-gray-900 mb-6",children:"Your Islamic Community Hub"}),p.jsx("p",{className:"text-xl text-gray-600 mb-8 max-w-2xl mx-auto",children:"Connect with scholars, read Quran, track prayer times, and strengthen your faith with our comprehensive Islamic mobile platform."}),p.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center",children:[p.jsxs(Re,{size:"lg",onClick:()=>r("/signup"),className:"bg-emerald-600 hover:bg-emerald-700 text-white text-lg px-8 py-6 shadow-lg hover:shadow-xl transition-all",children:[p.jsx(tq,{className:"mr-2 h-5 w-5"}),"Join the Community"]}),p.jsx(Re,{size:"lg",variant:"outline",onClick:()=>r("/signin"),className:"border-emerald-600 text-emerald-700 hover:bg-emerald-50 text-lg px-8 py-6",children:"Sign In"})]})]}),p.jsxs("section",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-20 bg-white",children:[p.jsx("h3",{className:"text-3xl font-bold text-center text-gray-900 mb-12",children:"Everything You Need for Your Islamic Journey"}),p.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8",children:s.map((a,c)=>{const A=a.icon;return p.jsx(qe,{className:"border-2 border-emerald-100 hover:border-emerald-300 hover:shadow-lg transition-all",children:p.jsxs($e,{className:"p-6",children:[p.jsx("div",{className:"w-12 h-12 bg-emerald-100 rounded-lg flex items-center justify-center mb-4",children:p.jsx(A,{className:"h-6 w-6 text-emerald-600"})}),p.jsx("h4",{className:"text-xl font-semibold text-gray-900 mb-2",children:a.title}),p.jsx("p",{className:"text-gray-600",children:a.description})]})},c)})})]}),p.jsx("section",{className:"bg-gradient-to-r from-emerald-600 to-emerald-700 text-white py-20",children:p.jsxs("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 text-center",children:[p.jsx("h3",{className:"text-3xl md:text-4xl font-bold mb-4",children:"Ready to Start Your Journey?"}),p.jsx("p",{className:"text-xl text-emerald-100 mb-8",children:"Join thousands of Muslims using Masjid Mobile to strengthen their faith and connect with the community."}),p.jsx(Re,{size:"lg",onClick:()=>r("/signup"),className:"bg-white text-emerald-700 hover:bg-emerald-50 text-lg px-8 py-6 shadow-lg",children:"Create Free Account"})]})}),p.jsx("footer",{className:"bg-gray-900 text-gray-300 py-12",children:p.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[p.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-8",children:[p.jsxs("div",{children:[p.jsx("img",{src:"/masjid-logo.png",alt:"Masjid",className:"h-10 w-auto mb-4 brightness-0 invert"}),p.jsx("p",{className:"text-sm",children:"Your trusted Islamic community platform"})]}),p.jsxs("div",{children:[p.jsx("h4",{className:"font-semibold text-white mb-4",children:"Quick Links"}),p.jsxs("ul",{className:"space-y-2 text-sm",children:[p.jsx("li",{children:p.jsx("a",{href:"/privacy-policy",className:"hover:text-emerald-400 transition-colors",children:"Privacy Policy"})}),p.jsx("li",{children:p.jsx("a",{href:"/terms-of-service",className:"hover:text-emerald-400 transition-colors",children:"Terms of Service"})})]})]}),p.jsxs("div",{children:[p.jsx("h4",{className:"font-semibold text-white mb-4",children:"Contact"}),p.jsx("p",{className:"text-sm",children:"Email: support@masjidmobile.com"})]})]}),p.jsx("div",{className:"mt-8 pt-8 border-t border-gray-800 text-center text-sm",children:p.jsx("p",{children:" 2025 Masjid Mobile. All rights reserved."})})]})})]})}function AIe(){return z.useEffect(()=>{h0e().catch(console.error)},[]),p.jsx(Mme,{children:p.jsx(aEe,{children:p.jsx(u0e,{children:p.jsxs("div",{id:"app-root",className:"min-h-screen bg-background",children:[p.jsxs(Lme,{children:[p.jsx(Zt,{path:"/",element:p.jsx(fye,{})}),p.jsx(Zt,{path:"/landing",element:p.jsx(lIe,{})}),p.jsx(Zt,{path:"/signin",element:p.jsx(dye,{})}),p.jsx(Zt,{path:"/signup",element:p.jsx(uye,{})}),p.jsx(Zt,{path:"/privacy-policy",element:p.jsx(mye,{})}),p.jsx(Zt,{path:"/terms-of-service",element:p.jsx(gye,{})}),p.jsx(Zt,{path:"/token-diagnostics",element:p.jsx(Rn,{children:p.jsx(sbe,{})})}),p.jsx(Zt,{path:"/dashboard",element:p.jsx(Rn,{children:p.jsx(pye,{})})}),p.jsx(Zt,{path:"/prayer-times",element:p.jsx(Rn,{children:p.jsx(kwe,{})})}),p.jsx(Zt,{path:"/quran",element:p.jsx(Rn,{children:p.jsx(Lwe,{})})}),p.jsx(Zt,{path:"/qibla",element:p.jsx(Rn,{children:p.jsx(Uwe,{})})}),p.jsx(Zt,{path:"/watch-stream/:channelName",element:p.jsx(Rn,{allowedRoles:["user"],children:p.jsx(oO,{})})}),p.jsx(Zt,{path:"/watch-stream",element:p.jsx(Rn,{allowedRoles:["user"],children:p.jsx(oO,{})})}),p.jsx(Zt,{path:"/donate",element:p.jsx(Rn,{children:p.jsx(Qwe,{})})}),p.jsx(Zt,{path:"/coin-wallet",element:p.jsx(Rn,{allowedRoles:["user"],children:p.jsx(Hwe,{})})}),p.jsx(Zt,{path:"/book-consultation",element:p.jsx(Rn,{allowedRoles:["user"],children:p.jsx(DG,{})})}),p.jsx(Zt,{path:"/scholar/:scholarId/book",element:p.jsx(Rn,{allowedRoles:["user"],children:p.jsx(ibe,{})})}),p.jsx(Zt,{path:"/my-bookings",element:p.jsx(Rn,{children:p.jsx(BG,{})})}),p.jsx(Zt,{path:"/activity-categories",element:p.jsx(Rn,{children:p.jsx(kG,{})})}),p.jsx(Zt,{path:"/activities/:categoryId",element:p.jsx(Rn,{children:p.jsx(LG,{})})}),p.jsx(Zt,{path:"/start-stream",element:p.jsx(Rn,{allowedRoles:["scholar","imam"],children:p.jsx(Gwe,{})})}),p.jsx(Zt,{path:"/manage-consultations",element:p.jsx(Rn,{allowedRoles:["scholar","imam"],children:p.jsx(Kwe,{})})}),p.jsx(Zt,{path:"/scholar-dashboard",element:p.jsx(Rn,{allowedRoles:["scholar","imam"],children:p.jsx(Wwe,{})})}),p.jsx(Zt,{path:"/scholar-consultations",element:p.jsx(Rn,{allowedRoles:["scholar","imam"],children:p.jsx(xG,{})})}),p.jsx(Zt,{path:"/wallet",element:p.jsx(Rn,{allowedRoles:["scholar","imam"],children:p.jsx(Ywe,{})})}),p.jsx(Zt,{path:"/scholar-consultations",element:p.jsx(Rn,{allowedRoles:["scholar","imam"],children:p.jsx(xG,{})})}),p.jsx(Zt,{path:"/availability",element:p.jsx(Rn,{allowedRoles:["scholar","imam"],children:p.jsx(zwe,{})})}),p.jsx(Zt,{path:"/livestreams",element:p.jsx(Rn,{children:p.jsx(Xwe,{})})}),p.jsx(Zt,{path:"/restaurants",element:p.jsx(Rn,{children:p.jsx(oIe,{})})}),p.jsx(Zt,{path:"/profile-settings",element:p.jsx(Rn,{children:p.jsx(Jwe,{})})}),p.jsx(Zt,{path:"/scholar/:scholarId",element:p.jsx(Rn,{children:p.jsx($we,{})})}),p.jsx(Zt,{path:"/consultation/:consultationId/messages",element:p.jsx(Rn,{children:p.jsx(Zwe,{})})}),p.jsx(Zt,{path:"/consultation/:consultationId/review",element:p.jsx(Rn,{allowedRoles:["user"],children:p.jsx(ebe,{consultationId:"",scholarId:"",scholarName:""})})}),p.jsx(Zt,{path:"/delete-account",element:p.jsx(Rn,{children:p.jsx(tbe,{})})}),p.jsx(Zt,{path:"/test-agora",element:p.jsx(Rn,{children:p.jsx(rbe,{})})}),p.jsx(Zt,{path:"/my-bookings",element:p.jsx(Rn,{children:p.jsx(BG,{})})}),p.jsx(Zt,{path:"/activity-categories",element:p.jsx(Rn,{children:p.jsx(kG,{})})}),p.jsx(Zt,{path:"/activities/:categoryId",element:p.jsx(Rn,{children:p.jsx(LG,{})})}),p.jsx(Zt,{path:"/prayer-services",element:p.jsx(Rn,{children:p.jsx(oO,{})})}),p.jsx(Zt,{path:"/available-scholars",element:p.jsx(Rn,{children:p.jsx(DG,{})})}),p.jsx(Zt,{path:"/reels",element:p.jsx(Rn,{children:p.jsx(aIe,{})})}),p.jsx(Zt,{path:"/activities",element:p.jsx(Rn,{children:p.jsx(cIe,{})})}),p.jsx(Zt,{path:"*",element:p.jsx(dIe,{})})]}),!1]})})})})}function dIe(){return p.jsx("div",{className:"min-h-screen flex items-center justify-center p-4",children:p.jsxs("div",{className:"text-center",children:[p.jsx("h1",{className:"text-4xl font-bold mb-4",children:"404"}),p.jsx("p",{className:"text-muted-foreground mb-4",children:"Page not found"}),p.jsx("a",{href:"/dashboard",className:"text-primary hover:underline",children:"Go to Dashboard"})]})})}const uIe=async()=>{try{const{Capacitor:r}=await n_(async()=>{const{Capacitor:a}=await import("./index-BjkuSehU.js");return{Capacitor:a}},[],import.meta.url);if(!r.isNativePlatform()){console.log("Running on web - Capacitor features disabled");return}const{App:s}=await n_(async()=>{const{App:a}=await import("./index-BqZ6UJOu.js");return{App:a}},__vite__mapDeps([3,1]),import.meta.url);s.addListener("appStateChange",({isActive:a})=>{localStorage.setItem("masjid-last-activity",new Date().toISOString()),console.log("App state changed:",a?"active":"background")}),s.addListener("pause",()=>{localStorage.setItem("masjid-last-activity",new Date().toISOString()),localStorage.setItem("masjid-app-paused","true")}),s.addListener("resume",()=>{localStorage.setItem("masjid-last-activity",new Date().toISOString()),localStorage.removeItem("masjid-app-paused")})}catch(r){console.log("Capacitor not available:",r)}};console.log(" main.tsx: File loaded");uIe();const _l=document.getElementById("root");console.log(" Root element:",_l?"Found":"NOT FOUND");window.addEventListener("error",r=>{var s;console.error(" Global error:",r.error),_l&&(_l.innerHTML=`
      <div style="padding: 20px; font-family: sans-serif; max-width: 800px; margin: 0 auto;">
        <h1 style="color: red;"> Application Error</h1>
        <p><strong>Message:</strong> ${r.message}</p>
        <p><strong>File:</strong> ${r.filename}:${r.lineno}:${r.colno}</p>
        <details>
          <summary style="cursor: pointer; color: #059669; font-weight: bold;">Stack Trace</summary>
          <pre style="background: #f5f5f5; padding: 10px; overflow: auto; font-size: 12px;">${((s=r.error)==null?void 0:s.stack)||"No stack trace available"}</pre>
        </details>
        <button onclick="location.reload()" style="margin-top: 20px; padding: 10px 20px; background: #059669; color: white; border: none; border-radius: 4px; cursor: pointer;">Reload App</button>
      </div>
    `)});window.addEventListener("unhandledrejection",r=>{console.error(" Unhandled promise rejection:",r.reason),_l&&(_l.innerHTML=`
      <div style="padding: 20px; font-family: sans-serif; max-width: 800px; margin: 0 auto;">
        <h1 style="color: red;"> Promise Rejection</h1>
        <pre style="background: #f5f5f5; padding: 10px; overflow: auto;">${r.reason}</pre>
        <button onclick="location.reload()" style="margin-top: 20px; padding: 10px 20px; background: #059669; color: white; border: none; border-radius: 4px; cursor: pointer;">Reload App</button>
      </div>
    `)});try{if(!_l)throw console.error(" Root element not found!"),new Error("Root element not found in DOM!");console.log(" Step 1: Root element found, importing App..."),console.log(" Step 2: Creating React root...");const r=Hfe.createRoot(_l);console.log(" Step 3: React root created, rendering App..."),r.render(p.jsx(z.StrictMode,{children:p.jsx(AIe,{})})),console.log(" Step 4: React render() called - App should be mounting...")}catch(r){console.error(" Failed to render app:",r),_l&&(_l.innerHTML=`
      <div style="padding: 20px; font-family: sans-serif; max-width: 800px; margin: 0 auto;">
        <h1 style="color: red;"> Failed to Initialize</h1>
        <pre style="background: #f5f5f5; padding: 10px; overflow: auto; white-space: pre-wrap;">${r instanceof Error?r.message+`

`+r.stack:String(r)}</pre>
        <button onclick="location.reload()" style="margin-top: 20px; padding: 10px 20px; background: #059669; color: white; border: none; border-radius: 4px; cursor: pointer;">Reload App</button>
      </div>
    `)}export{n_ as _};
